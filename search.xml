<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ç½‘ç«™æ–‡æ¡£mkdocs</title>
    <url>/2020/05/03/%E7%BD%91%E7%AB%99%E6%96%87%E6%A1%A3mkdocs/</url>
    <content><![CDATA[<h2 id="Mkdocs"><a href="#Mkdocs" class="headerlink" title="Mkdocs"></a>Mkdocs</h2><p><a href="https://www.mkdocs.org/#mkdocs" target="_blank" rel="noopener">mkdocs.org</a></p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><ol>
<li>å®‰è£…python2.7ï¼ˆå®‰è£…æ—¶é€‰ä¸­åŠ å…¥ç¯å¢ƒå˜é‡ï¼‰</li>
<li>pip install mkdocs &amp; mkdocs â€“version</li>
<li>pip install click-man</li>
<li>mkdocs new my-project &amp; cd my-project</li>
<li>mkdocs serve</li>
<li>mkdocs build</li>
<li>mkdocs build â€“clean (æ¸…ç†å·²è¢«åˆ é™¤çš„æ–‡æ¡£æ‰€ç”Ÿæˆçš„htmlæ–‡ä»¶)</li>
</ol>
<p>mkdocs-materialä¸»é¢˜é…ç½®<br><a href="https://squidfunk.github.io/mkdocs-material/getting-started/" target="_blank" rel="noopener">ç‚¹å‡»çœ‹æ•ˆæœ mkdocs-material</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. pip install mkdocs-material</span><br><span class="line">2. vim mkdocs.yml</span><br></pre></td></tr></table></figure>

<p>mkdocs.yml é…ç½®ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">site_name: æ–‡æ¡£ä¸­å¿ƒ</span><br><span class="line">theme:</span><br><span class="line">  name: &#39;material&#39;</span><br><span class="line">  palette:</span><br><span class="line">    primary: &#39;teal&#39;</span><br><span class="line">    accent: &#39;teal&#39;</span><br><span class="line">  font:</span><br><span class="line">    text: &#39;Roboto&#39;</span><br><span class="line">    code: &#39;Roboto Mono&#39;</span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdocs new [dir-name] - Create a new project.</span><br><span class="line">mkdocs serve - Start the live-reloading docs server.</span><br><span class="line">mkdocs build - Build the documentation site.</span><br><span class="line">mkdocs help - Print this help message.</span><br></pre></td></tr></table></figure>

<h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdocs.yml    # The configuration file.</span><br><span class="line">docs&#x2F;</span><br><span class="line">    index.md  # The documentation homepage.</span><br><span class="line">    ...       # Other markdown pages, images and other files.</span><br></pre></td></tr></table></figure>

<h2 id="å¦å¤–å‡ ç§æ–‡æ¡£è®°å½•æ–¹å¼"><a href="#å¦å¤–å‡ ç§æ–‡æ¡£è®°å½•æ–¹å¼" class="headerlink" title="å¦å¤–å‡ ç§æ–‡æ¡£è®°å½•æ–¹å¼"></a>å¦å¤–å‡ ç§æ–‡æ¡£è®°å½•æ–¹å¼</h2><ul>
<li>gitbook</li>
<li>wiki</li>
<li>docusaurus</li>
<li>MM-wiki</li>
</ul>
]]></content>
      <categories>
        <category>docs</category>
      </categories>
      <tags>
        <tag>docs</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨</title>
    <url>/2020/05/03/Python%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</url>
    <content><![CDATA[<h2 id="æœ‰è¶£çš„pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#æœ‰è¶£çš„pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="æœ‰è¶£çš„pythonä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>æœ‰è¶£çš„<code>python</code>ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h2><p><a href="https://mp.weixin.qq.com/s/h0YYmehLuO8QF5Ry7b7fiQ" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a><br><a href="https://mp.weixin.qq.com/s/rPFL7KXwD8Bof60lewqTMA" target="_blank" rel="noopener">æ–‡ç« </a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘å­˜å‚¨å¹³å°Seafile</title>
    <url>/2020/05/03/%E4%BA%91%E5%AD%98%E5%82%A8%E5%B9%B3%E5%8F%B0Seafile/</url>
    <content><![CDATA[<h2 id="äº‘å­˜å‚¨å¹³å°seafile"><a href="#äº‘å­˜å‚¨å¹³å°seafile" class="headerlink" title="äº‘å­˜å‚¨å¹³å°seafile"></a>äº‘å­˜å‚¨å¹³å°seafile</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;haiwen&#x2F;seafile</span><br></pre></td></tr></table></figure>

<p>Seafile çš„ç›®æ ‡æ˜¯ç»™ä¼ä¸šæä¾›ä¸€ä¸ªå®‰å…¨çš„äº‘å­˜å‚¨å¹³å°ï¼Œæ»¡è¶³ä¼ä¸šæ–‡ä»¶çš„å…±äº«å’Œåä½œçš„éœ€æ±‚ã€‚</p>
<p>Seafile é‡‡ç”¨å¼€æºçš„æ–¹å¼æ¥è¿›è¡Œäº§å“å¼€å‘ã€‚å¼€æºå¸®åŠ© Seafile æˆä¸ºäº†ä¸€ä¸ªå›½é™…åŒ–çš„é¡¹ç›®ï¼Œå¹¶å¸å¼•äº†å…¨çƒç”¨æˆ·çš„å‚ä¸å’Œè´¡çŒ®ã€‚ç›®å‰æˆ‘ä»¬å·²ç»åœ¨ Github å¼€æºä»£ç æ‰˜ç®¡å¹³å°ä¸Šæœ‰äº† 3900 å¤šä¸ªå…³æ³¨ã€‚å…¨çƒç”¨æˆ·çš„ä½¿ç”¨ã€åé¦ˆå’Œå®¡æ ¸ä½¿å¾— Seafile æ›´åŠ çš„å®‰å…¨å’Œç¨³å®šã€‚</p>
<p>æˆªè‡³ 2016 å¹´åˆï¼ŒSeafile å·²ç»æœ‰è¶…è¿‡ 30 ä¸‡ç”¨æˆ·ä½¿ç”¨ï¼Œå¹¶æ‹¥æœ‰å¡å·´æ–¯åŸºï¼Œå¾·å›½ Mainz å¤§å­¦ï¼Œå¾·å›½ HU Berlin å¤§å­¦å’Œæ³•å›½ Strasbourg å¤§å­¦ç­‰å¤§å‹ç»„ç»‡æœºæ„å®¢æˆ·ã€‚</p>
<p><a href="https://www.seafile.com/home/" target="_blank" rel="noopener">https://www.seafile.com/home/</a></p>
<h2 id="nextcloud"><a href="#nextcloud" class="headerlink" title="nextcloud"></a>nextcloud</h2><blockquote>
<p>å¦ä¸€ä¸ªå¼€æ”¾äº‘ç›˜æœåŠ¡</p>
</blockquote>
]]></content>
      <categories>
        <category>Seafile</category>
      </categories>
      <tags>
        <tag>Seafile</tag>
      </tags>
  </entry>
  <entry>
    <title>EditorConfigä½¿ç”¨ä»‹ç»</title>
    <url>/2020/05/03/EditorConfig%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<p>åœ¨githubçœ‹åˆ°å¾ˆå¤šé¡¹ç›®æ ¹ç›®å½•éƒ½æœ‰ .editorconfig æ–‡ä»¶ï¼Œæ‰€ä»¥å»äº†è§£ä¸€ä¸‹ã€‚</p>
<p>è¿™ä¸ªæ–‡ä»¶æ˜¯ EditorConfig ç”¨æ¥ç»Ÿä¸€ä¸åŒç¼–è¾‘å™¨çš„ä»£ç é£æ ¼çš„é…ç½®ã€‚</p>
<p>å„ç§IDEçš„é£æ ¼è‡ªç„¶ä¸ä¸€æ ·ï¼Œé€šè¿‡è¿™æ ·ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰çš„æ ‡å‡†ç»Ÿä¸€é£æ ¼ï¼Œæ¯”å¦‚ç¼©è¿›ç”¨xä¸ªç©ºæ ¼ã€‚å†æœ‰å°±æ˜¯å¤šäººä¸€èµ·ååŒå¼€å‘ä¸€ä¸ªé¡¹ç›®ï¼Œeditorconfig èƒ½èµ·åˆ°å¾ˆå¥½çš„æ•ˆæœã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># EditorConfig: http:&#x2F;&#x2F;editorconfig.org&#x2F;</span><br><span class="line"></span><br><span class="line">root &#x3D; true</span><br><span class="line"></span><br><span class="line">[*]</span><br><span class="line">indent_style &#x3D; space</span><br><span class="line">indent_size &#x3D; 4</span><br><span class="line">end_of_line &#x3D; lf</span><br><span class="line">charset &#x3D; utf-8</span><br><span class="line">trim_trailing_whitespace &#x3D; true</span><br><span class="line">insert_final_newline &#x3D; true</span><br><span class="line"></span><br><span class="line">[*.md]</span><br><span class="line">trim_trailing_whitespace &#x3D; false</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>IDE</category>
      </categories>
      <tags>
        <tag>IDE</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexoå†…ç½®æ ‡ç­¾</title>
    <url>/2020/04/23/Hexo%E5%86%85%E7%BD%AE%E6%A0%87%E7%AD%BE/</url>
    <content><![CDATA[<h2 id="Hexoå†…ç½®æ ‡ç­¾"><a href="#Hexoå†…ç½®æ ‡ç­¾" class="headerlink" title="Hexoå†…ç½®æ ‡ç­¾"></a>Hexoå†…ç½®æ ‡ç­¾</h2><blockquote>
<p>ã€Œæ ‡ç­¾ã€(Tag Plugin) æ˜¯ Hexo æä¾›çš„ä¸€ç§å¿«é€Ÿç”Ÿæˆç‰¹å®šå†…å®¹çš„æ–¹å¼ã€‚ ä¾‹å¦‚ï¼Œåœ¨æ ‡å‡† Markdown è¯­æ³•ä¸­ï¼Œæˆ‘ä»¬æ— æ³•æŒ‡å®šå›¾ç‰‡çš„å¤§å°ã€‚è¿™ç§æƒ…æ™¯ï¼Œæˆ‘ä»¬å³å¯ä½¿ç”¨æ ‡ç­¾æ¥è§£å†³ã€‚ Hexo å†…ç½®æ¥è®¸å¤šæ ‡ç­¾æ¥å¸®åŠ©å†™ä½œè€…å¯ä»¥æ›´å¿«çš„ä¹¦å†™ï¼Œ <a href="https://hexo.io/docs/tag-plugins.html" target="_blank" rel="noopener">å®Œæ•´çš„æ ‡ç­¾åˆ—è¡¨</a> å¯ä»¥å‚è€ƒ Hexo å®˜ç½‘ã€‚ å¦å¤–ï¼ŒHexo ä¹Ÿå¼€æ”¾æ¥æ¥å£ç»™ä¸»é¢˜ï¼Œä½¿ä¸»é¢˜æœ‰å¯èƒ½æä¾›ç»™å†™ä½œè€…æ›´ç®€ä¾¿çš„å†™ä½œæ–¹æ³•ã€‚ ä»¥ä¸‹æ ‡ç­¾ä¾¿æ˜¯ NexT ä¸»é¢˜å½“å‰æä¾›çš„æ ‡ç­¾ã€‚</p>
</blockquote>
<h3 id="æ–‡æœ¬å±…ä¸­çš„å¼•ç”¨"><a href="#æ–‡æœ¬å±…ä¸­çš„å¼•ç”¨" class="headerlink" title="æ–‡æœ¬å±…ä¸­çš„å¼•ç”¨"></a>æ–‡æœ¬å±…ä¸­çš„å¼•ç”¨</h3><hr>
<p>æ­¤æ ‡ç­¾å°†ç”Ÿæˆä¸€ä¸ªå¸¦ä¸Šä¸‹åˆ†å‰²çº¿çš„å¼•ç”¨ï¼ŒåŒæ—¶å¼•ç”¨å†…æ–‡æœ¬å°†è‡ªåŠ¨å±…ä¸­ã€‚ æ–‡æœ¬å±…ä¸­æ—¶ï¼Œå¤šè¡Œæ–‡æœ¬è‹¥é•¿åº¦ä¸ç­‰ï¼Œè§†è§‰ä¸Šä¼šæ˜¾å¾—ä¸å¯¹ç§°ï¼Œå› æ­¤å»ºè®®åœ¨å¼•ç”¨å•è¡Œæ–‡æœ¬çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚ ä¾‹å¦‚ä½œä¸ºæ–‡ç« å¼€ç¯‡å¼•ç”¨ æˆ–è€… ç»“æŸè¯­ä¹‹å‰çš„æ€»ç»“å¼•ç”¨ã€‚</p>
<h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><ul>
<li>HTMLæ–¹å¼ï¼šä½¿ç”¨è¿™ç§æ–¹å¼æ—¶ï¼Œç»™ img æ·»åŠ å±æ€§ class=â€blockquote-centerâ€ å³å¯ã€‚</li>
<li>æ ‡ç­¾æ–¹å¼ï¼šä½¿ç”¨ centerquote æˆ–è€… ç®€å†™ cq<blockquote>
<p>æ­¤æ ‡ç­¾è¦æ±‚ NexT çš„ç‰ˆæœ¬åœ¨ 0.4.5 æˆ–ä»¥ä¸Šã€‚ è‹¥ä½ æ­£åœ¨ä½¿ç”¨çš„ç‰ˆæœ¬æ¯”è¾ƒä½ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ HTML æ–¹å¼ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!-- HTMLæ–¹å¼: ç›´æ¥åœ¨ Markdown æ–‡ä»¶ä¸­ç¼–å†™ HTML æ¥è°ƒç”¨ --&gt;</span><br><span class="line">&lt;!-- å…¶ä¸­ class&#x3D;&quot;blockquote-center&quot; æ˜¯å¿…é¡»çš„ --&gt;</span><br><span class="line">&lt;blockquote class&#x3D;&quot;blockquote-center&quot;&gt;blah blah blah&lt;&#x2F;blockquote&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- æ ‡ç­¾ æ–¹å¼ï¼Œè¦æ±‚ç‰ˆæœ¬åœ¨0.4.5æˆ–ä»¥ä¸Š --&gt;</span><br><span class="line">&#123;% centerquote %&#125;blah blah blah&#123;% endcenterquote %&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- æ ‡ç­¾åˆ«å --&gt;</span><br><span class="line">&#123;% cq %&#125; blah blah blah &#123;% endcq %&#125;</span><br></pre></td></tr></table></figure>



</li>
</ul>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€æ˜“HTTPS åŠ å¯†è¯ä¹¦çš„å·¥å…·</title>
    <url>/2020/05/03/%E7%AE%80%E6%98%93HTTPS-%E5%8A%A0%E5%AF%86%E8%AF%81%E4%B9%A6%E7%9A%84%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<p><a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noopener">mkcert</a> æ˜¯ç”Ÿæˆæœ¬åœ° HTTPS åŠ å¯†è¯ä¹¦çš„å·¥å…·ï¼Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆè¯ä¹¦ï¼Œä¸éœ€è¦ä»»ä½•é…ç½®ã€‚</p>
<p>åœ¨ Linux ä¸Šï¼Œå®‰è£… certutil</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo apt install libnss3-tools</span><br><span class="line">$ sudo yum install nss-tools</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mkcert -install</span><br><span class="line">Created a new local CA at &quot;&#x2F;Users&#x2F;filippo&#x2F;Library&#x2F;Application Support&#x2F;mkcert&quot; ğŸ’¥</span><br><span class="line">The local CA is now installed in the system trust store! âš¡ï¸</span><br><span class="line">The local CA is now installed in the Firefox trust store (requires restart)! ğŸ¦Š</span><br><span class="line"></span><br><span class="line">$ mkcert example.com &#39;*.example.org&#39; myapp.dev localhost 127.0.0.1 ::1</span><br><span class="line">Using the local CA at &quot;&#x2F;Users&#x2F;filippo&#x2F;Library&#x2F;Application Support&#x2F;mkcert&quot; âœ¨</span><br><span class="line"></span><br><span class="line">Created a new certificate valid for the following names ğŸ“œ</span><br><span class="line"> - &quot;example.com&quot;</span><br><span class="line"> - &quot;*.example.org&quot;</span><br><span class="line"> - &quot;myapp.dev&quot;</span><br><span class="line"> - &quot;localhost&quot;</span><br><span class="line"> - &quot;127.0.0.1&quot;</span><br><span class="line"> - &quot;::1&quot;</span><br><span class="line"></span><br><span class="line">The certificate is at &quot;.&#x2F;example.com+5.pem&quot; and the key at &quot;.&#x2F;example.com+5-key.pem&quot; âœ…</span><br></pre></td></tr></table></figure>

<p><a href="https://keer.me/Using-mkcert-to-generate-local-HTTPS-certificates.html" target="_blank" rel="noopener">ä½¿ç”¨æ–¹æ³•å‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>LDAP éƒ¨ç½²æ–‡æ¡£</title>
    <url>/2020/04/23/LDAP-%E9%83%A8%E7%BD%B2%E6%96%87%E6%A1%A3/</url>
    <content><![CDATA[<h2 id="LDAP-åŸºæœ¬æ¦‚å¿µ"><a href="#LDAP-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="LDAP åŸºæœ¬æ¦‚å¿µ"></a>LDAP åŸºæœ¬æ¦‚å¿µ</h2><table>
<thead>
<tr>
<th align="left">å…³é”®å­—</th>
<th align="right">è‹±æ–‡åç§°</th>
<th align="center">ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="left">dc</td>
<td align="right">Domain Compnent</td>
<td align="center">åŸŸåçš„éƒ¨åˆ†ï¼Œå…¶æ ¼å¼æ˜¯å°†å®Œæ•´çš„åŸŸååˆ†æˆå‡ éƒ¨åˆ†ï¼Œå¦‚åŸŸåä¸ºexample.comå˜æˆdc=example,dc=comï¼ˆä¸€æ¡è®°å½•çš„æ‰€å±ä½ç½®</td>
</tr>
<tr>
<td align="left">uid</td>
<td align="right">User Id</td>
<td align="center">ç”¨æˆ·ID shuke.comï¼ˆä¸€æ¡è®°å½•çš„IDï¼‰</td>
</tr>
<tr>
<td align="left">ou</td>
<td align="right">Organization Unit</td>
<td align="center">ç»„ç»‡å•ä½ï¼Œç»„ç»‡å•ä½å¯ä»¥åŒ…å«å…¶ä»–å„ç§å¯¹è±¡(åŒ…æ‹¬å…¶ä»–ç»„ç»‡å•å…ƒ)ï¼Œå¦‚â€oaç»„â€(ä¸€æ¡è®°å½•çš„æ‰€å±ç»„ç»‡)</td>
</tr>
<tr>
<td align="left">cn</td>
<td align="right">Common Name</td>
<td align="center">å…¬å…±åç§°ï¼Œå¦‚â€Thomas Johanssonâ€(ä¸€æ¡è®°å½•çš„åç§°)</td>
</tr>
<tr>
<td align="left">sn</td>
<td align="right">Surname</td>
<td align="center">å§“,å¦‚â€èµµâ€</td>
</tr>
<tr>
<td align="left">dn</td>
<td align="right">Distinguished Name</td>
<td align="center">â€œuid=songtao.xu,ou=oaç»„,dc=example,dc=comâ€ï¼Œä¸€æ¡è®°å½•çš„ä½ç½®(å”¯ä¸€)</td>
</tr>
<tr>
<td align="left">rdn</td>
<td align="right">Relative dn</td>
<td align="center">ç›¸å¯¹è¾¨åˆ«å,ç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›¸å¯¹è·¯å¾„ï¼Œå®ƒæ˜¯ä¸ç›®å½•æ ‘ç»“æ„æ— å…³çš„éƒ¨åˆ†ï¼Œå¦‚â€uid=tomâ€æˆ–â€cn= Thomas Johanssonâ€</td>
</tr>
</tbody></table>
<h2 id="LDAP-éƒ¨ç½²æ–‡æ¡£"><a href="#LDAP-éƒ¨ç½²æ–‡æ¡£" class="headerlink" title="LDAP éƒ¨ç½²æ–‡æ¡£"></a>LDAP éƒ¨ç½²æ–‡æ¡£</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;issue</span><br><span class="line">Ubuntu 16.04.6 LTS \n \l</span><br><span class="line"># uname -r</span><br><span class="line">4.4.0-142-generic</span><br><span class="line"># slapd -VV</span><br><span class="line">@(#) $OpenLDAP: slapd  (Ubuntu) (Apr 10 2019 13:01:36) $</span><br><span class="line">	buildd@lgw01-amd64-031:&#x2F;build&#x2F;openldap-QaSHhB&#x2F;openldap-2.4.42+dfsg&#x2F;debian&#x2F;build&#x2F;servers&#x2F;slapd</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€-å®‰è£…"><a href="#ä¸€-å®‰è£…" class="headerlink" title="ä¸€. å®‰è£…"></a>ä¸€. å®‰è£…</h3><ol>
<li>å®‰è£…è½¯ä»¶åŒ…<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># apt install slapd ldap-utils -y</span><br><span class="line">åœ¨å®‰è£…è¿‡ç¨‹ä¸­,å°†è¦æ±‚æ‚¨è¾“å…¥å¹¶ç¡®è®¤LDAPçš„ç®¡ç†å‘˜å¯†ç ã€‚</span><br></pre></td></tr></table></figure></li>
<li>åˆå§‹åŒ–é…ç½®<blockquote>
<p>OpenLDAP 2.3 and later have transitioned to using a dynamic runtime configuration engine, slapd-config. <a href="https://www.openldap.org/doc/admin24/slapdconf2.html" target="_blank" rel="noopener">Configuring slapd</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># dpkg-reconfigure slapd</span><br><span class="line">1. Omit OpenLDAP server configuration: No</span><br><span class="line">2. DNS domain name as base DN: wecash.net</span><br><span class="line">3. Organization name: wecash Organization</span><br><span class="line">4. Administrator password: wecash@2019</span><br><span class="line">5. Database backend to use: MDB</span><br><span class="line">6. Do you want the database to be removed when slapd is purged: No</span><br><span class="line">7. Move old database: Yes</span><br><span class="line">8. Allow LDAPv2 protocol? No</span><br></pre></td></tr></table></figure></li>
<li>Configuration Layout<br>A sample config tree is shown<br><img src="https://www.openldap.org/doc/admin24/config_dit.png" alt="config_dit.png"></li>
<li>éªŒè¯æ˜¯å¦è¿è¡Œ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ps -ef | grep slapd</span><br><span class="line">openldap 11394     1  0 11:54 ?        00:00:00 &#x2F;usr&#x2F;sbin&#x2F;slapd -h ldap:&#x2F;&#x2F;&#x2F; ldapi:&#x2F;&#x2F;&#x2F; -g openldap -u openldap -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d</span><br><span class="line">root     11419  1227  0 11:55 pts&#x2F;0    00:00:00 grep --color&#x3D;auto slapd</span><br><span class="line"># netstat -ntlp | grep 389</span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      11394&#x2F;slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      11394&#x2F;slapd</span><br></pre></td></tr></table></figure>
æ³¨: è½¯ä»¶é»˜è®¤å®‰è£…è·¯å¾„ä¸º<code>/etc/ldap</code>,mdbæ•°æ®åº“æ–‡ä»¶å­˜æ”¾è·¯å¾„ä¸º<code>/var/lib/ldap/</code></li>
<li>æµ‹è¯•LDAPçš„æ¥å£<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapwhoami -H ldap:&#x2F;&#x2F; -x</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure>
anonymousæ˜¯åŒ¿åç”¨æˆ·çš„æŸ¥è¯¢ç»“æœ,å› ä¸ºæˆ‘ä»¬è¿è¡Œldapwhoamiè€Œä¸ç™»å½•åˆ°LDAPæœåŠ¡å™¨.è¿™æ„å‘³ç€æœåŠ¡å™¨æ­£åœ¨è¿è¡Œå¹¶åº”ç­”æŸ¥è¯¢.</li>
<li>å¯åŠ¨åœæ­¢<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># systemctl stop slapd.service</span><br><span class="line"># systemctl start slapd.service</span><br></pre></td></tr></table></figure>
è‡³æ­¤,LDAPçš„åˆæ­¥åŸºæœ¬é…ç½®å·²ç»å®Œæˆ.å®˜æ–¹æ–‡æ¡£è§£é‡Šåœ¨2.3ä¹‹åçš„ç‰ˆæœ¬ä½¿ç”¨åŠ¨æ€çš„é…ç½®æ–‡ä»¶çš„æ–¹å¼,ä½¿ç”¨ldapadd, ldapdelete or ldapmodifyä¿®æ”¹æ›´æ–°é…ç½®ä¿¡æ¯ä»¥åŠæ•°æ®åº“ä¿¡æ¯,ä¸å»ºè®®ä½¿ç”¨slapd.confé…ç½®æ–‡ä»¶æ–¹å¼è¿›è¡Œç®¡ç†.</li>
</ol>
<h3 id="äºŒ-æŸ¥çœ‹åˆå§‹åŒ–ä¿¡æ¯"><a href="#äºŒ-æŸ¥çœ‹åˆå§‹åŒ–ä¿¡æ¯" class="headerlink" title="äºŒ. æŸ¥çœ‹åˆå§‹åŒ–ä¿¡æ¯"></a>äºŒ. æŸ¥çœ‹åˆå§‹åŒ–ä¿¡æ¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapsearch -Q -LLL -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -b cn&#x3D;config dn</span><br><span class="line">dn: cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;module&#123;0&#125;,cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;&#123;0&#125;core,cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;&#123;1&#125;cosine,cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;&#123;2&#125;nis,cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">dn: cn&#x3D;&#123;3&#125;inetorgperson,cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">dn: olcBackend&#x3D;&#123;0&#125;mdb,cn&#x3D;config</span><br><span class="line">dn: olcDatabase&#x3D;&#123;-1&#125;frontend,cn&#x3D;config</span><br><span class="line">dn: olcDatabase&#x3D;&#123;0&#125;config,cn&#x3D;config</span><br><span class="line">dn: olcDatabase&#x3D;&#123;1&#125;mdb,cn&#x3D;config</span><br><span class="line"></span><br><span class="line"># ldapsearch -x -LLL -H ldap:&#x2F;&#x2F;&#x2F; -b dc&#x3D;wecash,dc&#x3D;net dn</span><br><span class="line">dn: dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰-TLS"><a href="#ä¸‰-TLS" class="headerlink" title="ä¸‰. TLS"></a>ä¸‰. TLS</h3><ol>
<li>Install the gnutls-bin and ssl-cert packages<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># apt install gnutls-bin ssl-cert</span><br></pre></td></tr></table></figure></li>
<li>Create a private key for the Certificate Authority<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sh -c &quot;certtool --generate-privkey &gt; &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;cakey.pem&quot;</span><br></pre></td></tr></table></figure></li>
<li>Create the template/file /etc/ssl/ca.info to define the CA<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cn &#x3D; Wecash Company</span><br><span class="line">ca</span><br><span class="line">cert_signing_key</span><br></pre></td></tr></table></figure></li>
<li>Create the self-signed CA certificate<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># certtool --generate-self-signed --load-privkey &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;cakey.pem --template &#x2F;etc&#x2F;ssl&#x2F;ca.info --outfile &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;cacert.pem</span><br></pre></td></tr></table></figure></li>
<li>Make a private key for the server<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># certtool --generate-privkey --sec-param Medium --outfile &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;tldap.wecash.net-key.pem</span><br></pre></td></tr></table></figure></li>
<li>Create the /etc/ssl/tldap.wecash.net.info info file containing<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">organization &#x3D; Wecash Company</span><br><span class="line">cn &#x3D; tldap.wecash.net</span><br><span class="line">tls_www_server</span><br><span class="line">encryption_key</span><br><span class="line">signing_key</span><br><span class="line">expiration_days &#x3D; 3650</span><br></pre></td></tr></table></figure></li>
<li>Create the serverâ€™s certificate<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># certtool --generate-certificate --load-privkey &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;tldap.wecash.net-key.pem --load-ca-certificate &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;cacert.pem --load-ca-privkey &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;cakey.pem --template &#x2F;etc&#x2F;ssl&#x2F;tldap.wecash.net.info --outfile &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;tldap.wecash.net.pem</span><br></pre></td></tr></table></figure></li>
<li>Adjust permissions and ownership<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mkdir &#x2F;etc&#x2F;ldap&#x2F;certs</span><br><span class="line"># cp &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;tldap.wecash.net-key.pem &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;</span><br><span class="line"># cp &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;cacert.pem &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;</span><br><span class="line"># cp &#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;tldap.wecash.net.pem &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;</span><br><span class="line"># chown -R openldap.openldap &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;</span><br><span class="line"># chmod 0640 &#x2F;etc&#x2F;ssl&#x2F;private&#x2F;tldap.wecash.net-key.pem</span><br><span class="line"># gpasswd -a openldap ssl-cert</span><br></pre></td></tr></table></figure></li>
<li>Create the file certinfo.ldif<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat certinfo.ldif</span><br><span class="line"># create new</span><br><span class="line">dn: cn&#x3D;config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcTLSCACertificateFile</span><br><span class="line">olcTLSCACertificateFile: &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;cacert.pem</span><br><span class="line">-</span><br><span class="line">replace: olcTLSCertificateFile</span><br><span class="line">olcTLSCertificateFile: &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;tldap.wecash.net.pem</span><br><span class="line">-</span><br><span class="line">replace: olcTLSCertificateKeyFile</span><br><span class="line">olcTLSCertificateKeyFile: &#x2F;etc&#x2F;ldap&#x2F;certs&#x2F;tldap.wecash.net-key.pem</span><br></pre></td></tr></table></figure></li>
<li>Use the ldapmodify command to tell slapd about our TLS work via the slapd-config database<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapmodify -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f certinfo.ldif</span><br><span class="line">SASL&#x2F;EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;external,cn&#x3D;auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">modifying entry &quot;cn&#x3D;config&quot;</span><br></pre></td></tr></table></figure></li>
<li>Contratry to popular belief, you do need Add <code>ldaps:///</code> in /etc/default/slapd in order to use encryption. You should have just<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># vim &#x2F;etc&#x2F;default&#x2F;slapd</span><br><span class="line">SLAPD_SERVICES&#x3D;&quot;ldap:&#x2F;&#x2F;&#x2F; ldapi:&#x2F;&#x2F;&#x2F; ldaps:&#x2F;&#x2F;&#x2F;&quot;</span><br></pre></td></tr></table></figure></li>
<li>ä¿®æ”¹è¯·æ±‚åŸŸå<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat slapd.ldif</span><br><span class="line"># log</span><br><span class="line">dn: cn&#x3D;config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcLogLevel</span><br><span class="line">olcLogLevel: stats</span><br><span class="line">-</span><br><span class="line">add: olcIdleTimeout</span><br><span class="line">olcIdleTimeout: 30</span><br><span class="line">-</span><br><span class="line">add: olcReferral</span><br><span class="line">olcReferral: ldaps:&#x2F;&#x2F;tldap.wecash.net</span><br><span class="line">-</span><br><span class="line">add: olcLogFile</span><br><span class="line">olcLogFile: &#x2F;var&#x2F;log&#x2F;sladp.log</span><br><span class="line"></span><br><span class="line"># ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f slapd.ldif</span><br><span class="line">modifying entry &quot;cn&#x3D;config&quot;</span><br><span class="line"></span><br><span class="line"># ldapsearch -Y external -H ldapi:&#x2F;&#x2F;&#x2F; -b cn&#x3D;config &quot;(objectClass&#x3D;olcGlobal)&quot;  olcReferral</span><br><span class="line">SASL&#x2F;EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;external,cn&#x3D;auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line"># extended LDIF</span><br><span class="line">#</span><br><span class="line"># LDAPv3</span><br><span class="line"># base &lt;cn&#x3D;config&gt; with scope subtree</span><br><span class="line"># filter: (objectClass&#x3D;olcGlobal)</span><br><span class="line"># requesting: olcReferral</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># config</span><br><span class="line">dn: cn&#x3D;config</span><br><span class="line">olcReferral: ldaps:&#x2F;&#x2F;tldap.wecash.net</span><br><span class="line"></span><br><span class="line"># search result</span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"># numResponses: 2</span><br><span class="line"># numEntries: 1</span><br></pre></td></tr></table></figure></li>
<li>restart slapd<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># systemctl restart slapd.service</span><br><span class="line"># netstat -ntlp | grep slapd</span><br><span class="line">tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      13728&#x2F;slapd</span><br><span class="line">tcp        0      0 0.0.0.0:636             0.0.0.0:*               LISTEN      13728&#x2F;slapd</span><br><span class="line">tcp6       0      0 :::389                  :::*                    LISTEN      13728&#x2F;slapd</span><br><span class="line">tcp6       0      0 :::636                  :::*                    LISTEN      13728&#x2F;slapd</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="å››-éªŒè¯æ•°æ®"><a href="#å››-éªŒè¯æ•°æ®" class="headerlink" title="å››. éªŒè¯æ•°æ®"></a>å››. éªŒè¯æ•°æ®</h3><ol>
<li>åˆå§‹åŒ–ä¸€äº›æ•°æ®<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat add_content.ldif</span><br><span class="line">dn: ou&#x3D;People,dc&#x3D;example,dc&#x3D;com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: People</span><br><span class="line"></span><br><span class="line">dn: ou&#x3D;Groups,dc&#x3D;example,dc&#x3D;com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: Groups</span><br><span class="line"></span><br><span class="line">dn: cn&#x3D;miners,ou&#x3D;Groups,dc&#x3D;example,dc&#x3D;com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">cn: miners</span><br><span class="line">gidNumber: 5000</span><br><span class="line"></span><br><span class="line">dn: uid&#x3D;john,ou&#x3D;People,dc&#x3D;example,dc&#x3D;com</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">uid: john</span><br><span class="line">sn: Doe</span><br><span class="line">givenName: John</span><br><span class="line">cn: John Doe</span><br><span class="line">displayName: John Doe</span><br><span class="line">uidNumber: 10000</span><br><span class="line">gidNumber: 5000</span><br><span class="line">userPassword: johnldap</span><br><span class="line">gecos: John Doe</span><br><span class="line">loginShell: &#x2F;bin&#x2F;bash</span><br><span class="line">homeDirectory: &#x2F;home&#x2F;john</span><br><span class="line"># ldapadd -x -W -D &quot;cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net&quot; -f add_content.ldif</span><br><span class="line">Enter LDAP Password: ********</span><br><span class="line">adding new entry &quot;ou&#x3D;People,dc&#x3D;example,dc&#x3D;com&quot;</span><br><span class="line">adding new entry &quot;ou&#x3D;Groups,dc&#x3D;example,dc&#x3D;com&quot;</span><br><span class="line">adding new entry &quot;cn&#x3D;miners,ou&#x3D;Groups,dc&#x3D;example,dc&#x3D;com&quot;</span><br><span class="line">adding new entry &quot;uid&#x3D;john,ou&#x3D;People,dc&#x3D;example,dc&#x3D;com&quot;</span><br></pre></td></tr></table></figure>
æ­¤æ—¶,ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·phpLDAPadminæˆ–è€…LDAP Admin Toolè®¿é—®LDAP serverç«¯å³å¯ä»¥æŸ¥çœ‹åˆ°æ•°æ®.</li>
<li>æŸ¥è¯¢ç›®å½•ç»“æ„æ ‘<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapsearch -x -LLL -H ldap:&#x2F;&#x2F;&#x2F; -b dc&#x3D;wecash,dc&#x3D;net dn</span><br><span class="line">dn: dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;Devops,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;People,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;Marketing,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: ou&#x3D;department,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;iris+ipHostNumber&#x3D;192.168.1.51,ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;gojira+ipHostNumber&#x3D;192.168.1.1,ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;zedan+ipHostNumber&#x3D;192.168.1.52,ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;gamera+ipHostNumber&#x3D;192.168.1.50,ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;git-wecash01cn-p001.pek3.wecash.net,ou&#x3D;Hosts,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: uid&#x3D;shuke,ou&#x3D;Devops,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;dba,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;devops,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;tester,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;manager,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;developer,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line">dn: cn&#x3D;Pete Minsky,ou&#x3D;Marketing,dc&#x3D;wecash,dc&#x3D;net</span><br><span class="line"></span><br><span class="line"># è´¦å·ç™»å½•è®¤è¯</span><br><span class="line"># ldapwhoami -H ldapi:&#x2F;&#x2F;&#x2F; -x  -D cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net -W</span><br><span class="line">Enter LDAP Password:</span><br><span class="line">dn:cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="äº”-Loggingè®¾ç½®"><a href="#äº”-Loggingè®¾ç½®" class="headerlink" title="äº”. Loggingè®¾ç½®"></a>äº”. Loggingè®¾ç½®</h3><ol>
<li>Create the file logging.ldif with the following contents<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat logging.ldif</span><br><span class="line">dn: cn&#x3D;config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcLogLevel</span><br><span class="line">olcLogLevel: stats</span><br></pre></td></tr></table></figure></li>
<li>æ›´æ–°æ•°æ®<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f logging.ldif</span><br></pre></td></tr></table></figure></li>
<li>åœ¨/etc/rsyslog.confå¢åŠ å†…å®¹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Disable rate limiting</span><br><span class="line"># (default is 200 messages in 5 seconds; below we make the 5 become 0)</span><br><span class="line">$SystemLogRateLimitInterval 0</span><br></pre></td></tr></table></figure></li>
<li>restart the rsyslog daemon<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl restart syslog.service</span><br></pre></td></tr></table></figure>
æ­¤æ—¶,<code>tail -f /var/log/syslog</code>æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å†…å®¹,å¯ä»¥æŸ¥çœ‹åˆ°LDAPç›¸å…³log</li>
</ol>
<h3 id="å…­-LDAPå‘½ä»¤ä»‹ç»"><a href="#å…­-LDAPå‘½ä»¤ä»‹ç»" class="headerlink" title="å…­. LDAPå‘½ä»¤ä»‹ç»"></a>å…­. LDAPå‘½ä»¤ä»‹ç»</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapmodrdn å‘½ä»¤ç”¨äºå¯¹ OpenLDAP ç›®å½•æ ‘ä¸­ RDN æ¡ç›®çš„ä¿®æ”¹ï¼Œå¯ä»¥ä»æ ‡å‡†çš„æ¡ç›®ä¿¡æ¯è¾“å…¥æˆ–è€…ä½¿ç”¨ -f æŒ‡å®š LDIF æ–‡ä»¶çš„æ ¼å¼è¾“å…¥ã€‚</span><br><span class="line"># ldapmodrdn -x -D cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net -w weopenldap -H ldapi:&#x2F;&#x2F;&#x2F; &quot;cn&#x3D;dba,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net&quot; cn&#x3D;wedba</span><br><span class="line">ldappasswd å‘½ä»¤ç”¨äºä¿®æ”¹å¯†ç </span><br><span class="line"># ldappasswd -x -D cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net -w weopenldap -H ldapi:&#x2F;&#x2F;&#x2F; &quot;cn&#x3D;wedba,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net&quot; -S</span><br><span class="line">ldapdelete å‘½ä»¤ç”¨äºä»ç›®å½•æ ‘ä¸­åˆ é™¤æŒ‡å®šæ¡ç›®ï¼Œå¹¶æ ¹æ® DN æ¡ç›®åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ï¼Œä½†å¿…é¡»æä¾›æ‰€è¦åˆ é™¤æŒ‡å®šæ¡ç›®çš„æƒé™æ‰€ç»‘å®šçš„ DNï¼ˆæ•´ä¸ªç›®å½•æ ‘çš„å”¯ä¸€æ ‡è¯†åç§°ï¼‰ã€‚</span><br><span class="line"># ldapdelete -x -w weopenldap -D cn&#x3D;admin,dc&#x3D;wecash,dc&#x3D;net &quot;cn&#x3D;tester,ou&#x3D;Groups,dc&#x3D;wecash,dc&#x3D;net&quot;</span><br><span class="line">è¦æ£€æµ‹é…ç½®æ–‡ä»¶çš„å¯ç”¨æ€§ï¼Œå¯è®¾ç½®è¾“å‡ºçº§åˆ«:</span><br><span class="line"># slaptest -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d</span><br><span class="line">config file testing succeeded</span><br><span class="line"># slaptest -d 3 -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d</span><br><span class="line">slapcat å‘½ä»¤ç”¨äºå°†æ•°æ®æ¡ç›®è½¬æ¢ä¸º OpenLDAP çš„ LDIF æ–‡ä»¶ï¼Œå¯ç”¨äº OpenLDAP æ¡ç›®çš„å¤‡ä»½ä»¥åŠç»“åˆ slapdadd æŒ‡å®šç”¨äºæ¢å¤æ¡ç›®ã€‚</span><br><span class="line">ä¸‹é¢é€šè¿‡slapcat å¤‡ä»½ OpenLDAP æ‰€æœ‰ç›®å½•æ ‘æ¡ç›®ï¼š</span><br><span class="line"># slapcat -v -l openldap.ldif</span><br><span class="line">LDAPå®¢æˆ·ç«¯æœºå™¨éªŒè¯:</span><br><span class="line"># getent passwd shuke</span><br><span class="line">shuke:*:12514:10202:shuke:&#x2F;home&#x2F;shuke:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>
<p><a href="https://wiki.shileizcc.com/confluence/pages/viewpage.action?pageId=39223593#OpenLDAP%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D-ldapsearch%E5%91%BD%E4%BB%A4" target="_blank" rel="noopener">OpenLDAP å‘½ä»¤ä»‹ç»-OpenLDAP</a></p>
<h3 id="ä¸ƒ-å¸è½½LDAP"><a href="#ä¸ƒ-å¸è½½LDAP" class="headerlink" title="ä¸ƒ. å¸è½½LDAP"></a>ä¸ƒ. å¸è½½LDAP</h3><ol>
<li>å‘½ä»¤å¸è½½<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># apt-get purge --auto-remove slapd ldap-utils</span><br></pre></td></tr></table></figure></li>
<li>åˆ é™¤ç›®å½•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># rm -rf &#x2F;etc&#x2F;ldap &amp;&amp; rm -rf &#x2F;var&#x2F;lib&#x2F;ldap</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="å…«-Backup-and-Restore"><a href="#å…«-Backup-and-Restore" class="headerlink" title="å…«. Backup and Restore"></a>å…«. Backup and Restore</h3><ol>
<li>ä¸‹è½½è„šæœ¬æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget --no-check-certificate https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alexanderjackson&#x2F;ldap-backup-and-restore&#x2F;master&#x2F;ldap-backup -O &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-backup</span><br><span class="line">wget --no-check-certificate https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;alexanderjackson&#x2F;ldap-backup-and-restore&#x2F;master&#x2F;ldap-restore -O &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-restore</span><br><span class="line">chown root.root &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-backup &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-restore</span><br><span class="line">chmod 500 &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-backup &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-restore</span><br></pre></td></tr></table></figure></li>
<li>å¤‡ä»½è„šæœ¬<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># grep -v &#39;^#&#39; &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-backup</span><br><span class="line">TIMESTAMP&#x3D;$(date +%Y%m%d-%H%M%S)</span><br><span class="line">BACKUP_PATH&#x3D;&#x2F;data&#x2F;backups&#x2F;ldap&#x2F;$&#123;TIMESTAMP&#125;</span><br><span class="line">echo &quot;  Creating backup at $&#123;BACKUP_PATH&#125;&quot;</span><br><span class="line">mkdir -p $&#123;BACKUP_PATH&#125;</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;nice &#x2F;usr&#x2F;sbin&#x2F;slapcat -n 0 &gt; $&#123;BACKUP_PATH&#125;&#x2F;config.ldif</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;nice &#x2F;usr&#x2F;sbin&#x2F;slapcat -n 1 &gt; $&#123;BACKUP_PATH&#125;&#x2F;domain.ldif</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;nice &#x2F;usr&#x2F;sbin&#x2F;slapcat -n 2 &gt; $&#123;BACKUP_PATH&#125;&#x2F;access.ldif</span><br><span class="line">chmod 640 $&#123;BACKUP_PATH&#125;&#x2F;*.ldif</span><br><span class="line">tar cpzf $&#123;BACKUP_PATH&#125;&#x2F;etc_ldap.tgz &#x2F;etc&#x2F;ldap &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">tar cpzf $&#123;BACKUP_PATH&#125;&#x2F;var_lib_ldap.tgz &#x2F;var&#x2F;lib&#x2F;ldap &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">ls -ahl $&#123;BACKUP_PATH&#125;</span><br><span class="line">echo &quot;Run ldap-restore to restore previous backups...&quot;</span><br></pre></td></tr></table></figure></li>
<li>è®¡åˆ’ä»»åŠ¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;cron.d&#x2F;ldap-backup</span><br><span class="line">MAILTO&#x3D;yunwei@wecash.net</span><br><span class="line">0 0 * * *  root    &#x2F;usr&#x2F;local&#x2F;sbin&#x2F;ldap-backup</span><br></pre></td></tr></table></figure></li>
<li>æ¢å¤LDAPæ•°æ®<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo systemctl stop slapd.service</span><br><span class="line">sudo mkdir &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;accesslog</span><br><span class="line">sudo slapadd -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d -n 0 -l &#x2F;data&#x2F;backups&#x2F;ldap&#x2F;$&#123;TIMESTAMP&#125;&#x2F;config.ldif</span><br><span class="line">sudo slapadd -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d -n 1 -l &#x2F;data&#x2F;backups&#x2F;ldap&#x2F;$&#123;TIMESTAMP&#125;&#x2F;domain.com.ldif</span><br><span class="line">sudo slapadd -F &#x2F;etc&#x2F;ldap&#x2F;slapd.d -n 2 -l &#x2F;data&#x2F;backups&#x2F;ldap&#x2F;$&#123;TIMESTAMP&#125;&#x2F;access.ldif</span><br><span class="line">sudo chown -R openldap:openldap &#x2F;etc&#x2F;ldap&#x2F;slapd.d&#x2F;</span><br><span class="line">sudo chown -R openldap:openldap &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;</span><br><span class="line">sudo systemctl start slapd.service</span><br></pre></td></tr></table></figure>
å‚è€ƒè„šæœ¬æ–‡ä»¶:<br><a href="https://github.com/alexanderjackson/ldap-backup-and-restore" target="_blank" rel="noopener">GitHub - alexanderjackson/ldap-backup-and-restore</a><br><a href="https://tylersguides.com/articles/backup-restore-openldap/" target="_blank" rel="noopener">How To Backup and Restore OpenLDAP - Tylerâ€™s Guides</a></li>
</ol>
<h3 id="ldap3-client-example"><a href="#ldap3-client-example" class="headerlink" title="ldap3 client example"></a>ldap3 client example</h3><p><a href="git@git.wecash.net:devops/ldap3-client.git">ldap3-client-example</a></p>
<h3 id="ldapPublicKey"><a href="#ldapPublicKey" class="headerlink" title="ldapPublicKey"></a>ldapPublicKey</h3><ol>
<li>é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat openssh-lpk.ldif</span><br><span class="line"># LDAP SSH Public Key schema</span><br><span class="line"># Source: https:&#x2F;&#x2F;serverfault.com&#x2F;questions&#x2F;653792&#x2F;ssh-key-authentication-using-ldap</span><br><span class="line"># Homepage: https:&#x2F;&#x2F;github.com&#x2F;AndriiGrytsenko&#x2F;openssh-ldap-publickey</span><br><span class="line"></span><br><span class="line">dn: cn&#x3D;openssh-lpk,cn&#x3D;schema,cn&#x3D;config</span><br><span class="line">objectClass: olcSchemaConfig</span><br><span class="line">cn: openssh-lpk</span><br><span class="line">olcAttributeTypes: ( 1.3.6.1.4.1.24552.500.1.1.1.13 NAME &#39;sshPublicKey&#39;</span><br><span class="line">    DESC &#39;MANDATORY: OpenSSH Public key&#39;</span><br><span class="line">    EQUALITY octetStringMatch</span><br><span class="line">    SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )</span><br><span class="line">olcObjectClasses: ( 1.3.6.1.4.1.24552.500.1.1.2.0 NAME &#39;ldapPublicKey&#39;</span><br><span class="line">    DESC &#39;MANDATORY: OpenSSH LPK objectclass&#39;</span><br><span class="line">    SUP top AUXILIARY</span><br><span class="line">    MAY ( sshPublicKey $ uid )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li>
<li>å¯¼å…¥é…ç½®ä¿¡æ¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f openssh-lpk.ldif</span><br><span class="line">SASL&#x2F;EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;external,cn&#x3D;auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry &quot;cn&#x3D;openssh-lpk,cn&#x3D;schema,cn&#x3D;config&quot;</span><br></pre></td></tr></table></figure>
æ­¤æ—¶,å¯ä»¥ä½¿ç”¨sshPublicKeyå±æ€§è¿›è¡Œuserç™»å½•éªŒè¯.</li>
</ol>
<h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3><ol>
<li>å¦‚ä½•ä¿®æ”¹é»˜è®¤çš„æ•°æ®åº“æ–‡ä»¶åˆ›å»ºè·¯å¾„?<br>é»˜è®¤çš„æ•°æ®åº“æ–‡ä»¶è·¯å¾„æ˜¯/var/lib/ldap</li>
</ol>
<ul>
<li><p>åˆ›å»ºå­˜æ”¾DBæ•°æ®çš„è·¯å¾„,å¹¶ä¿®æ”¹æƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mkdir &#x2F;data&#x2F;ldap&#x2F;data -pv</span><br><span class="line"># chown -R openldap.openldap &#x2F;data&#x2F;ldap&#x2F;data</span><br></pre></td></tr></table></figure></li>
<li><p>ç¼–å†™ä¿®æ”¹dbè·¯å¾„çš„ldifæ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat dbpath.ldif</span><br><span class="line">dn: olcDatabase&#x3D;&#123;1&#125;mdb,cn&#x3D;config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcDbDirectory</span><br><span class="line">olcDbDirectory: &#x2F;data&#x2F;ldap&#x2F;data</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰§è¡Œä¿®æ”¹å‘½ä»¤,æç¤ºé”™è¯¯ä¿¡æ¯å¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f dbpath.ldif</span><br><span class="line">adding new entry &quot;olcDatabase&#x3D;&#123;1&#125;hdb,cn&#x3D;config&quot;</span><br><span class="line">ldap_add: Other (e.g., implementation specific) error (80)</span><br><span class="line">	additional info: olcDbDirectory: value #0: invalid path: Permission denied</span><br></pre></td></tr></table></figure></li>
<li><p>logä¿¡æ¯<br>ldapå¯åŠ¨å¤±è´¥ï¼Œ/var/log/syslogæ—¥å¿—æ˜¾ç¤º:olcDbDirectory: value #0: invalid path: Permission denied</p>
</li>
<li><p>é—®é¢˜åŸå› <br>AppArmorçš„é…ç½®å¯¼è‡´</p>
<blockquote>
<p>AppArmor (Application Armor) æ˜¯ä¸€ä¸ªç±»ä¼¼äº SELinux çš„ä¸€ä¸ªå¼ºåˆ¶è®¿é—®æ§åˆ¶æ–¹æ³•ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥æŒ‡å®šç¨‹åºå¯ä»¥è¯»ã€å†™æˆ–è¿è¡Œå“ªäº›æ–‡ä»¶ï¼Œæ˜¯å¦å¯ä»¥æ‰“å¼€ç½‘ç»œç«¯å£ç­‰ã€‚AppArmor é…ç½®æ¯” SELinux æ›´åŠ æ–¹ä¾¿æ¯”è¾ƒé€‚åˆå­¦ä¹ <br>I believe if you want to install the LDAP Db to another directory you would need to add that directory to the apparmor profile for slapd. In my case that would have been editing â€œ/etc/apparmor.d/usr.sbin.slapdâ€ and changing</p>
</blockquote>
</li>
<li><p>è§£å†³æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># vim &#x2F;etc&#x2F;apparmor.d&#x2F;usr.sbin.slapd</span><br><span class="line">  # the databases and logs</span><br><span class="line">  &#x2F;var&#x2F;lib&#x2F;ldap&#x2F; r,</span><br><span class="line">  &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;** rwk,</span><br><span class="line"></span><br><span class="line">  # lock file</span><br><span class="line">  &#x2F;var&#x2F;lib&#x2F;ldap&#x2F;alock kw,</span><br><span class="line"></span><br><span class="line">  &#x2F;data&#x2F;ldap&#x2F;data&#x2F; r,</span><br><span class="line">  &#x2F;data&#x2F;ldap&#x2F;data&#x2F;** rwk,</span><br><span class="line"></span><br><span class="line">  # lock file</span><br><span class="line">  &#x2F;data&#x2F;ldap&#x2F;data&#x2F;alock kw,</span><br><span class="line"> æ·»åŠ DBè·¯å¾„åˆ°é…ç½®æ–‡ä»¶ä¸­,å¦‚ä¸Šæ‰€ç¤º</span><br><span class="line">é‡å¯apparmoræœåŠ¡</span><br><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;apparmor restart</span><br></pre></td></tr></table></figure></li>
<li><p>ä¿®æ”¹è·¯å¾„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapmodify -Q -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f dbpath.ldif</span><br><span class="line">modifying entry &quot;olcDatabase&#x3D;&#123;1&#125;mdb,cn&#x3D;config&quot;</span><br><span class="line">é‡å¯ldapæœåŠ¡</span><br><span class="line"># systemctl restart slapd.service</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹éªŒè¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapsearch -H ldapi:&#x2F;&#x2F; -Y EXTERNAL -b &quot;olcDatabase&#x3D;&#123;1&#125;mdb,cn&#x3D;config&quot; &quot;(objectClass&#x3D;olcDatabaseConfig)&quot; olcDbDirectory -LLL</span><br><span class="line">SASL&#x2F;EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber&#x3D;0+uidNumber&#x3D;0,cn&#x3D;peercred,cn&#x3D;external,cn&#x3D;auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">dn: olcDatabase&#x3D;&#123;1&#125;mdb,cn&#x3D;config</span><br><span class="line">olcDbDirectory: &#x2F;data&#x2F;ldap&#x2F;data</span><br></pre></td></tr></table></figure>
<p><a href="https://yilutongxing.wordpress.com/2013/11/07/ldap/" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a></p>
</li>
</ul>
<ol start="2">
<li>å¦‚ä½•è®¾ç½®LDAPç®¡ç†å‘˜å¯†ç ?</li>
</ol>
<ul>
<li>ç”Ÿæˆå¯†ç <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># slappasswd</span><br><span class="line">New password:</span><br><span class="line">Re-enter new password:</span><br><span class="line">&#123;SSHA&#125;XsxctHt+Ae3Saq2Kcead4UdZ0kOTZRn8</span><br></pre></td></tr></table></figure></li>
<li>ç”ŸæˆLDIFæ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; chrootpw.ldif </span><br><span class="line">dn: olcDatabase&#x3D;&#123;0&#125;config,cn&#x3D;config</span><br><span class="line">changetype: modify</span><br><span class="line">add: olcRootPW</span><br><span class="line">olcRootPW: &#123;SSHA&#125;XsxctHt+Ae3Saq2Kcead4UdZ0kOTZRn8</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure></li>
<li>æ‰§è¡ŒLDIFæ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ldapadd -Y EXTERNAL -H ldapi:&#x2F;&#x2F;&#x2F; -f chrootpw.ldif</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://www.openldap.org/doc/admin24/quickstart.html" target="_blank" rel="noopener">ç¼–è¯‘å®‰è£…</a></p>
<p>ä¸»è¦å‚è€ƒèµ„æ–™<br><a href="https://help.ubuntu.com/lts/serverguide/openldap-server.html.en" target="_blank" rel="noopener">OpenLDAP Server</a><br><a href="https://wiki.shileizcc.com/confluence/display/openldap/OpenLDAP" target="_blank" rel="noopener">OpenLDAP - OpenLDAP - Wiki.Shileizcc.com</a><br><a href="https://www.openldap.org/doc/admin24/slapdconf2.html" target="_blank" rel="noopener">OpenLDAP Software 2.4 Administratorâ€™s Guide: Configuring slapd</a></p>
<p>å…¶ä»–å‚è€ƒ<br><a href="https://segmentfault.com/a/1190000014683418" target="_blank" rel="noopener">æˆ‘èŠ±äº†ä¸€ä¸ªäº”ä¸€ç»ˆäºææ‡‚äº†OpenLDAP - æ—¥æ–°äº­ - SegmentFault æ€å¦</a><br><a href="http://tutoriels.meddeb.net/openldap-tutorial-log/" target="_blank" rel="noopener">Enable the production of Openldap Log file - Tutoriels pour la construction de logiciels</a><br><a href="https://blog.mallux.me/2017/03/03/openldap/" target="_blank" rel="noopener">OpenLDAP åˆè¯† | Mallux - å®é™è‡´è¿œ</a><br><a href="https://linuxguideandhints.com/centos/openldap.html" target="_blank" rel="noopener">OpenLDAP â€” Linux Guide and Hints</a><br><a href="https://www.server-world.info/en/note?os=Ubuntu_17.04&p=ssl" target="_blank" rel="noopener">Ubuntu 17.04 : Create SSL Certificates : Server World</a><br><a href="https://help.ubuntu.com/lts/serverguide/openldap-server.html.en#openldap-server-installation" target="_blank" rel="noopener">OpenLDAP Server</a><br><a href="https://www.howtoing.com/how-to-use-ldif-files-to-make-changes-to-an-openldap-system" target="_blank" rel="noopener">å¦‚ä½•ä½¿ç”¨LDIFæ–‡ä»¶æ¥è¿›è¡Œæ›´æ”¹OpenLDAPç³»ç»Ÿ</a><br><a href="https://www.ldapsoft.com/download.html" target="_blank" rel="noopener">LDAP Admin Tool</a><br><a href="https://www.server-world.info/en/note?os=CentOS_7&p=openldap&f=4" target="_blank" rel="noopener">ldap over ssl</a></p>
]]></content>
      <categories>
        <category>LDAP</category>
      </categories>
      <tags>
        <tag>LDAP</tag>
      </tags>
  </entry>
  <entry>
    <title>Nexusä»“åº“è¿ç§»</title>
    <url>/2020/04/23/Nexus%E4%BB%93%E5%BA%93%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<h2 id="Nexusä»“åº“è¿ç§»"><a href="#Nexusä»“åº“è¿ç§»" class="headerlink" title="Nexusä»“åº“è¿ç§»"></a>Nexusä»“åº“è¿ç§»</h2><blockquote>
<p>ä¸‹æ–‡ä¸»è¦ä»‹ç»Nexusä»“åº“è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œæ€»ç»“</p>
</blockquote>
<p>éœ€æ±‚æè¿°: éœ€è¦å°†æºä¸»æœºçš„NexusæœåŠ¡ä»¥åŠç›¸å…³æ•°æ®ä¿¡æ¯,è¿ç§»è‡³ç›®æ ‡ä¸»æœº,æ•°æ®è¿ç§»å®Œæˆæµ‹è¯•éªŒè¯å,åˆ‡æ¢åŸŸå,å®Œæˆè¿ç§».</p>
<h3 id="ç¯å¢ƒä»‹ç»"><a href="#ç¯å¢ƒä»‹ç»" class="headerlink" title="ç¯å¢ƒä»‹ç»"></a>ç¯å¢ƒä»‹ç»</h3><table>
<thead>
<tr>
<th align="center">æºä¸»æœº</th>
<th align="center">ç›®æ ‡ä¸»æœº</th>
<th align="center">åŸŸå</th>
<th align="center">Nexusç‰ˆæœ¬</th>
</tr>
</thead>
<tbody><tr>
<td align="center">10.80.42.138</td>
<td align="center">10.14.46.12</td>
<td align="center">repo.wecash.asia</td>
<td align="center">3.8.0</td>
</tr>
</tbody></table>
<h3 id="è¿ç§»æ­¥éª¤"><a href="#è¿ç§»æ­¥éª¤" class="headerlink" title="è¿ç§»æ­¥éª¤"></a>è¿ç§»æ­¥éª¤</h3><ol>
<li>åœ¨ä¸»æœºBç”Ÿæˆä¸€å¯¹ç§é’¥,åŒæ—¶å°†å…¬é’¥æ·»åŠ åˆ°ä¸»æœºAä¸Š,é…ç½®å…å¯†ç™»å½•;</li>
<li>åœ¨ä¸»æœºBå®‰è£…Mavenç¯å¢ƒ;</li>
<li>Rsyncå¢é‡æ–¹å¼åŒæ­¥æ•°æ®</li>
<li>æ•°æ®åŒæ­¥å®Œæˆå,å¯åŠ¨NexusæœåŠ¡,æœ¬åœ°å†™hostç»‘å®šåŸŸåæ–¹å¼,è¿›è¡ŒéªŒè¯;</li>
<li>éªŒè¯é€šè¿‡å,åˆ‡æ¢åŸŸå,å®Œå…¨è¿ç§»;<br>âš ï¸: å¼ºçƒˆå»ºè®®è¿ç§»æ—¶å€™,ä¸¤å°ä¸»æœºçš„Nexusæ•°æ®åŠæœåŠ¡ç›®å½•ä¿æŒå®Œå…¨ä¸€è‡´,ä»“åº“ç‰ˆæœ¬ä¿æŒä¸€è‡´;</li>
</ol>
<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><ol>
<li>å®‰è£…JDK(ç•¥)</li>
<li>å®‰è£…Maven<br><a href="https://maven.apache.org/index.html" target="_blank" rel="noopener">Maven â€“ Welcome to Apache Maven</a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line"># wget https:&#x2F;&#x2F;www-us.apache.org&#x2F;dist&#x2F;maven&#x2F;maven-3&#x2F;3.6.0&#x2F;binaries&#x2F;apache-maven-3.6.0-bin.tar.gz</span><br><span class="line"># tar -zxvf apache-maven-3.6.0-bin.tar.gz -C &#x2F;data&#x2F;services&#x2F;</span><br><span class="line"># cd &#x2F;data&#x2F;services&#x2F; &amp;&amp; mv apache-maven-3.6.0 maven-3.6</span><br></pre></td></tr></table></figure>
å®‰è£…é…ç½®å‚è€ƒ: <a href="https://maven.apache.org/users/index.html" target="_blank" rel="noopener">Maven â€“ Users Centre</a><br>é…ç½®ç¯å¢ƒå˜é‡:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export MAVEN_OPTS&#x3D;&quot;-Xms1g -Xmx1g&quot;</span><br><span class="line">export MAVEN_HOME&#x3D;&quot;&#x2F;data&#x2F;services&#x2F;maven-3.6&quot;</span><br><span class="line">export PATH&#x3D;$JAVA_HOME&#x2F;bin:$MAVEN_HOME&#x2F;bin:$PATH</span><br></pre></td></tr></table></figure></li>
<li>Nexuså®‰è£…</li>
</ol>
<ul>
<li>ä¸‹è½½<br><a href="https://www.sonatype.com/download-oss-sonatype" target="_blank" rel="noopener">Download Repository OSS</a></li>
<li>Nexuså¯åŠ¨è„šæœ¬<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;nexus.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;nexus service</span><br><span class="line">After&#x3D;network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">LimitNOFILE&#x3D;65536</span><br><span class="line">ExecStart&#x3D;&#x2F;data&#x2F;services&#x2F;nexus-8081&#x2F;bin&#x2F;nexus start</span><br><span class="line">ExecStop&#x3D;&#x2F;data&#x2F;services&#x2F;nexus-8081&#x2F;bin&#x2F;nexus stop</span><br><span class="line">User&#x3D;nexus</span><br><span class="line">Restart&#x3D;on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure></li>
<li>Nginxä»£ç†Nexusä»“åº“<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;repo.wecash.asia-80.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen   80;</span><br><span class="line">    server_name  repo.wecash.asia;</span><br><span class="line">    charset utf-8;</span><br><span class="line"></span><br><span class="line">    access_log &#x2F;data&#x2F;logs&#x2F;nginx&#x2F;repo.wecash.asia.access.log main;</span><br><span class="line">    error_log &#x2F;data&#x2F;logs&#x2F;nginx&#x2F;repo.wecash.asia.error.log warn;</span><br><span class="line"></span><br><span class="line">    # allow large uploads of files</span><br><span class="line">    client_max_body_size 1G;</span><br><span class="line"></span><br><span class="line">    # optimize downloading files larger than 1G</span><br><span class="line">    #proxy_max_temp_file_size 2G;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">      proxy_pass http:&#x2F;&#x2F;127.0.0.1:8081;</span><br><span class="line">      proxy_set_header Host $host;</span><br><span class="line">      proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è¿ç§»æ•°æ®"><a href="#è¿ç§»æ•°æ®" class="headerlink" title="è¿ç§»æ•°æ®"></a>è¿ç§»æ•°æ®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># nohup rsync -vuazrtpP --progress --delete --exclude&#x3D;&quot;blobs&#x2F;docker-registry-sea&quot;  -e &#39;ssh&#39; root@10.80.42.138:&#x2F;data&#x2F;nexus3data&#x2F;nexus3&#x2F; &#x2F;data&#x2F;nexus3data&#x2F;nexus3&#x2F; &gt; &#x2F;tmp&#x2F;rsync.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3>åœ¨åŒæ­¥å®ŒæˆBlobæ•°æ®å,å¯åŠ¨NexusæœåŠ¡,åœ¨ä½¿ç”¨ä»“åº“æ„å»ºåŒ…çš„æ—¶å€™å­˜åœ¨åŒ…çš„Meta-dataä¿¡æ¯æ›´æ–°æˆ–è·å–å¤±è´¥é—®é¢˜,å¯¼è‡´returnçš„codeä¸º500é—®é¢˜,clientè¿”å›çš„é”™è¯¯ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤º:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Failed to execute goal org.apache.maven.plugins:maven-deploy-plugin:2.8.2:deploy (default-deploy) on project indonesia-customer-center-biz-api: Failed to retrieve remote metadata net.wecash:indonesia-customer-center-biz-api:1.0-SNAPSHOT&#x2F;maven-metadata.xml: Could not transfer metadata net.wecash:indonesia-customer-center-biz-api:1.0-SNAPSHOT&#x2F;maven-metadata.xml from&#x2F;to nexus-snapshots (http:&#x2F;&#x2F;repo.wecash.asia&#x2F;repository&#x2F;maven-snapshots&#x2F;): Failed to transfer file: http:&#x2F;&#x2F;repo.wecash.asia&#x2F;repository&#x2F;maven-snapshots&#x2F;net&#x2F;wecash&#x2F;indonesia-customer-center-biz-api&#x2F;1.0-SNAPSHOT&#x2F;maven-metadata.xml. Return code is: 500 , ReasonPhrase:javax.servlet.ServletException: org.sonatype.nexus.repository.storage.RetryDeniedException: Reached max retries: 8&#x2F;8. -&gt; [Help 1]</span><br></pre></td></tr></table></figure></li>
</ul>
<ol>
<li>è¿ç§»åæºä¸»æœºä¸ç›®æ ‡ä¸»æœºè·¯å¾„ä¸ä¸€è‡´<br>åŒæ­¥Blobæ•°æ®è‡³è¿ç§»åçš„ä¸»æœºB,é€šè¿‡ä¿®æ”¹Nexusé…ç½®æ–‡ä»¶ä¸­çš„karaf.dataå‚æ•°æŒ‡å®šæ•°æ®ç›®å½•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cd &#x2F;data&#x2F;services&#x2F;nexus-3.8&#x2F;bin</span><br><span class="line"># cat nexus.vmoptions</span><br><span class="line">-Xms2G</span><br><span class="line">-Xmx2G</span><br><span class="line">-XX:MaxDirectMemorySize&#x3D;2G</span><br><span class="line">-XX:+UnlockDiagnosticVMOptions</span><br><span class="line">-XX:+UnsyncloadClass</span><br><span class="line">-XX:+LogVMOutput</span><br><span class="line">-XX:LogFile&#x3D;&#x2F;data&#x2F;nexus&#x2F;logs&#x2F;nexus.log</span><br><span class="line">-XX:-OmitStackTraceInFastThrow</span><br><span class="line">-Djava.net.preferIPv4Stack&#x3D;true</span><br><span class="line">-Dkaraf.home&#x3D;.</span><br><span class="line">-Dkaraf.base&#x3D;.</span><br><span class="line">-Dkaraf.etc&#x3D;etc&#x2F;karaf</span><br><span class="line">-Djava.util.logging.config.file&#x3D;etc&#x2F;karaf&#x2F;java.util.logging.properties</span><br><span class="line">-Dkaraf.data&#x3D;&#x2F;data&#x2F;nexus&#x2F;nexus-data</span><br><span class="line">-Djava.io.tmpdir&#x3D;&#x2F;data&#x2F;nexus&#x2F;tmp</span><br><span class="line">-Dkaraf.startLocalConsole&#x3D;false</span><br></pre></td></tr></table></figure></li>
<li>å°è¯•è§£å†³æ–¹æ³•ä¸€<br>æ­¤æ—¶,serveræ®µä¼šå­˜åœ¨ä¸€äº›å¼‚å¸¸log,å¦‚æœlogä¸­å‡ºç°soft-deletedå…³é”®å­—,éœ€è¦å°†å¯¹åº”Blobä¸‹volä¸‹çš„*.propertiesæ–‡ä»¶ä¸­çš„delete=trueæ ‡ç¤ºåˆ é™¤,å¦‚æœéœ€è¦Deployçš„åŒ…æ¯”è¾ƒå¤š,æ­¤æ—¶,æ‰‹åŠ¨æ“ä½œå°±ä¼šæ¯”è¾ƒç¹çä¸”å®¹æ˜“å‡ºé”™,æ€è€ƒ,å°è¯•ä»å…¨å±€æ¥ä¿®å¤è¯¥é—®é¢˜,åˆæ­¥ä½¿ç”¨Compactçš„Taskæ¥è¿›è¡Œä¿®å¤<a href="https://help.sonatype.com/repomanager3/configuration/repository-management#RepositoryManagement-BlobStores" target="_blank" rel="noopener">Repository Management</a>,å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰,é—®é¢˜ä¾ç„¶å­˜åœ¨â€¦</li>
<li>å°è¯•è§£å†³æ–¹æ³•äºŒ<br>é€šè¿‡OrientDB Consoleå°è¯•ä¿®æ”¹repository_blobstoreè¡¨ä¸­å¯¹åº”çš„Blobçš„pathä¿¡æ¯,ä¿®æ”¹ä¸ºç»å¯¹è·¯å¾„,é»˜è®¤è¡¨ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¸ºkaraf.dataè·¯å¾„çš„ç›¸å¯¹è·¯å¾„,æ­¤æ–¹æ³•ä¾ç„¶æ— æ•ˆâ€¦<br><a href="https://support.sonatype.com/hc/en-us/articles/235816228-Relocating-Blob-Stores" target="_blank" rel="noopener">Relocating Blob Stores â€“ Sonatype Support</a></li>
<li>ç»ˆæè§£å†³æ–¹æ³•<blockquote>
<p>å…¨é‡åŒæ­¥$data-dir or ${karaf.data}ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è‡³æ–°æœºå™¨ä»¥åŠnexusæºç å®‰è£…æ–‡ä»¶è‡³æ–°æœºå™¨,å¼ºçƒˆå»ºè®®æ–‡ä»¶å­˜æ”¾çš„ç›®å½•ç»“æ„ä¿æŒä¸€è‡´,å¢é‡å®Œå…¨åŒæ­¥å®Œæˆä¹‹å,ä¿®æ”¹ç¯å¢ƒå˜é‡å’Œæƒé™,å¯åŠ¨æœåŠ¡,è¿›è¡ŒéªŒè¯;</p>
</blockquote>
</li>
<li>å®˜æ–¹è¿ç§»æŒ‡å¯¼<br><a href="https://support.sonatype.com/hc/en-us/articles/360010352014-Moving-a-Nexus-Repo-3-Installation-to-a-New-Location" target="_blank" rel="noopener">Moving a Nexus Repo 3 Installation to a New Location â€“ Sonatype Support</a></li>
</ol>
<h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><ol>
<li>ä¸€èˆ¬åœ¨è¿ç§»å®Œæˆåéœ€è¦åˆ›å»ºTaskä»»åŠ¡,é‡å»ºrepoçš„Indexå’ŒMetaDataä¿¡æ¯</li>
<li>Nexusä»“åº“çš„å…ƒæ•°æ®å’Œé…ç½®ä¿¡æ¯å­˜å‚¨åœ¨OrientDB(æ–‡ä»¶ç±»å‹æ•°æ®åº“)ä¸­</li>
<li>Nexusä»“åº“çš„ç´¢å¼•ä¿¡æ¯å­˜å‚¨åœ¨å†…ç½®çš„elasticsearchä¸­</li>
<li>å¦‚æœåœ¨Nexusæ—¥å¿—ä¸­æŸ¥çœ‹åˆ°æœ‰å…³elasticsearchçš„Indexé”™è¯¯ä¿¡æ¯,åˆ é™¤${karaf.data}å‚æ•°å¯¹åº”ç›®å½•ä¸‹çš„elasticsearchç›®å½•,é‡æ–°åŒæ­¥æ•°æ®å³å¯</li>
</ol>
<h3 id="Mavené…ç½®æ–‡ä»¶"><a href="#Mavené…ç½®æ–‡ä»¶" class="headerlink" title="Mavené…ç½®æ–‡ä»¶"></a>Mavené…ç½®æ–‡ä»¶</h3><p><a href="http://matt33.com/2015/10/14/the-setting-of-repertory-maven/" target="_blank" rel="noopener">Nexusä»“åº“Mavené…ç½®æ–‡ä»¶settings.xmlå‚æ•°ä»‹ç»</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat settings.xml</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;settings xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot; xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;SETTINGS&#x2F;1.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;settings-1.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;pluginGroups&#x2F;&gt;</span><br><span class="line">  &lt;proxies&#x2F;&gt;</span><br><span class="line">  &lt;servers&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;wecash-nexus&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;wecash-asia&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;password&gt;Be2MFTpf6TPmcXw7BpEarGZt&lt;&#x2F;password&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;nexus-releases&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;wecash-asia&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;password&gt;Be2MFTpf6TPmcXw7BpEarGZt&lt;&#x2F;password&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">    &lt;server&gt;</span><br><span class="line">      &lt;id&gt;nexus-snapshots&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;username&gt;wecash-asia&lt;&#x2F;username&gt;</span><br><span class="line">      &lt;password&gt;Be2MFTpf6TPmcXw7BpEarGZt&lt;&#x2F;password&gt;</span><br><span class="line">    &lt;&#x2F;server&gt;</span><br><span class="line">  &lt;&#x2F;servers&gt;</span><br><span class="line">  &lt;mirrors&gt;</span><br><span class="line">    &lt;mirror&gt;</span><br><span class="line">      &lt;id&gt;wecash-nexus&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;name&gt;nexus repository&lt;&#x2F;name&gt;</span><br><span class="line">      &lt;mirrorOf&gt;*&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">      &lt;url&gt;http:&#x2F;&#x2F;repo.wecash.asia&#x2F;repository&#x2F;maven-public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">    &lt;&#x2F;mirror&gt;</span><br><span class="line">  &lt;&#x2F;mirrors&gt;</span><br><span class="line">  &lt;profiles&gt;</span><br><span class="line">    &lt;profile&gt;</span><br><span class="line">      &lt;id&gt;nexus&lt;&#x2F;id&gt;</span><br><span class="line">      &lt;repositories&gt;</span><br><span class="line">        &lt;repository&gt;</span><br><span class="line">          &lt;id&gt;wecash-nexus&lt;&#x2F;id&gt;</span><br><span class="line">          &lt;url&gt;http:&#x2F;&#x2F;repo.wecash.asia&#x2F;repository&#x2F;maven-public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">          &lt;releases&gt;</span><br><span class="line">            &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">          &lt;&#x2F;releases&gt;</span><br><span class="line">          &lt;snapshots&gt;</span><br><span class="line">            &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">          &lt;&#x2F;snapshots&gt;</span><br><span class="line">        &lt;&#x2F;repository&gt;</span><br><span class="line">      &lt;&#x2F;repositories&gt;</span><br><span class="line">      &lt;pluginRepositories&gt;</span><br><span class="line">        &lt;pluginRepository&gt;</span><br><span class="line">          &lt;id&gt;wecash-nexus&lt;&#x2F;id&gt;</span><br><span class="line">          &lt;url&gt;http:&#x2F;&#x2F;repo.wecash.asia&#x2F;repository&#x2F;maven-public&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">          &lt;releases&gt;</span><br><span class="line">            &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">          &lt;&#x2F;releases&gt;</span><br><span class="line">          &lt;snapshots&gt;</span><br><span class="line">            &lt;enabled&gt;true&lt;&#x2F;enabled&gt;</span><br><span class="line">          &lt;&#x2F;snapshots&gt;</span><br><span class="line">        &lt;&#x2F;pluginRepository&gt;</span><br><span class="line">      &lt;&#x2F;pluginRepositories&gt;</span><br><span class="line">    &lt;&#x2F;profile&gt;</span><br><span class="line">  &lt;&#x2F;profiles&gt;</span><br><span class="line">  &lt;activeProfiles&gt;</span><br><span class="line">    &lt;activeProfile&gt;nexus&lt;&#x2F;activeProfile&gt;</span><br><span class="line">  &lt;&#x2F;activeProfiles&gt;</span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>
<p>MavenåŸºæœ¬å‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ„å»º</span><br><span class="line">mvn clean package -Denv&#x3D;test-jkt -U -DskipTests&#x3D;True</span><br><span class="line"># æ¨é€åŒ…</span><br><span class="line">mvn deploy -Denv&#x3D;test-jkt -U -DskipTests&#x3D;True</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Nexus</category>
      </categories>
      <tags>
        <tag>Nexus</tag>
      </tags>
  </entry>
  <entry>
    <title>Django èšåˆ</title>
    <url>/2020/04/23/Django-%E8%81%9A%E5%90%88/</url>
    <content><![CDATA[<h1 id="Django-èšåˆ"><a href="#Django-èšåˆ" class="headerlink" title="Django èšåˆ"></a>Django èšåˆ</h1><hr>

<ol>
<li>åœ¨æŸ¥è¯¢é›†ä¸Šç”Ÿæˆèšåˆ(aggregate)<br>aggregate()æ˜¯QuerySet çš„ä¸€ä¸ªç»ˆæ­¢å­å¥ï¼Œæ„æ€æ˜¯è¯´ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ…å«ä¸€äº›é”®å€¼å¯¹çš„å­—å…¸ã€‚é”®çš„åç§°æ˜¯èšåˆå€¼çš„æ ‡è¯†ç¬¦ï¼Œå€¼æ˜¯è®¡ç®—å‡ºæ¥çš„èšåˆå€¼ã€‚é”®çš„åç§°æ˜¯æŒ‰ç…§å­—æ®µå’Œèšåˆå‡½æ•°çš„åç§°è‡ªåŠ¨ç”Ÿæˆå‡ºæ¥çš„ã€‚å¦‚æœä½ æƒ³è¦ä¸ºèšåˆå€¼æŒ‡å®šä¸€ä¸ªåç§°ï¼Œå¯ä»¥å‘èšåˆå­å¥æä¾›å®ƒã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Book.objects.aggregate(average_price&#x3D;Avg(&#39;price&#39;))</span><br><span class="line">&#123;&#39;average_price&#39;: 34.35&#125;</span><br></pre></td></tr></table></figure></li>
<li>ä¸ºæŸ¥è¯¢é›†çš„æ¯ä¸€é¡¹ç”Ÿæˆèšåˆ(annotate)<br>é€ä¸ªå¯¹è±¡çš„æ±‡æ€»ç»“æœå¯ä»¥ç”±annotate()å­å¥ç”Ÿæˆã€‚å½“annotate()å­å¥è¢«æŒ‡å®šä¹‹åï¼ŒQuerySetä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ä¼šè¢«æ³¨ä¸Šç‰¹å®šçš„å€¼ã€‚<br>è¿™äº›æ³¨è§£çš„è¯­æ³•éƒ½å’Œaggregate()å­å¥æ‰€ä½¿ç”¨çš„ç›¸åŒã€‚annotate()çš„æ¯ä¸ªå‚æ•°éƒ½æè¿°äº†å°†è¦è¢«è®¡ç®—çš„èšåˆã€‚æ¯”å¦‚ï¼Œç»™å›¾ä¹¦æ·»åŠ ä½œè€…æ•°é‡çš„æ³¨è§£ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Build an annotated queryset</span><br><span class="line">&gt;&gt;&gt; from django.db.models import Count</span><br><span class="line">&gt;&gt;&gt; q &#x3D; Book.objects.annotate(Count(&#39;authors&#39;))</span><br><span class="line"># Interrogate the first object in the queryset</span><br><span class="line">&gt;&gt;&gt; q[0]</span><br><span class="line">&lt;Book: The Definitive Guide to Django&gt;</span><br><span class="line">&gt;&gt;&gt; q[0].authors__count</span><br><span class="line">2</span><br><span class="line"># Interrogate the second object in the queryset</span><br><span class="line">&gt;&gt;&gt; q[1]</span><br><span class="line">&lt;Book: Practical Django Projects&gt;</span><br><span class="line">&gt;&gt;&gt; q[1].authors__count</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
å’Œä½¿ç”¨ aggregate()ä¸€æ ·ï¼Œæ³¨è§£çš„åç§°ä¹Ÿæ ¹æ®èšåˆå‡½æ•°çš„åç§°å’Œèšåˆå­—æ®µçš„åç§°å¾—åˆ°çš„ã€‚ä½ å¯ä»¥åœ¨æŒ‡å®šæ³¨è§£æ—¶ï¼Œä¸ºé»˜è®¤åç§°æä¾›ä¸€ä¸ªåˆ«åï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; q &#x3D; Book.objects.annotate(num_authors&#x3D;Count(&#39;authors&#39;))</span><br><span class="line">&gt;&gt;&gt; q[0].num_authors</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; q[1].num_authors</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>ä¸ aggregate() ä¸åŒçš„æ˜¯ï¼Œ annotate() ä¸æ˜¯ä¸€ä¸ªç»ˆæ­¢å­å¥ã€‚annotate()å­å¥çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªæŸ¥è¯¢é›† (QuerySet)ï¼›è¿™ä¸ª QuerySetå¯ä»¥ç”¨ä»»ä½•QuerySetæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼ŒåŒ…æ‹¬ filter(), order_by(), ç”šè‡³æ˜¯å†æ¬¡åº”ç”¨annotate()ã€‚</p>
<p><a href="http://python.usyiyi.cn/documents/django_182/topics/db/aggregation.html" target="_blank" rel="noopener">Django èšåˆ</a></p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Python f-strings 3.6 ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½</title>
    <url>/2020/04/23/Python-f-strings-3-6-%E7%89%88%E6%9C%AC%E6%96%B0%E5%A2%9E%E5%8A%A0%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%8A%9F%E8%83%BD/</url>
    <content><![CDATA[<h2 id="Python-f-strings-3-6-ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½"><a href="#Python-f-strings-3-6-ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½" class="headerlink" title="Python f-strings 3.6 ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½"></a>Python f-strings 3.6 ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½</h2><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><blockquote>
<p>Python 3.6 æ–°ç‰ˆæœ¬å¢åŠ çš„æ–°åŠŸèƒ½ formatted string literals ï¼Œç®€ç§° f-strings,f-stringï¼Œäº¦ç§°ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²å¸¸é‡ï¼ˆformatted string literalsï¼‰ï¼Œæ˜¯Python3.6æ–°å¼•å…¥çš„ä¸€ç§å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æºäºPEP 498 â€“ Literal String Interpolationï¼Œä¸»è¦ç›®çš„æ˜¯ä½¿æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ“ä½œæ›´åŠ ç®€ä¾¿ã€‚f-stringåœ¨å½¢å¼ä¸Šæ˜¯ä»¥ f æˆ– F ä¿®é¥°ç¬¦å¼•é¢†çš„å­—ç¬¦ä¸²ï¼ˆfâ€™xxxâ€™ æˆ– Fâ€™xxxâ€™ï¼‰ï¼Œä»¥å¤§æ‹¬å· {} æ ‡æ˜è¢«æ›¿æ¢çš„å­—æ®µï¼›f-stringåœ¨æœ¬è´¨ä¸Šå¹¶ä¸æ˜¯å­—ç¬¦ä¸²å¸¸é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªåœ¨è¿è¡Œæ—¶è¿ç®—æ±‚å€¼çš„è¡¨è¾¾å¼:</p>
<blockquote>
<p>While other string literals always have a constant value, formatted strings are really expressions evaluated at run time.<br>ï¼ˆä¸å…·æœ‰æ’å®šå€¼çš„å…¶å®ƒå­—ç¬¦ä¸²å¸¸é‡ä¸åŒï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²å®é™…ä¸Šæ˜¯è¿è¡Œæ—¶è¿ç®—æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚ï¼‰<br>â€”â€” Python Documentation</p>
</blockquote>
</blockquote>
<hr>
<p>f-stringåœ¨åŠŸèƒ½æ–¹é¢ä¸é€Šäºä¼ ç»Ÿçš„%-formattingè¯­å¥å’Œstr.format()å‡½æ•°ï¼ŒåŒæ—¶æ€§èƒ½åˆä¼˜äºäºŒè€…ï¼Œä¸”ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ ç®€æ´æ˜äº†ï¼Œå› æ­¤å¯¹äºPython3.6åŠä»¥åçš„ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨f-stringè¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–ã€‚</p>
<h2 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h2><h3 id="è¿™æ˜¯ä¸€ä¸ªè®©äººå…´å¥‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå…ˆæ¥çœ‹çœ‹æ•ˆæœ"><a href="#è¿™æ˜¯ä¸€ä¸ªè®©äººå…´å¥‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå…ˆæ¥çœ‹çœ‹æ•ˆæœ" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªè®©äººå…´å¥‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå…ˆæ¥çœ‹çœ‹æ•ˆæœ"></a>è¿™æ˜¯ä¸€ä¸ªè®©äººå…´å¥‹çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå…ˆæ¥çœ‹çœ‹æ•ˆæœ</h3><ol>
<li>f-stringç”¨å¤§æ‹¬å· {} è¡¨ç¤ºè¢«æ›¿æ¢å­—æ®µ,å…¶ä¸­ç›´æ¥å¡«å…¥æ›¿æ¢å†…å®¹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; name &#x3D; &#39;wxnacy&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;my name is &#123;name&#125;&#39;</span><br><span class="line">&#39;my name is wxnacy&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;my name is &#123;name&#125; and length is &#123;len(name)&#125;&#39;</span><br><span class="line">&#39;my name is wxnacy and length is 6&#39;</span><br><span class="line">&gt;&gt;&gt; F&#39;my name is &#123;name&#125; and length is &#123;len(name)&#125;&#39;</span><br><span class="line">&#39;my name is wxnacy and length is 6&#39;</span><br></pre></td></tr></table></figure></li>
<li>ä¹‹æ‰€ä»¥å«f-strings ï¼Œå°±æ˜¯è¦ç”¨ f ä½œä¸ºå­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œå°±åƒ bâ€™â€™, uâ€™â€™ é‚£æ ·ï¼Œç„¶åç”¨ {} ä¸­ä½¿ç”¨å˜é‡ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨å‡½æ•°æ–¹æ³•ï¼Œå°±å¯ä»¥å®Œæˆæ ¼å¼åŒ–ï¼Œå¦‚æœä½ ä¹Ÿæ¥è§¦ Node å¼€å‘ï¼Œå°±çŸ¥é“ç°åœ¨åœ¨ Javascript ä¸­å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–é€šå¸¸æ˜¯è¿™æ ·çš„<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; name &#x3D; &#39;wxnacy&#39;</span><br><span class="line">&#39;wxnacy&#39;</span><br><span class="line">&gt; &#96;my name is $&#123;name&#125; and length is $&#123;name.length&#125;&#96;</span><br><span class="line">&#39;my name is wxnacy and length is 6</span><br></pre></td></tr></table></figure>
<h3 id="è¡¨è¾¾å¼æ±‚å€¼ä¸å‡½æ•°è°ƒç”¨"><a href="#è¡¨è¾¾å¼æ±‚å€¼ä¸å‡½æ•°è°ƒç”¨" class="headerlink" title="è¡¨è¾¾å¼æ±‚å€¼ä¸å‡½æ•°è°ƒç”¨"></a>è¡¨è¾¾å¼æ±‚å€¼ä¸å‡½æ•°è°ƒç”¨</h3></li>
<li>f-stringçš„å¤§æ‹¬å· {} å¯ä»¥å¡«å…¥è¡¨è¾¾å¼æˆ–è°ƒç”¨å‡½æ•°ï¼ŒPythonä¼šæ±‚å‡ºå…¶ç»“æœå¹¶å¡«å…¥è¿”å›çš„å­—ç¬¦ä¸²å†…ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&#39;A total number of &#123;24 * 8 + 4&#125;&#39;</span><br><span class="line">&#39;A total number of 196&#39;</span><br><span class="line">&gt;&gt;&gt; name &#x3D; &#39;ERIC&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;My name is &#123;name.lower()&#125;&#39;</span><br><span class="line">&#39;My name is eric&#39;</span><br><span class="line">&gt;&gt;&gt; import math</span><br><span class="line">&gt;&gt;&gt; f&#39;The answer is &#123;math.log(math.pi)&#125;&#39;</span><br><span class="line">&#39;The answer is 1.1447298858494002&#39;</span><br></pre></td></tr></table></figure>
<h3 id="å¼•å·ã€å¤§æ‹¬å·ä¸åæ–œæ "><a href="#å¼•å·ã€å¤§æ‹¬å·ä¸åæ–œæ " class="headerlink" title="å¼•å·ã€å¤§æ‹¬å·ä¸åæ–œæ "></a>å¼•å·ã€å¤§æ‹¬å·ä¸åæ–œæ </h3>f-stringå¤§æ‹¬å·å†…æ‰€ç”¨çš„å¼•å·ä¸èƒ½å’Œå¤§æ‹¬å·å¤–çš„å¼•å·å®šç•Œç¬¦å†²çªï¼Œå¯æ ¹æ®æƒ…å†µçµæ´»åˆ‡æ¢ â€˜ å’Œ â€œ ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&#39;I am &#123;&quot;Eric&quot;&#125;&#39;</span><br><span class="line">&#39;I am Eric&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;I am &#123;&#39;Eric&#39;&#125;&#39;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">    f&#39;I am &#123;&#39;Eric&#39;&#125;&#39;</span><br><span class="line">                ^</span><br><span class="line">SyntaxError: invalid syntax</span><br></pre></td></tr></table></figure>
è‹¥ â€˜ å’Œ â€œ ä¸è¶³ä»¥æ»¡è¶³è¦æ±‚ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ â€˜â€™â€™ å’Œ â€œâ€â€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&quot;He said &#123;&quot;I&#39;m Eric&quot;&#125;&quot;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">    f&quot;He said &#123;&quot;I&#39;m Eric&quot;&#125;&quot;</span><br><span class="line">                ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line">&gt;&gt;&gt; f&#39;He said &#123;&quot;I&#39;m Eric&quot;&#125;&#39;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">    f&#39;He said &#123;&quot;I&#39;m Eric&quot;&#125;&#39;</span><br><span class="line">                  ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line">&gt;&gt;&gt; f&quot;&quot;&quot;He said &#123;&quot;I&#39;m Eric&quot;&#125;&quot;&quot;&quot;</span><br><span class="line">&quot;He said I&#39;m Eric&quot;</span><br><span class="line">&gt;&gt;&gt; f&#39;&#39;&#39;He said &#123;&quot;I&#39;m Eric&quot;&#125;&#39;&#39;&#39;</span><br><span class="line">&quot;He said I&#39;m Eric&quot;</span><br></pre></td></tr></table></figure>
<h3 id="å¤§æ‹¬å·å¤–çš„å¼•å·è¿˜å¯ä»¥ä½¿ç”¨-è½¬ä¹‰ï¼Œä½†å¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨-è½¬ä¹‰ï¼š"><a href="#å¤§æ‹¬å·å¤–çš„å¼•å·è¿˜å¯ä»¥ä½¿ç”¨-è½¬ä¹‰ï¼Œä½†å¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨-è½¬ä¹‰ï¼š" class="headerlink" title="å¤§æ‹¬å·å¤–çš„å¼•å·è¿˜å¯ä»¥ä½¿ç”¨ \ è½¬ä¹‰ï¼Œä½†å¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨ \ è½¬ä¹‰ï¼š"></a>å¤§æ‹¬å·å¤–çš„å¼•å·è¿˜å¯ä»¥ä½¿ç”¨ \ è½¬ä¹‰ï¼Œä½†å¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨ \ è½¬ä¹‰ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&#39;&#39;&#39;He\&#39;ll say &#123;&quot;I&#39;m Eric&quot;&#125;&#39;&#39;&#39;</span><br><span class="line">&quot;He&#39;ll say I&#39;m Eric&quot;</span><br><span class="line">&gt;&gt;&gt; f&#39;&#39;&#39;He&#39;ll say &#123;&quot;I\&#39;m Eric&quot;&#125;&#39;&#39;&#39;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">SyntaxError: f-string expression part cannot include a backslash</span><br></pre></td></tr></table></figure>
<h3 id="f-stringå¤§æ‹¬å·å¤–å¦‚æœéœ€è¦æ˜¾ç¤ºå¤§æ‹¬å·ï¼Œåˆ™åº”è¾“å…¥è¿ç»­ä¸¤ä¸ªå¤§æ‹¬å·-ï¼š"><a href="#f-stringå¤§æ‹¬å·å¤–å¦‚æœéœ€è¦æ˜¾ç¤ºå¤§æ‹¬å·ï¼Œåˆ™åº”è¾“å…¥è¿ç»­ä¸¤ä¸ªå¤§æ‹¬å·-ï¼š" class="headerlink" title="f-stringå¤§æ‹¬å·å¤–å¦‚æœéœ€è¦æ˜¾ç¤ºå¤§æ‹¬å·ï¼Œåˆ™åº”è¾“å…¥è¿ç»­ä¸¤ä¸ªå¤§æ‹¬å· ï¼š"></a>f-stringå¤§æ‹¬å·å¤–å¦‚æœéœ€è¦æ˜¾ç¤ºå¤§æ‹¬å·ï¼Œåˆ™åº”è¾“å…¥è¿ç»­ä¸¤ä¸ªå¤§æ‹¬å· ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&#39;5 &#123;&quot;&#123;stars&#125;&quot;&#125;&#39;</span><br><span class="line">&#39;5 &#123;stars&#125;&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;&#123;&#123;5&#125;&#125; &#123;&quot;stars&quot;&#125;&#39;</span><br><span class="line">&#39;&#123;5&#125; stars&#39;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸Šé¢æåˆ°ï¼Œf-stringå¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨-è½¬ä¹‰ï¼Œäº‹å®ä¸Šä¸ä»…å¦‚æ­¤ï¼Œf-stringå¤§æ‹¬å·å†…æ ¹æœ¬å°±ä¸å…è®¸å‡ºç°-ã€‚å¦‚æœç¡®å®éœ€è¦-ï¼Œåˆ™åº”é¦–å…ˆå°†åŒ…å«-çš„å†…å®¹ç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºï¼Œå†åœ¨f-stringå¤§æ‹¬å·å†…å¡«å…¥å˜é‡åï¼š"><a href="#ä¸Šé¢æåˆ°ï¼Œf-stringå¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨-è½¬ä¹‰ï¼Œäº‹å®ä¸Šä¸ä»…å¦‚æ­¤ï¼Œf-stringå¤§æ‹¬å·å†…æ ¹æœ¬å°±ä¸å…è®¸å‡ºç°-ã€‚å¦‚æœç¡®å®éœ€è¦-ï¼Œåˆ™åº”é¦–å…ˆå°†åŒ…å«-çš„å†…å®¹ç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºï¼Œå†åœ¨f-stringå¤§æ‹¬å·å†…å¡«å…¥å˜é‡åï¼š" class="headerlink" title="ä¸Šé¢æåˆ°ï¼Œf-stringå¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨ \ è½¬ä¹‰ï¼Œäº‹å®ä¸Šä¸ä»…å¦‚æ­¤ï¼Œf-stringå¤§æ‹¬å·å†…æ ¹æœ¬å°±ä¸å…è®¸å‡ºç° \ã€‚å¦‚æœç¡®å®éœ€è¦ \ï¼Œåˆ™åº”é¦–å…ˆå°†åŒ…å« \ çš„å†…å®¹ç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºï¼Œå†åœ¨f-stringå¤§æ‹¬å·å†…å¡«å…¥å˜é‡åï¼š"></a>ä¸Šé¢æåˆ°ï¼Œf-stringå¤§æ‹¬å·å†…ä¸èƒ½ä½¿ç”¨ \ è½¬ä¹‰ï¼Œäº‹å®ä¸Šä¸ä»…å¦‚æ­¤ï¼Œf-stringå¤§æ‹¬å·å†…æ ¹æœ¬å°±ä¸å…è®¸å‡ºç° \ã€‚å¦‚æœç¡®å®éœ€è¦ \ï¼Œåˆ™åº”é¦–å…ˆå°†åŒ…å« \ çš„å†…å®¹ç”¨ä¸€ä¸ªå˜é‡è¡¨ç¤ºï¼Œå†åœ¨f-stringå¤§æ‹¬å·å†…å¡«å…¥å˜é‡åï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&quot;newline: &#123;ord(&#39;\n&#39;)&#125;&quot;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">SyntaxError: f-string expression part cannot include a backslash</span><br><span class="line">&gt;&gt;&gt; newline &#x3D; ord(&#39;\n&#39;)</span><br><span class="line">&gt;&gt;&gt; f&#39;newline: &#123;newline&#125;&#39;</span><br><span class="line">&#39;newline: 10&#39;</span><br></pre></td></tr></table></figure>
<h3 id="å¤šè¡Œf-string"><a href="#å¤šè¡Œf-string" class="headerlink" title="å¤šè¡Œf-string"></a>å¤šè¡Œf-string</h3>f-stringè¿˜å¯ç”¨äºå¤šè¡Œå­—ç¬¦ä¸²ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; name &#x3D; &#39;Eric&#39;</span><br><span class="line">&gt;&gt;&gt; age &#x3D; 27</span><br><span class="line">&gt;&gt;&gt; f&quot;Hello!&quot; \</span><br><span class="line">... f&quot;I&#39;m &#123;name&#125;.&quot; \</span><br><span class="line">... f&quot;I&#39;m &#123;age&#125;.&quot;</span><br><span class="line">&quot;Hello!I&#39;m Eric.I&#39;m 27.&quot;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸åŸå§‹å­—ç¬¦ä¸²è”åˆä½¿ç”¨"><a href="#ä¸åŸå§‹å­—ç¬¦ä¸²è”åˆä½¿ç”¨" class="headerlink" title="ä¸åŸå§‹å­—ç¬¦ä¸²è”åˆä½¿ç”¨"></a>ä¸åŸå§‹å­—ç¬¦ä¸²è”åˆä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; fr&#39;hello\nworld&#39;</span><br><span class="line">&#39;hello\\nworld&#39;</span><br></pre></td></tr></table></figure>
<h3 id="æ”¯æŒè¡¨è¾¾å¼-å¯¹è±¡"><a href="#æ”¯æŒè¡¨è¾¾å¼-å¯¹è±¡" class="headerlink" title="æ”¯æŒè¡¨è¾¾å¼(å¯¹è±¡)"></a>æ”¯æŒè¡¨è¾¾å¼(å¯¹è±¡)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; spurs &#x3D; &#123;&quot;Guard&quot;: &quot;Parker&quot;, &quot;Forward&quot;: &quot;Duncan&quot;&#125;</span><br><span class="line">&gt;&gt;&gt; f&quot;The &#123;len(spurs)&#125; players are: &#123;spurs[&#39;Guard&#39;]&#125; the guard, and &#123;spurs[&#39;Forward&#39;]&#125; the forward.&quot;</span><br><span class="line">&#39;The 2 players are: Parker the guard, and Duncan the forward.&#39;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; f&#39;Numbers from 1-10 are &#123;[_ for _ in range(1, 11)]&#125;&#39;</span><br><span class="line">&#39;Numbers from 1-10 are [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]&#39;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="è‡ªå®šä¹‰æ ¼å¼ï¼šå¯¹é½ã€å®½åº¦ã€ç¬¦å·ã€è¡¥é›¶ã€ç²¾åº¦ã€è¿›åˆ¶ç­‰"><a href="#è‡ªå®šä¹‰æ ¼å¼ï¼šå¯¹é½ã€å®½åº¦ã€ç¬¦å·ã€è¡¥é›¶ã€ç²¾åº¦ã€è¿›åˆ¶ç­‰" class="headerlink" title="è‡ªå®šä¹‰æ ¼å¼ï¼šå¯¹é½ã€å®½åº¦ã€ç¬¦å·ã€è¡¥é›¶ã€ç²¾åº¦ã€è¿›åˆ¶ç­‰"></a>è‡ªå®šä¹‰æ ¼å¼ï¼šå¯¹é½ã€å®½åº¦ã€ç¬¦å·ã€è¡¥é›¶ã€ç²¾åº¦ã€è¿›åˆ¶ç­‰</h3><blockquote>
<p>f-stringé‡‡ç”¨ {content:format} è®¾ç½®å­—ç¬¦ä¸²æ ¼å¼ï¼Œå…¶ä¸­ content æ˜¯æ›¿æ¢å¹¶å¡«å…¥å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œå¯ä»¥æ˜¯å˜é‡ã€è¡¨è¾¾å¼æˆ–å‡½æ•°ç­‰ï¼Œformat æ˜¯æ ¼å¼æè¿°ç¬¦ã€‚é‡‡ç”¨é»˜è®¤æ ¼å¼æ—¶ä¸å¿…æŒ‡å®š {:format}ï¼Œå¦‚ä¸Šé¢ä¾‹å­æ‰€ç¤ºåªå†™ {content} å³å¯</p>
</blockquote>
<ol>
<li>æ’ç‰ˆæ ¼å¼<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; spurs &#x3D; &#123;&quot;Guard&quot;: &quot;Parker&quot;, &quot;Forward&quot;: &quot;Duncan&quot;&#125;</span><br><span class="line">&gt;&gt;&gt; def show_players():</span><br><span class="line">...     print(f&quot;&#123;&#39;Position&#39;:^10&#125;&#123;&#39;Name&#39;:^10&#125;&quot;)</span><br><span class="line">...     for player in spurs:</span><br><span class="line">...         print(f&quot;&#123;player:^10&#125;&#123;spurs[player]:^10&#125;&quot;)</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; show_players()</span><br><span class="line"> Position    Name</span><br><span class="line">  Guard     Parker</span><br><span class="line"> Forward    Duncan</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; 123.456</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:8.2f&#125;&#39;</span><br><span class="line">&#39;a is   123.46&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:08.2f&#125;&#39;</span><br><span class="line">&#39;a is 00123.46&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:8.2e&#125;&#39;</span><br><span class="line">&#39;a is 1.23e+02&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:8.2%&#125;&#39;</span><br><span class="line">&#39;a is 12345.60%&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:8.2g&#125;&#39;</span><br><span class="line">&#39;a is  1.2e+02&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s &#x3D; &#39;hello&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;s is &#123;s:8s&#125;&#39;</span><br><span class="line">&#39;s is hello   &#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;s is &#123;s:8.3s&#125;&#39;</span><br><span class="line">&#39;s is hel     &#39;</span><br></pre></td></tr></table></figure></li>
<li>ç»¼åˆç¤ºä¾‹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; 1234</span><br><span class="line">&gt;&gt;&gt; f&#39;a is &#123;a:^#10X&#125;&#39;      # å±…ä¸­ï¼Œå®½åº¦10ä½ï¼Œåå…­è¿›åˆ¶æ•´æ•°ï¼ˆå¤§å†™å­—æ¯ï¼‰ï¼Œæ˜¾ç¤º0Xå‰ç¼€</span><br><span class="line">&#39;a is   0X4D2   &#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; b &#x3D; 1234.5678</span><br><span class="line">&gt;&gt;&gt; f&#39;b is &#123;b:&lt;+10.2f&#125;&#39;    # å·¦å¯¹é½ï¼Œå®½åº¦10ä½ï¼Œæ˜¾ç¤ºæ­£å·ï¼ˆ+ï¼‰ï¼Œå®šç‚¹æ•°æ ¼å¼ï¼Œ2ä½å°æ•°</span><br><span class="line">&#39;b is +1234.57  &#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; c &#x3D; 12345678</span><br><span class="line">&gt;&gt;&gt; f&#39;c is &#123;c:015,d&#125;&#39;      # é«˜ä½è¡¥é›¶ï¼Œå®½åº¦15ä½ï¼Œåè¿›åˆ¶æ•´æ•°ï¼Œä½¿ç”¨,ä½œä¸ºåƒåˆ†åˆ†å‰²ä½</span><br><span class="line">&#39;c is 000,012,345,678&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d &#x3D; 0.5 + 2.5j</span><br><span class="line">&gt;&gt;&gt; f&#39;d is &#123;d:30.3e&#125;&#39;      # å®½åº¦30ä½ï¼Œç§‘å­¦è®¡æ•°æ³•ï¼Œ3ä½å°æ•°</span><br><span class="line">&#39;d is           5.000e-01+2.500e+00j&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; import datetime</span><br><span class="line">&gt;&gt;&gt; e &#x3D; datetime.datetime.today()</span><br><span class="line">&gt;&gt;&gt; f&#39;the time is &#123;e:%Y-%m-%d (%a) %H:%M:%S&#125;&#39;   # datetimeæ—¶é—´æ ¼å¼</span><br><span class="line">&#39;the time is 2018-07-14 (Sat) 20:46:02&#39;</span><br></pre></td></tr></table></figure>
<h3 id="lambdaè¡¨è¾¾å¼"><a href="#lambdaè¡¨è¾¾å¼" class="headerlink" title="lambdaè¡¨è¾¾å¼"></a>lambdaè¡¨è¾¾å¼</h3>f-stringå¤§æ‹¬å·å†…ä¹Ÿå¯å¡«å…¥lambdaè¡¨è¾¾å¼ï¼Œä½†lambdaè¡¨è¾¾å¼çš„ : ä¼šè¢«f-stringè¯¯è®¤ä¸ºæ˜¯è¡¨è¾¾å¼ä¸æ ¼å¼æè¿°ç¬¦ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œä¸ºé¿å…æ­§ä¹‰ï¼Œéœ€è¦å°†lambdaè¡¨è¾¾å¼ç½®äºæ‹¬å·()å†…:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; f&#39;result is &#123;lambda x: x ** 2 + 1 (2)&#125;&#39;</span><br><span class="line">  File &quot;&lt;input&gt;&quot;, line 1</span><br><span class="line">    (lambda x)</span><br><span class="line">             ^</span><br><span class="line">SyntaxError: unexpected EOF while parsing</span><br><span class="line">&gt;&gt;&gt; f&#39;result is &#123;(lambda x: x ** 2 + 1) (2)&#125;&#39;</span><br><span class="line">&#39;result is 5&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;result is &#123;(lambda x: x ** 2 + 1) (2):&lt;+7.2f&#125;&#39;</span><br><span class="line">&#39;result is +5.00  &#39;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="ä¸-format-å¯¹æ¯”"><a href="#ä¸-format-å¯¹æ¯”" class="headerlink" title="ä¸ format() å¯¹æ¯”"></a>ä¸ format() å¯¹æ¯”</h2><p>f-strings ä¸ format() æ ¼å¼åŒ–çš„è¯­æ³•å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯æ›´åŠ ç®€æ´</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import datetime</span><br><span class="line">&gt;&gt;&gt; f&#39;&#123;datetime.datetime.now():%Y-%m-%d %H:%M:%S.%s&#125;&#39;</span><br><span class="line">&#39;2018-12-28 11:06:16.1545966376&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;&#123;:%Y-%m-%d %H:%M:%S.%s&#125;&#39;.format(datetime.datetime.now())</span><br><span class="line">&#39;2018-12-28 11:06:37.1545966397&#39;</span><br></pre></td></tr></table></figure>

<p><a href="https://wxnacy.com/2018/01/03/python-format/" target="_blank" rel="noopener">Python æ ¼å¼åŒ–å‡½æ•° formatä½¿ç”¨</a></p>
<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å¯ä»¥æƒ³è±¡å¦‚æœä½ çš„é¡¹ç›®ç‰ˆæœ¬å…¨é¢æåˆ° 3.6 ä»¥åï¼Œf-strings æ ¼å¼åŒ–æ–¹æ³•ä¸€å®šæ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒä¸ä½†ç®€æ´ï¼Œå¹¶ä¸”å¿«ï¼Œå®ƒçš„é€Ÿåº¦æ¯”format()å¿«äº†ä¸€å€ã€‚</p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://blog.csdn.net/sunxb10/article/details/81036693" target="_blank" rel="noopener">Pythonæ ¼å¼åŒ–å­—ç¬¦ä¸²f-stringæ¦‚è§ˆ - sunxb10çš„åšå®¢ - CSDNåšå®¢</a><br><a href="https://mlln.cn/2018/05/19/python3%20f-string%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/#%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90" target="_blank" rel="noopener">python3 f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é«˜çº§ç”¨æ³• - DataScience</a><br><a href="https://wxnacy.com/2018/01/16/python-f-strings/" target="_blank" rel="noopener">Python f-strings 3.6 ç‰ˆæœ¬æ–°å¢åŠ çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Python concurrent.futures çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å—</title>
    <url>/2020/04/23/Python-concurrent-futures-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%BF%9B%E7%A8%8B%E6%B1%A0%E6%A8%A1%E5%9D%97/</url>
    <content><![CDATA[<h2 id="Python-concurrent-futures-çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å—"><a href="#Python-concurrent-futures-çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å—" class="headerlink" title="Python concurrent.futures çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å—"></a>Python concurrent.futures çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å—</h2><blockquote>
<p>åœ¨python3.2ç‰ˆæœ¬åŠä»¥ä¸Šä½¿ç”¨concurrent.futuresè¿›è¡Œçº¿ç¨‹æ± å’Œè¿›ç¨‹æ± çš„ä½¿ç”¨ï¼Œå®ç°æ•°æ®é«˜å¹¶å‘ã€‚</p>
</blockquote>
<blockquote class="blockquote-center"><p>å¦‚æœä¸€ä¸ªäººå¿ƒé‡Œè—äº†é‚£ä¹ˆå¤šçš„å–œæ€’å“€ä¹ï¼Œä¸€å®šæ›¾ç»æ´»å¾—ä¼¤ç—•ç´¯ç´¯ã€‚ </p>
</blockquote>
<p>åœ¨Python3.2å¼€å§‹å°±æœ‰concurrent_futuresï¼Œå…¶å¯ä»¥å®ç°çº¿ç¨‹æ± ï¼Œè¿›ç¨‹æ± ï¼Œä¸å¿…å†è‡ªå·±ä½¿ç”¨ç®¡é“ä¼ æ•°æ®é€ æˆæ­»é”çš„é—®é¢˜ã€‚å¹¶ä¸”è¿™ä¸ªæ¨¡å—å…·æœ‰çº¿ç¨‹æ± å’Œè¿›ç¨‹æ± ã€ç®¡ç†å¹¶è¡Œç¼–ç¨‹ä»»åŠ¡ã€å¤„ç†éç¡®å®šæ€§çš„æ‰§è¡Œæµç¨‹ã€è¿›ç¨‹/çº¿ç¨‹åŒæ­¥ç­‰åŠŸèƒ½ï¼Œä½†æ˜¯å¹³æ—¶ç”¨çš„æœ€å¤šçš„è¿˜æ˜¯ç”¨æ¥æ„å»ºçº¿ç¨‹æ± å’Œè¿›ç¨‹æ± ã€‚</p>
<p>æ­¤æ¨¡å—ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li>concurrent.futures.Executor: è¿™æ˜¯ä¸€ä¸ªè™šæ‹ŸåŸºç±»ï¼Œæä¾›äº†å¼‚æ­¥æ‰§è¡Œçš„æ–¹æ³•ã€‚</li>
<li>submit(function, argument): è°ƒåº¦å‡½æ•°ï¼ˆå¯è°ƒç”¨çš„å¯¹è±¡ï¼‰çš„æ‰§è¡Œï¼Œå°† argument ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</li>
<li>map(function, argument): å°† argument ä½œä¸ºå‚æ•°æ‰§è¡Œå‡½æ•°ï¼Œä»¥ å¼‚æ­¥ çš„æ–¹å¼ã€‚</li>
<li>shutdown(Wait=True): å‘å‡ºè®©æ‰§è¡Œè€…é‡Šæ”¾æ‰€æœ‰èµ„æºçš„ä¿¡å·ã€‚</li>
<li>concurrent.futures.Future: å…¶ä¸­åŒ…æ‹¬å‡½æ•°çš„å¼‚æ­¥æ‰§è¡Œã€‚Futureå¯¹è±¡æ˜¯submitä»»åŠ¡ï¼ˆå³å¸¦æœ‰å‚æ•°çš„functionsï¼‰åˆ°executorçš„å®ä¾‹</li>
</ol>
<h3 id="çŸ¥è¯†å›é¡¾"><a href="#çŸ¥è¯†å›é¡¾" class="headerlink" title="çŸ¥è¯†å›é¡¾"></a>çŸ¥è¯†å›é¡¾</h3><p><a href="http://www.langzi.fun/Python%20threading%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9D%97.html" target="_blank" rel="noopener">çº¿ç¨‹ä¸çº¿ç¨‹æ± </a><br><a href="http://www.langzi.fun/Python%20multiprocess%20%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9D%97.html" target="_blank" rel="noopener">è¿›ç¨‹ä¸è¿›ç¨‹æ± </a><br><a href="http://www.langzi.fun/Python%E5%8D%8F%E7%A8%8B.html" target="_blank" rel="noopener">å¼‚æ­¥åç¨‹</a></p>
<h3 id="çº¿ç¨‹æ± æ¡ˆä¾‹"><a href="#çº¿ç¨‹æ± æ¡ˆä¾‹" class="headerlink" title="çº¿ç¨‹æ± æ¡ˆä¾‹"></a>çº¿ç¨‹æ± æ¡ˆä¾‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># coding:utf-8</span><br><span class="line">from concurrent.futures import ProcessPoolExecutor,ThreadPoolExecutor</span><br><span class="line"># å¯¼å…¥çº¿ç¨‹æ± å’Œè¿›ç¨‹æ± æ¨¡å—</span><br><span class="line">import threading</span><br><span class="line"># å¯¼å…¥çº¿ç¨‹æ¨¡å—ï¼Œä½œç”¨æ˜¯è·å–å½“å‰çº¿ç¨‹çš„åç§°</span><br><span class="line">import os,time</span><br><span class="line"></span><br><span class="line">def task(n):</span><br><span class="line">    print(&#39;%s:%s is running&#39; %(threading.currentThread().getName(),os.getpid()))</span><br><span class="line">    # æ‰“å°å½“å‰çº¿ç¨‹åå’Œè¿è¡Œçš„idå·ç </span><br><span class="line">    time.sleep(2)</span><br><span class="line">    return n**2</span><br><span class="line">    # è¿”å›ä¼ å…¥å‚æ•°çš„äºŒæ¬¡å¹‚</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    p&#x3D;ThreadPoolExecutor()</span><br><span class="line">    #å®ä¾‹åŒ–çº¿ç¨‹æ± ï¼Œè®¾ç½®çº¿ç¨‹æ± çš„æ•°é‡ï¼Œä¸å¡«åˆ™é»˜è®¤ä¸ºcpuçš„ä¸ªæ•°*5</span><br><span class="line">    l&#x3D;[]</span><br><span class="line">    # ç”¨æ¥ä¿å­˜è¿”å›çš„æ•°æ®ï¼Œåšè®¡ç®—æ€»è®¡</span><br><span class="line">    for i in range(10):</span><br><span class="line">        obj&#x3D;p.submit(task,i)</span><br><span class="line">        # ä¼ å…¥çš„å‚æ•°æ˜¯è¦æ‰§è¡Œçš„å‡½æ•°å’Œè¯¥å‡½æ•°æ¥å—çš„å‚æ•°</span><br><span class="line">        # -----------------------------------</span><br><span class="line">        # è¿™é‡Œæ‰§è¡Œçš„æ–¹å¼æ˜¯å¼‚æ­¥æ‰§è¡Œ</span><br><span class="line">        # # p.submit(task,i).result()å³åŒæ­¥æ‰§è¡Œ</span><br><span class="line">        # -----------------------------------</span><br><span class="line">        # ä¸Šé¢çš„æ–¹æ³•ä½¿ç”¨rangeå¾ªç¯æœ‰ä¸ªé«˜çº§çš„å†™æ³•ï¼Œå³mapå†…ç½®å‡½æ•°</span><br><span class="line">        # obj&#x3D;p.map(task,range(10))</span><br><span class="line">        # p.shutdown()</span><br><span class="line">        # -----------------------------------</span><br><span class="line">        l.append(obj)</span><br><span class="line">        # æŠŠè¿”å›çš„ç»“æœä¿å­˜åœ¨ç©ºçš„åˆ—è¡¨ä¸­ï¼Œåšæ€»è®¡ç®—</span><br><span class="line">    p.shutdown()</span><br><span class="line">    # æ‰€æœ‰è®¡åˆ’è¿è¡Œå®Œæ¯•ï¼Œå…³é—­ç»“æŸçº¿ç¨‹æ± </span><br><span class="line"></span><br><span class="line">    print(&#39;&#x3D;&#39;*30)</span><br><span class="line">    print([obj.result() for obj in l])</span><br><span class="line"></span><br><span class="line">#ä¸Šé¢æ–¹æ³•ä¹Ÿå¯å†™æˆä¸‹é¢çš„æ–¹æ³•</span><br><span class="line">    # with ThreadPoolExecutor() as p:   #ç±»ä¼¼æ‰“å¼€æ–‡ä»¶,å¯çœå».shutdown()</span><br><span class="line">    #     future_tasks &#x3D; [p.submit(task, i) for i in range(10)]</span><br><span class="line">    # print(&#39;&#x3D;&#39; * 30)</span><br><span class="line">    # print([obj.result() for obj in future_tasks])</span><br></pre></td></tr></table></figure>

<h3 id="è¿›ç¨‹æ± æ¡ˆä¾‹"><a href="#è¿›ç¨‹æ± æ¡ˆä¾‹" class="headerlink" title="è¿›ç¨‹æ± æ¡ˆä¾‹"></a>è¿›ç¨‹æ± æ¡ˆä¾‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from concurrent.futures import ProcessPoolExecutor</span><br><span class="line">import os,time,random</span><br><span class="line">def task(n):</span><br><span class="line">    print(&#39;%s is running&#39; %os.getpid())</span><br><span class="line">    time.sleep(2)</span><br><span class="line">    return n**2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    p&#x3D;ProcessPoolExecutor()  #ä¸å¡«åˆ™é»˜è®¤ä¸ºcpuçš„ä¸ªæ•°</span><br><span class="line">    l&#x3D;[]</span><br><span class="line">    start&#x3D;time.time()</span><br><span class="line">    for i in range(10):</span><br><span class="line">        obj&#x3D;p.submit(task,i)   #submit()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªfutureå®ä¾‹ï¼Œè¦å¾—åˆ°ç»“æœéœ€è¦ç”¨obj.result()</span><br><span class="line">        l.append(obj)</span><br><span class="line"></span><br><span class="line">    p.shutdown()  #ç±»ä¼¼ç”¨from multiprocessing import Poolå®ç°è¿›ç¨‹æ± ä¸­çš„closeåŠjoinä¸€èµ·çš„ä½œç”¨</span><br><span class="line">    print(&#39;&#x3D;&#39;*30)</span><br><span class="line">    # print([obj for obj in l])</span><br><span class="line">    print([obj.result() for obj in l])</span><br><span class="line">    print(time.time()-start)</span><br><span class="line"></span><br><span class="line">    #ä¸Šé¢æ–¹æ³•ä¹Ÿå¯å†™æˆä¸‹é¢çš„æ–¹æ³•</span><br><span class="line">    # start &#x3D; time.time()</span><br><span class="line">    # with ProcessPoolExecutor() as p:   #ç±»ä¼¼æ‰“å¼€æ–‡ä»¶,å¯çœå».shutdown()</span><br><span class="line">    #     future_tasks &#x3D; [p.submit(task, i) for i in range(10)]</span><br><span class="line">    # print(&#39;&#x3D;&#39; * 30)</span><br><span class="line">    # print([obj.result() for obj in future_tasks])</span><br><span class="line">    # print(time.time() - start)</span><br></pre></td></tr></table></figure>

<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://www.cnblogs.com/huchong/p/7458414.html" target="_blank" rel="noopener">è¿›ç¨‹æ± ã€çº¿ç¨‹æ± ã€å›è°ƒå‡½æ•° - å¬é£ã€‚ - åšå®¢å›­</a><br><a href="https://www.cnblogs.com/huchong/p/7459324.html" target="_blank" rel="noopener">ä½¿ç”¨concurrent.futuresæ¨¡å—å¹¶å‘ï¼Œå®ç°è¿›ç¨‹æ± ã€çº¿ç¨‹æ±  - å¬é£ã€‚ - åšå®¢å›­</a><br><a href="http://www.langzi.fun/Python-concurrent-futures-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%BF%9B%E7%A8%8B%E6%B1%A0%E6%A8%A1%E5%9D%97.html" target="_blank" rel="noopener">Python concurrent.futures çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å— | Langzi - Never Setter æ°¸ä¸å°†å°±</a><br><a href="http://www.langzi.fun/Python-concurrent-futures-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%BF%9B%E7%A8%8B%E6%B1%A0%E6%A8%A1%E5%9D%97.html" target="_blank" rel="noopener">Python concurrent.futures çº¿ç¨‹æ± è¿›ç¨‹æ± æ¨¡å— | Langzi - Never Setter æ°¸ä¸å°†å°±</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä»£ç ä¸€è¡Œå®ç°å¹¶è¡Œ</title>
    <url>/2020/04/23/Python%E4%BB%A3%E7%A0%81%E4%B8%80%E8%A1%8C%E5%AE%9E%E7%8E%B0%E5%B9%B6%E8%A1%8C/</url>
    <content><![CDATA[<h2 id="Pythonä»£ç ä¸€è¡Œå®ç°å¹¶è¡Œ"><a href="#Pythonä»£ç ä¸€è¡Œå®ç°å¹¶è¡Œ" class="headerlink" title="Pythonä»£ç ä¸€è¡Œå®ç°å¹¶è¡Œ"></a>Pythonä»£ç ä¸€è¡Œå®ç°å¹¶è¡Œ</h2><blockquote>
<p>Python åœ¨ç¨‹åºå¹¶è¡ŒåŒ–æ–¹é¢å¤šå°‘æœ‰äº›å£°åç‹¼è—‰ã€‚æ’‡å¼€æŠ€æœ¯ä¸Šçš„é—®é¢˜ï¼Œä¾‹å¦‚çº¿ç¨‹çš„å®ç°å’Œ GILï¼Œæˆ‘è§‰å¾—é”™è¯¯çš„æ•™å­¦æŒ‡å¯¼æ‰æ˜¯ä¸»è¦é—®é¢˜ã€‚å¸¸è§çš„ç»å…¸ Python å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹æ•™ç¨‹å¤šæ˜¾å¾—åâ€é‡â€ã€‚è€Œä¸”å¾€å¾€éš”é´æ”ç—’ï¼Œæ²¡æœ‰æ·±å…¥æ¢è®¨æ—¥å¸¸å·¥ä½œä¸­æœ€æœ‰ç”¨çš„å†…å®¹ã€‚</p>
</blockquote>
<h3 id="ä¼ ç»Ÿçš„ä¾‹å­"><a href="#ä¼ ç»Ÿçš„ä¾‹å­" class="headerlink" title="ä¼ ç»Ÿçš„ä¾‹å­"></a>ä¼ ç»Ÿçš„ä¾‹å­</h3><p>ç®€å•æœç´¢ä¸‹â€Python å¤šçº¿ç¨‹æ•™ç¨‹â€ï¼Œä¸éš¾å‘ç°å‡ ä¹æ‰€æœ‰çš„æ•™ç¨‹éƒ½ç»™å‡ºæ¶‰åŠç±»å’Œé˜Ÿåˆ—çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import os </span><br><span class="line">import PIL </span><br><span class="line"></span><br><span class="line">from multiprocessing import Pool </span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">SIZE &#x3D; (75,75)</span><br><span class="line">SAVE_DIRECTORY &#x3D; &#39;thumbs&#39;</span><br><span class="line"></span><br><span class="line">def get_image_paths(folder):</span><br><span class="line">    return (os.path.join(folder, f) </span><br><span class="line">            for f in os.listdir(folder) </span><br><span class="line">            if &#39;jpeg&#39; in f)</span><br><span class="line"></span><br><span class="line">def create_thumbnail(filename): </span><br><span class="line">    im &#x3D; Image.open(filename)</span><br><span class="line">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="line">    base, fname &#x3D; os.path.split(filename) </span><br><span class="line">    save_path &#x3D; os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="line">    im.save(save_path)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    folder &#x3D; os.path.abspath(</span><br><span class="line">        &#39;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&#39;)</span><br><span class="line">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="line"></span><br><span class="line">    images &#x3D; get_image_paths(folder)</span><br><span class="line"></span><br><span class="line">    pool &#x3D; Pool()</span><br><span class="line">    pool.map(creat_thumbnail, images)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure>
<p>å“ˆï¼Œçœ‹èµ·æ¥æœ‰äº›åƒ Java ä¸æ˜¯å—ï¼Ÿ<br>æˆ‘å¹¶ä¸æ˜¯è¯´ä½¿ç”¨ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹å¤„ç†å¤šçº¿ç¨‹/å¤šè¿›ç¨‹ä»»åŠ¡æ˜¯é”™è¯¯çš„ï¼ˆäº‹å®ä¸Šï¼Œè¿™ä¸€æ¨¡å‹è‡ªæœ‰å…¶ç”¨æ­¦ä¹‹åœ°ï¼‰ã€‚åªæ˜¯ï¼Œå¤„ç†æ—¥å¸¸è„šæœ¬ä»»åŠ¡æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´æœ‰æ•ˆç‡çš„æ¨¡å‹ã€‚</p>
<h3 id="é—®é¢˜åœ¨äºâ€¦"><a href="#é—®é¢˜åœ¨äºâ€¦" class="headerlink" title="é—®é¢˜åœ¨äºâ€¦"></a>é—®é¢˜åœ¨äºâ€¦</h3><p>é¦–å…ˆï¼Œä½ éœ€è¦ä¸€ä¸ªæ ·æ¿ç±»ï¼›<br>å…¶æ¬¡ï¼Œä½ éœ€è¦ä¸€ä¸ªé˜Ÿåˆ—æ¥ä¼ é€’å¯¹è±¡ï¼›<br>è€Œä¸”ï¼Œä½ è¿˜éœ€è¦åœ¨é€šé“ä¸¤ç«¯éƒ½æ„å»ºç›¸åº”çš„æ–¹æ³•æ¥ååŠ©å…¶å·¥ä½œ(å¦‚æœéœ€æƒ³è¦è¿›è¡ŒåŒå‘é€šä¿¡æˆ–æ˜¯ä¿å­˜ç»“æœè¿˜éœ€è¦å†å¼•å…¥ä¸€ä¸ªé˜Ÿåˆ—)</p>
<h3 id="worker-è¶Šå¤šï¼Œé—®é¢˜è¶Šå¤š"><a href="#worker-è¶Šå¤šï¼Œé—®é¢˜è¶Šå¤š" class="headerlink" title="worker è¶Šå¤šï¼Œé—®é¢˜è¶Šå¤š"></a>worker è¶Šå¤šï¼Œé—®é¢˜è¶Šå¤š</h3><p>æŒ‰ç…§è¿™ä¸€æ€è·¯ï¼Œä½ ç°åœ¨éœ€è¦ä¸€ä¸ª worker çº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ä¸‹é¢æ˜¯ä¸€ç¯‡ IBM ç»å…¸æ•™ç¨‹ä¸­çš„ä¾‹å­â€”â€”åœ¨è¿›è¡Œç½‘é¡µæ£€ç´¢æ—¶é€šè¿‡å¤šçº¿ç¨‹è¿›è¡ŒåŠ é€Ÿã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#Example2.py</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">A more realistic thread pool example </span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">import time </span><br><span class="line">import threading </span><br><span class="line">import Queue </span><br><span class="line">import urllib2 </span><br><span class="line"></span><br><span class="line">class Consumer(threading.Thread): </span><br><span class="line">    def __init__(self, queue): </span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self._queue &#x3D; queue </span><br><span class="line"></span><br><span class="line">    def run(self):</span><br><span class="line">        while True: </span><br><span class="line">            content &#x3D; self._queue.get() </span><br><span class="line">            if isinstance(content, str) and content &#x3D;&#x3D; &#39;quit&#39;:</span><br><span class="line">                break</span><br><span class="line">            response &#x3D; urllib2.urlopen(content)</span><br><span class="line">        print &#39;Bye byes!&#39;</span><br><span class="line"></span><br><span class="line">def Producer():</span><br><span class="line">    urls &#x3D; [</span><br><span class="line">        &#39;http:&#x2F;&#x2F;www.python.org&#39;, &#39;http:&#x2F;&#x2F;www.yahoo.com&#39;</span><br><span class="line">        &#39;http:&#x2F;&#x2F;www.scala.org&#39;, &#39;http:&#x2F;&#x2F;www.google.com&#39;</span><br><span class="line">        # etc.. </span><br><span class="line">    ]</span><br><span class="line">    queue &#x3D; Queue.Queue()</span><br><span class="line">    worker_threads &#x3D; build_worker_pool(queue, 4)</span><br><span class="line">    start_time &#x3D; time.time()</span><br><span class="line"></span><br><span class="line">    # Add the urls to process</span><br><span class="line">    for url in urls: </span><br><span class="line">        queue.put(url)  </span><br><span class="line">    # Add the poison pillv</span><br><span class="line">    for worker in worker_threads:</span><br><span class="line">        queue.put(&#39;quit&#39;)</span><br><span class="line">    for worker in worker_threads:</span><br><span class="line">        worker.join()</span><br><span class="line"></span><br><span class="line">    print &#39;Done! Time taken: &#123;&#125;&#39;.format(time.time() - start_time)</span><br><span class="line"></span><br><span class="line">def build_worker_pool(queue, size):</span><br><span class="line">    workers &#x3D; []</span><br><span class="line">    for _ in range(size):</span><br><span class="line">        worker &#x3D; Consumer(queue)</span><br><span class="line">        worker.start() </span><br><span class="line">        workers.append(worker)</span><br><span class="line">    return workers</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    Producer()</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç èƒ½æ­£ç¡®çš„è¿è¡Œï¼Œä½†ä»”ç»†çœ‹çœ‹æˆ‘ä»¬éœ€è¦åšäº›ä»€ä¹ˆï¼šæ„é€ ä¸åŒçš„æ–¹æ³•ã€è¿½è¸ªä¸€ç³»åˆ—çš„çº¿ç¨‹ï¼Œè¿˜æœ‰ä¸ºäº†è§£å†³æ¼äººçš„æ­»é”é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„ join æ“ä½œã€‚è¿™è¿˜åªæ˜¯å¼€å§‹â€¦â€¦<br>è‡³æ­¤æˆ‘ä»¬å›é¡¾äº†ç»å…¸çš„å¤šçº¿ç¨‹æ•™ç¨‹ï¼Œå¤šå°‘æœ‰äº›ç©ºæ´ä¸æ˜¯å—ï¼Ÿæ ·æ¿åŒ–è€Œä¸”æ˜“å‡ºé”™ï¼Œè¿™æ ·äº‹å€åŠŸåŠçš„é£æ ¼æ˜¾ç„¶ä¸é‚£ä¹ˆé€‚åˆæ—¥å¸¸ä½¿ç”¨ï¼Œå¥½åœ¨æˆ‘ä»¬è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚</p>
<h3 id="ä½•ä¸è¯•è¯•-map"><a href="#ä½•ä¸è¯•è¯•-map" class="headerlink" title="ä½•ä¸è¯•è¯• map"></a>ä½•ä¸è¯•è¯• map</h3><p>map è¿™ä¸€å°å·§ç²¾è‡´çš„å‡½æ•°æ˜¯ç®€æ·å®ç° Python ç¨‹åºå¹¶è¡ŒåŒ–çš„å…³é”®ã€‚map æºäº Lisp è¿™ç±»å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚å®ƒå¯ä»¥é€šè¿‡ä¸€ä¸ªåºåˆ—å®ç°ä¸¤ä¸ªå‡½æ•°ä¹‹é—´çš„æ˜ å°„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">urls &#x3D; [&#39;http:&#x2F;&#x2F;www.yahoo.com&#39;, &#39;http:&#x2F;&#x2F;www.reddit.com&#39;]</span><br><span class="line">results &#x3D; map(urllib2.urlopen, urls)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„è¿™ä¸¤è¡Œä»£ç å°†urlsè¿™ä¸€åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’åˆ°urlopenæ–¹æ³•ä¸­ï¼Œå¹¶å°†æ‰€æœ‰ç»“æœä¿å­˜åˆ°resultsè¿™ä¸€åˆ—è¡¨ä¸­ã€‚å…¶ç»“æœå¤§è‡´ç›¸å½“äºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">results &#x3D; []</span><br><span class="line">for url in urls: </span><br><span class="line">    results.append(urllib2.urlopen(url))</span><br></pre></td></tr></table></figure>
<p>map å‡½æ•°ä¸€æ‰‹åŒ…åŠäº†åºåˆ—æ“ä½œã€å‚æ•°ä¼ é€’å’Œç»“æœä¿å­˜ç­‰ä¸€ç³»åˆ—çš„æ“ä½œã€‚<br>ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå€ŸåŠ©æ­£ç¡®çš„åº“ï¼Œmapå¯ä»¥è½»æ¾å®ç°å¹¶è¡ŒåŒ–æ“ä½œã€‚<br><img src="https://mmbiz.qpic.cn/mmbiz_png/MQ4FoG1HmnIy074cLZKEl2OBicGelE08V6PYrOCazDyYtRWuqibrpXSUjTOeibBzy9icztOcR9Ptibf8xxpvp1KE21Q/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="map-image"></p>
<p>åœ¨ Python ä¸­æœ‰ä¸ªä¸¤ä¸ªåº“åŒ…å«äº† map å‡½æ•°ï¼š multiprocessing å’Œå®ƒé²œä¸ºäººçŸ¥çš„å­åº“ multiprocessing.dummy.</p>
<ol>
<li>æ‰¯ä¸¤å¥ï¼š multiprocessing.dummyï¼Ÿ mltiprocessing åº“çš„çº¿ç¨‹ç‰ˆå…‹éš†ï¼Ÿè¿™æ˜¯è™¾ç±³ï¼Ÿå³ä¾¿åœ¨ multiprocessing åº“çš„å®˜æ–¹æ–‡æ¡£é‡Œå…³äºè¿™ä¸€å­åº“ä¹Ÿåªæœ‰ä¸€å¥ç›¸å…³æè¿°ã€‚è€Œè¿™å¥æè¿°è¯‘æˆäººè¯åŸºæœ¬å°±æ˜¯è¯´:â€å˜›ï¼Œæœ‰è¿™ä¹ˆä¸ªä¸œè¥¿ï¼Œä½ çŸ¥é“å°±æˆ.â€ç›¸ä¿¡æˆ‘ï¼Œè¿™ä¸ªåº“è¢«ä¸¥é‡ä½ä¼°äº†ï¼</li>
<li>my æ˜¯ multiprocessing æ¨¡å—çš„å®Œæ•´å…‹éš†ï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äº multiprocessing ä½œç”¨äºè¿›ç¨‹ï¼Œè€Œ dummy æ¨¡å—ä½œç”¨äºçº¿ç¨‹ï¼ˆå› æ­¤ä¹ŸåŒ…æ‹¬äº† Python æ‰€æœ‰å¸¸è§çš„å¤šçº¿ç¨‹é™åˆ¶ï¼‰ã€‚ </li>
<li>æ¢ä½¿ç”¨è¿™ä¸¤ä¸ªåº“å¼‚å¸¸å®¹æ˜“ã€‚ä½ å¯ä»¥é’ˆå¯¹ IO å¯†é›†å‹ä»»åŠ¡å’Œ CPU å¯†é›†å‹ä»»åŠ¡æ¥é€‰æ‹©ä¸åŒçš„åº“ã€‚</li>
</ol>
<h3 id="å°è¯•"><a href="#å°è¯•" class="headerlink" title="å°è¯•"></a>å°è¯•</h3><p>ä½¿ç”¨ä¸‹é¢çš„ä¸¤è¡Œä»£ç æ¥å¼•ç”¨åŒ…å«å¹¶è¡ŒåŒ– map å‡½æ•°çš„åº“ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br><span class="line">from multiprocessing.dummy import Pool as ThreadPool</span><br></pre></td></tr></table></figure>
<p>å®ä¾‹åŒ–Poolå¯¹è±¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pool &#x3D; ThreadPool()</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡ç®€å•çš„è¯­å¥æ›¿ä»£äº† example2.py ä¸­ buildworkerpool å‡½æ•° 7 è¡Œä»£ç çš„å·¥ä½œã€‚å®ƒç”Ÿæˆäº†ä¸€ç³»åˆ—çš„ worker çº¿ç¨‹å¹¶å®Œæˆåˆå§‹åŒ–å·¥ä½œã€å°†å®ƒä»¬å‚¨å­˜åœ¨å˜é‡ä¸­ä»¥æ–¹ä¾¿è®¿é—®ã€‚</p>
<p>Pool å¯¹è±¡æœ‰ä¸€äº›å‚æ•°ï¼Œè¿™é‡Œæˆ‘æ‰€éœ€è¦å…³æ³¨çš„åªæ˜¯å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼šprocesses. è¿™ä¸€å‚æ•°ç”¨äºè®¾å®šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ã€‚å…¶é»˜è®¤å€¼ä¸ºå½“å‰æœºå™¨ CPU çš„æ ¸æ•°ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ CPU å¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œè°ƒç”¨è¶Šå¤šçš„æ ¸é€Ÿåº¦å°±è¶Šå¿«ã€‚ä½†æ˜¯å½“å¤„ç†ç½‘ç»œå¯†é›†å‹ä»»åŠ¡æ—¶ï¼Œäº‹æƒ…æœ‰æœ‰äº›éš¾ä»¥é¢„è®¡äº†ï¼Œé€šè¿‡å®éªŒæ¥ç¡®å®šçº¿ç¨‹æ± çš„å¤§å°æ‰æ˜¯æ˜æ™ºçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pool &#x3D; ThreadPool(4) # Sets the pool size to 4</span><br></pre></td></tr></table></figure>
<p>çº¿ç¨‹æ•°è¿‡å¤šæ—¶ï¼Œåˆ‡æ¢çº¿ç¨‹æ‰€æ¶ˆè€—çš„æ—¶é—´ç”šè‡³ä¼šè¶…è¿‡å®é™…å·¥ä½œæ—¶é—´ã€‚å¯¹äºä¸åŒçš„å·¥ä½œï¼Œé€šè¿‡å°è¯•æ¥æ‰¾åˆ°çº¿ç¨‹æ± å¤§å°çš„æœ€ä¼˜å€¼æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚<br>åˆ›å»ºå¥½ Pool å¯¹è±¡åï¼Œå¹¶è¡ŒåŒ–çš„ç¨‹åºä¾¿å‘¼ä¹‹æ¬²å‡ºäº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ”¹å†™åçš„<code>xample2.py</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import urllib2 </span><br><span class="line">from multiprocessing.dummy import Pool as ThreadPool </span><br><span class="line"></span><br><span class="line">urls &#x3D; [</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#39;, </span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;about&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.onlamp.com&#x2F;pub&#x2F;a&#x2F;python&#x2F;2003&#x2F;04&#x2F;17&#x2F;metaclasses.html&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;doc&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;download&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;getit&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;community&#x2F;&#39;,</span><br><span class="line">    &#39;https:&#x2F;&#x2F;wiki.python.org&#x2F;moin&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;planet.python.org&#x2F;&#39;,</span><br><span class="line">    &#39;https:&#x2F;&#x2F;wiki.python.org&#x2F;moin&#x2F;LocalUserGroups&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;psf&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;docs.python.org&#x2F;devguide&#x2F;&#39;,</span><br><span class="line">    &#39;http:&#x2F;&#x2F;www.python.org&#x2F;community&#x2F;awards&#x2F;&#39;</span><br><span class="line">    # etc.. </span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"># Make the Pool of workers</span><br><span class="line">pool &#x3D; ThreadPool(4) </span><br><span class="line"># Open the urls in their own threads</span><br><span class="line"># and return the results</span><br><span class="line">results &#x3D; pool.map(urllib2.urlopen, urls)</span><br><span class="line">#close the pool and wait for the work to finish </span><br><span class="line">pool.close() </span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>
<p>å®é™…èµ·ä½œç”¨çš„ä»£ç åªæœ‰4è¡Œï¼Œå…¶ä¸­åªæœ‰ä¸€è¡Œæ˜¯å…³é”®çš„ã€‚map å‡½æ•°è½»è€Œæ˜“ä¸¾çš„å–ä»£äº†å‰æ–‡ä¸­è¶…è¿‡ 40 è¡Œçš„ä¾‹å­ã€‚ä¸ºäº†æ›´æœ‰è¶£ä¸€äº›ï¼Œæˆ‘ç»Ÿè®¡äº†ä¸åŒæ–¹æ³•ã€ä¸åŒçº¿ç¨‹æ± å¤§å°çš„è€—æ—¶æƒ…å†µã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># results &#x3D; [] </span><br><span class="line"># for url in urls:</span><br><span class="line">#   result &#x3D; urllib2.urlopen(url)</span><br><span class="line">#   results.append(result)</span><br><span class="line"></span><br><span class="line"># # ------- VERSUS ------- # </span><br><span class="line"></span><br><span class="line"># # ------- 4 Pool ------- # </span><br><span class="line"># pool &#x3D; ThreadPool(4) </span><br><span class="line"># results &#x3D; pool.map(urllib2.urlopen, urls)</span><br><span class="line"></span><br><span class="line"># # ------- 8 Pool ------- # </span><br><span class="line"></span><br><span class="line"># pool &#x3D; ThreadPool(8) </span><br><span class="line"># results &#x3D; pool.map(urllib2.urlopen, urls)</span><br><span class="line"></span><br><span class="line"># # ------- 13 Pool ------- # </span><br><span class="line"></span><br><span class="line"># pool &#x3D; ThreadPool(13) </span><br><span class="line"># results &#x3D; pool.map(urllib2.urlopen, urls)</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#        Single thread:  14.4 Seconds </span><br><span class="line">#               4 Pool:   3.1 Seconds</span><br><span class="line">#               8 Pool:   1.4 Seconds</span><br><span class="line">#              13 Pool:   1.3 Seconds</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ£’çš„ç»“æœä¸æ˜¯å—ï¼Ÿè¿™ä¸€ç»“æœä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆè¦é€šè¿‡å®éªŒæ¥ç¡®å®šçº¿ç¨‹æ± çš„å¤§å°ã€‚åœ¨æˆ‘çš„æœºå™¨ä¸Šå½“çº¿ç¨‹æ± å¤§å°å¤§äº 9 å¸¦æ¥çš„æ”¶ç›Šå°±ååˆ†æœ‰é™äº†ã€‚</p>
<h3 id="å¦ä¸€ä¸ªçœŸå®çš„ä¾‹å­"><a href="#å¦ä¸€ä¸ªçœŸå®çš„ä¾‹å­" class="headerlink" title="å¦ä¸€ä¸ªçœŸå®çš„ä¾‹å­"></a>å¦ä¸€ä¸ªçœŸå®çš„ä¾‹å­</h3><p>ç”Ÿæˆä¸Šåƒå¼ å›¾ç‰‡çš„ç¼©ç•¥å›¾<br>è¿™æ˜¯ä¸€ä¸ª CPU å¯†é›†å‹çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ååˆ†é€‚åˆè¿›è¡Œå¹¶è¡ŒåŒ–ã€‚</p>
<h4 id="åŸºç¡€å•è¿›ç¨‹ç‰ˆæœ¬"><a href="#åŸºç¡€å•è¿›ç¨‹ç‰ˆæœ¬" class="headerlink" title="åŸºç¡€å•è¿›ç¨‹ç‰ˆæœ¬"></a>åŸºç¡€å•è¿›ç¨‹ç‰ˆæœ¬</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import os </span><br><span class="line">import PIL </span><br><span class="line"></span><br><span class="line">from multiprocessing import Pool </span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">SIZE &#x3D; (75,75)</span><br><span class="line">SAVE_DIRECTORY &#x3D; &#39;thumbs&#39;</span><br><span class="line"></span><br><span class="line">def get_image_paths(folder):</span><br><span class="line">    return (os.path.join(folder, f) </span><br><span class="line">            for f in os.listdir(folder) </span><br><span class="line">            if &#39;jpeg&#39; in f)</span><br><span class="line"></span><br><span class="line">def create_thumbnail(filename): </span><br><span class="line">    im &#x3D; Image.open(filename)</span><br><span class="line">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="line">    base, fname &#x3D; os.path.split(filename) </span><br><span class="line">    save_path &#x3D; os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="line">    im.save(save_path)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    folder &#x3D; os.path.abspath(</span><br><span class="line">        &#39;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&#39;)</span><br><span class="line">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="line"></span><br><span class="line">    images &#x3D; get_image_paths(folder)</span><br><span class="line"></span><br><span class="line">    for image in images:</span><br><span class="line">        create_thumbnail(Image)</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¾¹è¿™æ®µä»£ç çš„ä¸»è¦å·¥ä½œå°±æ˜¯å°†éå†ä¼ å…¥çš„æ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡æ–‡ä»¶ï¼Œä¸€ä¸€ç”Ÿæˆç¼©ç•¥å›¾ï¼Œå¹¶å°†è¿™äº›ç¼©ç•¥å›¾ä¿å­˜åˆ°ç‰¹å®šæ–‡ä»¶å¤¹ä¸­ã€‚<br>è¿™æˆ‘çš„æœºå™¨ä¸Šï¼Œç”¨è¿™ä¸€ç¨‹åºå¤„ç† 6000 å¼ å›¾ç‰‡éœ€è¦èŠ±è´¹ 27.9 ç§’ã€‚<br>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ map å‡½æ•°æ¥ä»£æ›¿ for å¾ªç¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import os </span><br><span class="line">import PIL </span><br><span class="line"></span><br><span class="line">from multiprocessing import Pool </span><br><span class="line">from PIL import Image</span><br><span class="line"></span><br><span class="line">SIZE &#x3D; (75,75)</span><br><span class="line">SAVE_DIRECTORY &#x3D; &#39;thumbs&#39;</span><br><span class="line"></span><br><span class="line">def get_image_paths(folder):</span><br><span class="line">    return (os.path.join(folder, f) </span><br><span class="line">            for f in os.listdir(folder) </span><br><span class="line">            if &#39;jpeg&#39; in f)</span><br><span class="line"></span><br><span class="line">def create_thumbnail(filename): </span><br><span class="line">    im &#x3D; Image.open(filename)</span><br><span class="line">    im.thumbnail(SIZE, Image.ANTIALIAS)</span><br><span class="line">    base, fname &#x3D; os.path.split(filename) </span><br><span class="line">    save_path &#x3D; os.path.join(base, SAVE_DIRECTORY, fname)</span><br><span class="line">    im.save(save_path)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    folder &#x3D; os.path.abspath(</span><br><span class="line">        &#39;11_18_2013_R000_IQM_Big_Sur_Mon__e10d1958e7b766c3e840&#39;)</span><br><span class="line">    os.mkdir(os.path.join(folder, SAVE_DIRECTORY))</span><br><span class="line"></span><br><span class="line">    images &#x3D; get_image_paths(folder)</span><br><span class="line"></span><br><span class="line">    pool &#x3D; Pool()</span><br><span class="line">    pool.map(creat_thumbnail, images)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br></pre></td></tr></table></figure>
<p>5.6 ç§’ï¼<br>è™½ç„¶åªæ”¹åŠ¨äº†å‡ è¡Œä»£ç ï¼Œæˆ‘ä»¬å´æ˜æ˜¾æé«˜äº†ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º CPU å¯†é›†å‹ä»»åŠ¡å’Œ IO å¯†é›†å‹ä»»åŠ¡åˆ†åˆ«é€‰æ‹©å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹åº“æ¥è¿›ä¸€æ­¥æé«˜æ‰§è¡Œé€Ÿåº¦â€”â€”è¿™ä¹Ÿæ˜¯è§£å†³æ­»é”é—®é¢˜çš„è‰¯æ–¹ã€‚æ­¤å¤–ï¼Œç”±äº map å‡½æ•°å¹¶ä¸æ”¯æŒæ‰‹åŠ¨çº¿ç¨‹ç®¡ç†ï¼Œåè€Œä½¿å¾—ç›¸å…³çš„ debug å·¥ä½œä¹Ÿå˜å¾—å¼‚å¸¸ç®€å•ã€‚<br>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®ç°äº†ï¼ˆåŸºæœ¬ï¼‰é€šè¿‡ä¸€è¡Œ Python å®ç°å¹¶è¡ŒåŒ–ã€‚</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://mp.weixin.qq.com/s/LMlq2BSUJwkF-xQ4UkgkUg" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§</title>
    <url>/2020/04/23/Python-%E5%B7%A5%E5%8C%A0%EF%BC%9A%E7%BC%96%E5%86%99%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E4%BB%A3%E7%A0%81%E7%9A%84%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="Python-å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§"><a href="#Python-å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§" class="headerlink" title="Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§"></a>Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§</h2><h3 id="ã€Python-å·¥åŒ ã€æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ã€Python-å·¥åŒ ã€æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ã€Python å·¥åŒ ã€æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ã€Python å·¥åŒ ã€æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ä¸€ç›´è§‰å¾—ç¼–ç¨‹æŸç§æ„ä¹‰ä¸Šæ˜¯ä¸€é—¨ã€æ‰‹è‰ºã€ï¼Œå› ä¸ºä¼˜é›…è€Œé«˜æ•ˆçš„ä»£ç ï¼Œå°±å¦‚åŒå®Œç¾çš„æ‰‹å·¥è‰ºå“ä¸€æ ·è®©äººèµå¿ƒæ‚¦ç›®ã€‚ åœ¨é›•ç¢ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤§å·¥ç¨‹ï¼šæ¯”å¦‚åº”è¯¥ç”¨ä»€ä¹ˆæ¶æ„ã€å“ªç§è®¾è®¡æ¨¡å¼ã€‚ä¹Ÿæœ‰æ›´å¤šçš„å°ç»†èŠ‚ï¼Œæ¯”å¦‚ä½•æ—¶ä½¿ç”¨å¼‚å¸¸ï¼ˆExceptionsï¼‰ã€æˆ–æ€ä¹ˆç»™å˜é‡èµ·åã€‚é‚£äº›çœŸæ­£ä¼˜ç§€çš„ä»£ç ï¼Œæ­£æ˜¯ç”±æ— æ•°ä¼˜ç§€çš„ç»†èŠ‚é€ å°±çš„ã€‚ ã€Python å·¥åŒ ã€è¿™ä¸ªç³»åˆ—æ–‡ç« ï¼Œæ˜¯æˆ‘çš„ä¸€æ¬¡å°å°å°è¯•ã€‚å®ƒä¸“æ³¨äºåˆ†äº« Python ç¼–ç¨‹ä¸­çš„ä¸€äº›åã€å°ã€çš„ä¸œè¥¿ã€‚å¸Œæœ›èƒ½å¤Ÿå¸®åˆ°æ¯ä¸€ä½ç¼–ç¨‹è·¯ä¸Šçš„åŒ äººã€‚</p>
<h3 id="åºè¨€"><a href="#åºè¨€" class="headerlink" title="åºè¨€"></a>åºè¨€</h3><p>ç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç æ˜¯ç¼–ç è¿‡ç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚ å¦‚æœç”¨é“è·¯æ¥åšæ¯”å–»ï¼Œç°å®ä¸–ç•Œä¸­çš„ä»£ç ä»æ¥éƒ½ä¸æ˜¯ä¸€æ¡ç¬”ç›´çš„é«˜é€Ÿå…¬è·¯ï¼Œè€Œæ›´åƒæ˜¯ç”±æ— æ•°ä¸ªå²”è·¯å£ç»„æˆçš„æŸä¸ªå¸‚åŒºåœ°å›¾ã€‚æˆ‘ä»¬ç¼–ç è€…å°±åƒæ˜¯é©¾é©¶å‘˜ï¼Œéœ€è¦å‘Šè¯‰æˆ‘ä»¬çš„ç¨‹åºï¼Œä¸‹ä¸ªè·¯å£éœ€è¦å¾€å·¦è¿˜æ˜¯å¾€å³ã€‚ ç¼–å†™ä¼˜ç§€çš„æ¡ä»¶åˆ†æ”¯ä»£ç éå¸¸é‡è¦ï¼Œå› ä¸ºç³Ÿç³•ã€å¤æ‚çš„åˆ†æ”¯å¤„ç†éå¸¸å®¹æ˜“è®©äººå›°æƒ‘ï¼Œä»è€Œé™ä½ä»£ç è´¨é‡ã€‚æ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« å°†ä¼šç§é‡ç‚¹è°ˆè°ˆåœ¨ Python ä¸­ç¼–å†™åˆ†æ”¯ä»£ç åº”è¯¥æ³¨æ„çš„åœ°æ–¹ã€‚</p>
<h3 id="Python-é‡Œçš„åˆ†æ”¯ä»£ç "><a href="#Python-é‡Œçš„åˆ†æ”¯ä»£ç " class="headerlink" title="Python é‡Œçš„åˆ†æ”¯ä»£ç "></a>Python é‡Œçš„åˆ†æ”¯ä»£ç </h3><p>Python æ”¯æŒæœ€ä¸ºå¸¸è§çš„ if/else æ¡ä»¶åˆ†æ”¯è¯­å¥ï¼Œä¸è¿‡å®ƒç¼ºå°‘åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­å¸¸è§çš„ switch/case è¯­å¥ã€‚ é™¤æ­¤ä¹‹å¤–ï¼ŒPython è¿˜ä¸º for/while å¾ªç¯ä»¥åŠ try/except è¯­å¥æä¾›äº† else åˆ†æ”¯ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œå®ƒä»¬å¯ä»¥å¤§æ˜¾èº«æ‰‹ã€‚ ä¸‹é¢æˆ‘ä¼šä» æœ€ä½³å®è·µã€å¸¸è§æŠ€å·§ã€å¸¸è§é™·é˜± ä¸‰ä¸ªæ–¹é¢è®²ä¸€ä¸‹å¦‚æœç¼–å†™ä¼˜ç§€çš„æ¡ä»¶åˆ†æ”¯ä»£ç ã€‚</p>
<h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h3><ol>
<li>é¿å…å¤šå±‚åˆ†æ”¯åµŒå¥—<br>å¦‚æœè¿™ç¯‡æ–‡ç« åªèƒ½åˆ å‡æˆä¸€å¥è¯å°±ç»“æŸï¼Œé‚£ä¹ˆé‚£å¥è¯ä¸€å®šæ˜¯â€œè¦ç«­å°½æ‰€èƒ½çš„é¿å…åˆ†æ”¯åµŒå¥—â€ã€‚ è¿‡æ·±çš„åˆ†æ”¯åµŒå¥—æ˜¯å¾ˆå¤šç¼–ç¨‹æ–°æ‰‹æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ä¹‹ä¸€ã€‚å‡å¦‚æœ‰ä¸€ä½æ–°æ‰‹ JavaScript ç¨‹åºå‘˜å†™äº†å¾ˆå¤šå±‚åˆ†æ”¯åµŒå¥—ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šçœ‹åˆ°ä¸€å±‚åˆä¸€å±‚çš„å¤§æ‹¬å·ï¼šif { if { if { â€¦ }}}ã€‚ä¿—ç§°â€œåµŒå¥— if åœ°ç‹±ï¼ˆNested If Statement Hellï¼‰â€ã€‚ ä½†æ˜¯å› ä¸º Python ä½¿ç”¨äº†ç¼©è¿›æ¥ä»£æ›¿ {}ï¼Œæ‰€ä»¥è¿‡æ·±çš„åµŒå¥—åˆ†æ”¯ä¼šäº§ç”Ÿæ¯”å…¶ä»–è¯­è¨€ä¸‹æ›´ä¸ºä¸¥é‡çš„åæœã€‚æ¯”å¦‚è¿‡å¤šçš„ç¼©è¿›å±‚æ¬¡å¾ˆå®¹æ˜“å°±ä¼šè®©ä»£ç è¶…è¿‡ PEP8 ä¸­è§„å®šçš„æ¯è¡Œå­—æ•°é™åˆ¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ®µä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def buy_fruit(nerd, store):</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;å»æ°´æœåº—ä¹°è‹¹æœ</span><br><span class="line"></span><br><span class="line">    - å…ˆå¾—çœ‹çœ‹åº—æ˜¯ä¸æ˜¯åœ¨è¥ä¸š</span><br><span class="line"></span><br><span class="line">    - å¦‚æœæœ‰è‹¹æœçš„è¯ï¼Œå°±ä¹° 1 ä¸ª</span><br><span class="line"></span><br><span class="line">    - å¦‚æœé’±ä¸å¤Ÿï¼Œå°±å›å®¶å–é’±å†æ¥</span><br><span class="line"></span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    if store.is_open():</span><br><span class="line">        if store.has_stocks(&quot;apple&quot;):</span><br><span class="line">            if nerd.can_afford(store.price(&quot;apple&quot;, amount&#x3D;1)):</span><br><span class="line">                nerd.buy(store, &quot;apple&quot;, amount&#x3D;1)</span><br><span class="line">                return</span><br><span class="line">            else:</span><br><span class="line">                nerd.go_home_and_get_money()</span><br><span class="line">                return buy_fruit(nerd, store)</span><br><span class="line">        else:</span><br><span class="line">            raise MadAtNoFruit(&quot;no apple in store!&quot;)</span><br><span class="line">    else:</span><br><span class="line">        raise MadAtNoFruit(&quot;store is closed!&quot;)</span><br></pre></td></tr></table></figure>
ä¸Šé¢è¿™æ®µä»£ç æœ€å¤§çš„é—®é¢˜ï¼Œå°±æ˜¯è¿‡äºç›´æ¥ç¿»è¯‘äº†åŸå§‹çš„æ¡ä»¶åˆ†æ”¯è¦æ±‚ï¼Œå¯¼è‡´çŸ­çŸ­åå‡ è¡Œä»£ç åŒ…å«äº†æœ‰ä¸‰å±‚åµŒå¥—åˆ†æ”¯ã€‚ è¿™æ ·çš„ä»£ç å¯è¯»æ€§å’Œç»´æŠ¤æ€§éƒ½å¾ˆå·®ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå¾ˆç®€å•çš„æŠ€å·§ï¼šâ€æå‰ç»“æŸâ€æ¥ä¼˜åŒ–è¿™æ®µä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def buy_fruit(nerd, store):</span><br><span class="line"></span><br><span class="line">    if not store.is_open():</span><br><span class="line">        raise MadAtNoFruit(&quot;store is closed!&quot;)</span><br><span class="line">    if not store.has_stocks(&quot;apple&quot;):</span><br><span class="line">        raise MadAtNoFruit(&quot;no apple in store!&quot;)</span><br><span class="line">    if nerd.can_afford(store.price(&quot;apple&quot;, amount&#x3D;1)):</span><br><span class="line">        nerd.buy(store, &quot;apple&quot;, amount&#x3D;1)</span><br><span class="line">        return</span><br><span class="line">    else:</span><br><span class="line">        nerd.go_home_and_get_money()</span><br><span class="line">        return buy_fruit(nerd, store)</span><br></pre></td></tr></table></figure>
â€œæå‰ç»“æŸâ€æŒ‡ï¼šåœ¨å‡½æ•°å†…ä½¿ç”¨ return æˆ– raise ç­‰è¯­å¥æå‰åœ¨åˆ†æ”¯å†…ç»“æŸå‡½æ•°ã€‚æ¯”å¦‚ï¼Œåœ¨æ–°çš„ buy_fruit å‡½æ•°é‡Œï¼Œå½“åˆ†æ”¯æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œç»“æŸè¿™æ®µè¿™ä»£ç åˆ†æ”¯ã€‚è¿™æ ·çš„ä»£ç æ²¡æœ‰åµŒå¥—åˆ†æ”¯ï¼Œæ›´ç›´æ¥ä¹Ÿæ›´æ˜“è¯»ã€‚</li>
<li>å°è£…é‚£äº›è¿‡äºå¤æ‚çš„é€»è¾‘åˆ¤æ–­<br>å¦‚æœæ¡ä»¶åˆ†æ”¯é‡Œçš„è¡¨è¾¾å¼è¿‡äºå¤æ‚ï¼Œå‡ºç°äº†å¤ªå¤šçš„ not/and/orï¼Œé‚£ä¹ˆè¿™æ®µä»£ç çš„å¯è¯»æ€§å°±ä¼šå¤§æ‰“æŠ˜æ‰£ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¦‚æœæ´»åŠ¨è¿˜åœ¨å¼€æ”¾ï¼Œå¹¶ä¸”æ´»åŠ¨å‰©ä½™åé¢å¤§äº 10ï¼Œä¸ºæ‰€æœ‰æ€§åˆ«ä¸ºå¥³æ€§ï¼Œæˆ–è€…çº§åˆ«å¤§äº 3</span><br><span class="line"></span><br><span class="line"># çš„æ´»è·ƒç”¨æˆ·å‘æ”¾ 10000 ä¸ªé‡‘å¸</span><br><span class="line"></span><br><span class="line">if activity.is_active and activity.remaining &gt; 10 and \</span><br><span class="line"></span><br><span class="line">        user.is_active and (user.sex &#x3D;&#x3D; &#39;female&#39; or user.level &gt; 3):</span><br><span class="line"></span><br><span class="line">    user.add_coins(10000)</span><br><span class="line"></span><br><span class="line">    return</span><br></pre></td></tr></table></figure>
å¯¹äºè¿™æ ·çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†å…·ä½“çš„åˆ†æ”¯é€»è¾‘å°è£…æˆå‡½æ•°æˆ–è€…æ–¹æ³•ï¼Œæ¥è¾¾åˆ°ç®€åŒ–ä»£ç çš„ç›®çš„ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if activity.allow_new_user() and user.match_activity_condition():</span><br><span class="line">    user.add_coins(10000)</span><br><span class="line">    return</span><br></pre></td></tr></table></figure>
äº‹å®ä¸Šï¼Œå°†ä»£ç æ”¹å†™åï¼Œä¹‹å‰çš„æ³¨é‡Šæ–‡å­—å…¶å®ä¹Ÿå¯ä»¥å»æ‰äº†ã€‚å› ä¸ºåé¢è¿™æ®µä»£ç å·²ç»è¾¾åˆ°äº†è‡ªè¯´æ˜çš„ç›®çš„ã€‚è‡³äºå…·ä½“çš„ ä»€ä¹ˆæ ·çš„ç”¨æˆ·æ»¡è¶³æ´»åŠ¨æ¡ä»¶ï¼Ÿ è¿™ç§é—®é¢˜ï¼Œå°±åº”ç”±å…·ä½“çš„<code>match_activity_condition()</code>æ–¹æ³•æ¥å›ç­”äº†ã€‚<blockquote>
<p>Hint: æ°å½“çš„å°è£…ä¸å…‰ç›´æ¥æ”¹å–„äº†ä»£ç çš„å¯è¯»æ€§ï¼Œäº‹å®ä¸Šï¼Œå¦‚æœä¸Šé¢çš„æ´»åŠ¨åˆ¤æ–­é€»è¾‘åœ¨ä»£ç ä¸­å‡ºç°äº†ä¸æ­¢ä¸€æ¬¡çš„è¯ï¼Œå°è£…æ›´æ˜¯å¿…é¡»çš„ã€‚ä¸ç„¶é‡å¤ä»£ç ä¼šæå¤§çš„ç ´åè¿™æ®µé€»è¾‘çš„å¯ç»´æŠ¤æ€§ã€‚</p>
</blockquote>
</li>
<li>ç•™æ„ä¸åŒåˆ†æ”¯ä¸‹çš„é‡å¤ä»£ç <br>é‡å¤ä»£ç æ˜¯ä»£ç è´¨é‡çš„å¤©æ•Œï¼Œè€Œæ¡ä»¶åˆ†æ”¯è¯­å¥åˆéå¸¸å®¹æ˜“æˆä¸ºé‡å¤ä»£ç çš„é‡ç¾åŒºã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬ç¼–å†™æ¡ä»¶åˆ†æ”¯è¯­å¥æ—¶ï¼Œéœ€è¦ç‰¹åˆ«ç•™æ„ï¼Œä¸è¦ç”Ÿäº§ä¸å¿…è¦çš„é‡å¤ä»£ç ã€‚ è®©æˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¯¹äºæ–°ç”¨æˆ·ï¼Œåˆ›å»ºæ–°çš„ç”¨æˆ·èµ„æ–™ï¼Œå¦åˆ™æ›´æ–°æ—§èµ„æ–™</span><br><span class="line"></span><br><span class="line">if user.no_profile_exists:</span><br><span class="line">    create_user_profile(</span><br><span class="line">        username&#x3D;user.username,</span><br><span class="line">        email&#x3D;user.email,</span><br><span class="line">        age&#x3D;user.age,</span><br><span class="line">        address&#x3D;user.address,</span><br><span class="line">        # å¯¹äºæ–°å»ºç”¨æˆ·ï¼Œå°†ç”¨æˆ·çš„ç§¯åˆ†ç½®ä¸º 0</span><br><span class="line">        points&#x3D;0,</span><br><span class="line">        created&#x3D;now(),</span><br><span class="line">    )</span><br><span class="line">else:</span><br><span class="line">    update_user_profile(</span><br><span class="line">        username&#x3D;user.username,</span><br><span class="line">        email&#x3D;user.email,</span><br><span class="line">        age&#x3D;user.age,</span><br><span class="line">        address&#x3D;user.address,</span><br><span class="line">        updated&#x3D;now(),</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€çœ¼çœ‹å‡ºï¼Œåœ¨ä¸åŒçš„åˆ†æ”¯ä¸‹ï¼Œç¨‹åºè°ƒç”¨äº†ä¸åŒçš„å‡½æ•°ï¼Œåšäº†ä¸ä¸€æ ·çš„äº‹æƒ…ã€‚ä½†æ˜¯ï¼Œå› ä¸ºé‚£äº›é‡å¤ä»£ç çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å´å¾ˆéš¾ç®€å•çš„åŒºåˆ†å‡ºï¼ŒäºŒè€…çš„ä¸åŒç‚¹åˆ°åº•åœ¨å“ªã€‚ å…¶å®ï¼Œå¾—ç›Šäº Python çš„åŠ¨æ€ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•çš„æ”¹å†™ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œè®©å¯è¯»æ€§å¯ä»¥å¾—åˆ°æ˜¾è‘—çš„æå‡ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if user.no_profile_exists:</span><br><span class="line">    profile_func &#x3D; create_user_profile</span><br><span class="line">    extra_args &#x3D; &#123;&#39;points&#39;: 0, &#39;created&#39;: now()&#125;</span><br><span class="line">else:</span><br><span class="line">    profile_func &#x3D; update_user_profile</span><br><span class="line">    extra_args &#x3D; &#123;&#39;updated&#39;: now()&#125;</span><br><span class="line"></span><br><span class="line">profile_func(</span><br><span class="line">    username&#x3D;user.username,</span><br><span class="line">    email&#x3D;user.email,</span><br><span class="line">    age&#x3D;user.age,</span><br><span class="line">    address&#x3D;user.address,</span><br><span class="line">    **extra_args</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
å½“ä½ ç¼–å†™åˆ†æ”¯ä»£ç æ—¶ï¼Œè¯·é¢å¤–å…³æ³¨ç”±åˆ†æ”¯äº§ç”Ÿçš„é‡å¤ä»£ç å—ï¼Œå¦‚æœå¯ä»¥ç®€å•çš„æ¶ˆç­å®ƒä»¬ï¼Œé‚£å°±ä¸è¦è¿Ÿç–‘ã€‚</li>
<li>è°¨æ…ä½¿ç”¨ä¸‰å…ƒè¡¨è¾¾å¼<br>ä¸‰å…ƒè¡¨è¾¾å¼æ˜¯ Python 2.5 ç‰ˆæœ¬åæ‰æ”¯æŒçš„è¯­æ³•ã€‚åœ¨é‚£ä¹‹å‰ï¼ŒPython ç¤¾åŒºä¸€åº¦è®¤ä¸ºä¸‰å…ƒè¡¨è¾¾å¼æ²¡æœ‰å¿…è¦ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ x and a or b çš„æ–¹å¼æ¥æ¨¡æ‹Ÿå®ƒã€‚[æ³¨] äº‹å®æ˜¯ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½¿ç”¨æ™®é€šçš„ if/else è¯­å¥çš„ä»£ç å¯è¯»æ€§ç¡®å®æ›´å¥½ã€‚ç›²ç›®è¿½æ±‚ä¸‰å…ƒè¡¨è¾¾å¼å¾ˆå®¹æ˜“è¯±æƒ‘ä½ å†™å‡ºå¤æ‚ã€å¯è¯»æ€§å·®çš„ä»£ç ã€‚ æ‰€ä»¥ï¼Œè¯·è®°å¾—åªç”¨ä¸‰å…ƒè¡¨è¾¾å¼å¤„ç†ç®€å•çš„é€»è¾‘åˆ†æ”¯ã€‚<blockquote>
<p>language = â€œpythonâ€ if you.favor(â€œdynamicâ€) else â€œgolangâ€<br>å¯¹äºç»å¤§å¤šæ•°æƒ…å†µï¼Œè¿˜æ˜¯ä½¿ç”¨æ™®é€šçš„ if/else è¯­å¥å§ã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="å¸¸è§æŠ€å·§"><a href="#å¸¸è§æŠ€å·§" class="headerlink" title="å¸¸è§æŠ€å·§"></a>å¸¸è§æŠ€å·§</h3><ol>
<li>ä½¿ç”¨â€å¾·æ‘©æ ¹å®šå¾‹â€<br>åœ¨åšåˆ†æ”¯åˆ¤æ–­æ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šå†™æˆè¿™æ ·çš„ä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•æˆ–è€…ç”¨æˆ·æ²¡æœ‰ä½¿ç”¨ chromeï¼Œæ‹’ç»æä¾›æœåŠ¡</span><br><span class="line">if not user.has_logged_in or not user.is_from_chrome:</span><br><span class="line">    return &quot;our service is only available for chrome logged in user&quot;</span><br></pre></td></tr></table></figure>
ç¬¬ä¸€çœ¼çœ‹åˆ°ä»£ç æ—¶ï¼Œæ˜¯ä¸æ˜¯éœ€è¦æ€è€ƒä¸€ä¼šæ‰èƒ½ç†è§£å®ƒæƒ³å¹²å˜›ï¼Ÿè¿™æ˜¯å› ä¸ºä¸Šé¢çš„é€»è¾‘è¡¨è¾¾å¼é‡Œé¢å‡ºç°äº†2ä¸ªnotå’Œ1ä¸ªorã€‚è€Œæˆ‘ä»¬äººç±»æ°å¥½ä¸æ“…é•¿å¤„ç†è¿‡å¤šçš„â€œå¦å®šâ€ä»¥åŠâ€œæˆ–â€è¿™ç§é€»è¾‘å…³ç³»ã€‚ è¿™ä¸ªæ—¶å€™ï¼Œå°±è¯¥ å¾·æ‘©æ ¹å®šå¾‹ å‡ºåœºäº†ã€‚é€šä¿—çš„è¯´ï¼Œå¾·æ‘©æ ¹å®šå¾‹å°±æ˜¯<code>not A or not B</code>ç­‰ä»·äº<code>not (A and B)</code>é€šè¿‡è¿™æ ·çš„è½¬æ¢ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥æ”¹å†™æˆè¿™æ ·ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if not (user.has_logged_in and user.is_from_chrome):</span><br><span class="line">    return &quot;our service is only open for chrome logged in user&quot;</span><br></pre></td></tr></table></figure>
æ€ä¹ˆæ ·ï¼Œä»£ç æ˜¯ä¸æ˜¯æ˜“è¯»äº†å¾ˆå¤šï¼Ÿè®°ä½å¾·æ‘©æ ¹å®šå¾‹ï¼Œå¾ˆå¤šæ—¶å€™å®ƒå¯¹äºç®€åŒ–æ¡ä»¶åˆ†æ”¯é‡Œçš„ä»£ç é€»è¾‘éå¸¸æœ‰ç”¨ã€‚</li>
<li>è‡ªå®šä¹‰å¯¹è±¡çš„â€å¸ƒå°”çœŸå‡â€<br>æˆ‘ä»¬å¸¸è¯´ï¼Œåœ¨ Python é‡Œï¼Œâ€ä¸‡ç‰©çš†å¯¹è±¡â€ã€‚å…¶å®ï¼Œä¸å…‰â€ä¸‡ç‰©çš†å¯¹è±¡â€ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨å¾ˆå¤šé­”æ³•æ–¹æ³•ï¼ˆæ–‡æ¡£ä¸­ç§°ä¸ºï¼šuser-defined methodï¼‰ï¼Œæ¥è‡ªå®šä¹‰å¯¹è±¡çš„å„ç§è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥ç”¨å¾ˆå¤šåœ¨åˆ«çš„è¯­è¨€é‡Œé¢æ— æ³•åšåˆ°ã€æœ‰äº›é­”æ³•çš„æ–¹å¼æ¥å½±å“ä»£ç çš„æ‰§è¡Œã€‚ æ¯”å¦‚ï¼ŒPythonçš„æ‰€æœ‰å¯¹è±¡éƒ½æœ‰è‡ªå·±çš„â€å¸ƒå°”çœŸå‡â€ï¼š</li>
</ol>
<ul>
<li>å¸ƒå°”å€¼ä¸ºå‡çš„å¯¹è±¡ï¼šNone, 0, False, [], (), {}, set(), frozenset(), â€¦ â€¦</li>
<li>å¸ƒå°”å€¼ä¸ºçœŸçš„å¯¹è±¡ï¼šé 0 çš„æ•°å€¼ã€Trueï¼Œéç©ºçš„åºåˆ—ã€å…ƒç»„ï¼Œæ™®é€šçš„ç”¨æˆ·ç±»å®ä¾‹ï¼Œâ€¦ â€¦<br>é€šè¿‡å†…å»ºå‡½æ•° bool()ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„æŸ¥çœ‹æŸä¸ªå¯¹è±¡çš„å¸ƒå°”çœŸå‡ã€‚è€Œ Python è¿›è¡Œæ¡ä»¶åˆ†æ”¯åˆ¤æ–­æ—¶ç”¨åˆ°çš„ä¹Ÿæ˜¯è¿™ä¸ªå€¼ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bool(object())</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
é‡ç‚¹æ¥äº†ï¼Œè™½ç„¶æ‰€æœ‰ç”¨æˆ·ç±»å®ä¾‹çš„å¸ƒå°”å€¼éƒ½æ˜¯çœŸã€‚ä½†æ˜¯ Python æä¾›äº†æ”¹å˜è¿™ä¸ªè¡Œä¸ºçš„åŠæ³•ï¼šè‡ªå®šä¹‰ç±»çš„<code>__bool__</code>é­”æ³•æ–¹æ³• ï¼ˆåœ¨ Python 2.X ç‰ˆæœ¬ä¸­ä¸º <strong>nonzero</strong>ï¼‰ã€‚å½“ç±»å®šä¹‰äº†<code>__bool__</code>æ–¹æ³•åï¼Œå®ƒçš„è¿”å›å€¼å°†ä¼šè¢«å½“ä½œç±»å®ä¾‹çš„å¸ƒå°”å€¼ã€‚ å¦å¤–ï¼Œ<code>__bool__</code>ä¸æ˜¯å½±å“å®ä¾‹å¸ƒå°”çœŸå‡çš„å”¯ä¸€æ–¹æ³•ã€‚å¦‚æœç±»æ²¡æœ‰å®šä¹‰<code>__bool__</code>æ–¹æ³•ï¼ŒPython è¿˜ä¼šå°è¯•è°ƒç”¨<code>__len__</code>æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯å¯¹ä»»ä½•åºåˆ—å¯¹è±¡è°ƒç”¨ len å‡½æ•°ï¼‰ï¼Œé€šè¿‡ç»“æœæ˜¯å¦ä¸º 0 åˆ¤æ–­å®ä¾‹çœŸå‡ã€‚ é‚£ä¹ˆè¿™ä¸ªç‰¹æ€§æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿçœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class UserCollection(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, users):</span><br><span class="line">        self._users &#x3D; users</span><br><span class="line"></span><br><span class="line">users &#x3D; UserCollection([piglei, raymond])</span><br><span class="line">if len(users._users) &gt; 0:</span><br><span class="line">    print(&quot;There&#39;s some users in collection!&quot;)</span><br></pre></td></tr></table></figure>
ä¸Šé¢çš„ä»£ç é‡Œï¼Œåˆ¤æ–­<code>UserCollection</code>æ˜¯å¦æœ‰å†…å®¹æ—¶ç”¨åˆ°äº†<code>users._users</code>çš„é•¿åº¦ã€‚å…¶å®ï¼Œé€šè¿‡ä¸º UserCollection æ·»åŠ <code>__len__</code>é­”æ³•æ–¹æ³•ï¼Œä¸Šé¢çš„åˆ†æ”¯å¯ä»¥å˜å¾—æ›´ç®€å•ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class UserCollection:</span><br><span class="line"></span><br><span class="line">    def __init__(self, users):</span><br><span class="line">        self._users &#x3D; users</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        return len(self._users)</span><br><span class="line"></span><br><span class="line">users &#x3D; UserCollection([piglei, raymond])</span><br><span class="line"></span><br><span class="line"># å®šä¹‰äº† __len__ æ–¹æ³•åï¼ŒUserCollection å¯¹è±¡æœ¬èº«å°±å¯ä»¥è¢«ç”¨äºå¸ƒå°”åˆ¤æ–­äº†</span><br><span class="line">if users:</span><br><span class="line">    print(&quot;There&#39;s some users in collection!&quot;)</span><br></pre></td></tr></table></figure>
é€šè¿‡å®šä¹‰é­”æ³•æ–¹æ³•<code>__len__</code>å’Œ<code>__bool__</code>ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç±»è‡ªå·±æ§åˆ¶æƒ³è¦è¡¨ç°å‡ºçš„å¸ƒå°”çœŸå‡å€¼ï¼Œè®©ä»£ç å˜å¾—æ›´pythonicã€‚</li>
</ul>
<ol start="3">
<li>åœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨ <code>all()/any()</code><br>all() å’Œ any() ä¸¤ä¸ªå‡½æ•°éå¸¸é€‚åˆåœ¨æ¡ä»¶åˆ¤æ–­ä¸­ä½¿ç”¨ã€‚è¿™ä¸¤ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå…¶ä¸­ï¼š</li>
</ol>
<ul>
<li>all(seq)ï¼šä»…å½“ seq ä¸­æ‰€æœ‰å¯¹è±¡éƒ½ä¸ºå¸ƒå°”çœŸæ—¶è¿”å› Trueï¼Œå¦åˆ™è¿”å› False</li>
<li>any(seq)ï¼šåªè¦ seq ä¸­ä»»ä½•ä¸€ä¸ªå¯¹è±¡ä¸ºå¸ƒå°”çœŸå°±è¿”å› Trueï¼Œå¦åˆ™è¿”å› False<br>å‡å¦‚æˆ‘ä»¬æœ‰ä¸‹é¢è¿™æ®µä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def all_numbers_gt_10(numbers):</span><br><span class="line">    &quot;&quot;&quot;ä»…å½“åºåˆ—ä¸­æ‰€æœ‰æ•°å­—å¤§äº 10 æ—¶ï¼Œè¿”å› True</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if not numbers:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    for n in numbers:</span><br><span class="line">        if n &lt;&#x3D; 10:</span><br><span class="line">            return False</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>
å¦‚æœä½¿ç”¨<code>all()</code>å†…å»ºå‡½æ•°ï¼Œå†é…åˆä¸€ä¸ªç®€å•çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œä¸Šé¢çš„ä»£ç å¯ä»¥å†™æˆè¿™æ ·ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def all_numbers_gt_10_2(numbers):</span><br><span class="line">    return bool(numbers) and all(n &gt; 10 for n in numbers)</span><br></pre></td></tr></table></figure>
ç®€å•ã€é«˜æ•ˆï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰æŸå¤±å¯ç”¨æ€§ã€‚</li>
</ul>
<ol start="4">
<li>ä½¿ç”¨ try/while/for ä¸­ else åˆ†æ”¯<br>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡½æ•°ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def do_stuff():</span><br><span class="line">    first_thing_successed &#x3D; False</span><br><span class="line">    try:</span><br><span class="line">        do_the_first_thing()</span><br><span class="line">        first_thing_successed &#x3D; True</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;Error while calling do_some_thing&quot;)</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line">    # ä»…å½“ first_thing æˆåŠŸå®Œæˆæ—¶ï¼Œåšç¬¬äºŒä»¶äº‹</span><br><span class="line">    if first_thing_successed:</span><br><span class="line">        return do_the_second_thing()</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>åœ¨å‡½æ•° do_stuff ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›åªæœ‰å½“<code>do_the_first_thing()</code>æˆåŠŸè°ƒç”¨åï¼ˆä¹Ÿå°±æ˜¯ä¸æŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼‰ï¼Œæ‰ç»§ç»­åšç¬¬äºŒä¸ªå‡½æ•°è°ƒç”¨ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªé¢å¤–çš„å˜é‡<code>first_thing_successed</code>æ¥ä½œä¸ºæ ‡è®°ã€‚ å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ›´ç®€å•çš„æ–¹æ³•è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def do_stuff():</span><br><span class="line">    try:</span><br><span class="line">        do_the_first_thing()</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;Error while calling do_some_thing&quot;)</span><br><span class="line">        return</span><br><span class="line">    else:</span><br><span class="line">        return do_the_second_thing()</span><br></pre></td></tr></table></figure>
<p>åœ¨ try è¯­å¥å—æœ€åè¿½åŠ ä¸Š else åˆ†æ”¯åï¼Œåˆ†æ”¯ä¸‹çš„<code>do_the_second_thing()</code>ä¾¿åªä¼šåœ¨ try ä¸‹é¢çš„æ‰€æœ‰è¯­å¥æ­£å¸¸æ‰§è¡Œï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰ returnã€break ç­‰ï¼‰å®Œæˆåæ‰§è¡Œã€‚ ç±»ä¼¼çš„ï¼ŒPython é‡Œçš„ for/while å¾ªç¯ä¹Ÿæ”¯æŒæ·»åŠ  else åˆ†æ”¯ï¼Œå®ƒä»¬è¡¨ç¤ºï¼šå½“å¾ªç¯ä½¿ç”¨çš„è¿­ä»£å¯¹è±¡è¢«æ­£å¸¸è€—å°½ã€æˆ– while å¾ªç¯ä½¿ç”¨çš„æ¡ä»¶å˜é‡å˜ä¸º False åæ‰æ‰§è¡Œ else åˆ†æ”¯ä¸‹çš„ä»£ç ã€‚</p>
<h3 id="å¸¸è§é™·é˜±"><a href="#å¸¸è§é™·é˜±" class="headerlink" title="å¸¸è§é™·é˜±"></a>å¸¸è§é™·é˜±</h3><ol>
<li>ä¸ None å€¼çš„æ¯”è¾ƒ<br>åœ¨ Python ä¸­ï¼Œæœ‰ä¸¤ç§æ¯”è¾ƒå˜é‡çš„æ–¹æ³•ï¼š== å’Œ isï¼ŒäºŒè€…åœ¨å«ä¹‰ä¸Šæœ‰ç€æ ¹æœ¬çš„åŒºåˆ«ï¼š</li>
</ol>
<ul>
<li>==ï¼šè¡¨ç¤ºäºŒè€…æ‰€æŒ‡å‘çš„çš„å€¼æ˜¯å¦ä¸€è‡´</li>
<li>isï¼šè¡¨ç¤ºäºŒè€…æ˜¯å¦æŒ‡å‘å†…å­˜ä¸­çš„åŒä¸€ä»½å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ id(x) æ˜¯å¦ç­‰äº id(y)<br>None åœ¨ Python è¯­è¨€ä¸­æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œå¦‚æœä½ è¦åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦ä¸º None æ—¶ï¼Œè®°å¾—ä½¿ç”¨ is è€Œä¸æ˜¯ ==ï¼Œå› ä¸ºåªæœ‰ is æ‰èƒ½åœ¨ä¸¥æ ¼æ„ä¹‰ä¸Šè¡¨ç¤ºæŸä¸ªå˜é‡æ˜¯å¦æ˜¯ Noneã€‚ å¦åˆ™ï¼Œå¯èƒ½å‡ºç°ä¸‹é¢è¿™æ ·çš„æƒ…å†µï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; class Foo(object):</span><br><span class="line">...     def __eq__(self, other):</span><br><span class="line">...         return True</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; foo &#x3D; Foo()</span><br><span class="line">&gt;&gt;&gt; foo &#x3D;&#x3D; None</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
åœ¨ä¸Šé¢ä»£ç ä¸­ï¼ŒFoo è¿™ä¸ªç±»é€šè¿‡è‡ªå®šä¹‰<code>__eq__</code>é­”æ³•æ–¹æ³•çš„æ–¹å¼ï¼Œå¾ˆå®¹æ˜“å°±æ»¡è¶³äº†<code>== None</code>è¿™ä¸ªæ¡ä»¶ã€‚ æ‰€ä»¥ï¼Œå½“ä½ è¦åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¦ä¸º None æ—¶ï¼Œè¯·ä½¿ç”¨ is è€Œä¸æ˜¯ ==ã€‚</li>
</ul>
<ol start="2">
<li>ç•™æ„ and å’Œ or çš„è¿ç®—ä¼˜å…ˆçº§<br>çœ‹çœ‹ä¸‹é¢è¿™ä¸¤ä¸ªè¡¨è¾¾å¼ï¼ŒçŒœçŒœå®ƒä»¬çš„å€¼ä¸€æ ·å—ï¼Ÿ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; (True or False) and False</span><br><span class="line">&gt;&gt;&gt; True or False and False</span><br></pre></td></tr></table></figure>
ç­”æ¡ˆæ˜¯ï¼šä¸ä¸€æ ·ï¼Œå®ƒä»¬çš„å€¼åˆ†åˆ«æ˜¯ False å’Œ Trueï¼Œä½ çŒœå¯¹äº†å—ï¼Ÿ é—®é¢˜çš„å…³é”®åœ¨äºï¼šand è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§å¤§äº orã€‚å› æ­¤ä¸Šé¢çš„ç¬¬äºŒä¸ªè¡¨è¾¾å¼åœ¨ Python çœ‹æ¥å®é™…ä¸Šæ˜¯ True or (False and False)ã€‚æ‰€ä»¥ç»“æœæ˜¯ True è€Œä¸æ˜¯ Falseã€‚ åœ¨ç¼–å†™åŒ…å«å¤šä¸ª and å’Œ or çš„è¡¨è¾¾å¼æ—¶ï¼Œè¯·é¢å¤–æ³¨æ„ and å’Œ or çš„è¿ç®—ä¼˜å…ˆçº§ã€‚å³ä½¿æ‰§è¡Œä¼˜å…ˆçº§æ­£å¥½æ˜¯ä½ éœ€è¦çš„é‚£æ ·ï¼Œä½ ä¹Ÿå¯ä»¥åŠ ä¸Šé¢å¤–çš„æ‹¬å·æ¥è®©ä»£ç æ›´æ¸…æ™°ã€‚</li>
</ol>
<h3 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h3><p>ä»¥ä¸Šå°±æ˜¯ã€Python å·¥åŒ ã€ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ã€‚ä¸çŸ¥é“æ–‡ç« çš„å†…å®¹æ˜¯å¦å¯¹ä½ çš„èƒƒå£ã€‚ ä»£ç å†…çš„åˆ†æ”¯è¯­å¥ä¸å¯é¿å…ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œéœ€è¦å°¤å…¶æ³¨æ„å®ƒçš„å¯è¯»æ€§ï¼Œé¿å…å¯¹å…¶ä»–çœ‹åˆ°ä»£ç çš„äººé€ æˆå›°æ‰°ã€‚</p>
<h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p>äº‹å®ä¸Š<code>x and a or b</code>ä¸æ˜¯æ€»èƒ½ç»™ä½ æ­£ç¡®çš„ç»“æœï¼Œåªæœ‰å½“ a ä¸ b çš„å¸ƒå°”å€¼ä¸ºçœŸæ—¶ï¼Œè¿™ä¸ªè¡¨è¾¾å¼æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œè¿™æ˜¯ç”±é€»è¾‘è¿ç®—çš„çŸ­è·¯ç‰¹æ€§å†³å®šçš„ã€‚ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ<code>True and None or 0</code>è¯•è¯•çœ‹ï¼Œç»“æœæ˜¯0è€Œé Noneã€‚</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://python.jobbole.com/89060/" target="_blank" rel="noopener">Python å·¥åŒ ï¼šç¼–å†™æ¡ä»¶åˆ†æ”¯ä»£ç çš„æŠ€å·§</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonæŠ€æœ¯è¿›é˜¶</title>
    <url>/2020/04/23/Python%E6%8A%80%E6%9C%AF%E8%BF%9B%E9%98%B6/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ</title>
    <url>/2020/04/23/Python%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E5%AD%97%E5%85%B8%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E5%AD%97%E5%85%B8%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<h2 id="Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ"><a href="#Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ" class="headerlink" title="Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ"></a>Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ</h2><p>ä¸¤ä¸ªå­—å…¸å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d1 &#x3D; &#123;&#39;name&#39; : &#39;revotu&#39;, &#39;age&#39; : 99&#125;</span><br><span class="line">&gt;&gt;&gt; d2 &#x3D; &#123;&#39;age&#39; : 24, &#39;sex&#39; : &#39;male&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶åçš„ç»“æœå¦‚ä¸‹ï¼ˆå³ï¼Œkeyç›¸åŒæ—¶åé¢å­—å…¸å€¼è¦†ç›–å‰é¢å­—å…¸ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#39;sex&#39;: &#39;male&#39;, &#39;name&#39;: &#39;revotu&#39;, &#39;age&#39;: 24&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œè¯´æ˜å­—å…¸å¹¶ä¸æ”¯æŒ+åŠ æ³•è¿ç®—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d1 + d2</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand type(s) for +: &#39;dict&#39; and &#39;dict&#39;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>ç°æ€»ç»“å¦‚ä¸‹å‡ ç§æ–¹æ³•ä»¥åŠç®€è¦åˆ†ææ¯”è¾ƒã€‚</p>
<ol>
<li><p>å¤šæ¬¡æ›´æ–°<br>ä¸‹é¢æ˜¯æœ€ç®€å•çš„åˆå¹¶å­—å…¸çš„æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d.update(d1)</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ï¼Œå¹¶ä½¿ç”¨updateæ–¹æ³•å‘å­—å…¸ä¸­æ·»åŠ å…ƒç´ ã€‚æ³¨æ„ï¼Œå…ˆæ·»åŠ çš„æ˜¯d1ï¼Œä»¥ä¿è¯åé¢æ·»åŠ çš„d2é‡å¤é”®ä¼šè¦†ç›–d1ã€‚<br>æ­¤æ–¹æ³•æ»¡è¶³äº†æˆ‘ä»¬çš„è¦æ±‚ï¼Œè€Œä¸”æ¸…æ™°æ˜ç¡®ï¼Œå¯æ˜¯ä¸‰è¡Œä»£ç æ€»æ„Ÿè§‰ä¸å¤ŸPythonicã€‚</p>
</blockquote>
</li>
<li><p>å…ˆå¤åˆ¶ï¼Œåæ›´æ–°<br>å…ˆå¤åˆ¶d1å­—å…¸åˆ›å»ºä¸€ä¸ªæ–°å­—å…¸ï¼Œç„¶åä½¿ç”¨d2æ¥æ›´æ–°å‰é¢åˆ›å»ºçš„æ–°å­—å…¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; d1.copy()</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¯¹æ¯”æ–¹æ³•ä¸€ï¼Œè¿™ç§å¤åˆ¶d1çš„æ–¹æ³•ï¼Œæ›´æ˜æ˜¾çš„è¡¨ç°å‡ºd1ä½œä¸ºé»˜è®¤å€¼ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ„é€ å™¨<br>è¿˜å¯ä»¥ä½¿ç”¨å­—å…¸çš„æ„é€ å™¨dict()å¤åˆ¶å­—å…¸ï¼Œç„¶åå†æ›´æ–°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(d1)</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸æ–¹æ³•äºŒå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ²¡æœ‰æ–¹æ³•äºŒç›´æ¥æ˜äº†ã€‚</p>
</blockquote>
</li>
<li><p>å…³é”®å­—å‚æ•°hack<br>ä½ å¯èƒ½è§è¿‡ä¸‹é¢è¿™ä¸ªå·§å¦™çš„è§£å†³åŠæ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(d1 , **d2)</span><br></pre></td></tr></table></figure>
<p>åªæœ‰ä¸€è¡Œä»£ç ï¼Œçœ‹ä¸Šå»å¾ˆé…·ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§hackæŠ€å·§åªæœ‰åœ¨å­—å…¸çš„é”®æ˜¯å­—ç¬¦ä¸²æ—¶æ‰æœ‰æ•ˆã€‚</p>
<blockquote>
<p>çœ‹ä¸Šå»å¾ˆcoolï¼Œä½†æ˜¯ä¸é€šç”¨ï¼Œå­—å…¸çš„é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ‰å¯ä»¥ç”¨è¿™ç§å…³é”®å­—å‚æ•°æ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ¨å¯¼å¼<br>å¯ä»¥ç”¨å­—å…¸æ¨å¯¼å¼è§£å†³æ­¤é—®é¢˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;k:v for d in [d1, d2] for k,v in d.items()&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å­—å…¸æ¨å¯¼å¼æ–¹æ³•æ»¡è¶³è¦æ±‚ï¼Œåªæ˜¯åµŒå¥—çš„å­—å…¸æ¨å¯¼å¼ï¼Œä¸é‚£ä¹ˆæ¸…æ™°ï¼Œä¸æ˜“äºç†è§£ã€‚</p>
</blockquote>
</li>
<li><p>å…ƒç´ æ‹¼æ¥<br>æˆ‘ä»¬ä»æ¯ä¸ªå­—å…¸ä¸­è·å–ä¸€ä¸ªå…ƒç´ åˆ—è¡¨ï¼Œå°†åˆ—è¡¨æ‹¼æ¥èµ·æ¥ï¼Œç„¶åå†ç”¨æ‹¼æ¥çš„åˆ—è¡¨æ„é€ å­—å…¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(list(d1.items()) + list(d2.items()))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è€Œä¸”ï¼Œd2çš„å…ƒç´ åœ¨åˆ—è¡¨åé¢ï¼Œæ‰€ä»¥åœ¨é”®é‡å¤æ—¶å¯ä»¥è¦†ç›–d1ã€‚å¦‚æœåœ¨Python2ä¸­ï¼Œitems()æ–¹æ³•æœ¬èº«è¿”å›çš„å°±æ˜¯åˆ—è¡¨ï¼Œæ— éœ€ç”¨list()è½¬æˆåˆ—è¡¨ã€‚</p>
</blockquote>
</li>
</ol>
<p>å…ƒç´ æ‹¼æ¥åœ¨æ„é€ å­—å…¸å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œåªæ˜¯çœ‹ä¸Šå»ä»£ç æœ‰äº›é‡å¤ã€‚</p>
<ol start="7">
<li><p>å…ƒç´ å¹¶é›†<br>åœ¨Python3ä¸­ï¼Œå­—å…¸è¿”å›çš„æ˜¯è§†å›¾å¯¹è±¡ï¼Œé”®çš„è§†å›¾å¯¹è±¡æ˜¯ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ï¼Œå¦‚æœå­—å…¸ä¸­çš„å€¼å¯ä»¥ä¿è¯æ˜¯å”¯ä¸€çš„å¯å“ˆå¸Œçš„ï¼Œæ­¤æ—¶itemsè¿”å›çš„è§†å›¾å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><figcaption><span>d </span></figcaption><table><tr><td class="code"><pre><span class="line">&gt; è¿™ç§æ–¹æ³•æŒºæœ‰æ„æ€ï¼Œå¯æ˜¯å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºé›†åˆæ˜¯æ— åºçš„ï¼Œé”®é‡å¤æ—¶ä¸èƒ½ä¿è¯è°è¦†ç›–è°ï¼Œè€Œä¸”å­—å…¸ä¸­çš„å€¼é€šå¸¸ä¹Ÿæ˜¯ä¸å¯å“ˆå¸Œçš„ï¼Œå½“ç„¶ä¹Ÿå°±ä¸èƒ½è¿”å›ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">8. chain items</span><br><span class="line">ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºçš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæœ€ç¬¦åˆPythonè¯­è¨€ä¹ æƒ¯è€Œä¸”åªæœ‰ä¸€è¡Œä»£ç å®ç°çš„ï¼Œæ˜¯åˆ›å»ºä¸¤ä¸ªitemsçš„åˆ—è¡¨ï¼Œç„¶åæ‹¼æ¥æˆå­—å…¸ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç”¨itertools.chainæ¥ç®€åŒ–itemsæ‹¼æ¥è¿‡ç¨‹ï¼š</span><br><span class="line">&#96;&#96;&#96;&gt;&gt;&gt; d &#x3D; dict(chain(d1.items(), d2.items()))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§æ–¹æ¡ˆå¾ˆä¸é”™ï¼Œå¯èƒ½æ¯”å¦å¤–åˆ›å»ºä¸¤ä¸ªä¸å¿…è¦çš„åˆ—è¡¨æ›´é«˜æ•ˆã€‚</p>
</blockquote>
</li>
<li><p>ChainMap<br>collections.ChainMapå¯ä»¥å°†å¤šä¸ªå­—å…¸æˆ–æ˜ å°„ï¼Œåœ¨é€»è¾‘ä¸Šå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå•ç‹¬çš„æ˜ å°„ç»“æ„ï¼š</p>
<figure class="highlight plain"><figcaption><span>from collections import ChainMap</span></figcaption><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(ChainMap(d1, d2))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§æ–¹æ³•ä¹Ÿå¾ˆpythonicï¼Œè€Œä¸”ä¹Ÿæ˜¯é€šç”¨æ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ‹†åˆ†<br>åœ¨Python3.5+ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å…¨æ–°çš„å­—å…¸åˆå¹¶æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;**d1, **d2&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™è¡Œä»£ç å¾ˆpythonicï¼Œå¦‚æœæ˜¯ä½ çš„pythonç‰ˆæœ¬æ˜¯3.5+ï¼Œç”¨è¿™ç§æ–¹æ³•æ˜¯å¾ˆä¸é”™çš„é€‰æ‹©ã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸Šé¢è¯´äº†åç§å¯ä»¥åˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„æ–¹å¼ï¼Œå…·ä½“ç”¨å“ªä¸ªå–å†³äºä½ ã€‚<br>å¦‚æœä½¿ç”¨çš„æ˜¯Python3.5+çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå­—å…¸æ‹†åˆ†è¿™ç§æ–°è¯­æ³•åº”è¯¥å¾ˆé€‚åˆä½ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;**d1, **d2&#125;</span><br></pre></td></tr></table></figure>

<p><a href="http://www.revotu.com/python-merge-two-dicts-into-one-dict.html#more" target="_blank" rel="noopener">åŸæ–‡åšå®¢</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä»£ç çƒ­é‡è½½å‡½æ•°reload</title>
    <url>/2020/04/23/Python%E4%BB%A3%E7%A0%81%E7%83%AD%E9%87%8D%E8%BD%BD%E5%87%BD%E6%95%B0reload/</url>
    <content><![CDATA[<h2 id="Pythonä»£ç çƒ­é‡è½½å‡½æ•°reload"><a href="#Pythonä»£ç çƒ­é‡è½½å‡½æ•°reload" class="headerlink" title="Pythonä»£ç çƒ­é‡è½½å‡½æ•°reload"></a>Pythonä»£ç çƒ­é‡è½½å‡½æ•°reload</h2><blockquote>
<p>ä»£ç çƒ­é‡è½½æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯æ¯æ¬¡ä¿®æ”¹ä»£ç åéœ€è¦é‡å¯æœåŠ¡å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚ç”±äºæœ€è¿‘æ­£å¥½åœ¨ä¸€ä¸ªPythoné¡¹ç›®ä¸­éœ€è¦å®ç°çƒ­é‡è½½éœ€æ±‚ï¼Œå› æ­¤å†™äº†ä¸ªpythonç‰ˆçš„ä»£ç çƒ­é‡è½½demoï¼Œä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<h3 id="Python-reload-å‡½æ•°ä»‹ç»"><a href="#Python-reload-å‡½æ•°ä»‹ç»" class="headerlink" title="Python reload()å‡½æ•°ä»‹ç»"></a>Python reload()å‡½æ•°ä»‹ç»</h3><ul>
<li>æè¿°<br>reload() ç”¨äºé‡æ–°è½½å…¥ä¹‹å‰è½½å…¥çš„æ¨¡å—ã€‚</li>
<li>è¯­æ³•<br>reload() å‡½æ•°è¯­æ³•ï¼š<br>reload(module)</li>
<li>å‚æ•°<br>module â€“ æ¨¡å—å¯¹è±¡ã€‚</li>
<li>è¿”å›å€¼<br>è¿”å›æ¨¡å—å¯¹è±¡ã€‚</li>
</ul>
<h3 id="pythonä¸­çš„reloadå‡½æ•°"><a href="#pythonä¸­çš„reloadå‡½æ•°" class="headerlink" title="pythonä¸­çš„reloadå‡½æ•°"></a>pythonä¸­çš„reloadå‡½æ•°</h3><p>python2ä¸­çš„reloadå‡½æ•°å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å¯¼å…¥ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reload(module) # reloadæ¥æ”¶çš„å‚æ•°å¿…é¡»æ˜¯å·²ç»å¯¼å…¥çš„æ¨¡å—</span><br></pre></td></tr></table></figure>
<p>python3ä¸­çš„reloadå‡½æ•°ç§»åˆ°äº†impåº“é‡Œé¢ï¼Œå› æ­¤ÃŸéœ€è¦å¯¼å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from imp import reload</span><br><span class="line">reload(module)</span><br></pre></td></tr></table></figure>
<h3 id="Demo-01"><a href="#Demo-01" class="headerlink" title="Demo-01"></a>Demo-01</h3><p>demo1æ˜¯åŸºäºæœ€å¸¸è§çš„éœ€æ±‚ï¼Œå³åŒä¸€ä¸ªç›®å½•ä¸‹æœ‰2ä¸ªæ–‡ä»¶(plugin.pyï¼Œscan.py),scan.pyæ–‡ä»¶è°ƒç”¨plugin.pyæ–‡ä»¶ã€‚<br>plugin.pyæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">Now &#x3D; time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">print(&quot;Now: %s,Start executing plugin code...&quot; % Now)</span><br></pre></td></tr></table></figure>
<p>scan.pyæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from imp import reload</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line">import plugin</span><br><span class="line">while 1:</span><br><span class="line">    reload(plugin)</span><br><span class="line">    time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œscan.py,ç„¶åæ‰‹å·¥ä¿®æ”¹plugin.pyæ–‡ä»¶å†…å®¹ï¼Œè§‚å¯Ÿè¾“å‡ºçš„å˜åŒ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python scan.py</span><br><span class="line">Now: 2019-04-11 16:14:43,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:14:44,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:14:45,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:14:46,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:14:47,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:14:48,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:14:49,Start executing plugin code ......</span><br></pre></td></tr></table></figure>
<h3 id="Demo-02"><a href="#Demo-02" class="headerlink" title="Demo-02"></a>Demo-02</h3><p>Demo-02ä¼šç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œå³åŒä¸€ä¸ªç›®å½•ä¸‹æœ‰2ä¸ªæ–‡ä»¶(plugin.pyï¼Œscan.py),scan.pyæ–‡ä»¶è°ƒç”¨plugin.pyæ–‡ä»¶é‡Œé¢çš„crackå‡½æ•°ã€‚<br>plugin.pyæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">def crack():</span><br><span class="line">    import time</span><br><span class="line">    Now &#x3D; time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">    print(&quot;Now: %s,Start executing plugin code ......&quot; % Now)</span><br></pre></td></tr></table></figure>
<p>scan.pyæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from imp import reload</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line">import plugin</span><br><span class="line">while 1:</span><br><span class="line">    reload(plugin)</span><br><span class="line">    eval(&quot;plugin.crack()&quot;)</span><br><span class="line">    time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œscan.py,ç„¶åæ‰‹å·¥ä¿®æ”¹plugin.pyæ–‡ä»¶å†…å®¹ï¼Œè§‚å¯Ÿè¾“å‡ºçš„å˜åŒ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python scan.py</span><br><span class="line">Now: 2019-04-11 16:18:49,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:50,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:51,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:52,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:53,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:54,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:18:55,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:18:56,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:18:57,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:18:58,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:18:59,Start executing plugin code ...</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿè¿è¡Œç»“æœå¯ä»¥çœ‹å‡º,åœ¨è°ƒç”¨ä¹‹å‰å…ˆreloadä¸€ä¸‹æ¨¡å—ï¼Œç„¶åå†åˆ©ç”¨evalè°ƒç”¨è¯¥æ¨¡å—çš„crackå‡½æ•°ã€‚</p>
<h3 id="Demo-03"><a href="#Demo-03" class="headerlink" title="Demo-03"></a>Demo-03</h3><p>Demo-03é’ˆå¯¹æ›´ä¸ºç°å®çš„éœ€æ±‚ï¼Œå³ä¸åŒç›®å½•ä¸‹çš„2ä¸ªæ–‡ä»¶ï¼ˆ./scan.pyï¼Œ./plugins/plugin.pyï¼‰ï¼Œscan.pyæ–‡ä»¶è°ƒç”¨pluginsç›®å½•ä¸‹çš„plugin.pyæ–‡ä»¶é‡Œé¢çš„crackå‡½æ•°ã€‚<br>plugin.pyæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">def crack():</span><br><span class="line">    import time</span><br><span class="line">    Now &#x3D; time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">    print(&quot;Now: %s,Start executing plugin code ......&quot; % Now)</span><br></pre></td></tr></table></figure>
<p>scan.pyæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from imp import reload</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line">exec(&quot;import plugins.plugin&quot;)</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    reload(eval(&quot;plugins.plugin&quot;))</span><br><span class="line">    eval(&quot;plugins.plugin.crack()&quot;)</span><br><span class="line">    time.sleep(1)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œscan.py,ç„¶åæ‰‹å·¥ä¿®æ”¹plugin.pyæ–‡ä»¶å†…å®¹ï¼Œè§‚å¯Ÿè¾“å‡ºçš„å˜åŒ–ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python scan.py</span><br><span class="line">Now: 2019-04-11 16:25:10,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:11,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:12,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:13,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:14,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:15,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:16,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:17,Start executing plugin code ......</span><br><span class="line">Now: 2019-04-11 16:25:18,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:25:19,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:25:20,Start executing plugin code ...</span><br><span class="line">Now: 2019-04-11 16:25:21,Start executing plugin code ...</span><br></pre></td></tr></table></figure>
<p>è§‚å¯Ÿè¿è¡Œç»“æœå¯ä»¥çœ‹å‡º,reloadä¸æ”¯æŒ<code>from plugins improt plugin</code>çš„æ–¹å¼é‡è½½æ¨¡å—ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨<code>import plugins.plugin</code>çš„æ–¹å¼å¯¼å…¥æ¨¡å—å¹¶é‡è½½ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¹‹ç¦…</title>
    <url>/2020/04/23/Python%E4%B9%8B%E7%A6%85/</url>
    <content><![CDATA[<h2 id="Pythonä¹‹ç¦…"><a href="#Pythonä¹‹ç¦…" class="headerlink" title="Pythonä¹‹ç¦…"></a>Pythonä¹‹ç¦…</h2><blockquote>
<p>åœ¨Pythonäº¤äº’å¼è§£é‡Šå™¨ä¸­è¾“ å…¥import thiså°±ä¼šæ˜¾ç¤ºTim Petersçš„The Zen of python</p>
</blockquote>
<p><img src="https://pic4.zhimg.com/v2-3c27b47e4d5ef618a86252b39bb6db94_1200x500.jpg" alt="python"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import this</span><br><span class="line">The Zen of Python, by Tim Peters</span><br><span class="line"></span><br><span class="line">Beautiful is better than ugly.</span><br><span class="line">Explicit is better than implicit.</span><br><span class="line">Simple is better than complex.</span><br><span class="line">Complex is better than complicated.</span><br><span class="line">Flat is better than nested.</span><br><span class="line">Sparse is better than dense.</span><br><span class="line">Readability counts.</span><br><span class="line">Special cases aren&#39;t special enough to break the rules.</span><br><span class="line">Although practicality beats purity.</span><br><span class="line">Errors should never pass silently.</span><br><span class="line">Unless explicitly silenced.</span><br><span class="line">In the face of ambiguity, refuse the temptation to guess.</span><br><span class="line">There should be one-- and preferably only one --obvious way to do it.</span><br><span class="line">Although that way may not be obvious at first unless you&#39;re Dutch.</span><br><span class="line">Now is better than never.</span><br><span class="line">Although never is often better than *right* now.</span><br><span class="line">If the implementation is hard to explain, it&#39;s a bad idea.</span><br><span class="line">If the implementation is easy to explain, it may be a good idea.</span><br><span class="line">Namespaces are one honking great idea -- let&#39;s do more of those!</span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘å’Œè§£é‡Š:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Pythonä¹‹ç¦… by Tim Peters</span><br><span class="line"></span><br><span class="line">ä¼˜ç¾èƒœäºä¸‘é™‹ï¼ˆPython ä»¥ç¼–å†™ä¼˜ç¾çš„ä»£ç ä¸ºç›®æ ‡ï¼‰</span><br><span class="line">æ˜äº†èƒœäºæ™¦æ¶©ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯æ˜äº†çš„ï¼Œå‘½åè§„èŒƒï¼Œé£æ ¼ç›¸ä¼¼ï¼‰</span><br><span class="line">ç®€æ´èƒœäºå¤æ‚ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯ç®€æ´çš„ï¼Œä¸è¦æœ‰å¤æ‚çš„å†…éƒ¨å®ç°ï¼‰</span><br><span class="line">å¤æ‚èƒœäºå‡Œä¹±ï¼ˆå¦‚æœå¤æ‚ä¸å¯é¿å…ï¼Œé‚£ä»£ç é—´ä¹Ÿä¸èƒ½æœ‰éš¾æ‡‚çš„å…³ç³»ï¼Œè¦ä¿æŒæ¥å£ç®€æ´ï¼‰</span><br><span class="line">æ‰å¹³èƒœäºåµŒå¥—ï¼ˆä¼˜ç¾çš„ä»£ç åº”å½“æ˜¯æ‰å¹³çš„ï¼Œä¸èƒ½æœ‰å¤ªå¤šçš„åµŒå¥—ï¼‰</span><br><span class="line">é—´éš”èƒœäºç´§å‡‘ï¼ˆä¼˜ç¾çš„ä»£ç æœ‰é€‚å½“çš„é—´éš”ï¼Œä¸è¦å¥¢æœ›ä¸€è¡Œä»£ç è§£å†³é—®é¢˜ï¼‰</span><br><span class="line">å¯è¯»æ€§å¾ˆé‡è¦ï¼ˆä¼˜ç¾çš„ä»£ç æ˜¯å¯è¯»çš„ï¼‰</span><br><span class="line">å³ä¾¿å‡å€Ÿç‰¹ä¾‹çš„å®ç”¨æ€§ä¹‹åï¼Œä¹Ÿä¸å¯è¿èƒŒè¿™äº›è§„åˆ™ï¼ˆè¿™äº›è§„åˆ™è‡³é«˜æ— ä¸Šï¼‰</span><br><span class="line">ä¸è¦åŒ…å®¹æ‰€æœ‰é”™è¯¯ï¼Œé™¤éä½ ç¡®å®šéœ€è¦è¿™æ ·åšï¼ˆç²¾å‡†åœ°æ•è·å¼‚å¸¸ï¼Œä¸å†™ except:pass é£æ ¼çš„ä»£ç ï¼‰</span><br><span class="line">å½“å­˜åœ¨å¤šç§å¯èƒ½ï¼Œä¸è¦å°è¯•å»çŒœæµ‹</span><br><span class="line">è€Œæ˜¯å°½é‡æ‰¾ä¸€ç§ï¼Œæœ€å¥½æ˜¯å”¯ä¸€ä¸€ç§æ˜æ˜¾çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœä¸ç¡®å®šï¼Œå°±ç”¨ç©·ä¸¾æ³•ï¼‰</span><br><span class="line">è™½ç„¶è¿™å¹¶ä¸å®¹æ˜“ï¼Œå› ä¸ºä½ ä¸æ˜¯ Python ä¹‹çˆ¶ï¼ˆè¿™é‡Œçš„ Dutch æ˜¯æŒ‡ Guido ï¼‰</span><br><span class="line">åšä¹Ÿè®¸å¥½è¿‡ä¸åšï¼Œä½†ä¸å‡æ€ç´¢å°±åŠ¨æ‰‹è¿˜ä¸å¦‚ä¸åšï¼ˆåŠ¨æ‰‹ä¹‹å‰è¦ç»†æ€é‡ï¼‰</span><br><span class="line">å¦‚æœä½ æ— æ³•å‘äººæè¿°ä½ çš„æ–¹æ¡ˆï¼Œé‚£è‚¯å®šä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ¡ˆï¼›åä¹‹äº¦ç„¶ï¼ˆæ–¹æ¡ˆæµ‹è¯„æ ‡å‡†ï¼‰</span><br><span class="line">å‘½åç©ºé—´æ˜¯ä¸€ç§ç»å¦™çš„ç†å¿µï¼Œæˆ‘ä»¬åº”å½“å¤šåŠ åˆ©ç”¨ï¼ˆå€¡å¯¼ä¸å·å¬ï¼‰</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonä¸­çš„ä¸€äº›é«˜çº§æŠ€å·§</title>
    <url>/2020/04/23/Python%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E9%AB%98%E7%BA%A7%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="Pythonä¸­çš„ä¸€äº›é«˜çº§æŠ€å·§"><a href="#Pythonä¸­çš„ä¸€äº›é«˜çº§æŠ€å·§" class="headerlink" title="Pythonä¸­çš„ä¸€äº›é«˜çº§æŠ€å·§"></a>Pythonä¸­çš„ä¸€äº›é«˜çº§æŠ€å·§</h2><blockquote>
<p>Python å¼€å‘ä¸­æœ‰å“ªäº›é«˜çº§æŠ€å·§ï¼Ÿè¿™æ˜¯çŸ¥ä¹ä¸Šä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æ€»ç»“äº†ä¸€äº›å¸¸è§çš„æŠ€å·§åœ¨è¿™é‡Œï¼Œå¯èƒ½è°ˆä¸ä¸Šå¤šé«˜çº§ï¼Œä½†æŒæ¡è¿™äº›è‡³å°‘å¯ä»¥è®©ä½ çš„ä»£ç çœ‹èµ·æ¥ Pythonic ä¸€ç‚¹ã€‚å¦‚æœä½ è¿˜åœ¨æŒ‰ç…§ç±»Cè¯­è¨€çš„é‚£å¥—é£æ ¼æ¥å†™çš„è¯ï¼Œåœ¨ code review ææ€•ä¼šè¦è¢«åæ§½äº†.</p>
</blockquote>
<h3 id="åˆ—è¡¨æ¨å¯¼å¼"><a href="#åˆ—è¡¨æ¨å¯¼å¼" class="headerlink" title="åˆ—è¡¨æ¨å¯¼å¼"></a>åˆ—è¡¨æ¨å¯¼å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; chars &#x3D; [ c for c in &#39;python&#39; ]</span><br><span class="line">&gt;&gt;&gt; chars</span><br><span class="line">[&#39;p&#39;, &#39;y&#39;, &#39;t&#39;, &#39;h&#39;, &#39;o&#39;, &#39;n&#39;]</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸æ¨å¯¼å¼"><a href="#å­—å…¸æ¨å¯¼å¼" class="headerlink" title="å­—å…¸æ¨å¯¼å¼"></a>å­—å…¸æ¨å¯¼å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; dict1 &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4, &#39;e&#39;: 5&#125;</span><br><span class="line">&gt;&gt;&gt; double_dict1 &#x3D; &#123;k:v*2 for (k,v) in dict1.items()&#125;</span><br><span class="line">&gt;&gt;&gt; double_dict1</span><br><span class="line">&#123;&#39;a&#39;: 2, &#39;b&#39;: 4, &#39;c&#39;: 6, &#39;d&#39;: 8, &#39;e&#39;: 10&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é›†åˆæ¨å¯¼å¼"><a href="#é›†åˆæ¨å¯¼å¼" class="headerlink" title="é›†åˆæ¨å¯¼å¼"></a>é›†åˆæ¨å¯¼å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; set1 &#x3D; &#123;1,2,3,4&#125;</span><br><span class="line">&gt;&gt;&gt; double_set &#x3D; &#123;i*2 for i in set1&#125;</span><br><span class="line">&gt;&gt;&gt; double_set</span><br><span class="line">&#123;8, 2, 4, 6&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åˆå¹¶å­—å…¸"><a href="#åˆå¹¶å­—å…¸" class="headerlink" title="åˆå¹¶å­—å…¸"></a>åˆå¹¶å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; x &#x3D; &#123;&#39;a&#39;:1,&#39;b&#39;:2&#125;</span><br><span class="line">&gt;&gt;&gt; y &#x3D; &#123;&#39;c&#39;:3, &#39;d&#39;:4&#125;</span><br><span class="line">&gt;&gt;&gt; z &#x3D; &#123;**x, **y&#125;</span><br><span class="line">&gt;&gt;&gt; z</span><br><span class="line">&#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¤åˆ¶åˆ—è¡¨"><a href="#å¤åˆ¶åˆ—è¡¨" class="headerlink" title="å¤åˆ¶åˆ—è¡¨"></a>å¤åˆ¶åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; nums &#x3D; [1,2,3]</span><br><span class="line">&gt;&gt;&gt; nums[::]</span><br><span class="line">[1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; copy_nums &#x3D; nums[::]</span><br><span class="line">&gt;&gt;&gt; copy_nums</span><br><span class="line">[1, 2, 3]</span><br></pre></td></tr></table></figure>

<h3 id="åè½¬åˆ—è¡¨"><a href="#åè½¬åˆ—è¡¨" class="headerlink" title="åè½¬åˆ—è¡¨"></a>åè½¬åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; reverse_nums &#x3D; nums[::-1]</span><br><span class="line">&gt;&gt;&gt; reverse_nums</span><br><span class="line">[3, 2, 1]</span><br></pre></td></tr></table></figure>

<h3 id="å˜é‡äº¤æ¢"><a href="#å˜é‡äº¤æ¢" class="headerlink" title="å˜é‡äº¤æ¢"></a>å˜é‡äº¤æ¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a,b &#x3D; 1, 2</span><br><span class="line">&gt;&gt;&gt; a ,b &#x3D; b,a</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="é«˜çº§æ‹†åŒ…"><a href="#é«˜çº§æ‹†åŒ…" class="headerlink" title="é«˜çº§æ‹†åŒ…"></a>é«˜çº§æ‹†åŒ…</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, *b &#x3D; 1,2,3</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">[2, 3]</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, *b, c &#x3D; 1,2,3,4,5</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">[2, 3, 4]</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h3 id="å‡½æ•°è¿”å›å¤šä¸ªå€¼-å…¶å®æ˜¯è‡ªåŠ¨packingæˆå…ƒç»„-ç„¶åunpackingèµ‹å€¼ç»™4ä¸ªå˜é‡"><a href="#å‡½æ•°è¿”å›å¤šä¸ªå€¼-å…¶å®æ˜¯è‡ªåŠ¨packingæˆå…ƒç»„-ç„¶åunpackingèµ‹å€¼ç»™4ä¸ªå˜é‡" class="headerlink" title="å‡½æ•°è¿”å›å¤šä¸ªå€¼(å…¶å®æ˜¯è‡ªåŠ¨packingæˆå…ƒç»„)ç„¶åunpackingèµ‹å€¼ç»™4ä¸ªå˜é‡"></a>å‡½æ•°è¿”å›å¤šä¸ªå€¼(å…¶å®æ˜¯è‡ªåŠ¨packingæˆå…ƒç»„)ç„¶åunpackingèµ‹å€¼ç»™4ä¸ªå˜é‡</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def f():</span><br><span class="line">...     return 1, 2, 3, 4</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; a, b, c, d &#x3D; f()</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨åˆå¹¶æˆå­—ç¬¦ä¸²"><a href="#åˆ—è¡¨åˆå¹¶æˆå­—ç¬¦ä¸²" class="headerlink" title="åˆ—è¡¨åˆå¹¶æˆå­—ç¬¦ä¸²"></a>åˆ—è¡¨åˆå¹¶æˆå­—ç¬¦ä¸²</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot; &quot;.join([&quot;I&quot;, &quot;Love&quot;, &quot;Python&quot;])</span><br><span class="line">&#39;I Love Python&#39;</span><br></pre></td></tr></table></figure>

<h3 id="é“¾å¼æ¯”è¾ƒ"><a href="#é“¾å¼æ¯”è¾ƒ" class="headerlink" title="é“¾å¼æ¯”è¾ƒ"></a>é“¾å¼æ¯”è¾ƒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; if a &gt; 2 and a &lt; 5:</span><br><span class="line">...     pass</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; if 2&lt;a&lt;5:</span><br><span class="line">...     pass</span><br></pre></td></tr></table></figure>

<h3 id="yield-from"><a href="#yield-from" class="headerlink" title="yield from"></a>yield from</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ²¡æœ‰ä½¿ç”¨ field from</span><br><span class="line">def dup(n):</span><br><span class="line">    for i in range(n):</span><br><span class="line">        yield i</span><br><span class="line">        yield i</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨yield from</span><br><span class="line">def dup(n):</span><br><span class="line">    for i in range(n):</span><br><span class="line">    yield from [i, i]</span><br><span class="line"></span><br><span class="line">for i in dup(3):</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">0</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h3 id="in-ä»£æ›¿-or"><a href="#in-ä»£æ›¿-or" class="headerlink" title="in ä»£æ›¿ or"></a>in ä»£æ›¿ or</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; if x &#x3D;&#x3D; 1 or x &#x3D;&#x3D; 2 or x &#x3D;&#x3D; 3:</span><br><span class="line">...     pass</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; if x in (1,2,3):</span><br><span class="line">...     pass</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸ä»£æ›¿å¤šä¸ªif-else"><a href="#å­—å…¸ä»£æ›¿å¤šä¸ªif-else" class="headerlink" title="å­—å…¸ä»£æ›¿å¤šä¸ªif else"></a>å­—å…¸ä»£æ›¿å¤šä¸ªif else</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def fun(x):</span><br><span class="line">    if x &#x3D;&#x3D; &#39;a&#39;:</span><br><span class="line">        return 1</span><br><span class="line">    elif x &#x3D;&#x3D; &#39;b&#39;:</span><br><span class="line">        return 2</span><br><span class="line">    else:</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">def fun(x):</span><br><span class="line">    return &#123;&quot;a&quot;: 1, &quot;b&quot;: 2&#125;.get(x)</span><br></pre></td></tr></table></figure>

<h3 id="æœ‰ä¸‹æ ‡ç´¢å¼•çš„æšä¸¾"><a href="#æœ‰ä¸‹æ ‡ç´¢å¼•çš„æšä¸¾" class="headerlink" title="æœ‰ä¸‹æ ‡ç´¢å¼•çš„æšä¸¾"></a>æœ‰ä¸‹æ ‡ç´¢å¼•çš„æšä¸¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for i, e in enumerate([&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]):</span><br><span class="line">...     print(i, e)</span><br><span class="line">...</span><br><span class="line">0 a</span><br><span class="line">1 b</span><br><span class="line">2 c</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h3><p>æ³¨æ„åŒºåˆ†åˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨æ•ˆç‡æ›´é«˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; g &#x3D; (i**2 for i in range(5))</span><br><span class="line">&gt;&gt;&gt; g</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x10881e518&gt;</span><br><span class="line">&gt;&gt;&gt; for i in g:</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">9</span><br><span class="line">16</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨æ„åŒºåˆ†åˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨æ•ˆç‡æ›´é«˜"><a href="#æ³¨æ„åŒºåˆ†åˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨æ•ˆç‡æ›´é«˜" class="headerlink" title="æ³¨æ„åŒºåˆ†åˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨æ•ˆç‡æ›´é«˜"></a>æ³¨æ„åŒºåˆ†åˆ—è¡¨æ¨å¯¼å¼ï¼Œç”Ÿæˆå™¨æ•ˆç‡æ›´é«˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; g &#x3D; (i**2 for i in range(5))</span><br><span class="line">&gt;&gt;&gt; g</span><br><span class="line">&lt;generator object &lt;genexpr&gt; at 0x10881e518&gt;</span><br><span class="line">&gt;&gt;&gt; for i in g:</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">9</span><br><span class="line">16</span><br></pre></td></tr></table></figure>

<h3 id="é»˜è®¤å­—å…¸-defaultdict"><a href="#é»˜è®¤å­—å…¸-defaultdict" class="headerlink" title="é»˜è®¤å­—å…¸ defaultdict"></a>é»˜è®¤å­—å…¸ defaultdict</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict()</span><br><span class="line">&gt;&gt;&gt; d[&#39;nums&#39;]</span><br><span class="line">KeyError: &#39;nums&#39;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; from collections import defaultdict</span><br><span class="line">&gt;&gt;&gt; d &#x3D; defaultdict(list)</span><br><span class="line">&gt;&gt;&gt; d[&quot;nums&quot;]</span><br><span class="line">[]</span><br></pre></td></tr></table></figure>

<h3 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; lang &#x3D; &#39;python&#39;</span><br><span class="line">&gt;&gt;&gt; f&#39;&#123;lang&#125; is most popular language in the world&#39;</span><br><span class="line">&#39;python is most popular language in the world&#39;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ "><a href="#åˆ—è¡¨ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ " class="headerlink" title="åˆ—è¡¨ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ "></a>åˆ—è¡¨ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å…ƒç´ </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; nums &#x3D; [1,2,3,3]</span><br><span class="line">&gt;&gt;&gt; max(set(nums), key&#x3D;nums.count)</span><br><span class="line">3</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line">from collections import Counter</span><br><span class="line">&gt;&gt;&gt; Counter(nums).most_common()[0][0]</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<h3 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; with open(&quot;test.txt&quot;, &quot;w&quot;) as f:</span><br><span class="line">...     f.writelines(&quot;hello&quot;)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ¤æ–­å¯¹è±¡ç±»å‹ï¼Œå¯æŒ‡å®šå¤šä¸ªç±»å‹"><a href="#åˆ¤æ–­å¯¹è±¡ç±»å‹ï¼Œå¯æŒ‡å®šå¤šä¸ªç±»å‹" class="headerlink" title="åˆ¤æ–­å¯¹è±¡ç±»å‹ï¼Œå¯æŒ‡å®šå¤šä¸ªç±»å‹"></a>åˆ¤æ–­å¯¹è±¡ç±»å‹ï¼Œå¯æŒ‡å®šå¤šä¸ªç±»å‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; isinstance(a, (int, str))</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<h3 id="ç±»ä¼¼çš„è¿˜æœ‰å­—ç¬¦ä¸²çš„-startswithï¼Œendswith"><a href="#ç±»ä¼¼çš„è¿˜æœ‰å­—ç¬¦ä¸²çš„-startswithï¼Œendswith" class="headerlink" title="ç±»ä¼¼çš„è¿˜æœ‰å­—ç¬¦ä¸²çš„ startswithï¼Œendswith"></a>ç±»ä¼¼çš„è¿˜æœ‰å­—ç¬¦ä¸²çš„ startswithï¼Œendswith</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot;http:&#x2F;&#x2F;foofish.net&quot;.startswith((&#39;http&#39;,&#39;https&#39;))</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; &quot;https:&#x2F;&#x2F;foofish.net&quot;.startswith((&#39;http&#39;,&#39;https&#39;))</span><br><span class="line">True</span><br></pre></td></tr></table></figure>

<h3 id="str-ä¸-repr-åŒºåˆ«"><a href="#str-ä¸-repr-åŒºåˆ«" class="headerlink" title="str ä¸ repr åŒºåˆ«"></a><strong>str</strong> ä¸ <strong>repr</strong> åŒºåˆ«</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; str(datetime.now())</span><br><span class="line">&#39;2018-11-20 00:31:54.839605&#39;</span><br><span class="line">&gt;&gt;&gt; repr(datetime.now())</span><br><span class="line">&#39;datetime.datetime(2018, 11, 20, 0, 32, 0, 579521)&#39;</span><br></pre></td></tr></table></figure>
<p>å‰è€…å¯¹äººå‹å¥½ï¼Œå¯è¯»æ€§æ›´å¼ºï¼Œåè€…å¯¹è®¡ç®—æœºå‹å¥½ï¼Œæ”¯æŒ obj == eval(repr(obj))</p>
<h3 id="ä½¿ç”¨è£…é¥°å™¨"><a href="#ä½¿ç”¨è£…é¥°å™¨" class="headerlink" title="ä½¿ç”¨è£…é¥°å™¨"></a>ä½¿ç”¨è£…é¥°å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def makebold(f):</span><br><span class="line">return lambda: &quot;&lt;b&gt;&quot; + f() + &quot;&lt;&#x2F;b&gt;&quot;</span><br><span class="line"></span><br><span class="line">def makeitalic(f):</span><br><span class="line">return lambda: &quot;&lt;i&gt;&quot; + f() + &quot;&lt;&#x2F;i&gt;&quot;</span><br><span class="line"></span><br><span class="line">@makebold</span><br><span class="line">@makeitalic</span><br><span class="line">def say():</span><br><span class="line">return &quot;Hello&quot;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; say()</span><br><span class="line">&lt;b&gt;&lt;i&gt;Hello&lt;&#x2F;i&gt;&lt;&#x2F;b&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ä½¿ç”¨è£…é¥°å™¨-å¯è¯»æ€§éå¸¸å·®"><a href="#ä¸ä½¿ç”¨è£…é¥°å™¨-å¯è¯»æ€§éå¸¸å·®" class="headerlink" title="ä¸ä½¿ç”¨è£…é¥°å™¨,å¯è¯»æ€§éå¸¸å·®"></a>ä¸ä½¿ç”¨è£…é¥°å™¨,å¯è¯»æ€§éå¸¸å·®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def say():</span><br><span class="line">return &quot;Hello&quot;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; makebold(makeitalic(say))()</span><br><span class="line">&lt;b&gt;&lt;i&gt;Hello&lt;&#x2F;i&gt;&lt;&#x2F;b&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://mp.weixin.qq.com/s/cGHEJRUQ3CeuvL5rOqul8A" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonæŠ€æœ¯è¿›é˜¶yield</title>
    <url>/2020/04/23/Python%E6%8A%80%E6%9C%AF%E8%BF%9B%E9%98%B6yield/</url>
    <content><![CDATA[<h2 id="PythonæŠ€æœ¯è¿›é˜¶yield"><a href="#PythonæŠ€æœ¯è¿›é˜¶yield" class="headerlink" title="PythonæŠ€æœ¯è¿›é˜¶yield"></a>PythonæŠ€æœ¯è¿›é˜¶<code>yield</code></h2><blockquote>
<p><code>yield</code>å…³é”®å­—åœ¨Pythonä¸­å¼€å‘ä¸­ä½¿ç”¨è¾ƒä¸ºé¢‘ç¹ï¼Œå®ƒä¸ºæˆ‘ä»¬æŸäº›å¼€å‘åœºæ™¯æä¾›äº†ä¾¿åˆ©ï¼Œè¿™ç¯‡æ–‡ç« æˆ‘ä»¬æ¥æ·±å…¥è®²è§£<code>yield</code>ç›¸å…³çŸ¥è¯†ã€‚</p>
</blockquote>
<h3 id="ç”Ÿæˆå™¨"><a href="#ç”Ÿæˆå™¨" class="headerlink" title="ç”Ÿæˆå™¨"></a>ç”Ÿæˆå™¨</h3><p>åœ¨è®²<code>yield</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤ä¹ ä¸€ä¸‹è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨çš„åŒºåˆ«ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„æ–‡ç« ï¼šPythonæŠ€æœ¯è¿›é˜¶â€”â€”è¿­ä»£å™¨ã€å¯è¿­ä»£å¯¹è±¡ã€ç”Ÿæˆå™¨ã€‚</p>
<p>ç®€å•æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>å®ç°äº†è¿­ä»£å™¨åè®®<code>__iter__</code>å’Œ<code>next/__next__</code>æ–¹æ³•çš„å¯¹è±¡è¢«ç§°ä½œè¿­ä»£å™¨</li>
<li>è¿­ä»£å™¨å¯ä»¥ä½¿ç”¨<code>for</code>æ‰§è¡Œè¾“å‡ºæ¯ä¸ªå…ƒç´ </li>
<li>ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨</li>
</ul>
<p>ä¸€ä¸ªå‡½æ•°å†…ï¼Œå¦‚æœåŒ…å«äº†<code>yield</code>å…³é”®å­—ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç”Ÿæˆå™¨å‡½æ•°</span><br><span class="line">def gen(n):</span><br><span class="line">    for i in range(n):</span><br><span class="line">        yield i</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g &#x3D; gen(3)  # åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨</span><br><span class="line">print(g)</span><br><span class="line"></span><br><span class="line">print(type(g))  # &lt;type &#39;generator&#39;&gt;</span><br><span class="line"></span><br><span class="line"># ç”Ÿæˆå™¨è¿­ä»£</span><br><span class="line">for i in g:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&lt;generator object gen at 0x10a1cbaf0&gt;</span><br><span class="line">&lt;class &#39;generator&#39;&gt;</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œåœ¨æ‰§è¡Œ<code>g = gen(3)</code>æ—¶ï¼Œå‡½æ•°ä¸­çš„ä»£ç å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œæ­¤æ—¶æˆ‘ä»¬åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œä»–çš„ç±»å‹æ˜¯<code>generator</code>ã€‚<br>å½“æ‰§è¡Œ<code>for i in g</code>æ—¶ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œç›´åˆ°æ‰§è¡Œåˆ°<code>yield</code>æ—¶ï¼Œè¿”å›<code>yield</code>åé¢çš„å€¼ã€‚<br>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æƒ³è¾“å‡º5ä¸ªå…ƒç´ ï¼Œåœ¨åˆ›å»ºç”Ÿæˆå™¨æ—¶ï¼Œè¿™ä¸ª5ä¸ªå…ƒç´ æ­¤æ—¶å¹¶æ²¡æœ‰äº§ç”Ÿï¼Œä»€ä¹ˆæ—¶å€™äº§ç”Ÿå‘¢ï¼Ÿåœ¨æ‰§è¡Œforå¾ªç¯é‡åˆ°<code>yield</code>æ—¶ï¼Œæ­¤æ—¶æ‰ä¼šé€ä¸ªç”Ÿæˆæ¯ä¸ªå…ƒç´ ã€‚</p>
<p>ç”Ÿæˆå™¨é™¤äº†å®ç°è¿­ä»£å™¨åè®®å¯ä»¥è¿›è¡Œè¿­ä»£ä¹‹å¤–ï¼Œè¿˜åŒ…å«ä¸€äº›æ–¹æ³•ï¼š</p>
<ul>
<li><code>generator.next()</code>ï¼šæ¯æ¬¡æ‰§è¡Œåˆ°é‡åˆ°<code>yield</code>åè¿”å›ï¼Œç›´åˆ°æ²¡æœ‰<code>yield</code>ï¼ŒæŠ›å‡º<code>StopIterator</code>å¼‚å¸¸</li>
<li><code>generator.send(value)``ï¼šå°†</code>yield<code>çš„å€¼è®¾ç½®ä¸º</code>value`</li>
<li><code>generator.throw(type[, value[, traceback]])</code>ï¼šå‘ç”Ÿæˆå™¨å½“å‰çŠ¶æ€æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</li>
<li><code>generator.close()</code>ï¼šå…³é—­ç”Ÿæˆå™¨</li>
</ul>
<h3 id="next"><a href="#next" class="headerlink" title="next"></a>next</h3><p>ä¸ºäº†æ›´ä¾¿äºä½ ç†è§£åªæœ‰åœ¨é‡åˆ°<code>yield</code>æ—¶æ‰äº§ç”Ÿå€¼ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å†™ç¨‹åºå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def gen(n):</span><br><span class="line">    for i in range(n):</span><br><span class="line">        print(&#39;yield before&#39;)</span><br><span class="line">        yield i</span><br><span class="line">        print(&#39;yield after&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g &#x3D; gen(3)  # åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨</span><br><span class="line"># print(g.__next__)</span><br><span class="line">print(next(g))  # 0</span><br><span class="line">print(&#39;-&#39; * 5)</span><br><span class="line">print(next(g))  # 1</span><br><span class="line">print(&#39;-&#39; * 5)</span><br><span class="line">print(next(g))  # 2</span><br><span class="line">print(&#39;-&#39; * 5)</span><br><span class="line">print(next(g))  # StopIteration</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">yield before</span><br><span class="line">0</span><br><span class="line">-----</span><br><span class="line">yield after</span><br><span class="line">yield before</span><br><span class="line">1</span><br><span class="line">-----</span><br><span class="line">yield after</span><br><span class="line">yield before</span><br><span class="line">2</span><br><span class="line">-----</span><br><span class="line">yield after</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;learn.py&quot;, line 53, in &lt;module&gt;</span><br><span class="line">    print(next(g))  # StopIteration</span><br><span class="line">StopIteration</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åªæœ‰åœ¨æ‰§è¡Œ<code>next(g)</code>æ—¶ï¼Œæ‰ä¼šäº§ç”Ÿå€¼ï¼Œå¹¶ä¸”ç”Ÿæˆå™¨ä¼šä¿ç•™ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåœ¨å†æ¬¡æ‰§è¡Œ<code>next(g)</code>æ—¶ç»§ç»­è¿”å›ã€‚</p>
<h3 id="send"><a href="#send" class="headerlink" title="send"></a>send</h3><p>ä¸Šé¢çš„ä¾‹å­åªå±•ç¤ºäº†åœ¨<code>yield</code>åæœ‰å€¼çš„æƒ…å†µï¼Œå…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨<code>j = yield i</code>è¿™ç§è¯­æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import time</span><br><span class="line"></span><br><span class="line">def gen():</span><br><span class="line">    i &#x3D; 1</span><br><span class="line">    while True:</span><br><span class="line">        j &#x3D; yield i</span><br><span class="line">        i *&#x3D; 2</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        if j &#x3D;&#x3D; -1:</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">for i in gen():</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">8</span><br><span class="line">16</span><br><span class="line">32</span><br><span class="line">64</span><br><span class="line">128</span><br><span class="line">256</span><br><span class="line">^CTraceback (most recent call last):</span><br><span class="line">  File &quot;learn.py&quot;, line 86, in &lt;module&gt;</span><br><span class="line">    for i in gen():</span><br><span class="line">  File &quot;learn.py&quot;, line 81, in gen</span><br><span class="line">    time.sleep(2)</span><br><span class="line">KeyboardInterrupt</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç”Ÿæˆå™¨å‡½æ•°ç›¸å½“äºæ— é™ç”Ÿæˆæ¯æ¬¡ç¿»å€çš„æ•°å­—ï¼Œä¸€ç›´å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æˆ‘ä»¬æ€æ­»è¿›ç¨‹æ‰èƒ½åœæ­¢ã€‚<br>åœ¨ä¸Šé¢çš„ä»£ç ä½ ä¼šå‘ç°ï¼Œè²Œä¼¼æ°¸è¿œæ‰§è¡Œä¸åˆ°<code>j == -1</code>è¿™ä¸ªåˆ†æ”¯é‡Œï¼Œå¦‚æœæƒ³è®©ä»£ç æ‰§è¡Œåˆ°è¿™ï¼Œå¦‚ä½•åšï¼Ÿ<br>è¿™é‡Œå°±è¦ç”¨åˆ°ç”Ÿæˆçš„sendæ–¹æ³•ï¼Œå®ƒå¯ä»¥åœ¨å¤–éƒ¨ä¼ å…¥ä¸€ä¸ªå€¼ï¼Œä½¿å¾—æ”¹å˜ç”Ÿæˆå™¨å½“å‰çš„çŠ¶æ€ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">g &#x3D; gen()            # åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨</span><br><span class="line">print(next(g))       # 1</span><br><span class="line">print(next(g))       # 2</span><br><span class="line">print(next(g))       # 4</span><br><span class="line">print(g.send(-1))    # j &#x3D; -1 ç¨‹åºé€€å‡º</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">4</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;learn.py&quot;, line 112, in &lt;module&gt;</span><br><span class="line">    print(g.send(-1))    # j &#x3D; -1 ç¨‹åºé€€å‡º</span><br><span class="line">StopIteration</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ<code>g.send(-1)</code>,ç›¸å½“äºæŠŠ-1ä¼ å…¥ç”Ÿæˆå™¨ï¼Œèµ‹å€¼ç»™äº†<code>yield</code>ä¹‹å‰çš„jï¼Œä»è€Œæ”¹å˜äº†ç”Ÿæˆå™¨å†…éƒ¨çš„æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<h3 id="throw"><a href="#throw" class="headerlink" title="throw"></a>throw</h3><p>é™¤äº†å¯ä»¥å‘ç”Ÿæˆå™¨å†…éƒ¨ä¼ å…¥æŒ‡å®šå€¼ï¼Œè¿˜å¯ä»¥ä¼ å…¥æŒ‡å®šå¼‚å¸¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def gen():</span><br><span class="line">    try:</span><br><span class="line">        yield 1</span><br><span class="line">    except ValueError:</span><br><span class="line">        yield &#39;ValueError&#39;</span><br><span class="line">    finally:</span><br><span class="line">        print(&#39;finally&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g &#x3D; gen()  # åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨</span><br><span class="line">print(next(g))  # 1</span><br><span class="line">print(g.throw(ValueError))  # å‘å†…éƒ¨ä¼ å…¥å¼‚å¸¸ï¼Œè¿”å›ValueErrorï¼Œå¹¶æ‰“å°å‡ºfinally</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">1</span><br><span class="line">ValueError</span><br><span class="line">finally</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><code>throw</code>ä¸<code>next</code>ç±»ä¼¼ï¼Œä½†æ˜¯ä»¥ä¼ å…¥å¼‚å¸¸çš„æ–¹å¼ä½¿ç”Ÿæˆå™¨æ‰§è¡Œ,<code>throw</code>ä¸€èˆ¬åœ¨å¼€å‘ä¸­å¾ˆå°‘è¢«ç”¨åˆ°ã€‚</p>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><p>ä¸Šé¢ç®€å•ä»‹ç»äº†ç”Ÿæˆå™¨å’Œ<code>yield</code>çš„ä½¿ç”¨æ–¹å¼ï¼Œé‚£ä¹ˆ<code>yield</code>ä¸€èˆ¬åœ¨å“ªäº›åœºæ™¯ä¸­è¢«ä½¿ç”¨ï¼Ÿ</p>
<h4 id="å¤§åˆ—è¡¨çš„ç”Ÿæˆ"><a href="#å¤§åˆ—è¡¨çš„ç”Ÿæˆ" class="headerlink" title="å¤§åˆ—è¡¨çš„ç”Ÿæˆ"></a>å¤§åˆ—è¡¨çš„ç”Ÿæˆ</h4><blockquote>
<p>å¦‚æœä½ æƒ³ç”Ÿæˆä¸€ä¸ªéå¸¸å¤§çš„åˆ—è¡¨ï¼Œä½¿ç”¨listæ—¶åªèƒ½ä¸€æ¬¡æ€§åœ¨å†…å­˜ä¸­åˆ›å»ºå‡ºè¿™ä¸ªåˆ—è¡¨ï¼Œè¿™å¯èƒ½å¯¼è‡´å†…å­˜èµ„æºç”³è¯·éå¸¸å¤§ï¼Œç”šè‡³æœ‰å¯èƒ½è¢«æ“ä½œç³»ç»Ÿæ€æ­»è¿›ç¨‹ã€‚</p>
</blockquote>
<p>ç›´æ¥åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªå¤§åˆ—è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def big_list():</span><br><span class="line">    result &#x3D; []</span><br><span class="line">    for i in range(1000000000000):</span><br><span class="line">        result.append(i)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ä¸€æ¬¡æ€§åœ¨å†…å­˜ä¸­ç”Ÿæˆå¤§åˆ—è¡¨ å†…å­˜å ç”¨éå¸¸å¤§</span><br><span class="line">for i in big_list():</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
<p>ç”±äºç”Ÿæˆå™¨åªæœ‰åœ¨æ‰§è¡Œåˆ°<code>yield</code>æ—¶æ‰ä¼šäº§ç”Ÿå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ä¼˜é›…åœ°è§£å†³è¿™ç±»é—®é¢˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def big_list():</span><br><span class="line">    for i in range(1000000000000):</span><br><span class="line">        yield i</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"># å¤§åˆ—è¡¨åªæœ‰åœ¨è¿­ä»£æ—¶ æ‰é€ä¸ªç”Ÿæˆå…ƒç´  å‡å°‘å†…å­˜å ç”¨</span><br><span class="line">for i in big_list():</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>

<h4 id="ç®€åŒ–ä»£ç ç»“æ„"><a href="#ç®€åŒ–ä»£ç ç»“æ„" class="headerlink" title="ç®€åŒ–ä»£ç ç»“æ„"></a>ç®€åŒ–ä»£ç ç»“æ„</h4><p>å¦‚æœä¸€ä¸ªå‡½æ•°ä¸­è¦äº§ç”Ÿä¸€ä¸ªåˆ—è¡¨ï¼Œä½†è¿™ä¸ªåˆ—è¡¨å¯èƒ½æ˜¯å¤šä¸ªé€»è¾‘å—ç»„åˆåæ‰èƒ½äº§ç”Ÿçš„ï¼Œè¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ä»£ç ç»“æ„å˜å¾—å¤æ‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def gen_list():</span><br><span class="line">    # å¤šä¸ªé€»è¾‘å— ç»„æˆç”Ÿæˆä¸€ä¸ªåˆ—è¡¨</span><br><span class="line">    result &#x3D; []</span><br><span class="line">    for i in range(10):</span><br><span class="line">        result.append(i)</span><br><span class="line">    for j in range(5):</span><br><span class="line">        result.append(j * j)</span><br><span class="line">    for k in [100, 200, 300]:</span><br><span class="line">        result.append(k)</span><br><span class="line">    return result</span><br><span class="line">    </span><br><span class="line">for item in gen_list():</span><br><span class="line">    print item</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨<code>yield</code>ç”Ÿæˆè¿™ä¸ªåˆ—è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å¤šä¸ªé€»è¾‘å— ä½¿ç”¨yield ç”Ÿæˆä¸€ä¸ªåˆ—è¡¨</span><br><span class="line">def gen_list():</span><br><span class="line">    for i in range(10):</span><br><span class="line">        yield i</span><br><span class="line">    for j in range(5):</span><br><span class="line">        yield j * j</span><br><span class="line">    for k in [100, 200, 300]:</span><br><span class="line">        yield k</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for item in gen_list():</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªèƒ½å…ˆå£°æ˜ä¸€ä¸ª<code>list</code>ç±»å‹çš„å˜é‡ï¼Œç„¶ååœ¨æ¯ä¸ªé€»è¾‘å—ä¸­äº§ç”Ÿå…ƒç´ ï¼Œä¹‹å<code>append</code>åˆ°ç»“æœä¸­ï¼Œæœ€ç»ˆ<code>return</code>è¿”å›è¿™ä¸ªç»“æœã€‚<br>è€Œä½¿ç”¨<code>yield</code>åï¼Œåªéœ€åœ¨æ¯ä¸ªé€»è¾‘å—éœ€è¦äº§ç”Ÿå¹¶è¿”å›å…ƒç´ æ—¶ï¼Œä½¿ç”¨<code>yield</code>å³å¯ï¼Œä»£ç æ›´åŠ ç®€æ´ï¼Œç»“æ„æ›´æ¸…æ™°ï¼ŒåŒæ—¶è¿˜æ‹¥æœ‰å‡å°‘å†…å­˜å ç”¨çš„å¥½å¤„ã€‚</p>
<h3 id="åç¨‹ä¸å¹¶å‘"><a href="#åç¨‹ä¸å¹¶å‘" class="headerlink" title="åç¨‹ä¸å¹¶å‘"></a>åç¨‹ä¸å¹¶å‘</h3><p>æˆ‘ä»¬éƒ½æ¯”è¾ƒç†Ÿæ‚‰è¿›ç¨‹ã€çº¿ç¨‹ï¼Œä¸€èˆ¬ä¸ºäº†æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ï¼Œä¼šä½¿ç”¨å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹è¿›è¡Œå¼€å‘ï¼Œæœ€å¸¸ç”¨çš„ç¼–ç¨‹æ¨¡å‹å°±æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå³ä¸€ä¸ªè¿›ç¨‹/çº¿ç¨‹ç”Ÿäº§æ•°æ®ï¼Œå…¶ä»–è¿›ç¨‹/çº¿ç¨‹æ¶ˆè´¹æ•°æ®ã€‚</p>
<p>åœ¨å¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹å¼€å‘æ—¶ï¼Œä¸ºäº†é˜²æ­¢èµ„æºè¢«ç¯¡æ”¹ï¼Œå¾€å¾€ä¼šè¿›è¡ŒåŠ é”ï¼Œè¿™å°±å¯¼è‡´äº†ç¼–ç¨‹çš„å¤æ‚ç¨‹åº¦ã€‚</p>
<p>åœ¨Pythonå¼€å‘ä¸­ï¼Œä¹Ÿæä¾›äº†å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹çš„å¼€å‘æ–¹å¼ï¼Œä½†ç”±äºè§£é‡Šå™¨<code>GIL</code>çš„å­˜åœ¨ï¼Œå¤šçº¿ç¨‹å¼€å‘å¹¶ä¸èƒ½æé«˜æ‰§è¡Œæ•ˆç‡ã€‚æ‰€ä»¥åœ¨Pythonä¸­ï¼Œæ›´å¤šæé«˜æ‰§è¡Œæ•ˆç‡çš„ç¼–ç¨‹æ¨¡å‹æ˜¯ï¼šåç¨‹ã€‚</p>
<p>ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿç®€å•æ¥è¯´ï¼Œç”±å¤šä¸ªç¨‹åºå—ç»„åˆåä½œæ‰§è¡Œçš„ç¨‹åºï¼Œç§°ä¹‹ä¸ºåç¨‹ã€‚å¯èƒ½è¿™ä¹ˆè¯´è¿˜æ˜¯å¤ªè¿‡æ¨¡ç³Šï¼Œæˆ‘ä»¬ç”¨<code>yield</code>å®ç°ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def consumer():</span><br><span class="line">    i &#x3D; None</span><br><span class="line">    while True:</span><br><span class="line">        j &#x3D; yield i  # æ‹¿åˆ°producerå‘æ¥çš„æ•°æ®</span><br><span class="line">        print(&#39;consume %s&#39; % j)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def producer(c):</span><br><span class="line">    next(c)</span><br><span class="line">    for i in range(5):</span><br><span class="line">        print(&#39;produce %s&#39; % i)</span><br><span class="line">        c.send(i)  # å‘æ•°æ®ç»™consumer</span><br><span class="line">    c.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c &#x3D; consumer()</span><br><span class="line">producer(c)</span><br><span class="line"></span><br><span class="line"># output</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">produce 0</span><br><span class="line">consume 0</span><br><span class="line">produce 1</span><br><span class="line">consume 1</span><br><span class="line">produce 2</span><br><span class="line">consume 2</span><br><span class="line">produce 3</span><br><span class="line">consume 3</span><br><span class="line">produce 4</span><br><span class="line">consume 4</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªç¨‹åºæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>c = consumer()</code>åˆ›å»ºä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</li>
<li><code>producer(c)</code>å¼€å§‹æ‰§è¡Œä»£ç ï¼Œ<code>next(c)</code>ä¼šå¯åŠ¨ç”Ÿæˆå™¨<code>consumer</code>ç›´åˆ°ä»£ç è¿è¡Œåˆ°<code>j = yield i</code>å¤„ï¼Œæ­¤æ—¶<code>consumer</code>ç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›</li>
<li><code>producer</code>å‡½æ•°ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œç›´åˆ°<code>c.send(i)</code>ï¼Œåˆ©ç”¨ç”Ÿæˆå™¨çš„<code>send</code>æ–¹æ³•ï¼Œå‘<code>consumer</code>å‘é€æ•°æ®</li>
<li><code>consumer</code>å‡½æ•°è¢«å”¤é†’ï¼Œä»<code>j = yield i</code>å¤„å¼€å§‹æ‰§è¡Œï¼Œå¹¶æ¥æ”¶<code>producer</code>ä¼ æ¥çš„æ•°æ®èµ‹å€¼ç»™jï¼Œç„¶åæ‰“å°è¾“å‡ºï¼Œç›´åˆ°å†æ¬¡æ‰§è¡Œåˆ°<code>yield</code>å¤„ï¼Œè¿”å›</li>
<li><code>producer</code>ç»§ç»­æ‰§è¡Œå¾ªç¯ï¼Œæ‰§è¡Œä¸Šé¢çš„è¿‡ç¨‹ï¼Œé€ä¸ªå‘é€æ•°æ®ç»™<code>cosnumer</code>ï¼Œç›´åˆ°å¾ªç¯ç»“æŸ</li>
<li>æœ€ç»ˆ<code>c.close()</code>å…³é—­<code>consumer</code>ç”Ÿæˆå™¨ï¼Œç¨‹åºé€€å‡º<br>åœ¨ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å‘ç°ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼Œåœ¨<code>producer</code>å’Œ<code>consumer</code>è¿™2ä¸ªå‡½æ•°ä¹‹é—´æ¥å›åˆ‡æ¢æ‰§è¡Œï¼Œå®Œæˆäº†ç”Ÿäº§ä»»åŠ¡ã€æ¶ˆè´¹ä»»åŠ¡çš„åœºæ™¯ï¼Œè€Œä¸”æ•´ä¸ªç¨‹åºè¿è¡Œåœ¨å•è¿›ç¨‹å•çº¿ç¨‹ä¸‹ã€‚<br>è¿™å…¶ä¸­çš„åŸç†å°±æ˜¯åˆ©ç”¨äº†ç”Ÿæˆå™¨çš„<code>yield</code>å…³é”®å­—ä»¥åŠç”Ÿæˆå™¨çš„<code>next</code>å’Œ<code>send</code>æ–¹æ³•ã€‚<br>è¿™ä¹ˆåšçš„å¥½å¤„åœ¨äºï¼š</li>
<li>æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ— é”ï¼Œç¼–ç¨‹å¤æ‚åº¦é™ä½</li>
<li>ç¨‹åºåœ¨å‡½æ•°ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œæ˜¯åœ¨ç”¨æˆ·æ€ä¸‹è¿›è¡Œçš„ï¼Œä¸åƒè¿›ç¨‹/çº¿ç¨‹åˆ‡æ¢é™·å…¥å†…æ ¸çŠ¶æ€ï¼Œæ²¡æœ‰å†…æ ¸æ€çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ŒæŸè€—æ›´å°ï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜</li>
</ul>
<p>Pythonçš„ç”Ÿæˆå™¨å®ç°äº†åç¨‹çš„ç¼–ç¨‹æ–¹å¼ï¼Œä¸ºç¨‹åºçš„å¹¶å‘æ‰§è¡Œæä¾›äº†ç¼–ç¨‹åŸºç¡€ã€‚<br>Pythonçš„å¾ˆå¤šç¬¬ä¸‰æ–¹åŒ…éƒ½æ˜¯åŸºäºè¿™ä¸€ç‰¹æ€§è¿›è¡Œå°è£…çš„ï¼Œä¾‹å¦‚<code>geventã€tornado</code>ï¼Œå®ƒä»¬éƒ½å¤§å¤§æé«˜äº†ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²äº†Pythonä¸­ç”Ÿæˆå™¨ä¸<code>yield</code>çš„ç›¸å…³çŸ¥è¯†ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”Ÿæˆå™¨åœ¨ç”Ÿæˆå¾ˆå¤§çš„åˆ—è¡¨çš„åœºæ™¯ï¼Œèƒ½å¤ŸèŠ‚çœå†…å­˜ç©ºé—´çš„å ç”¨</li>
<li>åœ¨å¤æ‚é€»è¾‘å—ç”Ÿæˆåˆ—è¡¨å…ƒç´ æ—¶ï¼Œä½¿ç”¨<code>yield</code>èƒ½æå¤§ç®€åŒ–ä»£ç ç»“æ„</li>
<li>ç”Ÿæˆå™¨çš„ç‰¹æ€§ä¸ºPythonçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹â€”â€”åç¨‹ï¼Œæä¾›äº†ç¼–ç¨‹åŸºç¡€</li>
</ul>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://kaito-kidd.com/2018/05/21/python-advance-yield/" target="_blank" rel="noopener">åŸæ–‡å‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Redisé›†ç¾¤éƒ¨ç½²</title>
    <url>/2020/04/23/Redis%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h2 id="Redisé›†ç¾¤éƒ¨ç½²"><a href="#Redisé›†ç¾¤éƒ¨ç½²" class="headerlink" title="Redisé›†ç¾¤éƒ¨ç½²"></a>Redisé›†ç¾¤éƒ¨ç½²</h2><h2 id="Redisé›†ç¾¤éƒ¨ç½²-1"><a href="#Redisé›†ç¾¤éƒ¨ç½²-1" class="headerlink" title="Redisé›†ç¾¤éƒ¨ç½²"></a>Redisé›†ç¾¤éƒ¨ç½²</h2><ol>
<li>ç¼–è¯‘å®‰è£…<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;src&#x2F;</span><br><span class="line"># wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-5.0.0.tar.gz</span><br><span class="line"># tar zxvf redis-5.0.0.tar.gz</span><br><span class="line"># apt-get update &amp;&amp; apt-get install -y gcc automake make</span><br><span class="line"># cd redis-5.0.0 &amp;&amp; make &amp;&amp; make install</span><br><span class="line"># cp .&#x2F;src&#x2F;redis-server &#x2F;usr&#x2F;bin&#x2F;</span><br><span class="line"># cp .&#x2F;src&#x2F;redis-cli &#x2F;usr&#x2F;bin&#x2F;</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºæœåŠ¡å¯åœè„šæœ¬(å¦‚æœéœ€è¦)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cp .&#x2F;utils&#x2F;redis_init_script &#x2F;etc&#x2F;init.d&#x2F;redisd</span><br><span class="line"># service redisd start</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºç›®å½•åŠé…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mkdir &#x2F;tmp&#x2F;redis-cluster&#x2F;&#123;7000,7001,7002,7003,7004,7005&#125;&#x2F;log -pv</span><br><span class="line"># cp &#x2F;usr&#x2F;local&#x2F;src&#x2F;redis-5.0.0&#x2F;redis.conf &#x2F;data&#x2F;redis-cluster&#x2F;7000&#x2F;redis.conf</span><br><span class="line"># cd &#x2F;data&#x2F;redis-cluster&#x2F; &amp;&amp; cat 7000&#x2F;redis.conf</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">protected-mode yes</span><br><span class="line">port 7000</span><br><span class="line">tcp-backlog 511</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">daemonize yes</span><br><span class="line">supervised no</span><br><span class="line">pidfile &#x2F;var&#x2F;run&#x2F;redis_7000.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;&#x2F;data&#x2F;redis-cluster&#x2F;7000&#x2F;log&#x2F;redis-7000.log&quot;</span><br><span class="line">databases 16</span><br><span class="line">always-show-logo yes</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line">dir .&#x2F;</span><br><span class="line">replica-serve-stale-data yes</span><br><span class="line">replica-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">replica-priority 100</span><br><span class="line">lazyfree-lazy-eviction no</span><br><span class="line">lazyfree-lazy-expire no</span><br><span class="line">lazyfree-lazy-server-del no</span><br><span class="line">replica-lazy-flush no</span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">aof-use-rdb-preamble yes</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 15000</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line">slowlog-max-len 128</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">stream-node-max-bytes 4096</span><br><span class="line">stream-node-max-entries 100</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit replica 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">dynamic-hz yes</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line">rdb-save-incremental-fsync yes</span><br><span class="line">masterauth AuDdQdpuEZpXgNthP6CjYjPb</span><br><span class="line">requirepass AuDdQdpuEZpXgNthP6CjYjPb</span><br><span class="line">ä¿®æ”¹å…¶ä»–ç«¯å£é…ç½®æ–‡ä»¶</span><br><span class="line"># cp 7000&#x2F;redis.conf 7001&#x2F;</span><br><span class="line"># cp 7000&#x2F;redis.conf 7002&#x2F;</span><br><span class="line"># cp 7000&#x2F;redis.conf 7003&#x2F;</span><br><span class="line"># cp 7000&#x2F;redis.conf 7004&#x2F;</span><br><span class="line"># cp 7000&#x2F;redis.conf 7005&#x2F;</span><br><span class="line"># sed -i &#39;s&#x2F;7000&#x2F;7001&#x2F;g&#39; 7001&#x2F;redis.conf</span><br><span class="line"># sed -i &#39;s&#x2F;7000&#x2F;7002&#x2F;g&#39; 7002&#x2F;redis.conf</span><br><span class="line"># sed -i &#39;s&#x2F;7000&#x2F;7003&#x2F;g&#39; 7003&#x2F;redis.conf</span><br><span class="line"># sed -i &#39;s&#x2F;7000&#x2F;7004&#x2F;g&#39; 7004&#x2F;redis.conf</span><br><span class="line"># sed -i &#39;s&#x2F;7000&#x2F;7005&#x2F;g&#39; 7005&#x2F;redis.conf</span><br></pre></td></tr></table></figure></li>
<li>è°ƒæ•´ä¸‹å†…å­˜åˆ†é…ä½¿ç”¨æ–¹å¼å¹¶ä½¿å…¶ç”Ÿæ•ˆ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#æ­¤å‚æ•°å¯ç”¨çš„å€¼ä¸º0,1,2 </span><br><span class="line">#0è¡¨ç¤ºå½“ç”¨æˆ·ç©ºé—´è¯·æ±‚æ›´å¤šçš„å†…å­˜æ—¶ï¼Œå†…æ ¸å°è¯•ä¼°ç®—å‡ºå¯ç”¨çš„å†…å­˜ </span><br><span class="line">#1è¡¨ç¤ºå†…æ ¸å…è®¸è¶…é‡ä½¿ç”¨å†…å­˜ç›´åˆ°å†…å­˜ç”¨å®Œä¸ºæ­¢ </span><br><span class="line">#2è¡¨ç¤ºæ•´ä¸ªå†…å­˜åœ°å€ç©ºé—´ä¸èƒ½è¶…è¿‡swap+(vm.overcommit_ratio)%çš„RAMå€¼ </span><br><span class="line">echo &quot;vm.overcommit_memory&#x3D;1&quot;&gt;&gt;&#x2F;etc&#x2F;sysctl.conf</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></li>
<li>åˆ¶ä½œå¯åŠ¨è„šæœ¬<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat start-redis-cluster.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">cd &#x2F;data&#x2F;redis-cluster</span><br><span class="line"></span><br><span class="line">cd 7000 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7000&#x2F;redis.conf</span><br><span class="line">cd ..&#x2F;7001 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7001&#x2F;redis.conf</span><br><span class="line">cd ..&#x2F;7002 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7002&#x2F;redis.conf</span><br><span class="line">cd ..&#x2F;7003 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7003&#x2F;redis.conf</span><br><span class="line">cd ..&#x2F;7004 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7004&#x2F;redis.conf</span><br><span class="line">cd ..&#x2F;7005 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;redis-server &#x2F;data&#x2F;redis-cluster&#x2F;7005&#x2F;redis.conf</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨æœåŠ¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># bash start-redis-cluster.sh</span><br><span class="line"># ps -ef|grep redis</span><br><span class="line">root     30192     1  0 06:54 ?        00:00:04 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7000 [cluster]</span><br><span class="line">root     30194     1  0 06:54 ?        00:00:05 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7001 [cluster]</span><br><span class="line">root     30196     1  0 06:54 ?        00:00:04 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7002 [cluster]</span><br><span class="line">root     30201     1  0 06:54 ?        00:00:04 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7003 [cluster]</span><br><span class="line">root     30206     1  0 06:54 ?        00:00:05 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7004 [cluster]</span><br><span class="line">root     30211     1  0 06:54 ?        00:00:04 &#x2F;usr&#x2F;bin&#x2F;redis-server 0.0.0.0:7005 [cluster]</span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºé›†ç¾¤<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># redis-cli --cluster create 10.20.71.215:7000 10.20.73.204:7001 10.20.71.67:7002 10.20.71.215:7003 10.20.73.204:7004 10.20.71.67:7005 --cluster-replicas 1 -a AuDdQdpuEZpXgNthP6CjYjPb</span><br></pre></td></tr></table></figure></li>
<li>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-t001:&#x2F;usr&#x2F;local&#x2F;src&#x2F;redis-5.0.0# redis-cli -c -p 7000</span><br><span class="line">127.0.0.1:7000&gt; auth AuDdQdpuEZpXgNthP6CjYjPb</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:7000&gt; cluster nodes</span><br><span class="line">ab8eeb87cc65dd14d03b8ac1b1e8cf7956cec1f5 10.20.71.67:7005@17005 slave 113373eeb8450caf99f8bef80f7cf5e8be41f370 0 1556958626898 6 connected</span><br><span class="line">387497dd41e34c90f4ccfa5909e2c63987d2f0d6 10.20.71.67:7002@17002 master - 0 1556958624893 3 connected 10923-16383</span><br><span class="line">356ac5e0988889a793c055b99c1abff6579ba322 10.20.73.204:7004@17004 slave 387497dd41e34c90f4ccfa5909e2c63987d2f0d6 0 1556958625000 5 connected</span><br><span class="line">3c1d7c057ac1d325fcf63895ae52733242abc72b 10.20.73.204:7001@17001 master - 0 1556958625000 2 connected 5461-10922</span><br><span class="line">113373eeb8450caf99f8bef80f7cf5e8be41f370 10.20.71.215:7000@17000 myself,master - 0 1556958625000 1 connected 0-5460</span><br><span class="line">54c72a2901af3dd72cbbb816bd6c5283eec6eec9 10.20.71.215:7003@17003 slave 3c1d7c057ac1d325fcf63895ae52733242abc72b 0 1556958625894 4 connected</span><br></pre></td></tr></table></figure>
æ§åˆ¶å°ä¿¡æ¯æ˜¾ç¤º: å½“å‰é›†ç¾¤ä¸­å­˜åœ¨3ä¸ªä¸»èŠ‚ç‚¹å’Œ3ä¸ªä»èŠ‚ç‚¹ï¼Œè¯´æ˜æˆ‘ä»¬çš„é›†ç¾¤å·²ç»æ­å»ºæˆåŠŸ<br>è‡³æ­¤ï¼ŒRedis Clusteré›†ç¾¤å°±æ­å»ºå®Œæˆäº†!</li>
<li>æµ‹è¯•æ•°æ®<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-t001:~# redis-cli -h 10.20.73.204 -p 7001</span><br><span class="line">10.20.73.204:7001&gt; auth AuDdQdpuEZpXgNthP6CjYjPb</span><br><span class="line">OK</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt; set name shuke</span><br><span class="line">OK</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt;</span><br><span class="line">10.20.73.204:7001&gt; get name</span><br><span class="line">&quot;shuke&quot;</span><br></pre></td></tr></table></figure></li>
<li>cluster saveconfig<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å°†èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¿å­˜åˆ°ç¡¬ç›˜é‡Œé¢.</span><br><span class="line">è¯•ä¸€ä¸‹ï¼š</span><br><span class="line">127.0.0.1:7009&gt; cluster saveconfig</span><br><span class="line">OK</span><br><span class="line">okè¯´æ˜æˆåŠŸäº†,å®ƒä¼šè¦†ç›–é…ç½®æ–‡ä»¶å¤¹é‡Œçš„nodes.confæ–‡ä»¶.è¿™æ ·åšæ˜¯ä¸ºäº†æŸç§æƒ…å†µä¸‹nodesæ–‡ä»¶ä¸¢å¤±,è¿™æ ·å°±ä¼šç”Ÿæˆä¸€ä¸ªæœ€æ–°çš„èŠ‚ç‚¹é…ç½®æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>Tips :</p>
<ol>
<li>å¦‚æœæƒ³é‡æ–°åˆ›å»ºé›†ç¾¤ï¼Œéœ€è¦ç™»å½•åˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œflushdbï¼Œç„¶åæ‰§è¡Œcluster resetï¼Œé‡å¯èŠ‚ç‚¹;</li>
</ol>
<h3 id="é›†ç¾¤ç®¡ç†"><a href="#é›†ç¾¤ç®¡ç†" class="headerlink" title="é›†ç¾¤ç®¡ç†"></a>é›†ç¾¤ç®¡ç†</h3><p><a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">Redis é›†ç¾¤æ•™ç¨‹</a><br><a href="http://blog.huangz.me/2018/redis-cluster-manage-cheatsheet.html" target="_blank" rel="noopener">é›†ç¾¤ç®¡ç†å¸¸è§æ“ä½œ</a><br><a href="https://www.zybuluo.com/phper/note/205009" target="_blank" rel="noopener">å¸¸ç”¨å‘½ä»¤</a></p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://hoxis.github.io/redis-sentinel-ha.html" target="_blank" rel="noopener">Redis é«˜å¯ç”¨éƒ¨ç½²æ–¹æ¡ˆ</a><br><a href="https://wizardforcel.gitbooks.io/redis-doc/content/doc/9.html" target="_blank" rel="noopener">Redisé›†ç¾¤è§„èŒƒ</a></p>
]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢å‘å¯¹è±¡å…¥é—¨æ•™ç¨‹</title>
    <url>/2020/04/23/Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="Pythoné¢å‘å¯¹è±¡å…¥é—¨æ•™ç¨‹"><a href="#Pythoné¢å‘å¯¹è±¡å…¥é—¨æ•™ç¨‹" class="headerlink" title="Pythoné¢å‘å¯¹è±¡å…¥é—¨æ•™ç¨‹"></a>Pythoné¢å‘å¯¹è±¡å…¥é—¨æ•™ç¨‹</h2><blockquote>
<p>é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ï¼ˆé¢å‘è¿‡ç¨‹ç¼–ç¨‹ï¼‰éƒ½æ˜¯ç¨‹åºè®¾è®¡çš„æ–¹æ³•ï¼Œä¸è¿‡ç¨æœ‰åŒºåˆ«</p>
</blockquote>
<h3 id="é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹åŒºåˆ«"><a href="#é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹åŒºåˆ«" class="headerlink" title="é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹åŒºåˆ«"></a>é¢å‘è¿‡ç¨‹ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹åŒºåˆ«</h3><ol>
<li>é¢å‘è¿‡ç¨‹ç¼–ç¨‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. å¯¼å…¥å„ç§å¤–éƒ¨åº“</span><br><span class="line">2. è®¾è®¡å„ç§å…¨å±€å˜é‡</span><br><span class="line">3. å†™ä¸€ä¸ªå‡½æ•°å®ŒæˆæŸä¸ªåŠŸèƒ½</span><br><span class="line">4. å†™ä¸€ä¸ªå‡½æ•°å®ŒæˆæŸä¸ªåŠŸèƒ½</span><br><span class="line">5. å†™ä¸€ä¸ªå‡½æ•°å®ŒæˆæŸä¸ªåŠŸèƒ½</span><br><span class="line">6. å†™ä¸€ä¸ªå‡½æ•°å®ŒæˆæŸä¸ªåŠŸèƒ½</span><br><span class="line">7. å†™ä¸€ä¸ªå‡½æ•°å®ŒæˆæŸä¸ªåŠŸèƒ½</span><br><span class="line">8. ......</span><br><span class="line">9. å†™ä¸€ä¸ªmainå‡½æ•°ä½œä¸ºç¨‹åºå…¥å£</span><br></pre></td></tr></table></figure>
åœ¨å¤šå‡½æ•°ç¨‹åºä¸­ï¼Œè®¸å¤šé‡è¦çš„æ•°æ®è¢«æ”¾ç½®åœ¨å…¨å±€æ•°æ®åŒºï¼Œè¿™æ ·å®ƒä»¬å¯ä»¥è¢«æ‰€æœ‰çš„å‡½æ•°è®¿é—®ã€‚æ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥å…·æœ‰å®ƒä»¬è‡ªå·±çš„å±€éƒ¨æ•°æ®ï¼Œå°†æŸäº›åŠŸèƒ½ä»£ç å°è£…åˆ°å‡½æ•°ä¸­ï¼Œæ—¥åä¾¿æ— éœ€é‡å¤ç¼–å†™ï¼Œä»…è°ƒç”¨å‡½æ•°å³å¯ã€‚ä»ä»£ç çš„ç»„ç»‡å½¢å¼æ¥çœ‹å°±æ˜¯æ ¹æ®ä¸šåŠ¡é€»è¾‘ä»ä¸Šåˆ°ä¸‹å’ä»£ç ,ç¨‹åºä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œ.</li>
<li>é¢å‘å¯¹è±¡ç¼–ç¨‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. å¯¼å…¥å„ç§å¤–éƒ¨åº“</span><br><span class="line">2. è®¾è®¡å„ç§å…¨å±€å˜é‡</span><br><span class="line">3. å†³å®šä½ è¦çš„ç±»</span><br><span class="line">4. ç»™æ¯ä¸ªç±»æä¾›å®Œæ•´çš„ä¸€ç»„æ“ä½œ</span><br><span class="line">5. æ˜ç¡®åœ°ä½¿ç”¨ç»§æ‰¿æ¥è¡¨ç°ä¸åŒç±»ä¹‹é—´çš„å…±åŒç‚¹</span><br><span class="line">6. æ ¹æ®éœ€è¦ï¼Œå†³å®šæ˜¯å¦å†™ä¸€ä¸ªmainå‡½æ•°ä½œä¸ºç¨‹åºå…¥å£</span><br></pre></td></tr></table></figure>
é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå°†å‡½æ•°å’Œå˜é‡è¿›ä¸€æ­¥å°è£…æˆç±»ï¼Œç±»æ‰æ˜¯ç¨‹åºçš„åŸºæœ¬å…ƒç´ ï¼Œå®ƒå°†æ•°æ®å’Œæ“ä½œç´§å¯†åœ°è¿ç»“åœ¨ä¸€èµ·ï¼Œå¹¶ä¿æŠ¤æ•°æ®ä¸ä¼šè¢«å¤–ç•Œçš„å‡½æ•°æ„å¤–åœ°æ”¹å˜ã€‚ç±»å’Œå’Œç±»çš„å®ä¾‹(ä¹Ÿç§°å¯¹è±¡)æ˜¯é¢å‘å¯¹è±¡çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ˜¯å’Œé¢å‘è¿‡ç¨‹ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹çš„æ ¹æœ¬åŒºåˆ«ã€‚</li>
</ol>
<p>âš ï¸ å¹¶ä¸æ˜¯éè¦ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œè¦çœ‹ä½ çš„ç¨‹åºæ€ä¹ˆè®¾è®¡æ–¹ä¾¿ï¼Œä½†æ˜¯å°±ç›®å‰æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</p>
<h3 id="ç±»çš„åŸºæœ¬ç”¨æ³•"><a href="#ç±»çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="ç±»çš„åŸºæœ¬ç”¨æ³•"></a>ç±»çš„åŸºæœ¬ç”¨æ³•</h3><p>é¢å‘å¯¹è±¡æ˜¯é€šè¿‡å®šä¹‰classç±»æ¥å®šä¹‰ï¼Œè¿™ä¹ˆè¯´é¢å‘å¯¹è±¡ç¼–ç¨‹å°±æ˜¯åªä½¿ç”¨classç±»ï¼Œåœ¨classç±»ä¸­æœ‰å°è£…ï¼Œç»§æ‰¿çš„åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æ„é€ è¦ä¼ å…¥çš„å‚æ•°ï¼Œæ–¹ä¾¿æ§åˆ¶ã€‚</p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">class studetn:</span><br><span class="line">    # å®šä¹‰ä¸€ä¸ªç±»åä¸ºstudetn</span><br><span class="line">    def __init__(self,idx):</span><br><span class="line">    # å®šä¹‰åˆå§‹åŒ–æ„é€ ï¼Œè¿™é‡Œä½¿ç”¨initï¼Œè¿˜æœ‰åˆ«çš„å±æ€§æ¯”å¦‚reversedï¼Œiterä¹‹ç±»çš„</span><br><span class="line">        self.idx&#x3D;idx</span><br><span class="line">        self.age &#x3D; 18</span><br><span class="line">        # åˆå§‹åŒ–å˜é‡ï¼Œæ–¹ä¾¿ç»§æ‰¿</span><br><span class="line">        </span><br><span class="line">    def runx(self):</span><br><span class="line">    # å®šä¹‰è¿è¡Œå‡½æ•°ï¼Œä»ä¸Šé¢ç»§æ‰¿å˜é‡</span><br><span class="line">        print(self.idx)</span><br><span class="line">        time.sleep(1)</span><br><span class="line"></span><br><span class="line"># è¿™æ˜¯ç±»çš„è°ƒç”¨ï¼Œä¸€å®šè¦è®°å¾—ç±»çš„ä½¿ç”¨æ–¹æ³•ï¼Œé¦–å…ˆä¼ å…¥å‚æ•°ï¼Œç±»èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡a</span><br><span class="line"># ç„¶åè°ƒç”¨è¿™ä¸ªç±»ä¸‹é¢å®šä¹‰çš„å‡½æ•°        </span><br><span class="line">a&#x3D;studetn(&#39;a&#39;)</span><br><span class="line">a.runx()</span><br></pre></td></tr></table></figure>
<p>æœ¯è¯­ä»‹ç»:</p>
<ol>
<li>ç±»(Class): ç”¨æ¥æè¿°å…·æœ‰ç›¸åŒå±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡çš„é›†åˆã€‚å®ƒå®šä¹‰äº†è¯¥é›†åˆä¸­æ¯ä¸ªå¯¹è±¡æ‰€å…±æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚å…¶ä¸­çš„å¯¹è±¡è¢«ç§°ä½œç±»çš„å®ä¾‹ã€‚</li>
<li>å®ä¾‹ï¼šä¹Ÿç§°å¯¹è±¡ã€‚é€šè¿‡ç±»å®šä¹‰çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œèµ‹äºˆå…·ä½“çš„å€¼ï¼Œæˆä¸ºä¸€ä¸ªâ€æœ‰è¡€æœ‰è‚‰çš„å®ä½“â€ã€‚</li>
<li>å®ä¾‹åŒ–ï¼šåˆ›å»ºç±»çš„å®ä¾‹çš„è¿‡ç¨‹æˆ–æ“ä½œã€‚</li>
<li>å®ä¾‹å˜é‡ï¼šå®šä¹‰åœ¨å®ä¾‹ä¸­çš„å˜é‡ï¼Œåªä½œç”¨äºå½“å‰å®ä¾‹ã€‚</li>
<li>ç±»å˜é‡ï¼šç±»å˜é‡æ˜¯æ‰€æœ‰å®ä¾‹å…¬æœ‰çš„å˜é‡ã€‚ç±»å˜é‡å®šä¹‰åœ¨ç±»ä¸­ï¼Œä½†åœ¨æ–¹æ³•ä½“ä¹‹å¤–ã€‚</li>
<li>æ•°æ®æˆå‘˜ï¼šç±»å˜é‡ã€å®ä¾‹å˜é‡ã€æ–¹æ³•ã€ç±»æ–¹æ³•ã€é™æ€æ–¹æ³•å’Œå±æ€§ç­‰çš„ç»Ÿç§°ã€‚</li>
<li>æ–¹æ³•ï¼šç±»ä¸­å®šä¹‰çš„å‡½æ•°ã€‚</li>
<li>é™æ€æ–¹æ³•ï¼šä¸éœ€è¦å®ä¾‹åŒ–å°±å¯ä»¥ç”±ç±»æ‰§è¡Œçš„æ–¹æ³•</li>
<li>ç±»æ–¹æ³•ï¼šç±»æ–¹æ³•æ˜¯å°†ç±»æœ¬èº«ä½œä¸ºå¯¹è±¡è¿›è¡Œæ“ä½œçš„æ–¹æ³•ã€‚</li>
<li>æ–¹æ³•é‡å†™ï¼šå¦‚æœä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹çˆ¶ç±»çš„æ–¹æ³•è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°overrideã€‚</li>
<li>å°è£…ï¼šå°†å†…éƒ¨å®ç°åŒ…è£¹èµ·æ¥ï¼Œå¯¹å¤–é€æ˜ï¼Œæä¾›apiæ¥å£è¿›è¡Œè°ƒç”¨çš„æœºåˆ¶</li>
<li>ç»§æ‰¿ï¼šå³ä¸€ä¸ªæ´¾ç”Ÿç±»(derived class)ç»§æ‰¿çˆ¶ç±»(base class)çš„å˜é‡å’Œæ–¹æ³•ã€‚</li>
<li>å¤šæ€ï¼šæ ¹æ®å¯¹è±¡ç±»å‹çš„ä¸åŒä»¥ä¸åŒçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚</li>
</ol>
<h4 id="ç±»ä¸å®ä¾‹"><a href="#ç±»ä¸å®ä¾‹" class="headerlink" title="ç±»ä¸å®ä¾‹"></a>ç±»ä¸å®ä¾‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: ec2.py </span><br><span class="line">@time: 2019&#x2F;03&#x2F;14 10:52</span><br><span class="line">@contact: zhaofengfeng@wecash.net</span><br><span class="line">@software:  learn</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">class cc:</span><br><span class="line">    ccc &#x3D; &#39;ccc&#39;</span><br><span class="line">    # ccå°±æ˜¯ç±»å å¦‚æœæƒ³è¦ç»§æ‰¿åˆ«çš„ç±» å°±class cc(threading) æ„æ€å°±æ˜¯ä»threadingç»§æ‰¿</span><br><span class="line">    def __init__(self,a,b,c):</span><br><span class="line">        self.a&#x3D;a</span><br><span class="line">        self.b&#x3D;b</span><br><span class="line">        self.c&#x3D;c</span><br><span class="line">        # å®šä¹‰æ„é€ çš„è¿‡ç¨‹å°±æ˜¯å®ä¾‹åŒ–</span><br><span class="line">    def runx(self):</span><br><span class="line">        print self.a*10</span><br><span class="line">        print self.b*5</span><br><span class="line">        print self.c*2</span><br><span class="line">    def runy(self):</span><br><span class="line">        print requests.get(&#39;http:&#x2F;&#x2F;www.langzi.fun&#39;).headers</span><br><span class="line">e &#x3D; cc(&#39;AAA&#39;,&#39;CCC&#39;,&#39;EEE&#39;)</span><br><span class="line">e.runx()</span><br><span class="line">e.runy()</span><br><span class="line"># è¿™ä¸¤ä¸ªå°±æ˜¯è°ƒç”¨ç±»é‡Œé¢çš„æ–¹æ³•</span><br><span class="line">print e.c</span><br><span class="line">#å®ä¾‹å˜é‡æŒ‡çš„æ˜¯å®ä¾‹æœ¬èº«æ‹¥æœ‰çš„å˜é‡ã€‚æ¯ä¸ªå®ä¾‹çš„å˜é‡åœ¨å†…å­˜ä¸­éƒ½ä¸ä¸€æ ·ã€‚</span><br><span class="line">print e.ccc</span><br><span class="line">#ç±»å˜é‡ï¼Œåœ¨ç±»é‡Œé¢æ‰¾åˆ°å®šä¹‰çš„å˜é‡ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="è°ƒç”¨ç±»çš„ä¸‰ç§æ–¹æ³•"><a href="#è°ƒç”¨ç±»çš„ä¸‰ç§æ–¹æ³•" class="headerlink" title="è°ƒç”¨ç±»çš„ä¸‰ç§æ–¹æ³•"></a>è°ƒç”¨ç±»çš„ä¸‰ç§æ–¹æ³•</h4><ol>
<li>å®ä¾‹æ–¹æ³•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">class dd:</span><br><span class="line">    def __init__(self,url):</span><br><span class="line">        self.url&#x3D;url</span><br><span class="line">    def runx(self):</span><br><span class="line">        print requests.get(self.url).status_code</span><br><span class="line"></span><br><span class="line">a &#x3D; dd(&#39;http:&#x2F;&#x2F;www.langzi.fun&#39;)</span><br><span class="line">a.runx()</span><br><span class="line"># è¿™ç§è°ƒç”¨æ–¹æ³•å°±æ˜¯å®ä¾‹æ–¹æ³•</span><br></pre></td></tr></table></figure></li>
<li>é™æ€æ–¹æ³•<blockquote>
<p>é™æ€æ–¹æ³•ç”±ç±»è°ƒç”¨ï¼Œæ— é»˜è®¤å‚æ•°ã€‚å°†å®ä¾‹æ–¹æ³•å‚æ•°ä¸­çš„selfå»æ‰ï¼Œç„¶ååœ¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹åŠ ä¸Š<code>@staticmethod</code>ï¼Œå°±æˆä¸ºé™æ€æ–¹æ³•ã€‚å®ƒå±äºç±»ï¼Œå’Œå®ä¾‹æ— å…³ã€‚å»ºè®®åªä½¿ç”¨ç±»å.é™æ€æ–¹æ³•çš„è°ƒç”¨æ–¹å¼ã€‚ï¼ˆè™½ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å®ä¾‹å.é™æ€æ–¹æ³•çš„æ–¹å¼è°ƒç”¨ï¼‰</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line">class ff:</span><br><span class="line">    @staticmethod</span><br><span class="line">    def runx():</span><br><span class="line">        print requests.get(&#39;http:&#x2F;&#x2F;www.langzi.fun&#39;).status_code</span><br><span class="line">ff.runx()</span><br><span class="line">#è¿™é‡Œå°±ç›´æ¥è°ƒç”¨äº†ç±»çš„å˜é‡ï¼Œåªåœ¨ç±»ä¸­è¿è¡Œè€Œä¸åœ¨å®ä¾‹ä¸­è¿è¡Œçš„æ–¹æ³•</span><br></pre></td></tr></table></figure>
ç»å¸¸æœ‰ä¸€äº›è·Ÿç±»æœ‰å…³ç³»çš„åŠŸèƒ½ä½†åœ¨è¿è¡Œæ—¶åˆä¸éœ€è¦å®ä¾‹å’Œç±»å‚ä¸çš„æƒ…å†µä¸‹éœ€è¦ç”¨åˆ°é™æ€æ–¹æ³•. æ¯”å¦‚æ›´æ”¹ç¯å¢ƒå˜é‡æˆ–è€…ä¿®æ”¹å…¶ä»–ç±»çš„å±æ€§ç­‰èƒ½ç”¨åˆ°é™æ€æ–¹æ³•. è¿™ç§æƒ…å†µå¯ä»¥ç›´æ¥ç”¨å‡½æ•°è§£å†³, ä½†è¿™æ ·åŒæ ·ä¼šæ‰©æ•£ç±»å†…éƒ¨çš„ä»£ç ï¼Œé€ æˆç»´æŠ¤å›°éš¾ã€‚</li>
<li>ç±»æ–¹æ³•<blockquote>
<p>ç±»æ–¹æ³•ç”±ç±»è°ƒç”¨ï¼Œé‡‡ç”¨<code>@classmethod</code>è£…é¥°ï¼Œè‡³å°‘ä¼ å…¥ä¸€ä¸ªclsï¼ˆä»£æŒ‡ç±»æœ¬èº«ï¼Œç±»ä¼¼selfï¼‰å‚æ•°ã€‚æ‰§è¡Œç±»æ–¹æ³•æ—¶ï¼Œè‡ªåŠ¨å°†è°ƒç”¨è¯¥æ–¹æ³•çš„ç±»èµ‹å€¼ç»™clsã€‚å»ºè®®åªä½¿ç”¨ç±»å.ç±»æ–¹æ³•çš„è°ƒç”¨æ–¹å¼ã€‚ï¼ˆè™½ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å®ä¾‹å.ç±»æ–¹æ³•çš„æ–¹å¼è°ƒç”¨ï¼‰<br>å¦‚æœè¦æ„é€ ä¸€ä¸ªç±»ï¼Œæ¥å—ä¸€ä¸ªç½‘ç«™å’Œè¿™ä¸ªç½‘ç«™çš„çŠ¶æ€ç ï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚å°±åƒè¿™æ ·ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line">class gg:</span><br><span class="line">    def __init__(self,url,stat):</span><br><span class="line">        self.url&#x3D;url</span><br><span class="line">        self.stat&#x3D;stat</span><br><span class="line">    def outer(self):</span><br><span class="line">        print self.url</span><br><span class="line">        print self.stat</span><br><span class="line">a &#x3D; gg(&#39;langzi&#39;,200)</span><br><span class="line">a.outer()</span><br></pre></td></tr></table></figure>
è¿™æ ·å°±æ˜¯ä½¿ç”¨å®ä¾‹æ–¹æ³•ï¼Œè™½ç„¶å¯ä»¥å®ç°ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¼ å…¥çš„å‚æ•°å¹¶ä¸æ˜¯(â€˜shukeâ€™,200)è¿™æ ·çš„æ ¼å¼ï¼Œè€Œæ˜¯(â€˜shuke-200â€™)è¿™æ ·çš„ï¼Œé‚£è¯¥æ€ä¹ˆåšï¼Ÿé¦–å…ˆè¦æŠŠè¿™ä¸ªæ‹†åˆ†ï¼Œä½†æ˜¯è¦ä½¿ç”¨å®ä¾‹æ–¹æ³•å®ç°èµ·æ¥å¾ˆéº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨ç±»æ–¹æ³•ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;utf-8&#39;)</span><br><span class="line">class gg:</span><br><span class="line">    url &#x3D; 0</span><br><span class="line">    stat &#x3D; 0</span><br><span class="line">    # å› ä¸ºä½¿ç”¨classmethodåä¼šä¼ å…¥æ–°çš„å˜é‡ï¼Œæ‰€ä»¥ä¸€å¼€å§‹æ˜¯éœ€è¦è‡ªå·±å…ˆå®šä¹‰ç±»å˜é‡</span><br><span class="line">    def __init__(self,url&#x3D;0,stat&#x3D;0):</span><br><span class="line">    # è¿™é‡ŒæŒ‰ç…§æ­£å¸¸çš„å®šä¹‰æ„é€ å‡½æ•°</span><br><span class="line">        self.url&#x3D;url</span><br><span class="line">        self.stat&#x3D;stat</span><br><span class="line">    @classmethod</span><br><span class="line">    # è£…é¥°å™¨ï¼Œç«‹é©¬æ‰§è¡Œä¸‹é¢çš„å‡½æ•°</span><br><span class="line">    def split(cls,info):</span><br><span class="line">        # è¿™ä¸ªå‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤çš„clså°±æ˜¯è¿™ä¸ªç±»çš„initå‡½æ•°ï¼Œinfoå°±æ˜¯å¤–é¢ä¼ å…¥è¿›æ¥çš„</span><br><span class="line">        url,stat&#x3D;map(str,info.split(&#39;-&#39;))</span><br><span class="line">        # è¿™é‡Œè½¬æ¢æˆäº†æ ¼å¼åŒ–çš„ç»“æ„</span><br><span class="line">        data &#x3D; cls(url,stat)</span><br><span class="line">        # ç„¶åæ‰§è¡Œè¿™ä¸ªç±»ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªç±»æ„é€ å‡½æ•°éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œäºæ˜¯å°±ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°</span><br><span class="line">        return data</span><br><span class="line">        # è¿™é‡Œå°±ç›´æ¥è¿”å›äº†å‡½æ•°ç»“æœ</span><br><span class="line">    def outer(self):</span><br><span class="line">        print self.url</span><br><span class="line">        print self.stat</span><br><span class="line"></span><br><span class="line">r &#x3D; gg.split((&#39;langzi-200&#39;))</span><br><span class="line">r.outer()</span><br><span class="line"># è¿™é‡Œæ˜¯è°ƒç”¨ç±»æ–¹æ³•ï¼Œä¸è°ƒç”¨å®ä¾‹æ–¹æ³•ä¸€æ ·</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="ç±»çš„ç‰¹æ€§"><a href="#ç±»çš„ç‰¹æ€§" class="headerlink" title="ç±»çš„ç‰¹æ€§"></a>ç±»çš„ç‰¹æ€§</h3><h4 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h4><blockquote>
<p>å°è£…æ˜¯æŒ‡å°†æ•°æ®ä¸å…·ä½“æ“ä½œçš„å®ç°ä»£ç æ”¾åœ¨æŸä¸ªå¯¹è±¡å†…éƒ¨ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®ã€‚å¿…é¡»è¦å…ˆè°ƒç”¨ç±»çš„æ–¹æ³•æ‰èƒ½å¯åŠ¨ã€‚</p>
</blockquote>
<ol>
<li>Example<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class cc:</span><br><span class="line">    ccc &#x3D; &#39;ccc&#39;</span><br><span class="line">    # ccå°±æ˜¯ç±»å å¦‚æœæƒ³è¦ç»§æ‰¿åˆ«çš„ç±» å°±class cc(threading) æ„æ€å°±æ˜¯ä»threadingç»§æ‰¿</span><br><span class="line">    def __init__(self,a,b,c):</span><br><span class="line">        self.a&#x3D;a</span><br><span class="line">        self.b&#x3D;b</span><br><span class="line">        self.c&#x3D;c</span><br><span class="line">print e.ccc</span><br><span class="line">#ç±»å˜é‡ï¼Œåœ¨ç±»é‡Œé¢æ‰¾åˆ°å®šä¹‰çš„å˜é‡ã€‚</span><br><span class="line">print ccc</span><br><span class="line"># è¿™é‡Œä¼šæŠ¥é”™ï¼Œè¿™å°±æ˜¯å°è£…ã€‚ç±»ä¸­çš„å‡½æ•°åŒç†ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><blockquote>
<p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªclassçš„æ—¶å€™ï¼Œå¯ä»¥ä»æŸä¸ªç°æœ‰çš„classç»§æ‰¿ï¼Œæ–°çš„classç§°ä¸ºå­ç±»ï¼ˆSubclassï¼‰ï¼Œè€Œè¢«ç»§æ‰¿çš„classç§°ä¸ºåŸºç±»ã€çˆ¶ç±»æˆ–è¶…ç±»ï¼ˆBase classã€Super classï¼‰ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€ä¸ªåä¸ºAnimalçš„classï¼Œæœ‰ä¸€ä¸ªrun()æ–¹æ³•å¯ä»¥ç›´æ¥æ‰“å°ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Animal(object):</span><br><span class="line">    def run(self):</span><br><span class="line">        print &#39;Animal is running...&#39;</span><br></pre></td></tr></table></figure>
å½“æˆ‘ä»¬éœ€è¦ç¼–å†™Dogå’ŒCatç±»æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»Animalç±»ç»§æ‰¿ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Dog(Animal):</span><br><span class="line">    pass</span><br><span class="line">class Cat(Animal):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
ç»§æ‰¿æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæœ€å¤§çš„å¥½å¤„æ˜¯å­ç±»è·å¾—äº†çˆ¶ç±»çš„å…¨éƒ¨åŠŸèƒ½ã€‚ç”±äºAnimialå®ç°äº†run()æ–¹æ³•ï¼Œå› æ­¤ï¼ŒDogå’ŒCatä½œä¸ºå®ƒçš„å­ç±»ï¼Œä»€ä¹ˆäº‹ä¹Ÿæ²¡å¹²ï¼Œå°±è‡ªåŠ¨æ‹¥æœ‰äº†run()æ–¹æ³•ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dog &#x3D; Dog()</span><br><span class="line">dog.run()</span><br><span class="line">cat &#x3D; Cat()</span><br><span class="line">cat.run()</span><br></pre></td></tr></table></figure>
å½“å­ç±»å’Œçˆ¶ç±»éƒ½å­˜åœ¨ç›¸åŒçš„run()æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è¯´ï¼Œå­ç±»çš„run()è¦†ç›–äº†çˆ¶ç±»çš„run()ï¼Œåœ¨ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šè°ƒç”¨å­ç±»çš„run()ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±è·å¾—äº†ç»§æ‰¿çš„å¦ä¸€ä¸ªå¥½å¤„: å¤šæ€ã€‚<h4 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h4><blockquote>
<p>è¦ç†è§£å¤šæ€çš„å¥½å¤„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªAnimalç±»å‹çš„å˜é‡ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def run_twice(animal):</span><br><span class="line">    animal.run()</span><br><span class="line">    animal.run()</span><br></pre></td></tr></table></figure>
å½“æˆ‘ä»¬ä¼ å…¥Animalçš„å®ä¾‹æ—¶ï¼Œrun_twice()å°±æ‰“å°å‡ºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run_twice(Animal())</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">Animal is running...</span><br><span class="line">Animal is running...</span><br></pre></td></tr></table></figure>
å½“æˆ‘ä»¬ä¼ å…¥Dogçš„å®ä¾‹æ—¶ï¼Œrun_twice()å°±æ‰“å°å‡º:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run_twice(Dog())</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">Dog is running...</span><br><span class="line">Dog is running...</span><br></pre></td></tr></table></figure>
å½“æˆ‘ä»¬ä¼ å…¥Catçš„å®ä¾‹æ—¶ï¼Œrun_twice()å°±æ‰“å°å‡ºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run_twice(Cat())</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">Cat is running...</span><br><span class="line">Cat is running...</span><br></pre></td></tr></table></figure>
çœ‹ä¸Šå»æ²¡å•¥æ„æ€ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªTortoiseç±»å‹ï¼Œä¹Ÿä»Animalæ´¾ç”Ÿï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Tortoise(Animal):</span><br><span class="line">    def run(self):</span><br><span class="line">        print &#39;Tortoise is running slowly...&#39;</span><br></pre></td></tr></table></figure>
å½“æˆ‘ä»¬è°ƒç”¨run_twice()æ—¶ï¼Œä¼ å…¥Tortoiseçš„å®ä¾‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">run_twice(Tortoise())</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">Tortoise is running slowly...</span><br><span class="line">Tortoise is running slowly...</span><br></pre></td></tr></table></figure></li>
<li>ä½ ä¼šå‘ç°ï¼Œæ–°å¢ä¸€ä¸ªAnimalçš„å­ç±»ï¼Œä¸å¿…å¯¹run_twice()åšä»»ä½•ä¿®æ”¹ï¼Œå®é™…ä¸Šï¼Œä»»ä½•ä¾èµ–Animalä½œä¸ºå‚æ•°çš„å‡½æ•°æˆ–è€…æ–¹æ³•éƒ½å¯ä»¥ä¸åŠ ä¿®æ”¹åœ°æ­£å¸¸è¿è¡Œï¼ŒåŸå› å°±åœ¨äºå¤šæ€ã€‚</li>
<li>å¤šæ€çš„å¥½å¤„å°±æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¼ å…¥Dogã€Catã€Tortoiseâ€¦â€¦æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦æ¥æ”¶Animalç±»å‹å°±å¯ä»¥äº†ï¼Œå› ä¸ºDogã€Catã€Tortoiseâ€¦â€¦éƒ½æ˜¯Animalç±»å‹ï¼Œç„¶åï¼ŒæŒ‰ç…§Animalç±»å‹è¿›è¡Œæ“ä½œå³å¯ã€‚ç”±äºAnimalç±»å‹æœ‰run()æ–¹æ³•ï¼Œå› æ­¤ï¼Œä¼ å…¥çš„ä»»æ„ç±»å‹ï¼Œåªè¦æ˜¯Animalç±»æˆ–è€…å­ç±»ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨å®é™…ç±»å‹çš„run()æ–¹æ³•ï¼Œè¿™å°±æ˜¯å¤šæ€çš„æ„æ€.</li>
<li>å¯¹äºä¸€ä¸ªå˜é‡ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“å®ƒæ˜¯Animalç±»å‹ï¼Œæ— éœ€ç¡®åˆ‡åœ°çŸ¥é“å®ƒçš„å­ç±»å‹ï¼Œå°±å¯ä»¥æ”¾å¿ƒåœ°è°ƒç”¨run()æ–¹æ³•ï¼Œè€Œå…·ä½“è°ƒç”¨çš„run()æ–¹æ³•æ˜¯ä½œç”¨åœ¨Animalã€Dogã€Catè¿˜æ˜¯Tortoiseå¯¹è±¡ä¸Šï¼Œç”±è¿è¡Œæ—¶è¯¥å¯¹è±¡çš„ç¡®åˆ‡ç±»å‹å†³å®šï¼Œè¿™å°±æ˜¯å¤šæ€çœŸæ­£çš„å¨åŠ›ï¼šè°ƒç”¨æ–¹åªç®¡è°ƒç”¨ï¼Œä¸ç®¡ç»†èŠ‚ï¼Œè€Œå½“æˆ‘ä»¬æ–°å¢ä¸€ç§Animalçš„å­ç±»æ—¶ï¼Œåªè¦ç¡®ä¿run()æ–¹æ³•ç¼–å†™æ­£ç¡®ï¼Œä¸ç”¨ç®¡åŸæ¥çš„ä»£ç æ˜¯å¦‚ä½•è°ƒç”¨çš„ã€‚è¿™å°±æ˜¯è‘—åçš„â€œå¼€é—­â€åŸåˆ™</li>
</ol>
<ul>
<li>å¯¹æ‰©å±•å¼€æ”¾ï¼šå…è®¸æ–°å¢Animalå­ç±»</li>
<li>å¯¹ä¿®æ”¹å°é—­ï¼šä¸éœ€è¦ä¿®æ”¹ä¾èµ–Animalç±»å‹çš„run_twice()ç­‰å‡½æ•°<br>âš ï¸ æ€»ç»“: </li>
</ul>
<ol>
<li>ç»§æ‰¿å¯ä»¥æŠŠçˆ¶ç±»çš„æ‰€æœ‰åŠŸèƒ½éƒ½ç›´æ¥æ‹¿è¿‡æ¥ï¼Œè¿™æ ·å°±ä¸å¿…é‡é›¶åšèµ·ï¼Œå­ç±»åªéœ€è¦æ–°å¢è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æŠŠçˆ¶ç±»ä¸é€‚åˆçš„æ–¹æ³•è¦†ç›–é‡å†™ï¼›</li>
<li>æœ‰äº†ç»§æ‰¿ï¼Œæ‰èƒ½æœ‰å¤šæ€ã€‚åœ¨è°ƒç”¨ç±»å®ä¾‹æ–¹æ³•çš„æ—¶å€™ï¼Œå°½é‡æŠŠå˜é‡è§†ä½œçˆ¶ç±»ç±»å‹ï¼Œè¿™æ ·ï¼Œæ‰€æœ‰å­ç±»ç±»å‹éƒ½å¯ä»¥æ­£å¸¸è¢«æ¥æ”¶ï¼›</li>
<li>æ—§çš„æ–¹å¼å®šä¹‰Pythonç±»å…è®¸ä¸ä»objectç±»ç»§æ‰¿ï¼Œä½†è¿™ç§ç¼–ç¨‹æ–¹å¼å·²ç»ä¸¥é‡ä¸æ¨èä½¿ç”¨ã€‚ä»»ä½•æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„ç±»å¯ä»¥ç»§æ‰¿ï¼Œå°±ç»§æ‰¿è‡ªobjectç±»ã€‚</li>
</ol>
<h3 id="é­”æ³•æ–¹æ³•"><a href="#é­”æ³•æ–¹æ³•" class="headerlink" title="é­”æ³•æ–¹æ³•"></a>é­”æ³•æ–¹æ³•</h3><p>åœ¨ä¸Šé¢æœ‰æåˆ°é™¤äº†<strong>init</strong>ä¹‹å¤–è¿˜æœ‰iter,reverseçš„æ–¹æ³•ï¼Œè¿™é‡Œå°±è¯¦ç»†è¯´ä¸‹é™¤äº†initåˆå§‹åŒ–è¿˜æœ‰å“ªäº›åˆ«çš„æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__init__ :      æ„é€ å‡½æ•°ï¼Œåœ¨ç”Ÿæˆå¯¹è±¡æ—¶è°ƒç”¨</span><br><span class="line">__del__ :       ææ„å‡½æ•°ï¼Œé‡Šæ”¾å¯¹è±¡æ—¶ä½¿ç”¨</span><br><span class="line">__repr__ :      æ‰“å°ï¼Œè½¬æ¢</span><br><span class="line">__setitem__ :   æŒ‰ç…§ç´¢å¼•èµ‹å€¼</span><br><span class="line">__getitem__:    æŒ‰ç…§ç´¢å¼•è·å–å€¼</span><br><span class="line">__len__:        è·å¾—é•¿åº¦</span><br><span class="line">__cmp__:        æ¯”è¾ƒè¿ç®—</span><br><span class="line">__call__:       è°ƒç”¨</span><br><span class="line">__add__:        åŠ è¿ç®—</span><br><span class="line">__sub__:        å‡è¿ç®—</span><br><span class="line">__mul__:        ä¹˜è¿ç®—</span><br><span class="line">__div__:        é™¤è¿ç®—</span><br><span class="line">__mod__:        æ±‚ä½™è¿ç®—</span><br><span class="line">__pow__:        å¹‚</span><br><span class="line">__doc__:        æ–‡æ¡£å’Œä¿¡æ¯</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="å…·ä½“ä½¿ç”¨"><a href="#å…·ä½“ä½¿ç”¨" class="headerlink" title="å…·ä½“ä½¿ç”¨"></a>å…·ä½“ä½¿ç”¨</h4><ol>
<li><strong>doc</strong><br>è¯´æ˜æ€§æ–‡æ¡£å’Œä¿¡æ¯ã€‚Pythonè‡ªå»ºï¼Œæ— éœ€è‡ªå®šä¹‰ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    &quot;&quot;&quot; æè¿°ç±»ä¿¡æ¯ï¼Œå¯è¢«è‡ªåŠ¨æ”¶é›† &quot;&quot;&quot;</span><br><span class="line">    def func(self):</span><br><span class="line">        pass</span><br><span class="line"># æ‰“å°ç±»çš„è¯´æ˜æ–‡æ¡£ </span><br><span class="line">print(Foo.__doc__)</span><br></pre></td></tr></table></figure></li>
<li><strong>init</strong>()<br>å®ä¾‹åŒ–æ–¹æ³•ï¼Œé€šè¿‡ç±»åˆ›å»ºå®ä¾‹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘æ‰§è¡Œã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; 18</span><br><span class="line">obj &#x3D; Foo(&#39;jack&#39;) # è‡ªåŠ¨æ‰§è¡Œç±»ä¸­çš„ __init__ æ–¹æ³•</span><br></pre></td></tr></table></figure></li>
<li><strong>module</strong> å’Œ <strong>class</strong><br>module è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡åœ¨å±äºå“ªä¸ªæ¨¡å—ã€‚<br>class è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡å±äºå“ªä¸ªç±»ã€‚<br>è¿™ä¸¤è€…ä¹Ÿæ˜¯Pythonå†…å»ºï¼Œæ— éœ€è‡ªå®šä¹‰ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    pass</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">print(obj.__module__)</span><br><span class="line">print(obj.__class__)</span><br></pre></td></tr></table></figure></li>
<li><strong>del</strong>()<blockquote>
<p>ææ„æ–¹æ³•ï¼Œå½“å¯¹è±¡åœ¨å†…å­˜ä¸­è¢«é‡Šæ”¾æ—¶ï¼Œè‡ªåŠ¨è§¦å‘æ­¤æ–¹æ³•ã€‚<br>æ³¨ï¼šæ­¤æ–¹æ³•ä¸€èˆ¬æ— é¡»è‡ªå®šä¹‰ï¼Œå› ä¸ºPythonè‡ªå¸¦å†…å­˜åˆ†é…å’Œé‡Šæ”¾æœºåˆ¶ï¼Œé™¤éä½ éœ€è¦åœ¨é‡Šæ”¾çš„æ—¶å€™æŒ‡å®šåšä¸€äº›åŠ¨ä½œã€‚ææ„å‡½æ•°çš„è°ƒç”¨æ˜¯ç”±è§£é‡Šå™¨åœ¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨è§¦å‘æ‰§è¡Œçš„ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __del__(self):</span><br><span class="line">        print(&quot;æˆ‘è¢«å›æ”¶äº†ï¼&quot;)</span><br><span class="line"></span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">del obj</span><br></pre></td></tr></table></figure></li>
<li><strong>call</strong>()<blockquote>
<p>æ„é€ æ–¹æ³•çš„æ‰§è¡Œæ˜¯ç”±ç±»åŠ æ‹¬å·æ‰§è¡Œçš„ï¼Œå³ï¼šå¯¹è±¡ = ç±»å()ï¼Œè€Œå¯¹äºcall() æ–¹æ³•ï¼Œæ˜¯ç”±å¯¹è±¡ååŠ æ‹¬å·è§¦å‘çš„ï¼Œå³ï¼šå¯¹è±¡() æˆ–è€… ç±»()()<br>å¦‚æœä¸ºä¸€ä¸ªç±»ç¼–å†™äº†è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨è¯¥ç±»çš„å®ä¾‹åé¢åŠ æ‹¬å·ï¼Œå¯ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line">    def __call__(self, *args, **kwargs):</span><br><span class="line">        print(&#39;__call__&#39;)</span><br><span class="line">obj &#x3D; Foo()     # æ‰§è¡Œ __init__</span><br><span class="line">obj()       # æ‰§è¡Œ __call__</span><br></pre></td></tr></table></figure>
å¯ä»¥ç”¨Pythonå†…å»ºçš„callable()å‡½æ•°è¿›è¡Œæµ‹è¯•ï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯ä»¥è¢«æ‰§è¡Œã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">callable(Student())</span><br><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line">True</span><br></pre></td></tr></table></figure></li>
<li><strong>dict</strong><br>åˆ—å‡ºç±»æˆ–å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜ï¼éå¸¸é‡è¦å’Œæœ‰ç”¨çš„ä¸€ä¸ªå±æ€§ï¼ŒPythonè‡ªå»ºï¼Œæ— éœ€ç”¨æˆ·è‡ªå·±å®šä¹‰ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Province:</span><br><span class="line">    country &#x3D; &#39;China&#39;</span><br><span class="line">    def __init__(self, name, count):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.count &#x3D; count</span><br><span class="line">    def func(self, *args, **kwargs):</span><br><span class="line">        printï¼ˆ&#39;func&#39;ï¼‰</span><br><span class="line"># è·å–ç±»çš„æˆå‘˜</span><br><span class="line">print(Province.__dict__)</span><br><span class="line"># è·å– å¯¹è±¡obj1 çš„æˆå‘˜ </span><br><span class="line">obj1 &#x3D; Province(&#39;HeBei&#39;,10000)</span><br><span class="line">print(obj1.__dict__)</span><br><span class="line"># è·å– å¯¹è±¡obj2 çš„æˆå‘˜ </span><br><span class="line">obj2 &#x3D; Province(&#39;HeNan&#39;, 3888)</span><br><span class="line">print(obj2.__dict__)</span><br></pre></td></tr></table></figure></li>
<li><strong>str</strong>()</li>
</ol>
<p>å¦‚æœä¸€ä¸ªç±»ä¸­å®šä¹‰äº†str()æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨æ‰“å°å¯¹è±¡æ—¶ï¼Œé»˜è®¤è¾“å‡ºè¯¥æ–¹æ³•çš„è¿”å›å€¼ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹æ³•ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å®šä¹‰ã€‚ã€€<br>ä¸‹é¢çš„ç±»ï¼Œæ²¡æœ‰å®šä¹‰str()æ–¹æ³•ï¼Œæ‰“å°ç»“æœæ˜¯ï¼š&lt;main.Foo object at 0x32io4u2389572394885&gt;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    pass</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">print(obj)</span><br><span class="line">å®šä¹‰äº†__str__()æ–¹æ³•åï¼Œæ‰“å°ç»“æœæ˜¯ï¼š&#39;jack&#39;ã€‚</span><br><span class="line">class Foo:</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &#39;jack&#39;</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">print(obj)</span><br></pre></td></tr></table></figure>
<ol start="8">
<li><strong>getitem</strong>()ã€<strong>setitem</strong>()ã€<strong>delitem</strong>()<br>å–å€¼ã€èµ‹å€¼ã€åˆ é™¤è¿™â€ä¸‰å‰‘å®¢â€çš„å¥—è·¯ï¼Œåœ¨Pythonä¸­ï¼Œæˆ‘ä»¬å·²ç»è§è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œæ¯”å¦‚å‰é¢çš„<code>@property</code>è£…é¥°å™¨ã€‚<br>Pythonä¸­ï¼Œæ ‡è¯†ç¬¦åé¢åŠ åœ†æ‹¬å·ï¼Œé€šå¸¸ä»£è¡¨æ‰§è¡Œæˆ–è°ƒç”¨æ–¹æ³•çš„æ„æ€ã€‚è€Œåœ¨æ ‡è¯†ç¬¦åé¢åŠ ä¸­æ‹¬å·[]ï¼Œé€šå¸¸ä»£è¡¨å–å€¼çš„æ„æ€ã€‚Pythonè®¾è®¡äº†<code>getitem()ã€setitem()ã€delitem()</code>è¿™ä¸‰ä¸ªç‰¹æ®Šæˆå‘˜ï¼Œç”¨äºæ‰§è¡Œä¸ä¸­æ‹¬å·æœ‰å…³çš„åŠ¨ä½œã€‚å®ƒä»¬åˆ†åˆ«è¡¨ç¤ºå–å€¼ã€èµ‹å€¼ã€åˆ é™¤æ•°<br>ä¹Ÿå°±æ˜¯å¦‚ä¸‹çš„æ“ä½œï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a &#x3D; æ ‡è¯†ç¬¦[]ã€€ï¼š ã€€ã€€æ‰§è¡Œ__getitem__æ–¹æ³•</span><br><span class="line">æ ‡è¯†ç¬¦[] &#x3D; a  ï¼š ã€€ã€€æ‰§è¡Œ__setitem__æ–¹æ³•</span><br><span class="line">del æ ‡è¯†ç¬¦[]ã€€ï¼š ã€€ã€€æ‰§è¡Œ__delitem__æ–¹æ³•</span><br></pre></td></tr></table></figure>
å¦‚æœæœ‰ä¸€ä¸ªç±»åŒæ—¶å®šä¹‰äº†è¿™ä¸‰ä¸ªé­”æ³•æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„å®ä¾‹çš„è¡Œä¸ºçœ‹èµ·æ¥å°±åƒä¸€ä¸ªå­—å…¸ä¸€æ ·ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    def __getitem__(self, key):</span><br><span class="line">        print(&#39;__getitem__&#39;,key)</span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&#39;__setitem__&#39;,key,value)</span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        print(&#39;__delitem__&#39;,key)</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">result &#x3D; obj[&#39;k1&#39;]      # è‡ªåŠ¨è§¦å‘æ‰§è¡Œ __getitem__</span><br><span class="line">obj[&#39;k2&#39;] &#x3D; &#39;jack&#39;      # è‡ªåŠ¨è§¦å‘æ‰§è¡Œ __setitem__</span><br><span class="line">del obj[&#39;k1&#39;]</span><br></pre></td></tr></table></figure></li>
<li><strong>iter</strong>()<blockquote>
<p>è¿™æ˜¯è¿­ä»£å™¨æ–¹æ³•ï¼åˆ—è¡¨ã€å­—å…¸ã€å…ƒç»„ä¹‹æ‰€ä»¥å¯ä»¥è¿›è¡Œforå¾ªç¯ï¼Œæ˜¯å› ä¸ºå…¶å†…éƒ¨å®šä¹‰äº† iter()è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœç”¨æˆ·æƒ³è®©è‡ªå®šä¹‰çš„ç±»çš„å¯¹è±¡å¯ä»¥è¢«è¿­ä»£ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨ç±»ä¸­å®šä¹‰è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è®©è¯¥æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ã€‚å½“åœ¨ä»£ç ä¸­åˆ©ç”¨forå¾ªç¯éå†å¯¹è±¡æ—¶ï¼Œå°±ä¼šè°ƒç”¨ç±»çš„è¿™ä¸ªiter()æ–¹æ³•ã€‚<br>æ™®é€šçš„ç±»ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    pass</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">for i in obj:</span><br><span class="line">    print(i)</span><br><span class="line"># æŠ¥é”™ï¼šTypeError: &#39;Foo&#39; object is not iterable&lt;br&gt;# åŸå› æ˜¯Fooå¯¹è±¡ä¸å¯è¿­ä»£</span><br><span class="line">æ·»åŠ ä¸€ä¸ª__iter__()ï¼Œä½†ä»€ä¹ˆéƒ½ä¸è¿”å›ï¼š</span><br><span class="line">class Foo:</span><br><span class="line">    def __iter__(self):</span><br><span class="line">        pass</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">for i in obj:</span><br><span class="line">    print(i)</span><br><span class="line"># æŠ¥é”™ï¼šTypeError: iter() returned non-iterator of type &#39;NoneType&#39;</span><br><span class="line">#åŸå› æ˜¯ __iter__æ–¹æ³•æ²¡æœ‰è¿”å›ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡</span><br></pre></td></tr></table></figure>
è¿”å›ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self, sq):</span><br><span class="line">        self.sq &#x3D; sq</span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return iter(self.sq)</span><br><span class="line">obj &#x3D; Foo([11,22,33,44])</span><br><span class="line">for i in obj:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>
æœ€å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç”Ÿæˆå™¨ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line">    def __iter__(self):</span><br><span class="line">        yield 1</span><br><span class="line">        yield 2</span><br><span class="line">        yield 3</span><br><span class="line">obj &#x3D; Foo()</span><br><span class="line">for i in obj:</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure></li>
<li><strong>len</strong>()<blockquote>
<p>åœ¨Pythonä¸­ï¼Œå¦‚æœä½ è°ƒç”¨å†…ç½®çš„len()å‡½æ•°è¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡çš„é•¿åº¦ï¼Œåœ¨åå°ï¼Œå…¶å®æ˜¯å»è°ƒç”¨è¯¥å¯¹è±¡çš„len()æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ç­‰ä»·çš„ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">len(&#39;ABC&#39;)</span><br><span class="line">3</span><br><span class="line">&#39;ABC&#39;.__len__()</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
Pythonçš„listã€dictã€strç­‰å†…ç½®æ•°æ®ç±»å‹éƒ½å®ç°äº†è¯¥æ–¹æ³•ï¼Œä½†æ˜¯ä½ è‡ªå®šä¹‰çš„ç±»è¦å®ç°lenæ–¹æ³•éœ€è¦å¥½å¥½è®¾è®¡ã€‚</li>
<li><strong>repr</strong>()<blockquote>
<p>è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å’Œstr()å¾ˆåƒï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯str()è¿”å›ç”¨æˆ·çœ‹åˆ°çš„å­—ç¬¦ä¸²ï¼Œè€Œrepr()è¿”å›ç¨‹åºå¼€å‘è€…çœ‹åˆ°çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œrepr()æ˜¯ä¸ºè°ƒè¯•æœåŠ¡çš„ã€‚é€šå¸¸ä¸¤è€…ä»£ç ä¸€æ ·ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo:</span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &quot;this is %s&quot; % self.name</span><br><span class="line">    __repr__ &#x3D; __str__</span><br></pre></td></tr></table></figure></li>
<li><strong>add</strong>: åŠ è¿ç®— <strong>sub</strong>: å‡è¿ç®— <strong>mul</strong>: ä¹˜è¿ç®— <strong>div</strong>: é™¤è¿ç®— <strong>mod</strong>: æ±‚ä½™è¿ç®— <strong>pow</strong>: å¹‚è¿ç®—<blockquote>
<p>è¿™äº›éƒ½æ˜¯ç®—æœ¯è¿ç®—æ–¹æ³•ï¼Œéœ€è¦ä½ è‡ªå·±ä¸ºç±»è®¾è®¡å…·ä½“è¿ç®—ä»£ç ã€‚æœ‰äº›Pythonå†…ç½®æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚intå°±å¸¦æœ‰è¿™äº›æ–¹æ³•ã€‚Pythonæ”¯æŒè¿ç®—ç¬¦çš„é‡è½½ï¼Œä¹Ÿå°±æ˜¯é‡å†™ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Vector:</span><br><span class="line">   def __init__(self, a, b):</span><br><span class="line">      self.a &#x3D; a</span><br><span class="line">      self.b &#x3D; b</span><br><span class="line">   def __str__(self):</span><br><span class="line">      return &#39;Vector (%d, %d)&#39; % (self.a, self.b)</span><br><span class="line">   def __add__(self,other):</span><br><span class="line">      return Vector(self.a + other.a, self.b + other.b)</span><br><span class="line">v1 &#x3D; Vector(2,10)</span><br><span class="line">v2 &#x3D; Vector(5,-2)</span><br><span class="line">print (v1 + v2)</span><br></pre></td></tr></table></figure></li>
<li><strong>author</strong>ä½œè€…ä¿¡æ¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__author__ &#x3D; &quot;shuke&quot;</span><br><span class="line">def show():</span><br><span class="line">    print(__author__)</span><br><span class="line">show()</span><br></pre></td></tr></table></figure></li>
<li><strong>slots</strong><blockquote>
<p>Pythonä½œä¸ºä¸€ç§åŠ¨æ€è¯­è¨€ï¼Œå¯ä»¥åœ¨ç±»å®šä¹‰å®Œæˆå’Œå®ä¾‹åŒ–åï¼Œç»™ç±»æˆ–è€…å¯¹è±¡ç»§ç»­æ·»åŠ éšæ„ä¸ªæ•°æˆ–è€…ä»»æ„ç±»å‹çš„å˜é‡æˆ–æ–¹æ³•ï¼Œè¿™æ˜¯åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼š </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def print_doc(self):</span><br><span class="line">    print(&quot;haha&quot;)</span><br><span class="line"></span><br><span class="line">class Foo:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">obj1 &#x3D; Foo()</span><br><span class="line">obj2 &#x3D; Foo()</span><br><span class="line"># åŠ¨æ€æ·»åŠ å®ä¾‹å˜é‡</span><br><span class="line">obj1.name &#x3D; &quot;jack&quot;</span><br><span class="line">obj2.age &#x3D; 18</span><br><span class="line"># åŠ¨æ€çš„ç»™ç±»æ·»åŠ å®ä¾‹æ–¹æ³•</span><br><span class="line">Foo.show &#x3D; print_doc</span><br><span class="line">obj1.show()</span><br><span class="line">obj2.show()</span><br></pre></td></tr></table></figure>
ä½†æ˜¯ï¼å¦‚æœæˆ‘æƒ³é™åˆ¶å®ä¾‹å¯ä»¥æ·»åŠ çš„å˜é‡æ€ä¹ˆåŠï¼Ÿå¯ä»¥ä½¿slotsé™åˆ¶å®ä¾‹çš„å˜é‡ï¼Œæ¯”å¦‚ï¼Œåªå…è®¸Fooçš„å®ä¾‹æ·»åŠ nameå’Œageå±æ€§ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def print_doc(self):</span><br><span class="line">    print(&quot;haha&quot;)</span><br><span class="line">class Foo:</span><br><span class="line">    __slots__ &#x3D; (&quot;name&quot;, &quot;age&quot;)</span><br><span class="line">    pass</span><br><span class="line">obj1 &#x3D; Foo()</span><br><span class="line">obj2 &#x3D; Foo()</span><br><span class="line"># åŠ¨æ€æ·»åŠ å®ä¾‹å˜é‡</span><br><span class="line">obj1.name &#x3D; &quot;jack&quot;</span><br><span class="line">obj2.age &#x3D; 18</span><br><span class="line">obj1.sex &#x3D; &quot;male&quot;       # è¿™ä¸€å¥ä¼šå¼¹å‡ºé”™è¯¯</span><br><span class="line"># ä½†æ˜¯æ— æ³•é™åˆ¶ç»™ç±»æ·»åŠ æ–¹æ³•</span><br><span class="line">Foo.show &#x3D; print_doc</span><br><span class="line">obj1.show()</span><br><span class="line">obj2.show()</span><br><span class="line">ç”±äº&#39;sex&#39;ä¸åœ¨__slots__çš„åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ç»‘å®šsexå±æ€§ï¼Œè¯•å›¾ç»‘å®šsexå°†å¾—åˆ°AttributeErrorçš„é”™è¯¯ã€‚</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;F:&#x2F;Python&#x2F;pycharm&#x2F;201705&#x2F;1.py&quot;, line 14, in &lt;module&gt;</span><br><span class="line">    obj1.sex &#x3D; &quot;male&quot;</span><br><span class="line">AttributeError: &#39;Foo&#39; object has no attribute &#39;sex&#39;</span><br></pre></td></tr></table></figure>
éœ€è¦æé†’çš„æ˜¯ï¼Œslotså®šä¹‰çš„å±æ€§ä»…å¯¹å½“å‰ç±»çš„å®ä¾‹èµ·ä½œç”¨ï¼Œå¯¹ç»§æ‰¿äº†å®ƒçš„å­ç±»æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚æƒ³æƒ³ä¹Ÿæ˜¯è¿™ä¸ªé“ç†ï¼Œå¦‚æœä½ ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå´è«åå…¶å¦™å‘ç°æœ‰äº›å˜é‡æ— æ³•å®šä¹‰ï¼Œé‚£ä¸æ˜¯å¤§é—®é¢˜ä¹ˆï¼Ÿå¦‚æœéè¦å­ç±»ä¹Ÿè¢«é™åˆ¶ï¼Œé™¤éåœ¨å­ç±»ä¸­ä¹Ÿå®šä¹‰slotsï¼Œè¿™æ ·ï¼Œå­ç±»å®ä¾‹å…è®¸å®šä¹‰çš„å±æ€§å°±æ˜¯è‡ªèº«çš„slotsåŠ ä¸Šçˆ¶ç±»çš„slotsã€‚</li>
</ol>
<h3 id="æˆå‘˜ä¿æŠ¤ä¸è®¿é—®æœºåˆ¶"><a href="#æˆå‘˜ä¿æŠ¤ä¸è®¿é—®æœºåˆ¶" class="headerlink" title="æˆå‘˜ä¿æŠ¤ä¸è®¿é—®æœºåˆ¶"></a>æˆå‘˜ä¿æŠ¤ä¸è®¿é—®æœºåˆ¶</h3><p>æœ‰äº›å¯¹è±¡ä½ ä¸æƒ³å¤–éƒ¨è®¿é—®ï¼Œå³ä½¿æ˜¯é€šè¿‡è°ƒç”¨ç±»å¯¹è±¡ä¹Ÿæ— æ³•è®¿é—®</p>
<h4 id="ç§æœ‰æˆå‘˜"><a href="#ç§æœ‰æˆå‘˜" class="headerlink" title="ç§æœ‰æˆå‘˜"></a>ç§æœ‰æˆå‘˜</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class obj:</span><br><span class="line">    def __init__(self,name):</span><br><span class="line">        self.name&#x3D;name</span><br><span class="line">    def pri(self):</span><br><span class="line">        print self.name</span><br><span class="line">    __age &#x3D; 18</span><br><span class="line">    # åŠ ä¸ŠåŒä¸‹åˆ’çº¿çš„å°±æ˜¯ç§æœ‰å˜é‡ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</span><br><span class="line">a &#x3D; obj(&#39;zhao&#39;)</span><br><span class="line">a.pri()</span><br><span class="line"># output</span><br><span class="line">zhao</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦åœ¨ç±»ä¸­è°ƒç”¨è¿™ä¸ªç§æœ‰æˆå‘˜ï¼Œå¯ä»¥è¿™ä¹ˆç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class obj:</span><br><span class="line">    def __init__(self,name):</span><br><span class="line">        self.name&#x3D;name</span><br><span class="line">    def prin(self):</span><br><span class="line">        print self.name</span><br><span class="line">    __age &#x3D; 18</span><br><span class="line">    # åŠ ä¸ŠåŒä¸‹åˆ’çº¿çš„å°±æ˜¯ç§æœ‰å˜é‡ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</span><br><span class="line">    @classmethod</span><br><span class="line">    # å¦‚æœè¦åœ¨ç±»ä¸­è°ƒç”¨ï¼Œé¦–å…ˆè°ƒç”¨ç±»æ–¹æ³•</span><br><span class="line">    def pri(cls):</span><br><span class="line">        print cls.__age</span><br><span class="line">        # ç„¶ååœ¨ä½¿ç”¨</span><br><span class="line">a &#x3D; obj(&#39;zhao&#39;)</span><br><span class="line">a.prin()</span><br><span class="line">obj.pri()</span><br><span class="line"># é€šè¿‡è¿™æ ·ç›´æ¥è°ƒç”¨ç±»ä¸­çš„ç§æœ‰å˜é‡</span><br><span class="line"># output</span><br><span class="line">zhao</span><br><span class="line">18</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨get-set-delæ–¹æ³•æ“ä½œç§æœ‰æˆå‘˜"><a href="#ä½¿ç”¨get-set-delæ–¹æ³•æ“ä½œç§æœ‰æˆå‘˜" class="headerlink" title="ä½¿ç”¨get-set-delæ–¹æ³•æ“ä½œç§æœ‰æˆå‘˜"></a>ä½¿ç”¨get-set-delæ–¹æ³•æ“ä½œç§æœ‰æˆå‘˜</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class obj:</span><br><span class="line">    def __init__(self,name):</span><br><span class="line">        self.name&#x3D;name</span><br><span class="line">    def prin(self):</span><br><span class="line">        print self.name</span><br><span class="line">    __age &#x3D; 18</span><br><span class="line">    # åŠ ä¸ŠåŒä¸‹åˆ’çº¿çš„å°±æ˜¯ç§æœ‰å˜é‡ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</span><br><span class="line">    @classmethod</span><br><span class="line">    # å¦‚æœè¦åœ¨ç±»ä¸­è°ƒç”¨ï¼Œé¦–å…ˆè°ƒç”¨ç±»æ–¹æ³•</span><br><span class="line">    def pri(cls):</span><br><span class="line">        print cls.__age</span><br><span class="line">        # ç„¶ååœ¨ä½¿ç”¨</span><br><span class="line">    @classmethod</span><br><span class="line">    def set_age(cls,value):</span><br><span class="line">        cls.__age &#x3D; value</span><br><span class="line">        return cls.__age</span><br><span class="line">        # è¿™ä¸ªç”¨æ³•å°±æ˜¯æ”¹å˜__ageçš„å€¼</span><br><span class="line">    @classmethod</span><br><span class="line">    def get_age(cls):</span><br><span class="line">        return cls.__age</span><br><span class="line">        # è¿™ä¸ªç”¨æ³•å°±æ˜¯ç›´æ¥è¿”å›__ageçš„å€¼</span><br><span class="line">    @classmethod</span><br><span class="line">    def del_age(cls):</span><br><span class="line">        del cls.__age</span><br><span class="line">        # è¿™ä¸ªç”¨æ³•å°±æ˜¯ç›´æ¥åˆ é™¤__ageçš„å€¼</span><br><span class="line"></span><br><span class="line">print obj.get_age()</span><br><span class="line"># è¿™é‡Œæ˜¯ç›´æ¥è°ƒç”¨å‡º__ageçš„å€¼  è¿”å›å€¼18</span><br><span class="line">print obj.set_age(20)</span><br><span class="line"># è¿™é‡Œæ˜¯ç›´æ¥æ”¹å˜__ageçš„å€¼  è¿”å›å€¼20</span><br><span class="line">obj.del_age()</span><br><span class="line"># è¿™é‡Œæ˜¯ç›´æ¥åˆ é™¤__ageçš„å€¼</span><br></pre></td></tr></table></figure>
<p>æ€è€ƒï¼š æ—¢ç„¶æ˜¯ç§æœ‰å˜é‡ï¼Œä¸è®©å¤–éƒ¨è®¿é—®ï¼Œä¸ºä½•æœ‰è¦åœ¨åé¢è°ƒç”¨åˆæ”¹å˜å‘¢ï¼Ÿå› ä¸ºå¯ä»¥å¯¹ç§æœ‰å˜é‡è¿›è¡Œé¢å¤–çš„æ£€æµ‹ï¼Œå¤„ç†ï¼ŒåŠ å·¥ç­‰ç­‰ã€‚æ¯”å¦‚åˆ¤æ–­valueçš„å€¼ï¼Œä½¿ç”¨isinstanceç„¶ååšif-elseåˆ¤æ–­ã€‚<br>ä½¿ç”¨ç§æœ‰å˜é‡å¯ä»¥å¯¹å†…éƒ¨å˜é‡è¿›è¡Œä¿æŠ¤ï¼Œå¤–éƒ¨æ— æ³•æ”¹å˜ï¼Œä½†æ˜¯å¯ä»¥å¯¹å®ƒè¿›è¡Œæ£€æµ‹å¤„ç†ã€‚<br>è¿™é‡Œå¼•ç”³ä¸€ä¸‹ç§æœ‰æˆå‘˜çš„ä¿æŠ¤æœºåˆ¶ï¼Œä½¿ç”¨<code>_age</code>ç§æœ‰å˜é‡å…¶å®å°±æ˜¯<code>obj._obj__age</code>æ ·å­è¿›è¡Œä¿æŠ¤ï¼Œè¯´ç™½äº†ä½ ç›´æ¥ä½¿ç”¨<code>bj._obj__age</code>å¯ä»¥ç›´æ¥è°ƒç”¨å†…éƒ¨ç§æœ‰å˜é‡ageäº†ã€‚</p>
<h4 id="Propetyè£…é¥°å™¨"><a href="#Propetyè£…é¥°å™¨" class="headerlink" title="Propetyè£…é¥°å™¨"></a>Propetyè£…é¥°å™¨</h4><blockquote>
<p>æŠŠç±»çš„æ–¹æ³•ä¼ªè£…æˆå±æ€§è°ƒç”¨çš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠç±»é‡Œé¢çš„ä¸€ä¸ªå‡½æ•°ï¼Œå˜æˆä¸€ä¸ªå±æ€§ä¸€æ ·çš„ä¸œè¥¿~<br>ä¸€å¼€å§‹è°ƒç”¨ç±»çš„æ–¹æ³•è¦ä½¿ç”¨åœ†æ‹¬å·ï¼Œç°åœ¨å˜æˆäº†å±æ€§è¿›è¡Œè¯»å–è®¾ç½®å­˜å‚¨ã€‚<br>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼š</p>
</blockquote>
<ol>
<li>è°ƒç”¨æ–¹æ³•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class obj:</span><br><span class="line">    def __init__(self,name,age):</span><br><span class="line">        self.__name&#x3D;name</span><br><span class="line">        self.__age&#x3D;age</span><br><span class="line">        # è®²è¿™äº›è®¾ç½®æˆç§æœ‰å˜é‡</span><br><span class="line">    def get_age(self):</span><br><span class="line">        return self.__age</span><br><span class="line">    def set_age(self,value):</span><br><span class="line">        if isinstance(value,int):</span><br><span class="line">            self.__age&#x3D;value</span><br><span class="line">        else:</span><br><span class="line">            raise ValueError(&#39;éæ•´æ•°ç±»å‹&#39;)</span><br><span class="line">    def del_age(self):</span><br><span class="line">        print &#39;delete over&#39;</span><br><span class="line">a &#x3D; obj(&#39;langzi&#39;,18)</span><br><span class="line">print a.get_age()</span><br><span class="line">a.set_age(20)</span><br><span class="line">print a.get_age()</span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨è£…é¥°å™¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class obj:</span><br><span class="line">    def __init__(self,name,age):</span><br><span class="line">        self.__name&#x3D;name</span><br><span class="line">        self.__age&#x3D;age</span><br><span class="line">        # æŠŠè¿™äº›è®¾ç½®æˆç§æœ‰å˜é‡</span><br><span class="line">    @property</span><br><span class="line">    def age(self):</span><br><span class="line">        return self.__age</span><br><span class="line">    @age.setter</span><br><span class="line">    def age(self,value):</span><br><span class="line">        if isinstance(value,int):</span><br><span class="line">            self.__age&#x3D;value</span><br><span class="line">        else:</span><br><span class="line">            raise ValueError(&#39;éæ•´æ•°ç±»å‹&#39;)</span><br><span class="line">    @age.deleter</span><br><span class="line">    def age(self):</span><br><span class="line">        print &#39;delete over&#39;</span><br><span class="line">a &#x3D; obj(&#39;langzi&#39;,18)</span><br><span class="line"># ä½¿ç”¨è¿™äº›è£…é¥°å™¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¸å¯¹è±¡çš„æ–¹æ³•ç›´æ¥è°ƒç”¨</span><br><span class="line">print a.age</span><br><span class="line"># è¿™é‡Œå°±æ˜¯ç›´æ¥è°ƒç”¨è¿”å›ageçš„å€¼</span><br><span class="line">a.age&#x3D;20</span><br><span class="line"># è¿™é‡Œå°±æ˜¯ç›´æ¥ä½¿ç”¨setteræŠŠå€¼è½¬æ¢</span><br><span class="line">print a.age</span><br><span class="line">del a.age</span><br><span class="line"># åˆ é™¤age</span><br></pre></td></tr></table></figure>
å½“ç„¶è¿™ç§è°ƒç”¨æ–¹æ³•æœ‰äº›éº»çƒ¦ï¼Œæ¯æ¬¡éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªå»å®ä¾‹ç±»ä¸å¯¹è±¡ï¼Œæœ‰ä¸ªæ›´åŠ ç®€å•ç›´è§‚çš„æ–¹æ³•ã€‚<h4 id="æ›´åŠ ç®€ä¾¿çš„ä½¿ç”¨property-å‡½æ•°"><a href="#æ›´åŠ ç®€ä¾¿çš„ä½¿ç”¨property-å‡½æ•°" class="headerlink" title="æ›´åŠ ç®€ä¾¿çš„ä½¿ç”¨property()å‡½æ•°"></a>æ›´åŠ ç®€ä¾¿çš„ä½¿ç”¨property()å‡½æ•°</h4><blockquote>
<p>è£…é¥°å™¨çš„æ–¹å¼å°†ä¸€ä¸ªæ–¹æ³•ä¼ªè£…æˆå±æ€§å¤–ï¼ŒPythonå†…ç½®çš„<code>uiltins</code>å—ä¸­çš„<code>roperty()</code>æ•°ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ç¬¬äºŒç§è®¾ç½®ç±»å±æ€§çš„æ‰‹æ®µã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class People:</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.__name &#x3D; name</span><br><span class="line">        self.__age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def get_age(self):</span><br><span class="line">        return self.__age</span><br><span class="line"></span><br><span class="line">    def set_age(self, age):</span><br><span class="line">        if isinstance(age, int):</span><br><span class="line">            self.__age &#x3D; age</span><br><span class="line">        else:</span><br><span class="line">            raise ValueError</span><br><span class="line"></span><br><span class="line">    def del_age(self):</span><br><span class="line">        print(&quot;åˆ é™¤å¹´é¾„æ•°æ®ï¼&quot;)</span><br><span class="line"></span><br><span class="line">    # æ ¸å¿ƒåœ¨è¿™å¥</span><br><span class="line">    age &#x3D; property(get_age, set_age, del_age, &quot;å¹´é¾„&quot;)    </span><br><span class="line"></span><br><span class="line">obj &#x3D; People(&quot;jack&quot;, 18)</span><br><span class="line">print(obj.age)</span><br><span class="line">obj.age &#x3D; 19</span><br><span class="line">print(&quot;obj.age:  &quot;, obj.age)</span><br><span class="line">del obj.ag</span><br></pre></td></tr></table></figure>
é€šè¿‡è¯­å¥<code>ge = property(get_age, set_age, del_age, &quot;é¾„&quot;</code>ä¸€ä¸ªæ–¹æ³•ä¼ªè£…æˆä¸ºå±æ€§ã€‚å…¶æ•ˆæœå’Œè£…é¥°å™¨çš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚<br>property()å‡½æ•°çš„å‚æ•°ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ å®ä¾‹.å±æ€§ æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•</span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ å®ä¾‹.å±æ€§ ï¼ XXXæ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•</span><br><span class="line">ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ–¹æ³•åï¼Œè°ƒç”¨ delå®ä¾‹.å±æ€§ æ—¶è‡ªåŠ¨æ‰§è¡Œçš„æ–¹æ³•</span><br><span class="line">ç¬¬å››ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè°ƒç”¨ å®ä¾‹.å±æ€§.__doc__æ—¶çš„æè¿°ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>
åœ¨Djangoæ¡†æ¶æºç ä¸­æœ‰ä½¿ç”¨åˆ°æ­¤ç‰¹æ€§</li>
</ol>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§18ä¸ª</title>
    <url>/2020/04/23/Python%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A718%E4%B8%AA/</url>
    <content><![CDATA[<h2 id="Pythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§18ä¸ª"><a href="#Pythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§18ä¸ª" class="headerlink" title="Pythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§18ä¸ª"></a>Pythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§18ä¸ª</h2><p>åˆè¯†Pythonè¯­è¨€ï¼Œè§‰å¾—pythonæ»¡è¶³äº†æˆ‘ä¸Šå­¦æ—¶å€™å¯¹ç¼–ç¨‹è¯­è¨€çš„æ‰€æœ‰è¦æ±‚.</p>
<ol>
<li><p>äº¤æ¢å˜é‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;a&#x3D;3</span><br><span class="line">&gt;&gt;&gt;b&#x3D;6</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæƒ…å†µå¦‚æœè¦äº¤æ¢å˜é‡åœ¨c++ä¸­ï¼Œè‚¯å®šéœ€è¦ä¸€ä¸ªç©ºå˜é‡ã€‚ä½†æ˜¯pythonä¸éœ€è¦ï¼Œåªéœ€ä¸€è¡Œï¼Œå¤§å®¶çœ‹æ¸…æ¥šäº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;a,b&#x3D;b,a</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;print(a)</span><br><span class="line">&gt;&gt;&gt;6</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;ptint(b)</span><br><span class="line">&gt;&gt;&gt;5</span><br></pre></td></tr></table></figure></li>
<li><p>å­—å…¸æ¨å¯¼(Dictionary comprehensions)å’Œé›†åˆæ¨å¯¼(Set comprehensions)</p>
<blockquote>
<p>å¤§å¤šæ•°çš„Pythonç¨‹åºå‘˜éƒ½çŸ¥é“ä¸”ä½¿ç”¨è¿‡åˆ—è¡¨æ¨å¯¼(list comprehensions)ã€‚å¦‚æœä½ å¯¹list comprehensionsæ¦‚å¿µä¸æ˜¯å¾ˆç†Ÿæ‚‰â€”â€”ä¸€ä¸ªlist comprehensionå°±æ˜¯ä¸€ä¸ªæ›´ç®€çŸ­ã€ç®€æ´çš„åˆ›å»ºä¸€ä¸ªlistçš„æ–¹æ³•</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; some_list &#x3D; [1, 2, 3, 4, 5]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; another_list &#x3D; [ x + 1 for x in some_list ]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; another_list</span><br><span class="line">[2, 3, 4, 5, 6]</span><br></pre></td></tr></table></figure>
<p>è‡ªä»python 3.1 èµ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„è¯­æ³•æ¥åˆ›å»ºé›†åˆå’Œå­—å…¸è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; # Set Comprehensions</span><br><span class="line">&gt;&gt;&gt; some_list &#x3D; [1, 2, 3, 4, 5, 2, 5, 1, 4, 8]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; even_set &#x3D; &#123; x for x in some_list if x % 2 &#x3D;&#x3D; 0 &#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; even_set</span><br><span class="line">set([8, 2, 4])</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; # Dict Comprehensions</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d &#x3D; &#123; x: x % 2 &#x3D;&#x3D; 0 for x in range(1, 11) &#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;1: False, 2: True, 3: False, 4: True, 5: False, 6: True, 7: False, 8: True, 9: False, 10: True&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä»¥some_listä¸ºåŸºç¡€ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ä¸é‡å¤å…ƒç´ çš„é›†åˆï¼Œè€Œä¸”é›†åˆé‡ŒåªåŒ…å«å¶æ•°ã€‚è€Œåœ¨å­—å…¸è¡¨çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªkeyæ˜¯ä¸é‡å¤çš„1åˆ°10ä¹‹é—´çš„æ•´æ•°ï¼Œvalueæ˜¯å¸ƒå°”å‹ï¼Œç”¨æ¥æŒ‡ç¤ºkeyæ˜¯å¦æ˜¯å¶æ•°ã€‚<br>è¿™é‡Œå¦å¤–ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„äº‹æƒ…æ˜¯é›†åˆçš„å­—é¢é‡è¡¨ç¤ºæ³•ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•çš„ç”¨è¿™ç§æ–¹æ³•åˆ›å»ºä¸€ä¸ªé›†åˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; my_set &#x3D; &#123;1, 2, 1, 2, 3, 4&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; my_set</span><br><span class="line">set([1, 2, 3, 4])</span><br></pre></td></tr></table></figure>
<p>è€Œä¸éœ€è¦ä½¿ç”¨å†…ç½®å‡½æ•°set()ã€‚</p>
</li>
<li><p>è®¡æ•°æ—¶ä½¿ç”¨Counterè®¡æ•°å¯¹è±¡<br>è¿™å¬èµ·æ¥æ˜¾è€Œæ˜“è§ï¼Œä½†ç»å¸¸è¢«äººå¿˜è®°ã€‚å¯¹äºå¤§å¤šæ•°ç¨‹åºå‘˜æ¥è¯´ï¼Œæ•°ä¸€ä¸ªä¸œè¥¿æ˜¯ä¸€é¡¹å¾ˆå¸¸è§çš„ä»»åŠ¡ï¼Œè€Œä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸æ˜¯å¾ˆæœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…â€”â€”è¿™é‡Œæœ‰å‡ ç§æ–¹æ³•èƒ½æ›´ç®€å•çš„å®Œæˆè¿™ç§ä»»åŠ¡ã€‚<br>Pythonçš„collectionsç±»åº“é‡Œæœ‰ä¸ªå†…ç½®çš„dictç±»çš„å­ç±»ï¼Œæ˜¯ä¸“é—¨æ¥å¹²è¿™ç§äº‹æƒ…çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import Counter</span><br><span class="line">&gt;&gt;&gt; c &#x3D; Counter(&#39;hello world&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">Counter(&#123;&#39;l&#39;: 3, &#39;o&#39;: 2, &#39; &#39;: 1, &#39;e&#39;: 1, &#39;d&#39;: 1, &#39;h&#39;: 1, &#39;r&#39;: 1, &#39;w&#39;: 1&#125;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; c.most_common(2)</span><br><span class="line">[(&#39;l&#39;, 3), (&#39;o&#39;, 2)]</span><br></pre></td></tr></table></figure></li>
<li><p>æ¼‚äº®çš„æ‰“å°å‡ºJSON<br>JSONæ˜¯ä¸€ç§éå¸¸å¥½çš„æ•°æ®åºåˆ—åŒ–çš„å½¢å¼ï¼Œè¢«å¦‚ä»Šçš„å„ç§APIå’Œweb serviceå¤§é‡çš„ä½¿ç”¨ã€‚ä½¿ç”¨pythonå†…ç½®çš„jsonå¤„ç†ï¼Œå¯ä»¥ä½¿JSONä¸²å…·æœ‰ä¸€å®šçš„å¯è¯»æ€§ï¼Œä½†å½“é‡åˆ°å¤§å‹æ•°æ®æ—¶ï¼Œå®ƒè¡¨ç°æˆä¸€ä¸ªå¾ˆé•¿çš„ã€è¿ç»­çš„ä¸€è¡Œæ—¶ï¼Œäººçš„è‚‰çœ¼å°±å¾ˆéš¾è§‚çœ‹äº†ã€‚<br>ä¸ºäº†èƒ½è®©JSONæ•°æ®è¡¨ç°çš„æ›´å‹å¥½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨indentå‚æ•°æ¥è¾“å‡ºæ¼‚äº®çš„JSONã€‚å½“åœ¨æ§åˆ¶å°äº¤äº’å¼ç¼–ç¨‹æˆ–åšæ—¥å¿—æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import json</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(json.dumps(data))  # No indention</span><br><span class="line">&#123;&quot;status&quot;: &quot;OK&quot;, &quot;count&quot;: 2, &quot;results&quot;: [&#123;&quot;age&quot;: 27, &quot;name&quot;: &quot;Oz&quot;, &quot;lactose_intolerant&quot;: true&#125;, &#123;&quot;age&quot;: 29, &quot;name&quot;: &quot;Joe&quot;, &quot;lactose_intolerant&quot;: false&#125;]&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print(json.dumps(data, indent&#x3D;2))  # With indention</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;OK&quot;,</span><br><span class="line">  &quot;count&quot;: 2,</span><br><span class="line">  &quot;results&quot;: [</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: 27,</span><br><span class="line">      &quot;name&quot;: &quot;Oz&quot;,</span><br><span class="line"></span><br><span class="line">      &quot;lactose_intolerant&quot;: true</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;: 29,</span><br><span class="line"></span><br><span class="line">      &quot;name&quot;: &quot;Joe&quot;,</span><br><span class="line">      &quot;lactose_intolerant&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œä½¿ç”¨å†…ç½®çš„pprintæ¨¡å—ï¼Œä¹Ÿå¯ä»¥è®©å…¶å®ƒä»»ä½•ä¸œè¥¿æ‰“å°è¾“å‡ºçš„æ›´æ¼‚äº®ã€‚</p>
</li>
<li><p>è§£å†³FizzBuzz<br>å‰æ®µæ—¶é—´Jeff Atwood æ¨å¹¿äº†ä¸€ä¸ªç®€å•çš„ç¼–ç¨‹ç»ƒä¹ å«FizzBuzzï¼Œé—®é¢˜å¼•ç”¨å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å†™ä¸€ä¸ªç¨‹åºï¼Œæ‰“å°æ•°å­—1åˆ°100ï¼Œ3çš„å€æ•°æ‰“å°â€œFizzâ€æ¥æ›¿æ¢è¿™ä¸ªæ•°ï¼Œ5çš„å€æ•°æ‰“å°â€œBuzzâ€ï¼Œå¯¹äºæ—¢æ˜¯3çš„å€æ•°åˆæ˜¯5çš„å€æ•°çš„æ•°å­—æ‰“å°â€œFizzBuzzâ€ã€‚<br>è¿™é‡Œå°±æ˜¯ä¸€ä¸ªç®€çŸ­çš„ï¼Œæœ‰æ„æ€çš„æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for x in range(1,101):</span><br><span class="line">    print&quot;fizz&quot;[x%3*len(&#39;fizz&#39;)::]+&quot;buzz&quot;[x%5*len(&#39;buzz&#39;)::] or x</span><br></pre></td></tr></table></figure></li>
<li><p>if è¯­å¥åœ¨è¡Œå†…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print &quot;Hello&quot; if True else &quot;World&quot;</span><br><span class="line">&gt;&gt;&gt; Hello</span><br></pre></td></tr></table></figure></li>
<li><p>è¿æ¥<br>ä¸‹é¢çš„æœ€åä¸€ç§æ–¹å¼åœ¨ç»‘å®šä¸¤ä¸ªä¸åŒç±»å‹çš„å¯¹è±¡æ—¶æ˜¾å¾—å¾ˆcoolã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nfc &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;]</span><br><span class="line">afc &#x3D; [&quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">print nfc + afc</span><br><span class="line">&gt;&gt;&gt; [&#39;Packers&#39;, &#39;49ers&#39;, &#39;Ravens&#39;, &#39;Patriots&#39;]</span><br><span class="line"></span><br><span class="line">print str(1) + &quot; world&quot;</span><br><span class="line">&gt;&gt;&gt; 1 world</span><br><span class="line"></span><br><span class="line">print &#96;1&#96; + &quot; world&quot;</span><br><span class="line">&gt;&gt;&gt; 1 world</span><br><span class="line"></span><br><span class="line">print 1, &quot;world&quot;</span><br><span class="line">&gt;&gt;&gt; 1 world</span><br><span class="line">print nfc, 1</span><br><span class="line">&gt;&gt;&gt; [&#39;Packers&#39;, &#39;49ers&#39;] 1</span><br></pre></td></tr></table></figure></li>
<li><p>æ•°å€¼æ¯”è¾ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x &#x3D; 2</span><br><span class="line">if 3 &gt; x &gt; 1:</span><br><span class="line">   print x</span><br><span class="line">&gt;&gt;&gt; 2</span><br><span class="line">if 1 &lt; x &gt; 0:</span><br><span class="line">   print x</span><br><span class="line">&gt;&gt;&gt; 2</span><br></pre></td></tr></table></figure></li>
<li><p>åŒæ—¶è¿­ä»£ä¸¤ä¸ªåˆ—è¡¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nfc &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;]</span><br><span class="line">afc &#x3D; [&quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">for teama, teamb in zip(nfc, afc):</span><br><span class="line">     print teama + &quot; vs. &quot; + teamb</span><br><span class="line">&gt;&gt;&gt; Packers vs. Ravens</span><br><span class="line">&gt;&gt;&gt; 49ers vs. Patriots</span><br></pre></td></tr></table></figure></li>
<li><p>å¸¦ç´¢å¼•çš„åˆ—è¡¨è¿­ä»£</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">teams &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">for index, team in enumerate(teams):</span><br><span class="line">    print index, team</span><br><span class="line">&gt;&gt;&gt; 0 Packers</span><br><span class="line">&gt;&gt;&gt; 1 49ers</span><br><span class="line">&gt;&gt;&gt; 2 Ravens</span><br><span class="line">&gt;&gt;&gt; 3 Patriots</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ—è¡¨æ¨å¯¼å¼</p>
<blockquote>
<p>å·²çŸ¥ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ·é€‰å‡ºå¶æ•°åˆ—è¡¨æ–¹æ³•ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">numbers &#x3D; [1,2,3,4,5,6]</span><br><span class="line">even &#x3D; []</span><br><span class="line">for number in numbers:</span><br><span class="line">    if number%2 &#x3D;&#x3D; 0:</span><br><span class="line">        even.append(number)</span><br></pre></td></tr></table></figure>
<p>è½¬å˜æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">numbers &#x3D; [1,2,3,4,5,6]</span><br><span class="line">even &#x3D; [number for number in numbers if number%2 &#x3D;&#x3D; 0]</span><br></pre></td></tr></table></figure></li>
<li><p>å­—å…¸æ¨å¯¼<br>å’Œåˆ—è¡¨æ¨å¯¼ç±»ä¼¼ï¼Œå­—å…¸å¯ä»¥åšåŒæ ·çš„å·¥ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">teams &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">print &#123;key: value for value, key in enumerate(teams)&#125;</span><br><span class="line">&gt;&gt;&gt; &#123;&#39;49ers&#39;: 1, &#39;Ravens&#39;: 2, &#39;Patriots&#39;: 3, &#39;Packers&#39;: 0&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>åˆå§‹åŒ–åˆ—è¡¨çš„å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">items &#x3D; [0]*3</span><br><span class="line">print items</span><br><span class="line">&gt;&gt;&gt; [0,0,0]</span><br></pre></td></tr></table></figure></li>
<li><p>åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">teams &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">print &quot;, &quot;.join(teams)</span><br><span class="line">&gt;&gt;&gt; &#39;Packers, 49ers, Ravens, Patriots&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>ä»å­—å…¸ä¸­è·å–å…ƒç´ <br>æˆ‘æ‰¿è®¤try/exceptä»£ç å¹¶ä¸é›…è‡´ï¼Œä¸è¿‡è¿™é‡Œæœ‰ä¸€ç§ç®€å•æ–¹æ³•ï¼Œå°è¯•åœ¨å­—å…¸ä¸­æŸ¥æ‰¾keyï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„alueå°†ç”¨ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸ºå…¶å˜é‡å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data &#x3D; &#123;&#39;user&#39;: 1, &#39;name&#39;: &#39;Max&#39;, &#39;three&#39;: 4&#125;</span><br><span class="line">try:</span><br><span class="line">   is_admin &#x3D; data[&#39;admin&#39;]</span><br><span class="line">except KeyError:</span><br><span class="line">   is_admin &#x3D; False</span><br></pre></td></tr></table></figure>
<p>æ›¿æ¢æˆè¿™æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data &#x3D; &#123;&#39;user&#39;: 1, &#39;name&#39;: &#39;Max&#39;, &#39;three&#39;: 4&#125;</span><br><span class="line">is_admin &#x3D; data.get(&#39;admin&#39;, False)</span><br></pre></td></tr></table></figure></li>
<li><p>è·å–åˆ—è¡¨çš„å­é›†<br>æœ‰æ—¶ï¼Œä½ åªéœ€è¦åˆ—è¡¨ä¸­çš„éƒ¨åˆ†å…ƒç´ ï¼Œè¿™é‡Œæ˜¯ä¸€äº›è·å–åˆ—è¡¨å­é›†çš„æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x &#x3D; [1,2,3,4,5,6]</span><br><span class="line">#å‰3ä¸ª</span><br><span class="line">print x[:3]</span><br><span class="line">&gt;&gt;&gt; [1,2,3]</span><br><span class="line">#ä¸­é—´4ä¸ª</span><br><span class="line">print x[1:5]</span><br><span class="line">&gt;&gt;&gt; [2,3,4,5]</span><br><span class="line">#æœ€å3ä¸ª</span><br><span class="line">print x[3:]</span><br><span class="line">&gt;&gt;&gt; [4,5,6]</span><br><span class="line">#å¥‡æ•°é¡¹</span><br><span class="line">print x[::2]</span><br><span class="line">&gt;&gt;&gt; [1,3,5]</span><br><span class="line">#å¶æ•°é¡¹</span><br><span class="line">print x[1::2]</span><br><span class="line">&gt;&gt;&gt; [2,4,6]</span><br></pre></td></tr></table></figure>
<p>é™¤äº†pythonå†…ç½®çš„æ•°æ®ç±»å‹å¤–ï¼Œåœ¨collectionæ¨¡å—åŒæ ·è¿˜åŒ…æ‹¬ä¸€äº›ç‰¹åˆ«çš„ç”¨ä¾‹ï¼Œåœ¨æœ‰äº›åœºåˆCounteréå¸¸å®ç”¨ã€‚å¦‚æœä½ å‚åŠ è¿‡åœ¨è¿™ä¸€å¹´çš„Facebook HackerCupï¼Œä½ ç”šè‡³ä¹Ÿèƒ½æ‰¾åˆ°ä»–çš„å®ç”¨ä¹‹å¤„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from collections import Counter</span><br><span class="line">print Counter(&quot;hello&quot;)</span><br><span class="line">&gt;&gt;&gt; Counter(&#123;&#39;l&#39;: 2, &#39;h&#39;: 1, &#39;e&#39;: 1, &#39;o&#39;: 1&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>è¿­ä»£å·¥å…·<br>å’Œcollectionsåº“ä¸€æ ·ï¼Œè¿˜æœ‰ä¸€ä¸ªåº“å«itertoolsï¼Œå¯¹æŸäº›é—®é¢˜çœŸèƒ½é«˜æ•ˆåœ°è§£å†³ã€‚å…¶ä¸­ä¸€ä¸ªç”¨ä¾‹æ˜¯æŸ¥æ‰¾æ‰€æœ‰ç»„åˆï¼Œä»–èƒ½å‘Šè¯‰ä½ åœ¨ä¸€ä¸ªç»„ä¸­å…ƒç´ çš„æ‰€æœ‰ä¸èƒ½çš„ç»„åˆæ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from itertools import combinations</span><br><span class="line">teams &#x3D; [&quot;Packers&quot;, &quot;49ers&quot;, &quot;Ravens&quot;, &quot;Patriots&quot;]</span><br><span class="line">for game in combinations(teams, 2):</span><br><span class="line">    print game</span><br><span class="line">&gt;&gt;&gt; (&#39;Packers&#39;, &#39;49ers&#39;)</span><br><span class="line">&gt;&gt;&gt; (&#39;Packers&#39;, &#39;Ravens&#39;)</span><br><span class="line">&gt;&gt;&gt; (&#39;Packers&#39;, &#39;Patriots&#39;)</span><br><span class="line">&gt;&gt;&gt; (&#39;49ers&#39;, &#39;Ravens&#39;)</span><br><span class="line">&gt;&gt;&gt; (&#39;49ers&#39;, &#39;Patriots&#39;)</span><br><span class="line">&gt;&gt;&gt; (&#39;Ravens&#39;, &#39;Patriots&#39;)</span><br></pre></td></tr></table></figure></li>
<li><p>False == True<br>æ¯”èµ·å®ç”¨æŠ€æœ¯æ¥è¯´è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹ï¼Œåœ¨pythonä¸­ï¼ŒTrueå’ŒFalseæ˜¯å…¨å±€å˜é‡ï¼Œå› æ­¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">False &#x3D; True</span><br><span class="line">if False:</span><br><span class="line">   print &quot;Hello&quot;</span><br><span class="line">else:</span><br><span class="line">   print &quot;World&quot;</span><br><span class="line">&gt;&gt;&gt; Hello</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://mp.weixin.qq.com/s/sIbOR71lqXxEA6ul9nt4Ag" target="_blank" rel="noopener">18ä¸ªPythoné«˜æ•ˆç¼–ç¨‹æŠ€å·§ï¼</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>SFTP</title>
    <url>/2020/04/23/SFTP/</url>
    <content><![CDATA[<h2 id="SFTP"><a href="#SFTP" class="headerlink" title="SFTP"></a>SFTP</h2><p>æœåŠ¡å™¨åœ°å€ï¼š10.40.14.26(å†…ç½‘)  47.94.162.132(å…¬ç½‘)   åŸŸåï¼šftp.wecash.net</p>
<p>SFTPé…ç½®è¿‡ç¨‹<br>   1 è¿æ¥ç”¨æˆ·æ ¹æ®ç”¨æˆ·éœ€æ±‚æ·»åŠ ç³»ç»Ÿç”¨æˆ·é…ç½®å¯†ç ï¼Œä¾‹ï¼š</p>
<pre><code>useradd sftp_test

passwd sftp_test</code></pre><p>   2  å°†ç”¨æˆ·åŠ å…¥sftp-groupç»„ï¼ˆå·²é¢„å…ˆæ·»åŠ ï¼‰</p>
<pre><code>usermod -a -G  sftp-group sftp_test</code></pre><p>   3 åˆ›å»ºchrootç›®å½•ï¼Œè¯¥ç›®å½•ä¸ºsftpç”¨æˆ·ç™»å½•çš„ç›®å½•ï¼Œæƒé™ä¸ºrootï¼Œé™åˆ¶ç”¨æˆ·åœ¨æ­¤ç›®å½•æ“ä½œæƒé™ï¼Œå¹¶ä¸”åˆ›å»ºç”¨æˆ·çš„æ“ä½œç›®å½•</p>
<pre><code>mkdir /data/sftp

mkdir /data/sftp/test 

æˆæƒæ“ä½œç›®å½•

chown sftp_test:sftp-group /data/sftp/test</code></pre><p>4 é…ç½®sshé…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;ssh&#x2F;sshd_config</span><br><span class="line">Protocol 2</span><br><span class="line">Port 22</span><br><span class="line">AddressFamily any</span><br><span class="line">ListenAddress 0.0.0.0</span><br><span class="line">AllowGroups root</span><br><span class="line">AllowGroups yunwei deploy sftp-group</span><br><span class="line">AuthorizedKeysCommand &#x2F;usr&#x2F;bin&#x2F;sss_ssh_authorizedkeys</span><br><span class="line">AuthorizedKeysCommandUser root</span><br><span class="line">ChallengeResponseAuthentication yes</span><br><span class="line">LogLevel INFO</span><br><span class="line">PasswordAuthentication yes</span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">Subsystem sftp-user &#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;sftp-server</span><br><span class="line">SyslogFacility AUTHPRIV</span><br><span class="line">UsePAM yes</span><br><span class="line">X11Forwarding yes</span><br><span class="line">Subsystem sftp &#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;sftp-server</span><br><span class="line">Match Group sftp-group</span><br><span class="line">ChrootDirectory &#x2F;data&#x2F;sftp</span><br><span class="line">AllowTcpForwarding no</span><br><span class="line">PermitTunnel no</span><br><span class="line">ForceCommand internal-sftp</span><br></pre></td></tr></table></figure>
<p>æ–°å¢é…ç½®ï¼š<br>         AllowGroups yunwei deploy sftp-group<br>         Subsystem sftp /usr/lib/openssh/sftp-servers<br>         Match Group sftp-group<br>         ChrootDirectory /data/sftp<br>         AllowTcpForwarding no<br>         PermitTunnel no<br>         ForceCommand internal-sftp<br>    é‡å¯sshdæœåŠ¡</p>
<pre><code>è¿æ¥æ–¹å¼ï¼š sftp sftp_test@10.40.14.26

ä½¿ç”¨sshè¿æ¥ä¼šæç¤ºä»…ç”¨sftpè¿æ¥ï¼š

        This service allows sftp connections only.

        Connection to 10.40.14.26 closed.</code></pre>]]></content>
      <categories>
        <category>SFTP</category>
      </categories>
      <tags>
        <tag>SFTP</tag>
      </tags>
  </entry>
  <entry>
    <title>Vimå‘½ä»¤åˆé›†</title>
    <url>/2020/04/23/Vim%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/</url>
    <content><![CDATA[<h2 id="Vimå‘½ä»¤åˆé›†"><a href="#Vimå‘½ä»¤åˆé›†" class="headerlink" title="Vimå‘½ä»¤åˆé›†"></a>Vimå‘½ä»¤åˆé›†</h2><h3 id="å‘½ä»¤å†å²"><a href="#å‘½ä»¤å†å²" class="headerlink" title="å‘½ä»¤å†å²"></a>å‘½ä»¤å†å²</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä»¥:å’Œ&#x2F;å¼€å¤´çš„å‘½ä»¤éƒ½æœ‰å†å²çºªå½•ï¼Œå¯ä»¥é¦–å…ˆé”®å…¥:æˆ–&#x2F;ç„¶åæŒ‰ä¸Šä¸‹ç®­å¤´æ¥é€‰æ‹©æŸä¸ªå†å²å‘½ä»¤ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="å¯åŠ¨vim"><a href="#å¯åŠ¨vim" class="headerlink" title="å¯åŠ¨vim"></a>å¯åŠ¨vim</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨å‘½ä»¤è¡Œçª—å£ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯</span><br><span class="line"></span><br><span class="line">vim ç›´æ¥å¯åŠ¨vim</span><br><span class="line"></span><br><span class="line">vim filename æ‰“å¼€vimå¹¶åˆ›å»ºåä¸ºfilenameçš„æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<h3 id="æ–‡ä»¶å‘½ä»¤"><a href="#æ–‡ä»¶å‘½ä»¤" class="headerlink" title="æ–‡ä»¶å‘½ä»¤"></a>æ–‡ä»¶å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰“å¼€å•ä¸ªæ–‡ä»¶</span><br><span class="line">vim file</span><br><span class="line"></span><br><span class="line">åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶</span><br><span class="line">vim file1 file2 file3 â€¦</span><br><span class="line"></span><br><span class="line">åœ¨vimçª—å£ä¸­æ‰“å¼€ä¸€ä¸ªæ–°æ–‡ä»¶</span><br><span class="line">:open file</span><br><span class="line"></span><br><span class="line">åœ¨æ–°çª—å£ä¸­æ‰“å¼€æ–‡ä»¶</span><br><span class="line">:split file</span><br><span class="line"></span><br><span class="line">åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">:bn</span><br><span class="line"></span><br><span class="line">åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">:bp</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå½“å‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶ä¼šç”¨[]æ‹¬èµ·æ¥ã€‚</span><br><span class="line">:args</span><br><span class="line"></span><br><span class="line">### æ‰“å¼€è¿œç¨‹æ–‡ä»¶ï¼Œæ¯”å¦‚ftpæˆ–è€…share folder</span><br><span class="line">:e ftp:&#x2F;&#x2F;192.168.10.76&#x2F;abc.txt</span><br><span class="line">:e \\qadrive\test\1.txt</span><br></pre></td></tr></table></figure>

<h3 id="vimçš„æ¨¡å¼"><a href="#vimçš„æ¨¡å¼" class="headerlink" title="vimçš„æ¨¡å¼"></a>vimçš„æ¨¡å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ­£å¸¸æ¨¡å¼ï¼ˆæŒ‰Escæˆ–Ctrl+[è¿›å…¥ï¼‰ å·¦ä¸‹è§’æ˜¾ç¤ºæ–‡ä»¶åæˆ–ä¸ºç©º</span><br><span class="line"></span><br><span class="line">æ’å…¥æ¨¡å¼ï¼ˆæŒ‰ié”®è¿›å…¥ï¼‰ å·¦ä¸‹è§’æ˜¾ç¤ºâ€“INSERTâ€“</span><br><span class="line"></span><br><span class="line">å¯è§†æ¨¡å¼ï¼ˆä¸çŸ¥é“å¦‚ä½•è¿›å…¥ï¼‰ å·¦ä¸‹è§’æ˜¾ç¤ºâ€“VISUALâ€“</span><br></pre></td></tr></table></figure>

<h3 id="å¯¼èˆªå‘½ä»¤"><a href="#å¯¼èˆªå‘½ä»¤" class="headerlink" title="å¯¼èˆªå‘½ä»¤"></a>å¯¼èˆªå‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">% æ‹¬å·åŒ¹é…</span><br></pre></td></tr></table></figure>

<h3 id="æ’å…¥å‘½ä»¤"><a href="#æ’å…¥å‘½ä»¤" class="headerlink" title="æ’å…¥å‘½ä»¤"></a>æ’å…¥å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">i åœ¨å½“å‰ä½ç½®ç”Ÿå‰æ’å…¥</span><br><span class="line"></span><br><span class="line">I åœ¨å½“å‰è¡Œé¦–æ’å…¥</span><br><span class="line"></span><br><span class="line">a åœ¨å½“å‰ä½ç½®åæ’å…¥</span><br><span class="line"></span><br><span class="line">A åœ¨å½“å‰è¡Œå°¾æ’å…¥</span><br><span class="line"></span><br><span class="line">o åœ¨å½“å‰è¡Œä¹‹åæ’å…¥ä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">O åœ¨å½“å‰è¡Œä¹‹å‰æ’å…¥ä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥æ‰¾å‘½ä»¤"><a href="#æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾å‘½ä»¤"></a>æŸ¥æ‰¾å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;textã€€ã€€æŸ¥æ‰¾textï¼ŒæŒ‰nå¥æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒæŒ‰Nå¥æŸ¥æ‰¾å‰ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">?textã€€ã€€æŸ¥æ‰¾textï¼Œåå‘æŸ¥æ‰¾ï¼ŒæŒ‰nå¥æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒæŒ‰Nå¥æŸ¥æ‰¾å‰ä¸€ä¸ªã€‚</span><br><span class="line"></span><br><span class="line">vimä¸­æœ‰ä¸€äº›ç‰¹æ®Šå­—ç¬¦åœ¨æŸ¥æ‰¾æ—¶éœ€è¦è½¬ä¹‰ã€€ã€€.*[]^%&#x2F;?~$</span><br><span class="line"></span><br><span class="line">:set ignorecaseã€€ã€€å¿½ç•¥å¤§å°å†™çš„æŸ¥æ‰¾</span><br><span class="line"></span><br><span class="line">:set noignorecaseã€€ã€€ä¸å¿½ç•¥å¤§å°å†™çš„æŸ¥æ‰¾</span><br><span class="line"></span><br><span class="line">æŸ¥æ‰¾å¾ˆé•¿çš„è¯ï¼Œå¦‚æœä¸€ä¸ªè¯å¾ˆé•¿ï¼Œé”®å…¥éº»çƒ¦ï¼Œå¯ä»¥å°†å…‰æ ‡ç§»åŠ¨åˆ°è¯¥è¯ä¸Šï¼ŒæŒ‰*æˆ–#é”®å³å¯ä»¥è¯¥å•è¯è¿›è¡Œæœç´¢ï¼Œç›¸å½“äº&#x2F;æœç´¢ã€‚è€Œ#å‘½ä»¤ç›¸å½“äº?æœç´¢ã€‚</span><br><span class="line"></span><br><span class="line">:set hlsearchã€€ã€€é«˜äº®æœç´¢ç»“æœï¼Œæ‰€æœ‰ç»“æœéƒ½é«˜äº®æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯åªæ˜¾ç¤ºä¸€ä¸ªåŒ¹é…ã€‚</span><br><span class="line">:set nohlsearchã€€ã€€å…³é—­é«˜äº®æœç´¢æ˜¾ç¤º</span><br><span class="line">:nohlsearchã€€ã€€å…³é—­å½“å‰çš„é«˜äº®æ˜¾ç¤ºï¼Œå¦‚æœå†æ¬¡æœç´¢æˆ–è€…æŒ‰ä¸‹næˆ–Né”®ï¼Œåˆ™ä¼šå†æ¬¡é«˜äº®ã€‚</span><br><span class="line">:set incsearchã€€ã€€é€æ­¥æœç´¢æ¨¡å¼ï¼Œå¯¹å½“å‰é”®å…¥çš„å­—ç¬¦è¿›è¡Œæœç´¢è€Œä¸å¿…ç­‰å¾…é”®å…¥å®Œæˆã€‚</span><br><span class="line">:set wrapscanã€€ã€€é‡æ–°æœç´¢ï¼Œåœ¨æœç´¢åˆ°æ–‡ä»¶å¤´æˆ–å°¾æ—¶ï¼Œè¿”å›ç»§ç»­æœç´¢ï¼Œé»˜è®¤å¼€å¯ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="æ›¿æ¢å‘½ä»¤"><a href="#æ›¿æ¢å‘½ä»¤" class="headerlink" title="æ›¿æ¢å‘½ä»¤"></a>æ›¿æ¢å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ra å°†å½“å‰å­—ç¬¦æ›¿æ¢ä¸ºaï¼Œå½“æœŸå­—ç¬¦å³å…‰æ ‡æ‰€åœ¨å­—ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line">s&#x2F;old&#x2F;new&#x2F; ç”¨oldæ›¿æ¢newï¼Œæ›¿æ¢å½“å‰è¡Œçš„ç¬¬ä¸€ä¸ªåŒ¹é…</span><br><span class="line"></span><br><span class="line">s&#x2F;old&#x2F;new&#x2F;g ç”¨oldæ›¿æ¢newï¼Œæ›¿æ¢å½“å‰è¡Œçš„æ‰€æœ‰åŒ¹é…</span><br><span class="line"></span><br><span class="line">%s&#x2F;old&#x2F;new&#x2F; ç”¨oldæ›¿æ¢newï¼Œæ›¿æ¢æ‰€æœ‰è¡Œçš„ç¬¬ä¸€ä¸ªåŒ¹é…</span><br><span class="line"></span><br><span class="line">%s&#x2F;old&#x2F;new&#x2F;g ç”¨oldæ›¿æ¢newï¼Œæ›¿æ¢æ•´ä¸ªæ–‡ä»¶çš„æ‰€æœ‰åŒ¹é…</span><br><span class="line"></span><br><span class="line">:10,20 s&#x2F;^&#x2F;    &#x2F;g åœ¨ç¬¬10è¡ŒçŸ¥ç¬¬20è¡Œæ¯è¡Œå‰é¢åŠ å››ä¸ªç©ºæ ¼ï¼Œç”¨äºç¼©è¿›ã€‚</span><br><span class="line"></span><br><span class="line">ddp äº¤æ¢å…‰æ ‡æ‰€åœ¨è¡Œå’Œå…¶ä¸‹ç´§é‚»çš„ä¸€è¡Œã€‚</span><br></pre></td></tr></table></figure>

<h3 id="ç§»åŠ¨å‘½ä»¤"><a href="#ç§»åŠ¨å‘½ä»¤" class="headerlink" title="ç§»åŠ¨å‘½ä»¤"></a>ç§»åŠ¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- h å·¦ç§»ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">- l å³ç§»ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå‘½ä»¤å¾ˆå°‘ç”¨ï¼Œä¸€èˆ¬ç”¨wä»£æ›¿ã€‚</span><br><span class="line">- k ä¸Šç§»ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">- j ä¸‹ç§»ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">ä»¥ä¸Šå››ä¸ªå‘½ä»¤å¯ä»¥é…åˆæ•°å­—ä½¿ç”¨ï¼Œæ¯”å¦‚20jå°±æ˜¯å‘ä¸‹ç§»åŠ¨20è¡Œï¼Œ5hå°±æ˜¯å‘å·¦ç§»åŠ¨5ä¸ªå­—ç¬¦ï¼Œåœ¨Vimä¸­ï¼Œå¾ˆå¤šå‘½ä»¤éƒ½å¯ä»¥é…åˆæ•°å­—ä½¿ç”¨ï¼Œæ¯”å¦‚åˆ é™¤10ä¸ªå­—ç¬¦10xï¼Œåœ¨å½“å‰ä½ç½®åæ’å…¥3ä¸ªï¼ï¼Œ3aï¼&lt;Esc&gt;ï¼Œè¿™é‡Œçš„Escæ˜¯å¿…é¡»çš„ï¼Œå¦åˆ™å‘½ä»¤ä¸ç”Ÿæ•ˆã€‚</span><br><span class="line"></span><br><span class="line">w å‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯ï¼ˆå…‰æ ‡åœåœ¨å•è¯é¦–éƒ¨ï¼‰ï¼Œå¦‚æœå·²åˆ°è¡Œå°¾ï¼Œåˆ™è½¬è‡³ä¸‹ä¸€è¡Œè¡Œé¦–ã€‚æ­¤å‘½ä»¤å¿«ï¼Œå¯ä»¥ä»£æ›¿lå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line">b å‘åç§»åŠ¨ä¸€ä¸ªå•è¯ 2b å‘åç§»åŠ¨2ä¸ªå•è¯</span><br><span class="line"></span><br><span class="line">eï¼ŒåŒwï¼Œåªä¸è¿‡æ˜¯å…‰æ ‡åœåœ¨å•è¯å°¾éƒ¨</span><br><span class="line"></span><br><span class="line">geï¼ŒåŒbï¼Œå…‰æ ‡åœåœ¨å•è¯å°¾éƒ¨ã€‚</span><br><span class="line"></span><br><span class="line">^ ç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">0ï¼ˆæ•°å­—0ï¼‰ç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ä¸€ä¸ªå­—ç¬¦ä¸Šï¼Œ</span><br><span class="line"></span><br><span class="line">&lt;HOME&gt; ç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚åŒ0å¥ã€‚</span><br><span class="line"></span><br><span class="line">$ ç§»åŠ¨åˆ°è¡Œå°¾ 3$ ç§»åŠ¨åˆ°ä¸‹é¢3è¡Œçš„è¡Œå°¾</span><br><span class="line"></span><br><span class="line">gg ç§»åŠ¨åˆ°æ–‡ä»¶å¤´ã€‚ &#x3D; [[</span><br><span class="line"></span><br><span class="line">Gï¼ˆshift + gï¼‰ ç§»åŠ¨åˆ°æ–‡ä»¶å°¾ã€‚ &#x3D; ]]</span><br><span class="line"></span><br><span class="line">fï¼ˆfindï¼‰å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨äºç§»åŠ¨ï¼Œfxå°†æ‰¾åˆ°å…‰æ ‡åç¬¬ä¸€ä¸ªä¸ºxçš„å­—ç¬¦ï¼Œ3fdå°†æ‰¾åˆ°ç¬¬ä¸‰ä¸ªä¸ºdçš„å­—ç¬¦ã€‚</span><br><span class="line"></span><br><span class="line">F åŒfï¼Œåå‘æŸ¥æ‰¾ã€‚</span><br><span class="line"></span><br><span class="line">è·³åˆ°æŒ‡å®šè¡Œï¼Œå†’å·+è¡Œå·ï¼Œå›è½¦ï¼Œæ¯”å¦‚è·³åˆ°240è¡Œå°±æ˜¯ :240å›è½¦ã€‚å¦ä¸€ä¸ªæ–¹æ³•æ˜¯è¡Œå·+Gï¼Œæ¯”å¦‚230Gè·³åˆ°230è¡Œã€‚</span><br><span class="line"></span><br><span class="line">Ctrl + e å‘ä¸‹æ»šåŠ¨ä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">Ctrl + y å‘ä¸Šæ»šåŠ¨ä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">Ctrl + d å‘ä¸‹æ»šåŠ¨åŠå±</span><br><span class="line"></span><br><span class="line">Ctrl + u å‘ä¸Šæ»šåŠ¨åŠå±</span><br><span class="line"></span><br><span class="line">Ctrl + f å‘ä¸‹æ»šåŠ¨ä¸€å±</span><br><span class="line"></span><br><span class="line">Ctrl + b å‘ä¸Šæ»šåŠ¨ä¸€å±</span><br></pre></td></tr></table></figure>

<h3 id="æ’¤é”€å’Œé‡åš"><a href="#æ’¤é”€å’Œé‡åš" class="headerlink" title="æ’¤é”€å’Œé‡åš"></a>æ’¤é”€å’Œé‡åš</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">u æ’¤é”€ï¼ˆUndoï¼‰</span><br><span class="line"></span><br><span class="line">U æ’¤é”€å¯¹æ•´è¡Œçš„æ“ä½œ</span><br><span class="line"></span><br><span class="line">Ctrl + r é‡åšï¼ˆRedoï¼‰ï¼Œå³æ’¤é”€çš„æ’¤é”€ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤å‘½ä»¤"><a href="#åˆ é™¤å‘½ä»¤" class="headerlink" title="åˆ é™¤å‘½ä»¤"></a>åˆ é™¤å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x åˆ é™¤å½“å‰å­—ç¬¦</span><br><span class="line"></span><br><span class="line">3x åˆ é™¤å½“å‰å…‰æ ‡å¼€å§‹å‘åä¸‰ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">X åˆ é™¤å½“å‰å­—ç¬¦çš„å‰ä¸€ä¸ªå­—ç¬¦ã€‚X&#x3D;dh</span><br><span class="line"></span><br><span class="line">dl åˆ é™¤å½“å‰å­—ç¬¦ï¼Œ dl&#x3D;x</span><br><span class="line"></span><br><span class="line">dh åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">dd åˆ é™¤å½“å‰è¡Œ</span><br><span class="line"></span><br><span class="line">dj åˆ é™¤ä¸Šä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">dk åˆ é™¤ä¸‹ä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">10d åˆ é™¤å½“å‰è¡Œå¼€å§‹çš„10è¡Œã€‚</span><br><span class="line"></span><br><span class="line">D åˆ é™¤å½“å‰å­—ç¬¦è‡³è¡Œå°¾ã€‚D&#x3D;d$</span><br><span class="line"></span><br><span class="line">d$ åˆ é™¤å½“å‰å­—ç¬¦ä¹‹åçš„æ‰€æœ‰å­—ç¬¦ï¼ˆæœ¬è¡Œï¼‰</span><br><span class="line"></span><br><span class="line">kdgg åˆ é™¤å½“å‰è¡Œä¹‹å‰æ‰€æœ‰è¡Œï¼ˆä¸åŒ…æ‹¬å½“å‰è¡Œï¼‰</span><br><span class="line"></span><br><span class="line">jdGï¼ˆjd shift + gï¼‰   åˆ é™¤å½“å‰è¡Œä¹‹åæ‰€æœ‰è¡Œï¼ˆä¸åŒ…æ‹¬å½“å‰è¡Œï¼‰</span><br><span class="line"></span><br><span class="line">:1,10d åˆ é™¤1-10è¡Œ</span><br><span class="line"></span><br><span class="line">:11,$d åˆ é™¤11è¡ŒåŠä»¥åæ‰€æœ‰çš„è¡Œ</span><br><span class="line"></span><br><span class="line">:1,$d åˆ é™¤æ‰€æœ‰è¡Œ</span><br><span class="line"></span><br><span class="line">J(shift + j)ã€€ã€€åˆ é™¤ä¸¤è¡Œä¹‹é—´çš„ç©ºè¡Œï¼Œå®é™…ä¸Šæ˜¯åˆå¹¶ä¸¤è¡Œã€‚</span><br></pre></td></tr></table></figure>

<h3 id="æ‹·è´å’Œç²˜è´´"><a href="#æ‹·è´å’Œç²˜è´´" class="headerlink" title="æ‹·è´å’Œç²˜è´´"></a>æ‹·è´å’Œç²˜è´´</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yy æ‹·è´å½“å‰è¡Œ</span><br><span class="line"></span><br><span class="line">nyy æ‹·è´å½“å‰åå¼€å§‹çš„nè¡Œï¼Œæ¯”å¦‚2yyæ‹·è´å½“å‰è¡ŒåŠå…¶ä¸‹ä¸€è¡Œã€‚</span><br><span class="line"></span><br><span class="line">p  åœ¨å½“å‰å…‰æ ‡åç²˜è´´,å¦‚æœä¹‹å‰ä½¿ç”¨äº†yyå‘½ä»¤æ¥å¤åˆ¶ä¸€è¡Œï¼Œé‚£ä¹ˆå°±åœ¨å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œç²˜è´´ã€‚</span><br><span class="line"></span><br><span class="line">shift+p åœ¨å½“å‰è¡Œå‰ç²˜è´´</span><br><span class="line"></span><br><span class="line">:1,10 co 20 å°†1-10è¡Œæ’å…¥åˆ°ç¬¬20è¡Œä¹‹åã€‚</span><br><span class="line"></span><br><span class="line">:1,$ co $ å°†æ•´ä¸ªæ–‡ä»¶å¤åˆ¶ä¸€ä»½å¹¶æ·»åŠ åˆ°æ–‡ä»¶å°¾éƒ¨ã€‚</span><br><span class="line"></span><br><span class="line">æ­£å¸¸æ¨¡å¼ä¸‹æŒ‰vï¼ˆé€å­—ï¼‰æˆ–Vï¼ˆé€è¡Œï¼‰è¿›å…¥å¯è§†æ¨¡å¼ï¼Œç„¶åç”¨jklhå‘½ä»¤ç§»åŠ¨å³å¯é€‰æ‹©æŸäº›è¡Œæˆ–å­—ç¬¦ï¼Œå†æŒ‰yå³å¯å¤åˆ¶</span><br><span class="line">ddpäº¤æ¢å½“å‰è¡Œå’Œå…¶ä¸‹ä¸€è¡Œ</span><br><span class="line"></span><br><span class="line">xpäº¤æ¢å½“å‰å­—ç¬¦å’Œå…¶åä¸€ä¸ªå­—ç¬¦</span><br></pre></td></tr></table></figure>

<h3 id="å‰ªåˆ‡å‘½ä»¤"><a href="#å‰ªåˆ‡å‘½ä»¤" class="headerlink" title="å‰ªåˆ‡å‘½ä»¤"></a>å‰ªåˆ‡å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ­£å¸¸æ¨¡å¼ä¸‹æŒ‰vï¼ˆé€å­—ï¼‰æˆ–Vï¼ˆé€è¡Œï¼‰è¿›å…¥å¯è§†æ¨¡å¼ï¼Œç„¶åç”¨jklhå‘½ä»¤ç§»åŠ¨å³å¯é€‰æ‹©æŸäº›è¡Œæˆ–å­—ç¬¦ï¼Œå†æŒ‰då³å¯å‰ªåˆ‡</span><br><span class="line"></span><br><span class="line">ndd å‰ªåˆ‡å½“å‰è¡Œä¹‹åçš„nè¡Œã€‚åˆ©ç”¨på‘½ä»¤å¯ä»¥å¯¹å‰ªåˆ‡çš„å†…å®¹è¿›è¡Œç²˜è´´</span><br><span class="line"></span><br><span class="line">:1,10d å°†1-10è¡Œå‰ªåˆ‡ã€‚åˆ©ç”¨på‘½ä»¤å¯å°†å‰ªåˆ‡åçš„å†…å®¹è¿›è¡Œç²˜è´´ã€‚</span><br><span class="line"></span><br><span class="line">:1, 10 m 20 å°†ç¬¬1-10è¡Œç§»åŠ¨åˆ°ç¬¬20è¡Œä¹‹åã€‚</span><br></pre></td></tr></table></figure>


<h3 id="é€€å‡ºå‘½ä»¤"><a href="#é€€å‡ºå‘½ä»¤" class="headerlink" title="é€€å‡ºå‘½ä»¤"></a>é€€å‡ºå‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:wq ä¿å­˜å¹¶é€€å‡º</span><br><span class="line"></span><br><span class="line">ZZ ä¿å­˜å¹¶é€€å‡º</span><br><span class="line"></span><br><span class="line">:q! å¼ºåˆ¶é€€å‡ºå¹¶å¿½ç•¥æ‰€æœ‰æ›´æ”¹</span><br><span class="line"></span><br><span class="line">:e! æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹ï¼Œå¹¶æ‰“å¼€åŸæ¥æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure>


<h3 id="çª—å£å‘½ä»¤"><a href="#çª—å£å‘½ä»¤" class="headerlink" title="çª—å£å‘½ä»¤"></a>çª—å£å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:splitæˆ–new æ‰“å¼€ä¸€ä¸ªæ–°çª—å£ï¼Œå…‰æ ‡åœåœ¨é¡¶å±‚çš„çª—å£ä¸Š</span><br><span class="line"></span><br><span class="line">:split fileæˆ–:new file ç”¨æ–°çª—å£æ‰“å¼€æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">splitæ‰“å¼€çš„çª—å£éƒ½æ˜¯æ¨ªå‘çš„ï¼Œä½¿ç”¨vsplitå¯ä»¥çºµå‘æ‰“å¼€çª—å£ã€‚</span><br><span class="line"></span><br><span class="line">Ctrl+ww ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªçª—å£</span><br><span class="line"></span><br><span class="line">Ctrl+wj ç§»åŠ¨åˆ°ä¸‹æ–¹çš„çª—å£</span><br><span class="line"></span><br><span class="line">Ctrl+wk ç§»åŠ¨åˆ°ä¸Šæ–¹çš„çª—å£</span><br></pre></td></tr></table></figure>

<h3 id="å…³é—­çª—å£"><a href="#å…³é—­çª—å£" class="headerlink" title="å…³é—­çª—å£"></a>å…³é—­çª—å£</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:close æœ€åä¸€ä¸ªçª—å£ä¸èƒ½ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå¯ä»¥é˜²æ­¢æ„å¤–é€€å‡ºvimã€‚</span><br><span class="line"></span><br><span class="line">:q å¦‚æœæ˜¯æœ€åä¸€ä¸ªè¢«å…³é—­çš„çª—å£ï¼Œé‚£ä¹ˆå°†é€€å‡ºvimã€‚</span><br><span class="line"></span><br><span class="line">ZZ ä¿å­˜å¹¶é€€å‡ºã€‚</span><br><span class="line"></span><br><span class="line">å…³é—­æ‰€æœ‰çª—å£ï¼Œåªä¿ç•™å½“å‰çª—å£</span><br><span class="line"></span><br><span class="line">:only</span><br></pre></td></tr></table></figure>

<h3 id="å½•åˆ¶å®"><a href="#å½•åˆ¶å®" class="headerlink" title="å½•åˆ¶å®"></a>å½•åˆ¶å®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æŒ‰qé”®åŠ ä»»æ„å­—æ¯å¼€å§‹å½•åˆ¶ï¼Œå†æŒ‰qé”®ç»“æŸå½•åˆ¶ï¼ˆè¿™æ„å‘³ç€vimä¸­çš„å®ä¸å¯åµŒå¥—ï¼‰ï¼Œä½¿ç”¨çš„æ—¶å€™@åŠ å®åï¼Œæ¯”å¦‚qaã€‚ã€‚ã€‚qå½•åˆ¶åä¸ºaçš„å®ï¼Œ@aä½¿ç”¨è¿™ä¸ªå®ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ‰§è¡Œshellå‘½ä»¤</span><br><span class="line"></span><br><span class="line">:!command</span><br><span class="line"></span><br><span class="line">:!ls åˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">:!perl -c script.pl æ£€æŸ¥perlè„šæœ¬è¯­æ³•ï¼Œå¯ä»¥ä¸ç”¨é€€å‡ºvimï¼Œéå¸¸æ–¹ä¾¿ã€‚</span><br><span class="line"></span><br><span class="line">:!perl script.pl æ‰§è¡Œperlè„šæœ¬ï¼Œå¯ä»¥ä¸ç”¨é€€å‡ºvimï¼Œéå¸¸æ–¹ä¾¿ã€‚</span><br><span class="line"></span><br><span class="line">:suspendæˆ–Ctrl â€“ Z æŒ‚èµ·vimï¼Œå›åˆ°shellï¼ŒæŒ‰fgå¯ä»¥è¿”å›vimã€‚</span><br></pre></td></tr></table></figure>

<h3 id="æ³¨é‡Šå‘½ä»¤"><a href="#æ³¨é‡Šå‘½ä»¤" class="headerlink" title="æ³¨é‡Šå‘½ä»¤"></a>æ³¨é‡Šå‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">perlç¨‹åºä¸­#å¼€å§‹çš„è¡Œä¸ºæ³¨é‡Šï¼Œæ‰€ä»¥è¦æ³¨é‡ŠæŸäº›è¡Œï¼Œåªéœ€åœ¨è¡Œé¦–åŠ å…¥#</span><br><span class="line"></span><br><span class="line">3,5 s&#x2F;^&#x2F;#&#x2F;g æ³¨é‡Šç¬¬3-5è¡Œ</span><br><span class="line"></span><br><span class="line">3,5 s&#x2F;^#&#x2F;&#x2F;g è§£é™¤3-5è¡Œçš„æ³¨é‡Š</span><br><span class="line"></span><br><span class="line">1,$ s&#x2F;^&#x2F;#&#x2F;g æ³¨é‡Šæ•´ä¸ªæ–‡æ¡£ã€‚</span><br><span class="line"></span><br><span class="line">:%s&#x2F;^&#x2F;#&#x2F;g æ³¨é‡Šæ•´ä¸ªæ–‡æ¡£ï¼Œæ­¤æ³•æ›´å¿«ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:help or F1 æ˜¾ç¤ºæ•´ä¸ªå¸®åŠ©</span><br><span class="line"></span><br><span class="line">:help xxx æ˜¾ç¤ºxxxçš„å¸®åŠ©ï¼Œæ¯”å¦‚ :help i, :help CTRL-[ï¼ˆå³Ctrl+[çš„å¸®åŠ©ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">:help â€˜numberâ€™ Vimé€‰é¡¹çš„å¸®åŠ©ç”¨å•å¼•å·æ‹¬èµ·</span><br><span class="line"></span><br><span class="line">:help &lt;Esc&gt;ç‰¹æ®Šé”®çš„å¸®åŠ©ç”¨&lt;&gt;æ‰©èµ·</span><br><span class="line"></span><br><span class="line">:help -t Vimå¯åŠ¨å‚æ•°çš„å¸®åŠ©ç”¨-</span><br><span class="line"></span><br><span class="line">:help i_&lt;Esc&gt; æ’å…¥æ¨¡å¼ä¸‹Escçš„å¸®åŠ©ï¼ŒæŸä¸ªæ¨¡å¼ä¸‹çš„å¸®åŠ©ç”¨æ¨¡å¼_ä¸»é¢˜çš„æ¨¡å¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¸®åŠ©æ–‡ä»¶ä¸­ä½äº||ä¹‹é—´çš„å†…å®¹æ˜¯è¶…é“¾æ¥ï¼Œå¯ä»¥ç”¨Ctrl+]è¿›å…¥é“¾æ¥ï¼ŒCtrl+oï¼ˆCtrl + tï¼‰è¿”å›</span><br></pre></td></tr></table></figure>

<h3 id="å…¶ä»–éç¼–è¾‘å‘½ä»¤"><a href="#å…¶ä»–éç¼–è¾‘å‘½ä»¤" class="headerlink" title="å…¶ä»–éç¼–è¾‘å‘½ä»¤"></a>å…¶ä»–éç¼–è¾‘å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">. é‡å¤å‰ä¸€æ¬¡å‘½ä»¤</span><br><span class="line"></span><br><span class="line">:set ruler?ã€€ã€€æŸ¥çœ‹æ˜¯å¦è®¾ç½®äº†rulerï¼Œåœ¨.vimrcä¸­ï¼Œä½¿ç”¨setå‘½ä»¤è®¾åˆ¶çš„é€‰é¡¹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹</span><br><span class="line"></span><br><span class="line">:scriptnamesã€€ã€€æŸ¥çœ‹vimè„šæœ¬æ–‡ä»¶çš„ä½ç½®ï¼Œæ¯”å¦‚.vimrcæ–‡ä»¶ï¼Œè¯­æ³•æ–‡ä»¶åŠpluginç­‰ã€‚</span><br><span class="line"></span><br><span class="line">:set list æ˜¾ç¤ºéæ‰“å°å­—ç¬¦ï¼Œå¦‚tabï¼Œç©ºæ ¼ï¼Œè¡Œå°¾ç­‰ã€‚å¦‚æœtabæ— æ³•æ˜¾ç¤ºï¼Œè¯·ç¡®å®šç”¨set lcs&#x3D;tab:&gt;-å‘½ä»¤è®¾ç½®äº†.vimrcæ–‡ä»¶ï¼Œå¹¶ç¡®ä¿ä½ çš„æ–‡ä»¶ä¸­çš„ç¡®æœ‰tabï¼Œå¦‚æœå¼€å¯äº†expendtabï¼Œé‚£ä¹ˆtabå°†è¢«æ‰©å±•ä¸ºç©ºæ ¼ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="Vimæ•™ç¨‹"><a href="#Vimæ•™ç¨‹" class="headerlink" title="Vimæ•™ç¨‹"></a>Vimæ•™ç¨‹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨Unixç³»ç»Ÿä¸Š</span><br><span class="line"></span><br><span class="line">$ vimtutor</span><br><span class="line"></span><br><span class="line">åœ¨Windowsç³»ç»Ÿä¸Š</span><br><span class="line">:help tutor</span><br><span class="line"></span><br><span class="line">:syntax åˆ—å‡ºå·²ç»å®šä¹‰çš„è¯­æ³•é¡¹</span><br><span class="line"></span><br><span class="line">:syntax clear æ¸…é™¤å·²å®šä¹‰çš„è¯­æ³•è§„åˆ™</span><br><span class="line"></span><br><span class="line">:syntax case match å¤§å°å†™æ•æ„Ÿï¼Œintå’ŒIntå°†è§†ä¸ºä¸åŒçš„è¯­æ³•å…ƒç´ </span><br><span class="line"></span><br><span class="line">:syntax case ignore å¤§å°å†™æ— å…³ï¼Œintå’ŒIntå°†è§†ä¸ºç›¸åŒçš„è¯­æ³•å…ƒç´ ï¼Œå¹¶ä½¿ç”¨åŒæ ·çš„é…è‰²æ–¹æ¡ˆ</span><br></pre></td></tr></table></figure>

<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p>[<a href="http://www.cnblogs.com/softwaretesting/archive/2011/07/12/2104435.html" target="_blank" rel="noopener">Vimå‘½ä»¤åˆé›†</a>]</p>
]]></content>
      <categories>
        <category>Vim</category>
      </categories>
      <tags>
        <tag>Vim</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaä¸“é¢˜</title>
    <url>/2020/04/23/kafka%E4%B8%93%E9%A2%98/</url>
    <content><![CDATA[<h1 id="kafkaä¸“é¢˜"><a href="#kafkaä¸“é¢˜" class="headerlink" title="kafkaä¸“é¢˜"></a>kafkaä¸“é¢˜</h1><blockquote>
<p><a href="https://www.cnblogs.com/BYRans/p/6054930.html" target="_blank" rel="noopener">Kafkaç®€ä»‹</a></p>
</blockquote>
<h2 id="æ¶ˆæ¯ç³»ç»Ÿä»‹ç»"><a href="#æ¶ˆæ¯ç³»ç»Ÿä»‹ç»" class="headerlink" title="æ¶ˆæ¯ç³»ç»Ÿä»‹ç»"></a>æ¶ˆæ¯ç³»ç»Ÿä»‹ç»</h2><p>ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿè´Ÿè´£å°†æ•°æ®ä»ä¸€ä¸ªåº”ç”¨ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªåº”ç”¨ï¼Œåº”ç”¨åªéœ€å…³æ³¨äºæ•°æ®ï¼Œæ— éœ€å…³æ³¨æ•°æ®åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªåº”ç”¨é—´æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’åŸºäºå¯é çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåœ¨å®¢æˆ·ç«¯åº”ç”¨å’Œæ¶ˆæ¯ç³»ç»Ÿä¹‹é—´å¼‚æ­¥ä¼ é€’æ¶ˆæ¯ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼šç‚¹å¯¹ç‚¹ä¼ é€’æ¨¡å¼ã€å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚å¤§éƒ¨åˆ†çš„æ¶ˆæ¯ç³»ç»Ÿé€‰ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚</p>
<h2 id="ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ"><a href="#ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ"></a>ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ</h2><p>åœ¨ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚æ­¤æ—¶ï¼Œå°†æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚å½“ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹äº†é˜Ÿåˆ—ä¸­çš„æŸæ¡æ•°æ®ä¹‹åï¼Œè¯¥æ¡æ•°æ®åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚è¯¥æ¨¡å¼å³ä½¿æœ‰å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹æ•°æ®ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®å¤„ç†çš„é¡ºåº.</p>
<h2 id="å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ"><a href="#å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ"></a>å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ</h2><p>åœ¨å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ä¸€ä¸ªtopicä¸­ã€‚ä¸ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹è¯¥topicä¸­æ‰€æœ‰çš„æ•°æ®ï¼ŒåŒä¸€æ¡æ•°æ®å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ•°æ®è¢«æ¶ˆè´¹åä¸ä¼šç«‹é©¬åˆ é™¤ã€‚åœ¨å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…ç§°ä¸ºå‘å¸ƒè€…ï¼Œæ¶ˆè´¹è€…ç§°ä¸ºè®¢é˜…è€…ã€‚è¯¥æ¨¡å¼çš„ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š</p>
<h2 id="Kafkaæ¦‚è¿°"><a href="#Kafkaæ¦‚è¿°" class="headerlink" title="Kafkaæ¦‚è¿°"></a>Kafkaæ¦‚è¿°</h2><p>Apache Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ”¯æ’‘æµ·é‡æ•°æ®çš„æ•°æ®ä¼ é€’ã€‚åœ¨ç¦»çº¿å’Œå®æ—¶çš„æ¶ˆæ¯å¤„ç†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒKafkaéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚Kafkaå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œå¹¶å¯¹æ¶ˆæ¯åˆ›å»ºäº†å¤‡ä»½ä¿è¯äº†æ•°æ®çš„å®‰å…¨ã€‚Kafkaåœ¨ä¿è¯äº†è¾ƒé«˜çš„å¤„ç†é€Ÿåº¦çš„åŒæ—¶ï¼Œåˆèƒ½ä¿è¯æ•°æ®å¤„ç†çš„ä½å»¶è¿Ÿå’Œæ•°æ®çš„é›¶ä¸¢å¤±ã€‚</p>
<p>Kafkaçš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<p>å¯é æ€§ï¼šKafkaæ˜¯ä¸€ä¸ªå…·æœ‰åˆ†åŒºæœºåˆ¶ã€å‰¯æœ¬æœºåˆ¶å’Œå®¹é”™æœºåˆ¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ<br>å¯æ‰©å±•æ€§ï¼šKafkaæ¶ˆæ¯ç³»ç»Ÿæ”¯æŒé›†ç¾¤è§„æ¨¡çš„çƒ­æ‰©å±•<br>é«˜æ€§èƒ½ï¼šKafkaåœ¨æ•°æ®å‘å¸ƒå’Œè®¢é˜…è¿‡ç¨‹ä¸­éƒ½èƒ½ä¿è¯æ•°æ®çš„é«˜ååé‡ã€‚å³ä¾¿åœ¨TBçº§æ•°æ®å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œä»ç„¶èƒ½ä¿è¯ç¨³å®šçš„æ€§èƒ½ã€‚</p>
<h2 id="Kafka-ä¸“ç”¨æœ¯è¯­"><a href="#Kafka-ä¸“ç”¨æœ¯è¯­" class="headerlink" title="Kafka ä¸“ç”¨æœ¯è¯­"></a>Kafka ä¸“ç”¨æœ¯è¯­</h2><p>ä¸€ä¸ªtopicé…ç½®äº†3ä¸ªpartitionã€‚Partition1æœ‰ä¸¤ä¸ªoffsetï¼š0å’Œ1ã€‚Partition2æœ‰4ä¸ªoffsetã€‚Partition3æœ‰1ä¸ªoffsetã€‚å‰¯æœ¬çš„idå’Œå‰¯æœ¬æ‰€åœ¨çš„æœºå™¨çš„idæ°å¥½ç›¸åŒã€‚</p>
<p>å¦‚æœä¸€ä¸ªtopicçš„å‰¯æœ¬æ•°ä¸º3ï¼Œé‚£ä¹ˆKafkaå°†åœ¨é›†ç¾¤ä¸­ä¸ºæ¯ä¸ªpartitionåˆ›å»º3ä¸ªç›¸åŒçš„å‰¯æœ¬ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªbrokerå­˜å‚¨ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚å¤šä¸ªproducerå’Œconsumerå¯åŒæ—¶ç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®ã€‚</p>
<p>å„ä¸ªæœ¯è¯­çš„è¯¦ç»†ä»‹ç»å¦‚ä¸‹:</p>
<ul>
<li>Topicï¼šåœ¨Kafkaä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªç±»åˆ«å±æ€§æ¥åˆ’åˆ†æ•°æ®çš„æ‰€å±ç±»ï¼Œåˆ’åˆ†æ•°æ®çš„è¿™ä¸ªç±»ç§°ä¸ºtopicã€‚å¦‚æœæŠŠKafkaçœ‹åšä¸ºä¸€ä¸ªæ•°æ®åº“ï¼Œtopicå¯ä»¥ç†è§£ä¸ºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼Œtopicçš„åå­—å³ä¸ºè¡¨åã€‚</li>
<li>Partitionï¼štopicä¸­çš„æ•°æ®åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚æ¯ä¸ªtopicè‡³å°‘æœ‰ä¸€ä¸ªpartitionã€‚æ¯ä¸ªpartitionä¸­çš„æ•°æ®ä½¿ç”¨å¤šä¸ªsegmentæ–‡ä»¶å­˜å‚¨ã€‚partitionä¸­çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œpartitioné—´çš„æ•°æ®ä¸¢å¤±äº†æ•°æ®çš„é¡ºåºã€‚å¦‚æœtopicæœ‰å¤šä¸ªpartitionï¼Œæ¶ˆè´¹æ•°æ®æ—¶å°±ä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºã€‚åœ¨éœ€è¦ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºçš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å°†partitionæ•°ç›®è®¾ä¸º1ã€‚</li>
<li>Partition offsetï¼šæ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå½“å‰Partitionä¸‹å”¯ä¸€çš„64å­—èŠ‚çš„offsetï¼Œå®ƒæŒ‡æ˜äº†è¿™æ¡æ¶ˆæ¯çš„èµ·å§‹ä½ç½®ã€‚</li>
<li>Replicas of partitionï¼šå‰¯æœ¬æ˜¯ä¸€ä¸ªåˆ†åŒºçš„å¤‡ä»½ã€‚å‰¯æœ¬ä¸ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå‰¯æœ¬åªç”¨äºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå³æ¶ˆè´¹è€…ä¸ä»ä¸ºfollowerçš„partitionä¸­æ¶ˆè´¹æ•°æ®ï¼Œè€Œæ˜¯ä»ä¸ºleaderçš„partitionä¸­è¯»å–æ•°æ®ã€‚</li>
<li>Brokerï¼š<ul>
<li>Kafka é›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨èŠ‚ç‚¹ç§°ä¸ºbrokerã€‚</li>
<li>brokerå­˜å‚¨topicçš„æ•°æ®ã€‚å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤æœ‰Nä¸ªbrokerï¼Œé‚£ä¹ˆæ¯ä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªpartitionã€‚</li>
<li>å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤æœ‰(N+M)ä¸ªbrokerï¼Œé‚£ä¹ˆå…¶ä¸­æœ‰Nä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªpartitionï¼Œå‰©ä¸‹çš„Mä¸ªbrokerä¸å­˜å‚¨è¯¥topicçš„partitionæ•°æ®ã€‚</li>
<li>å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤ä¸­brokeræ•°ç›®å°‘äºNä¸ªï¼Œé‚£ä¹ˆä¸€ä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°½é‡é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™ç§æƒ…å†µå®¹æ˜“å¯¼è‡´Kafkaé›†ç¾¤æ•°æ®ä¸å‡è¡¡ã€‚</li>
</ul>
</li>
<li>Producerï¼šç”Ÿäº§è€…å³æ•°æ®çš„å‘å¸ƒè€…ï¼Œè¯¥è§’è‰²å°†æ¶ˆæ¯å‘å¸ƒåˆ°Kafkaçš„topicä¸­ã€‚brokeræ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯åï¼Œbrokerå°†è¯¥æ¶ˆæ¯è¿½åŠ åˆ°å½“å‰ç”¨äºè¿½åŠ æ•°æ®çš„segmentæ–‡ä»¶ä¸­ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªpartitionä¸­ï¼Œç”Ÿäº§è€…ä¹Ÿå¯ä»¥æŒ‡å®šæ•°æ®å­˜å‚¨çš„partitionã€‚</li>
<li>Consumerï¼šæ¶ˆè´¹è€…å¯ä»¥ä»brokerä¸­è¯»å–æ•°æ®ã€‚æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªtopicä¸­çš„æ•°æ®ã€‚</li>
<li>Leaderï¼šæ¯ä¸ªpartitionæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä½œä¸ºLeaderï¼ŒLeaderæ˜¯å½“å‰è´Ÿè´£æ•°æ®çš„è¯»å†™çš„partitionã€‚</li>
<li>Followerï¼šFollowerè·ŸéšLeaderï¼Œæ‰€æœ‰å†™è¯·æ±‚éƒ½é€šè¿‡Leaderè·¯ç”±ï¼Œæ•°æ®å˜æ›´ä¼šå¹¿æ’­ç»™æ‰€æœ‰Followerï¼ŒFollowerä¸Leaderä¿æŒæ•°æ®åŒæ­¥ã€‚å¦‚æœLeaderå¤±æ•ˆï¼Œåˆ™ä»Followerä¸­é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„Leaderã€‚å½“Followerä¸LeaderæŒ‚æ‰ã€å¡ä½æˆ–è€…åŒæ­¥å¤ªæ…¢ï¼Œleaderä¼šæŠŠè¿™ä¸ªfollowerä»â€œin sync replicasâ€ï¼ˆISRï¼‰åˆ—è¡¨ä¸­åˆ é™¤ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªFollowerã€‚</li>
</ul>
<h2 id="Kafkaæ¶æ„"><a href="#Kafkaæ¶æ„" class="headerlink" title="Kafkaæ¶æ„"></a>Kafkaæ¶æ„</h2><ul>
<li>Brokerï¼šKafkaçš„brokeræ˜¯æ— çŠ¶æ€çš„ï¼Œbrokerä½¿ç”¨Zookeeperç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ã€‚Leaderçš„é€‰ä¸¾ä¹Ÿç”±Zookeeperè´Ÿè´£ã€‚</li>
<li>Zookeeperï¼šZookeeperè´Ÿè´£ç»´æŠ¤å’Œåè°ƒbrokerã€‚å½“Kafkaç³»ç»Ÿä¸­æ–°å¢äº†brokeræˆ–è€…æŸä¸ªbrokerå‘ç”Ÿæ•…éšœå¤±æ•ˆæ—¶ï¼Œç”±ZooKeeperé€šçŸ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¾æ®Zookeeperçš„brokerçŠ¶æ€ä¿¡æ¯ä¸brokeråè°ƒæ•°æ®çš„å‘å¸ƒå’Œè®¢é˜…ä»»åŠ¡ã€‚</li>
<li>Producerï¼šç”Ÿäº§è€…å°†æ•°æ®æ¨é€åˆ°brokerä¸Šï¼Œå½“é›†ç¾¤ä¸­å‡ºç°æ–°çš„brokeræ—¶ï¼Œæ‰€æœ‰çš„ç”Ÿäº§è€…å°†ä¼šæœå¯»åˆ°è¿™ä¸ªæ–°çš„brokerï¼Œå¹¶è‡ªåŠ¨å°†æ•°æ®å‘é€åˆ°è¿™ä¸ªbrokerä¸Šã€‚</li>
<li>Consumerï¼šå› ä¸ºKafkaçš„brokeræ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥consumerå¿…é¡»ä½¿ç”¨partition offsetæ¥è®°å½•æ¶ˆè´¹äº†å¤šå°‘æ•°æ®ã€‚å¦‚æœä¸€ä¸ªconsumeræŒ‡å®šäº†ä¸€ä¸ªtopicçš„offsetï¼Œæ„å‘³ç€è¯¥consumerå·²ç»æ¶ˆè´¹äº†è¯¥offsetä¹‹å‰çš„æ‰€æœ‰æ•°æ®ã€‚consumerå¯ä»¥é€šè¿‡æŒ‡å®šoffsetï¼Œä»topicçš„æŒ‡å®šä½ç½®å¼€å§‹æ¶ˆè´¹æ•°æ®ã€‚consumerçš„offsetå­˜å‚¨åœ¨Zookeeperä¸­ã€‚</li>
</ul>
<h2 id="Kafkaå·¥ä½œæµç¨‹"><a href="#Kafkaå·¥ä½œæµç¨‹" class="headerlink" title="Kafkaå·¥ä½œæµç¨‹"></a>Kafkaå·¥ä½œæµç¨‹</h2><p>Kafkaå°†æŸtopicçš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªpartitionä¸­ã€‚ä¸€ä¸ªpartitionå†…æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„indexï¼Œè¿™ä¸ªindexå«åšoffsetã€‚æ–°æ¥çš„æ•°æ®è¿½åŠ åˆ°partitionçš„å°¾éƒ¨ã€‚æ¯æ¡æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šåšå¤‡ä»½ï¼Œä»è€Œä¿è¯äº†Kafkaä½¿ç”¨çš„å¯é æ€§ã€‚</p>
<p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°topicä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©å¤šç§æ¶ˆè´¹æ–¹å¼æ¶ˆè´¹Kafkaä¸­çš„æ•°æ®ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ¶ˆè´¹æ–¹å¼çš„æµç¨‹ã€‚</p>
<h3 id="ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š"><a href="#ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š" class="headerlink" title="ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š"></a>ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š</h3><ul>
<li>ç”Ÿäº§è€…å°†æ•°æ®å‘é€åˆ°æŒ‡å®štopicä¸­</li>
<li>Kafkaå°†æ•°æ®ä»¥partitionçš„æ–¹å¼å­˜å‚¨åˆ°brokerä¸Šã€‚Kafkaæ”¯æŒæ•°æ®å‡è¡¡ï¼Œä¾‹å¦‚ç”Ÿäº§è€…ç”Ÿæˆäº†ä¸¤æ¡æ¶ˆæ¯ï¼Œtopicæœ‰ä¸¤ä¸ªpartitionï¼Œé‚£ä¹ˆKafkaå°†åœ¨ä¸¤ä¸ªpartitionä¸Šåˆ†åˆ«å­˜å‚¨ä¸€æ¡æ¶ˆæ¯</li>
<li>æ¶ˆè´¹è€…è®¢é˜…æŒ‡å®štopicçš„æ•°æ®</li>
<li>å½“æ¶ˆè´¹è€…è®¢é˜…topicä¸­æ¶ˆæ¯æ—¶ï¼ŒKafkaå°†å½“å‰çš„offsetå‘ç»™æ¶ˆè´¹è€…ï¼ŒåŒæ—¶å°†offsetå­˜å‚¨åˆ°Zookeeperä¸­</li>
<li>æ¶ˆè´¹è€…ä»¥ç‰¹å®šçš„é—´éš”ï¼ˆå¦‚100msï¼‰å‘Kafkaè¯·æ±‚æ•°æ®</li>
<li>å½“Kafkaæ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ•°æ®æ—¶ï¼ŒKafkaå°†è¿™äº›æ•°æ®æ¨é€ç»™æ¶ˆè´¹è€…</li>
<li>æ¶ˆè´¹è€…å—åˆ°Kafkaæ¨é€çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œå¤„ç†</li>
<li>å½“æ¶ˆè´¹è€…å¤„ç†å®Œè¯¥æ¡æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…å‘Kafka brokerå‘é€ä¸€ä¸ªè¯¥æ¶ˆæ¯å·²è¢«æ¶ˆè´¹çš„åé¦ˆ</li>
<li>å½“Kafkaæ¥åˆ°æ¶ˆè´¹è€…çš„åé¦ˆåï¼ŒKafkaæ›´æ–°offsetåŒ…æ‹¬Zookeeperä¸­çš„offsetã€‚</li>
<li>ä»¥ä¸Šè¿‡ç¨‹ä¸€ç›´é‡å¤ï¼Œç›´åˆ°æ¶ˆè´¹è€…åœæ­¢è¯·æ±‚æ•°æ®</li>
<li>æ¶ˆè´¹è€…å¯ä»¥é‡ç½®offsetï¼Œä»è€Œå¯ä»¥çµæ´»æ¶ˆè´¹å­˜å‚¨åœ¨Kafkaä¸Šçš„æ•°æ®</li>
</ul>
<h3 id="æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹"><a href="#æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹" class="headerlink" title="æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹"></a>æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹</h3><p>Kafkaæ”¯æŒæ¶ˆè´¹è€…ç»„å†…çš„å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªtopicï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±å…·æœ‰åŒä¸€ä¸ªGroup IDçš„å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°æŒ‡å®šçš„topic</li>
<li>Kafkaå°†æ•°æ®å­˜å‚¨åˆ°brokerä¸Šçš„partitionä¸­</li>
<li>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…äº†ä¸€ä¸ªtopicï¼Œtopicåå­—ä¸ºâ€œtestâ€ï¼Œæ¶ˆè´¹è€…çš„Group IDä¸ºâ€œGroup1â€</li>
<li>æ­¤æ—¶Kafkaçš„å¤„ç†æ–¹å¼ä¸åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µä¸€æ ·</li>
<li>å½“Kafkaæ¥æ”¶åˆ°ä¸€ä¸ªåŒæ ·Group IDä¸ºâ€œGroup1â€ã€æ¶ˆè´¹çš„topicåŒæ ·ä¸ºâ€œtestâ€çš„æ¶ˆè´¹è€…çš„è¯·æ±‚æ—¶ï¼ŒKafkaæŠŠæ•°æ®æ“ä½œæ¨¡å¼åˆ‡æ¢ä¸ºåˆ†äº«æ¨¡å¼ï¼Œæ­¤æ—¶æ•°æ®å°†åœ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ä¸Šå…±äº«ã€‚</li>
<li>å½“æ¶ˆè´¹è€…çš„æ•°ç›®è¶…è¿‡topicçš„partitionæ•°ç›®æ—¶ï¼Œåæ¥çš„æ¶ˆè´¹è€…å°†æ¶ˆè´¹ä¸åˆ°Kafkaä¸­çš„æ•°æ®ã€‚å› ä¸ºåœ¨Kafkaç»™æ¯ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹è€…è‡³å°‘åˆ†é…ä¸€ä¸ªpartitionï¼Œä¸€æ—¦partitionéƒ½è¢«æŒ‡æ´¾ç»™æ¶ˆè´¹è€…äº†ï¼Œæ–°æ¥çš„æ¶ˆè´¹è€…å°†ä¸ä¼šå†åˆ†é…partitionã€‚å³ä¸€ä¸ªpartitionåªèƒ½åˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionã€‚</li>
</ol>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a></p>
<h2 id="å®‰è£…zookeeperä¾èµ–"><a href="#å®‰è£…zookeeperä¾èµ–" class="headerlink" title="å®‰è£…zookeeperä¾èµ–"></a>å®‰è£…zookeeperä¾èµ–</h2><p><a href="http://zookeeper.apache.org/" target="_blank" rel="noopener">Apache ZooKeeper - Home</a><br>å¯åŠ¨kafkaå¾ˆç®€å•ï¼Œé…ç½®å¥½å‰ç½®çš„æ“ä½œåï¼Œå…ˆè¿›å…¥zookeeperçš„ç›®å½•ä¸‹ï¼Œå¯åŠ¨zookeeper,å¯ä»¥å•ç‹¬å®‰è£…,ä¹Ÿå¯ä»¥ä½¿ç”¨kafkaä¸­é›†æˆçš„zookeeper,é»˜è®¤åœ¨binç›®å½•ä¸‹æœ‰zookeeperçš„å¯åŠ¨è„šæœ¬,zookeeperå’Œkafkaçš„é…ç½®å‡åœ¨kafkaå®‰è£…åŒ…ä¸‹çš„configç›®å½•ä¸‹,ä¸‹é¢é‡‡ç”¨å•ç‹¬å®‰è£…kafkaçš„æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;soft&#x2F;zookeeper</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨è„šæœ¬ä½¿ç”¨æ–¹æ³•</span><br><span class="line">Usage: .&#x2F;bin&#x2F;zkServer.sh &#123;start|start-foreground|stop|restart|status|upgrade|print-cmd&#125;</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨Zookeeper</span><br><span class="line">.&#x2F;bin&#x2F;zkServer.sh  start</span><br><span class="line">&#x2F;&#x2F; å…³é—­Zookeeper</span><br><span class="line">.&#x2F;bin&#x2F;zkServer.sh  stop</span><br><span class="line">&#x2F;&#x2F; æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨</span><br><span class="line">ps -ef | grep zookeepe</span><br></pre></td></tr></table></figure>
<p>PSï¼šå› ä¸ºkafkaæ˜¯éœ€è¦æ³¨å†Œåœ¨zookeeperä¸Šé¢ï¼Œé€šè¿‡zookeeperè¿›è¡Œç®¡ç†å’Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥å¯åŠ¨kafkaä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯åŠ¨zookeeperã€‚</p>
<h2 id="2-kafkaå®‰è£…"><a href="#2-kafkaå®‰è£…" class="headerlink" title="2. kafkaå®‰è£…"></a>2. kafkaå®‰è£…</h2><p>éšåæˆ‘ä»¬è¿›å…¥Kafkaç›®å½•ä¸‹ï¼Œå¯åŠ¨kafkaï¼Œå…·ä½“æ“ä½œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;kafka_2.11-1.0.0</span><br><span class="line">&#x2F;&#x2F; ä¿®æ”¹é…ç½®</span><br><span class="line">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;config&#x2F;server.properties  kafkaé…ç½®</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;config&#x2F;zookeeper.properties   kafkaé›†æˆçš„zookeeperé…ç½®</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨kafka</span><br><span class="line">.&#x2F;bin&#x2F;kafka-server-start.sh -daemon .&#x2F;config&#x2F;server.properties</span><br><span class="line">&#x2F;&#x2F; æŸ¥çœ‹</span><br><span class="line">jps -lm</span><br><span class="line">11776 &#x2F;usr&#x2F;local&#x2F;cerebro-0.7.2&#x2F;lib&#x2F;cerebro.cerebro-0.7.2-launcher.jar</span><br><span class="line">1392 &#x2F;usr&#x2F;share&#x2F;jenkins&#x2F;jenkins.war --webroot&#x3D;&#x2F;var&#x2F;cache&#x2F;jenkins&#x2F;war --httpPort&#x3D;8080</span><br><span class="line">24209 sun.tools.jps.Jps -lm</span><br><span class="line">20867 com.github.ltsopensource.startup.jobtracker.JobTrackerStartup &#x2F;data&#x2F;soft&#x2F;lts&#x2F;conf&#x2F;zoo</span><br><span class="line">20755 com.github.ltsopensource.startup.admin.JettyContainer &#x2F;data&#x2F;soft&#x2F;lts</span><br><span class="line">7972 org.apache.zookeeper.server.quorum.QuorumPeerMain &#x2F;data&#x2F;soft&#x2F;zookeeper-3.3.6&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">10486 kafka.Kafka ..&#x2F;config&#x2F;server.properties</span><br><span class="line">12029 com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk 127.0.0.1:2181 --port 9001 --refresh 10.seconds --retain 2.days</span><br><span class="line">11471 org.elasticsearch.bootstrap.Elasticsearch</span><br><span class="line">PS: å¯ä»¥çœ‹åˆ°zookeeperå’Œkafkaéƒ½å·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯å•æœºçš„å‘½ä»¤ï¼Œé›†ç¾¤çš„å‘½ä»¤åé¢å†è®²ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">bin&#x2F;kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic testKJ1</span><br><span class="line"></span><br><span class="line">2. ä¸ºtopicå¢åŠ å‰¯æœ¬</span><br><span class="line">bin&#x2F;kafka-reassign -partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json&#x2F;partitions-to-move.json -execute</span><br><span class="line"></span><br><span class="line">3. åˆ›å»ºtopic</span><br><span class="line">bin&#x2F;kafka-topics.sh --create --zookeeper localhost:2181 --replication -factor1 --partitions 1 --topic testKJ1</span><br><span class="line"></span><br><span class="line">4. ä¸ºtopicå¢åŠ partition</span><br><span class="line">bin&#x2F;bin&#x2F;kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions2 â€“topic testKJ1</span><br><span class="line"></span><br><span class="line">5. kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤</span><br><span class="line">bin&#x2F;kafka-console-producer.sh --broker-list localhost:9092 --topic testKJ1</span><br><span class="line"></span><br><span class="line">6. kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤</span><br><span class="line">bin&#x2F;kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic testKJ1</span><br><span class="line"></span><br><span class="line">7. kafkaæœåŠ¡å¯åŠ¨</span><br><span class="line">bin&#x2F;kafka-server-start.sh -daemon ..&#x2F;config&#x2F;server.properties</span><br><span class="line"></span><br><span class="line">8. ä¸‹çº¿broker</span><br><span class="line">bin&#x2F;kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker #brokerId# --num.retries3--retry.interval.ms 60</span><br><span class="line">shutdownÂ broker</span><br><span class="line"></span><br><span class="line">9. åˆ é™¤topic,åªä¼šåˆ é™¤zookeeperä¸­çš„å…ƒæ•°æ®ï¼Œæ¶ˆæ¯æ–‡ä»¶é¡»æ‰‹åŠ¨åˆ é™¤</span><br><span class="line">.&#x2F;bin&#x2F;kafka-topics.sh  --delete --zookeeper 127.0.0.1:2181 --topic topic-name</span><br><span class="line"></span><br><span class="line">10. æŸ¥çœ‹topicæ¶ˆè´¹è¿›åº¦</span><br><span class="line">è¿™ä¸ªä¼šæ˜¾ç¤ºå‡ºconsumer groupçš„offsetæƒ…å†µï¼Œ å¿…é¡»å‚æ•°ä¸º--groupï¼Œ ä¸æŒ‡å®š--topicï¼Œé»˜è®¤ä¸ºæ‰€æœ‰topic</span><br><span class="line">æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset</span><br><span class="line">bin&#x2F;kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group test --topic testKJ1</span><br><span class="line">bin&#x2F;kafka-consumer-offset-checker.sh --zookeeper 192.168.0.201:12181 --group group1 --topic group1</span><br><span class="line"></span><br><span class="line">11. åˆ—å‡ºæ‰€æœ‰çš„TOPIC</span><br><span class="line">bin&#x2F;kafka-topics.sh --zookeeper 127.0.0.1:2181 --list</span><br></pre></td></tr></table></figure>
<h2 id="Connecting-to-ZooKeeper"><a href="#Connecting-to-ZooKeeper" class="headerlink" title="Connecting to ZooKeeper"></a>Connecting to ZooKeeper</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. check status</span><br><span class="line">$ bin&#x2F;zkServer.sh status</span><br><span class="line">2. connect</span><br><span class="line">$ bin&#x2F;zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯: <a href="http://zookeeper.apache.org/doc/current/zookeeperStarted.html" target="_blank" rel="noopener">ZooKeeper Getting Started Guide</a></p>
]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå•ä¾‹æ¨¡å¼</title>
    <url>/2020/04/23/python%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="pythonå•ä¾‹æ¨¡å¼"><a href="#pythonå•ä¾‹æ¨¡å¼" class="headerlink" title="pythonå•ä¾‹æ¨¡å¼"></a>pythonå•ä¾‹æ¨¡å¼</h2><h2 id="ä¸€-ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ä¸€-ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸€. ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ä¸€. ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œè¯¥æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚å½“ä½ å¸Œæœ›åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ï¼ŒæŸä¸ªç±»åªèƒ½å‡ºç°ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå•ä¾‹å¯¹è±¡å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚</p>
<p>æ¯”å¦‚ï¼ŒæŸä¸ªæœåŠ¡å™¨ç¨‹åºçš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ª AppConfig çš„ç±»æ¥è¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ã€‚å¦‚æœåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦åˆ›å»º AppConfig å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™å°±å¯¼è‡´ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ª AppConfig çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œè¿™æ ·ä¼šä¸¥é‡æµªè´¹å†…å­˜èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨é…ç½®æ–‡ä»¶å†…å®¹å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚äº‹å®ä¸Šï¼Œç±»ä¼¼ AppConfig è¿™æ ·çš„ç±»ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚</p>
<h2 id="äºŒ-å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"><a href="#äºŒ-å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="äºŒ. å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"></a>äºŒ. å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼</h2><p>åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šç§æ–¹æ³•æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼š<br>ä½¿ç”¨æ¨¡å—<br>ä½¿ç”¨ <strong>new</strong><br>ä½¿ç”¨è£…é¥°å™¨ï¼ˆdecoratorï¼‰<br>ä½¿ç”¨å…ƒç±»ï¼ˆmetaclass)</p>
<h3 id="2-1-ä½¿ç”¨æ¨¡å—"><a href="#2-1-ä½¿ç”¨æ¨¡å—" class="headerlink" title="2.1 ä½¿ç”¨æ¨¡å—"></a>2.1 ä½¿ç”¨æ¨¡å—</h3><p>å…¶å®ï¼ŒPython çš„æ¨¡å—å°±æ˜¯å¤©ç„¶çš„å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºæ¨¡å—åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶ï¼Œä¼šç”Ÿæˆ .pyc æ–‡ä»¶ï¼Œå½“ç¬¬äºŒæ¬¡å¯¼å…¥æ—¶ï¼Œå°±ä¼šç›´æ¥åŠ è½½ .pyc æ–‡ä»¶ï¼Œè€Œä¸ä¼šå†æ¬¡æ‰§è¡Œæ¨¡å—ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€æŠŠç›¸å…³çš„å‡½æ•°å’Œæ•°æ®å®šä¹‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå°±å¯ä»¥è·å¾—ä¸€ä¸ªå•ä¾‹å¯¹è±¡äº†ã€‚å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³è¦ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå¯ä»¥è€ƒè™‘è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mysingleton.py</span><br><span class="line">class My_Singleton(object):</span><br><span class="line">    def foo(self):</span><br><span class="line">        pass</span><br><span class="line">        </span><br><span class="line">my_singleton &#x3D; My_Singleton()</span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜åœ¨æ–‡ä»¶ mysingleton.py ä¸­ï¼Œç„¶åè¿™æ ·ä½¿ç”¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from mysingleton import my_singleton</span><br><span class="line">my_singleton.foo()</span><br></pre></td></tr></table></figure>

<h3 id="2-2-ä½¿ç”¨new"><a href="#2-2-ä½¿ç”¨new" class="headerlink" title="2.2 ä½¿ç”¨new"></a>2.2 ä½¿ç”¨<strong>new</strong></h3><p><strong>new</strong>()åœ¨<strong>init</strong>()ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚åˆ©ç”¨è¿™ä¸ªæ–¹æ³•å’Œç±»çš„å±æ€§çš„ç‰¹ç‚¹å¯ä»¥å®ç°è®¾è®¡æ¨¡å¼çš„å•ä¾‹æ¨¡å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singeton(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å•ä¾‹æ¨¡å¼</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not hasattr(cls, &#39;_instance&#39;):</span><br><span class="line">            # orig &#x3D; super(Singeton, cls)</span><br><span class="line">            cls._instance &#x3D; super(Singeton, cls).__new__(cls, *args, **kwargs)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyCLass(Singeton):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line"></span><br><span class="line">one &#x3D; MyCLass()</span><br><span class="line">two &#x3D; MyCLass()</span><br><span class="line">print(one is two)</span><br><span class="line">print(one &#x3D;&#x3D; two)</span><br><span class="line">print(id(one), id(two))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">è¾“å‡º:</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">4436793720 4436793720</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†ç±»çš„å®ä¾‹å’Œä¸€ä¸ªç±»å˜é‡ _instance å…³è”èµ·æ¥ï¼Œå¦‚æœ cls._instance ä¸º None åˆ™åˆ›å»ºå®ä¾‹ï¼Œå¦åˆ™ç›´æ¥è¿”å› cls._instance</p>
<h3 id="2-3-å…±äº«å±æ€§"><a href="#2-3-å…±äº«å±æ€§" class="headerlink" title="2.3 å…±äº«å±æ€§"></a>2.3 å…±äº«å±æ€§</h3><p>åˆ›å»ºå®ä¾‹æ—¶æŠŠæ‰€æœ‰å®ä¾‹çš„<strong>dict</strong>æŒ‡å‘åŒä¸€ä¸ªå­—å…¸,è¿™æ ·å®ƒä»¬å…·æœ‰ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Borg(object):</span><br><span class="line">    _state &#x3D; &#123;&#125;</span><br><span class="line">    def __new__(cls, *args, **kw):</span><br><span class="line">        ob &#x3D; super(Borg, cls).__new__(cls, *args, **kw)</span><br><span class="line">        ob.__dict__ &#x3D; cls._state</span><br><span class="line">        return ob</span><br><span class="line"></span><br><span class="line">class MyClass2(Borg):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line">    </span><br><span class="line"># æ²¡æ˜ç™½è¯¥æ–¹å¼å¦‚ä½•å®ç°å•ä¾‹</span><br></pre></td></tr></table></figure>

<h3 id="2-4-è£…é¥°å™¨æ–¹å¼"><a href="#2-4-è£…é¥°å™¨æ–¹å¼" class="headerlink" title="2.4 è£…é¥°å™¨æ–¹å¼"></a>2.4 è£…é¥°å™¨æ–¹å¼</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œè£…é¥°å™¨ï¼ˆdecoratorï¼‰å¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹ä¸€ä¸ªç±»æˆ–å‡½æ•°çš„åŠŸèƒ½ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¥è£…é¥°æŸä¸ªç±»ï¼Œä½¿å…¶åªèƒ½ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from functools import wraps</span><br><span class="line"></span><br><span class="line">def singleton(cls):</span><br><span class="line">    instances &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @wraps(cls)</span><br><span class="line">    def getinstance(*args, **kw):</span><br><span class="line">        if cls not in instances:</span><br><span class="line">            instances[cls] &#x3D; cls(*args, **kw)</span><br><span class="line">        return instances[cls]</span><br><span class="line"></span><br><span class="line">    return getinstance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@singleton</span><br><span class="line">class MyClass(object):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line"></span><br><span class="line">one &#x3D; MyClass()</span><br><span class="line">two &#x3D; MyClass()</span><br><span class="line">print(one is two)</span><br><span class="line">print(one &#x3D;&#x3D; two)</span><br><span class="line">print(id(one), id(two))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">4492352536 4492352536</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè£…é¥°å™¨singletonï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªå†…éƒ¨å‡½æ•° getinstanceï¼Œè¯¥å‡½æ•°ä¼šåˆ¤æ–­æŸä¸ªç±»æ˜¯å¦åœ¨å­—å…¸ instances ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°† cls ä½œä¸º keyï¼Œcls(*args, **kw)ä½œä¸º valueå­˜åˆ°instancesä¸­,å¦åˆ™,ç›´æ¥è¿”å› instances[cls]ã€‚</p>
<h3 id="2-5-ä½¿ç”¨metaclass"><a href="#2-5-ä½¿ç”¨metaclass" class="headerlink" title="2.5 ä½¿ç”¨metaclass"></a>2.5 ä½¿ç”¨metaclass</h3><p>å…ƒç±»ï¼ˆmetaclassï¼‰å¯ä»¥æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå®ƒä¸»è¦åšä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>æ‹¦æˆªç±»çš„åˆ›å»º</li>
<li>ä¿®æ”¹ç±»çš„å®šä¹‰</li>
<li>è¿”å›ä¿®æ”¹åçš„ç±»<br>ä½¿ç”¨å…ƒç±»å®ç°å•ä¾‹æ¨¡å¼çš„ä»£ç å¦‚ä¸‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singleton(type):</span><br><span class="line">    _instances &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def __call__(cls, *args, **kwargs):</span><br><span class="line">        if cls not in cls._instances:</span><br><span class="line">            cls._instances[cls] &#x3D; super(Singleton, cls).__call__(*args, **kwargs)</span><br><span class="line">        return cls._instances[cls]</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">class MyClass(object):</span><br><span class="line">    __metaclass__ &#x3D; Singleton</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Python3</span><br><span class="line">class MyClass(metaclass&#x3D;Singleton):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>




</li>
</ul>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>python-socketç¼–ç¨‹</title>
    <url>/2020/04/23/python-socket%E7%BC%96%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="python-socketç¼–ç¨‹"><a href="#python-socketç¼–ç¨‹" class="headerlink" title="python-socketç¼–ç¨‹"></a>python-socketç¼–ç¨‹</h2><h2 id="äº”å±‚ç½‘ç»œæ¨¡å‹"><a href="#äº”å±‚ç½‘ç»œæ¨¡å‹" class="headerlink" title="äº”å±‚ç½‘ç»œæ¨¡å‹"></a>äº”å±‚ç½‘ç»œæ¨¡å‹</h2><h3 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h3><p>åŠŸèƒ½ï¼šæ–‡ä»¶ä¼ è¾“ï¼Œç”µå­é‚®ä»¶ï¼Œæ–‡ä»¶æœåŠ¡ï¼Œæ•°æ®ä¼ è¾“<br>TCP/IPåè®®ï¼šHTTP,FTP,SMTP,DNS,TELNET,SSH</p>
<h3 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h3><p>åŠŸèƒ½ï¼šæä¾›ç«¯å£å¯¹ç«¯å£çš„æ¥å£<br>TCP/IPåè®®ï¼šTCP-UDP</p>
<h3 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h3><p>åŠŸèƒ½ï¼šä¸ºæ•°æ®åŒ…é€‰æ‹©è·¯ç”±<br>TCP/IPåè®®ï¼šIP,ICMP</p>
<h3 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h3><p>åŠŸèƒ½ï¼šä¼ è¾“æœ‰åœ°å€çš„å¸§ï¼Œé”™è¯¯æ£€æµ‹åŠŸèƒ½<br>TCP/IPåè®®ï¼šARP</p>
<h3 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h3><p>åŠŸèƒ½ï¼šç‰©ç†åª’ä½“ï¼Œå…‰çº¤<br>TCP/IPåè®®ï¼š1000BASE-SX</p>
<p>æ¯æ¬¡çš„ç½‘ç»œä¼ è¾“è¯·æ±‚éƒ½æ˜¯é€šè¿‡ åº”ç”¨å±‚â€“-&gt;ä¼ è¾“å±‚â€“-&gt;ç½‘ç»œå±‚â€“-&gt;æ•°æ®é“¾è·¯å±‚â€“-&gt;ç‰©ç†å±‚ä¼ é€’ã€‚<br>é™¤äº†åº”ç”¨å±‚ï¼Œå…¶ä»–çš„å±‚éƒ½ç”±æ“ä½œç³»ç»Ÿï¼Œç‰©ç†è®¾å¤‡å®Œæˆï¼Œæ‰€ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„æ¥å£socketç›´æ¥èµ°ä¼ è¾“å±‚(é€šè¿‡TCPé“¾æ¥ï¼Œsocketä¸å±äºç½‘ç»œåè®®ï¼Œå±äºè‡ªå·±å®šä¹‰çš„åè®®)å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†ä¸åŒåè®®çš„ç½‘ç»œè¯·æ±‚ã€‚</p>
<h3 id="c-så®ç°é€šä¿¡"><a href="#c-så®ç°é€šä¿¡" class="headerlink" title="c/så®ç°é€šä¿¡"></a>c/så®ç°é€šä¿¡</h3><p>ä½¿ç”¨socketå®ç°å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„é€šä¿¡ï¼Œå·ä¸€å¼ å›¾(socketçš„å›ºå®šç¼–ç¨‹æ¨¡å¼)<br><img src="http://www.langzi.fun/upload/TIM%E6%88%AA%E5%9B%BE20190225114621.png" alt="TIM%E6%88%AA%E5%9B%BE20190225114621.png"></p>
<h3 id="æœåŠ¡ç«¯ä»£ç ï¼š"><a href="#æœåŠ¡ç«¯ä»£ç ï¼š" class="headerlink" title="æœåŠ¡ç«¯ä»£ç ï¼š"></a>æœåŠ¡ç«¯ä»£ç ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">s &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line"># æŒ‡å®šç½‘ç»œç±»å‹ï¼ŒæŒ‡å®šç±»å‹å¯¹åº”çš„åè®®(TCPåè®®)</span><br><span class="line"># AF_INET &#x3D; 2</span><br><span class="line"># # IPV4</span><br><span class="line"># AF_INET6 &#x3D; 23</span><br><span class="line"># # IPV6</span><br><span class="line"># AF_IPX &#x3D; 6</span><br><span class="line"># # UNIXä¸‹çš„è¿›ç¨‹é—´é€šä¿¡</span><br><span class="line"></span><br><span class="line">s.bind((&#39;0.0.0.0&#39;,9999))</span><br><span class="line"># ç»‘å®šIPä¸ç«¯å£ï¼Œä¼ å…¥å…ƒç»„ç±»å‹ï¼Œ</span><br><span class="line">s.listen()</span><br><span class="line"># å¼€å§‹ç›‘å¬ç»‘å®šçš„IPä¸ç«¯å£</span><br><span class="line"></span><br><span class="line">sock,addr &#x3D; s.accept()</span><br><span class="line"># sockæ˜¯ä¼ è¾“å¯¹è±¡ï¼Œaddræ˜¯ä¼ è¾“å¯¹è±¡çš„IPåœ°å€</span><br><span class="line"></span><br><span class="line">data &#x3D; sock.recv(1024)</span><br><span class="line"># è·å–å®¢æˆ·ç«¯å‘æ¥çš„1kbå¤§å°çš„å§‹æ®</span><br><span class="line">print(data.decode(&#39;utf-8&#39;))</span><br><span class="line"># æ‰“å°å‡ºå®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ï¼Œè¿”å›çš„æ˜¯bytesç±»å‹ï¼Œéœ€è¦ç¼–ç æˆutf-8</span><br><span class="line">sock.send(&#39;æ€»éƒ¨æ”¶åˆ°æ€»éƒ¨æ”¶åˆ°&#39;.encode(&#39;utf-8&#39;))</span><br><span class="line"># ç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ•°æ®</span><br><span class="line">s.close()</span><br><span class="line">sock.close()</span><br><span class="line"># å…³é—­è¿æ¥</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">c &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">c.connect((&#39;127.0.0.1&#39;,9999))</span><br><span class="line">c.send(&#39;shukeå‘¼å«æ€»éƒ¨&#39;.encode(&#39;utf-8&#39;))</span><br><span class="line"># å› ä¸ºä¼ é€’çš„æ˜¯bytesç±»å‹çš„æ•°æ®ï¼Œéœ€è¦ç¼–ç </span><br><span class="line">data &#x3D; c.recv(1024)</span><br><span class="line"># å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯å‘æ¥çš„1kbæ•°æ®</span><br><span class="line">print(data.decode(&#39;utf-8&#39;))</span><br><span class="line"># æ‰“å°æœåŠ¡ç«¯è¿”å›çš„æ•°æ®</span><br><span class="line">c.close()</span><br></pre></td></tr></table></figure>
<p>socketçš„ç¼–ç æ¨¡å¼åŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯å›ºå®šçš„ï¼Œå¥—ç”¨ä»£ç å³å¯ã€‚<br>å…ˆè¿è¡ŒæœåŠ¡ç«¯ä»£ç ï¼Œå†è¿è¡Œå®¢æˆ·ç«¯ä»£ç ï¼š<br>å®¢æˆ·ç«¯è¿”å›ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shukeå‘¼å«æ€»éƒ¨</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯è¿”å›ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ€»éƒ¨æ”¶åˆ°æ€»éƒ¨æ”¶åˆ°</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå°±æ˜¯å›ºå®šçš„å¥—è·¯ä»£ç ï¼Œå¦‚æœæƒ³è¦è®©æœåŠ¡ç«¯ä¸€ç›´æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚çš„è¯ï¼Œåœ¨è¿™é‡Œä¿®æ”¹ä»£ç å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s.bind((&#39;0.0.0.0&#39;,9999))</span><br><span class="line"># ç»‘å®šIPä¸ç«¯å£ï¼Œä¼ å…¥å…ƒç»„ç±»å‹ï¼Œ</span><br><span class="line">s.listen()</span><br><span class="line"># å¼€å§‹ç›‘å¬ç»‘å®šçš„IPä¸ç«¯å£</span><br><span class="line">while 1:</span><br><span class="line">    sock,addr &#x3D; s.accept()</span><br><span class="line">    # sockæ˜¯ä¼ è¾“å¯¹è±¡ï¼Œaddræ˜¯ä¼ è¾“å¯¹è±¡çš„IPåœ°å€</span><br><span class="line"></span><br><span class="line">    data &#x3D; sock.recv(1024)</span><br><span class="line">    # è·å–å®¢æˆ·ç«¯å‘æ¥çš„1kbå¤§å°çš„å§‹æ®</span><br><span class="line">    print(data.decode(&#39;utf-8&#39;))</span><br><span class="line">    # æ‰“å°å‡ºå®¢æˆ·ç«¯å‘æ¥çš„æ•°æ®ï¼Œè¿”å›çš„æ˜¯bytesç±»å‹ï¼Œéœ€è¦ç¼–ç æˆutf-8</span><br><span class="line">    sock.send(&#39;æ€»éƒ¨æ”¶åˆ°æ€»éƒ¨æ”¶åˆ°&#39;.encode(&#39;utf-8&#39;))</span><br><span class="line">    # ç„¶åå‘å®¢æˆ·ç«¯å‘é€ä¸€æ¡æ•°æ®</span><br><span class="line">    sock.close()</span><br><span class="line">    # å…³é—­è¿æ¥</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„socketå‘é€çš„å†…å®¹å¿…é¡»è¦æ˜¯bytesç±»å‹çš„(python3)ï¼Œè¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯¹äºbytesç¼–ç çš„æ•°æ®æ¥è¯´</span><br><span class="line">åªæœ‰decodeæ–¹æ³•</span><br><span class="line">å°±æ˜¯æŠŠbytesç¼–ç çš„æ•°æ®è½¬æ¢æˆutf-8ç¼–ç </span><br><span class="line"></span><br><span class="line">å¯¹äºutf-8ç¼–ç çš„æ•°æ®æ¥è¯´</span><br><span class="line">åªæœ‰encodeæ–¹æ³•</span><br><span class="line">å°±æ˜¯æŠŠutf-8ç¼–ç çš„æ•°æ®è½¬æ¢æˆbytesç¼–ç ï¼Œå¦‚æœè¦è½¬æˆå…¶ä»–ç¼–ç </span><br><span class="line">.encdoe(&#39;gbk&#39;)å³å¯</span><br></pre></td></tr></table></figure>

<h3 id="C-Sç«¯ç›¸äº’å‘æ¶ˆæ¯"><a href="#C-Sç«¯ç›¸äº’å‘æ¶ˆæ¯" class="headerlink" title="C/Sç«¯ç›¸äº’å‘æ¶ˆæ¯"></a>C/Sç«¯ç›¸äº’å‘æ¶ˆæ¯</h3><ol>
<li>æœåŠ¡ç«¯å‘é€ä»£ç <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">s &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">s.bind((&#39;0.0.0.0&#39;,9999))</span><br><span class="line">s.listen()</span><br><span class="line">sock, addr &#x3D; s.accept()</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    inp &#x3D; input(&#39;è¾“å…¥æ¶ˆæ¯:&#39;)</span><br><span class="line">    sock.send(inp.encode(&#39;utf-8&#39;))</span><br><span class="line">    data &#x3D; sock.recv(1024)</span><br><span class="line">    print(&#39;æ¥æ”¶æ¶ˆæ¯:&#39;+data.decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure></li>
<li>å®¢æˆ·ç«¯å‘é€ä»£ç <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">c &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">c.connect((&#39;127.0.0.1&#39;,9999))</span><br><span class="line">while 1:</span><br><span class="line">    data &#x3D; c.recv(1024)</span><br><span class="line">    print(&#39;æ¥æ”¶æ¶ˆæ¯:&#39;+data.decode(&#39;utf-8&#39;))</span><br><span class="line">    inp &#x3D; input(&#39;è¾“å…¥æ¶ˆæ¯:&#39;)</span><br><span class="line">    c.send(inp.encode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
æœåŠ¡ç«¯è¿”å›ç»“æœï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¾“å…¥æ¶ˆæ¯:æˆ‘æ˜¯ä½ çˆ¸çˆ¸</span><br><span class="line">æ¥æ”¶æ¶ˆæ¯:æˆ‘æ˜¯ä½ çˆ·çˆ·</span><br><span class="line">è¾“å…¥æ¶ˆæ¯:</span><br></pre></td></tr></table></figure>
å®¢æˆ·ç«¯è¿”å›ç»“æœï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¥æ”¶æ¶ˆæ¯:æˆ‘æ˜¯ä½ çˆ¸çˆ¸</span><br><span class="line">è¾“å…¥æ¶ˆæ¯:æˆ‘æ˜¯ä½ çˆ·çˆ·</span><br></pre></td></tr></table></figure>
<h3 id="å¤šç”¨æˆ·è¿æ¥"><a href="#å¤šç”¨æˆ·è¿æ¥" class="headerlink" title="å¤šç”¨æˆ·è¿æ¥"></a>å¤šç”¨æˆ·è¿æ¥</h3>ä»ä¸Šé¢çš„ä»£ç ä¸­ä¸€ä¸ªsockåªèƒ½æœåŠ¡ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯åªèƒ½æœåŠ¡ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å³å¯å®Œæˆä¸€ä¸ªæœåŠ¡ç«¯æœåŠ¡å¤§é‡çš„å®¢æˆ·ç«¯ã€‚<br>æœåŠ¡ç«¯ä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">import threading</span><br><span class="line">s &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">s.bind((&#39;0.0.0.0&#39;,9999))</span><br><span class="line">s.listen()</span><br><span class="line"></span><br><span class="line">def handle_sock(sock,addr):</span><br><span class="line">    while 1:</span><br><span class="line">        inp &#x3D; input(&#39;è¾“å…¥æ¶ˆæ¯:&#39;)</span><br><span class="line">        sock.send(inp.encode(&#39;utf-8&#39;))</span><br><span class="line">        data &#x3D; sock.recv(1024)</span><br><span class="line">        print(&#39;æ¥æ”¶æ¶ˆæ¯:&#39; + data.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    sock, addr &#x3D; s.accept()</span><br><span class="line">    clinent_thread &#x3D; threading.Thread(target&#x3D;handle_sock,args&#x3D;(sock,addr))</span><br><span class="line">    clinent_thread.start()</span><br></pre></td></tr></table></figure>
å®¢æˆ·ç«¯ä»£ç ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">c &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">c.connect((&#39;127.0.0.1&#39;,9999))</span><br><span class="line">while 1:</span><br><span class="line">    data &#x3D; c.recv(1024)</span><br><span class="line">    print(&#39;æ¥æ”¶æ¶ˆæ¯:&#39;+data.decode(&#39;utf-8&#39;))</span><br><span class="line">    inp &#x3D; input(&#39;è¾“å…¥æ¶ˆæ¯:&#39;)</span><br><span class="line">    c.send(inp.encode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>
è¿™ä¸ªæ—¶å€™è¿è¡Œä¸¤ä¸ªå®¢æˆ·ç«¯å‘é€è¯·æ±‚ä¸€æ ·å¯ä»¥è¢«æœåŠ¡ç«¯è·å–åˆ°ã€‚</li>
</ol>
<h3 id="æ¨¡æ‹ŸHTTPè¯·æ±‚"><a href="#æ¨¡æ‹ŸHTTPè¯·æ±‚" class="headerlink" title="æ¨¡æ‹ŸHTTPè¯·æ±‚"></a>æ¨¡æ‹ŸHTTPè¯·æ±‚</h3><blockquote>
<p>requestsæœ¬è´¨ä¸Šè°ƒç”¨urllibå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œurllibé€šè¿‡è°ƒç”¨socketå‘èµ·ç½‘ç»œè¯·æ±‚ã€‚æ¨¡æ‹Ÿsocketå¯¹HTTPè¯·æ±‚å°±æ˜¯å¯¹æœ¬è´¨ä¸Šè¿›è¡Œé‡å†™ç¼–ç¨‹ã€‚<br>å…·ä½“å®ç°çœ‹ä»£ç ï¼Œå…¶å®å¾ˆç®€å•çš„ï¼Œä¸å¤šæè¿°</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">from urllib.parse import  urlparse</span><br><span class="line"># å¯¹urlåšè§£æ</span><br><span class="line"></span><br><span class="line">def get_url(url):</span><br><span class="line">    url &#x3D; urlparse(url)</span><br><span class="line">    # å¯¹ä¼ å…¥çš„ç½‘å€è¿›è¡Œè§£æï¼Œæ¯”å¦‚ä¼ å…¥http:&#x2F;&#x2F;www.langzi.fun&#x2F;admin.php</span><br><span class="line">    host,path &#x3D; url.netloc,url.path</span><br><span class="line">    # è·å–ä¼ å…¥ç½‘å€çš„ä¸»åŸŸåå’Œåé¢çš„urlè·¯å¾„</span><br><span class="line">    if path &#x3D;&#x3D; &#39;&#39;:</span><br><span class="line">        path &#x3D; &#39;&#x2F;&#39;</span><br><span class="line">    c &#x3D; socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">    c.connect((host,80))</span><br><span class="line">    headers &#x3D; &#39;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;71.0.3578.98 Safari&#x2F;537.36&#39;</span><br><span class="line">    # ç»‘å®šipä¸ç«¯å£</span><br><span class="line">    c.send(&#39;GET &#123;&#125;\r\nHost:&#123;&#125;\r\nUser-Agent:&#123;&#125;\r\n&#39;.format(path,host,headers).encode(&#39;utf-8&#39;))</span><br><span class="line">    # å‘é€è¯·æ±‚ï¼Œè¯·æ±‚æ–¹å¼ä¸ºGET å†…å®¹æ˜¯urlçš„è·¯å¾„ï¼Œç„¶ååˆ†éš”æ¢è¡Œ</span><br><span class="line">    # å‘é€è¯·æ±‚ï¼Œè¯·æ±‚çš„HOSTä¸»æœºå°±æ˜¯ä¸»åŸŸå</span><br><span class="line">    # åœ¨è¿™é‡Œå¯ä»¥æŠŠè¯·æ±‚å¤´ï¼ŒcookieåŠ è¿›æ¥</span><br><span class="line"></span><br><span class="line">    data &#x3D; b&#39;&#39;</span><br><span class="line">    # è·å–æ•°æ®</span><br><span class="line">    while 1:</span><br><span class="line">        d &#x3D; c.recv(1024)</span><br><span class="line">        if d:</span><br><span class="line">            data +&#x3D;d</span><br><span class="line">        else:</span><br><span class="line">            break</span><br><span class="line">    print(data.decode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line">get_url(&#39;http:&#x2F;&#x2F;www.lancygroup.com&#x2F;&#39;)</span><br></pre></td></tr></table></figure>

<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://www.langzi.fun/socket%E7%BC%96%E7%A8%8B.html" target="_blank" rel="noopener">åŸæ–‡-socketç¼–ç¨‹</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>python-thriftä½¿ç”¨å®ä¾‹</title>
    <url>/2020/04/23/python-thrift%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="python-thriftä½¿ç”¨å®ä¾‹"><a href="#python-thriftä½¿ç”¨å®ä¾‹" class="headerlink" title="python-thriftä½¿ç”¨å®ä¾‹"></a>python-thriftä½¿ç”¨å®ä¾‹</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>Apache Thrift æ˜¯ Facebook å®ç°çš„ä¸€ç§é«˜æ•ˆçš„ã€æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€çš„è¿œç¨‹æœåŠ¡è°ƒç”¨çš„æ¡†æ¶ã€‚æœ¬æ–‡å°†ä» Pythonå¼€å‘äººå‘˜è§’åº¦ç®€å•ä»‹ç» Apache Thrift çš„æ¶æ„ã€å¼€å‘å’Œä½¿ç”¨ã€‚</p>
</blockquote>
<hr>
<h3 id="Thriftç®€ä»‹"><a href="#Thriftç®€ä»‹" class="headerlink" title="Thriftç®€ä»‹"></a>Thriftç®€ä»‹</h3><h4 id="Transport"><a href="#Transport" class="headerlink" title="Transport"></a>Transport</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Transportç½‘ç»œè¯»å†™ï¼ˆsocketï¼Œhttpç­‰ï¼‰æŠ½è±¡ï¼Œç”¨äºå’Œå…¶ä»–thriftç»„ä»¶è§£è€¦ã€‚</span><br><span class="line">Transportçš„æ¥å£åŒ…æ‹¬ï¼šopen, close, read, write, flush, isOpen, readAllã€‚</span><br><span class="line">Serverç«¯éœ€è¦ServerTransportï¼ˆå¯¹ç›‘å¬socketçš„ä¸€ç§æŠ½è±¡ï¼‰ï¼Œç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥å£åŒ…æ‹¬ï¼šlisten, accept, closeã€‚</span><br><span class="line">pythonä¸­Transportçš„å®ç°åŒ…æ‹¬ï¼šTSocket, THttpServer, TSSLSocket, TTwisted, TZlibTransportï¼Œéƒ½æ˜¯å¯¹æŸç§åè®®æˆ–æ¡†æ¶çš„å®ç°ã€‚è¿˜æœ‰ä¸¤ä¸ªè£…é¥°å™¨ï¼Œç”¨äºä¸ºå·²æœ‰çš„Transportæ·»åŠ åŠŸèƒ½ï¼ŒTBufferedTransportï¼ˆå¢åŠ ç¼“å†²ï¼‰å’ŒTFramedTransportï¼ˆæ·»åŠ å¸§ï¼‰ã€‚</span><br><span class="line">åœ¨åˆ›å»ºserveræ—¶ï¼Œä¼ å…¥çš„æ—¶Tranportçš„å·¥å‚ï¼Œè¿™äº›FactoryåŒ…æ‹¬ï¼šTTransportFactoryBaseï¼ˆæ²¡æœ‰ä»»ä½•ä¿®é¥°ï¼Œç›´æ¥è¿”å›ï¼‰ï¼ŒTBufferedTransportFactoryï¼ˆè¿”å›å¸¦ç¼“å†²çš„Transportï¼‰å’ŒTFramedTransportFactoryï¼ˆè¿”å›å¸§å®šä½çš„Transportï¼‰ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Protocolç”¨äºå¯¹æ•°æ®æ ¼å¼æŠ½è±¡ï¼Œåœ¨rpcè°ƒç”¨æ—¶åºåˆ—åŒ–è¯·æ±‚å’Œå“åº”ã€‚</span><br><span class="line">TProtocolçš„å®ç°åŒ…æ‹¬ï¼šTJSONProtocolï¼ŒTSimpleJSONProtocolï¼ŒTBinaryProtocolï¼ŒTBinaryPotocolAcceleratedï¼ŒTCompactProtocolã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Processor"><a href="#Processor" class="headerlink" title="Processor"></a>Processor</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Processorå¯¹streamè¯»å†™æŠ½è±¡ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ç”¨æˆ·ç¼–å†™çš„handlerå·²å“åº”å¯¹åº”çš„serviceã€‚å…·ä½“çš„Processoræœ‰compilerç”Ÿæˆï¼Œç”¨æˆ·éœ€è¦å®ç°serviceçš„å®ç°ç±»ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Serveråˆ›å»ºTransportï¼Œè¾“å…¥ã€è¾“å‡ºçš„Protocolï¼Œä»¥åŠå“åº”serviceçš„handlerï¼Œç›‘å¬åˆ°clientçš„è¯·æ±‚ç„¶åå§”æ‰˜ç»™processorå¤„ç†ã€‚</span><br><span class="line">TServeræ˜¯åŸºç±»ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°åŒ…æ‹¬ï¼š</span><br><span class="line">1) processor, serverTransport</span><br><span class="line">2) processor, serverTransport, transportFactory, protocolFactory</span><br><span class="line">3) processor, serverTransport, inputTransportFactory, outputTransportFactory, inputProtocolFactory, outputProtocolFactory </span><br><span class="line">TServerå†…éƒ¨å®é™…ä¸Šéœ€è¦3ï¼‰æ‰€åˆ—çš„å‚æ•°ï¼Œ1ï¼‰å’Œ2ï¼‰ä¼šå¯¼è‡´å¯¹åº”çš„å‚æ•°ä½¿ç”¨é»˜è®¤å€¼ã€‚</span><br><span class="line">TServerçš„å­ç±»åŒ…æ‹¬ï¼šTSimpleServer, TThreadedServer, TThreadPoolServer, TForkingServer, THttpServer, TNonblockingServer, TProcessPoolServer</span><br><span class="line">TServerçš„serveæ–¹æ³•ç”¨äºå¼€å§‹æœåŠ¡ï¼Œæ¥æ”¶clientçš„è¯·æ±‚ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="Code-generated"><a href="#Code-generated" class="headerlink" title="Code generated"></a>Code generated</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">constants.py: åŒ…å«å£°æ˜çš„æ‰€æœ‰å¸¸é‡</span><br><span class="line">ttypes.py: å£°æ˜çš„structï¼Œå®ç°äº†å…·ä½“çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</span><br><span class="line">SERVICE_NAME.py: å¯¹åº”serviceçš„æè¿°æ–‡ä»¶ï¼ŒåŒ…å«äº†ï¼š</span><br><span class="line">Iface: serviceæ¥å£å®šä¹‰</span><br><span class="line">Client: clientçš„rpcè°ƒç”¨æ¡©</span><br></pre></td></tr></table></figure>
<h5 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h5><p>Thriftçš„ç”¨æ³•å®é™…ä¸Šå¾ˆç®€å•ï¼Œå®šä¹‰å¥½IDLï¼Œç„¶åå®ç°serviceå¯¹åº”çš„handlerï¼ˆæ–¹æ³•åã€å‚æ•°åˆ—è¡¨ä¸æ¥å£å®šä¹‰ä¸€è‡´æ¥å£ï¼‰ï¼Œæœ€åå°±æ˜¯é€‰æ‹©å„ä¸ªç»„ä»¶ã€‚<br>éœ€è¦é€‰æ‹©çš„åŒ…æ‹¬ï¼šTransportï¼ˆä¸€èˆ¬éƒ½æ˜¯socketï¼Œåªæ˜¯ååˆ†éœ€è¦é€‰æ‹©buffedå’Œframedè£…é¥°å™¨factoryï¼‰ï¼ŒProtocolï¼ŒServerã€‚</p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ç®€å•è®°å½•ä¸‹åœ¨macä¸‹ä½¿ç”¨python thriftçš„è¿‡ç¨‹</p>
<ol>
<li><p>å®‰è£… Thrift çš„ python åº“æœ‰ä¸¤ç§æ–¹æ¡ˆ(1. pipå®‰è£… 2. æºç å®‰è£…)å…·ä½“å‚è§æ–‡æœ«é“¾æ¥<br> 1ï¼‰pipå®‰è£…ï¼š pip install thrift(æœ€å¥½åœ¨venvä¸­ä½¿ç”¨)</p>
</li>
<li><p>å®‰è£… Thrift çš„ IDL ç¼–è¯‘å·¥å…·ï¼ˆwindows/linuxå®‰è£…è§æ–‡æœ«é“¾æ¥ï¼‰<br> 1ï¼‰macä¸‹å®‰è£…ï¼š brew install thrift<br> $ thrift -versionï¼Œå¦‚æœæ‰“å°å‡ºæ¥ï¼šThrift version x.x.x è¡¨æ˜ complier å®‰è£…æˆåŠŸ</p>
</li>
<li><p>å»ºç«‹é¡¹ç›®ç›®å½•(thrift_demo)å¹¶å¼€å§‹ç¼–ç <br> 1ï¼‰ç›®å½•ç»“æ„(exampleç›®å½•åŠå…¶ä¸‹çš„æ–‡ä»¶ä¸ç”¨æ‰‹åŠ¨åˆ›å»ºï¼Œæ˜¯é€šè¿‡å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå…·ä½“ç»†èŠ‚è¯·å¾€ä¸‹çœ‹)<br> <img src="/2020/04/23/python-thrift%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B/74bca25d-d3d4-4d76-b0e1-b1101520d45b/380b63e5.png" alt="dir.png"><br> &lt;1&gt; clientç›®å½•ä¸‹çš„ client.py å®ç°äº†å®¢æˆ·ç«¯ç”¨äºå‘é€æ•°æ®å¹¶æ‰“å°æ¥æ”¶åˆ° server ç«¯å¤„ç†åçš„æ•°æ®<br> &lt;2&gt; server ç›®å½•ä¸‹çš„ server.py å®ç°äº†æœåŠ¡ç«¯ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œå¤§å†™å¤„ç†åè¿”å›ç»™å®¢æˆ·ç«¯<br> &lt;3&gt; thrift_file ç”¨äºå­˜æ”¾ thrift çš„ IDL æ–‡ä»¶ï¼š *.thrift<br> 2) å®šä¹‰ Thrift RPC æ¥å£IDLæ–‡ä»¶ example.thrift:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">namespace py example</span><br><span class="line"></span><br><span class="line">struct Data &#123;</span><br><span class="line">1: string name</span><br><span class="line">2: i32 age</span><br><span class="line">3: string addr</span><br><span class="line">4: i32 code &#x3D; 20</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service format_data &#123;</span><br><span class="line">Data do_format(1:Data data),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ thrift_file ç›®å½•æ‰§è¡Œï¼š$ thrift -out .. â€“gen py example.thriftï¼Œå°±ä¼šåœ¨ thrift_file çš„åŒçº§ç›®å½•ä¸‹ç”Ÿæˆ python çš„åŒ…ï¼šexample<br>3) å®ç° server ç«¯server.py:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">sys.path.append(os.path.abspath(os.path.join(os.path.dirname(&#39;__file__&#39;), os.path.pardir)))</span><br><span class="line"></span><br><span class="line">from thrift.transport import TSocket</span><br><span class="line">from thrift.transport import TTransport</span><br><span class="line">from thrift.protocol import TBinaryProtocol</span><br><span class="line">from example.format_data import Client</span><br><span class="line">from example.format_data import Data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__HOST &#x3D; &#39;localhost&#39;</span><br><span class="line">__PORT &#x3D; 9000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    tsocket &#x3D; TSocket.TSocket(__HOST, __PORT)</span><br><span class="line">    transport &#x3D; TTransport.TBufferedTransport(tsocket)</span><br><span class="line">    protocol &#x3D; TBinaryProtocol.TBinaryProtocol(transport)</span><br><span class="line">    client &#x3D; Client(protocol)</span><br><span class="line"></span><br><span class="line">    data &#x3D; Data(&#39;hello,world!&#39;, 123)</span><br><span class="line">    transport.open()</span><br><span class="line">    print(&#39;client-requets&#39;)</span><br><span class="line">    res &#x3D; client.do_format(data)</span><br><span class="line">    # print(client.do_format(data).text)</span><br><span class="line">    print(&#39;server-answer&#39;, res)</span><br><span class="line"></span><br><span class="line">    transport.close()</span><br><span class="line">except Thrift.TException as ex:</span><br><span class="line">    print(ex.message)</span><br></pre></td></tr></table></figure>
<p>4) å®ç° client ç«¯client.py:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: client.py </span><br><span class="line">@time: 2019&#x2F;04&#x2F;03 19:01</span><br><span class="line">@contact: zhaofengfeng@wecash.net</span><br><span class="line">@software:  learn</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># ! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">sys.path.append(os.path.abspath(os.path.join(os.path.dirname(&#39;__file__&#39;), os.path.pardir)))</span><br><span class="line"></span><br><span class="line">from thrift import Thrift</span><br><span class="line">from thrift.transport import TSocket</span><br><span class="line">from thrift.transport import TTransport</span><br><span class="line">from thrift.protocol import TBinaryProtocol</span><br><span class="line">from example.format_data import Client</span><br><span class="line">from example.format_data import Data</span><br><span class="line"></span><br><span class="line">__HOST &#x3D; &#39;localhost&#39;</span><br><span class="line">__PORT &#x3D; 9000</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    tsocket &#x3D; TSocket.TSocket(__HOST, __PORT)</span><br><span class="line">    transport &#x3D; TTransport.TBufferedTransport(tsocket)</span><br><span class="line">    protocol &#x3D; TBinaryProtocol.TBinaryProtocol(transport)</span><br><span class="line">    client &#x3D; Client(protocol)</span><br><span class="line"></span><br><span class="line">    data &#x3D; Data(&#39;shuke&#39;, 18, &quot;BeiJing&quot;, code&#x3D;200)</span><br><span class="line">    transport.open()</span><br><span class="line">    print(&#39;client-requets&#39;)</span><br><span class="line">    res &#x3D; client.do_format(data)</span><br><span class="line">    # print(client.do_format(data).text)</span><br><span class="line">    print(&#39;server-answer&#39;, res, &quot;\n&quot;, res.__dict__)</span><br><span class="line">    transport.close()</span><br><span class="line">except Thrift.TException as ex:</span><br><span class="line">    print(ex.message)</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰§è¡ŒéªŒè¯ç»“æœ<br>1) å…ˆå¯åŠ¨ server(è¿›å…¥serverç›®å½•ï¼Œæ‰§è¡Œpython server.py)ï¼Œä¹‹åå†å¦ä¸€ä¸ªçª—å£æ‰§è¡Œ clientï¼ˆè¿›å…¥clientç›®å‰ï¼Œæ‰§è¡Œpython client.pyï¼‰:client ä¾§æ§åˆ¶å°æ‰“å°çš„ç»“æœä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> $ python client.py</span><br><span class="line">client-requets</span><br><span class="line">server-answer Data(name&#x3D;&#39;SHUKE_Thrift&#39;, age&#x3D;18, addr&#x3D;&#39;BeiJing&#39;, code&#x3D;200)</span><br><span class="line"> &#123;&#39;name&#39;: &#39;SHUKE_Thrift&#39;, &#39;age&#39;: 18, &#39;addr&#39;: &#39;BeiJing&#39;, &#39;code&#39;: 200&#125;</span><br></pre></td></tr></table></figure>
<p>serverä¾§æ§åˆ¶å°æ‰“å°çš„ç»“æœä¸º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> $ python server.py</span><br><span class="line">Starting the rpc server at localhost : 9000</span><br><span class="line">shuke 18 BeiJing 200</span><br></pre></td></tr></table></figure>
<p>è¯æ˜ Thrift çš„ RPC æ¥å£å®šä¹‰æˆåŠŸ.</p>
<h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><h4 id="ä¼ è¾“åè®®"><a href="#ä¼ è¾“åè®®" class="headerlink" title="ä¼ è¾“åè®®"></a>ä¼ è¾“åè®®</h4><p>åœ¨ä¼ è¾“åè®®ä¸Šæ€»ä½“åˆ’åˆ†ä¸ºæ–‡æœ¬å’ŒäºŒè¿›åˆ¶ ,ä¸ºèŠ‚çº¦å¸¦å®½ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨äºŒè¿›åˆ¶ç±»å‹çš„ä¼ è¾“åè®®ä¸ºå¤šæ•°.<br>TBinaryProtocol â€” äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“<br>TCompactProtocol â€” é«˜æ•ˆç‡çš„ã€å¯†é›†çš„äºŒè¿›åˆ¶ç¼–ç æ ¼å¼è¿›è¡Œæ•°æ®ä¼ è¾“<br>TJSONProtocol â€” ä½¿ç”¨ JSON çš„æ•°æ®ç¼–ç åè®®è¿›è¡Œæ•°æ®ä¼ è¾“<br>TSimpleJSONProtocol â€” åªæä¾› JSON åªå†™çš„åè®®ï¼Œé€‚ç”¨äºé€šè¿‡è„šæœ¬è¯­è¨€è§£æ<br>TDebugProtocol â€“ ä½¿ç”¨æ˜“æ‡‚çš„å¯è¯»çš„æ–‡æœ¬æ ¼å¼ï¼Œä»¥ä¾¿äº debug</p>
<h4 id="æ•°æ®ä¼ è¾“"><a href="#æ•°æ®ä¼ è¾“" class="headerlink" title="æ•°æ®ä¼ è¾“"></a>æ•°æ®ä¼ è¾“</h4><p>TSocket â€” ä½¿ç”¨é˜»å¡å¼ I/O è¿›è¡Œä¼ è¾“ï¼Œæ˜¯æœ€å¸¸è§çš„æ¨¡å¼<br>TFramedTransport â€” ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼ŒæŒ‰å—çš„å¤§å°è¿›è¡Œä¼ è¾“<br>TNonblockingTransport â€” ä½¿ç”¨éé˜»å¡æ–¹å¼ï¼Œç”¨äºæ„å»ºå¼‚æ­¥å®¢æˆ·ç«¯<br>TMemoryTransport â€“ å°†å†…å­˜ç”¨äº I/O<br>TZlibTransport â€“ ä½¿ç”¨ zlib è¿›è¡Œå‹ç¼©ï¼Œ ä¸å…¶ä»–ä¼ è¾“æ–¹å¼è”åˆä½¿ç”¨<br>TFileTransport â€“ ä»¥æ–‡ä»¶å½¢å¼è¿›è¡Œä¼ è¾“</p>
<h4 id="æœåŠ¡ç«¯ç±»å‹"><a href="#æœåŠ¡ç«¯ç±»å‹" class="headerlink" title="æœåŠ¡ç«¯ç±»å‹"></a>æœåŠ¡ç«¯ç±»å‹</h4><p>TSimpleServer â€” å•çº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I/O<br>TThreadPoolServer â€”â€” å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨æ ‡å‡†çš„é˜»å¡å¼ I/O<br>TNonblockingServer â€”â€” å¤šçº¿ç¨‹æœåŠ¡å™¨ç«¯ä½¿ç”¨éé˜»å¡å¼ I/O</p>
<h4 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h4><p>Thrift è„šæœ¬å¯å®šä¹‰çš„æ•°æ®ç±»å‹åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>
</li>
</ol>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼š<ul>
<li>boolï¼šå¸ƒå°”å€¼ï¼Œtrue æˆ– false</li>
<li>byteï¼š8 ä½æœ‰ç¬¦å·æ•´æ•°</li>
<li>i16ï¼š16 ä½æœ‰ç¬¦å·æ•´æ•°</li>
<li>i32ï¼š32 ä½æœ‰ç¬¦å·æ•´æ•°</li>
<li>i64ï¼š64 ä½æœ‰ç¬¦å·æ•´æ•°</li>
<li>doubleï¼š64 ä½æµ®ç‚¹æ•°</li>
<li>stringï¼šæœªçŸ¥ç¼–ç æ–‡æœ¬æˆ–äºŒè¿›åˆ¶å­—ç¬¦ä¸²</li>
</ul>
</li>
<li>ç»“æ„ä½“ç±»å‹ï¼š<ul>
<li>structï¼šå®šä¹‰å…¬å…±çš„å¯¹è±¡ï¼Œç±»ä¼¼äº C è¯­è¨€ä¸­çš„ç»“æ„ä½“å®šä¹‰</li>
</ul>
</li>
<li>å®¹å™¨ç±»å‹ï¼š<ul>
<li>listï¼šä¸€ç³»åˆ— t1 ç±»å‹çš„å…ƒç´ ç»„æˆçš„æœ‰åºè¡¨ï¼Œå…ƒç´ å¯ä»¥é‡å¤</li>
<li>setï¼šä¸€ç³»åˆ— t1 ç±»å‹çš„å…ƒç´ ç»„æˆçš„æ— åºè¡¨ï¼Œå…ƒç´ å”¯ä¸€</li>
<li>map&lt;t1,t2&gt;ï¼škey/value å¯¹ï¼ˆkey çš„ç±»å‹æ˜¯ t1 ä¸” key å”¯ä¸€ï¼Œvalue ç±»å‹æ˜¯ t2ï¼‰</li>
</ul>
</li>
<li>å¼‚å¸¸ç±»å‹ï¼š<ul>
<li>exception å¼‚å¸¸åœ¨è¯­æ³•å’ŒåŠŸèƒ½ä¸Šç±»ä¼¼äºç»“æ„ä½“ï¼Œå®ƒåœ¨è¯­ä¹‰ä¸Šä¸åŒäºç»“æ„ä½“â€”å½“å®šä¹‰ä¸€ä¸ª RPC æœåŠ¡æ—¶ï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦å£°æ˜ä¸€ä¸ªè¿œç¨‹æ–¹æ³•æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</li>
</ul>
</li>
<li>æœåŠ¡ç±»å‹ï¼š<ul>
<li>serviceï¼šå¯¹åº”æœåŠ¡çš„ç±»</li>
</ul>
</li>
</ul>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://www.cnblogs.com/276815076/p/10078645.html" target="_blank" rel="noopener">python thriftä½¿ç”¨å®ä¾‹-åšå®¢å›­</a><br><a href="https://thief.one/2018/10/22/1/" target="_blank" rel="noopener">åŸºäºrpcé€šä¿¡çš„åŸç†åŠpythonä¸­çš„rpcæ¡†æ¶ | nMaskâ€™s Blog</a><br><a href="https://pypi.org/project/json-rpc/" target="_blank" rel="noopener">json-rpc Â· PyPI</a><br><a href="https://www.zerorpc.io/" target="_blank" rel="noopener">zerorpc</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—</title>
    <url>/2020/04/23/%E5%90%8C%E6%97%B6%E8%BF%AD%E4%BB%A3%E5%A4%9A%E4%B8%AA%E5%BA%8F%E5%88%97/</url>
    <content><![CDATA[<h2 id="åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—"><a href="#åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—" class="headerlink" title="åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—"></a>åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—</h2><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>ä½ æƒ³åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—ï¼Œæ¯æ¬¡åˆ†åˆ«ä»ä¸€ä¸ªåºåˆ—ä¸­å–ä¸€ä¸ªå…ƒç´ ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ä¸ºäº†åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ—ï¼Œä½¿ç”¨ zip() å‡½æ•°ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; xpts &#x3D; [1, 5, 4, 2, 10, 7]</span><br><span class="line">&gt;&gt;&gt; ypts &#x3D; [101, 78, 37, 15, 62, 99]</span><br><span class="line">&gt;&gt;&gt; for x, y in zip(xpts, ypts):</span><br><span class="line">...     print(x,y)</span><br><span class="line">...</span><br><span class="line">1 101</span><br><span class="line">5 78</span><br><span class="line">4 37</span><br><span class="line">2 15</span><br><span class="line">10 62</span><br><span class="line">7 99</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p><code>zip(a, b)</code>ä¼šç”Ÿæˆä¸€ä¸ªå¯è¿”å›å…ƒç»„ <code>(x, y)</code> çš„è¿­ä»£å™¨ï¼Œå…¶ä¸­xæ¥è‡ªaï¼Œyæ¥è‡ªbã€‚ ä¸€æ—¦å…¶ä¸­æŸä¸ªåºåˆ—åˆ°åº•ç»“å°¾ï¼Œè¿­ä»£å®£å‘Šç»“æŸã€‚ å› æ­¤è¿­ä»£é•¿åº¦è·Ÿå‚æ•°ä¸­æœ€çŸ­åºåˆ—é•¿åº¦ä¸€è‡´ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; b &#x3D; [&#39;w&#39;, &#39;x&#39;, &#39;y&#39;, &#39;z&#39;]</span><br><span class="line">&gt;&gt;&gt; for i in zip(a,b):</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">(1, &#39;w&#39;)</span><br><span class="line">(2, &#39;x&#39;)</span><br><span class="line">(3, &#39;y&#39;)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªä¸æ˜¯ä½ æƒ³è¦çš„æ•ˆæœï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨<code>itertools.zip_longest()</code> å‡½æ•°æ¥ä»£æ›¿ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; from itertools import zip_longest</span><br><span class="line">&gt;&gt;&gt; for i in zip_longest(a,b):</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">(1, &#39;w&#39;)</span><br><span class="line">(2, &#39;x&#39;)</span><br><span class="line">(3, &#39;y&#39;)</span><br><span class="line">(None, &#39;z&#39;)</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; for i in zip_longest(a, b, fillvalue&#x3D;0):</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">(1, &#39;w&#39;)</span><br><span class="line">(2, &#39;x&#39;)</span><br><span class="line">(3, &#39;y&#39;)</span><br><span class="line">(0, &#39;z&#39;)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="è®¨è®º"><a href="#è®¨è®º" class="headerlink" title="è®¨è®º"></a>è®¨è®º</h3><p>å½“ä½ æƒ³æˆå¯¹å¤„ç†æ•°æ®çš„æ—¶å€™ zip() å‡½æ•°æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ æ¯”å¦‚ï¼Œå‡è®¾ä½ å¤´åˆ—è¡¨å’Œä¸€ä¸ªå€¼åˆ—è¡¨ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">headers &#x3D; [&#39;name&#39;, &#39;shares&#39;, &#39;price&#39;]</span><br><span class="line">values &#x3D; [&#39;ACME&#39;, 100, 490.1]</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨zip()å¯ä»¥è®©ä½ å°†å®ƒä»¬æ‰“åŒ…å¹¶ç”Ÿæˆä¸€ä¸ªå­—å…¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">s &#x3D; dict(zip(headers,values))</span><br><span class="line">&gt;&gt;&gt; print(s)</span><br><span class="line">&#123;&#39;name&#39;: &#39;ACME&#39;, &#39;shares&#39;: 100, &#39;price&#39;: 490.1&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½ ä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·äº§ç”Ÿè¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for name, val in zip(headers, values):</span><br><span class="line">    print(name, &#39;&#x3D;&#39;, val)</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ä¸å¸¸è§ï¼Œä½†æ˜¯ <code>zip()</code> å¯ä»¥æ¥å—å¤šäºä¸¤ä¸ªçš„åºåˆ—çš„å‚æ•°ã€‚ è¿™æ—¶å€™æ‰€ç”Ÿæˆçš„ç»“æœå…ƒç»„ä¸­å…ƒç´ ä¸ªæ•°è·Ÿè¾“å…¥åºåˆ—ä¸ªæ•°ä¸€æ ·ã€‚æ¯”å¦‚;</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3]</span><br><span class="line">&gt;&gt;&gt; b &#x3D; [10, 11, 12]</span><br><span class="line">&gt;&gt;&gt; c &#x3D; [&#39;x&#39;,&#39;y&#39;,&#39;z&#39;]</span><br><span class="line">&gt;&gt;&gt; for i in zip(a, b, c):</span><br><span class="line">...     print(i)</span><br><span class="line">...</span><br><span class="line">(1, 10, &#39;x&#39;)</span><br><span class="line">(2, 11, &#39;y&#39;)</span><br><span class="line">(3, 12, &#39;z&#39;)</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>æœ€åå¼ºè°ƒä¸€ç‚¹å°±æ˜¯ï¼Œ <code>zip()</code> ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨æ¥ä½œä¸ºç»“æœè¿”å›ã€‚ å¦‚æœä½ éœ€è¦å°†ç»“å¯¹çš„å€¼å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ï¼Œè¦ä½¿ç”¨ <code>list()</code> å‡½æ•°ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; zip(a, b)</span><br><span class="line">&lt;zip object at 0x1007001b8&gt;</span><br><span class="line">&gt;&gt;&gt; list(zip(a, b))</span><br><span class="line">[(1, 10), (2, 11), (3, 12)]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="åŸæ–‡åœ°å€"><a href="#åŸæ–‡åœ°å€" class="headerlink" title="åŸæ–‡åœ°å€"></a>åŸæ–‡åœ°å€</h3><p><a href="https://python3-cookbook.readthedocs.io/zh_CN/latest/c04/p11_iterate_over_multiple_sequences_simultaneously.html" target="_blank" rel="noopener">åŒæ—¶è¿­ä»£å¤šä¸ªåºåˆ— â€” python3-cookbook 3.0.0 æ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²</title>
    <url>/2020/04/23/mongodb%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/</url>
    <content><![CDATA[<h2 id="mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²"><a href="#mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²" class="headerlink" title="mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²"></a>mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²</h2><blockquote>
<p>mongodbæ˜¯æœ€å¸¸ç”¨çš„nosqlæ•°æ®åº“ï¼Œåœ¨æ•°æ®åº“æ’åä¸­å·²ç»ä¸Šå‡åˆ°äº†å‰å…­ã€‚è¿™ç¯‡æ–‡ç« ä»‹ç»å¦‚ä½•æ­å»ºé«˜å¯ç”¨çš„mongodbï¼ˆåˆ†ç‰‡+å‰¯æœ¬ï¼‰é›†ç¾¤ã€‚</p>
</blockquote>
<p>åœ¨æ­å»ºé›†ç¾¤ä¹‹å‰ï¼Œéœ€è¦é¦–å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µï¼šè·¯ç”±ï¼Œåˆ†ç‰‡ã€å‰¯æœ¬é›†ã€é…ç½®æœåŠ¡å™¨ç­‰ã€‚</p>
<h3 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h3><hr>
<p><img src="http://www.itmind.net/assets/images/2017/bigdata/sharded-cluster-production-architecture.bakedsvg.svg" alt="sharded-cluster"><br>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªç»„ä»¶ï¼šmongosã€config serverã€shardã€replica setã€‚</p>
<ol>
<li><p>mongosï¼Œæ•°æ®åº“é›†ç¾¤è¯·æ±‚çš„å…¥å£ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½é€šè¿‡mongosè¿›è¡Œåè°ƒï¼Œä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªè·¯ç”±é€‰æ‹©å™¨ï¼Œmongosè‡ªå·±å°±æ˜¯ä¸€ä¸ªè¯·æ±‚åˆ†å‘ä¸­å¿ƒï¼Œå®ƒè´Ÿè´£æŠŠå¯¹åº”çš„æ•°æ®è¯·æ±‚è¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„shardæœåŠ¡å™¨ä¸Šã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé€šå¸¸æœ‰å¤šmongosä½œä¸ºè¯·æ±‚çš„å…¥å£ï¼Œé˜²æ­¢å…¶ä¸­ä¸€ä¸ªæŒ‚æ‰æ‰€æœ‰çš„mongodbè¯·æ±‚éƒ½æ²¡æœ‰åŠæ³•æ“ä½œã€‚</p>
</li>
<li><p>config serverï¼Œé¡¾åæ€ä¹‰ä¸ºé…ç½®æœåŠ¡å™¨ï¼Œå­˜å‚¨æ‰€æœ‰æ•°æ®åº“å…ƒä¿¡æ¯ï¼ˆè·¯ç”±ã€åˆ†ç‰‡ï¼‰çš„é…ç½®ã€‚mongosæœ¬èº«æ²¡æœ‰ç‰©ç†å­˜å‚¨åˆ†ç‰‡æœåŠ¡å™¨å’Œæ•°æ®è·¯ç”±ä¿¡æ¯ï¼Œåªæ˜¯ç¼“å­˜åœ¨å†…å­˜é‡Œï¼Œé…ç½®æœåŠ¡å™¨åˆ™å®é™…å­˜å‚¨è¿™äº›æ•°æ®ã€‚mongosç¬¬ä¸€æ¬¡å¯åŠ¨æˆ–è€…å…³æ‰é‡å¯å°±ä¼šä» config server åŠ è½½é…ç½®ä¿¡æ¯ï¼Œä»¥åå¦‚æœé…ç½®æœåŠ¡å™¨ä¿¡æ¯å˜åŒ–ä¼šé€šçŸ¥åˆ°æ‰€æœ‰çš„ mongos æ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼Œè¿™æ · mongos å°±èƒ½ç»§ç»­å‡†ç¡®è·¯ç”±ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé€šå¸¸æœ‰å¤šä¸ª config server é…ç½®æœåŠ¡å™¨ï¼Œå› ä¸ºå®ƒå­˜å‚¨äº†åˆ†ç‰‡è·¯ç”±çš„å…ƒæ•°æ®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼</p>
</li>
<li><p>shardï¼Œåˆ†ç‰‡ï¼ˆshardingï¼‰æ˜¯æŒ‡å°†æ•°æ®åº“æ‹†åˆ†ï¼Œå°†å…¶åˆ†æ•£åœ¨ä¸åŒçš„æœºå™¨ä¸Šçš„è¿‡ç¨‹ã€‚å°†æ•°æ®åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨ä¸Šï¼Œä¸éœ€è¦åŠŸèƒ½å¼ºå¤§çš„æœåŠ¡å™¨å°±å¯ä»¥å­˜å‚¨æ›´å¤šçš„æ•°æ®å’Œå¤„ç†æ›´å¤§çš„è´Ÿè½½ã€‚åŸºæœ¬æ€æƒ³å°±æ˜¯å°†é›†åˆåˆ‡æˆå°å—ï¼Œè¿™äº›å—åˆ†æ•£åˆ°è‹¥å¹²ç‰‡é‡Œï¼Œæ¯ä¸ªç‰‡åªè´Ÿè´£æ€»æ•°æ®çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åé€šè¿‡ä¸€ä¸ªå‡è¡¡å™¨æ¥å¯¹å„ä¸ªåˆ†ç‰‡è¿›è¡Œå‡è¡¡ï¼ˆæ•°æ®è¿ç§»ï¼‰ã€‚</p>
</li>
<li><p>replica setï¼Œä¸­æ–‡ç¿»è¯‘å‰¯æœ¬é›†ï¼Œå…¶å®å°±æ˜¯shardçš„å¤‡ä»½ï¼Œé˜²æ­¢shardæŒ‚æ‰ä¹‹åæ•°æ®ä¸¢å¤±ã€‚å¤åˆ¶æä¾›äº†æ•°æ®çš„å†—ä½™å¤‡ä»½ï¼Œå¹¶åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šå­˜å‚¨æ•°æ®å‰¯æœ¬ï¼Œæé«˜äº†æ•°æ®çš„å¯ç”¨æ€§ï¼Œ å¹¶å¯ä»¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚</p>
</li>
<li><p>ä»²è£è€…ï¼ˆArbiterï¼‰ï¼Œæ˜¯å¤åˆ¶é›†ä¸­çš„ä¸€ä¸ªMongoDBå®ä¾‹ï¼Œå®ƒå¹¶ä¸ä¿å­˜æ•°æ®ã€‚ä»²è£èŠ‚ç‚¹ä½¿ç”¨æœ€å°çš„èµ„æºå¹¶ä¸”ä¸è¦æ±‚ç¡¬ä»¶è®¾å¤‡ï¼Œä¸èƒ½å°†Arbiteréƒ¨ç½²åœ¨åŒä¸€ä¸ªæ•°æ®é›†èŠ‚ç‚¹ä¸­ï¼Œå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–åº”ç”¨æœåŠ¡å™¨æˆ–è€…ç›‘è§†æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿå¯éƒ¨ç½²åœ¨å•ç‹¬çš„è™šæ‹Ÿæœºä¸­ã€‚ä¸ºäº†ç¡®ä¿å¤åˆ¶é›†ä¸­æœ‰å¥‡æ•°çš„æŠ•ç¥¨æˆå‘˜ï¼ˆåŒ…æ‹¬primaryï¼‰ï¼Œéœ€è¦æ·»åŠ ä»²è£èŠ‚ç‚¹åšä¸ºæŠ•ç¥¨ï¼Œå¦åˆ™primaryä¸èƒ½è¿è¡Œæ—¶ä¸ä¼šè‡ªåŠ¨åˆ‡æ¢primaryã€‚</p>
</li>
</ol>
<p>ç®€å•äº†è§£ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ€»ç»“ä¸€ä¸‹ï¼Œåº”ç”¨è¯·æ±‚mongosæ¥æ“ä½œmongodbçš„å¢åˆ æ”¹æŸ¥ï¼Œé…ç½®æœåŠ¡å™¨å­˜å‚¨æ•°æ®åº“å…ƒä¿¡æ¯ï¼Œå¹¶ä¸”å’ŒmongosåšåŒæ­¥ï¼Œæ•°æ®æœ€ç»ˆå­˜å…¥åœ¨shardï¼ˆåˆ†ç‰‡ï¼‰ä¸Šï¼Œä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±åŒæ­¥åœ¨å‰¯æœ¬é›†ä¸­å­˜å‚¨äº†ä¸€ä»½ï¼Œä»²è£åœ¨æ•°æ®å­˜å‚¨åˆ°åˆ†ç‰‡çš„æ—¶å€™å†³å®šå­˜å‚¨åˆ°å“ªä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>ç³»ç»Ÿç³»ç»Ÿ Ubuntu 18.04.1 LTS<br>ä¸‰å°æœåŠ¡å™¨ï¼š10.20.71.135/10.20.73.182/10.20.70.61<br>å®‰è£…åŒ…ï¼š mongodb-org-server_4.0.6_amd64.deb</p>
<h4 id="æœåŠ¡å™¨è§„åˆ’"><a href="#æœåŠ¡å™¨è§„åˆ’" class="headerlink" title="æœåŠ¡å™¨è§„åˆ’"></a>æœåŠ¡å™¨è§„åˆ’</h4><table>
<thead>
<tr>
<th>æœåŠ¡å™¨mongo-135</th>
<th>æœåŠ¡å™¨mongo-182</th>
<th>æœåŠ¡å™¨mongo-61</th>
</tr>
</thead>
<tbody><tr>
<td>mongos</td>
<td>mongos</td>
<td>mongos</td>
</tr>
<tr>
<td>config server</td>
<td>config server</td>
<td>config server</td>
</tr>
<tr>
<td>shard server1 ä¸»èŠ‚ç‚¹</td>
<td>shard server1 å‰¯èŠ‚ç‚¹</td>
<td>shard server1 ä»²è£</td>
</tr>
<tr>
<td>shard server2 ä»²è£</td>
<td>shard server2 ä¸»èŠ‚ç‚¹</td>
<td>shard server2 ä¸»èŠ‚ç‚¹</td>
</tr>
<tr>
<td>shard server3 å‰¯èŠ‚ç‚¹</td>
<td>shard server3 ä»²è£</td>
<td>shard server3 ä¸»èŠ‚ç‚¹</td>
</tr>
</tbody></table>
<p>ç«¯å£åˆ†é…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongosï¼š20000</span><br><span class="line">configï¼š21000</span><br><span class="line">shard1ï¼š27017</span><br><span class="line">shard2ï¼š27017</span><br><span class="line">shard3ï¼š27017</span><br></pre></td></tr></table></figure>
<h3 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h3><ol>
<li><p>mongodbæºé…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo apt-key adv --keyserver hkp:&#x2F;&#x2F;keyserver.ubuntu.com:80 --recv 9DA31620334BD75D9DCB49F368818C72E52529D4</span><br><span class="line">echo &quot;deb [ arch&#x3D;amd64 ] https:&#x2F;&#x2F;repo.mongodb.org&#x2F;apt&#x2F;ubuntu bionic&#x2F;mongodb-org&#x2F;4.0 multiverse&quot; | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;mongodb-org-4.0.list</span><br><span class="line">sudo apt-get update</span><br><span class="line">ä¼šå®‰è£…å¯¹åº”æºçš„mongoæ‰€æœ‰ä¾èµ–åŒ…,æ­¤å¤„ä¸æ‰§è¡Œ</span><br><span class="line"># sudo apt-get install -y mongodb-org</span><br><span class="line">echo &quot;mongodb-org hold&quot; | sudo dpkg --set-selections</span><br><span class="line">echo &quot;mongodb-org-server hold&quot; | sudo dpkg --set-selections</span><br><span class="line">echo &quot;mongodb-org-shell hold&quot; | sudo dpkg --set-selections</span><br><span class="line">echo &quot;mongodb-org-mongos hold&quot; | sudo dpkg --set-selections</span><br><span class="line">echo &quot;mongodb-org-tools hold&quot; | sudo dpkg --set-selections</span><br><span class="line"></span><br><span class="line"># å®‰è£…ä¾èµ–</span><br><span class="line">apt install -y  mongodb-org-mongos mongodb-org-shell mongodb-org-tools</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener">å‚è€ƒ</a></p>
</li>
<li><p>mongodbå®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;repo.mongodb.org&#x2F;apt&#x2F;ubuntu&#x2F;dists&#x2F;bionic&#x2F;mongodb-org&#x2F;4.0&#x2F;multiverse&#x2F;binary-amd64&#x2F;mongodb-org-server_4.0.6_amd64.deb</span><br><span class="line">dpkg -i mongodb-org-server_4.0.6_amd64.deb</span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«åœ¨æ¯å°æœºå™¨å»ºç«‹confã€mongosã€configã€shard1ã€shard2ã€shard3å…­ä¸ªç›®å½•ï¼Œå› ä¸ºmongosä¸å­˜å‚¨æ•°æ®ï¼Œåªéœ€è¦å»ºç«‹æ—¥å¿—æ–‡ä»¶ç›®å½•å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;conf</span><br><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;mongos&#x2F;log</span><br><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;configsvr&#x2F;&#123;data,log&#125;</span><br><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;shard1&#x2F;&#123;date,log&#125;</span><br><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;shard2&#x2F;&#123;data,log&#125;</span><br><span class="line">mkdir -p &#x2F;usr&#x2F;local&#x2F;mongodb&#x2F;shard3&#x2F;&#123;data,log&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å‡†å¤‡é›†ç¾¤é—´é€šä¿¡ä½¿ç”¨çš„åŠ å¯†key"><a href="#å‡†å¤‡é›†ç¾¤é—´é€šä¿¡ä½¿ç”¨çš„åŠ å¯†key" class="headerlink" title="å‡†å¤‡é›†ç¾¤é—´é€šä¿¡ä½¿ç”¨çš„åŠ å¯†key"></a>å‡†å¤‡é›†ç¾¤é—´é€šä¿¡ä½¿ç”¨çš„åŠ å¯†key</h3><p>åˆ›å»ºmongodã€mongosä¹‹é—´é€šä¿¡æ‰€ä½¿ç”¨çš„keyæ–‡ä»¶ï¼Œåœ¨ä»»æ„ä¸€å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">openssl rand -base64 756 &gt; &#x2F;etc&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">chmod 400 &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line"># å°†&#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;keyæ–‡ä»¶æ‹·è´åˆ°å…¶å®ƒæœåŠ¡å™¨ä¸Šï¼Œä¿æŒæ–‡ä»¶æƒé™ä¸å˜</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="connfig-serveré…ç½®æœåŠ¡å™¨"><a href="#connfig-serveré…ç½®æœåŠ¡å™¨" class="headerlink" title="connfig serveré…ç½®æœåŠ¡å™¨"></a>connfig serveré…ç½®æœåŠ¡å™¨</h3><p>mongodb3.4ä»¥åè¦æ±‚é…ç½®æœåŠ¡å™¨ä¹Ÿåˆ›å»ºå‰¯æœ¬é›†ï¼Œä¸ç„¶é›†ç¾¤æ­å»ºä¸æˆåŠŸã€‚<br>æ·»åŠ é…ç½®æ–‡ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat configsrv.conf</span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongodb&#x2F;config&#x2F;data</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;config&#x2F;log&#x2F;configsrv.log</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 21000</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">   authorization: enabled</span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: configs</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: &quot;configsvr&quot;</span><br></pre></td></tr></table></figure>
<p>åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨çš„config server<br>æ–¹å¼ä¸€:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;configsrv.conf</span><br></pre></td></tr></table></figure>
<p>æ–¹å¼äºŒ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongosrv.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MongoDB Database Config Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mongodb</span><br><span class="line">Group&#x3D;mongodb</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;default&#x2F;mongod</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;mongod --config &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;configsrv.conf</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mongodb&#x2F;config&#x2F;log&#x2F;configsrv.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE&#x3D;infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU&#x3D;infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS&#x3D;infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE&#x3D;64000</span><br><span class="line"># processes&#x2F;threads</span><br><span class="line">LimitNPROC&#x3D;64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK&#x3D;infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax&#x3D;infinity</span><br><span class="line">TasksAccounting&#x3D;false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;ulimit&#x2F;#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start mongosrv.service</span><br><span class="line">systemctl enable mongosrv.service</span><br></pre></td></tr></table></figure>
<p>ç™»å½•ä»»æ„ä¸€å°é…ç½®æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–é…ç½®å‰¯æœ¬é›†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#è¿æ¥</span><br><span class="line">mongo --port 21000</span><br><span class="line">#configå˜é‡</span><br><span class="line">config &#x3D; &#123;</span><br><span class="line">    _id : &quot;configs&quot;,</span><br><span class="line">     members : [</span><br><span class="line">         &#123;_id : 0, host : &quot;10.20.71.135:21000&quot; &#125;,</span><br><span class="line">         &#123;_id : 1, host : &quot;10.20.73.182:21000&quot; &#125;,</span><br><span class="line">         &#123;_id : 2, host : &quot;10.20.70.61:21000&quot; &#125;</span><br><span class="line">     ]</span><br><span class="line">&#125;</span><br><span class="line">#åˆå§‹åŒ–å‰¯æœ¬é›†</span><br><span class="line">rs.initiate(config)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œâ€_idâ€ : â€œconfigsâ€åº”ä¸é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ replicaction.replSetName ä¸€è‡´ï¼Œâ€membersâ€ ä¸­çš„ â€œhostâ€ ä¸ºä¸‰ä¸ªèŠ‚ç‚¹çš„ ip å’Œ port</p>
<h3 id="é…ç½®åˆ†ç‰‡å‰¯æœ¬é›†-ä¸‰å°æœºå™¨"><a href="#é…ç½®åˆ†ç‰‡å‰¯æœ¬é›†-ä¸‰å°æœºå™¨" class="headerlink" title="é…ç½®åˆ†ç‰‡å‰¯æœ¬é›†(ä¸‰å°æœºå™¨)"></a>é…ç½®åˆ†ç‰‡å‰¯æœ¬é›†(ä¸‰å°æœºå™¨)</h3><h4 id="è®¾ç½®ç¬¬ä¸€ä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard1"><a href="#è®¾ç½®ç¬¬ä¸€ä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard1" class="headerlink" title="è®¾ç½®ç¬¬ä¸€ä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard1)"></a>è®¾ç½®ç¬¬ä¸€ä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard1)</h4><ol>
<li>é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# egrep -v ^# shard1.conf</span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongodb&#x2F;shard1&#x2F;data</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;shard1&#x2F;log&#x2F;shard1.log</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27017</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">   authorization: enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard1</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: &quot;shardsvr&quot;</span><br></pre></td></tr></table></figure></li>
<li>åˆ¶ä½œæœåŠ¡å¯åŠ¨æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod-shard1.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MongoDB Shard1 Database Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mongodb</span><br><span class="line">Group&#x3D;mongodb</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;default&#x2F;mongod</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;mongod --config &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard1.conf</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mongodb&#x2F;shard1&#x2F;log&#x2F;shard1.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE&#x3D;infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU&#x3D;infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS&#x3D;infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE&#x3D;64000</span><br><span class="line"># processes&#x2F;threads</span><br><span class="line">LimitNPROC&#x3D;64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK&#x3D;infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax&#x3D;infinity</span><br><span class="line">TasksAccounting&#x3D;false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;ulimit&#x2F;#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼ä¸€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl daemon-reload</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl start mongod-shard1.service</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl status mongod-shard1.service</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼äºŒ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard1.conf</span><br></pre></td></tr></table></figure>
ç™»é™†ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–å‰¯æœ¬é›†:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨ä»»æ„ä¸€å°æœåŠ¡ä¸Šåˆå§‹åŒ–å¤åˆ¶é›†é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">mongo --port 27017</span><br><span class="line">#ä½¿ç”¨adminæ•°æ®åº“</span><br><span class="line">use admin</span><br><span class="line">#å®šä¹‰å‰¯æœ¬é›†é…ç½®ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„ &quot;arbiterOnly&quot;:true ä»£è¡¨å…¶ä¸ºä»²è£èŠ‚ç‚¹ã€‚</span><br><span class="line">config &#x3D; &#123;</span><br><span class="line">   _id : &quot;shard1&quot;,</span><br><span class="line">   members : [</span><br><span class="line">       &#123;_id : 0, host : &quot;10.20.71.135:27017&quot; &#125;,</span><br><span class="line">       &#123;_id : 1, host : &quot;10.20.73.182:27017&quot; &#125;,</span><br><span class="line">       &#123;_id : 2, host : &quot;10.20.70.61:27017&quot;, arbiterOnly: true &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">#åˆå§‹åŒ–å‰¯æœ¬é›†é…ç½®</span><br><span class="line">rs.initiate(config);</span><br><span class="line">rs.status()</span><br><span class="line">rs.conf()</span><br></pre></td></tr></table></figure>
<h4 id="è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard2"><a href="#è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard2" class="headerlink" title="è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard2)"></a>è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard2)</h4></li>
<li>é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# egrep -v ^# shard2.conf</span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongodb&#x2F;shard2&#x2F;data</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;shard2&#x2F;log&#x2F;shard2.log</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27018</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">   authorization: enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard2</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: &quot;shardsvr&quot;</span><br></pre></td></tr></table></figure></li>
<li>åˆ¶ä½œæœåŠ¡å¯åŠ¨æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod-shard2.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MongoDB Shard2 Database Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mongodb</span><br><span class="line">Group&#x3D;mongodb</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;default&#x2F;mongod</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;mongod --config &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard2.conf</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mongodb&#x2F;shard2&#x2F;log&#x2F;shard2.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE&#x3D;infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU&#x3D;infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS&#x3D;infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE&#x3D;64000</span><br><span class="line"># processes&#x2F;threads</span><br><span class="line">LimitNPROC&#x3D;64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK&#x3D;infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax&#x3D;infinity</span><br><span class="line">TasksAccounting&#x3D;false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;ulimit&#x2F;#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼ä¸€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl daemon-reload</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl start mongod-shard2.service</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl status mongod-shard2.service</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼äºŒ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard2.conf</span><br></pre></td></tr></table></figure>
ç™»é™†ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–å‰¯æœ¬é›†:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨ä»»æ„ä¸€å°æœåŠ¡ä¸Šåˆå§‹åŒ–å¤åˆ¶é›†é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">mongo --port 27018</span><br><span class="line">#ä½¿ç”¨adminæ•°æ®åº“</span><br><span class="line">use admin</span><br><span class="line">#å®šä¹‰å‰¯æœ¬é›†é…ç½®ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„ &quot;arbiterOnly&quot;:true ä»£è¡¨å…¶ä¸ºä»²è£èŠ‚ç‚¹ã€‚</span><br><span class="line">config &#x3D; &#123;</span><br><span class="line">   _id : &quot;shard2&quot;,</span><br><span class="line">   members : [</span><br><span class="line">       &#123;_id : 0, host : &quot;10.20.71.135:27018&quot; &#125;,</span><br><span class="line">       &#123;_id : 1, host : &quot;10.20.73.182:27018&quot;, arbiterOnly: true &#125;,</span><br><span class="line">       &#123;_id : 2, host : &quot;10.20.70.61:27018&quot; &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">#åˆå§‹åŒ–å‰¯æœ¬é›†é…ç½®</span><br><span class="line">rs.initiate(config);</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard3"><a href="#è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†-shard3" class="headerlink" title="è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard3)"></a>è®¾ç½®ç¬¬äºŒä¸ªåˆ†ç‰‡å‰¯æœ¬é›†(shard3)</h4><ol>
<li>é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# egrep -v ^# shard3.conf</span><br><span class="line">storage:</span><br><span class="line">  dbPath: &#x2F;data&#x2F;mongodb&#x2F;shard3&#x2F;data</span><br><span class="line">  journal:</span><br><span class="line">    enabled: true</span><br><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;shard3&#x2F;log&#x2F;shard3.log</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 27019</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">   authorization: enabled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  replSetName: shard3</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  clusterRole: &quot;shardsvr&quot;</span><br></pre></td></tr></table></figure></li>
<li>åˆ¶ä½œæœåŠ¡å¯åŠ¨æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongod-shard3.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MongoDB Shard3 Database Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mongodb</span><br><span class="line">Group&#x3D;mongodb</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;default&#x2F;mongod</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;mongod --config &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard3.conf</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mongodb&#x2F;shard3&#x2F;log&#x2F;shard3.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE&#x3D;infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU&#x3D;infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS&#x3D;infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE&#x3D;64000</span><br><span class="line"># processes&#x2F;threads</span><br><span class="line">LimitNPROC&#x3D;64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK&#x3D;infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax&#x3D;infinity</span><br><span class="line">TasksAccounting&#x3D;false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;ulimit&#x2F;#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼ä¸€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl daemon-reload</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl start mongod-shard3.service</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl status mongod-shard3.service</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼äºŒ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard3.conf</span><br></pre></td></tr></table></figure>
ç™»é™†ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œåˆå§‹åŒ–å‰¯æœ¬é›†:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongo --port 27019</span><br><span class="line"></span><br><span class="line">use admin</span><br><span class="line"></span><br><span class="line">#å®šä¹‰å‰¯æœ¬é›†é…ç½®ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„ &quot;arbiterOnly&quot;:true ä»£è¡¨å…¶ä¸ºä»²è£èŠ‚ç‚¹ã€‚</span><br><span class="line">config &#x3D; &#123;</span><br><span class="line">   _id : &quot;shard3&quot;,</span><br><span class="line">   members : [</span><br><span class="line">       &#123;_id : 0, host : &quot;10.20.71.135:27019&quot;,arbiterOnly: true &#125;,</span><br><span class="line">       &#123;_id : 1, host : &quot;10.20.73.182:27019&quot; &#125;,</span><br><span class="line">       &#123;_id : 2, host : &quot;10.20.70.61:27019&quot; &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#åˆå§‹åŒ–å‰¯æœ¬é›†é…ç½®</span><br><span class="line">rs.initiate(config);</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®è·¯ç”±æœåŠ¡å™¨-mongos"><a href="#é…ç½®è·¯ç”±æœåŠ¡å™¨-mongos" class="headerlink" title="é…ç½®è·¯ç”±æœåŠ¡å™¨ mongos"></a>é…ç½®è·¯ç”±æœåŠ¡å™¨ mongos</h3>å…ˆå¯åŠ¨é…ç½®æœåŠ¡å™¨å’Œåˆ†ç‰‡æœåŠ¡å™¨,åå¯åŠ¨è·¯ç”±å®ä¾‹:ï¼ˆä¸‰å°æœºå™¨ï¼‰</li>
<li>é…ç½®æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">systemLog:</span><br><span class="line">  destination: file</span><br><span class="line">  logAppend: true</span><br><span class="line">  path: &#x2F;data&#x2F;mongodb&#x2F;mongos&#x2F;log&#x2F;mongos.log</span><br><span class="line"></span><br><span class="line">net:</span><br><span class="line">  port: 20000</span><br><span class="line">  bindIp: 0.0.0.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">processManagement:</span><br><span class="line">  timeZoneInfo: &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"></span><br><span class="line">security:</span><br><span class="line">   keyFile: &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;key</span><br><span class="line">   clusterAuthMode: keyFile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">replication:</span><br><span class="line">  localPingThresholdMs: 15</span><br><span class="line"></span><br><span class="line">sharding:</span><br><span class="line">  #ç›‘å¬çš„é…ç½®æœåŠ¡å™¨,åªèƒ½æœ‰1ä¸ªæˆ–è€…3ä¸ª configsä¸ºé…ç½®æœåŠ¡å™¨çš„å‰¯æœ¬é›†åå­—</span><br><span class="line">  configDB: &quot;configs&#x2F;10.20.71.135:21000,10.20.73.182:21000,10.20.70.61:21000&quot;</span><br></pre></td></tr></table></figure></li>
<li>åˆ¶ä½œæœåŠ¡å¯åŠ¨æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# cat &#x2F;lib&#x2F;systemd&#x2F;system&#x2F;mongos.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;MongoDB Mongos Database Server</span><br><span class="line">After&#x3D;network.target</span><br><span class="line">Documentation&#x3D;https:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User&#x3D;mongodb</span><br><span class="line">Group&#x3D;mongodb</span><br><span class="line">EnvironmentFile&#x3D;-&#x2F;etc&#x2F;default&#x2F;mongod</span><br><span class="line">ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;mongos --config &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;mongos.conf</span><br><span class="line">PIDFile&#x3D;&#x2F;data&#x2F;mongodb&#x2F;mongos&#x2F;log&#x2F;mongos.pid</span><br><span class="line"># file size</span><br><span class="line">LimitFSIZE&#x3D;infinity</span><br><span class="line"># cpu time</span><br><span class="line">LimitCPU&#x3D;infinity</span><br><span class="line"># virtual memory size</span><br><span class="line">LimitAS&#x3D;infinity</span><br><span class="line"># open files</span><br><span class="line">LimitNOFILE&#x3D;64000</span><br><span class="line"># processes&#x2F;threads</span><br><span class="line">LimitNPROC&#x3D;64000</span><br><span class="line"># locked memory</span><br><span class="line">LimitMEMLOCK&#x3D;infinity</span><br><span class="line"># total threads (user+kernel)</span><br><span class="line">TasksMax&#x3D;infinity</span><br><span class="line">TasksAccounting&#x3D;false</span><br><span class="line"></span><br><span class="line"># Recommended limits for for mongod as specified in</span><br><span class="line"># http:&#x2F;&#x2F;docs.mongodb.org&#x2F;manual&#x2F;reference&#x2F;ulimit&#x2F;#recommended-settings</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼ä¸€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl daemon-reload</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl enable mongos</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl start mongos.service</span><br><span class="line">root@mgo-db01cn-p001:&#x2F;data&#x2F;mongodb&#x2F;conf# systemctl status mongos.service</span><br></pre></td></tr></table></figure>
å¯åŠ¨æ–¹å¼äºŒ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongod -f &#x2F;data&#x2F;mongodb&#x2F;conf&#x2F;shard3.conf</span><br></pre></td></tr></table></figure></li>
<li>å¯ç”¨åˆ†ç‰‡<br>ç›®å‰æ­å»ºäº†mongodbé…ç½®æœåŠ¡å™¨ã€è·¯ç”±æœåŠ¡å™¨ï¼Œå„ä¸ªåˆ†ç‰‡æœåŠ¡å™¨ï¼Œä¸è¿‡åº”ç”¨ç¨‹åºè¿æ¥åˆ°mongosè·¯ç”±æœåŠ¡å™¨å¹¶ä¸èƒ½ä½¿ç”¨åˆ†ç‰‡æœºåˆ¶ï¼Œè¿˜éœ€è¦åœ¨ç¨‹åºé‡Œè®¾ç½®åˆ†ç‰‡é…ç½®ï¼Œè®©åˆ†ç‰‡ç”Ÿæ•ˆã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongo --port 20000</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨adminæ•°æ®åº“</span><br><span class="line">use  admin</span><br><span class="line"></span><br><span class="line">#ä¸²è”è·¯ç”±æœåŠ¡å™¨ä¸åˆ†é…å‰¯æœ¬é›†</span><br><span class="line">sh.addShard(&quot;shard1&#x2F;10.20.71.135:27017,10.20.73.182:27017,10.20.70.61:27017&quot;)</span><br><span class="line">sh.addShard(&quot;shard2&#x2F;10.20.71.135:27018,10.20.73.182:27018,10.20.70.61:27018&quot;)</span><br><span class="line">sh.addShard(&quot;shard3&#x2F;10.20.71.135:27019,10.20.73.182:27019,10.20.70.61:27019&quot;)</span><br><span class="line"></span><br><span class="line">#æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</span><br><span class="line">sh.status()</span><br></pre></td></tr></table></figure>
âš ï¸ : é›†ç¾¤æœåŠ¡å¯åŠ¨é¡ºåº<br>mongodbçš„å¯åŠ¨é¡ºåºæ˜¯ï¼Œå…ˆå¯åŠ¨é…ç½®æœåŠ¡å™¨ï¼Œåœ¨å¯åŠ¨åˆ†ç‰‡ï¼Œæœ€åå¯åŠ¨mongos.<br>configsvr-&gt;shard-&gt;mongos<br>è‡³æ­¤ï¼Œæ•´ä¸ªmongodbé«˜å¯ç”¨é›†ç¾¤å°±æ­å»ºå¥½äº†ã€‚</li>
</ol>
<h3 id="éƒ¨ç½²æµ‹è¯•"><a href="#éƒ¨ç½²æµ‹è¯•" class="headerlink" title="éƒ¨ç½²æµ‹è¯•"></a>éƒ¨ç½²æµ‹è¯•</h3><ol>
<li>å…ˆå»ºä¸€ä¸ªdatabaseåŠuseråˆ›å»ºæ•°æ®<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºä¸€ä¸ªadminç”¨æˆ·</span><br><span class="line">$ mongo --port 20000</span><br><span class="line">&gt; use admin</span><br><span class="line">&gt; db.createUser(&#123; user: &quot;weadmin&quot;, pwd: &quot;123456&quot;,roles: [&#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125;,&#123; role: &quot;clusterManager&quot;, db : &quot;admin&quot;&#125;],passwordDigestor: &quot;server&quot;&#125;)</span><br><span class="line">&gt; exit</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªdatabaseçš„è®¿é—®ç”¨æˆ·</span><br><span class="line">$ mongo --username weadmin --password 123456 --authenticationDatabase admin --port 20000 admin</span><br><span class="line">&gt; use test</span><br><span class="line">&gt; db.createUser(&#123;user: &quot;test&quot;,pwd: &quot;123456&quot;,roles: [&#123; role: &quot;dbOwner&quot;, db: &quot;test&quot; &#125;],passwordDigestor: &quot;server&quot;&#125;);</span><br><span class="line">&gt; exit</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨è¯¥ç”¨æˆ·è®¿é—®databaseï¼Œå¹¶æ’å…¥æ•°æ®ï¼Œåˆ›å»ºç´¢å¼•</span><br><span class="line">$ mongo --username test --password 123456 --authenticationDatabase test --port 20000  test</span><br><span class="line">#æ’å…¥æµ‹è¯•æ•°æ®</span><br><span class="line">&gt; for (var i &#x3D; 1; i &lt;&#x3D; 5000; i++)&#123;db.table1.save(&#123;id:i,&quot;name&quot;:&quot;shuke&quot;&#125;)&#125;;</span><br><span class="line">&gt; exit</span><br></pre></td></tr></table></figure></li>
<li>åˆ†ç‰‡ç”Ÿæ•ˆ<br>ç›®å‰é…ç½®æœåŠ¡ã€è·¯ç”±æœåŠ¡ã€åˆ†ç‰‡æœåŠ¡ã€å‰¯æœ¬é›†æœåŠ¡éƒ½å·²ç»ä¸²è”èµ·æ¥äº†ï¼Œä½†æˆ‘ä»¬çš„ç›®çš„æ˜¯å¸Œæœ›æ’å…¥æ•°æ®ï¼Œæ•°æ®èƒ½å¤Ÿè‡ªåŠ¨åˆ†ç‰‡ã€‚è¿æ¥åœ¨mongosä¸Šï¼Œå‡†å¤‡è®©æŒ‡å®šçš„æ•°æ®åº“ã€æŒ‡å®šçš„é›†åˆåˆ†ç‰‡ç”Ÿæ•ˆã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mongo --username weadmin --password 123456 --authenticationDatabase admin --port 20000 admin</span><br><span class="line">&gt; use admin</span><br><span class="line"># è®¤è¯</span><br><span class="line">&gt; db.auth(&quot;weadmin&quot;, &quot;123456&quot;)</span><br><span class="line">#æŒ‡å®štestdbåˆ†ç‰‡ç”Ÿæ•ˆ</span><br><span class="line">db.runCommand( &#123; enablesharding :&quot;test&quot;&#125;);</span><br><span class="line">#æŒ‡å®šæ•°æ®åº“é‡Œéœ€è¦åˆ†ç‰‡çš„é›†åˆå’Œç‰‡é”®</span><br><span class="line">db.runCommand( &#123; shardcollection : &quot;test.table1&quot;,key : &#123;id: 1&#125; &#125; )</span><br></pre></td></tr></table></figure>
æˆ‘ä»¬è®¾ç½®testdbçš„ table1 è¡¨éœ€è¦åˆ†ç‰‡ï¼Œæ ¹æ® id è‡ªåŠ¨åˆ†ç‰‡åˆ° shard1 ï¼Œshard2ï¼Œshard3 ä¸Šé¢å»ã€‚è¦è¿™æ ·è®¾ç½®æ˜¯å› ä¸ºä¸æ˜¯æ‰€æœ‰mongodb çš„æ•°æ®åº“å’Œè¡¨ éƒ½éœ€è¦åˆ†ç‰‡ï¼</li>
<li>æµ‹è¯•åˆ†ç‰‡é…ç½®ç»“æœ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mongo --username test --password 123456 --authenticationDatabase test --port 20000  test</span><br><span class="line">&gt; use test</span><br><span class="line">&gt; db.auth(&quot;test&quot;, &quot;123456&quot;)</span><br><span class="line">#æŸ¥çœ‹åˆ†ç‰‡æƒ…å†µ</span><br><span class="line">&gt; db.table1.stats();</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ‰‹å·¥éƒ¨ç½²mongodbé›†ç¾¤è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œæ‰€ä»¥å¦‚æœå›¾çœäº‹å„¿ï¼Œè¿˜æ˜¯ä½¿ç”¨äº‘å‚å•†æä¾›çš„PaaSæœåŠ¡å¥½äº†ï¼Œæ¯”å¦‚äº‘æ•°æ®åº“ MongoDBã€‚å¦‚æœä¸€å®šè¦è‡ªå·±æ­å»ºï¼Œè¿˜æ˜¯å»ºè®®ç”¨ç°æˆçš„<a href="https://github.com/twoyao/ansible-mongodb-cluster" target="_blank" rel="noopener">ansible-mongodb-cluster</a>è„šæœ¬å¥½äº†ã€‚</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://jeremyxu2010.github.io/2018/10/mongodb%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/" target="_blank" rel="noopener">mongodbé«˜å¯ç”¨é›†ç¾¤éƒ¨ç½² - jeremyçš„æŠ€æœ¯ç‚¹æ»´</a><br><a href="http://www.ityouknow.com/mongodb/2017/08/05/mongodb-cluster-setup.html" target="_blank" rel="noopener">mongodb 3.4 é›†ç¾¤æ­å»ºï¼šåˆ†ç‰‡+å‰¯æœ¬é›† - çº¯æ´çš„å¾®ç¬‘åšå®¢</a><br><a href="https://cloud.tencent.com/developer/article/1034843" target="_blank" rel="noopener">æ­å»º MongoDBåˆ†ç‰‡ï¼ˆshardingï¼‰ / åˆ†åŒº / é›†ç¾¤ç¯å¢ƒ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘</a><br><a href="https://segmentfault.com/a/1190000012376769" target="_blank" rel="noopener">MongoDBå‰¯æœ¬é›†é…ç½® - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦</a><br><a href="http://www.mongoing.com/docs/core/replica-set-architecture-three-members.html" target="_blank" rel="noopener">ä¸‰ä¸ªèŠ‚ç‚¹çš„å¤åˆ¶é›† â€” MongoDB Manual 3.4</a><br><a href="https://blog.lijunbo.com/2018/04/02/ubuntu_mongo_install/" target="_blank" rel="noopener">åœ¨Ubuntuä¸Šå®‰è£…MongoDBç¤¾åŒºç‰ˆ | é™æ°´æµæ·±</a></p>
]]></content>
      <categories>
        <category>mongodb</category>
      </categories>
      <tags>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨Django RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ</title>
    <url>/2020/04/23/%E5%9C%A8Django-REST%E6%A1%86%E6%9E%B6%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8%E4%B8%AD%E5%8A%A8%E6%80%81%E6%8E%92%E9%99%A4%E6%88%96%E5%8C%85%E5%90%AB%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5/</url>
    <content><![CDATA[<h2 id="åœ¨Django-RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ"><a href="#åœ¨Django-RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ" class="headerlink" title="åœ¨Django RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ"></a>åœ¨Django RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ</h2><p>æˆ‘åœ¨Django RESTæ¡†æ¶ä¸­æœ‰ä¸€ä¸ªåºåˆ—åŒ–ç¨‹åºï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class QuestionSerializer(serializers.Serializer):</span><br><span class="line">    id &#x3D; serializers.CharField()</span><br><span class="line">    question_text &#x3D; QuestionTextSerializer()</span><br><span class="line">    topic &#x3D; TopicSerializer()</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘æœ‰ä¸¤ä¸ªä½¿ç”¨ä¸Šè¿°åºåˆ—åŒ–ç¨‹åºçš„APIè§†å›¾ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class QuestionWithTopicView(generics.RetrieveAPIView):</span><br><span class="line">    # I wish to include all three fields - id, question_text</span><br><span class="line">    # and topic in this API.</span><br><span class="line">    serializer_class &#x3D; QuestionSerializer</span><br><span class="line"></span><br><span class="line">class QuestionWithoutTopicView(generics.RetrieveAPIView):</span><br><span class="line">    # I want to exclude topic in this API.</span><br><span class="line">    serializer_class &#x3D; ExamHistorySerializer</span><br></pre></td></tr></table></figure>

<h2 id="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å†™ä¸¤ä¸ªä¸åŒçš„ä¸²è¡Œå™¨ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ¥æœ‰æ¡ä»¶åœ°ä»ç»™å®šçš„åºåˆ—åŒ–ç¨‹åºä¸­æ’é™¤å­—æ®µã€‚"><a href="#ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å†™ä¸¤ä¸ªä¸åŒçš„ä¸²è¡Œå™¨ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ¥æœ‰æ¡ä»¶åœ°ä»ç»™å®šçš„åºåˆ—åŒ–ç¨‹åºä¸­æ’é™¤å­—æ®µã€‚" class="headerlink" title="ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å†™ä¸¤ä¸ªä¸åŒçš„ä¸²è¡Œå™¨ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ¥æœ‰æ¡ä»¶åœ°ä»ç»™å®šçš„åºåˆ—åŒ–ç¨‹åºä¸­æ’é™¤å­—æ®µã€‚"></a>ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å†™ä¸¤ä¸ªä¸åŒçš„ä¸²è¡Œå™¨ã€‚ä½†æ˜¯ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ¥æœ‰æ¡ä»¶åœ°ä»ç»™å®šçš„åºåˆ—åŒ–ç¨‹åºä¸­æ’é™¤å­—æ®µã€‚</h2><p>ä½ è¯•è¿‡è¿™ä¸ªæŠ€å·§å—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class QuestionSerializer(serializers.Serializer):</span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        remove_fields &#x3D; kwargs.pop(&#39;remove_fields&#39;, None)</span><br><span class="line">        super(QuestionSerializer, self).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        if remove_fields:</span><br><span class="line">            # for multiple fields in a list</span><br><span class="line">            for field_name in remove_fields:</span><br><span class="line">                self.fields.pop(field_name)</span><br><span class="line"></span><br><span class="line">class QuestionWithoutTopicView(generics.RetrieveAPIView):</span><br><span class="line">        serializer_class &#x3D; QuestionSerializer(remove_fields&#x3D;[&#39;field_to_remove1&#39; &#39;field_to_remove2&#39;])</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ²¡æœ‰,å€¼å¾—å°è¯•ã€‚</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://codeday.me/bug/20180808/216472.html" target="_blank" rel="noopener">åœ¨Django RESTæ¡†æ¶åºåˆ—åŒ–å™¨ä¸­åŠ¨æ€æ’é™¤æˆ–åŒ…å«ä¸€ä¸ªå­—æ®µ</a></p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>zabbixä½¿ç”¨pythonè·å–é˜¿é‡Œäº‘SLBå¸¦å®½</title>
    <url>/2020/04/23/zabbix%E4%BD%BF%E7%94%A8python%E8%8E%B7%E5%8F%96%E9%98%BF%E9%87%8C%E4%BA%91SLB%E5%B8%A6%E5%AE%BD/</url>
    <content><![CDATA[<h2 id="zabbixä½¿ç”¨pythonè·å–é˜¿é‡Œäº‘SLBå¸¦å®½"><a href="#zabbixä½¿ç”¨pythonè·å–é˜¿é‡Œäº‘SLBå¸¦å®½" class="headerlink" title="zabbixä½¿ç”¨pythonè·å–é˜¿é‡Œäº‘SLBå¸¦å®½"></a>zabbixä½¿ç”¨pythonè·å–é˜¿é‡Œäº‘SLBå¸¦å®½</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/qgRAExPhngfpWON9icxJarejKzj940jmKeg9B7m6hgribxIaWtbYNsndFU2NVpxOIVr9oZAT7Phn93Zulicjnladw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="å±•ç¤ºå›¾"></p>
<h3 id="é˜¿é‡Œäº‘SDK"><a href="#é˜¿é‡Œäº‘SDK" class="headerlink" title="é˜¿é‡Œäº‘SDK"></a>é˜¿é‡Œäº‘SDK</h3><p>é˜¿é‡Œäº‘ç›®å‰æä¾›äº†å¾ˆå¤šçš„SDKï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨åœ¨çº¿è°ƒè¯•å·¥å…·ï¼Œè™½ç„¶æœ‰äº›bug</p>
<p><a href="https://develop.aliyun.com/tools/sdk?#/python" target="_blank" rel="noopener">Python-sdk</a></p>
<p><a href="https://api.aliyun.com/?spm=5176.143622.743215.5.524c6168naUyOU" target="_blank" rel="noopener">åœ¨çº¿è°ƒè¯•å·¥å…·</a></p>
<p>ä½†æ˜¯ä¸»é¡µé¢çš„SDKåˆ—è¡¨é‡Œé¢å¹¶æ²¡æœ‰SLBï¼Œå¹¶ä¸”ç¿»äº†ä¸‹aliyun-python-sdk-slb (2.1.2)è¿™ä¸ªåŒ…é‡Œé¢å¥½åƒä¹Ÿæ²¡æœ‰å¸¦å®½ç›¸å…³çš„æè¿°ã€‚åˆ«æ€¥ï¼Œæˆ‘ä»¬è¿˜æœ‰äº‘ç›‘æ§çš„SDKã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†é˜¿é‡Œäº‘äº‘ç›‘æ§çš„SDKï¼ˆaliyun-python-sdk-cms (5.0.0)ï¼‰</p>
<p>è·å–SLBå¸¦å®½<br>Python2.7è°ƒè¯•é€šè¿‡ï¼Œéœ€è¦ä½¿ç”¨pipå®‰è£…<code>liyun-python-sdk-coreï¼Œaliyun-python-sdk-cms</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"></span><br><span class="line">#coding&#x3D;utf-8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">from aliyunsdkcore import client</span><br><span class="line"></span><br><span class="line">from aliyunsdkcms.request.v20170301 import QueryMetricListRequest</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">clt &#x3D; client.AcsClient(&#39;&lt;ACCESSKEY&gt;&#39;,&#39;&lt;SECRETKEY&gt;&#39;,&#39;cn-beijing&#39;)</span><br><span class="line"></span><br><span class="line">request &#x3D; QueryMetricListRequest.QueryMetricListRequest()</span><br><span class="line"></span><br><span class="line">request.set_accept_format(&#39;json&#39;)</span><br><span class="line"></span><br><span class="line">#ä¸¤ä¸ªå‚æ•°æŒ‰ç…§é¢„è®¾å€¼è®¾å®šï¼Œå‚è§å‚è€ƒèµ„æ–™æè¿°</span><br><span class="line"></span><br><span class="line">request.set_Project(&#39;acs_slb&#39;)</span><br><span class="line"></span><br><span class="line">request.set_Metric(&#39;TrafficTXNew&#39;)</span><br><span class="line"></span><br><span class="line">#åªè·å–1å°æ—¶å†…çš„æ•°æ®</span><br><span class="line"></span><br><span class="line">start_time &#x3D; time.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;,time.localtime(time.time()-3600))</span><br><span class="line"></span><br><span class="line">timestamp_start &#x3D; int(time.mktime(time.strptime(start_time, &quot;%Y-%m-%d %H:%M:%S&quot;))) * 1000</span><br><span class="line"></span><br><span class="line">request.set_StartTime(timestamp_start)</span><br><span class="line"></span><br><span class="line">#ä»ç³»ç»Ÿè¾“å…¥å‚æ•°è·å–IPåœ°å€å’ŒSLB-ID</span><br><span class="line"></span><br><span class="line">slbip &#x3D; sys.argv[1]</span><br><span class="line"></span><br><span class="line">slbid &#x3D; sys.argv[2]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">request.set_Dimensions(&#123;&#39;instanceId&#39;:slbid,&#39;port&#39;:&#39;443&#39;,&#39;vip&#39;:slbip&#125;)</span><br><span class="line"></span><br><span class="line">request.set_Period(&#39;60&#39;)</span><br><span class="line"></span><br><span class="line">#result &#x3D; clt.do_action(request)</span><br><span class="line"></span><br><span class="line">result &#x3D; clt.do_action_with_exception(request)</span><br><span class="line"></span><br><span class="line">#print result</span><br><span class="line"></span><br><span class="line">#jsonç»“æœå¤„ç†</span><br><span class="line"></span><br><span class="line">datadict &#x3D; json.loads(result)</span><br><span class="line"></span><br><span class="line">#å–å€’æ•°ç¬¬äºŒæ¡æ•°æ®ï¼Œå› ä¸ºå€’æ•°ç¬¬ä¸€æ¡ä¸å¤ªå‡†</span><br><span class="line"></span><br><span class="line">res &#x3D; datadict[&#39;Datapoints&#39;][-2][&#39;Average&#39;]</span><br><span class="line"></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">python ali-slb.py  &lt;IPåœ°å€&gt;  &lt;SLBçš„ID&gt;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ¥å…¥zabbixï¼Œä½¿ç”¨grafanaå°±å¯ä»¥å‡ºå›¾äº†ã€‚</p>
]]></content>
      <categories>
        <category>Zabbix</category>
      </categories>
      <tags>
        <tag>Zabbix</tag>
      </tags>
  </entry>
  <entry>
    <title>æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸Šä¸‹æ–‡ç®¡ç†å™¨</title>
    <url>/2020/04/23/%E6%B7%B1%E5%85%A5%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8/</url>
    <content><![CDATA[<h2 id="æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h2><h3 id="mixinç»§æ‰¿"><a href="#mixinç»§æ‰¿" class="headerlink" title="mixinç»§æ‰¿"></a>mixinç»§æ‰¿</h3><p>å¤šç»§æ‰¿ä¼šé€ æˆå…³ç³»æ··ä¹±ï¼Œå¯¼è‡´MROç®—æ³•å‡ºç°è®¸å¤šé¢„æ–™ä¸åˆ°çš„é—®é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯æ¨èMIXINç»§æ‰¿ï¼Œæœ€å°ç»§æ‰¿ï¼Œåªç»§æ‰¿ä¸€ä¸ªç±»ã€‚</p>
<h3 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><p>withä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™ä¸ªç”¨è¿‡å¾ˆå¤šæ¬¡ï¼Œæ¯”å¦‚åœ¨æ‰§è¡Œmysqlè¯­å¥çš„æ—¶å€™è¦å…ˆé“¾æ¥æ•°æ®åº“ï¼Œè·å–æ¸¸æ ‡ï¼Œæ‰§è¡Œsqlè¯­å¥ï¼Œå…³é—­è¿æ¥ã€‚åˆæˆ–è€…æ˜¯æ–‡æœ¬å†…å®¹çš„è¯»å†™ï¼Œæ‰“å¼€æ–‡æœ¬å†™å…¥å†…å®¹å…³é—­æ–‡æœ¬ã€‚</p>
<p>å¦‚æœæ¯æ¬¡æ‰§è¡Œä¸€æ¡è¯­å¥éƒ½è¦åšè¿™ä¹ˆå¤šæ“ä½œï¼Œå°±ä¼šäº§ç”Ÿå¤§é‡é‡å¤çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨å³å¯ç¾è§‚åˆè½»æ¾çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>withç®¡ç†ä¸Šä¸‹æ–‡çš„ä½œç”¨æ˜¯å¯¹ä¸€äº›é‡å¤çš„ä»£ç ç®€å•åŒ–ï¼Œå¹¶ä¸”èƒ½ä¼˜åŒ–try/except/finallyçš„å†™æ³•ã€‚</p>
<p>ä¸Šä¸‹æ–‡çš„å®ç°æ˜¯é€šè¿‡ä¸¤ä¸ªé­”æ³•å‡½æ•°enterå’Œexitå®ç°ï¼Œåæ¥æ›´æ–°å†é€ åï¼Œä½¿ç”¨contextlibæä¾›çš„APIå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„å®Œæˆã€‚</p>
<p>æ¦‚å¿µå’ŒåŠŸèƒ½éƒ½æ˜ç™½åï¼Œæœ€é‡è¦çš„è¿˜æ˜¯å¦‚ä½•å®ç°ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šshukeå»ç»™çŒ«ä¹°é¥¼å¹²ï¼Œæ¯æ¬¡ä¹°çš„æ—¶å€™éƒ½è¦åšè¿™äº›åŠ¨ä½œï¼Œæå‡ºé’±åŒ…ï¼ŒèŠ±å‡ºxå…ƒï¼Œæ”¶å›é’±åŒ…ã€‚æ¯æ¬¡éƒ½è¦é‡å¤æé’±åŒ…æ”¶é’±åŒ…è¿™ä¸ªåŠ¨ä½œæœ‰äº›éº»çƒ¦ï¼Œå¹¶ä¸”ä¸‡ä¸€å¿˜äº†æé’±åŒ…å°±ä¸èƒ½ä»˜é’±ï¼Œå¿˜äº†æ”¶é’±åŒ…çš„è¯ï¼Œé’±åŒ…å°±æ‰äº†ã€‚æ¯æ¬¡æé’±åŒ…æ”¶é’±åŒ…éƒ½è¦å†™ä»£ç ï¼Œæœ‰å•¥ç®€ä»‹çš„æ–¹å¼å˜›ï¼Ÿ</p>
<h3 id="ä½¿ç”¨enterå’Œexitå®ç°-1"><a href="#ä½¿ç”¨enterå’Œexitå®ç°-1" class="headerlink" title="ä½¿ç”¨enterå’Œexitå®ç°(1)"></a>ä½¿ç”¨enterå’Œexitå®ç°(1)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: 0325.py </span><br><span class="line">@time: 2019&#x2F;03&#x2F;25 16:28</span><br><span class="line">@contact: zhaofengfeng@shuke.net</span><br><span class="line">@software:  learn</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class wallet(object):</span><br><span class="line">    def __init__(self, man):</span><br><span class="line">        self.man &#x3D; man</span><br><span class="line"></span><br><span class="line">    def __enter__(self):</span><br><span class="line">        print(self.man + &#39;æ”¾å¿ƒå¤§èƒ†çš„æå‡ºäº†é’±åŒ…&#39;)</span><br><span class="line"></span><br><span class="line">    def __exit__(self, exc_type, exc_val, exc_tb):</span><br><span class="line">        print(self.man + &#39;å°å¿ƒç¿¼ç¿¼çš„æ”¶èµ·æ¥é’±åŒ…&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def use_money(man):</span><br><span class="line">    return wallet(man)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with use_money(&#39;shuke&#39;) as a:</span><br><span class="line">    print(&#39;èŠ±äº†600å—é’±&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿”å›ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shukeæ”¾å¿ƒå¤§èƒ†çš„æå‡ºäº†é’±åŒ…</span><br><span class="line">èŠ±äº†600å—é’±</span><br><span class="line">shukeå°å¿ƒç¿¼ç¿¼çš„æ”¶èµ·æ¥é’±åŒ…</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨enterå’Œexitå®ç°-2"><a href="#ä½¿ç”¨enterå’Œexitå®ç°-2" class="headerlink" title="ä½¿ç”¨enterå’Œexitå®ç°(2)"></a>ä½¿ç”¨enterå’Œexitå®ç°(2)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class wallet(object):</span><br><span class="line">    def __init__(self, man):</span><br><span class="line">        self.man &#x3D; man</span><br><span class="line"></span><br><span class="line">    def __enter__(self):</span><br><span class="line">        print(self.man + &#39;æ”¾å¿ƒå¤§èƒ†çš„æå‡ºäº†é’±åŒ…&#39;)</span><br><span class="line">        # return self è¿™ä¸€æ­¥éå¸¸é‡è¦ï¼Œä½œç”¨æ˜¯è¿”å›å®ä¾‹</span><br><span class="line">        return self</span><br><span class="line"></span><br><span class="line">    def __exit__(self, exc_type, exc_val, exc_tb):</span><br><span class="line">        print(self.man + &#39;å°å¿ƒç¿¼ç¿¼çš„æ”¶èµ·æ¥é’±åŒ…&#39;)</span><br><span class="line"></span><br><span class="line">    def use_money(self, money):</span><br><span class="line">        print(self.man + &#39;èŠ±äº†&#39; + money + &#39;å…ƒ&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with wallet(&#39;shuke02&#39;)as a:</span><br><span class="line">    a.use_money(&#39;1000&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shuke02æ”¾å¿ƒå¤§èƒ†çš„æå‡ºäº†é’±åŒ…</span><br><span class="line">shuke02èŠ±äº†1000å…ƒ</span><br><span class="line">shuke02å°å¿ƒç¿¼ç¿¼çš„æ”¶èµ·æ¥é’±åŒ…</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨contextlibå®ç°"><a href="#ä½¿ç”¨contextlibå®ç°" class="headerlink" title="ä½¿ç”¨contextlibå®ç°"></a>ä½¿ç”¨contextlibå®ç°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import contextlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@contextlib.contextmanager</span><br><span class="line">def use_money(man):</span><br><span class="line">    try:</span><br><span class="line">        print(man + &#39;ååˆ†æ”¾å¿ƒå¤§èƒ†çš„æå‡ºé’±åŒ…&#39;)</span><br><span class="line">        yield None</span><br><span class="line">        # yieldç”Ÿæˆå™¨ï¼Œè¿è¡Œåˆ°è¿™é‡Œä¼šè¿”å›ä¸€ä¸ªå€¼(ä½ éšä¾¿å†™ä¸€ä¸ªå°±è¡Œ)</span><br><span class="line">    finally:</span><br><span class="line">        print(man + &#39;ä¸‡åˆ†è°¨æ…çš„æ”¶èµ·äº†é’±åŒ…&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with use_money(&#39;shuke03&#39;)as a:</span><br><span class="line">    print(&#39;èŠ±äº†100å—é’±&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿”å›ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shuke03ååˆ†æ”¾å¿ƒå¤§èƒ†çš„æå‡ºé’±åŒ…</span><br><span class="line">èŠ±äº†100å—é’±</span><br><span class="line">shuke03ä¸‡åˆ†è°¨æ…çš„æ”¶èµ·äº†é’±åŒ…</span><br></pre></td></tr></table></figure>
<p>è¿™åªæ˜¯ä¸€ä¸ªåˆ›å»ºä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æ–¹æ³•ï¼ŒæŒ‰ç…§å›ºå®šçš„æ ¼å¼ä¹¦å†™å°±è¡Œ.</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://www.langzi.fun/%E6%B7%B1%E5%85%A5%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1-%E4%B8%8B.html" target="_blank" rel="noopener">æ·±å…¥ç±»ä¸å¯¹è±¡-ä¸‹</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>å®æˆ˜å¸¸ç”¨shellç¼–å†™</title>
    <url>/2020/04/23/%E5%AE%9E%E6%88%98%E5%B8%B8%E7%94%A8shell%E7%BC%96%E5%86%99/</url>
    <content><![CDATA[<h2 id="å®æˆ˜å¸¸ç”¨shellç¼–å†™"><a href="#å®æˆ˜å¸¸ç”¨shellç¼–å†™" class="headerlink" title="å®æˆ˜å¸¸ç”¨shellç¼–å†™"></a>å®æˆ˜å¸¸ç”¨shellç¼–å†™</h2><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol>
<li><p>å¼€å¤´åŠ è§£é‡Šå™¨ï¼š<code>#!/bin/bash</code></p>
</li>
<li><p>è¯­æ³•ç¼©è¿›ï¼Œä½¿ç”¨å››ä¸ªç©ºæ ¼ï¼›å¤šåŠ æ³¨é‡Šè¯´æ˜ã€‚</p>
</li>
<li><p>å‘½åå»ºè®®è§„åˆ™ï¼šå˜é‡åå¤§å†™ã€å±€éƒ¨å˜é‡å°å†™ï¼Œå‡½æ•°åå°å†™ï¼Œåå­—ä½“ç°å‡ºå®é™…ä½œç”¨ã€‚</p>
</li>
<li><p>é»˜è®¤å˜é‡æ˜¯å…¨å±€çš„ï¼Œåœ¨å‡½æ•°ä¸­å˜é‡localæŒ‡å®šä¸ºå±€éƒ¨å˜é‡ï¼Œé¿å…æ±¡æŸ“å…¶ä»–ä½œç”¨åŸŸã€‚</p>
</li>
<li><p>æœ‰ä¸¤ä¸ªå‘½ä»¤èƒ½å¸®åŠ©æˆ‘è°ƒè¯•è„šæœ¬ï¼šset -e é‡åˆ°æ‰§è¡Œé0æ—¶é€€å‡ºè„šæœ¬ï¼Œset-x æ‰“å°æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
</li>
<li><p>å†™è„šæœ¬ä¸€å®šå…ˆæµ‹è¯•å†åˆ°ç”Ÿäº§ä¸Šã€‚</p>
</li>
<li><p>è·å–éšæœºå­—ç¬¦ä¸²æˆ–æ•°å­—<br>è·å–éšæœº8ä½å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼š</span><br><span class="line"># echo $RANDOM |md5sum |cut -c 1-8</span><br><span class="line">471b94f2</span><br><span class="line">æ–¹æ³•2ï¼š</span><br><span class="line"># openssl rand -base64 4</span><br><span class="line">vg3BEg&#x3D;&#x3D;</span><br><span class="line">æ–¹æ³•3ï¼š</span><br><span class="line"># cat &#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;random&#x2F;uuid |cut -c 1-8</span><br><span class="line">ed9e032c</span><br></pre></td></tr></table></figure>
<p>è·å–éšæœº8ä½æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼š</span><br><span class="line"># echo $RANDOM |cksum |cut -c 1-8</span><br><span class="line">23648321</span><br><span class="line">æ–¹æ³•2ï¼š</span><br><span class="line"># openssl rand -base64 4 |cksum |cut -c 1-8</span><br><span class="line">38571131</span><br><span class="line">æ–¹æ³•3ï¼š</span><br><span class="line"># date +%N |cut -c 1-8</span><br><span class="line">69024815</span><br></pre></td></tr></table></figure>
<p>cksumï¼šæ‰“å°CRCæ•ˆéªŒå’Œç»Ÿè®¡å­—èŠ‚</p>
</li>
<li><p>å®šä¹‰ä¸€ä¸ªé¢œè‰²è¾“å‡ºå­—ç¬¦ä¸²å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼š</span><br><span class="line">function echo_color() &#123;</span><br><span class="line">    if [ $1 &#x3D;&#x3D; &quot;green&quot; ]; then</span><br><span class="line">        echo -e &quot;[32;40m$2[0m&quot;</span><br><span class="line">    elif [ $1 &#x3D;&#x3D; &quot;red&quot; ]; then</span><br><span class="line">        echo -e &quot;[31;40m$2[0m&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">æ–¹æ³•2ï¼š</span><br><span class="line">function echo_color() &#123;</span><br><span class="line">    case $1 in</span><br><span class="line">        green)</span><br><span class="line">            echo -e &quot;[32;40m$2[0m&quot;</span><br><span class="line">            ;;</span><br><span class="line">        red)</span><br><span class="line">            echo -e &quot;[31;40m$2[0m&quot; </span><br><span class="line">            ;;</span><br><span class="line">        *) </span><br><span class="line">            echo &quot;Example: echo_color red string&quot;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line">ä½¿ç”¨æ–¹æ³•ï¼šecho_color green &quot;test&quot;</span><br></pre></td></tr></table></figure>
<p>functionå…³é”®å­—å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯åŠ æˆ–ä¸åŠ ã€‚</p>
</li>
<li><p>æ‰¹é‡åˆ›å»ºç”¨æˆ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">DATE&#x3D;$(date +%F_%T)</span><br><span class="line">USER_FILE&#x3D;user.txt</span><br><span class="line">echo_color()&#123;</span><br><span class="line">    if [ $1 &#x3D;&#x3D; &quot;green&quot; ]; then</span><br><span class="line">        echo -e &quot;[32;40m$2[0m&quot;</span><br><span class="line">    elif [ $1 &#x3D;&#x3D; &quot;red&quot; ]; then</span><br><span class="line">        echo -e &quot;[31;40m$2[0m&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"># å¦‚æœç”¨æˆ·æ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¤§å°å¤§äº0å°±å¤‡ä»½</span><br><span class="line">if [ -s $USER_FILE ]; then</span><br><span class="line">    mv $USER_FILE $&#123;USER_FILE&#125;-$&#123;DATE&#125;.bak</span><br><span class="line">    echo_color green &quot;$USER_FILE exist, rename $&#123;USER_FILE&#125;-$&#123;DATE&#125;.bak&quot;</span><br><span class="line">fi</span><br><span class="line">echo -e &quot;User	Password&quot; &gt;&gt; $USER_FILE</span><br><span class="line">echo &quot;----------------&quot; &gt;&gt; $USER_FILE</span><br><span class="line">for USER in user&#123;1..10&#125;; do</span><br><span class="line">    if ! id $USER &amp;&gt;&#x2F;dev&#x2F;null; then</span><br><span class="line">        PASS&#x3D;$(echo $RANDOM |md5sum |cut -c 1-8)</span><br><span class="line">        useradd $USER</span><br><span class="line">        echo $PASS |passwd --stdin $USER &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">        echo -e &quot;$USER	$PASS&quot; &gt;&gt; $USER_FILE</span><br><span class="line">        echo &quot;$USER User create successful.&quot;</span><br><span class="line">    else</span><br><span class="line">        echo_color red &quot;$USER User already exists!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li><p>æ£€æŸ¥è½¯ä»¶åŒ…æ˜¯å¦å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">if rpm -q sysstat &amp;&gt;&#x2F;dev&#x2F;null; then</span><br><span class="line">    echo &quot;sysstat is already installed.&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;sysstat is not installed!&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ£€æŸ¥æœåŠ¡çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">PORT_C&#x3D;$(ss -anu |grep -c 123)</span><br><span class="line">PS_C&#x3D;$(ps -ef |grep ntpd |grep -vc grep)</span><br><span class="line">if [ $PORT_C -eq 0 -o $PS_C -eq 0 ]; then</span><br><span class="line">    echo &quot;å†…å®¹&quot; | mail -s &quot;ä¸»é¢˜&quot; dst@example.com</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ£€æŸ¥ä¸»æœºå­˜æ´»çŠ¶æ€<br>æ–¹æ³•1ï¼šå°†é”™è¯¯IPæ”¾åˆ°æ•°ç»„é‡Œé¢åˆ¤æ–­æ˜¯å¦pingå¤±è´¥ä¸‰æ¬¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">IP_LIST&#x3D;&quot;192.168.18.1 192.168.1.1 192.168.18.2&quot;</span><br><span class="line">for IP in $IP_LIST; do</span><br><span class="line">    NUM&#x3D;1</span><br><span class="line">    while [ $NUM -le 3 ]; do</span><br><span class="line">        if ping -c 1 $IP &gt; &#x2F;dev&#x2F;null; then</span><br><span class="line">            echo &quot;$IP Ping is successful.&quot;</span><br><span class="line">            break</span><br><span class="line">        else</span><br><span class="line">            # echo &quot;$IP Ping is failure $NUM&quot;</span><br><span class="line">            FAIL_COUNT[$NUM]&#x3D;$IP</span><br><span class="line">            let NUM++</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    if [ $&#123;#FAIL_COUNT[*]&#125; -eq 3 ];then</span><br><span class="line">        echo &quot;$&#123;FAIL_COUNT[1]&#125; Ping is failure!&quot;</span><br><span class="line">        unset FAIL_COUNT[*]</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•2ï¼šå°†é”™è¯¯æ¬¡æ•°æ”¾åˆ°FAIL_COUNTå˜é‡é‡Œé¢åˆ¤æ–­æ˜¯å¦pingå¤±è´¥ä¸‰æ¬¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">IP_LIST&#x3D;&quot;192.168.18.1 192.168.1.1 192.168.18.2&quot;</span><br><span class="line">for IP in $IP_LIST; do</span><br><span class="line">    FAIL_COUNT&#x3D;0</span><br><span class="line">    for ((i&#x3D;1;i&lt;&#x3D;3;i++)); do</span><br><span class="line">        if ping -c 1 $IP &gt;&#x2F;dev&#x2F;null; then</span><br><span class="line">            echo &quot;$IP Ping is successful.&quot;</span><br><span class="line">            break</span><br><span class="line">        else</span><br><span class="line">            # echo &quot;$IP Ping is failure $i&quot;</span><br><span class="line">            let FAIL_COUNT++</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    if [ $FAIL_COUNT -eq 3 ]; then</span><br><span class="line">        echo &quot;$IP Ping is failure!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•3ï¼šåˆ©ç”¨forå¾ªç¯å°†pingé€šå°±è·³å‡ºå¾ªç¯ç»§ç»­ï¼Œå¦‚æœä¸è·³å‡ºå°±ä¼šèµ°åˆ°æ‰“å°pingå¤±è´¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">ping_success_status() &#123;</span><br><span class="line">    if ping -c 1 $IP &gt;&#x2F;dev&#x2F;null; then</span><br><span class="line">        echo &quot;$IP Ping is successful.&quot;</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">IP_LIST&#x3D;&quot;192.168.18.1 192.168.1.1 192.168.18.2&quot;</span><br><span class="line">for IP in $IP_LIST; do</span><br><span class="line">    ping_success_status</span><br><span class="line">    ping_success_status</span><br><span class="line">    ping_success_status</span><br><span class="line">    echo &quot;$IP Ping is failure!&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li><p>ç›‘æ§CPUã€å†…å­˜å’Œç¡¬ç›˜åˆ©ç”¨ç‡</p>
</li>
</ol>
<ul>
<li>CPU<br>å€ŸåŠ©vmstatå·¥å…·æ¥åˆ†æCPUç»Ÿè®¡ä¿¡æ¯ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">DATE&#x3D;$(date +%F&quot; &quot;%H:%M)</span><br><span class="line">IP&#x3D;$(ifconfig eth0 |awk -F  [ :]+   &#x2F;inet addr&#x2F;&#123;print $4&#125; )  # åªæ”¯æŒCentOS6</span><br><span class="line">MAIL&#x3D;&quot;example@mail.com&quot;</span><br><span class="line">if ! which vmstat &amp;&gt;&#x2F;dev&#x2F;null; then</span><br><span class="line">    echo &quot;vmstat command no found, Please install procps package.&quot; </span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">US&#x3D;$(vmstat |awk  NR&#x3D;&#x3D;3&#123;print $13&#125; )</span><br><span class="line">SY&#x3D;$(vmstat |awk  NR&#x3D;&#x3D;3&#123;print $14&#125; )</span><br><span class="line">IDLE&#x3D;$(vmstat |awk  NR&#x3D;&#x3D;3&#123;print $15&#125; )</span><br><span class="line">WAIT&#x3D;$(vmstat |awk  NR&#x3D;&#x3D;3&#123;print $16&#125; )</span><br><span class="line">USE&#x3D;$(($US+$SY))</span><br><span class="line">if [ $USE -ge 50 ]; then</span><br><span class="line">    echo &quot;</span><br><span class="line">    Date: $DATE</span><br><span class="line">    Host: $IP</span><br><span class="line">    Problem: CPU utilization $USE</span><br><span class="line">    &quot; | mail -s &quot;CPU Monitor&quot; $MAIL</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
<li>memory<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">DATE&#x3D;$(date +%F&quot; &quot;%H:%M)</span><br><span class="line">IP&#x3D;$(ifconfig eth0 |awk -F  [ :]+   &#x2F;inet addr&#x2F;&#123;print $4&#125; )  </span><br><span class="line">MAIL&#x3D;&quot;example@mail.com&quot;</span><br><span class="line">TOTAL&#x3D;$(free -m |awk  &#x2F;Mem&#x2F;&#123;print $2&#125; )</span><br><span class="line">USE&#x3D;$(free -m |awk  &#x2F;Mem&#x2F;&#123;print $3-$6-$7&#125; )</span><br><span class="line">FREE&#x3D;$(($TOTAL-$USE))</span><br><span class="line"># å†…å­˜å°äº1Gå‘é€æŠ¥è­¦é‚®ä»¶</span><br><span class="line">if [ $FREE -lt 1024 ]; then</span><br><span class="line">    echo &quot;</span><br><span class="line">    Date: $DATE</span><br><span class="line">    Host: $IP</span><br><span class="line">    Problem: Total&#x3D;$TOTAL,Use&#x3D;$USE,Free&#x3D;$FREE</span><br><span class="line">    &quot; | mail -s &quot;Memory Monitor&quot; $MAIL</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
<li>Disk<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">DATE&#x3D;$(date +%F&quot; &quot;%H:%M)</span><br><span class="line">IP&#x3D;$(ifconfig eth0 |awk -F  [ :]+   &#x2F;inet addr&#x2F;&#123;print $4&#125; )  </span><br><span class="line">MAIL&#x3D;&quot;example@mail.com&quot;</span><br><span class="line">TOTAL&#x3D;$(fdisk -l |awk -F [: ]+   BEGIN&#123;OFS&#x3D;&quot;&#x3D;&quot;&#125;&#x2F;^Disk &#x2F;dev&#x2F;&#123;printf &quot;%s&#x3D;%sG,&quot;,$2,$3&#125; )</span><br><span class="line">PART_USE&#x3D;$(df -h |awk  BEGIN&#123;OFS&#x3D;&quot;&#x3D;&quot;&#125;&#x2F;^&#x2F;dev&#x2F;&#123;print $1,int($5),$6&#125; )</span><br><span class="line">for i in $PART_USE; do</span><br><span class="line">    PART&#x3D;$(echo $i |cut -d&quot;&#x3D;&quot; -f1)</span><br><span class="line">    USE&#x3D;$(echo $i |cut -d&quot;&#x3D;&quot; -f2)</span><br><span class="line">    MOUNT&#x3D;$(echo $i |cut -d&quot;&#x3D;&quot; -f3)</span><br><span class="line">    if [ $USE -gt 80 ]; then</span><br><span class="line">        echo &quot;</span><br><span class="line">        Date: $DATE</span><br><span class="line">        Host: $IP</span><br><span class="line">        Total: $TOTAL</span><br><span class="line">        Problem: $PART&#x3D;$USE($MOUNT)</span><br><span class="line">        &quot; | mail -s &quot;Disk Monitor&quot; $MAIL</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="8">
<li>æ‰¹é‡ä¸»æœºç£ç›˜åˆ©ç”¨ç‡ç›‘æ§<br>å‰æç›‘æ§ç«¯å’Œè¢«ç›‘æ§ç«¯SSHå…äº¤äº’ç™»å½•æˆ–è€…å¯†é’¥ç™»å½•ã€‚<br>å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¿å­˜è¢«ç›‘æ§ä¸»æœºSSHè¿æ¥ä¿¡æ¯ï¼Œæ–‡ä»¶å†…å®¹æ ¼å¼ï¼šIP User Port<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">HOST_INFO&#x3D;host.info</span><br><span class="line">for IP in $(awk  &#x2F;^[^#]&#x2F;&#123;print $1&#125;  $HOST_INFO); do</span><br><span class="line">    USER&#x3D;$(awk -v ip&#x3D;$IP  ip&#x3D;&#x3D;$1&#123;print $2&#125;  $HOST_INFO)</span><br><span class="line">    PORT&#x3D;$(awk -v ip&#x3D;$IP  ip&#x3D;&#x3D;$1&#123;print $3&#125;  $HOST_INFO)</span><br><span class="line">    TMP_FILE&#x3D;&#x2F;tmp&#x2F;disk.tmp</span><br><span class="line">    ssh -p $PORT $USER@$IP  df -h  &gt; $TMP_FILE</span><br><span class="line">    USE_RATE_LIST&#x3D;$(awk  BEGIN&#123;OFS&#x3D;&quot;&#x3D;&quot;&#125;&#x2F;^&#x2F;dev&#x2F;&#123;print $1,int($5)&#125;  $TMP_FILE)</span><br><span class="line">    for USE_RATE in $USE_RATE_LIST; do</span><br><span class="line">        PART_NAME&#x3D;$&#123;USE_RATE%&#x3D;*&#125;</span><br><span class="line">        USE_RATE&#x3D;$&#123;USE_RATE#*&#x3D;&#125;</span><br><span class="line">        if [ $USE_RATE -ge 80 ]; then</span><br><span class="line">            echo &quot;Warning: $PART_NAME Partition usage $USE_RATE%!&quot;</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>æ£€æŸ¥ç½‘ç«™å¯ç”¨æ€§</li>
</ol>
<ul>
<li>æ£€æŸ¥URLå¯ç”¨æ€§<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼š</span><br><span class="line">check_url() &#123;</span><br><span class="line">    HTTP_CODE&#x3D;$(curl -o &#x2F;dev&#x2F;null --connect-timeout 3 -s -w &quot;%&#123;http_code&#125;&quot; $1)</span><br><span class="line">    if [ $HTTP_CODE -ne 200 ]; then</span><br><span class="line">        echo &quot;Warning: $1 Access failure!&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">æ–¹æ³•2ï¼š</span><br><span class="line">check_url() &#123;</span><br><span class="line">if ! wget -T 10 --tries&#x3D;1 --spider $1 &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1; then  </span><br><span class="line">#-Tè¶…æ—¶æ—¶é—´ï¼Œ--trieså°è¯•1æ¬¡ï¼Œ--spiderçˆ¬è™«æ¨¡å¼</span><br><span class="line">        echo &quot;Warning: $1 Access failure!&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ä½¿ç”¨æ–¹æ³•ï¼š<code>check_url www.baidu.com</code></li>
<li>åˆ¤æ–­ä¸‰æ¬¡URLå¯ç”¨æ€§<br>æ€è·¯ä¸ä¸Šé¢æ£€æŸ¥ä¸»æœºå­˜æ´»çŠ¶æ€ä¸€æ ·ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•1ï¼šåˆ©ç”¨å¾ªç¯æŠ€å·§ï¼Œå¦‚æœæˆåŠŸå°±è·³å‡ºå½“å‰å¾ªç¯ï¼Œå¦åˆ™æ‰§è¡Œåˆ°æœ€åä¸€è¡Œ</span><br><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">check_url() &#123;</span><br><span class="line">    HTTP_CODE&#x3D;$(curl -o &#x2F;dev&#x2F;null --connect-timeout 3 -s -w &quot;%&#123;http_code&#125;&quot; $1)</span><br><span class="line">    if [ $HTTP_CODE -eq 200 ]; then</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line">URL_LIST&#x3D;&quot;www.baidu.com www.agasgf.com&quot;</span><br><span class="line">for URL in $URL_LIST; do</span><br><span class="line">    check_url $URL</span><br><span class="line">    check_url $URL</span><br><span class="line">    check_url $URL</span><br><span class="line">    echo &quot;Warning: $URL Access failure!&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•2ï¼šé”™è¯¯æ¬¡æ•°ä¿å­˜åˆ°å˜é‡</span><br><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">URL_LIST&#x3D;&quot;www.baidu.com www.agasgf.com&quot;</span><br><span class="line">for URL in $URL_LIST; do</span><br><span class="line">    FAIL_COUNT&#x3D;0</span><br><span class="line">    for ((i&#x3D;1;i&lt;&#x3D;3;i++)); do</span><br><span class="line">        HTTP_CODE&#x3D;$(curl -o &#x2F;dev&#x2F;null --connect-timeout 3 -s -w &quot;%&#123;http_code&#125;&quot; $URL)</span><br><span class="line">        if [ $HTTP_CODE -ne 200 ]; then</span><br><span class="line">            let FAIL_COUNT++</span><br><span class="line">        else</span><br><span class="line">            break</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    if [ $FAIL_COUNT -eq 3 ]; then</span><br><span class="line">        echo &quot;Warning: $URL Access failure!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ–¹æ³•3ï¼šé”™è¯¯æ¬¡æ•°ä¿å­˜åˆ°æ•°ç»„</span><br><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">URL_LIST&#x3D;&quot;www.baidu.com www.agasgf.com&quot;</span><br><span class="line">for URL in $URL_LIST; do</span><br><span class="line">    NUM&#x3D;1</span><br><span class="line">    while [ $NUM -le 3 ]; do</span><br><span class="line">        HTTP_CODE&#x3D;$(curl -o &#x2F;dev&#x2F;null --connect-timeout 3 -s -w &quot;%&#123;http_code&#125;&quot; $URL)</span><br><span class="line">        if [ $HTTP_CODE -ne 200 ]; then</span><br><span class="line">            FAIL_COUNT[$NUM]&#x3D;$IP  #åˆ›å»ºæ•°ç»„ï¼Œä»¥$NUMä¸‹æ ‡ï¼Œ$IPå…ƒç´ </span><br><span class="line">            let NUM++</span><br><span class="line">        else</span><br><span class="line">            break</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">    if [ $&#123;#FAIL_COUNT[*]&#125; -eq 3 ]; then</span><br><span class="line">        echo &quot;Warning: $URL Access failure!&quot;</span><br><span class="line">        unset FAIL_COUNT[*]    #æ¸…ç©ºæ•°ç»„</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="10">
<li>æ£€æŸ¥MySQLä¸»ä»åŒæ­¥çŠ¶æ€<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash  </span><br><span class="line">USER&#x3D;bak</span><br><span class="line">PASSWD&#x3D;123456</span><br><span class="line">IO_SQL_STATUS&#x3D;$(mysql -u$USER -p$PASSWD -e  show slave statusG  |awk -F:  &#x2F;Slave_.*_Running&#x2F;&#123;gsub(&quot;: &quot;,&quot;:&quot;);print $0&#125; )  #gsubå»é™¤å†’å·åé¢çš„ç©ºæ ¼</span><br><span class="line">for i in $IO_SQL_STATUS; do</span><br><span class="line">    THREAD_STATUS_NAME&#x3D;$&#123;i%:*&#125;</span><br><span class="line">    THREAD_STATUS&#x3D;$&#123;i#*:&#125;</span><br><span class="line">    if [ &quot;$THREAD_STATUS&quot; !&#x3D; &quot;Yes&quot; ]; then</span><br><span class="line">        echo &quot;Error: MySQL Master-Slave $THREAD_STATUS_NAME status is $THREAD_STATUS!&quot;</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»´æŠ¤JAVAè„šæœ¬</title>
    <url>/2020/04/23/%E7%BB%B4%E6%8A%A4JAVA%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<h3 id="ç»´æŠ¤JAVAè„šæœ¬"><a href="#ç»´æŠ¤JAVAè„šæœ¬" class="headerlink" title="ç»´æŠ¤JAVAè„šæœ¬"></a>ç»´æŠ¤JAVAè„šæœ¬</h3><p>start_env.sh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">CURRENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; pwd)</span><br><span class="line">PARENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; cd ..; pwd)</span><br><span class="line">CURRENT_SERVICE_NAME&#x3D;$(echo $&#123;CURRENT_PATH&#125; | awk -F &#39;&#x2F;&#39; &#39;&#123;print $(NF)&#125;&#39;)</span><br><span class="line"></span><br><span class="line"># USE THOSE VARIABLE</span><br><span class="line">GC_LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs&#x2F;$&#123;CURRENT_SERVICE_NAME&#125;-gcdetail.log</span><br><span class="line">COMMON_CONFIG_PATH&#x3D;$&#123;PARENT_PATH&#125;</span><br><span class="line">CONFIG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;config</span><br><span class="line">JAR_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;jar</span><br><span class="line">LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs</span><br><span class="line"></span><br><span class="line">## MODIFY FOLLOWING LINES</span><br><span class="line">EXECUT_JAR&#x3D;&quot;america-business-auth-impl-1.0-SNAPSHOT-all.jar&quot;</span><br><span class="line">DUBBO_PARAMETER&#x3D;&quot;</span><br><span class="line">-Dapp.id&#x3D;america-business-auth</span><br><span class="line">-Xdebug</span><br><span class="line">-server</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line">-Xnoagent</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:NewRatio&#x3D;2</span><br><span class="line">-XX:SurvivorRatio&#x3D;8</span><br><span class="line">-XX:MetaspaceSize&#x3D;128m</span><br><span class="line">-XX:MaxMetaspaceSize&#x3D;128m</span><br><span class="line">-Xloggc:$&#123;GC_LOG_PATH&#125;</span><br><span class="line">-Ddubbo.registry.file&#x3D;$&#123;JAR_PATH&#125;&#x2F;dubbo.cache</span><br><span class="line">-Dconfig.path&#x3D;file:$&#123;COMMON_CONFIG_PATH&#125;&#x2F;common.properties;file:$&#123;CONFIG_PATH&#125;&#x2F;config.properties</span><br><span class="line">$&#123;JAR_PATH&#125;&#x2F;$&#123;EXECUT_JAR&#125;</span><br><span class="line">&quot;</span><br><span class="line">## STOP MODIFY</span><br><span class="line"></span><br><span class="line">java -jar $&#123;DUBBO_PARAMETER&#125; | &#x2F;usr&#x2F;bin&#x2F;cronolog $LOG_PATH&#x2F;out.%Y%m%d.nohup &gt;&gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>service_control.sh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">#set -x</span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line"># USE THOSE VARIABLE</span><br><span class="line">CURRENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; pwd)</span><br><span class="line">PARENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; cd ..; pwd)</span><br><span class="line">CURRENT_SERVICE_NAME&#x3D;$(echo $&#123;CURRENT_PATH&#125; | awk -F &#39;&#x2F;&#39; &#39;&#123;print $(NF)&#125;&#39;)</span><br><span class="line">STOP_WAIT_TIME&#x3D;10</span><br><span class="line">CURRENT_TIME&#x3D;&#96;date +%Y%m%d-%H%M%S&#96;</span><br><span class="line"></span><br><span class="line">DUMP_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;dump</span><br><span class="line">LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log() &#123;</span><br><span class="line">    echo &quot;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;): $1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exit_status() &#123;</span><br><span class="line">    if [ $? &#x3D;&#x3D; 0 ]</span><br><span class="line">    then</span><br><span class="line">        echo -e &quot;\\033[1;32m[OK]\\033[0;39m&quot;</span><br><span class="line">    else</span><br><span class="line">        echo -e &quot;\\033[1;31m[Failed]\\033[0;39m&quot;</span><br><span class="line">        log &quot;Error&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_user() &#123;</span><br><span class="line">    if [ &#96;whoami&#96; !&#x3D; &quot;app&quot; || &#96;whoami&#96; !&#x3D; &quot;root&quot; ]; then</span><br><span class="line">        log &quot;Please use app user to run this command.&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop_service() &#123;</span><br><span class="line"></span><br><span class="line">    log &quot;Stop Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 1 ]</span><br><span class="line">    then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; run more than one process&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">    if [ x$Service_PID &#x3D;&#x3D; x ];then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; process is NOT exist&quot;</span><br><span class="line">        exit_status</span><br><span class="line">    else</span><br><span class="line">        log &quot;KILL Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">        kill  $Service_PID</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    log &quot;Search Service Process ...&quot;</span><br><span class="line">    Check&#x3D;N</span><br><span class="line">    N&#x3D;0</span><br><span class="line">    while [ $Check &#x3D;&#x3D; &quot;N&quot; ]</span><br><span class="line">    do</span><br><span class="line">        N&#x3D;$(($N+1))</span><br><span class="line">        Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line"></span><br><span class="line">        if [ &quot;$Service_PID&quot; &#x3D; &quot;&quot; ]</span><br><span class="line">        then</span><br><span class="line">            log &quot;Not found Service PID alive&quot;</span><br><span class="line">            break</span><br><span class="line">        else</span><br><span class="line">            log &quot;$N: Check Service PID:$Service_PID, Sleep 1 Sec Wait Service Exit ...&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        if [ $((N)) -gt $STOP_WAIT_TIME ]</span><br><span class="line">        then</span><br><span class="line">            log &quot;Force KILL Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">            #jstack $Service_PID &gt;&gt; &#x2F;var&#x2F;log&#x2F;jstack.log</span><br><span class="line">            #skill -9 $Service_PID</span><br><span class="line">            kill -9 $Service_PID</span><br><span class="line">            exit_status</span><br><span class="line">            break</span><br><span class="line">        fi</span><br><span class="line">        sleep 1</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start_service() &#123;</span><br><span class="line"></span><br><span class="line">    log &quot;Start Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F; | grep -v grep |grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 0 ]</span><br><span class="line">    then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; already running&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if [ ! -d $LOG_PATH ]; then</span><br><span class="line">        mkdir -p $LOG_PATH</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    nohup &#x2F;bin&#x2F;bash $CURRENT_PATH&#x2F;start_env.sh &amp;&gt;&gt; &#x2F;dev&#x2F;null &amp;</span><br><span class="line"></span><br><span class="line">    #exit_status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">status() &#123;</span><br><span class="line"></span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 1 ]</span><br><span class="line">    then</span><br><span class="line">        echo &quot;Service run more than one process,please check&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">    if [ x$Service_PID &#x3D;&#x3D; x ];then</span><br><span class="line">        echo &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; process is NOT exist&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    else</span><br><span class="line">        Service_startTime&#x3D;&#96;ps -p $&#123;Service_PID&#125; -o lstart|grep -v &quot;START&quot;&#96;</span><br><span class="line">        echo -e &quot;service: $&#123;CURRENT_SERVICE_NAME&#125; started,\npid: $&#123;Service_PID&#125;,\nstartTime: $&#123;Service_startTime&#125;,\nlogPath: $&#123;LOG_PATH&#125;&#x2F;out.&#96;date +%Y%m%d&#96;.nohup&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dump() &#123;</span><br><span class="line">    if [ ! -d $DUMP_PATH ]; then</span><br><span class="line">        mkdir -p $DUMP_PATH</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo -e &quot;Dumping the $&#123;CURRENT_SERVICE_NAME&#125; ...\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstack $Service_PID &gt; $DUMP_PATH&#x2F;jstack-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jinfo $Service_PID &gt; $DUMP_PATH&#x2F;jinfo-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstat -gcutil $Service_PID &gt; $DUMP_PATH&#x2F;jstat-gcutil-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstat -gccapacity $Service_PID &gt; $DUMP_PATH&#x2F;jstat-gccapacity-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap $Service_PID &gt; $DUMP_PATH&#x2F;jmap-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap -heap $Service_PID &gt; $DUMP_PATH&#x2F;jmap-heap-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap -histo $Service_PID &gt; $DUMP_PATH&#x2F;jmap-histo-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    if [ -r &#x2F;usr&#x2F;sbin&#x2F;lsof ]; then</span><br><span class="line">    &#x2F;usr&#x2F;sbin&#x2F;lsof -p $Service_PID &gt; $DUMP_PATH&#x2F;lsof-$Service_PID.$&#123;CURRENT_TIME&#125;.dump</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    fi</span><br><span class="line">    echo -e &quot;\nDump Complete, files in $&#123;DUMP_PATH&#125;\n&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tail_log() &#123;</span><br><span class="line">    if [ ! -n &quot;$1&quot; ] ; then</span><br><span class="line">        tail_num&#x3D;10</span><br><span class="line">    else</span><br><span class="line">        tail_num&#x3D;$1</span><br><span class="line">    fi</span><br><span class="line">    tail -$&#123;tail_num&#125;f $&#123;LOG_PATH&#125;&#x2F;out.&#96;date +%Y%m%d&#96;.nohup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">help() &#123;</span><br><span class="line">    echo &quot;USAGE: $0 &#123;stop|start|restart|status|dump|log [tail line of numbers:200]|help&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ $# -gt 0 ] ; then</span><br><span class="line"></span><br><span class="line">    case $1 in</span><br><span class="line">    start)</span><br><span class="line">        log &quot;Will Start Service ...&quot;</span><br><span class="line">        start_service</span><br><span class="line">        log &quot;Sleep 3 Sec for Status ...&quot;</span><br><span class="line">        sleep 3</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        log &quot;Will Stop Service ...&quot;</span><br><span class="line">        stop_service</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        log &quot;Will Restart Service ...&quot;</span><br><span class="line"></span><br><span class="line">        stop_service</span><br><span class="line">        log &quot;Sleep 3 Sec&quot;</span><br><span class="line">        sleep 3</span><br><span class="line"></span><br><span class="line">        start_service</span><br><span class="line">        log &quot;Sleep 3 Sec for Status ...&quot;</span><br><span class="line">        sleep 3</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    dump)</span><br><span class="line">        check_user</span><br><span class="line">        status</span><br><span class="line">        if [ $? &#x3D;&#x3D; 0 ]</span><br><span class="line">        then</span><br><span class="line">            dump</span><br><span class="line">        else</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        ;;</span><br><span class="line">    log)</span><br><span class="line">        tail_log $2</span><br><span class="line">        ;;</span><br><span class="line">    help)</span><br><span class="line">        help</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Bad Parameter: $1&quot;</span><br><span class="line">        help</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    help</span><br><span class="line">    exit 1;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JAVA</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›pythonç›¸å…³çš„çŸ¥è¯†ç‚¹æ•´ç†</title>
    <url>/2020/04/23/%E4%B8%80%E4%BA%9Bpython%E7%9B%B8%E5%85%B3%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<h3 id="djangoç›¸å…³"><a href="#djangoç›¸å…³" class="headerlink" title="djangoç›¸å…³"></a>djangoç›¸å…³</h3><ol>
<li><p>ä¸­é—´ä»¶<br>ä¸­é—´ä»¶ä¸€èˆ¬åšè®¤è¯æˆ–æ‰¹é‡è¯·æ±‚å¤„ç†ï¼Œdjangoä¸­çš„ä¸­é—´ä»¶ï¼Œå…¶å®æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨è¯·æ±‚å’Œç»“æŸåï¼Œdjangoä¼šæ ¹æ®è‡ªå·±çš„è§„åˆ™åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œä¸­é—´ä»¶ä¸­ç›¸åº”çš„æ–¹æ³•ï¼Œ<br>å¦‚è¯·æ±‚è¿‡æ¥ æ‰§è¡Œprocess_request, viewï¼Œprocess_responseæ–¹æ³•</p>
</li>
<li><p>Djangoã€Tornadoã€Flaskå„è‡ªçš„ä¼˜åŠ¿<br>Djangoï¼šDjangoæ— socketï¼Œdjangoçš„ç›®çš„æ˜¯ç®€ä¾¿ï¼Œå¿«é€Ÿå¼€å‘ï¼Œå¹¶éµå¾ªMVCè®¾è®¡ï¼Œå¤šä¸ªç»„ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»¥â€œæ’ä»¶â€å½¢å¼æœåŠ¡äºæ•´ä¸ªæ¡†æ¶ï¼Œ<br>djangoæœ‰è®¸å¤šåŠŸèƒ½å¼ºå¤§çš„ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚djangoå…·æœ‰å¾ˆå¼ºçš„å¯æ‰©å±•æ€§ã€‚<br>Tornadoï¼šå®ƒæ˜¯éé˜»å¡å¼æœåŠ¡å™¨ï¼Œè€Œä¸”é€Ÿåº¦ç›¸å½“å¿«ï¼Œå¾—åŠ›äºå…¶ éé˜»å¡çš„æ–¹å¼å’Œå¯¹epollçš„è¿ç”¨ï¼ŒFutureå¯¹è±¡ï¼Œç¼ºç‚¹ï¼šæ²¡æœ‰sessionï¼Œéœ€è¦è‡ªå®šåˆ¶<br>Flaskï¼šæ˜¯ä¸€ä¸ªå¾®å‹çš„webæ¡†æ¶ï¼Œé…åˆSQLALchemyæ¥ä½¿ç”¨ï¼Œjinja2æ¨¡æ¿ï¼Œ werkzeugæ¥å£                  </p>
</li>
<li><p>djangoç‰ˆæœ¬ï¼ŒPythonç‰ˆæœ¬ï¼Œlinuxç‰ˆæœ¬<br>djangoï¼š1.11<br>Pythonï¼š3.5<br>linuxï¼š6.8</p>
</li>
<li><p>djangoçš„templateçš„æ³¨é‡Šæ˜¯ä»€ä¹ˆæ ·å­çš„<br>å•è¡Œï¼š<br>å¤šè¡Œæ³¨é‡Šï¼š&#123;%comment%&#123;&#123;</p>
</li>
<li><p>djangoæ€ä¹ˆå¼„å¹¶å‘çš„<br>nginx+uwsigä¸ºdjangoæä¾›é«˜å¹¶å‘ï¼Œnginxçš„å¹¶å‘èƒ½åŠ›è¶…è¿‡ï¼Œå•å°å¹¶å‘èƒ½åŠ›è¿‡å®Œï¼Œåœ¨çº¯é™æ€çš„webæœåŠ¡ä¸­æ›´æ˜¯çªå‡ºå…¶ä¼˜è¶Šçš„åœ°æ–¹ï¼Œç”±äºåº•å±‚ä½¿ç”¨epollå¼‚æ­¥IOæ¨¡å‹è¿›è¡Œå¤„ç†ã€‚</p>
</li>
<li><p>tornodoçš„ioloopçŸ¥é“æ˜¯ä»€ä¹ˆå—ï¼Ÿ<br>äº‹ä»¶å¾ªç¯</p>
</li>
<li><p>select_relatedå’Œprefetch_relatedï¼ŒQå’ŒF<br>select_relatedï¼šä¸€å¯¹å¤šä½¿ç”¨ï¼ŒæŸ¥è¯¢ä¸»åŠ¨åšè¿è¡¨<br>prefetch_relatedï¼šå¤šå¯¹å¤šæˆ–è€…ä¸€å¯¹å¤šçš„æ—¶å€™ä½¿ç”¨ï¼Œä¸åšè¿è¡¨ï¼Œåšå¤šæ¬¡æŸ¥è¯¢<br>Qï¼šç”¨äºæ„é€ å¤æ‚æŸ¥è¯¢æ¡ä»¶<br>Fï¼šæ›´æ–°æ—¶ç”¨äºè·å–åŸæ¥çš„å€¼ï¼Œä¸“é—¨å–å¯¹è±¡ä¸­æŸä¸€åˆ—è¿›è¡Œæ“ä½œ</p>
</li>
<li><p>ä»€ä¹ˆæ˜¯ORMï¼Ÿ<br>ORMï¼Œå³Object-Relational Mappingï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨å…³ç³»å‹æ•°æ®åº“å’Œä¸šåŠ¡å®ä½“å¯¹è±¡ä¹‹é—´åšä¸€ä¸ªæ˜ å°„<br>ORMä¼˜ç¼ºç‚¹ï¼š<br>ä¼˜ç‚¹ï¼šæ‘†è„±å¤æ‚çš„SQLæ“ä½œï¼Œé€‚åº”å¿«é€Ÿå¼€å‘ï¼Œè®©æ•°æ®ç»“æœå˜å¾—ç®€å•ï¼Œæ•°æ®åº“è¿ç§»æˆæœ¬æ›´ä½<br>ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚ç”¨äºå¤§å‹åº”ç”¨ï¼Œå¤æ‚çš„SQLæ“ä½œè¿˜éœ€è¦é€šè¿‡SQLè¯­å¥å®ç°</p>
</li>
<li><p>CORSè·¨åŸŸèµ„æºå…±äº«<br>é¦–å…ˆä¼šå‘é€â€é¢„æ£€â€opptionâ€ï¼Œè¯·æ±‚ï¼Œå¦‚æœâ€é¢„æ£€â€æˆåŠŸï¼Œåˆ™å‘é€çœŸå®æ•°æ®ã€‚</p>
</li>
<li><p>Djangoçš„Formä¸»è¦å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼Ÿ<br>ç”ŸæˆHTMlæ ‡ç­¾ï¼ŒéªŒè¯ç”¨æˆ·æ•°æ® is_vaildï¼ŒHTML Formæäº¤ä¿ç•™ä¸Šæ¬¡æäº¤æ•°æ®ï¼Œåˆå§‹åŒ–é¡µé¢æ˜¾ç¤ºå†…å®¹</p>
</li>
<li><p>CBVå’ŒFBV<br>CBVåœ¨æŒ‡å®šçš„ç±»ä¸Šé¢åŠ ä¸Šè£…é¥°å™¨æˆ–åœ¨æ­¤æ–¹æ³•ä¸Šé¢æ·»åŠ è£…é¥°å™¨ @method_decorator,å¹¶ç»§æ‰¿view</p>
</li>
<li><p>cookieåŠsession<br>cookieï¼šæ˜¯ä¿ç•™åœ¨å®¢æˆ·ç«¯ä¸Šé¢çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œcookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookie<br>sessionï¼šæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šé¢çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä¾èµ–ä¸cookieï¼Œå®‰å…¨æŒ‡æ•°æ¯”cookieé«˜</p>
</li>
<li><p>djangoçš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ<br>è¯·æ±‚æ¥äº†å…ˆåˆ°uwsgiï¼ŒæŠŠè¯·æ±‚åšä¸€éƒ¨åˆ†åˆ†è£…ç»™djangoæ¡†æ¶ï¼Œç„¶åç»è¿‡æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼Œè·¯ç”±ï¼Œè§†å›¾ï¼Œè§†å›¾å¤„ç†å†è¿”å›ç»™ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶åœ¨è¿”å›ç»™uwsgiï¼Œåœ¨è¿”å›ç»™ç”¨æˆ·ã€‚</p>
</li>
<li><p>uwsgiå’Œwsgi<br>wsgiï¼šæ˜¯webæœåŠ¡å™¨ç½‘å…³æ¥å£ï¼Œæ˜¯pyhtonåº”ç”¨ç¨‹åºæˆ–æ¡†æ¶å’ŒwebæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§æ¥å£ï¼Œå…¶å¹¿æ³›ä½¿ç”¨çš„æ˜¯djangoæ¡†æ¶ã€‚<br>uwsgiï¼šæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®ƒå®ç°äº†wsgiåè®®ï¼ŒNginxä¸­HttpUwsgiModuleçš„ä½œç”¨æ˜¯ä¸UwsgiæœåŠ¡å™¨è¿›è¡Œäº¤æ¢</p>
</li>
<li><p>è§£é‡Šä¸‹django - debug -toolbarçš„ä½¿ç”¨<br>ä½¿ç”¨djangoå¼€å‘ç«™ç‚¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨django-debug-toolbaræ¥è¿›è¡Œè°ƒè¯•ï¼Œåœ¨settings.pyä¸­æ·»åŠ  â€˜debugâ€”toolbar.midleware.Debug ToolbarMiddlewareâ€™åˆ°é¡¹ç›®çš„MIDDLEWARE_CLASSESå†…ã€‚</p>
</li>
</ol>
<h3 id="Pythonéƒ¨åˆ†"><a href="#Pythonéƒ¨åˆ†" class="headerlink" title="Pythonéƒ¨åˆ†"></a>Pythonéƒ¨åˆ†</h3><ol>
<li><p><strong>new</strong>.<strong>init</strong>åŒºåˆ«ï¼Œå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Œæœ‰ä»€ä¹ˆä¼˜ç‚¹<br><strong>new</strong>æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œ<strong>init</strong>æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•<br><strong>new</strong>è¿”å›ä¸€ä¸ªåˆ›å»ºçš„å®ä¾‹ï¼Œ<strong>init</strong>ä»€ä¹ˆéƒ½ä¸è¿”å›<br><strong>new</strong>è¿”å›ä¸€ä¸ªclsçš„å®ä¾‹æ—¶åé¢çš„<strong>init</strong>æ‰èƒ½è¢«è°ƒç”¨<br>å½“åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ—¶è°ƒç”¨<strong>new</strong>ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹æ—¶è°ƒç”¨<strong>init</strong></p>
</li>
<li><p>æ·±æµ…æ‹·è´<br>æµ…æ‹·è´åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå­˜åœ¨çš„åœ°å€ï¼Œè€Œæ·±æ‹·è´æ˜¯å¢åŠ ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”å¼€è¾Ÿäº†æ–°çš„å†…å­˜ï¼Œè¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜ï¼Œ<br>é‡‡ç”¨æµ…æ‹·è´çš„æƒ…å†µï¼Œé‡Šæ”¾å†…å­˜ï¼Œä¼šé‡Šæ”¾åŒä¸€å†…å­˜ï¼Œæ·±æ‹·è´å°±ä¸ä¼šå‡ºç°é‡Šæ”¾åŒä¸€å†…å­˜çš„é”™è¯¯</p>
</li>
<li><p>HTTP/IPç›¸å…³åè®®ï¼Œåˆ†åˆ«ä½äºå“ªå±‚<br>httpåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œhttpåè®®æ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®<br>httpåè®®å·¥ä½œä¸c/sæ¶æ„ä¸Šï¼Œæµè§ˆå™¨ä½œä¸ºhttpçš„å®¢æˆ·ç«¯é€šè¿‡URLå‘httpæœåŠ¡ç«¯å³webæœåŠ¡å™¨å‘é€æ‰€ç”¨è¯·æ±‚ã€‚webæœåŠ¡å™¨æ”¶åˆ°æ‰€æœ‰è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ï¼Œ<br>httpç‰¹ç‚¹æ˜¯çŸ­è¿æ¥ï¼Œæ— çŠ¶æ€<br>åœ°å€æ é”®è¾“å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åç»å†äº†ä»€ä¹ˆï¼Ÿ</p>
</li>
<li><p>æµè§ˆå™¨å‘DNSæœåŠ¡å™¨è¯·æ±‚è§£æè¯¥URLä¸­çš„åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€</p>
</li>
<li><p>è§£æå‡ºIPåœ°å€åï¼Œæ ¹æ®IPåœ°å€å’Œé»˜è®¤ç«¯å£80ï¼Œå’ŒæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥</p>
</li>
<li><p>æµè§ˆå™¨å‘å‡ºè¯»å–æ–‡ä»¶çš„httpè¯·æ±‚ï¼Œè¯¥è¯·æ±‚æŠ¥æ–‡ä½œä¸ºTCPä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡çš„æ•°æ®å‘é€ç»™æœåŠ¡å™¨</p>
</li>
<li><p>æœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚åšå‡ºå“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„htmlæ–‡ä»¶å‘é€ç»™æµè§ˆå™¨</p>
</li>
<li><p>é‡Šæ”¾TCPè¿æ¥</p>
</li>
<li><p>æµè§ˆå™¨å°†è¯¥HMTLæ¸²æŸ“å¹¶æ˜¾ç¤ºå†…å®¹</p>
</li>
<li><p>TCP/UDPåŒºåˆ«<br>TCPåè®®æ˜¯é¢å‘è¿æ¥ï¼Œä¿è¯é«˜å¯é æ€§ï¼ˆæ•°æ®æ— ä¸¢å¤±ï¼Œæ•°æ®æ— å¤±åºï¼Œæ•°æ®æ— é”™è¯¯ï¼Œæ•°æ®æ— é‡å¤è¾¾åˆ°ï¼‰ä¼ è¾“å±‚åè®®<br>UDPï¼šæ•°æ®ä¸¢å¤±ï¼Œæ— ç§©åºçš„ä¼ è¾“å±‚åè®®ï¼ˆqqåŸºäºudpåè®®ï¼‰</p>
</li>
<li><p>webscoket<br>websocketæ˜¯åŸºäºhttpåè®®çš„ï¼Œå¯æŒç»­åŒ–è¿æ¥<br>è½®è¯¢ï¼šæµè§ˆå™¨æ¯éš”å‡ ç§’å°±å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°æ¶ˆæ¯<br>é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘èµ·è¿æ¥åï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œå°±ä¸€ç›´ä¸è¿”å›responseç»™å®¢æˆ·ç«¯ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯è¿”å›ï¼Œè¿”å›å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¿æ¥</p>
</li>
<li><p>RabbitMQ:<br>æœåŠ¡å™¨ç«¯æœ‰Erlangè¯­è¨€æ¥ç¼–å†™ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯ï¼Œåªä¼šajaxï¼Œç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§çš„æ–¹é¢ä¸ä¿—ã€‚<br>connectionæ˜¯RabbitMQçš„socketè¿æ¥ï¼Œå®ƒå°è£…äº†socketéƒ¨åˆ†ç›¸å…³åè®®é€»è¾‘<br>connectionFactroyä¸ºconnectionçš„åˆ¶é€ å·¥å‚<br>channelæ˜¯æˆ‘ä»¬ä¸RabbitMQæ‰“äº¤é“çš„æœ€é‡è¦çš„ä¸€ä¸ªæ¥å£ï¼Œå¤§éƒ¨åˆ†çš„ä¸šåŠ¡æ“ä½œæ˜¯åœ¨chaanelè¿™ä¸ªæ¥å£ä¸­å®Œæˆï¼ŒåŒ…æ‹¬å®šä¹‰Queueã€å®šä¹‰Exchangeã€<br>ç»‘å®šQueueä¸Exchange,å‘å¸ƒæ¶ˆæ¯ç­‰</p>
</li>
<li><p>è£…é¥°å™¨<br>è°ƒç”¨è£…é¥°å™¨å…¶å®æ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œä¸ºå…¶ä»–å‡½æ•°æ·»åŠ é™„åŠ åŠŸèƒ½ï¼Œä¸ä¿®æ”¹è¢«ä¿®æ”¹çš„æºä»£ç å’Œä¸ä¿®æ”¹è¢«ä¿®é¥°çš„æ–¹å¼ï¼Œè£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚<br>æ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹ç‰©å¤„ç†ã€ç¼“å­˜ã€æƒé™éªŒè¯ç­‰ï¼Œæœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡ä¸å‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç å¹¶ç»§ç»­é‡ç”¨ã€‚</p>
</li>
<li><p>é—­åŒ…</p>
</li>
<li><p>å¿…é¡»æœ‰ä¸€ä¸ªå†…åµŒå‡½æ•°</p>
</li>
<li><p>å†…åµŒå‡½æ•°å¿…é¡»å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼ˆè¯¥å‡½æ•°åŒ…å«å¯¹å¤–ä½œç”¨åŸŸè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸåå­—çš„å¼•ç”¨ï¼‰</p>
</li>
<li><p>å¤–éƒ¨å‡½æ•°çš„è¿”å›å€¼å¿…é¡»æ˜¯å†…åµŒå‡½æ•°</p>
</li>
<li><p>è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨<br>è¿­ä»£å¯è¿­ä»£å¯¹è±¡å¯¹åº”_iter_ï¼ˆæ–¹æ³•ï¼‰å’Œè¿­ä»£å™¨å¯¹åº”_next_ï¼ˆæ–¹æ³•ï¼‰çš„ä¸€ä¸ªè¿‡ç¨‹<br>ç”Ÿæˆå™¨ï¼šåŒ…æ‹¬å«æœ‰yieldè¿™ä¸ªå…³é”®å­—ï¼Œç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œè°ƒåŠ¨nextæŠŠå‡½æ•°å˜æˆè¿­ä»£å™¨ã€‚</p>
</li>
<li><p>classmethodï¼Œstaticmethodï¼Œproperty<br>ç±»æ–¹æ³•ï¼šå°†ç±»çš„å‡½æ•°è½¬æ¢æˆç±»æ–¹æ³•ï¼Œå‡½æ•°ä¸Šè£…é¥°@classmethodä¼šå°†å‡½æ•°çš„è‡ªåŠ¨ä¼ å€¼å‚æ•°æ”¹æˆcls<br>é™æ€æ–¹æ³•ï¼šæ­¤æ–¹æ³•ç›¸å½“äºç»™ç±»æ‰©å±•ä¸€ä¸ªåŠŸèƒ½ï¼Œå°†ç±»å†…çš„å‡½æ•°å®ä¾‹åŒ–ï¼Œç»™ç±»æˆ–å¯¹è±¡ä½¿ç”¨ï¼Œæ­¤æ—¶ç±»å†…çš„å‡½æ•°å°±æ˜¯æ™®é€šå‡½æ•°ï¼Œä¸ç®¡æ˜¯ç±»è¿˜æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨<br>å®ä¾‹åŒ–ï¼šç±»çš„å®ä¾‹åŒ–å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºç±»ï¼ˆï¼‰æŠŠè™šæ‹Ÿçš„ä¸œè¥¿å®ä¾‹åŒ–ï¼Œå¾—åˆ°å…·ä½“å­˜åœ¨çš„å€¼</p>
</li>
<li><p>å¸¸ç”¨çš„çŠ¶æ€ç <br>200â€“æœåŠ¡å™¨æˆåŠŸè¿”å›ç½‘é¡µ<br>204â€“è¯·æ±‚æ”¶åˆ°,ä½†è¿”å›ä¿¡æ¯ä¸ºç©º<br>304â€“å®¢æˆ·ç«¯å·²ç»æ‰§è¡Œäº†GET,ä½†æ–‡ä»¶æœªå˜åŒ–<br>400â€“é”™è¯¯è¯·æ±‚ï¼Œå¦‚è¯­æ³•é”™è¯¯<br>403â€“æ— æƒé™è®¿é—®<br>404â€“è¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨<br>500â€“æœåŠ¡å™¨äº§ç”Ÿå†…éƒ¨é”™è¯¯<br>â€</p>
</li>
<li><p>å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œåç¨‹ï¼ŒGIL<br>GIL:å…¨å±€è§£é‡Šå™¨é”ï¼Œæ˜¯é”åœ¨cpythonè§£é‡Šå™¨ä¸Šï¼Œå¯¼è‡´åŒä¸€æ—¶åˆ»ï¼ŒåŒä¸€è¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¢«æ‰§è¡Œ<br>å¤šè¿›ç¨‹ï¼šå¤šè¿›ç¨‹æ¨¡å—multiprocessingæ¥å®ç°ï¼Œcpuå¯†é›†å‹ï¼ŒIOè®¡ç®—å‹å¯ä»¥ç”¨å¤šè¿›ç¨‹<br>å¤šçº¿ç¨‹ï¼šå¤šçº¿ç¨‹æ¨¡å—threadingæ¥å®ç°ï¼ŒIOå¯†é›†å‹ï¼Œå¤šçº¿ç¨‹å¯ä»¥æé«˜æ•ˆç‡<br>åç¨‹ï¼šä¾èµ–äºgeenletï¼Œå¯¹äºå¤šçº¿ç¨‹åº”ç”¨ã€‚cpué€šè¿‡åˆ‡ç‰‡çš„æ–¹å¼æ¥åˆ‡æ¢çº¿ç¨‹é—´çš„æ‰§è¡Œï¼Œé‡åˆ°IOæ“ä½œè‡ªåŠ¨åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶éœ€è¦è€—æ—¶ï¼Œ<br>è€Œåæˆå¥½å¤„æ²¡æœ‰åˆ‡æ¢çš„æ¶ˆè€—ï¼Œæ²¡æœ‰é”å®šæ¦‚å¿µã€‚<br>è¿›ç¨‹ï¼šæ˜¯èµ„æºç®¡ç†å•ä½ï¼Œè¿›è¡Œæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ç°å¹¶å‘å’Œå¹¶å‘<br>çº¿ç¨‹ï¼šæ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œçº¿ç¨‹çš„å‡ºç°ä¸ºäº†é™ä½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œæä¾›ç³»ç»Ÿçš„å¹¶å‘æ€§</p>
</li>
<li><p>IOå¤šè·¯å¤ç”¨/å¼‚æ­¥éé˜»å¡<br>IOå¤šè·¯å¤ç”¨ï¼šé€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªæè¿°ç¬¦ select/poll/epoll<br>selectï¼šè¿æ¥æ•°å—é™ï¼ŒæŸ¥æ‰¾é…å¯¹é€Ÿåº¦æ…¢ï¼Œæ•°æ®ç”±å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·æ€<br>pollï¼šæ”¹å–„äº†è¿æ¥æ•°ï¼Œä½†æ˜¯è¿˜æ˜¯æŸ¥æ‰¾é…å¯¹é€Ÿåº¦æ…¢ï¼Œæ•°æ®ç”±å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·æ€<br>epollï¼šepollæ˜¯linuxä¸‹å¤šè·¯å¤ç”¨IOæ¥å£ï¼Œæ˜¯select/pollçš„å¢å¼ºç‰ˆï¼Œå®ƒèƒ½æ˜¾è‘—æé«˜ç¨‹åºåœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸­åªæœ‰å°‘é‡æ´»è·ƒçš„æƒ…å†µä¸‹çš„ç³»ç»ŸCPUåˆ©ç”¨ç‡<br>å¼‚æ­¥éé˜»å¡ï¼šå¼‚æ­¥ä½“ç°åœ¨å›è°ƒä¸Šï¼Œå›è°ƒå°±æ˜¯æœ‰æ¶ˆæ¯è¿”å›æ—¶å‘ŠçŸ¥ä¸€å£°å„¿è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚éé˜»å¡å°±æ˜¯ä¸ç­‰å¾…ï¼Œä¸éœ€è¦è¿›ç¨‹ç­‰å¾…ä¸‹å»ï¼Œ<br>ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œä¸ç®¡å…¶ä»–è¿›ç¨‹çš„çŠ¶æ€ã€‚</p>
</li>
<li><p>PEP8è§„èŒƒï¼Œè§„èŒƒçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
<li><p>ç¼©è¿›ï¼š4ä¸ªç©ºå®ç°ç¼©è¿›ï¼Œå°½é‡ä¸ä½¿ç”¨Tab</p>
</li>
<li><p>è¡Œï¼šæ²¡è¡Œæœ€å¤§é•¿åº¦ä¸è¶…è¿‡79ï¼Œæ¢è¡Œå¯ä»¥ä½¿ç”¨åæ–œæ </p>
</li>
<li><p>å‘½åè§„èŒƒï¼š</p>
</li>
<li><p>æ³¨é‡Šè§„èŒƒï¼š</p>
</li>
<li><p>range-and-xrange<br>éƒ½åœ¨å¾ªç¯æ—¶ä½¿ç”¨ï¼Œxrangeå†…å­˜æ€§èƒ½æ›´å¥½ï¼Œxrangeç”¨æ³•ä¸rangeå®Œå…¨ç›¸åŒï¼Œrangeä¸€ä¸ªç”Ÿæˆlistå¯¹è±¡ï¼Œxrangeæ˜¯ç”Ÿæˆå™¨</p>
</li>
<li><p>withä¸Šä¸‹æ–‡æœºåˆ¶åŸç†<br>_enter_å’Œ_exit_ï¼Œä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œå³withè¯­å¥ï¼Œä¸ºäº†è®©ä¸€ä¸ªå¯¹è±¡å…¼å®¹withè¯­å¥ï¼Œå¿…é¡»åœ¨è¿™ä¸ªå¯¹è±¡ç±»ä¸­å£°æ˜_enter_å’Œ_exit_æ–¹æ³•ï¼Œ<br>ä½¿ç”¨withè¯­å¥çš„ç›®çš„å°±æ˜¯æŠŠä»£ç å—æ”¾å…¥withä¸­æ‰§è¡Œï¼Œwithç»“æŸåï¼Œè‡ªåŠ¨å®Œæˆæ¸…ç†å·¥ä½œï¼Œæ— é¡»æ”¶åˆ°å¹²é¢„</p>
</li>
<li><p>ç»å…¸ç±»ã€æ–°å¼ç±»<br>ç»å…¸ç±»éµå¾ªï¼šæ·±åº¦ä¼˜å…ˆï¼Œpython2ä¸­<br>æ–°å¼ç±»éµå¾ªï¼šå¹¿åº¦ä¼˜å…ˆï¼ŒPython3ä¸­</p>
</li>
<li><p>æœ‰æ²¡æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æŸ¥æ‰¾Pythonçš„bugå’Œè¿›è¡Œé™æ€çš„ä»£ç åˆ†æï¼Ÿ<br>PyCheckeræ˜¯ä¸€ä¸ªPythonä»£ç çš„é™æ€åˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æŸ¥æ‰¾Pythonä»£ç çš„bugï¼Œä¼šå¯¹ä»£ç çš„å¤æ‚åº¦å’Œæ ¼å¼æå‡ºè­¦å‘Šï¼Œ<br>Pylintæ˜¯å¦å¤–ä¸€ä¸ªå·¥å…·å¯ä»¥è¿›è¡Œcodingstandardæ£€æŸ¥  </p>
</li>
<li><p>Pythonæ˜¯å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„</p>
</li>
<li><p>å¯¹è±¡å¼•ç”¨è®¡æ•°ï¼š<br>  å¼•ç”¨è®¡æ•°å¢åŠ çš„æƒ…å†µï¼š<br>  æ¥ä¿æŒè¿½è¸ªå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½ç”¨å¼•ç”¨è®¡æ•°ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªæ–°åç§°<br>  å°†å…¶æ”¾å…¥ä¸€ä¸ªå®¹å™¨ä¸­ï¼ˆåˆ—è¡¨ï¼Œå­—å…¸ï¼Œå…ƒç¥–ï¼‰<br>  å¼•ç”¨è®¡æ•°å‡å°‘çš„æƒ…å†µï¼š<br>  ä½¿ç”¨delè¯­å¥å¯¹å¯¹è±¡åˆ«åæ˜¾ç¤ºçš„é”€æ¯<br>  å¼•ç”¨è¶…å‡ºä½œç”¨åŸŸæˆ–è¢«é‡æ–°èµ‹å€¼<br>  sys.getrefcount()å‡½æ•°å¯ä»¥è·å¾—å¯¹è±¡çš„å½“å‰å¼•ç”¨è®¡æ•°</p>
</li>
<li><p>æ ‡è®°-æ¸…é™¤æœºåˆ¶</p>
</li>
<li><p>åˆ†ä»£æŠ€æœ¯</p>
</li>
<li><p>ä»€ä¹ˆæ˜¯pythonï¼Ÿä½¿ç”¨pythonæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ<br>pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæœ‰å¯¹è±¡ã€æ¨¡å—ã€çº¿ç¨‹ã€å¼‚å¸¸å¤„ç†å’Œè‡ªåŠ¨å†…å­˜ç®¡ç†ã€‚å®ƒç®€æ´ï¼Œç®€å•ã€æ–¹ä¾¿ã€å®¹æ˜“æ‰©å±•ã€æœ‰è®¸å¤šè‡ªå¸¦çš„æ•°æ®ç»“æœï¼Œè€Œä¸”å®ƒå¼€æº</p>
</li>
<li><p>ä»€ä¹ˆæ˜¯picklingå’Œunpicklingï¼Ÿ<br>Pickleæ¨¡å—è¯»å…¥ä»»ä½•pythonå¯¹è±¡ï¼Œå°†å®ƒä»¬è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨dumpå‡½æ•°å°†å…¶è½¬å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­â€”â€”è¿™ä¸ªè¿‡ç¨‹å«åšpickling<br>åä¹‹ä»å­˜å‚¨çš„å­—ç¬¦ä¸²æ–‡ä»¶ä¸­æå–åŸå§‹pythonå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå«åšunpickling</p>
</li>
<li><p>pythonæ˜¯å¦‚ä½•è¢«è§£é‡Šçš„ï¼Ÿ<br>Pythonæ˜¯ä¸€ç§è§£é‡Šæ€§è¯­è¨€ï¼Œå®ƒçš„æºä»£ç å¯ä»¥ç›´æ¥è¿è¡Œï¼ŒPythonè§£é‡Šå™¨ä¼šå°†æºä»£ç è½¬æ¢æˆä¸­é—´è¯­è¨€ï¼Œä¹‹åå†ç¿»è¯‘æˆæœºå™¨ç å†æ‰§è¡Œ</p>
</li>
<li><p>æ•°ç»„å’Œå…ƒç¥–ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ<br>æ•°ç»„å’Œå…ƒç¥–ä¹‹é—´çš„åŒºåˆ«ï¼šæ•°ç»„å†…å®¹å¯ä»¥è¢«ä¿®æ”¹ï¼Œè€Œå…ƒç¥–å†…å®¹æ˜¯åªè¯»çš„ï¼Œä¸å¯è¢«ä¿®æ”¹çš„ï¼Œå¦å¤–å…ƒç¥–å¯ä»¥è¢«å“ˆå¸Œï¼Œæ¯”å¦‚ä½œä¸ºå­—å…¸çš„key</p>
</li>
<li><p>å‚æ•°æŒ‰å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ<br>pythonä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ç±»ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å¼•ç”¨çš„å€¼æ˜¯ç”±å‡½æ•°ç¡®å®šçš„ï¼Œå› æ­¤æ— æ³•è¢«æ”¹å˜ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œä½ å¯ä»¥æ”¹åŠ¨å¯¹è±¡</p>
</li>
<li><p>Pythonéƒ½æœ‰å“ªäº›è‡ªå¸¦çš„æ•°æ®ç»“æ„ï¼Ÿ<br>Pythonè‡ªå¸¦çš„æ•°æ®ç»“æ„åˆ†ä¸ºå¯å˜å’Œä¸å¯å˜çš„ï¼šå¯å˜çš„æœ‰ï¼šæ•°ç»„ã€é›†åˆã€å­—å…¸ï¼Œä¸å¯å˜çš„æ˜¯ï¼šå­—ç¬¦ä¸²ã€å…ƒç¥–ã€æ•´æ•°</p>
</li>
<li><p>ä»€ä¹ˆæ˜¯pythonçš„å‘½åç©ºé—´ï¼Ÿ<br>åœ¨pythonä¸­ï¼Œæ‰€æœ‰çš„åå­—éƒ½å­˜åœ¨äºä¸€ä¸ªç©ºé—´ä¸­ï¼Œå®ƒä»¬åœ¨æ”¹ç©ºé—´ä¸­å­˜åœ¨å’Œè¢«æ“ä½œâ€”â€”è¿™å°±æ˜¯å‘½åç©ºé—´ï¼Œå®ƒå°±å¥½åƒä¸€ä¸ªç›’å­ï¼Œåœ¨æ¯ä¸ªå˜é‡åå­—éƒ½å¯¹åº”è£…ç€ä¸€ä¸ªå¯¹è±¡ï¼Œ<br>å½“æŸ¥è¯¢å˜é‡çš„æ—¶å€™ï¼Œä¼šä»è¯¥ç›’å­é‡Œé¢å¯»æ‰¾ç›¸åº”çš„å¯¹è±¡</p>
</li>
<li><p>pythonä¸­çš„unittestæ˜¯ä»€ä¹ˆï¼Ÿ<br>åœ¨pythonä¸­ï¼Œunittestæ˜¯pythonä¸­çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒæ‹¥æœ‰æ”¯æŒå…±äº«æ­å»ºã€è‡ªåŠ¨æµ‹è¯•ã€åœ¨æµ‹è¯•ä¸­æš‚åœä»£ç ã€å°†ä¸åŒæµ‹è¯•è¿­ä»£æˆä¸€ç»„</p>
</li>
<li><p><em>argsä¸*</em>kwargs</p>
</li>
</ol>
<p><em>argsä»£è¡¨ä½ç½®å‚æ•°ï¼Œå®ƒä¼šæ¥æ”¶ä»»æ„å¤šä¸ªå‚æ•°å¹¶æŠŠè¿™äº›å‚æ•°ä½œä¸ºå…ƒç¥–ä¼ é€’ç»™å‡½æ•°ã€‚*</em>kwargsä»£è¡¨çš„å…³é”®å­—å‚æ•°ï¼Œè¿”å›çš„æ˜¯å­—å…¸ï¼Œä½ç½®å‚æ•°ä¸€å®šè¦æ”¾åœ¨å…³é”®å­—å‰é¢</p>
<ol start="29">
<li><p>åœ¨Pythonä¸­ä»€ä¹ˆæ˜¯slicingï¼Ÿ<br>slicingæ˜¯ä¸€ç§åœ¨æœ‰åºçš„å¯¹è±¡ç±»å‹ä¸­ï¼ˆæ•°ç»„ã€å…ƒç¥–ã€å­—ç¬¦ä¸²ï¼‰èŠ‚é€‰æŸä¸€æ®µçš„è¯­æ³•</p>
</li>
<li><p>ä¸­çš„docstringæ˜¯ä»€ä¹ˆï¼Ÿ<br>Pythonä¸­æ–‡æ¡£å­—ç¬¦ä¸²è¢«ç§°ä¸ºdocstringï¼Œå®ƒåœ¨Pythonä¸­çš„ä½œç”¨æ˜¯ä¸ºå‡½æ•°ã€æ¨¡å—å’Œç±»æ³¨é‡Šç”Ÿæˆæ–‡æ¡£</p>
</li>
<li><p>osä¸sysåŒºåˆ«ï¼š<br>osæ˜¯æ¨¡å—è´Ÿè´£ç¨‹åºä¸æ“ä½œç³»ç»Ÿçš„äº¤äº’ï¼Œæä¾›äº†è®¿é—®æ“ä½œç³»ç»Ÿåº•å±‚çš„æ¥å£<br>sysæ¨¡å—æ˜¯è´Ÿè´£ç¨‹åºä¸pythonè§£é‡Šå™¨çš„äº¤äº’ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°å’Œå˜é‡ï¼Œç”¨äºæ“æ§Pythonæ—¶è¿è¡Œçš„ç¯å¢ƒ</p>
</li>
<li><p>å®ç°ä¸€ä¸ªå•ä¾‹æ¨¡å¼<br>_new_ï¼ˆï¼‰åœ¨ _init_ï¼ˆï¼‰ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚åˆ©ç”¨è¿™ä¸ªæ–¹æ³•å’Œç±»çš„å±æ€§çš„ç‰¹ç‚¹å¯ä»¥å®ç°è®¾è®¡æ¨¡å¼çš„å•ä¾‹æ¨¡å¼ã€‚<br>å•ä¾‹æ¨¡å¼æ˜¯æŒ‡åˆ›å»ºå”¯ä¸€å¯¹è±¡ï¼Œå•ä¾‹æ¨¡å¼è®¾è®¡çš„ç±»åªèƒ½å®ä¾‹ï¼Œå®ä¾‹åŒ–1ä¸ªå¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singleton(object):</span><br><span class="line">    __instance&#x3D;None</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if Singleton.__instance is None:</span><br><span class="line">            Singleton.__instance&#x3D;object.__new__(cls,*args,**kwargs)</span><br><span class="line">        return Singleton.__instance</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜</title>
    <url>/2020/04/23/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%94%A8Strace%E8%AF%8A%E6%96%AD%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<h2 id="æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜"><a href="#æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜" class="headerlink" title="æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜"></a>æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜</h2><p>æ—©äº›å¹´ï¼Œå¦‚æœä½ çŸ¥é“æœ‰ä¸ª strace å‘½ä»¤ï¼Œå°±å¾ˆç‰›äº†ï¼Œè€Œç°åœ¨å¤§å®¶åŸºæœ¬éƒ½çŸ¥é“ strace äº†ï¼Œå¦‚æœä½ é‡åˆ°æ€§èƒ½é—®é¢˜æ±‚åŠ©åˆ«äººï¼Œåæœ‰å…«ä¹ä¼šå»ºè®®ä½ ç”¨ strace æŒ‚ä¸Šå»çœ‹çœ‹ï¼Œä¸è¿‡å½“ä½ æŒ‚ä¸Šå»äº†ï¼Œçœ‹ç€æ»¡å±ç¿»æ»šçš„å­—ç¬¦ï¼Œå´åæœ‰å…«ä¹çœ‹ä¸å‡ºä¸ªæ‰€ä»¥ç„¶ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œå‘ä½ å±•ç¤ºä¸€ä¸‹åœ¨ç”¨ strace è¯Šæ–­é—®é¢˜æ—¶çš„ä¸€äº›å¥—è·¯ã€‚</p>
<p>å¦‚ä¸‹çœŸå®æ¡ˆä¾‹ï¼Œå¦‚æœ‰é›·åŒï¼Œå®å±å¿…ç„¶ï¼è®©æˆ‘ä»¬çœ‹ä¸€å°é«˜è´Ÿè½½æœåŠ¡å™¨çš„ top ç»“æœï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/PiaIQldYWZNOicsPhk6EoxoZX7bGH8wwXV6xWge4S3ibM9kVibMTsuBCYIILYc4GhXuPbXibAfgLibWZf0Oz0RwFEeJA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"></p>
<blockquote>
<p>æŠ€å·§ï¼šè¿è¡Œ top æ—¶ï¼ŒæŒ‰ã€Œ1ã€æ‰“å¼€ CPU åˆ—è¡¨ï¼ŒæŒ‰ã€Œshift+pã€ä»¥ CPU æ’åºã€‚<br>åœ¨æœ¬ä¾‹ä¸­å¤§å®¶å¾ˆå®¹æ˜“å‘ç° CPU ä¸»è¦æ˜¯è¢«è‹¥å¹²ä¸ª PHP è¿›ç¨‹å ç”¨äº†ï¼ŒåŒæ—¶ PHP è¿›ç¨‹å ç”¨çš„æ¯”è¾ƒå¤šçš„å†…å­˜ï¼Œä¸è¿‡ç³»ç»Ÿå†…å­˜å°šæœ‰ç»“ä½™ï¼ŒSWAP ä¹Ÿä¸ä¸¥é‡ï¼Œè¿™å¹¶ä¸æ˜¯é—®é¢˜ä¸»å› ã€‚</p>
</blockquote>
<p>ä¸è¿‡åœ¨ CPU åˆ—è¡¨ä¸­èƒ½çœ‹åˆ° CPU ä¸»è¦æ¶ˆè€—åœ¨å†…æ ¸æ€ã€Œsyã€ï¼Œè€Œä¸æ˜¯ç”¨æˆ·æ€ã€Œusã€ï¼Œå’Œæˆ‘ä»¬çš„ç»éªŒä¸ç¬¦ã€‚Linux æ“ä½œç³»ç»Ÿæœ‰å¾ˆå¤šç”¨æ¥è·Ÿè¸ªç¨‹åºè¡Œä¸ºçš„å·¥å…·ï¼Œå†…æ ¸æ€çš„å‡½æ•°è°ƒç”¨è·Ÿè¸ªç”¨ã€Œstraceã€ï¼Œç”¨æˆ·æ€çš„å‡½æ•°è°ƒç”¨è·Ÿè¸ªç”¨ã€Œltraceã€ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åº”è¯¥ç”¨ã€Œstraceã€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell&gt; strace -p &lt;PID&gt;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡å¦‚æœç›´æ¥ç”¨ strace è·Ÿè¸ªæŸä¸ªè¿›ç¨‹çš„è¯ï¼Œé‚£ä¹ˆç­‰å¾…ä½ çš„å¾€å¾€æ˜¯æ»¡å±ç¿»æ»šçš„å­—ç¬¦ï¼Œæƒ³ä»è¿™é‡Œçœ‹å‡ºé—®é¢˜çš„ç—‡ç»“å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå¥½åœ¨<code>strace</code>å¯ä»¥æŒ‰æ“ä½œæ±‡æ€»æ—¶é—´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell&gt; strace -cp &lt;PID&gt;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ã€Œcã€é€‰é¡¹ç”¨æ¥æ±‡æ€»å„ä¸ªæ“ä½œçš„æ€»è€—æ—¶ï¼Œè¿è¡Œåçš„ç»“æœå¤§æ¦‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/PiaIQldYWZNOicsPhk6EoxoZX7bGH8wwXVFM4Y0EZjeOr8ibcoiake8lSsOqAMYVe7aDujibulxBM48vnrO8XXJuwVw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><br>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ° CPU ä¸»è¦è¢« clone æ“ä½œæ¶ˆè€—äº†ï¼Œè¿˜å¯ä»¥å•ç‹¬è·Ÿè¸ªä¸€ä¸‹ cloneï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell&gt; strace -T -e clone -p &lt;PID&gt;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ã€ŒTã€é€‰é¡¹å¯ä»¥è·å–æ“ä½œå®é™…æ¶ˆè€—çš„æ—¶é—´ï¼Œé€šè¿‡ã€Œeã€é€‰é¡¹å¯ä»¥è·Ÿè¸ªæŸä¸ªæ“ä½œï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/PiaIQldYWZNOicsPhk6EoxoZX7bGH8wwXVmBteMRoCe1dNVNZG4Q6cfJptt5Tj0CDx6aPCJw0y7yhiazMABzzfAuA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1"><br>strace -T -e clone -p<br>å¾ˆæ˜æ˜¾ï¼Œä¸€ä¸ª clone æ“ä½œéœ€è¦å‡ ç™¾æ¯«ç§’ï¼Œè‡³äº clone çš„å«ä¹‰ï¼Œå‚è€ƒ man æ–‡æ¡£ï¼š</p>
<blockquote>
<p>clone() creates a new process, in a manner similar to fork(2). It is actually a library function layered on top of the underlying clone() system call, hereinafter referred to as sys_clone. A description of sys_clone is given towards the end of this page.<br>Unlike fork(2), these calls allow the child process to share parts of its execution context with the calling process, such as the memory space, the table of file descriptors, and the table of signal handlers. (Note that on this manual page, â€œcalling processâ€ normally corresponds to â€œparent processâ€. But see the description of CLONE_PARENT below.)<br>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ã€‚é‚£ä¹ˆåœ¨ PHP é‡Œä»€ä¹ˆæ—¶å€™ä¼šå‡ºç°æ­¤ç±»ç³»ç»Ÿè°ƒç”¨å‘¢ï¼ŸæŸ¥è¯¢ä¸šåŠ¡ä»£ç çœ‹åˆ°äº†<code>exec</code>å‡½æ•°ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤éªŒè¯å®ƒç¡®å®ä¼šå¯¼è‡´<code>clone</code>ç³»ç»Ÿè°ƒç”¨ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shell&gt; strace -eclone php -r &#39;exec(&quot;ls&quot;);&#39;</span><br></pre></td></tr></table></figure>
<p>æœ€åå†è€ƒå¤§å®¶ä¸€ä¸ªé¢˜ï¼šå¦‚æœæˆ‘ä»¬ç”¨ strace è·Ÿè¸ªä¸€ä¸ªè¿›ç¨‹ï¼Œè¾“å‡ºç»“æœå¾ˆå°‘ï¼Œæ˜¯ä¸æ˜¯è¯´æ˜è¿›ç¨‹å¾ˆç©ºé—²ï¼Ÿå…¶å®è¯•è¯• ltraceï¼Œå¯èƒ½ä¼šå‘ç°åˆ«æœ‰æ´å¤©ã€‚è®°ä½æœ‰å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹åˆ†ã€‚</p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="https://mp.weixin.qq.com/s/VDXO_nvaz7ZAIZz8NpPprQ" target="_blank" rel="noopener">Linuxè¿ç»´è¿›é˜¶:æ‰‹æŠŠæ‰‹æ•™ä½ ç”¨Straceè¯Šæ–­é—®é¢˜</a></p>
]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
      <tags>
        <tag>LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢å‘å¯¹è±¡-ä½¿ç”¨æšä¸¾ç±»</title>
    <url>/2020/04/23/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1-%E4%BD%BF%E7%94%A8%E6%9E%9A%E4%B8%BE%E7%B1%BB/</url>
    <content><![CDATA[<h2 id="é¢å‘å¯¹è±¡-ä½¿ç”¨æšä¸¾ç±»"><a href="#é¢å‘å¯¹è±¡-ä½¿ç”¨æšä¸¾ç±»" class="headerlink" title="é¢å‘å¯¹è±¡-ä½¿ç”¨æšä¸¾ç±»"></a>é¢å‘å¯¹è±¡-ä½¿ç”¨æšä¸¾ç±»</h2><p>å½“æˆ‘ä»¬éœ€è¦å®šä¹‰å¸¸é‡æ—¶ï¼Œä¸€ä¸ªåŠæ³•æ˜¯ç”¨å¤§å†™å˜é‡é€šè¿‡æ•´æ•°æ¥å®šä¹‰ï¼Œä¾‹å¦‚æœˆä»½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JAN &#x3D; 1</span><br><span class="line">FEB &#x3D; 2</span><br><span class="line">MAR &#x3D; 3</span><br><span class="line">...</span><br><span class="line">NOV &#x3D; 11</span><br><span class="line">DEC &#x3D; 12</span><br></pre></td></tr></table></figure>
<p>å¥½å¤„æ˜¯ç®€å•ï¼Œç¼ºç‚¹æ˜¯ç±»å‹æ˜¯intï¼Œå¹¶ä¸”ä»ç„¶æ˜¯å˜é‡ã€‚</p>
<p>æ›´å¥½çš„æ–¹æ³•æ˜¯ä¸ºè¿™æ ·çš„æšä¸¾ç±»å‹å®šä¹‰ä¸€ä¸ªclassç±»å‹ï¼Œç„¶åï¼Œæ¯ä¸ªå¸¸é‡éƒ½æ˜¯classçš„ä¸€ä¸ªå”¯ä¸€å®ä¾‹ã€‚Pythonæä¾›äº†Enumç±»æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from enum import Enum</span><br><span class="line"></span><br><span class="line">Month &#x3D; Enum(&#39;Month&#39;, (&#39;Jan&#39;, &#39;Feb&#39;, &#39;Mar&#39;, &#39;Apr&#39;, &#39;May&#39;, &#39;Jun&#39;, &#39;Jul&#39;, &#39;Aug&#39;, &#39;Sep&#39;, &#39;Oct&#39;, &#39;Nov&#39;, &#39;Dec&#39;))</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å°±è·å¾—äº†Monthç±»å‹çš„æšä¸¾ç±»ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Month.Janæ¥å¼•ç”¨ä¸€ä¸ªå¸¸é‡ï¼Œæˆ–è€…æšä¸¾å®ƒçš„æ‰€æœ‰æˆå‘˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for name, member in Month.__members__.items():</span><br><span class="line">    print(name, &#39;&#x3D;&gt;&#39;, member, &#39;,&#39;, member.value)</span><br></pre></td></tr></table></figure>
<p>valueå±æ€§åˆ™æ˜¯è‡ªåŠ¨èµ‹ç»™æˆå‘˜çš„intå¸¸é‡ï¼Œé»˜è®¤ä»1å¼€å§‹è®¡æ•°ã€‚</p>
<p>å¦‚æœéœ€è¦æ›´ç²¾ç¡®åœ°æ§åˆ¶æšä¸¾ç±»å‹ï¼Œå¯ä»¥ä»Enumæ´¾ç”Ÿå‡ºè‡ªå®šä¹‰ç±»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from enum import Enum, unique</span><br><span class="line"></span><br><span class="line">@unique</span><br><span class="line">class Weekday(Enum):</span><br><span class="line">    Sun &#x3D; 0 # Sunçš„valueè¢«è®¾å®šä¸º0</span><br><span class="line">    Mon &#x3D; 1</span><br><span class="line">    Tue &#x3D; 2</span><br><span class="line">    Wed &#x3D; 3</span><br><span class="line">    Thu &#x3D; 4</span><br><span class="line">    Fri &#x3D; 5</span><br><span class="line">    Sat &#x3D; 6</span><br></pre></td></tr></table></figure>
<p>@uniqueè£…é¥°å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æŸ¥ä¿è¯æ²¡æœ‰é‡å¤å€¼ã€‚</p>
<p>è®¿é—®è¿™äº›æšä¸¾ç±»å‹å¯ä»¥æœ‰è‹¥å¹²ç§æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; day1 &#x3D; Weekday.Mon</span><br><span class="line">&gt;&gt;&gt; print(day1)</span><br><span class="line">Weekday.Mon</span><br><span class="line">&gt;&gt;&gt; print(Weekday.Tue)</span><br><span class="line">Weekday.Tue</span><br><span class="line">&gt;&gt;&gt; print(Weekday[&#39;Tue&#39;])</span><br><span class="line">Weekday.Tue</span><br><span class="line">&gt;&gt;&gt; print(Weekday.Tue.value)</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; print(day1 &#x3D;&#x3D; Weekday.Mon)</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; print(day1 &#x3D;&#x3D; Weekday.Tue)</span><br><span class="line">False</span><br><span class="line">&gt;&gt;&gt; print(Weekday(1))</span><br><span class="line">Weekday.Mon</span><br><span class="line">&gt;&gt;&gt; print(day1 &#x3D;&#x3D; Weekday(1))</span><br><span class="line">True</span><br><span class="line">&gt;&gt;&gt; Weekday(7)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  ...</span><br><span class="line">ValueError: 7 is not a valid Weekday</span><br><span class="line">&gt;&gt;&gt; for name, member in Weekday.__members__.items():</span><br><span class="line">...     print(name, &#39;&#x3D;&gt;&#39;, member)</span><br><span class="line">...</span><br><span class="line">Sun &#x3D;&gt; Weekday.Sun</span><br><span class="line">Mon &#x3D;&gt; Weekday.Mon</span><br><span class="line">Tue &#x3D;&gt; Weekday.Tue</span><br><span class="line">Wed &#x3D;&gt; Weekday.Wed</span><br><span class="line">Thu &#x3D;&gt; Weekday.Thu</span><br><span class="line">Fri &#x3D;&gt; Weekday.Fri</span><br><span class="line">Sat &#x3D;&gt; Weekday.Sat</span><br></pre></td></tr></table></figure>
<p>å¯è§ï¼Œæ—¢å¯ä»¥ç”¨æˆå‘˜åç§°å¼•ç”¨æšä¸¾å¸¸é‡ï¼Œåˆå¯ä»¥ç›´æ¥æ ¹æ®valueçš„å€¼è·å¾—æšä¸¾å¸¸é‡ã€‚</p>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>æŠŠStudentçš„genderå±æ€§æ”¹é€ ä¸ºæšä¸¾ç±»å‹ï¼Œå¯ä»¥é¿å…ä½¿ç”¨å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">from enum import Enum, unique</span><br><span class="line"></span><br><span class="line">class Gender(Enum):</span><br><span class="line">    Male &#x3D; 0</span><br><span class="line">    Female &#x3D; 1</span><br><span class="line"></span><br><span class="line">class Student(object):</span><br><span class="line">    def __init__(self, name, gender):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.gender &#x3D; gender</span><br><span class="line"># æµ‹è¯•:</span><br><span class="line">bart &#x3D; Student(&#39;Bart&#39;, Gender.Male)</span><br><span class="line">if bart.gender &#x3D;&#x3D; Gender.Male:</span><br><span class="line">    print(bart.gender.value)</span><br><span class="line">    print(&#39;æµ‹è¯•é€šè¿‡!&#39;)</span><br><span class="line">else:</span><br><span class="line">    print(&#39;æµ‹è¯•å¤±è´¥!&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>Enum</code>å¯ä»¥æŠŠä¸€ç»„ç›¸å…³å¸¸é‡å®šä¹‰åœ¨ä¸€ä¸ªclassä¸­ï¼Œä¸”classä¸å¯å˜ï¼Œè€Œä¸”æˆå‘˜å¯ä»¥ç›´æ¥æ¯”è¾ƒã€‚</p>
<p><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143191235886950998592cd3e426e91687cdae696e64b000" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”±ORMæµ…è°ˆpythonå…ƒç±»</title>
    <url>/2020/04/23/%E7%94%B1ORM%E6%B5%85%E8%B0%88python%E5%85%83%E7%B1%BB/</url>
    <content><![CDATA[<h2 id="ç”±ORMæµ…è°ˆpythonå…ƒç±»"><a href="#ç”±ORMæµ…è°ˆpythonå…ƒç±»" class="headerlink" title="ç”±ORMæµ…è°ˆpythonå…ƒç±»"></a>ç”±ORMæµ…è°ˆpythonå…ƒç±»</h2><blockquote>
<p>ä¸»è¦ä»‹ç»äº†ä»€ä¹ˆæ˜¯ç±»ï¼Œå¦‚ä½•åŠ¨æ€çš„åˆ›å»ºç±»ï¼Œä»€ä¹ˆæ˜¯å…ƒç±»ï¼Œç±»çš„_metaclass_å±æ€§ä»¥åŠå¦‚ä½•è‡ªå·±å®ç°ORMã€‚</p>
</blockquote>
<h3 id="åœ¨è°ˆPythonå…ƒç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ORMæ˜¯ä»€ä¹ˆ"><a href="#åœ¨è°ˆPythonå…ƒç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ORMæ˜¯ä»€ä¹ˆ" class="headerlink" title="åœ¨è°ˆPythonå…ƒç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ORMæ˜¯ä»€ä¹ˆ?"></a>åœ¨è°ˆPythonå…ƒç±»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ORMæ˜¯ä»€ä¹ˆ?</h3><p>ORM ä¸ºObject Relational Mapping çš„ç®€ç§°ï¼Œä¸­æ–‡æ„æ€ä¸ºå¯¹è±¡å…³ç³»æ˜ å°„ï¼ŒORMçš„å‡ºç°ï¼Œæ˜¯ä¸ºäº†è§£å†³é¢å‘å¯¹è±¡å’Œå…³ç³»æ•°æ®åº“ä¹‹é—´ä¸ç›¸åŒ¹é…è€Œå‡ºç°çš„æŠ€æœ¯ï¼Œç›®çš„æ˜¯ä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥å®ç°å¯¹æ•°æ®åº“ä¸­è¡¨çš„æ“ä½œï¼Œä»è€Œå±è”½æ‰åº•å±‚çš„SQLæ“ä½œã€‚</p>
<p>ç®€å•äº†è§£äº†ORMçš„æ¦‚å¿µï¼Œè®¸å¤šåŒå­¦å¯èƒ½ä¼šæƒ³äº†è§£ORMæ˜¯æ€ä¹ˆå®ç°çš„ï¼Œä»¥ä¸‹ä»£ç æ‘˜è‡ªdjangoé¡¹ç›®ORMçš„éƒ¨åˆ†å®ç°ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def subclass_exception(name, parents, module, attached_to&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Create exception subclass. Used by ModelBase below.</span><br><span class="line"></span><br><span class="line">    If &#39;attached_to&#39; is supplied, the exception will be created in a way that</span><br><span class="line">    allows it to be pickled, assuming the returned exception class will be added</span><br><span class="line">    as an attribute to the &#39;attached_to&#39; class.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    class_dict &#x3D; &#123;&#39;__module__&#39;: module&#125;</span><br><span class="line">    if attached_to is not None:</span><br><span class="line">            def __reduce__(self):</span><br><span class="line">               # Exceptions are special - they&#39;ve got state that isn&#39;t</span><br><span class="line">               # in self.__dict__. We assume it is all in self.args.</span><br><span class="line">               return (unpickle_inner_exception, (attached_to, name), self.args)</span><br><span class="line"></span><br><span class="line">            def __setstate__(self, args):</span><br><span class="line">               self.args &#x3D; args</span><br><span class="line"></span><br><span class="line">        class_dict[&#39;__reduce__&#39;] &#x3D; __reduce__</span><br><span class="line">        class_dict[&#39;__setstate__&#39;] &#x3D; __setstate__</span><br><span class="line"></span><br><span class="line">    return type(name, parents, class_dict)</span><br></pre></td></tr></table></figure>
<p>å¾ˆå¤šåŒå­¦ä¼šå¥½å¥‡ï¼Œtype ä¸æ˜¯ä¸€èˆ¬æ¥æ£€æµ‹Pythonå˜é‡çš„ç±»å‹çš„å˜›ï¼Œæ€ä¹ˆåœ¨è¿™é‡Œç«Ÿç„¶å¯ä»¥æ¥å—è¿™ä¹ˆå¤šå‚æ•°ï¼Œåœ¨è¿™é‡Œä»–çš„ç”¨æ³•åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ è¿™å°±æ¶‰åŠåˆ°äº†Python çš„å…ƒç±»(metaclass)ç›¸å…³çŸ¥è¯†ï¼Œè€ŒORMï¼Œåˆ™æ˜¯å…ƒç±»çš„åº”ç”¨ä¹‹ä¸€ã€‚</p>
<h3 id="ç±»å’Œå®ä¾‹"><a href="#ç±»å’Œå®ä¾‹" class="headerlink" title="ç±»å’Œå®ä¾‹"></a>ç±»å’Œå®ä¾‹</h3><blockquote>
<p>é¢å‘å¯¹è±¡æœ€é‡è¦çš„æ¦‚å¿µå°±æ˜¯ç±»ï¼ˆClassï¼‰å’Œå®ä¾‹ï¼ˆInstanceï¼‰ï¼Œå¿…é¡»ç‰¢è®°ç±»æ˜¯æŠ½è±¡çš„æ¨¡æ¿ï¼Œæ¯”å¦‚Studentç±»ï¼Œè€Œå®ä¾‹æ˜¯æ ¹æ®ç±»åˆ›å»ºå‡ºæ¥çš„ä¸€ä¸ªä¸ªå…·ä½“çš„â€œå¯¹è±¡â€ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ç›¸åŒçš„æ–¹æ³•ï¼Œä½†å„è‡ªçš„æ•°æ®å¯èƒ½ä¸åŒã€‚</p>
</blockquote>
<p>ä»ä»¥Studentç±»ä¸ºä¾‹ï¼Œåœ¨Pythonä¸­ï¼Œå®šä¹‰ç±»æ˜¯é€šè¿‡classå…³é”®å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>classåé¢ç´§æ¥ç€æ˜¯ç±»åï¼Œå³Studentï¼Œç±»åé€šå¸¸æ˜¯å¤§å†™å¼€å¤´çš„å•è¯ï¼Œç´§æ¥ç€æ˜¯(object)ï¼Œè¡¨ç¤ºè¯¥ç±»æ˜¯ä»å“ªä¸ªç±»ç»§æ‰¿ä¸‹æ¥çš„ï¼Œç»§æ‰¿çš„æ¦‚å¿µæˆ‘ä»¬åé¢å†è®²ï¼Œé€šå¸¸ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„ç»§æ‰¿ç±»ï¼Œå°±ä½¿ç”¨objectç±»ï¼Œè¿™æ˜¯æ‰€æœ‰ç±»æœ€ç»ˆéƒ½ä¼šç»§æ‰¿çš„ç±»ã€‚</p>
<p>å®šä¹‰å¥½äº†Studentç±»ï¼Œå°±å¯ä»¥æ ¹æ®Studentç±»åˆ›å»ºå‡ºStudentçš„å®ä¾‹ï¼Œåˆ›å»ºå®ä¾‹æ˜¯é€šè¿‡ç±»å+()å®ç°çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart &#x3D; Student()</span><br><span class="line">&gt;&gt;&gt; bart</span><br><span class="line">&lt;__main__.Student object at 0x10a67a590&gt;</span><br><span class="line">&gt;&gt;&gt; Student</span><br><span class="line">&lt;class &#39;__main__.Student&#39;&gt;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå˜é‡bartæŒ‡å‘çš„å°±æ˜¯ä¸€ä¸ªStudentçš„objectï¼Œåé¢çš„0x10a67a590æ˜¯å†…å­˜åœ°å€ï¼Œæ¯ä¸ªobjectçš„åœ°å€éƒ½ä¸ä¸€æ ·ï¼Œè€ŒStudentæœ¬èº«åˆ™æ˜¯ä¸€ä¸ªç±»ã€‚<br>å¯ä»¥è‡ªç”±åœ°ç»™ä¸€ä¸ªå®ä¾‹å˜é‡ç»‘å®šå±æ€§ï¼Œæ¯”å¦‚ï¼Œç»™å®ä¾‹bartç»‘å®šä¸€ä¸ªnameå±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart.name &#x3D; &#39;Bart Simpson&#39;</span><br><span class="line">&gt;&gt;&gt; bart.name</span><br><span class="line">&#39;Bart Simpson&#39;</span><br></pre></td></tr></table></figure>
<p>ç”±äºç±»å¯ä»¥èµ·åˆ°æ¨¡æ¿çš„ä½œç”¨ï¼Œå› æ­¤ï¼Œå¯ä»¥åœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼ŒæŠŠä¸€äº›æˆ‘ä»¬è®¤ä¸ºå¿…é¡»ç»‘å®šçš„å±æ€§å¼ºåˆ¶å¡«å†™è¿›å»ã€‚é€šè¿‡å®šä¹‰ä¸€ä¸ªç‰¹æ®Šçš„<strong>init</strong>æ–¹æ³•ï¼Œåœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œå°±æŠŠnameï¼Œscoreç­‰å±æ€§ç»‘ä¸Šå»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°<strong>init</strong>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œæ˜¯selfï¼Œè¡¨ç¤ºåˆ›å»ºçš„å®ä¾‹æœ¬èº«ï¼Œå› æ­¤ï¼Œåœ¨<strong>init</strong>æ–¹æ³•å†…éƒ¨ï¼Œå°±å¯ä»¥æŠŠå„ç§å±æ€§ç»‘å®šåˆ°selfï¼Œå› ä¸ºselfå°±æŒ‡å‘åˆ›å»ºçš„å®ä¾‹æœ¬èº«ã€‚</p>
<p>æœ‰äº†<strong>init</strong>æ–¹æ³•ï¼Œåœ¨åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œå°±ä¸èƒ½ä¼ å…¥ç©ºçš„å‚æ•°äº†ï¼Œå¿…é¡»ä¼ å…¥ä¸<strong>init</strong>æ–¹æ³•åŒ¹é…çš„å‚æ•°ï¼Œä½†selfä¸éœ€è¦ä¼ ï¼ŒPythonè§£é‡Šå™¨è‡ªå·±ä¼šæŠŠå®ä¾‹å˜é‡ä¼ è¿›å»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart &#x3D; Student(&#39;Bart Simpson&#39;, 59)</span><br><span class="line">&gt;&gt;&gt; bart.name</span><br><span class="line">&#39;Bart Simpson&#39;</span><br><span class="line">&gt;&gt;&gt; bart.score</span><br><span class="line">59</span><br></pre></td></tr></table></figure>
<p>å’Œæ™®é€šçš„å‡½æ•°ç›¸æ¯”ï¼Œåœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°åªæœ‰ä¸€ç‚¹ä¸åŒï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œæ˜¯å®ä¾‹å˜é‡selfï¼Œå¹¶ä¸”ï¼Œè°ƒç”¨æ—¶ï¼Œä¸ç”¨ä¼ é€’è¯¥å‚æ•°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç±»çš„æ–¹æ³•å’Œæ™®é€šå‡½æ•°æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰€ä»¥ï¼Œä½ ä»ç„¶å¯ä»¥ç”¨é»˜è®¤å‚æ•°ã€å¯å˜å‚æ•°å’Œå…³é”®å­—å‚æ•°ã€‚</p>
<h2 id="æ•°æ®å°è£…"><a href="#æ•°æ®å°è£…" class="headerlink" title="æ•°æ®å°è£…"></a>æ•°æ®å°è£…</h2><p>é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯æ•°æ®å°è£…ã€‚åœ¨ä¸Šé¢çš„Studentç±»ä¸­ï¼Œæ¯ä¸ªå®ä¾‹å°±æ‹¥æœ‰å„è‡ªçš„nameå’Œscoreè¿™äº›æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°æ¥è®¿é—®è¿™äº›æ•°æ®ï¼Œæ¯”å¦‚æ‰“å°ä¸€ä¸ªå­¦ç”Ÿçš„æˆç»©ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def print_score(std):</span><br><span class="line">...     print &#39;%s: %s&#39; % (std.name, std.score)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; print_score(bart)</span><br><span class="line">Bart Simpson: 59</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œæ—¢ç„¶Studentå®ä¾‹æœ¬èº«å°±æ‹¥æœ‰è¿™äº›æ•°æ®ï¼Œè¦è®¿é—®è¿™äº›æ•°æ®ï¼Œå°±æ²¡æœ‰å¿…è¦ä»å¤–é¢çš„å‡½æ•°å»è®¿é—®ï¼Œå¯ä»¥ç›´æ¥åœ¨Studentç±»çš„å†…éƒ¨å®šä¹‰è®¿é—®æ•°æ®çš„å‡½æ•°ï¼Œè¿™æ ·ï¼Œå°±æŠŠâ€œæ•°æ®â€ç»™å°è£…èµ·æ¥äº†ã€‚è¿™äº›å°è£…æ•°æ®çš„å‡½æ•°æ˜¯å’ŒStudentç±»æœ¬èº«æ˜¯å…³è”èµ·æ¥çš„ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç±»çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line"></span><br><span class="line">    def __init__(self, name, score):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.score &#x3D; score</span><br><span class="line"></span><br><span class="line">    def print_score(self):</span><br><span class="line">        print &#39;%s: %s&#39; % (self.name, self.score)</span><br></pre></td></tr></table></figure>
<p>è¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯selfå¤–ï¼Œå…¶ä»–å’Œæ™®é€šå‡½æ•°ä¸€æ ·ã€‚è¦è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œåªéœ€è¦åœ¨å®ä¾‹å˜é‡ä¸Šç›´æ¥è°ƒç”¨ï¼Œé™¤äº†selfä¸ç”¨ä¼ é€’ï¼Œå…¶ä»–å‚æ•°æ­£å¸¸ä¼ å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart.print_score()</span><br><span class="line">Bart Simpson: 59</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨çœ‹Studentç±»ï¼Œå°±åªéœ€è¦çŸ¥é“ï¼Œåˆ›å»ºå®ä¾‹éœ€è¦ç»™å‡ºnameå’Œscoreï¼Œè€Œå¦‚ä½•æ‰“å°ï¼Œéƒ½æ˜¯åœ¨Studentç±»çš„å†…éƒ¨å®šä¹‰çš„ï¼Œè¿™äº›æ•°æ®å’Œé€»è¾‘è¢«â€œå°è£…â€èµ·æ¥äº†ï¼Œè°ƒç”¨å¾ˆå®¹æ˜“ï¼Œä½†å´ä¸ç”¨çŸ¥é“å†…éƒ¨å®ç°çš„ç»†èŠ‚ã€‚<br>å°è£…çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥ç»™Studentç±»å¢åŠ æ–°çš„æ–¹æ³•ï¼Œæ¯”å¦‚get_gradeï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Student(object):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    def get_grade(self):</span><br><span class="line">        if self.score &gt;&#x3D; 90:</span><br><span class="line">            return &#39;A&#39;</span><br><span class="line">        elif self.score &gt;&#x3D; 60:</span><br><span class="line">            return &#39;B&#39;</span><br><span class="line">        else:</span><br><span class="line">            return &#39;C&#39;</span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œget_gradeæ–¹æ³•å¯ä»¥ç›´æ¥åœ¨å®ä¾‹å˜é‡ä¸Šè°ƒç”¨ï¼Œä¸éœ€è¦çŸ¥é“å†…éƒ¨å®ç°ç»†èŠ‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart.get_grade()</span><br><span class="line">&#39;C&#39;</span><br></pre></td></tr></table></figure>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ç±»æ˜¯åˆ›å»ºå®ä¾‹çš„æ¨¡æ¿ï¼Œè€Œå®ä¾‹åˆ™æ˜¯ä¸€ä¸ªä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ï¼Œå„ä¸ªå®ä¾‹æ‹¥æœ‰çš„æ•°æ®éƒ½äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼›</p>
<p>æ–¹æ³•å°±æ˜¯ä¸å®ä¾‹ç»‘å®šçš„å‡½æ•°ï¼Œå’Œæ™®é€šå‡½æ•°ä¸åŒï¼Œæ–¹æ³•å¯ä»¥ç›´æ¥è®¿é—®å®ä¾‹çš„æ•°æ®ï¼›</p>
<p>é€šè¿‡åœ¨å®ä¾‹ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œæˆ‘ä»¬å°±ç›´æ¥æ“ä½œäº†å¯¹è±¡å†…éƒ¨çš„æ•°æ®ï¼Œä½†æ— éœ€çŸ¥é“æ–¹æ³•å†…éƒ¨çš„å®ç°ç»†èŠ‚ã€‚</p>
<p>å’Œé™æ€è¯­è¨€ä¸åŒï¼ŒPythonå…è®¸å¯¹å®ä¾‹å˜é‡ç»‘å®šä»»ä½•æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸¤ä¸ªå®ä¾‹å˜é‡ï¼Œè™½ç„¶å®ƒä»¬éƒ½æ˜¯åŒä¸€ä¸ªç±»çš„ä¸åŒå®ä¾‹ï¼Œä½†æ‹¥æœ‰çš„å˜é‡åç§°éƒ½å¯èƒ½ä¸åŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; bart &#x3D; Student(&#39;Bart Simpson&#39;, 59)</span><br><span class="line">&gt;&gt;&gt; lisa &#x3D; Student(&#39;Lisa Simpson&#39;, 87)</span><br><span class="line">&gt;&gt;&gt; bart.age &#x3D; 8</span><br><span class="line">&gt;&gt;&gt; bart.age</span><br><span class="line">8</span><br><span class="line">&gt;&gt;&gt; bart.__dict__</span><br><span class="line">&#123;&#39;name&#39;: &#39;Bart Simpson&#39;, &#39;score&#39;: 59, &#39;age&#39;: 8&#125;</span><br><span class="line">&gt;&gt;&gt; lisa.age</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">AttributeError: &#39;Student&#39; object has no attribute &#39;age&#39;</span><br></pre></td></tr></table></figure>

<h3 id="å¦‚ä½•åŠ¨æ€çš„åˆ›å»ºç±»ï¼Ÿ"><a href="#å¦‚ä½•åŠ¨æ€çš„åˆ›å»ºç±»ï¼Ÿ" class="headerlink" title="å¦‚ä½•åŠ¨æ€çš„åˆ›å»ºç±»ï¼Ÿ"></a>å¦‚ä½•åŠ¨æ€çš„åˆ›å»ºç±»ï¼Ÿ</h3><p>æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯é‡‡ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def create_class(class_name):</span><br><span class="line">    if class_name &#x3D;&#x3D; &quot;MyClass&quot;:</span><br><span class="line">        class MyClass():</span><br><span class="line">            pass</span><br><span class="line">        return MyClass</span><br><span class="line">    else:</span><br><span class="line">        class OtherClasss():</span><br><span class="line">            pass</span><br><span class="line">        return OtherClasss</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æ­¤ç±»æ–¹æ³•ï¼Œä¸èƒ½ç§°ä¹‹ä¸ºçœŸæ­£çš„åŠ¨æ€ï¼Œå› ä¸ºåªèƒ½æ”¯æŒæœ‰é™çš„ç±»çš„åˆ›å»ºï¼Œé‚£æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œèƒ½çœŸæ­£å®ç°åŠ¨æ€åˆ›å»ºä¸€äº›ç±»å‘¢ï¼Ÿ æ‰€ä»¥ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æåˆ°å…³é”®è¯typeäº†<br>ä½†æ˜¯ä¸æ­¤åŒæ—¶ï¼Œtypeè¿˜æœ‰å¦ä¸€ä¸ªç¥å¥‡çš„èƒ½åŠ›ï¼Œå°±æ˜¯å®ƒä¹Ÿèƒ½åŠ¨æ€çš„åˆ›å»ºç±»ã€‚typeå¯ä»¥æ¥å—ä¸€ä¸ªç±»çš„ç›¸å…³ä¿¡æ¯ä½œä¸ºå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªç±»ã€‚ ä¸‹é¢æ˜¯å…¶ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type(ç±»å, çˆ¶ç±»çš„å…ƒç»„ï¼ŒåŒ…å«å±æ€§çš„å­—å…¸)</span><br></pre></td></tr></table></figure>

<h3 id="ä»€ä¹ˆæ˜¯å…ƒç±»ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å…ƒç±»ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å…ƒç±»ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å…ƒç±»ï¼Ÿ</h3><p>ä¸Šé¢æåˆ°äº†ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå¯¹è±¡å°±å¿…é¡»æœ‰ç±»æ¥åˆ›å»ºï¼Œè€Œå…ƒç±»ï¼Œå°±æ˜¯ç”¨æ¥åˆ›å»ºè¿™ç§ç±»çš„ã€‚ç®€å•æ¥è¯´ï¼Œç”¨äºåˆ›å»ºç±»çš„ç±»ï¼Œå°±æ˜¯å…ƒç±»ã€‚ å¯ä»¥ç†è§£ä¸ºä¸€ä¸‹è¿™ç§æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MyClass &#x3D; MetaClass()</span><br><span class="line">MyObject &#x3D; MyClass()</span><br></pre></td></tr></table></figure>
<p>è€Œtypeï¼Œå°±æ˜¯å…ƒç±»ï¼Œäºæ˜¯åˆ›å»ºä¸€ä¸ªç±»ï¼Œå°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¿™ç§æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MyClass &#x3D; type(&quot;MyClass&quot;, (), &#123;&#125;)</span><br><span class="line">MyObject &#x3D; MyClass()</span><br></pre></td></tr></table></figure>
<h3 id="ç±»çš„-metaclass-å±æ€§"><a href="#ç±»çš„-metaclass-å±æ€§" class="headerlink" title="ç±»çš„_metaclass_å±æ€§"></a>ç±»çš„_metaclass_å±æ€§</h3><p>å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±»çš„æ—¶å€™ä¸ºå…¶æ·»åŠ <strong>metaclass</strong>å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo(object):</span><br><span class="line">    __metaclass__ &#x3D; somethingâ€¦</span><br><span class="line">[â€¦]</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼ŒPythonå°±ä¼šé‡‡ç”¨ä½ æŒ‡å®šçš„æ–¹æ³•ï¼Œæ¥åˆ›å»ºè¿™ä¸ªç±»ï¼Œå¦åˆ™ï¼Œä¼šä½¿ç”¨typeæ¥åˆ›å»ºè¿™ä¸ªç±»ï¼Œä¸‹é¢æ¼”ç¤ºå¦‚ä½•è‡ªå®šä¹‰çš„æŒ‡å®šmetaclasså±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def lower_attr(class_name, class_parents, class_attr):</span><br><span class="line">    lower_attr &#x3D; &#123;&#125;</span><br><span class="line">    for name, val in class_attr.items():</span><br><span class="line">        if name.startswith(&#39;__&#39;):</span><br><span class="line">           lower_attr[name] &#x3D; val</span><br><span class="line">        else:</span><br><span class="line">           lower_attr[name.lower()] &#x3D; val</span><br><span class="line">    return type(class_name, class_parents, lower_attr)</span><br><span class="line"></span><br><span class="line">class MyClss():</span><br><span class="line">    __metaclass__ &#x3D; lower_attr</span><br><span class="line">    A &#x3D; &#39;A&#39;</span><br><span class="line">    b &#x3D; &#39;b&#39;</span><br><span class="line"></span><br><span class="line">my_class &#x3D; MyClss()</span><br><span class="line"></span><br><span class="line">print(hasattr(my_class, &#39;A&#39;)) # False</span><br><span class="line">print(hasattr(my_class, &#39;b&#39;)) # True</span><br><span class="line">print(hasattr(my_class, &#39;a&#39;)) # True</span><br></pre></td></tr></table></figure>

<h2 id="å¦‚ä½•è‡ªå·±å®ç°ORMï¼Ÿ"><a href="#å¦‚ä½•è‡ªå·±å®ç°ORMï¼Ÿ" class="headerlink" title="å¦‚ä½•è‡ªå·±å®ç°ORMï¼Ÿ"></a>å¦‚ä½•è‡ªå·±å®ç°ORMï¼Ÿ</h2><p>é¦–å…ˆæ¥å®šä¹‰Fieldç±»ï¼Œå®ƒè´Ÿè´£ä¿å­˜æ•°æ®åº“è¡¨çš„å­—æ®µåå’Œå­—æ®µçš„ç±»å‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Field(object):</span><br><span class="line">    def __init__(self, name, column_type):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.column_type &#x3D; column_type</span><br></pre></td></tr></table></figure>
<p>åœ¨Fieldçš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥å®šä¹‰å„ç§å…·ä½“ç±»å‹çš„Fieldï¼Œæ¯”å¦‚StringFieldï¼ŒIntegerFieldç­‰ç­‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class StringField(Field):</span><br><span class="line">    def __init__(self, name, max_length):</span><br><span class="line">        super(StringField, self).__init__(name, &#39;varchar(%d)&#39; % max_length)</span><br><span class="line"></span><br><span class="line">class IntegerField(Field):</span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        super(IntegerField, self).__init__(name, &#39;int&#39;)</span><br></pre></td></tr></table></figure>
<p>ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯ç¼–å†™æœ€å¤æ‚çš„ModelMetaclassäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ModelMetaclass(type):</span><br><span class="line">    def __new__(cls, name, bases, attrs):</span><br><span class="line">        if name &#x3D;&#x3D; &#39;Model&#39;:</span><br><span class="line">            return type.__new__(cls, name, bases, attrs)</span><br><span class="line">        print(&#39;Found model: %s&#39; % name)</span><br><span class="line">        mappings &#x3D; dict()</span><br><span class="line">        for k, v in attrs.items():</span><br><span class="line">            if isinstance(v, Field):</span><br><span class="line">                mappings[k] &#x3D; v</span><br><span class="line">        for k in mappings.keys():</span><br><span class="line">            attrs.pop(k)</span><br><span class="line">        attrs[&#39;__mappings__&#39;] &#x3D; mappings</span><br><span class="line">        attrs[&#39;__table__&#39;] &#x3D; name</span><br><span class="line">        return type.__new__(cls, name, bases, attrs)</span><br></pre></td></tr></table></figure>
<p>ä»¥åŠåŸºç±»Modelï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Model(dict, metaclass&#x3D;ModelMetaclass):</span><br><span class="line"></span><br><span class="line">    def __init__(self, **kw):</span><br><span class="line">        super(Model, self).__init__(**kw)</span><br><span class="line"></span><br><span class="line">    def __getattr__(self, key):</span><br><span class="line">        try:</span><br><span class="line">            return self[key]</span><br><span class="line">        except KeyError:</span><br><span class="line">            raise AttributeError(r&quot;&#39;Model&#39; object has no attribute &#39;%s&#39;&quot; % key)</span><br><span class="line"></span><br><span class="line">    def __setattr__(self, key, value):</span><br><span class="line">        self[key] &#x3D; value</span><br><span class="line"></span><br><span class="line">    def save(self):</span><br><span class="line">        fields &#x3D; []</span><br><span class="line">        params &#x3D; []</span><br><span class="line">        args &#x3D; []</span><br><span class="line">        for k, v in self.__mappings__.items():</span><br><span class="line">            fields.append(v.name)</span><br><span class="line">            params.append(&#39;?&#39;)</span><br><span class="line">            args.append(getattr(self, k, None))</span><br><span class="line">        sql &#x3D; &#39;insert into %s (%s) values (%s)&#39; % (self.__table__, &#39;,&#39;.join(fields), &#39;,&#39;.join(params))</span><br><span class="line">        print(&#39;SQL: %s&#39; % sql)</span><br><span class="line">        print(&#39;ARGS: %s&#39; % str(args))</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºUserç±»ï¼Œå¹¶è°ƒç”¨saveæ–¹æ³•ï¼Œä¿å­˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class User(Model):</span><br><span class="line">    id &#x3D; IntegerField(&#39;id&#39;)</span><br><span class="line">    name &#x3D; StringField(&#39;username&#39;, max_length&#x3D;48)</span><br><span class="line">    email &#x3D; StringField(&#39;email&#39;, max_length&#x3D;128)</span><br><span class="line">    password &#x3D; StringField(&#39;password&#39;, max_length&#x3D;24)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼š</span><br><span class="line">u &#x3D; User(id&#x3D;12345, name&#x3D;&#39;xiaoming&#39;, email&#x3D;&#39;xiaoming@xiaomi.com&#39;, password&#x3D;&#39;test&#39;)</span><br><span class="line"># ä¿å­˜åˆ°æ•°æ®åº“ï¼š</span><br><span class="line">u.save()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ï¼Œæˆ‘ä»¬å°±ç®€å•å®ç°äº†ä¸€ä¸ªORMã€‚</p>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="https://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/001386820064557c69858840b4c48d2b8411bc2ea9099ba000" target="_blank" rel="noopener">ä½¿ç”¨å…ƒç±» - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»™å¤§å®¶å®‰åˆ©å‡ ä¸ª Flask å­¦ä¹ èµ„æº</title>
    <url>/2020/04/23/%E7%BB%99%E5%A4%A7%E5%AE%B6%E5%AE%89%E5%88%A9%E5%87%A0%E4%B8%AA-Flask-%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90/</url>
    <content><![CDATA[<h2 id="ç»™å¤§å®¶å®‰åˆ©å‡ ä¸ª-Flask-å­¦ä¹ èµ„æº"><a href="#ç»™å¤§å®¶å®‰åˆ©å‡ ä¸ª-Flask-å­¦ä¹ èµ„æº" class="headerlink" title="ç»™å¤§å®¶å®‰åˆ©å‡ ä¸ª Flask å­¦ä¹ èµ„æº"></a>ç»™å¤§å®¶å®‰åˆ©å‡ ä¸ª Flask å­¦ä¹ èµ„æº</h2><p>Flask æ˜¯ Python ä¸­æœ€æµè¡Œçš„ Web æ¡†æ¶ä¹‹ä¸€ï¼Œä»¥å°å·§ã€çµæ´»ã€å¯æ‰©å±•æ€§å¼ºè‘—ç§°ï¼Œç›¸æ¯” Djangoï¼Œå®ƒç»™äº†å¼€å‘è€…æœ€å¤§é™åº¦çš„è‡ªç”±ï¼Œå¦‚æœä½ ä¸å–œæ¬¢å…³ç³»å‹æ•°æ®åº“ï¼Œokï¼Œæ²¡é—®é¢˜ï¼Œåˆ‡æ¢æˆæœ¬éå¸¸ä½ï¼Œè€Œ Django å‘¢ï¼Ÿä½ èƒ½é‡åˆ°çš„é—®é¢˜å®ƒéƒ½å¸®ä½ æƒ³å¥½å¹¶ä¸”æä¾›äº†å¯¹åº”è§£å†³æ–¹æ¡ˆï¼Œä½ è‡ªå·±å°±ä¸è¦å»é‡å¤é€ è½®å­äº†ï¼Œæ¯”å¦‚æ¨¡ç‰ˆå¼•æ“ï¼ŒORMï¼Œä¸çˆ½æƒ³æ›¿æ¢ï¼Ÿè¿™ä¸ªæœ‰ç‚¹éš¾ã€‚</p>
<h3 id="1-The-Flask-Mega-Tutorial-æ•™ç¨‹"><a href="#1-The-Flask-Mega-Tutorial-æ•™ç¨‹" class="headerlink" title="1. The Flask Mega-Tutorial æ•™ç¨‹"></a>1. The Flask Mega-Tutorial æ•™ç¨‹</h3><p>è¿™ä¸ªæ•™ç¨‹æ˜¯ã€ŠFlask Webå¼€å‘ï¼šåŸºäºPythonçš„Webåº”ç”¨å¼€å‘å®æˆ˜ã€‹ä½œè€… Miguel Grinberg å†™çš„ 2017ç‰ˆ Flask æ•™ç¨‹ï¼Œä¹Ÿæ˜¯æˆ‘å¼ºçƒˆæ¨èç»™å¤§å®¶çš„ Flask æ•™ç¨‹ï¼Œè‹±è¯­é˜…è¯»æ°´å¹³è¿‡å¾—å»çš„è¯ï¼Œå»ºè®®ç›´æ¥è¯»åŸæ–‡ï¼Œè‹±è¯­æ¸£ä¹Ÿæœ‰ç¦éŸ³ï¼Œå›½å†…å·²æœ‰ç½‘å‹æŠŠå®ƒç¿»è¯‘æˆäº†ä¸­æ–‡ã€‚</p>
<p><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world" target="_blank" rel="noopener">è‹±æ–‡åœ°å€</a><br><a href="https://github.com/luhuisicnu/The-Flask-Mega-Tutorial-zh" target="_blank" rel="noopener">ä¸­æ–‡åœ°å€</a></p>
<h3 id="2-Flaskä¹‹æ—…"><a href="#2-Flaskä¹‹æ—…" class="headerlink" title="2. Flaskä¹‹æ—…"></a>2. Flaskä¹‹æ—…</h3><p>å¦‚æœä½ å·²ç»å…¥é—¨äº†Flaskï¼Œè‚¯å®šå¸Œæœ›æœ‰ä¸€ä¸ª Flask æœ€ä½³å®è·µæŒ‡å—ï¼Œè®©ä½ çš„ Flask é¡¹ç›®çœ‹èµ·æ¥æ›´åŠ  professionalï¼Œè€Œæœ¬ä¹¦æ¶‰åŠçš„ä¸»é¢˜å°±æ˜¯Flaskçš„æœ€ä½³ç¼–ç¨‹å®è·µå’Œæ¨¡å¼ã€‚å°½é‡é¿å…å•°å—¦å®˜æ–¹æ–‡æ¡£ä¸­æåˆ°çš„å†…å®¹ï¼ŒåŒæ—¶ä¹Ÿä¼šå†æ¬¡å¼ºè°ƒä¸€äº›æ¦‚å¿µæ¥åŠ æ·±å°è±¡ã€‚</p>
<p><a href="http://exploreflask.com/en/latest/" target="_blank" rel="noopener">è‹±æ–‡åœ°å€</a><br><a href="https://spacewander.github.io/explore-flask-zh/index.html" target="_blank" rel="noopener">ä¸­æ–‡åœ°å€</a></p>
<h3 id="3-Flask-æºç è§£æ"><a href="#3-Flask-æºç è§£æ" class="headerlink" title="3. Flask æºç è§£æ"></a>3. Flask æºç è§£æ</h3><p>å¦‚æœä½ å·²ç»ç†Ÿç»ƒæŒæ¡äº† Flask æ¡†æ¶ï¼Œæ˜¯ä¸æ˜¯æƒŠå¹äº Flask æ¡†æ¶èƒŒåçš„è®¾è®¡ç²¾é«“ï¼Œä¸€ä¸ªç²¾æ‚çš„Webæ¡†æ¶ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿäº†è§£å®ƒæœ€å¥½çš„åŠæ³•å°±æ˜¯çª¥æ¢å®ƒçš„æºç ï¼Œè¿˜å¥½ï¼Œè¿™ä»¶äº‹å·²ç»æœ‰äººå¸®ä½ åšäº†ã€‚</p>
<p><a href="http://cizixs.com/2017/01/13/flask-insight-context" target="_blank" rel="noopener">åœ°å€</a></p>
<h3 id="4-Awesome-Flask"><a href="#4-Awesome-Flask" class="headerlink" title="4. Awesome Flask"></a>4. Awesome Flask</h3><p>æœ€åå¼ºçƒˆæ¨èçš„æ˜¯è¿™ä¸ª Awesome ç³»åˆ—çš„ Flask èµ„æºå¤§é›†åˆï¼Œæ¶µç›–äº† Flask çš„å„æ–¹å„é¢ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹æ‰©å±•æ’ä»¶ä»¥åŠæ•™ç¨‹ã€ä¹¦ç±å’Œè§†é¢‘ã€PPTè¿˜æœ‰é¡¹ç›®ç»“æ„ç­‰ç­‰ã€‚</p>
<p><a href="https://github.com/humiaozuzu/awesome-flask" target="_blank" rel="noopener">åœ°å€</a></p>
<h3 id="5-Flask-for-Fun-and-Profit"><a href="#5-Flask-for-Fun-and-Profit" class="headerlink" title="5. Flask for Fun and Profit"></a>5. Flask for Fun and Profit</h3><p>Flask ä½œè€… Armin Ronacher åœ¨PyBay2016ä¸Šçš„ä¸€ä¸ªè§†é¢‘åˆ†äº«ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•æ„å»ºä¸€ä¸ªå¤§å‹å¤æ‚çš„æ˜“äºæµ‹è¯•çš„APIæœåŠ¡ã€‚åŒæ—¶è¿˜æœ‰åœ¨å¼€å‘Flaskçš„è¿‡ç¨‹çš„ä¸€äº›è®¾è®¡æ€æƒ³ã€‚</p>
<p><a href="https://www.youtube.com/watch?v=1ByQhAM5c1I" target="_blank" rel="noopener">è§†é¢‘åœ°å€</a><br><a href="https://speakerdeck.com/player/94a53afb6a524ad88f301f62166a27e4?" target="_blank" rel="noopener">PPT</a></p>
<h3 id="å†è¡¥å……ä¸€äº›å…¶å®ƒèµ„æºï¼š"><a href="#å†è¡¥å……ä¸€äº›å…¶å®ƒèµ„æºï¼š" class="headerlink" title="å†è¡¥å……ä¸€äº›å…¶å®ƒèµ„æºï¼š"></a>å†è¡¥å……ä¸€äº›å…¶å®ƒèµ„æºï¼š</h3><p>Flask Web å¼€å‘å…¥é—¨<br><a href="https://funhacks.gitbooks.io/head-first-flask/content/chapter02/section2.03.html" target="_blank" rel="noopener">https://funhacks.gitbooks.io/head-first-flask/content/chapter02/section2.03.html</a></p>
<p><a href="http://www.bjhee.com/flask-1.html" target="_blank" rel="noopener">Flaskå…¥é—¨ç³»åˆ—æ•™ç¨‹</a></p>
<p><a href="http://www.bjhee.com/flask-ad1.html" target="_blank" rel="noopener">Flaskè¿›é˜¶ç³»åˆ—æ•™ç¨‹</a></p>
<p>Full Stack Web Development with Flask (è§†é¢‘æ•™ç¨‹ï¼Œéœ€è¦ç¿»åœŸå•¬)<br><a href="https://github.com/realpython/discover-flask" target="_blank" rel="noopener">https://github.com/realpython/discover-flask</a></p>
<p>Full Stack Python<br><a href="https://www.fullstackpython.com/flask.html" target="_blank" rel="noopener">https://www.fullstackpython.com/flask.html</a></p>
]]></content>
      <categories>
        <category>Flask</category>
      </categories>
      <tags>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Django æ‰¾å›å¯†ç </title>
    <url>/2020/04/20/Django-%E6%89%BE%E5%9B%9E%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h2 id="Django-æ‰¾å›å¯†ç "><a href="#Django-æ‰¾å›å¯†ç " class="headerlink" title="Django æ‰¾å›å¯†ç "></a>Django æ‰¾å›å¯†ç </h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import random</span><br><span class="line">from django.shortcuts import render</span><br><span class="line">from django.contrib.auth.models import User</span><br><span class="line">from django.contrib.auth.hashers import make_password</span><br><span class="line"></span><br><span class="line">def findpassword(request):</span><br><span class="line">    button &#x3D; &quot;è·å–éªŒè¯ç &quot;</span><br><span class="line">    new_password &#x3D; False</span><br><span class="line">    </span><br><span class="line">    if request.method &#x3D;&#x3D; &quot;POST&quot;:</span><br><span class="line">        username &#x3D; request.POST.get(&quot;username&quot;,&#39;root&#39;)</span><br><span class="line">        VerificationCode &#x3D; request.POST.get(&quot;VerificationCode&quot;,&quot;&quot;)</span><br><span class="line">        password&#x3D; request.POST.get(&quot;password&quot;,&quot;&quot;)</span><br><span class="line">        user &#x3D; User.objects.filter(username&#x3D;username)</span><br><span class="line">        if not user:</span><br><span class="line">            tips &#x3D; f&quot;ç”¨æˆ·&#123;username&#125;ä¸å­˜åœ¨&quot;</span><br><span class="line">        else:</span><br><span class="line">            if not request.session.get(&quot;VerificationCode&quot;,&quot;&quot;):</span><br><span class="line">                button &#x3D; &quot;é‡ç½®å¯†ç &quot;</span><br><span class="line">                tips &#x3D; &quot;éªŒè¯ç å·²å‘é€&quot;</span><br><span class="line">                new_password &#x3D; True</span><br><span class="line">                VerificationCode &#x3D; str(random.randint(1000,9999))</span><br><span class="line">                request.session[&quot;VerificationCode&quot;] &#x3D; VerificationCode</span><br><span class="line">                user[0].email_user(&quot;æ‰¾å›å¯†ç &quot;,VerificationCode)</span><br><span class="line">            elif verificationCode &#x3D;&#x3D; request.session.get(&quot;verificationCode&quot;):</span><br><span class="line">                dj_ps &#x3D; make_password(password,None,&quot;pbkdf2_sha256&quot;)</span><br><span class="line">                user[0].password &#x3D; dj_ps</span><br><span class="line">                user[0].save()</span><br><span class="line">                del request.session[&quot;VerificationCode&quot;]</span><br><span class="line">                tips &#x3D; &quot;å¯†ç å·²é‡ç½®&quot;</span><br><span class="line">            else</span><br><span class="line">               tips &#x3D; &quot;éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è·å–&quot;</span><br><span class="line">               new_password &#x3D; False</span><br><span class="line">               def request.session[&quot;VerificationCode&quot;]</span><br><span class="line">      return render(request,&quot;user.html&quot;,locals())</span><br></pre></td></tr></table></figure>

<h3 id="ç”¨æˆ·modelçš„å®ç°"><a href="#ç”¨æˆ·modelçš„å®ç°" class="headerlink" title="ç”¨æˆ·modelçš„å®ç°"></a>ç”¨æˆ·modelçš„å®ç°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># models.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from django.db import models</span><br><span class="line">from django.contrib.auth.models import AbstractUser</span><br><span class="line"></span><br><span class="line">class MyUser(AbstractUser):</span><br><span class="line">    qq &#x3D; models.ChardField(&quot;QQ å·ç &quot;, max_length&#x3D;16)</span><br><span class="line">    weChat &#x3D; models.ChardField(&quot;å¾®ä¿¡&quot;, max_length&#x3D;100)</span><br><span class="line">    mobile &#x3D; models.ChardField(&quot;æ‰‹æœºå·ç &quot;, max_length&#x3D;11)</span><br><span class="line">    </span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.username</span><br></pre></td></tr></table></figure>

<h2 id="æ‰©å±•MyUser-Admin-ä¿¡æ¯"><a href="#æ‰©å±•MyUser-Admin-ä¿¡æ¯" class="headerlink" title="æ‰©å±•MyUser Admin ä¿¡æ¯"></a>æ‰©å±•MyUser Admin ä¿¡æ¯</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from .models import MyUser</span><br><span class="line">from django.contrib.auth.admin import UserAdmin</span><br><span class="line">from django.utils.translation import gettext_lazy as _</span><br><span class="line"></span><br><span class="line">@admin.register(MyUser)</span><br><span class="line">class MyUserAdmin(UserAdmin):</span><br><span class="line">    list_display &#x3D; [&quot;uername&quot;,&quot;email&quot;,&quot;mobile&quot;,&quot;qq&quot;,&quot;weChat&quot;]</span><br><span class="line">    fieldsets &#x3D; list(&quot;UserAdmin.fielsets&quot;)</span><br><span class="line">    fieldsets[1] &#x3D; (_(&quot;Personal info&quot;),&#123;&quot;fields&quot;: (&quot;first_name&quot;,&quot;last_name&quot;,&quot;email&quot;,&quot;mobile&quot;,&quot;qq&quot;,&quot;weChat&quot;))&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Adminåå°appè®¾ç½®"><a href="#Adminåå°appè®¾ç½®" class="headerlink" title="Adminåå°appè®¾ç½®"></a>Adminåå°appè®¾ç½®</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># __init__.py</span><br><span class="line"></span><br><span class="line">from django.apps import AppConfig</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">## ä¿®æ”¹appåœ¨adminåå°æ˜¾ç¤ºåç§°</span><br><span class="line">## default_app_configçš„å€¼æ¥è‡ªapps.pyç±»å</span><br><span class="line"></span><br><span class="line">default_app_config &#x3D; &quot;user.IndexConfig&quot;</span><br><span class="line"></span><br><span class="line"># è·å–å½“å‰appçš„å‘½å</span><br><span class="line">def get_current_app_name(_file):</span><br><span class="line">    return os.path.split(os.path.dirname(_file_)[-1])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># é‡å†™ç±» IndexConfig</span><br><span class="line">class IndexConfig(AppConfig):</span><br><span class="line">    name &#x3D; get_current_app_name(__file__)</span><br><span class="line">    verbose_name &#x3D; &quot;ç”¨æˆ·ç®¡ç†&quot;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django æ•°æ®ç±»å‹</title>
    <url>/2020/04/20/Django-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h2 id="Django-æ•°æ®ç±»å‹"><a href="#Django-æ•°æ®ç±»å‹" class="headerlink" title="Django æ•°æ®ç±»å‹"></a>Django æ•°æ®ç±»å‹</h2><table>
<thead>
<tr>
<th>è¡¨å­—æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>models.Auto.Field</td>
<td>é»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºIDçš„å­—æ®µå¹¶ä¸ºintç±»å‹</td>
</tr>
<tr>
<td>models.CharField</td>
<td>å­—ç¬¦ä¸²ç±»å‹</td>
</tr>
<tr>
<td>models.BooleanField</td>
<td>å¸ƒå°”ç±»å‹</td>
</tr>
<tr>
<td>models.ComaSeparatedIntegerField</td>
<td>ç”¨é€—å·åˆ†éš”çš„æ•´æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.DateField</td>
<td>æ—¥æœŸ(date)ç±»å‹</td>
</tr>
<tr>
<td>models.DateTimeFile</td>
<td>æ—¥æœŸ(datetime)ç±»å‹</td>
</tr>
<tr>
<td>models.Decimal</td>
<td>åè¿›åˆ¶å°æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.EmailField</td>
<td>å­—ç¬¦ä¸²ç±»å‹(æ­£åˆ™è¡¨è¾¾å¼é‚®ç®±)</td>
</tr>
<tr>
<td>models.FloatField</td>
<td>æµ®ç‚¹ç±»å‹</td>
</tr>
<tr>
<td>models.IntegerField</td>
<td>æ•´æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.BigIntegerField</td>
<td>é•¿æ•´æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.IPAddressField</td>
<td>å­—ç¬¦ä¸²ç±»å‹(æ­£åˆ™è¡¨è¾¾å¼)</td>
</tr>
<tr>
<td>models.GenericIPAddressField</td>
<td>å­—ç¬¦ä¸²ç±»å‹ï¼Œå‚æ•°protocalå¯ä»¥æ˜¯: both,IPv4å’ŒIPv6ï¼ŒéªŒè¯IPåœ°å€</td>
</tr>
<tr>
<td>models.NullBooleanField</td>
<td>å…è®¸ä¸ºç©ºçš„å¸ƒå°”ç±»å‹</td>
</tr>
<tr>
<td>models.PositiveIntegerField</td>
<td>æ­£æ•´æ•°çš„æ•´æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.PositiveSmallIntegerField</td>
<td>å°æ­£æ•´æ•°ç±»å‹</td>
</tr>
<tr>
<td>models.SlugField</td>
<td>åŒ…å«å­—æ¯/æ•°å­—/ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå¸¸ç”¨è¯­URL</td>
</tr>
<tr>
<td>models.SmallIntergerField</td>
<td>å°æ•´æ•°ç±»å‹ï¼Œå–å€¼èŒƒå›´æ˜¯(-32,768~+32,767)</td>
</tr>
<tr>
<td>models.TextField</td>
<td>é•¿æ–‡æœ¬ç±»å‹</td>
</tr>
<tr>
<td>models.Timefiled</td>
<td>æ—¶é—´ç±»å‹ï¼Œæ˜¾ç¤ºæ—¶åˆ†ç§’</td>
</tr>
<tr>
<td>models.URLField</td>
<td>å­—ç¬¦ä¸²ï¼Œåœ°å€ä¸ºæ­£åˆ™è¡¨è¾¾å¼</td>
</tr>
<tr>
<td>models.BinaryField</td>
<td>äºŒè¿›åˆ¶æ•°æ®ç±»å‹</td>
</tr>
</tbody></table>
<h3 id="è¡¨å­—æ®µå‚æ•°è®¾ç½®"><a href="#è¡¨å­—æ®µå‚æ•°è®¾ç½®" class="headerlink" title="è¡¨å­—æ®µå‚æ•°è®¾ç½®"></a>è¡¨å­—æ®µå‚æ•°è®¾ç½®</h3><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Null</td>
<td>å¦‚ä¸ºTrue,å­—æ®µæ˜¯å¦å¯ä»¥ä¸ºç©º</td>
</tr>
<tr>
<td>Blank</td>
<td>å¦‚ä¸ºTrueï¼Œ è®¾ç½®åœ¨Adminåå°ç«™ç‚¹ç®¡ç†ä¸­æ·»åŠ æ•°æ®æ—¶å¯ä»¥å…è®¸ä¸ºç©ºå€¼</td>
</tr>
<tr>
<td>Default</td>
<td>è®¾ç½®ä¸ºé»˜è®¤å€¼</td>
</tr>
<tr>
<td>primary_key</td>
<td>å¦‚ä¸ºTrueï¼Œå°†å­—æ®µè®¾ç½®ä¸ºä¸»é”®</td>
</tr>
<tr>
<td>db_column</td>
<td>è®¾ç½®æ•°æ®åº“ä¸­çš„å­—æ®µåç§°</td>
</tr>
<tr>
<td>Unique</td>
<td>å¦‚ä¸ºTrue,å°†è‡ªç£åŠè®¾ç½®æˆå”¯ä¸€å±æ€§ï¼Œé»˜è®¤ä¸ºFalse</td>
</tr>
<tr>
<td>db_index</td>
<td>å¦‚ä¸ºTrueï¼Œå°†å­—æ®µæ·»åŠ æ•°æ®åº“ç´¢å¼•</td>
</tr>
<tr>
<td>verbose_name</td>
<td>åœ¨Adminç«™ç‚¹ç®¡ç†è®¾ç½®å­—æ®µçš„æ˜¾ç¤ºåç§°</td>
</tr>
<tr>
<td>related_name</td>
<td>å…³è”å¯¹è±¡åå‘é¥®ç”¨æè¿°ç¬¦ï¼Œç”¨äºå¤šè¡¨æŸ¥è¯¢ï¼Œå¯è§£å†³ä¸€ä¸ªæ•°æ®è¡¨æœ‰2ä¸ªå¤–é”®åŒæ—¶æŒ‡å‘å¦ä¸€ä¸ªæ•°æ®è¡¨è€Œå‡ºç°é‡åçš„é—®é¢˜</td>
</tr>
</tbody></table>
<h3 id="djangoå¸¸ç”¨çš„å†…ç½®å‡½æ•°"><a href="#djangoå¸¸ç”¨çš„å†…ç½®å‡½æ•°" class="headerlink" title="djangoå¸¸ç”¨çš„å†…ç½®å‡½æ•°"></a>djangoå¸¸ç”¨çš„å†…ç½®å‡½æ•°</h3><table>
<thead>
<tr>
<th>å†…ç½®å‡½æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>authenticate</td>
<td>éªŒè¯ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¿…é€‰å‚æ•°ä¸º<code>username</code>å’Œ<code>password</code>ï¼Œåªèƒ½ç”¨äºæ¨¡å‹User</td>
</tr>
<tr>
<td>create_user</td>
<td>åˆ›å»ºæ–°çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¿…é€‰å‚æ•°ä¸º<code>username</code>,åªèƒ½ç”¨äºæ¨¡å‹User</td>
</tr>
<tr>
<td>set_password</td>
<td>ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œå¿…é€‰å‚æ•°ä¸º<code>password</code>ï¼Œåªèƒ½ç”¨äºæ¨¡å‹User</td>
</tr>
<tr>
<td>login/logout</td>
<td>ç”¨æˆ·çš„çš„ç™»é™†å’Œæ³¨é”€ï¼Œåªèƒ½ç”¨äºæ¨¡å‹User</td>
</tr>
<tr>
<td>make_password</td>
<td>å¯†ç åŠ å¯†å¤„ç†ï¼Œå¿…é€‰å‚æ•°ä¸º<code>password</code>ï¼Œå¯è„±ç¦»æ¨¡å‹Userå•ç‹¬ä½¿ç”¨</td>
</tr>
<tr>
<td>check_password</td>
<td>æ ¡éªŒåŠ å¯†å‰åçš„å¯†ç æ˜¯å¦ç›¸åŒï¼Œå¯è„±ç¦»æ¨¡å‹Userå•ç‹¬ä½¿ç”¨</td>
</tr>
<tr>
<td>email_user</td>
<td>å‘é€é‚®ä»¶ï¼Œåªç”¨ç”¨äºæ¨¡å‹User</td>
</tr>
<tr>
<td>send_mail</td>
<td>å‘é€é‚®ä»¶</td>
</tr>
<tr>
<td>send_mass_mail</td>
<td>æ‰¹é‡å‘é€é‚®ä»¶</td>
</tr>
<tr>
<td>EmailMutilAlternatives</td>
<td>å‘é€è‡ªå®šä¹‰å†…å®¹æ ¼å¼çš„é‚®ä»¶</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Django REST framework APIè®¤è¯(åŒ…å«JWTè®¤è¯) + æƒé™</title>
    <url>/2020/04/20/Django-REST-framework-API%E8%AE%A4%E8%AF%81-%E5%8C%85%E5%90%ABJWT%E8%AE%A4%E8%AF%81-%E6%9D%83%E9%99%90/</url>
    <content><![CDATA[<h2 id="Django-REST-framework-APIè®¤è¯-åŒ…å«JWTè®¤è¯-æƒé™"><a href="#Django-REST-framework-APIè®¤è¯-åŒ…å«JWTè®¤è¯-æƒé™" class="headerlink" title="Django REST framework APIè®¤è¯(åŒ…å«JWTè®¤è¯) + æƒé™"></a>Django REST framework APIè®¤è¯(åŒ…å«JWTè®¤è¯) + æƒé™</h2><h3 id="ä¸€-èƒŒæ™¯"><a href="#ä¸€-èƒŒæ™¯" class="headerlink" title="ä¸€. èƒŒæ™¯"></a>ä¸€. èƒŒæ™¯</h3><p>åœ¨æˆ‘ä»¬å­¦ä¹ Django Rest Frameworkï¼ˆç®€ç§°DRFï¼‰æ—¶ï¼Œå…¶éå¸¸å‹å¥½åœ°ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¯æµè§ˆAPIçš„ç•Œé¢ã€‚å¾ˆå¤šæµ‹è¯•å·¥ä½œéƒ½å¯ä»¥åœ¨å¯æµè§ˆAPIç•Œé¢å®Œæˆæµ‹è¯•ã€‚è¦ä½¿ç”¨å¯æµè§ˆAPIç•Œé¢å¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨urls.pyæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹éƒ¨åˆ†å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import include</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-auth&#x2F;&#39;, include(&#39;rest_framework.urls&#39;,</span><br><span class="line">                               namespace&#x3D;&#39;rest_framework&#39;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œrâ€™^api-auth/â€˜éƒ¨åˆ†å®é™…ä¸Šå¯ä»¥ç”¨ä»»ä½•ä½ æƒ³ä½¿ç”¨URLæ›¿ä»£ã€‚å”¯ä¸€çš„é™åˆ¶æ˜¯æ‰€åŒ…å«çš„URLå¿…é¡»ä½¿ç”¨â€™rest_frameworkâ€™å‘½åç©ºé—´ã€‚åœ¨Django 1.9+ä¸­ï¼ŒREST frameworkå°†è‡ªåŠ¨è®¾ç½®ï¼Œæ‰€ä»¥ä½ ä¹Ÿæ— é¡»å…³å¿ƒã€‚</p>
<p>é…ç½®å®Œæˆåï¼Œå¦‚æœå†æ¬¡æ‰“å¼€æµè§ˆå™¨APIç•Œé¢å¹¶åˆ·æ–°é¡µé¢ï¼Œä½ å°†åœ¨é¡µé¢å³ä¸Šè§’çœ‹åˆ°ä¸€ä¸ªâ€œLog inâ€é“¾æ¥ã€‚è¿™å°±æ˜¯DRFæä¾›çš„ç™»å½•å’Œç™»å‡ºå…¥å£ï¼Œå¯ä»¥ç”¨æ¥å®Œæˆè®¤è¯ã€‚</p>
<p>ç„¶åè¿›å…¥åˆ°â€™rest_framework.urlsâ€™æºç ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°æä¾›äº†â€™loginâ€™å’Œâ€™logoutâ€™ä¸¤ä¸ªæ¥å£ï¼Œåˆ†åˆ«ç”¨æ¥ç™»å…¥å’Œç™»å½•çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if django.VERSION &lt; (1, 11):</span><br><span class="line">    login &#x3D; views.login</span><br><span class="line">    login_kwargs &#x3D; &#123;&#39;template_name&#39;: &#39;rest_framework&#x2F;login.html&#39;&#125;</span><br><span class="line">    logout &#x3D; views.logout</span><br><span class="line">else:</span><br><span class="line">    login &#x3D; views.LoginView.as_view(template_name&#x3D;&#39;rest_framework&#x2F;login.html&#39;)</span><br><span class="line">    login_kwargs &#x3D; &#123;&#125;</span><br><span class="line">    logout &#x3D; views.LogoutView.as_view()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">app_name &#x3D; &#39;rest_framework&#39;</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^login&#x2F;$&#39;, login, login_kwargs, name&#x3D;&#39;login&#39;),</span><br><span class="line">    url(r&#39;^logout&#x2F;$&#39;, logout, name&#x3D;&#39;logout&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­loginæ¥å£è°ƒç”¨LoginViewè§†å›¾ï¼Œlogoutæ¥å£è°ƒç”¨LogoutViewè§†å›¾ã€‚è¿™ä¸¤ä¸ªè§†å›¾éƒ½æ˜¯django.contrib.authåº”ç”¨æä¾›çš„ã€‚åœ¨LogoutViewè§†å›¾ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€ä¸ªè£…é¥°å™¨@method_decorator(csrf_protect)ï¼Œæ˜¯ç”¨æ¥åšCSRF codeéªŒè¯çš„ï¼Œå°±æ˜¯åšè¡¨å•å®‰å…¨éªŒè¯çš„ï¼Œé˜²æ­¢è·¨ç«™æ”»å‡»ã€‚è€Œè¿™ä¸ªCSRF codeæ˜¯åœ¨è¿”å›HTMLé¡µé¢çš„æ—¶å€™Djangoä¼šè‡ªåŠ¨æ³¨å†Œè¿™ä¹ˆä¸€ä¸ªCSRF codeæ–¹æ³•ï¼Œè€Œåœ¨templateä¸­ä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ç”Ÿæˆcodeå€¼ã€‚åœ¨å‰ç«¯é¡µé¢å…ƒç´ forméƒ¨åˆ†ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°name=â€csrfmiddlewaretokenâ€æ ‡è¯†ï¼Œä¸”åœ¨Djangoè¿”å›çš„ HTTP å“åº”çš„ cookie é‡Œï¼ŒDjango ä¼šä¸ºä½ æ·»åŠ ä¸€ä¸ªcsrftoken å­—æ®µï¼Œå…¶å€¼ä¸ºä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„tokenã€‚è¿™å°±æ˜¯ç”¨æ¥åšè¡¨å•å®‰å…¨éªŒè¯çš„ï¼Œå…·ä½“å…³äºCSRFåŸç†è§Djangoç« èŠ‚ã€‚</p>
<p>è¿™é‡Œè¦è¯´æ˜ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿™ä¸ªLoginViewæˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥æ‹¿æ¥ç”¨çš„ï¼Œå› ä¸ºå®ƒéœ€è¦åšCSRFéªŒè¯ï¼Œè€Œåœ¨å‰åç«¯åˆ†ç¦»ç³»ç»Ÿä¸­ä¸éœ€è¦åšCSRFéªŒè¯ï¼Œè¿™é‡Œä¸å­˜åœ¨ç«™å†…ç«™å¤–çš„é—®é¢˜ï¼Œæœ¬èº«å°±æ˜¯è·¨ç«™è®¿é—®çš„ã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬å‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ï¼Œå¦‚ä½•åšAPIæ¥å£çš„éªŒè¯å‘¢ï¼Ÿå…¶å®frameworkä¹Ÿå·²ç»æä¾›äº†å¤šç§éªŒè¯æ–¹å¼ã€‚</p>
<h3 id="äºŒ-èº«ä»½éªŒè¯"><a href="#äºŒ-èº«ä»½éªŒè¯" class="headerlink" title="äºŒ. èº«ä»½éªŒè¯"></a>äºŒ. èº«ä»½éªŒè¯</h3><p>REST frameworkæä¾›äº†è®¸å¤šå¼€ç®±å³ç”¨çš„èº«ä»½éªŒè¯æ–¹æ¡ˆï¼ŒåŒæ—¶ä¹Ÿå…è®¸ä½ å®æ–½è‡ªå®šä¹‰æ–¹æ¡ˆã€‚è¿™é‡Œéœ€è¦æ˜ç¡®ä¸€ä¸‹ç”¨æˆ·è®¤è¯ï¼ˆAuthenticationï¼‰å’Œç”¨æˆ·æˆæƒï¼ˆAuthorizationï¼‰æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œè®¤è¯è§£å†³çš„æ˜¯â€œæœ‰æ²¡æœ‰â€çš„é—®é¢˜ï¼Œè€Œæˆæƒè§£å†³çš„æ˜¯â€œèƒ½ä¸èƒ½â€çš„é—®é¢˜ã€‚</p>
<p>BasicAuthentication<br>è¯¥è®¤è¯æ–¹æ¡ˆä½¿ç”¨ HTTP Basic Authenticationï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç­¾åã€‚Basic Authentication é€šå¸¸åªé€‚ç”¨äºæµ‹è¯•ã€‚</p>
<p>SessionAuthentication<br>æ­¤è®¤è¯æ–¹æ¡ˆä½¿ç”¨ Django çš„é»˜è®¤ session åç«¯è¿›è¡Œè®¤è¯ã€‚Session èº«ä»½éªŒè¯é€‚ç”¨äºä¸æ‚¨çš„ç½‘ç«™åœ¨åŒä¸€ä¼šè¯ç¯å¢ƒä¸­è¿è¡Œçš„ AJAX å®¢æˆ·ç«¯ã€‚</p>
<p>TokenAuthentication<br>æ­¤è®¤è¯æ–¹æ¡ˆä½¿ç”¨ç®€å•çš„åŸºäºä»¤ç‰Œçš„ HTTP è®¤è¯æ–¹æ¡ˆã€‚ä»¤ç‰Œèº«ä»½éªŒè¯é€‚ç”¨äº client-server æ¶æ„ï¼Œä¾‹å¦‚æœ¬æœºæ¡Œé¢å’Œç§»åŠ¨å®¢æˆ·ç«¯ã€‚</p>
<p>RemoteUserAuthentication<br>è¿™ç§èº«ä»½éªŒè¯æ–¹æ¡ˆå…è®¸æ‚¨å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™æ‚¨çš„ Web æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨è®¾ç½® REMOTE_USER ç¯å¢ƒå˜é‡ã€‚</p>
<p>é»˜è®¤çš„è®¤è¯æ–¹æ¡ˆå¯ä»¥ä½¿ç”¨DEFAULT_AUTHENTICATION_CLASSESå…¨å±€è®¾ç½®ï¼Œåœ¨settings.pyæ–‡ä»¶é…ç½®ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒDRFå¼€å¯äº† BasicAuthentication ä¸ SessionAuthentication çš„è®¤è¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (</span><br><span class="line">        &#39;rest_framework.authentication.BasicAuthentication&#39;,</span><br><span class="line">        &#39;rest_framework.authentication.SessionAuthentication&#39;,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…³äºDRFï¼Œå‡ ä¹æ‰€æœ‰çš„é…ç½®éƒ½å®šä¹‰åœ¨MREST_FRAMEWORKå˜é‡ä¸­ã€‚å¦å¤–ï¼Œå…³äºè®¤è¯æ–¹å¼DRFé»˜è®¤ä¼šæ£€æµ‹é…ç½®åœ¨DEFAULT_AUTHENTICATION_CLASSESå˜é‡ä¸­çš„æ‰€æœ‰è®¤è¯æ–¹å¼ï¼Œåªè¦æœ‰ä¸€ä¸ªè®¤è¯æ–¹å¼é€šè¿‡å³å¯ç™»å½•æˆåŠŸã€‚è¿™é‡Œçš„DEFAULT_AUTHENTICATION_CLASSESä¸Djangoä¸­çš„MIDDLEWAREç±»ä¼¼ï¼Œåœ¨å°†requesté€šè¿‡urlæ˜ å°„åˆ°viewsä¹‹å‰ï¼ŒDjangoå’ŒDRFéƒ½ä¼šè°ƒç”¨å®šä¹‰åœ¨MREST_FRAMEWORKå˜é‡ä¸­çš„ç±»çš„ä¸€äº›æ–¹æ³•ã€‚<br>å¦å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨åŸºäºAPIViewç±»çš„è§†å›¾ï¼Œåœ¨æ¯ä¸ªè§†å›¾æˆ–æ¯ä¸ªè§†å›¾é›†çš„åŸºç¡€ä¸Šè®¾ç½®èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.authentication import SessionAuthentication, BasicAuthentication</span><br><span class="line">from rest_framework.permissions import IsAuthenticated</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line"> </span><br><span class="line">class ExampleView(APIView):</span><br><span class="line">    authentication_classes &#x3D; (SessionAuthentication, BasicAuthentication)</span><br><span class="line">    permission_classes &#x3D; (IsAuthenticated,)</span><br><span class="line"> </span><br><span class="line">    def get(self, request, format&#x3D;None):</span><br><span class="line">        content &#x3D; &#123;</span><br><span class="line">            &#39;user&#39;: unicode(request.user),  # &#96;django.contrib.auth.User&#96; instance.</span><br><span class="line">            &#39;auth&#39;: unicode(request.auth),  # None</span><br><span class="line">        &#125;</span><br><span class="line">        return Response(content)</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ˜ç™½çš„ä¸€ç‚¹æ˜¯ï¼ŒDRFçš„è®¤è¯æ˜¯åœ¨å®šä¹‰æœ‰æƒé™ç±»ï¼ˆpermission_classesï¼‰çš„è§†å›¾ä¸‹æ‰æœ‰ä½œç”¨ï¼Œä¸”æƒé™ç±»ï¼ˆpermission_classesï¼‰å¿…é¡»è¦æ±‚è®¤è¯ç”¨æˆ·æ‰èƒ½è®¿é—®æ­¤è§†å›¾ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰æƒé™ç±»ï¼ˆpermission_classesï¼‰ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€å…è®¸åŒ¿åç”¨æˆ·çš„è®¿é—®ï¼Œè‡ªç„¶ç‰µæ¶‰ä¸åˆ°è®¤è¯ç›¸å…³çš„é™åˆ¶äº†ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯åœ¨å…¨å±€é…ç½®DEFAULT_AUTHENTICATION_CLASSESè®¤è¯ï¼Œç„¶åä¼šå®šä¹‰å¤šä¸ªbase viewsï¼Œæ ¹æ®ä¸åŒçš„è®¿é—®éœ€æ±‚æ¥ç»§æ‰¿ä¸åŒçš„base viewså³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.permissions import (</span><br><span class="line">    IsAuthenticated,</span><br><span class="line">    IsAdminUser,</span><br><span class="line">    IsAuthenticatedOrReadOnly</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">class BaseView(APIView):</span><br><span class="line">    &#39;&#39;&#39;æ™®é€šç”¨æˆ·&#39;&#39;&#39;</span><br><span class="line">    permission_classes &#x3D; (</span><br><span class="line">        IsOwnerOrReadOnly,</span><br><span class="line">        IsAuthenticated</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">class SuperUserpermissions(APIView):</span><br><span class="line">    &#39;&#39;&#39;è¶…çº§ç”¨æˆ·&#39;&#39;&#39;</span><br><span class="line">    permission_classes &#x3D; (IsAdminUser,)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">class NotLogin(APIView):</span><br><span class="line">    &#39;&#39;&#39;åŒ¿åç”¨æˆ·&#39;&#39;&#39;</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œåœ¨å‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ä¸€èˆ¬ä¸ä¼šä½¿ç”¨ BasicAuthentication ä¸ SessionAuthentication çš„è®¤è¯æ–¹å¼ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒ TokenAuthentication è®¤è¯æ–¹å¼å³å¯ã€‚</p>
<h3 id="ä¸‰-TokenAuthentication"><a href="#ä¸‰-TokenAuthentication" class="headerlink" title="ä¸‰.TokenAuthentication"></a>ä¸‰.TokenAuthentication</h3><p>è¦ä½¿ç”¨<code>TokenAuthentication</code>æ–¹æ¡ˆï¼Œä½ éœ€è¦å°†è®¤è¯ç±»é…ç½®ä¸ºåŒ…å«<code>TokenAuthentication</code>ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (</span><br><span class="line">        &#39;rest_framework.authentication.BasicAuthentication&#39;,</span><br><span class="line">        &#39;rest_framework.authentication.SessionAuthentication&#39;,</span><br><span class="line">        &#39;rest_framework.authentication.TokenAuthentication&#39;,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¹¶åœ¨INSTALLED_APPSè®¾ç½®ä¸­å¦å¤–åŒ…å« rest_framework.authtokenï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS &#x3D; (</span><br><span class="line">    ...</span><br><span class="line">    &#39;rest_framework.authtoken&#39;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼š rest_framework.authtokenåº”ç”¨ä¸€å®šè¦æ”¾åˆ°INSTALLED_APPSï¼Œå¹¶ä¸”ç¡®ä¿åœ¨æ›´æ”¹è®¾ç½®åè¿è¡Œ<code>python manage.py migrate</code>ã€‚ rest_framework.authtokenåº”ç”¨éœ€è¦åˆ›å»ºä¸€å¼ è¡¨ç”¨æ¥å­˜å‚¨ç”¨æˆ·ä¸Tokençš„å¯¹åº”å…³ç³»ã€‚<br>æ•°æ®åº“è¿ç§»å®Œæˆåï¼Œå¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªauthtoken_tokenè¡¨ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; show create table authtoken_token\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: authtoken_token</span><br><span class="line">Create Table: CREATE TABLE &#96;authtoken_token&#96; (</span><br><span class="line">  &#96;key&#96; varchar(40) NOT NULL,</span><br><span class="line">  &#96;created&#96; datetime(6) NOT NULL,</span><br><span class="line">  &#96;user_id&#96; int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;key&#96;),</span><br><span class="line">  UNIQUE KEY &#96;user_id&#96; (&#96;user_id&#96;),</span><br><span class="line">  CONSTRAINT &#96;authtoken_token_user_id_35299eff_fk_auth_user_id&#96; FOREIGN KEY (&#96;user_id&#96;) REFERENCES &#96;auth_user&#96; (&#96;id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­â€œuser_idâ€å­—æ®µå…³è”åˆ°äº†ç”¨æˆ·è¡¨ã€‚</p>
<ul>
<li>é…ç½®URLconf<br>ä½¿ç”¨<code>TokenAuthentication</code>æ—¶ï¼Œä½ å¯èƒ½å¸Œæœ›ä¸ºå®¢æˆ·æä¾›ä¸€ç§æœºåˆ¶ï¼Œä»¥è·å–ç»™å®šç”¨æˆ·åå’Œå¯†ç çš„ä»¤ç‰Œã€‚ REST framework æä¾›äº†ä¸€ä¸ªå†…ç½®çš„è§†å›¾æ¥æ”¯æŒè¿™ç§è¡Œä¸ºã€‚è¦ä½¿ç”¨å®ƒï¼Œè¯·å°†<code>obtain_auth_token</code>è§†å›¾æ·»åŠ åˆ°æ‚¨çš„ URLconf ä¸­ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.authtoken import views</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-auth&#x2F;&#39;, views.obtain_auth_token)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
å…¶ä¸­ï¼Œ<code>r&#39;^api-token-auth/&#39;</code>éƒ¨åˆ†å®é™…ä¸Šå¯ä»¥ç”¨ä»»ä½•ä½ æƒ³ä½¿ç”¨URLæ›¿ä»£ã€‚</li>
<li>åˆ›å»ºToken<br>ä½ è¿˜éœ€è¦ä¸ºç”¨æˆ·åˆ›å»ºä»¤ç‰Œï¼Œç”¨æˆ·ä»¤ç‰Œä¸ç”¨æˆ·æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚å¦‚æœä½ å·²ç»åˆ›å»ºäº†ä¸€äº›ç”¨æˆ·ï¼Œåˆ™å¯ä»¥ä¸ºæ‰€æœ‰ç°æœ‰ç”¨æˆ·ç”Ÿæˆä»¤ç‰Œï¼Œä¾‹å¦‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.contrib.auth.models import User</span><br><span class="line">from rest_framework.authtoken.models import Token</span><br><span class="line"> </span><br><span class="line">for user in User.objects.all():</span><br><span class="line">    Token.objects.get_or_create(user&#x3D;user)</span><br></pre></td></tr></table></figure>
ä½ ä¹Ÿå¯ä»¥ä¸ºæŸä¸ªå·²ç»å­˜åœ¨çš„ç”¨æˆ·åˆ›å»ºTokenï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for user in User.objects.filter(username&#x3D;&#39;admin&#39;):</span><br><span class="line">    Token.objects.get_or_create(user&#x3D;user)</span><br></pre></td></tr></table></figure>
åˆ›å»ºæˆåŠŸåï¼Œä¼šåœ¨Tokenè¡¨ä¸­ç”Ÿæˆå¯¹åº”çš„Tokenä¿¡æ¯ã€‚</li>
</ul>
<p>å¦‚æœä½ å¸Œæœ›æ¯ä¸ªç”¨æˆ·éƒ½æ‹¥æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ä»¤ç‰Œï¼Œåˆ™åªéœ€æ•æ‰ç”¨æˆ·çš„<code>post_save</code>ä¿¡å·å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf import settings</span><br><span class="line">from django.db.models.signals import post_save</span><br><span class="line">from django.dispatch import receiver</span><br><span class="line">from rest_framework.authtoken.models import Token</span><br><span class="line"></span><br><span class="line">@receiver(post_save, sender&#x3D;settings.AUTH_USER_MODEL)</span><br><span class="line">def create_auth_token(sender, instance&#x3D;None, created&#x3D;False, **kwargs):</span><br><span class="line">    if created:</span><br><span class="line">        Token.objects.create(user&#x3D;instance)</span><br></pre></td></tr></table></figure>
<p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦ç¡®ä¿å°†æ­¤ä»£ç ç‰‡æ®µæ”¾ç½®åœ¨å·²å®‰è£…çš„models.pyæ¨¡å—æˆ– Django å¯åŠ¨æ—¶å°†å¯¼å…¥çš„å…¶ä»–æŸä¸ªä½ç½®ã€‚</p>
<ul>
<li>è·å–Token<br>ä¸Šé¢è™½ç„¶ä»‹ç»äº†å¤šç§åˆ›å»ºTokençš„æ–¹å¼ï¼Œå…¶å®æˆ‘ä»¬æœ€ç®€å•çš„å°±æ˜¯åªéœ€è¦é…ç½®ä¸€ä¸‹urls.pyï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æš´éœ²çš„APIæ¥è·å–Tokenäº†ã€‚å½“ä½¿ç”¨è¡¨å•æ•°æ®æˆ– JSON å°†æœ‰æ•ˆçš„usernameå’Œpasswordå­—æ®µå‘å¸ƒåˆ°è§†å›¾æ—¶ï¼Œobtain_auth_tokenè§†å›¾å°†è¿”å› JSON å“åº”ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -d &quot;username&#x3D;admin&amp;password&#x3D;admin123456&quot; http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;api-token-auth&#x2F;</span><br><span class="line">&#123;&quot;token&quot;:&quot;684b41712e8e38549504776613bd5612ba997616&quot;&#125;</span><br></pre></td></tr></table></figure>
è¯·æ³¨æ„ï¼Œç¼ºçœçš„<code>obtain_auth_token</code>è§†å›¾æ˜¾å¼ä½¿ç”¨ JSON è¯·æ±‚å’Œå“åº”ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä½ è®¾ç½®çš„é»˜è®¤çš„æ¸²æŸ“å™¨å’Œè§£æå™¨ç±»ã€‚</li>
</ul>
<p>å½“æˆ‘ä»¬æ­£å¸¸è·å–åˆ°Tokenåï¼Œ<code>obtain_auth_token</code>è§†å›¾ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åœ¨Tokenè¡¨ä¸­åˆ›å»ºå¯¹åº”çš„Tokenã€‚æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ObtainAuthToken(APIView):</span><br><span class="line">    throttle_classes &#x3D; ()</span><br><span class="line">    permission_classes &#x3D; ()</span><br><span class="line">    parser_classes &#x3D; (parsers.FormParser, parsers.MultiPartParser, parsers.JSONParser,)</span><br><span class="line">    renderer_classes &#x3D; (renderers.JSONRenderer,)</span><br><span class="line">    serializer_class &#x3D; AuthTokenSerializer</span><br><span class="line">    if coreapi is not None and coreschema is not None:</span><br><span class="line">        schema &#x3D; ManualSchema(</span><br><span class="line">            fields&#x3D;[</span><br><span class="line">                coreapi.Field(</span><br><span class="line">                    name&#x3D;&quot;username&quot;,</span><br><span class="line">                    required&#x3D;True,</span><br><span class="line">                    location&#x3D;&#39;form&#39;,</span><br><span class="line">                    schema&#x3D;coreschema.String(</span><br><span class="line">                        title&#x3D;&quot;Username&quot;,</span><br><span class="line">                        description&#x3D;&quot;Valid username for authentication&quot;,</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">                coreapi.Field(</span><br><span class="line">                    name&#x3D;&quot;password&quot;,</span><br><span class="line">                    required&#x3D;True,</span><br><span class="line">                    location&#x3D;&#39;form&#39;,</span><br><span class="line">                    schema&#x3D;coreschema.String(</span><br><span class="line">                        title&#x3D;&quot;Password&quot;,</span><br><span class="line">                        description&#x3D;&quot;Valid password for authentication&quot;,</span><br><span class="line">                    ),</span><br><span class="line">                ),</span><br><span class="line">            ],</span><br><span class="line">            encoding&#x3D;&quot;application&#x2F;json&quot;,</span><br><span class="line">        )</span><br><span class="line"> </span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        serializer &#x3D; self.serializer_class(data&#x3D;request.data,</span><br><span class="line">                                           context&#x3D;&#123;&#39;request&#39;: request&#125;)</span><br><span class="line">        serializer.is_valid(raise_exception&#x3D;True)</span><br><span class="line">        user &#x3D; serializer.validated_data[&#39;user&#39;]</span><br><span class="line">        token, created &#x3D; Token.objects.get_or_create(user&#x3D;user)</span><br><span class="line">        return Response(&#123;&#39;token&#39;: token.key&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">obtain_auth_token &#x3D; ObtainAuthToken.as_view()</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æƒé™æˆ–é™åˆ¶åº”ç”¨äº<code>obtain_auth_token</code>è§†å›¾ã€‚ å¦‚æœæ‚¨å¸Œæœ›åº”ç”¨<code>throttling</code>ï¼Œåˆ™éœ€è¦é‡å†™è§†å›¾ç±»ï¼Œå¹¶ä½¿ç”¨<code>throttle_classes</code>å±æ€§åŒ…å«å®ƒä»¬ã€‚</p>
<p>å¦‚æœä½ éœ€è¦è‡ªå®šä¹‰<code>obtain_auth_token</code>è§†å›¾ï¼Œä½ å¯ä»¥é€šè¿‡ç»§æ‰¿<code>ObtainAuthToken</code>è§†å›¾ç±»æ¥å®ç°ï¼Œå¹¶åœ¨ä½ çš„urls.pyä¸­ä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šè¿”å›è¶…å‡ºtokenå€¼çš„å…¶ä»–ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.authtoken.views import ObtainAuthToken</span><br><span class="line">from rest_framework.authtoken.models import Token</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"> </span><br><span class="line">class CustomAuthToken(ObtainAuthToken):</span><br><span class="line"> </span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        serializer &#x3D; self.serializer_class(data&#x3D;request.data,</span><br><span class="line">                                           context&#x3D;&#123;&#39;request&#39;: request&#125;)</span><br><span class="line">        serializer.is_valid(raise_exception&#x3D;True)</span><br><span class="line">        user &#x3D; serializer.validated_data[&#39;user&#39;]</span><br><span class="line">        token, created &#x3D; Token.objects.get_or_create(user&#x3D;user)</span><br><span class="line">        return Response(&#123;</span><br><span class="line">            &#39;token&#39;: token.key,</span><br><span class="line">            &#39;user_id&#39;: user.pk,</span><br><span class="line">            &#39;email&#39;: user.email</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰urls.py:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-auth&#x2F;&#39;, CustomAuthToken.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>è®¤è¯Token<br>å½“æˆ‘ä»¬è·å–åˆ°Tokenåï¼Œå°±å¯ä»¥æ‹¿ç€è¿™ä¸ªTokenæ¥è®¤è¯å…¶ä»–APIäº†ã€‚å¯¹äºå®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»¤ç‰Œå¯†é’¥åº”åŒ…å«åœ¨ <code>Authorization</code> HTTP header ä¸­ã€‚å…³é”®å­—åº”ä»¥å­—ç¬¦ä¸²æ–‡å­— â€œTokenâ€ ä¸ºå‰ç¼€ï¼Œç”¨ç©ºæ ¼åˆ†éš”ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b</span><br></pre></td></tr></table></figure>
æ³¨æ„ï¼š å¦‚æœä½ æƒ³åœ¨ header ä¸­ä½¿ç”¨ä¸åŒçš„å…³é”®å­—ï¼ˆä¾‹å¦‚Bearerï¼‰ï¼Œåªéœ€å­ç±»åŒ–<code>TokenAuthentication</code>å¹¶è®¾ç½®keywordç±»å˜é‡ã€‚<br>å¦‚æœæˆåŠŸé€šè¿‡èº«ä»½éªŒè¯ï¼Œ<code>TokenAuthentication</code>å°†æä¾›ä»¥ä¸‹å‡­æ®ã€‚</li>
</ul>
<p>request.useræ˜¯ä¸€ä¸ªUserå®ä¾‹ï¼ŒåŒ…å«äº†ç”¨æˆ·ååŠç›¸å…³ä¿¡æ¯ã€‚<br>request.authæ˜¯ä¸€ä¸ªrest_framework.authtoken.models.Tokenå®ä¾‹ã€‚<br>æœªç»èº«ä»½éªŒè¯çš„å“åº”è¢«æ‹’ç»å°†å¯¼è‡´HTTP 401 Unauthorizedçš„å“åº”å’Œç›¸åº”çš„ WWW-Authenticate headerã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WWW-Authenticate: Token</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä»¤ç‰Œè®¤è¯çš„APIï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X GET -H &#39;Authorization: Token 684b41712e8e38549504776613bd5612ba997616&#39; http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;virtual&#x2F;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š å¦‚æœæ‚¨åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨<code>TokenAuthentication</code>ï¼Œåˆ™å¿…é¡»ç¡®ä¿æ‚¨çš„ API åªèƒ½é€šè¿‡httpsè®¿é—®ã€‚</p>
<h3 id="å››-è®¤è¯æºç "><a href="#å››-è®¤è¯æºç " class="headerlink" title="å››. è®¤è¯æºç "></a>å››. è®¤è¯æºç </h3><p>ä½¿ç”¨ TokenAuthentication è®¤è¯æ–¹å¼ï¼Œå½“è®¤è¯æˆåŠŸåï¼Œåœ¨ request ä¸­å°†æä¾›äº† request.user å’Œ request.auth å®ä¾‹ã€‚å…¶ä¸­ request.user å®ä¾‹ä¸­æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·ååŠç”¨æˆ·IDï¼Œè€Œ request.auth å®ä¾‹ä¸­æœ‰Tokenä¿¡æ¯ã€‚é‚£ä¹ˆDRFæ˜¯å¦‚ä½•æŠŠ Token è½¬æ¢ä¸ºç”¨æˆ·ä¿¡æ¯å‘¢ï¼Ÿé€šè¿‡ä¸‹é¢çš„æºç éƒ¨åˆ†å°±å¯ä»¥çœ‹åˆ°å®ƒä»¬æ˜¯å¦‚ä½•è½¬æ¢çš„ã€‚</p>
<p>åŸºäº DRF çš„è¯·æ±‚å¤„ç†ï¼Œä¸å¸¸è§„çš„ url é…ç½®ä¸åŒï¼Œé€šå¸¸ä¸€ä¸ª Django çš„ url è¯·æ±‚å¯¹åº”ä¸€ä¸ªè§†å›¾å‡½æ•°ï¼Œåœ¨ä½¿ç”¨ DRF æ—¶ï¼Œæˆ‘ä»¬è¦åŸºäºè§†å›¾å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è§†å›¾å¯¹è±¡çš„ as_view å‡½æ•°ï¼Œas_view å‡½æ•°ä¸­ä¼šè°ƒç”¨ rest_framework/views.py ä¸­çš„ dispatch å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæ ¹æ® request è¯·æ±‚æ–¹æ³•ï¼Œå»è°ƒç”¨æˆ‘ä»¬åœ¨ view å¯¹è±¡ä¸­å®šä¹‰çš„å¯¹åº”çš„æ–¹æ³•ï¼Œå°±åƒè¿™æ ·:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.authtoken import views</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-auth&#x2F;&#39;, views.obtain_auth_token)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè™½ç„¶ç›´æ¥è°ƒç”¨ views.obtain_auth_token æ–¹æ³•ï¼Œä½†è¿›å…¥åˆ° views.obtain_auth_token æ–¹æ³•åè¿˜æ˜¯ DRF æ¨¡å¼ï¼Œæºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">obtain_auth_token &#x3D; ObtainAuthToken.as_view()</span><br></pre></td></tr></table></figure>
<p>ObtainAuthToken æ–¹æ³•æ˜¯ç»§æ‰¿ DRF ä¸­çš„ APIView çš„ View ç±»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ObtainAuthToken(APIView):</span><br><span class="line">    throttle_classes &#x3D; ()</span><br><span class="line">    permission_classes &#x3D; ()</span><br><span class="line">    parser_classes &#x3D; (parsers.FormParser, parsers.MultiPartParser, parsers.JSONParser,)</span><br><span class="line">    renderer_classes &#x3D; (renderers.JSONRenderer,)</span><br><span class="line">    serializer_class &#x3D; AuthTokenSerializer</span><br><span class="line">    ....</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æ˜¯ç”¨ POST æ–¹æ³•è¯·æ±‚ ObtainAuthTokenï¼Œé‚£ä¹ˆ as_view() å‡½æ•°ä¼šè°ƒç”¨ dispatch å‡½æ•°ï¼Œdispatch æ ¹æ® request.METHODï¼Œè¿™é‡Œæ˜¯ POSTï¼Œå»è°ƒç”¨ ObtainAuthToken ç±»çš„ POST æ–¹æ³•ï¼Œè¿™å°±è·Ÿé€šå¸¸çš„ url-&gt;view çš„æµç¨‹ä¸€æ ·äº†ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒDRF ä¸­çš„ APIVIEW æ˜¯ç»§æ‰¿ Django View çš„ï¼Œé‡å†™äº†éƒ¨åˆ† as_view æ–¹æ³•ï¼Œè€Œè°ƒç”¨ dispatch å‡½æ•°æ˜¯åœ¨ Django View çš„ as_view æ–¹æ³•ä¸­åšçš„äº‹æƒ…ï¼Œæºç éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    ....</span><br><span class="line">    @classmethod</span><br><span class="line">    def as_view(cls, **initkwargs):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Store the original class on the view function.</span><br><span class="line"> </span><br><span class="line">        This allows us to discover information about the view when we do URL</span><br><span class="line">        reverse lookups.  Used for breadcrumb generation.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if isinstance(getattr(cls, &#39;queryset&#39;, None), models.query.QuerySet):</span><br><span class="line">            def force_evaluation():</span><br><span class="line">                raise RuntimeError(</span><br><span class="line">                    &#39;Do not evaluate the &#96;.queryset&#96; attribute directly, &#39;</span><br><span class="line">                    &#39;as the result will be cached and reused between requests. &#39;</span><br><span class="line">                    &#39;Use &#96;.all()&#96; or call &#96;.get_queryset()&#96; instead.&#39;</span><br><span class="line">                )</span><br><span class="line">            cls.queryset._fetch_all &#x3D; force_evaluation</span><br><span class="line"> </span><br><span class="line">        view &#x3D; super(APIView, cls).as_view(**initkwargs)</span><br><span class="line">        view.cls &#x3D; cls</span><br><span class="line">        view.initkwargs &#x3D; initkwargs</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ç”¨æˆ·è®¤è¯æ˜¯åœ¨æ‰§è¡Œè¯·æ±‚ View ä¹‹å‰åšçš„ï¼Œæ‰€ä»¥å…¶å®å°±æ˜¯åœ¨ dispatch å‡½æ•°ä¹‹ä¸­åšçš„ï¼Œå…·ä½“è§æºç  rest-framework/views.py ä¸­ APIView ç±»ä¸­çš„ dispatch å‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    &#x2F;&#x2F; ä»settingsæ–‡ä»¶ä¸­è·å–è®¤è¯ç±»ã€é™æµç±»ã€æƒé™ç±»</span><br><span class="line">    authentication_classes &#x3D; api_settings.DEFAULT_AUTHENTICATION_CLASSES</span><br><span class="line">    throttle_classes &#x3D; api_settings.DEFAULT_THROTTLE_CLASSES</span><br><span class="line">    permission_classes &#x3D; api_settings.DEFAULT_PERMISSION_CLASSES</span><br><span class="line">    ....</span><br><span class="line">    </span><br><span class="line">    def dispatch(self, request, *args, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        &#96;.dispatch()&#96; is pretty much the same as Django&#39;s regular dispatch,</span><br><span class="line">        but with extra hooks for startup, finalize, and exception handling.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.args &#x3D; args</span><br><span class="line">        self.kwargs &#x3D; kwargs</span><br><span class="line">       </span><br><span class="line">        &#x2F;&#x2F; å°è£…requestï¼Œå¯¹åŸå§‹requestå¯¹è±¡å¢åŠ ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚è®¤è¯ç±»ï¼Œéƒ½æ˜¯åœ¨initialize_requestæ–¹æ³•ä¸­å®Œæˆ</span><br><span class="line">        request &#x3D; self.initialize_request(request, *args, **kwargs)</span><br><span class="line">        self.request &#x3D; request</span><br><span class="line">        self.headers &#x3D; self.default_response_headers  # deprecate?</span><br><span class="line"> </span><br><span class="line">        try:</span><br><span class="line">            &#x2F;&#x2F; è°ƒç”¨self.initialè¿›è¡Œç”¨æˆ·è®¤è¯</span><br><span class="line">            self.initial(request, *args, **kwargs)</span><br><span class="line"> </span><br><span class="line">            # Get the appropriate handler method</span><br><span class="line">            if request.method.lower() in self.http_method_names:</span><br><span class="line">                handler &#x3D; getattr(self, request.method.lower(),</span><br><span class="line">                                  self.http_method_not_allowed)</span><br><span class="line">            else:</span><br><span class="line">                handler &#x3D; self.http_method_not_allowed</span><br><span class="line"> </span><br><span class="line">            response &#x3D; handler(request, *args, **kwargs)</span><br><span class="line"> </span><br><span class="line">        except Exception as exc:</span><br><span class="line">            response &#x3D; self.handle_exception(exc)</span><br><span class="line"> </span><br><span class="line">        self.response &#x3D; self.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">        return self.response</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ self.initialize_request ä¹Ÿå¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œå› ä¸ºè¿™é‡Œçš„ request å¯¹è±¡ï¼Œåé¢ä¹Ÿä¼šæœ‰è°ƒç”¨çš„åœ°æ–¹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    ....</span><br><span class="line">    def initialize_request(self, request, *args, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Returns the initial request object.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        parser_context &#x3D; self.get_parser_context(request)</span><br><span class="line"> </span><br><span class="line">        return Request(</span><br><span class="line">            request,</span><br><span class="line">            parsers&#x3D;self.get_parsers(),</span><br><span class="line">            authenticators&#x3D;self.get_authenticators(),   &#x2F;&#x2F; è¿™é‡ŒæŠŠè®¤è¯ç±»å°è£…è¿›è¡Œäº†requesté‡Œé¢</span><br><span class="line">            negotiator&#x3D;self.get_content_negotiator(),</span><br><span class="line">            parser_context&#x3D;parser_context</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ self.get_authenticators() æ–¹æ³•å°±æ˜¯ç”¨æ¥å– self.authentication_classes å˜é‡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    ....</span><br><span class="line">    def get_authenticators(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Instantiates and returns the list of authenticators that this view can use.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return [auth() for auth in self.authentication_classes]</span><br></pre></td></tr></table></figure>
<p>å…³äº authentication_classes å˜é‡ï¼Œä¸Šé¢å·²ç»ç»™å‡ºäº†ï¼Œå°±åœ¨ APIView é‡Œé¢ authentication_classes å­—æ®µã€‚</p>
<p>ç„¶åå°±åˆ°äº†è®¤è¯ï¼Œé‡ç‚¹åœ¨äº self.initial(request, *args, **kwargs) å‡½æ•°ï¼Œå¯¹äºè¿™ä¸ªå‡½æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    ....</span><br><span class="line">    def initial(self, request, *args, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Runs anything that needs to occur prior to calling the method handler.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.format_kwarg &#x3D; self.get_format_suffix(**kwargs)</span><br><span class="line"> </span><br><span class="line">        # Perform content negotiation and store the accepted info on the request</span><br><span class="line">        neg &#x3D; self.perform_content_negotiation(request)</span><br><span class="line">        request.accepted_renderer, request.accepted_media_type &#x3D; neg</span><br><span class="line"> </span><br><span class="line">        # Determine the API version, if versioning is in use.</span><br><span class="line">        version, scheme &#x3D; self.determine_version(request, *args, **kwargs)</span><br><span class="line">        request.version, request.versioning_scheme &#x3D; version, scheme</span><br><span class="line"> </span><br><span class="line">        # Ensure that the incoming request is permitted</span><br><span class="line">        self.perform_authentication(request)   &#x2F;&#x2F; ç”¨æˆ·è®¤è¯</span><br><span class="line">        self.check_permissions(request)        &#x2F;&#x2F; æƒé™æ£€æŸ¥</span><br><span class="line">        self.check_throttles(request)          &#x2F;&#x2F; é™æµæ£€æŸ¥</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³æ³¨ self.perform_authentication(request) éªŒè¯æŸä¸ªç”¨æˆ·ï¼Œå…¶å®å¯ä»¥çœ‹åˆ°æƒé™æ£€æŸ¥åŠé™æµä¹Ÿæ˜¯åœ¨è¿™é‡Œåšçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class APIView(View):</span><br><span class="line">    ....</span><br><span class="line">    def perform_authentication(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Perform authentication on the incoming request.</span><br><span class="line"> </span><br><span class="line">        Note that if you override this and simply &#39;pass&#39;, then authentication</span><br><span class="line">        will instead be performed lazily, the first time either</span><br><span class="line">        &#96;request.user&#96; or &#96;request.auth&#96; is accessed.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        request.user</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ request.user å…¶å®æ˜¯ä¸€ä¸ª @property çš„å‡½æ•°ï¼ŒåŠ  @property è¡¨ç¤ºè°ƒç”¨ user æ–¹æ³•çš„æ—¶å€™ä¸éœ€è¦åŠ æ‹¬å·â€œuser()â€ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ request.user ã€‚è€Œè¿™é‡Œçš„ request å¯¹è±¡å°±æ˜¯ä¸Šé¢ initialize_request æ–¹æ³•è¿”å›çš„ï¼Œå…¶ä¸­è¿˜è¿”å›äº† DRF å®šä¹‰çš„ request å¯¹è±¡ï¼Œåœ¨ request å¯¹è±¡ä¸­æœ‰è¢« @property è£…é¥°çš„ user æ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Request(object):</span><br><span class="line">    ....</span><br><span class="line">    @property</span><br><span class="line">    def user(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Returns the user associated with the current request, as authenticated</span><br><span class="line">        by the authentication classes provided to the request.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if not hasattr(self, &#39;_user&#39;):</span><br><span class="line">            with wrap_attributeerrors():</span><br><span class="line">                self._authenticate()</span><br><span class="line">        return self._user</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹æ¥äº†ï¼Œåˆ°äº†çœŸæ­£è®¤è¯çš„æ–¹æ³•äº†ï¼Œå…³æ³¨ <code>self._authenticate()</code>å‡½æ•°å³å¯ã€‚æ­¤æ–¹æ³•ä¼šå¾ªç¯å°è¯•æ¯ä¸ª DRF è®¤è¯æ–¹å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Request(object):</span><br><span class="line">    ....</span><br><span class="line">    def _authenticate(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å°è¯•ä½¿ç”¨æ¯ä¸ªèº«ä»½éªŒè¯å®ä¾‹éªŒè¯è¯·æ±‚</span><br><span class="line">        self.authenticators &#x3D; [BasicAuthentication, SessionAuthentication, TokenAuthentication]</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        for authenticator in self.authenticators:</span><br><span class="line">            try:</span><br><span class="line">                user_auth_tuple &#x3D; authenticator.authenticate(self)</span><br><span class="line">            except exceptions.APIException:</span><br><span class="line">                &#x2F;&#x2F; å¦‚æœauthenticateæ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æ‰§è¡Œself._not_authenticatedæ–¹æ³•ï¼Œç›¸å½“äºåŒ¿åç”¨æˆ·ï¼Œæ²¡æœ‰é€šè¿‡è®¤è¯</span><br><span class="line">                self._not_authenticated()</span><br><span class="line">                raise</span><br><span class="line"> </span><br><span class="line">            if user_auth_tuple is not None:</span><br><span class="line">                self._authenticator &#x3D; authenticator</span><br><span class="line">                self.user, self.auth &#x3D; user_auth_tuple</span><br><span class="line">                return</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; å¦‚æœæ²¡æœ‰è®¾ç½®è®¤è¯ç±»çš„è¯ï¼Œä¹Ÿç›¸å½“äºåŒ¿åç”¨æˆ·ï¼Œæ²¡æœ‰é€šè¿‡è®¤è¯</span><br><span class="line">        self._not_authenticated()</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ self.authenticators ä»å“ªå„¿æ¥çš„å‘¢ï¼Ÿå°±æ˜¯ä¸Šé¢å±•ç¤ºçš„ï¼Œåœ¨ APIVIEW ç±»ä¸­çš„ authentication_classes = api_settings.DEFAULT_AUTHENTICATION_CLASSES å¾—åˆ°çš„ã€‚æˆ‘ä»¬ä¸Šé¢åœ¨ä»‹ç» DRF èº«ä»½éªŒè¯æ—¶ä¹Ÿè¯´äº†ï¼Œå¯ä»¥æŠŠè®¤è¯ç±»å®šä¹‰åœ¨å…¨å±€ settings æ–‡ä»¶ä¸­ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨åŸºäº APIView ç±»çš„è§†å›¾ï¼Œåœ¨æ¯ä¸ªè§†å›¾æˆ–æ¯ä¸ªè§†å›¾é›†çš„åŸºç¡€ä¸Šè®¾ç½®èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚å¦‚ä¸‹æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class ExampleView(APIView):</span><br><span class="line">    authentication_classes &#x3D; (SessionAuthentication, BasicAuthentication)</span><br><span class="line">    permission_classes &#x3D; (IsAuthenticated,)</span><br></pre></td></tr></table></figure>
<p>å½“åŸºäº APIView ç±»çš„è§†å›¾å®šä¹‰éªŒè¯æˆ–æƒé™ç±»æ—¶ï¼Œç›¸å½“äºè¦†ç›–äº†åŸç”Ÿ APIVIEW ä¸­çš„ç›¸å…³å˜é‡ï¼Œè‡ªç„¶å°±ä½¿ç”¨è¦†ç›–åçš„å˜é‡äº†ã€‚authentication_classes é‡Œé¢æ”¾çš„å°±æ˜¯å¯ä»¥ç”¨æ¥éªŒè¯ä¸€ä¸ªç”¨æˆ·çš„ç±»ï¼Œä»–æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒéªŒè¯ç”¨æˆ·æ—¶ï¼ŒæŒ‰ç…§è¿™ä¸ªå…ƒç»„é¡ºåºï¼Œç›´åˆ°éªŒè¯é€šè¿‡æˆ–è€…éå†æ•´ä¸ªå…ƒç»„è¿˜æ²¡æœ‰é€šè¿‡ã€‚åŒç† self.check_permissions(request) æ˜¯éªŒè¯è¯¥ç”¨æˆ·æ˜¯å¦å…·æœ‰APIçš„ä½¿ç”¨æƒé™ã€‚å…³äºå¯¹viewæ§åˆ¶çš„å…¶ä»–ç±»éƒ½åœ¨rest-framework/views.pyçš„APIViewç±»ä¸­å®šä¹‰äº†ã€‚</p>
<p>ç”±äºæˆ‘ä»¬è¿™é‡Œåªæ˜¯æ‹¿ TokenAuthentication è®¤è¯è¯´æ˜ï¼Œæ‰€ä»¥å¿½ç•¥ BasicAuthentication å’Œ SessionAuthentication è¿™ä¸¤ç§è®¤è¯ï¼Œå…¶åŸç†ä¸TokenAuthentication ä¸€æ ·ã€‚è¿™æ ·ï¼Œå°±è¿›å…¥åˆ°äº† TokenAuthentication è®¤è¯ï¼Œå…¶æºç éƒ¨åˆ†å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; è·å–headeréƒ¨åˆ† Authorization æ ‡è¯†çš„ä¿¡æ¯</span><br><span class="line">def get_authorization_header(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Return request&#39;s &#39;Authorization:&#39; header, as a bytestring.</span><br><span class="line"> </span><br><span class="line">    Hide some test client ickyness where the header can be unicode.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    auth &#x3D; request.META.get(&#39;HTTP_AUTHORIZATION&#39;, b&#39;&#39;)</span><br><span class="line">    if isinstance(auth, text_type):</span><br><span class="line">        # Work around django test client oddness</span><br><span class="line">        auth &#x3D; auth.encode(HTTP_HEADER_ENCODING)</span><br><span class="line">    return auth</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è§£æå¹¶è®¤è¯ Token</span><br><span class="line">class TokenAuthentication(BaseAuthentication):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Simple token based authentication.</span><br><span class="line"> </span><br><span class="line">    Clients should authenticate by passing the token key in the &quot;Authorization&quot;</span><br><span class="line">    HTTP header, prepended with the string &quot;Token &quot;.  For example:</span><br><span class="line"> </span><br><span class="line">        Authorization: Token 401f7ac837da42b97f613d789819ff93537bee6a</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"> </span><br><span class="line">    keyword &#x3D; &#39;Token&#39;</span><br><span class="line">    model &#x3D; None</span><br><span class="line"> </span><br><span class="line">    def get_model(self):</span><br><span class="line">        if self.model is not None:</span><br><span class="line">            return self.model</span><br><span class="line">        from rest_framework.authtoken.models import Token</span><br><span class="line">        return Token</span><br><span class="line"> </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    A custom token model may be used, but must have the following properties.</span><br><span class="line"> </span><br><span class="line">    * key -- The string identifying the token</span><br><span class="line">    * user -- The user to which the token belongs</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"> </span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &#x2F;&#x2F; é€šè¿‡ä¸Šé¢çš„get_authorization_headeræ–¹æ³•å¾—åˆ°Tokenä¿¡æ¯</span><br><span class="line">        &#x2F;&#x2F; auth &#x3D; [b&#39;Token&#39;, b&#39;684b41712e8e38549504776613bd5612ba997616&#39;]</span><br><span class="line">        auth &#x3D; get_authorization_header(request).split()</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; é€šè¿‡è·å–Tokenå…³é”®å­—ï¼Œå¹¶ä¸keywordå˜é‡æ¯”å¯¹ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ˜¯Tokenæ–¹å¼è®¤è¯</span><br><span class="line">        if not auth or auth[0].lower() !&#x3D; self.keyword.lower().encode():</span><br><span class="line">            return None</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; authé•¿åº¦ç­‰äº2æ—¶æ‰æ˜¯åˆæ³•å€¼ï¼Œç»§ç»­å¾€ä¸‹è¿›è¡Œ</span><br><span class="line">        if len(auth) &#x3D;&#x3D; 1:</span><br><span class="line">            msg &#x3D; _(&#39;Invalid token header. No credentials provided.&#39;)</span><br><span class="line">            raise exceptions.AuthenticationFailed(msg)</span><br><span class="line">        elif len(auth) &gt; 2:</span><br><span class="line">            msg &#x3D; _(&#39;Invalid token header. Token string should not contain spaces.&#39;)</span><br><span class="line">            raise exceptions.AuthenticationFailed(msg)</span><br><span class="line">     </span><br><span class="line">        &#x2F;&#x2F; è¿›è¡Œtokenè§£ç ï¼Œä»bytesç¼–ç æ ¼å¼è½¬ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">        try:</span><br><span class="line">            token &#x3D; auth[1].decode()</span><br><span class="line">        except UnicodeError:</span><br><span class="line">            msg &#x3D; _(&#39;Invalid token header. Token string should not contain invalid characters.&#39;)</span><br><span class="line">            raise exceptions.AuthenticationFailed(msg)</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; æŠŠè½¬æ¢è¿‡çš„tokenä¼ ç»™è®¤è¯å‡­è¯æ–¹æ³•è¿›è¡ŒéªŒè¯</span><br><span class="line">        return self.authenticate_credentials(token)</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F; éªŒè¯å‡­è¯æ–¹æ³•è¿›è¡Œæ¥æ”¶tokenå¹¶è¿›è¡ŒéªŒè¯</span><br><span class="line">    def authenticate_credentials(self, key):</span><br><span class="line">        &#x2F;&#x2F; è·å–Tokenæ¨¡å‹å®ä¾‹</span><br><span class="line">        model &#x3D; self.get_model()</span><br><span class="line">        try:</span><br><span class="line">            &#x2F;&#x2F; ä½¿ç”¨select_relatedæ–¹æ³•è·å–ç›¸åº”å¤–é”®å¯¹åº”çš„å¯¹è±¡ï¼ˆå°±æ˜¯ä¸¤è¡¨Joinï¼‰ï¼Œç„¶åè¿›è¡ŒTokenè¿‡æ»¤æŸ¥è¯¢</span><br><span class="line">            token &#x3D; model.objects.select_related(&#39;user&#39;).get(key&#x3D;key)</span><br><span class="line">        except model.DoesNotExist:</span><br><span class="line">            raise exceptions.AuthenticationFailed(_(&#39;Invalid token.&#39;))</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ˜¯ç™»å½•æˆåŠŸ</span><br><span class="line">        if not token.user.is_active:</span><br><span class="line">            raise exceptions.AuthenticationFailed(_(&#39;User inactive or deleted.&#39;))</span><br><span class="line"> </span><br><span class="line">        &#x2F;&#x2F; è¿”å›userå®ä¾‹ï¼ŒåŠtokenå®ä¾‹</span><br><span class="line">        return (token.user, token)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PSï¼šDRFè‡ªå¸¦çš„TokenAuthenticationè®¤è¯æ–¹å¼ä¹Ÿéå¸¸ç®€å•ï¼ŒåŒæ—¶å¼Šç«¯ä¹Ÿå¾ˆå¤§ï¼ŒçœŸæ­£é¡¹ç›®ä¸­ç”¨çš„è¾ƒå°‘ã€‚ç”±äºéœ€è¦å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­ï¼Œå®ƒåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç”¨èµ·æ¥è¾ƒä¸ºéº»çƒ¦ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œå¢åŠ æ•°æ®åº“å‹åŠ›ï¼›åŒæ—¶å®ƒä¸æ”¯æŒTokençš„è¿‡æœŸè®¾ç½®ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨å®é™…å‰åç«¯åˆ†ç¦»é¡¹ç›®ä¸­ä½¿ç”¨JWTï¼ˆJson Web Tokenï¼‰æ ‡å‡†çš„è®¤è¯æ–¹å¼è¾ƒå¤šï¼Œæ¯ä¸ªè¯­è¨€éƒ½æœ‰å„è‡ªå®ç°JWTçš„æ–¹å¼ï¼ŒPythonä¹Ÿä¸ä¾‹å¤–ã€‚</p>
</blockquote>
<h3 id="äº”-JWTè®¤è¯"><a href="#äº”-JWTè®¤è¯" class="headerlink" title="äº”. JWTè®¤è¯"></a>äº”. JWTè®¤è¯</h3><p>äº†è§£å®ŒDRFè‡ªå¸¦çš„TokenAuthenticationè®¤è¯æ–¹å¼çš„å¼Šç«¯ä¹‹åï¼Œå†æ¥çœ‹JWTï¼ˆJson Web Tokenï¼‰è®¤è¯æ–¹å¼ã€‚å®ƒä»¬ä¸¤ä¸ªçš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯è®¤è¯ç”¨æˆ·Tokenï¼Œç„¶åå–å‡ºå¯¹åº”çš„ç”¨æˆ·ã€‚ä½†JWTè§£å†³äº†ä¸¤ä¸ªè¾ƒå¤§çš„é—®é¢˜ã€‚</p>
<p>ç¬¬ä¸€ï¼Œæ˜¯ä¸éœ€è¦æŠŠTokenå­˜å‚¨åˆ°æ•°æ®åº“è¡¨ä¸­äº†ï¼Œè€Œæ˜¯æ ¹æ®ä¸€å®šçš„ç®—æ³•æ¥ç®—å‡ºç”¨æˆ·Tokenï¼Œç„¶åæ¯æ¬¡ç”¨æˆ·æ¥éªŒè¯æ—¶å†ä»¥åŒæ ·çš„æ–¹å¼ç”Ÿæˆå¯¹åº”çš„Tokenè¿›è¡Œæ ¡éªŒã€‚å½“ç„¶ï¼Œå®é™…JWTç”ŸæˆTokençš„æ–¹å¼è¿˜æ˜¯è¾ƒä¸ºå¤æ‚çš„ï¼Œå…·ä½“å¯ä»¥çœ‹JWTåè®®ç›¸å…³æ–‡ç« ã€‚</p>
<p>ç¬¬äºŒï¼ŒJWTå¯¹äºç”Ÿæˆçš„Tokenå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦æé«˜äº†Tokençš„å®‰å…¨æ€§ã€‚</p>
<p>JWTçš„åŸç†è¿˜æ˜¯ç¨ç¨æœ‰ç‚¹éº»çƒ¦çš„ï¼Œé‡Œé¢æ¶‰åŠäº†ä¸€äº›å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„ç®—æ³•ã€‚ä½†æ˜¯JWTä½¿ç”¨èµ·æ¥ç¡®æ˜¯éå¸¸ç®€å•ï¼ŒPythonä¸­æœ‰PyJWTåº“ï¼Œè€Œåœ¨DRFä¸­ä¹Ÿæœ‰å¯¹åº”çš„å¼€æºé¡¹ç›®<a href="https://github.com/GetBlimp/django-rest-framework-jwt" target="_blank" rel="noopener">django-rest-framework-jwt</a></p>
<ul>
<li>å®‰è£…<br>ç›´æ¥ä½¿ç”¨pipå®‰è£…å³å¯ï¼Œç›®å‰æ”¯æŒPythonã€Djangoã€DRFä¸»æµç‰ˆæœ¬ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ pip install djangorestframework-jwt</span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨<br>åœ¨settings.pyæ–‡ä»¶ä¸­ï¼Œå°†JSONWebTokenAuthentication æ·»åŠ åˆ°REST frameworkæ¡†æ¶çš„DEFAULT_AUTHENTICATION_CLASSES<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_PERMISSION_CLASSES&#39;: (</span><br><span class="line">        &#39;rest_framework.permissions.IsAuthenticated&#39;,</span><br><span class="line">    ),</span><br><span class="line">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: (</span><br><span class="line">        &#39;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#39;,</span><br><span class="line">        &#39;rest_framework.authentication.SessionAuthentication&#39;,</span><br><span class="line">        &#39;rest_framework.authentication.BasicAuthentication&#39;,</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
åŒæ ·ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨åŸºäºAPIViewç±»çš„è§†å›¾ï¼Œåœ¨æ¯ä¸ªè§†å›¾æˆ–æ¯ä¸ªè§†å›¾é›†çš„åŸºç¡€ä¸Šè®¾ç½®èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚ä¸ä¸Šé¢æ¼”ç¤ºçš„ Token è®¤è¯ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ï¼Œå°½å¯èƒ½ä½¿ç”¨åŸºäºAPIViewç±»çš„è§†å›¾è®¤è¯æ–¹å¼ã€‚<br>ä½†ä½¿ç”¨åŸºäºAPIViewç±»çš„è§†å›¾è®¤è¯æ–¹å¼æ—¶ï¼Œä¸è¦å¿˜è®°å¯¼å…¥ç±»ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework_jwt.authentication import JSONWebTokenAuthentication</span><br></pre></td></tr></table></figure>
åœ¨ä½ çš„urls.pyæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹URLè·¯ç”±ï¼Œä»¥ä¾¿é€šè¿‡POSTåŒ…å«ç”¨æˆ·åå’Œå¯†ç çš„ä»¤ç‰Œè·å–ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework_jwt.views import obtain_jwt_token</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-auth&#x2F;&#39;, obtain_jwt_token)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
å¦‚æœä½ ä½¿ç”¨ç”¨æˆ·åadminå’Œå¯†ç admin123456åˆ›å»ºäº†ç”¨æˆ·ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œæ¥æµ‹è¯•JWTæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X POST -d &quot;username&#x3D;admin&amp;password&#x3D;admin123456&quot; http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;api-token-auth&#x2F;</span><br></pre></td></tr></table></figure>
æˆ–è€…ï¼Œä½ å¯ä»¥ä½¿ç”¨Django REST frameworkæ”¯æŒçš„æ‰€æœ‰å†…å®¹ç±»å‹æ¥è·å–èº«ä»½éªŒè¯ä»¤ç‰Œã€‚ä¾‹å¦‚ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X POST -H &quot;Content-Type: application&#x2F;json&quot; -d &#39;&#123;&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;admin123456&quot;&#125;&#39; http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;api-token-auth&#x2F;</span><br></pre></td></tr></table></figure>
ç°åœ¨è®¿é—®éœ€è¦è®¤è¯çš„APIæ—¶ï¼Œå°±å¿…é¡»è¦åŒ…å«<code>Authorization: JWT &lt;your_token&gt;</code>å¤´ä¿¡æ¯äº†ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -H &quot;Authorization: JWT &lt;your_token&gt;&quot; http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;virtual&#x2F;</span><br></pre></td></tr></table></figure></li>
<li>åˆ·æ–°Token<br>å¦‚æœJWT_ALLOW_REFRESHä¸ºTrueï¼Œå¯ä»¥â€œåˆ·æ–°â€æœªè¿‡æœŸçš„ä»¤ç‰Œä»¥è·å¾—å…·æœ‰æ›´æ–°åˆ°æœŸæ—¶é—´çš„å…¨æ–°ä»¤ç‰Œã€‚åƒå¦‚ä¸‹è¿™æ ·æ·»åŠ ä¸€ä¸ªURLæ¨¡å¼ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework_jwt.views import refresh_jwt_token</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-refresh&#x2F;&#39;, refresh_jwt_token)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
ä½¿ç”¨æ–¹å¼å°±æ˜¯å°†ç°æœ‰ä»¤ç‰Œä¼ é€’åˆ°åˆ·æ–°APIï¼Œå¦‚ä¸‹æ‰€ç¤º: <code>{&quot;token&quot;: EXISTING_TOKEN}</code>ã€‚è¯·æ³¨æ„ï¼Œåªæœ‰éè¿‡æœŸçš„ä»¤ç‰Œæ‰æœ‰æ•ˆã€‚å¦å¤–ï¼Œå“åº”JSONçœ‹èµ·æ¥ä¸æ­£å¸¸è·å–ä»¤ç‰Œç«¯ç‚¹<code>{&quot;token&quot;: NEW_TOKEN}</code>ç›¸åŒã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X POST -H &quot;Content-Type: application&#x2F;json&quot; -d &#39;&#123;&quot;token&quot;:&quot;&lt;EXISTING_TOKEN&gt;&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;api-token-refresh&#x2F;</span><br></pre></td></tr></table></figure>
å¯ä»¥é‡å¤ä½¿ç”¨ä»¤ç‰Œåˆ·æ–°ï¼ˆtoken1 -&gt; token2 -&gt; token3ï¼‰ï¼Œä½†æ­¤ä»¤ç‰Œé“¾å­˜å‚¨åŸå§‹ä»¤ç‰Œï¼ˆä½¿ç”¨ç”¨æˆ·å/å¯†ç å‡­æ®è·å–ï¼‰çš„æ—¶é—´ã€‚ä½œä¸ºorig_iatï¼Œä½ åªèƒ½å°†åˆ·æ–°ä»¤ç‰Œä¿ç•™è‡³JWT_REFRESH_EXPIRATION_DELTAã€‚<br>åˆ·æ–°tokenä»¥è·å¾—æ–°çš„tokençš„ä½œç”¨åœ¨äºï¼ŒæŒç»­ä¿æŒæ´»è·ƒç”¨æˆ·ç™»å½•çŠ¶æ€ã€‚æ¯”å¦‚é€šè¿‡ç”¨æˆ·å¯†ç è·å¾—çš„tokenæœ‰æ•ˆæ—¶é—´ä¸º1å°æ—¶ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€1å°æ—¶åæ­¤tokenå¤±æ•ˆï¼Œç”¨æˆ·å¿…é¡»å¾—é‡æ–°ç™»å½•ï¼Œè¿™å¯¹äºæ´»è·ƒç”¨æˆ·æ¥è¯´å…¶å®æ˜¯å¤šä½™çš„ã€‚å¦‚æœè¿™ä¸ªç”¨æˆ·åœ¨è¿™1å°æ—¶å†…éƒ½åœ¨æµè§ˆç½‘ç«™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è®©ç”¨æˆ·é‡æ–°ç™»å½•ï¼Œå°±æ˜¯åœ¨tokenæ²¡æœ‰å¤±æ•ˆä¹‹å‰è°ƒç”¨åˆ·æ–°æ¥å£ä¸ºç”¨æˆ·è·å¾—æ–°çš„tokenã€‚</li>
<li>è®¤è¯Token<br>åœ¨ä¸€äº›å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œèº«ä»½éªŒè¯ç”±å•ä¸ªæœåŠ¡å¤„ç†ã€‚æ­¤æœåŠ¡è´Ÿè´£å…¶ä»–æœåŠ¡å§”æ´¾ç¡®è®¤ç”¨æˆ·å·²ç™»å½•æ­¤èº«ä»½éªŒè¯æœåŠ¡çš„è´£ä»»ã€‚è¿™é€šå¸¸æ„å‘³ç€å…¶ä»–æœåŠ¡å°†ä»ç”¨æˆ·æ¥æ”¶JWTä¼ é€’ç»™èº«ä»½éªŒè¯æœåŠ¡ï¼Œå¹¶åœ¨å°†å—ä¿æŠ¤èµ„æºè¿”å›ç»™ç”¨æˆ·ä¹‹å‰ç­‰å¾…JWTæœ‰æ•ˆçš„ç¡®è®¤ã€‚æ·»åŠ ä»¥ä¸‹URLæ¨¡å¼ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework_jwt.views import verify_jwt_token</span><br><span class="line">urlpatterns +&#x3D; [</span><br><span class="line">    url(r&#39;^api-token-verify&#x2F;&#39;, verify_jwt_token)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
å°†Tokenä¼ é€’ç»™éªŒè¯APIï¼Œå¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œåˆ™è¿”å›ä»¤ç‰Œï¼Œè¿”å›çŠ¶æ€ç ä¸º200ã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å›400 Bad Requestä»¥åŠè¯†åˆ«ä»¤ç‰Œæ— æ•ˆçš„é”™è¯¯ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X POST -H &quot;Content-Type: application&#x2F;json&quot; -d &#39;&#123;&quot;token&quot;:&quot;&lt;EXISTING_TOKEN&gt;&quot;&#125;&#39; http:&#x2F;&#x2F;localhost:8000&#x2F;api-token-verify&#x2F;</span><br></pre></td></tr></table></figure></li>
<li>æ‰‹åŠ¨åˆ›å»ºToken<br>æœ‰æ—¶å€™ä½ å¯èƒ½å¸Œæœ›æ‰‹åŠ¨ç”Ÿæˆä»¤ç‰Œï¼Œä¾‹å¦‚åœ¨åˆ›å»ºå¸æˆ·åç«‹å³å°†ä»¤ç‰Œè¿”å›ç»™ç”¨æˆ·ã€‚æˆ–è€…ï¼Œä½ éœ€è¦è¿”å›çš„ä¿¡æ¯ä¸æ­¢æ˜¯Tokenï¼Œå¯èƒ½è¿˜æœ‰ç”¨æˆ·æƒé™ç›¸å…³å€¼ã€‚ä½ å¯ä»¥è¿™æ ·åšï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework_jwt.settings import api_settings</span><br><span class="line"> </span><br><span class="line">jwt_payload_handler &#x3D; api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">jwt_encode_handler &#x3D; api_settings.JWT_ENCODE_HANDLER</span><br><span class="line"> </span><br><span class="line">payload &#x3D; jwt_payload_handler(user)</span><br><span class="line">token &#x3D; jwt_encode_handler(payload)</span><br></pre></td></tr></table></figure></li>
<li>å…¶ä»–è®¾ç½®<br>ä½ å¯ä»¥è¦†ç›–ä¸€äº›å…¶ä»–è®¾ç½®ï¼Œæ¯”å¦‚å˜æ›´Tokenè¿‡æœŸæ—¶é—´ï¼Œä»¥ä¸‹æ˜¯æ‰€æœ‰å¯ç”¨è®¾ç½®çš„é»˜è®¤å€¼ã€‚åœ¨settings.pyæ–‡ä»¶ä¸­è®¾ç½®ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JWT_AUTH &#x3D; &#123;</span><br><span class="line">    &#39;JWT_ENCODE_HANDLER&#39;:</span><br><span class="line">    &#39;rest_framework_jwt.utils.jwt_encode_handler&#39;,</span><br><span class="line"> </span><br><span class="line">    &#39;JWT_DECODE_HANDLER&#39;:</span><br><span class="line">    &#39;rest_framework_jwt.utils.jwt_decode_handler&#39;,</span><br><span class="line"> </span><br><span class="line">    &#39;JWT_PAYLOAD_HANDLER&#39;:</span><br><span class="line">    &#39;rest_framework_jwt.utils.jwt_payload_handler&#39;,</span><br><span class="line"> </span><br><span class="line">    &#39;JWT_PAYLOAD_GET_USER_ID_HANDLER&#39;:</span><br><span class="line">    &#39;rest_framework_jwt.utils.jwt_get_user_id_from_payload_handler&#39;,</span><br><span class="line"> </span><br><span class="line">    &#39;JWT_RESPONSE_PAYLOAD_HANDLER&#39;:</span><br><span class="line">    &#39;rest_framework_jwt.utils.jwt_response_payload_handler&#39;,</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¿™æ˜¯ç”¨äºç­¾ç½²JWTçš„å¯†é’¥ï¼Œç¡®ä¿è¿™æ˜¯å®‰å…¨çš„ï¼Œä¸å…±äº«ä¸å…¬å¼€çš„</span><br><span class="line">    &#39;JWT_SECRET_KEY&#39;: settings.SECRET_KEY,</span><br><span class="line">    &#39;JWT_GET_USER_SECRET_KEY&#39;: None,</span><br><span class="line">    &#39;JWT_PUBLIC_KEY&#39;: None,</span><br><span class="line">    &#39;JWT_PRIVATE_KEY&#39;: None,</span><br><span class="line">    &#39;JWT_ALGORITHM&#39;: &#39;HS256&#39;,</span><br><span class="line">    &#x2F;&#x2F; å¦‚æœç§˜é’¥æ˜¯é”™è¯¯çš„ï¼Œå®ƒä¼šå¼•å‘ä¸€ä¸ªjwt.DecodeError</span><br><span class="line">    &#39;JWT_VERIFY&#39;: True,</span><br><span class="line">    &#39;JWT_VERIFY_EXPIRATION&#39;: True,</span><br><span class="line">    &#39;JWT_LEEWAY&#39;: 0,</span><br><span class="line">    &#x2F;&#x2F; Tokenè¿‡æœŸæ—¶é—´è®¾ç½®</span><br><span class="line">    &#39;JWT_EXPIRATION_DELTA&#39;: datetime.timedelta(seconds&#x3D;300),</span><br><span class="line">    &#39;JWT_AUDIENCE&#39;: None,</span><br><span class="line">    &#39;JWT_ISSUER&#39;: None,</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ˜¯å¦å¼€å¯å…è®¸Tokenåˆ·æ–°æœåŠ¡ï¼ŒåŠé™åˆ¶Tokenåˆ·æ–°é—´éš”æ—¶é—´ï¼Œä»åŸå§‹Tokenè·å–å¼€å§‹è®¡ç®—</span><br><span class="line">    &#39;JWT_ALLOW_REFRESH&#39;: False,</span><br><span class="line">    &#39;JWT_REFRESH_EXPIRATION_DELTA&#39;: datetime.timedelta(days&#x3D;7),</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F; å®šä¹‰ä¸ä»¤ç‰Œä¸€èµ·å‘é€çš„Authorizationæ ‡å¤´å€¼å‰ç¼€</span><br><span class="line">    &#39;JWT_AUTH_HEADER_PREFIX&#39;: &#39;JWT&#39;,</span><br><span class="line">    &#39;JWT_AUTH_COOKIE&#39;: None,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
ä¸€èˆ¬é™¤äº†è¿‡æœŸæ—¶é—´å¤–ï¼Œå…¶ä»–é…ç½®å‚æ•°å¾ˆå°‘æ”¹å˜ã€‚å…·ä½“å‚æ•°æ„ä¹‰å½“ç”¨åˆ°æ—¶å¯ä»¥æŸ¥è¯¢å®˜ç½‘ã€‚</li>
</ul>
<p>JWTå”¯ä¸€çš„ä¸€ä¸ªä¸ç®—ç¼ºç‚¹çš„ç¼ºç‚¹å°±æ˜¯Tokenå¤ªé•¿äº†ï¼Œ180ä½ã€‚</p>
<p><a href="https://segmentfault.com/a/1190000013010835" target="_blank" rel="noopener">Token è®¤è¯çš„æ¥é¾™å»è„‰</a></p>
<p><a href="http://www.hi-roy.com/2017/01/11/%E5%9F%BA%E4%BA%8Ecookie%E7%9A%84django-rest-jwt%E8%AE%A4%E8%AF%81/" target="_blank" rel="noopener">åŸºäºcookieçš„django-rest-jwtè®¤è¯</a></p>
<p><a href="https://q1mi.github.io/Django-REST-framework-documentation/api-guide/authentication_zh/" target="_blank" rel="noopener">TokenAuthentication</a></p>
<h3 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h3><p><a href="http://www.ywnds.com/?p=14967" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
<h3 id="æƒé™ç›¸å…³å‚è€ƒ"><a href="#æƒé™ç›¸å…³å‚è€ƒ" class="headerlink" title="æƒé™ç›¸å…³å‚è€ƒ"></a>æƒé™ç›¸å…³å‚è€ƒ</h3><p><a href="https://segmentfault.com/a/1190000004401112" target="_blank" rel="noopener">Django REST frameworkçš„å„ç§æŠ€å·§ã€ç›®å½•ç´¢å¼•ã€‘ - åç«¯å¼€å‘é‚£ç‚¹äº‹å„¿ - SegmentFault æ€å¦</a><br><a href="https://segmentfault.com/a/1190000004400312" target="_blank" rel="noopener">Django REST frameworkçš„å„ç§æŠ€å·§â€”â€”3.æƒé™ - åç«¯å¼€å‘é‚£ç‚¹äº‹å„¿ - SegmentFault æ€å¦</a><br><a href="https://cloud.tencent.com/developer/article/1155184" target="_blank" rel="noopener">djangoæƒé™ç®¡ç†(Permission)-å†…ç½®æƒé™å®ç°</a><br><a href="https://juejin.im/post/5a991807518825558a060a77" target="_blank" rel="noopener">django viewset</a></p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Alembic</title>
    <url>/2020/04/20/Alembic/</url>
    <content><![CDATA[<h2 id="Alembic"><a href="#Alembic" class="headerlink" title="Alembic"></a>Alembic</h2><p>æ•°æ®åº“çš„ç®¡ç†æ˜¯ä¸€ä¸ªé¡¹ç›®ä¸­éå¸¸å…³é”®çš„éƒ¨åˆ†ã€‚<br>æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­å…ä¸äº†è¦å¯¹æ•°æ®åº“çš„ç»“æ„è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼Œæ¯”å¦‚å­—æ®µçš„å¢åŠ ï¼Œå­—æ®µç±»å‹çš„æ”¹å˜ï¼Œ æˆ–è€…æ–°æ·»å’Œåˆ é™¤ä¸€ä¸ªè¡¨ã€‚<br>æ¯”å¦‚æ–°å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œæœ´ç´ çš„æ€æƒ³ï¼ˆåŸå§‹çš„å†²åŠ¨ï¼‰æ˜¯ä»£ç é‡Œè¡¥å……ä¸€ä¸ª classï¼Œå®šä¹‰å¥½å„ä¸ªå­—æ®µï¼ˆå¯èƒ½æœ‰50ä¸ªç”šè‡³æ›´å¤šçš„å­—æ®µï¼‰ï¼Œå†ä¸€æ¬¡ create_all()ï¼ˆè¿™ä¹Ÿæ„å‘³ç€ä¹‹å‰çš„æ•°æ®ä¼šæ¶ˆå¤±ï¼‰ï¼Œæˆ–è€…åœ¨ä»£ç éƒ¨åˆ†å†™å¥½ä¹‹åï¼Œé€šè¿‡æ•°æ®åº“è½¯ä»¶äººè‚‰ä¿®æ”¹æ•°æ®åº“ä¸­çš„ç»“æ„ï¼ˆæƒ³æƒ³ï¼Œå‡ åä¸ªå­—æ®µï¼Œç”šè‡³ä¸Šç™¾ä¸ªå­—æ®µï¼‰ã€‚<br>ä¸Šè¿°çš„åšæ³•ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œä¸è¦å¿˜äº†ï¼Œç”Ÿäº§å·¥å…·çš„ä½¿ç”¨ä¿ƒè¿›äººç±»ç¤¾ä¼šå‘å±•ï¼Œé‡å¤çš„æœºæ¢°åŠ³åŠ¨å°±æ˜¯æµªè´¹ç”Ÿå‘½ï¼Œèªæ˜çš„ç¨‹åºå‘˜æ˜¯è¦å­¦ä¼šå·æ‡’çš„ã€‚<br>æ‰€ä»¥ï¼Œä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹ alembicï¼è¿™æ˜¯ sqlalchemy ä½œè€…äº²è‡ªå¼€å‘çš„ æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œäº²å„¿å­ã€‚ï¼ˆéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œä»…ä»…é’ˆå¯¹ç»“æ„åŒ–çš„æ•°æ®ï¼ŒMysql PostgreSQL ç­‰ï¼‰<br>æ•°æ®åº“è¿ç§»çš„ç»ˆæç›®çš„ï¼šæ•°æ®ä¸ä¸¢å¤±ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼š"><a href="#ç¬¬ä¸€æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼š"></a>ç¬¬ä¸€æ­¥ï¼š</h3><p>pip install alembic  # è¯·ç¡®ä¿æ˜¯ä½ ä»£ç è¿è¡Œ python ç‰ˆæœ¬ä¸­çš„ pip<br>æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿å®‰è£…äº† alembicã€‚ä¹‹åä½ å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ alembic å‘½ä»¤äº†</p>
<h3 id="ç¬¬äºŒæ­¥ï¼š"><a href="#ç¬¬äºŒæ­¥ï¼š" class="headerlink" title="ç¬¬äºŒæ­¥ï¼š"></a>ç¬¬äºŒæ­¥ï¼š</h3><p>alembic init alembic_dir  # alembic_dir æ˜¯è‡ªå®šä¹‰çš„åå­—ï¼Œä¸ç”¨åŠ å¼•å·<br>åœ¨ä½ çš„é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹è¿è¡Œè¿™ä¸ªæŒ‡ä»¤ï¼Œä¸å‡ºæ„å¤–ï¼Œä¼šå‡ºç°ï¼šï¼ˆå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨åˆ«çš„ç›®å½•é‡Œé¢è¿™ä¹ˆåšï¼Œä¸è¿‡ï¼Œä»…ä»…æ˜¯ä½¿ç”¨çš„è¯ï¼ŒçŸ¥é“è¿™æ˜¯ä¸ªå¥—è·¯å°±å¥½äº†ï¼Œå› ä¸º alembic å‘½ä»¤ä¼šæ‰¾å½“å‰å‘½ä»¤å½•é‡Œçš„ env.py æ–‡ä»¶ï¼‰<br>yourproject/<br>alembic.ini  # ç›¸å…³çš„åˆå§‹åŒ–é…ç½®ï¼Œä¸»è¦ä¸º env.py ä¸­çš„ context æä¾›ç›¸åº”çš„å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„æ˜¯ sqlalchemy.url è¿™ä¸ª<br>alembic_dir/<br>env.py # ç¯å¢ƒæ–‡ä»¶ï¼Œçµæ´»æ€§ç›¸å½“ä¹‹å¤§<br>README<br>   script.py.mako  # è¿™æ˜¯ç”¨æ¥ç”Ÿæˆè¿ç§»è„šæœ¬ py æ–‡ä»¶çš„ mako è¯­æ³•è„šæœ¬æ–‡ä»¶<br>   versions/  # è¿™ä¸ªæ–‡ä»¶é‡Œä¿å­˜ç€æ¯æ¬¡ revision çš„ç›¸å…³ä¿¡æ¯</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼š"><a href="#ç¬¬ä¸‰æ­¥ï¼š" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼š"></a>ç¬¬ä¸‰æ­¥ï¼š</h3><p>ç¼–è¾‘ alembic.ini æ–‡ä»¶ï¼Œç»‘å®šæ•°æ®åº“<br>sqlalchemy.url = driver://user:pass@localhost/dbname  # æŠŠ = åé¢çš„ä¿®æ”¹æˆä½ æ•°æ®åº“çš„é…ç½®å°±å¯ä»¥äº†ï¼Œä¸è¦åŠ å¼•å·<br>ç¬¬å››æ­¥ï¼š<br>åœ¨ env.py ä¸­å¼ºåŠ¿æ’å…¥å¦‚ä¸‹ä»£ç ï¼Œé˜²æ­¢åœ¨ä½¿ç”¨ è‡ªåŠ¨è¿ç§»å‘½ä»¤ æ—¶ï¼Œæ‰¾ä¸åˆ°æ•°æ®åº“çš„è·¯å¾„ï¼Œå‚è€ƒï¼šstackoverflow<br>import os<br>import sys<br>sys.path.insert(0. os.path.realpath(â€˜.â€™))<br>ä¸ºäº†ä½¿ç”¨æ¨¡å‹ç±»å®ç° è‡ªåŠ¨è¿ç§»ï¼Œè¿˜éœ€è¦è®¾ç½®å…ƒæ•°æ®ï¼Œè¿™æ · alembic æ‰èƒ½è·å–æ¨¡å‹ç±»ä¸­å®šä¹‰çš„ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from models import Base</span><br><span class="line">Target_metadata &#x3D; Base.metadata</span><br></pre></td></tr></table></figure>
<h3 id="ç¬¬äº”æ­¥ï¼š"><a href="#ç¬¬äº”æ­¥ï¼š" class="headerlink" title="ç¬¬äº”æ­¥ï¼š"></a>ç¬¬äº”æ­¥ï¼š</h3><p>æ¯”å¦‚ä½ çš„ä»£ç é‡Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªè¡¨æ¨¡å‹ç±»ï¼Œæœ‰å¦‚ä¸‹ä¸¤ä¸ªæ“ä½œã€‚<br>alembic revision -m â€˜input your description for this versionâ€™  # è¿™ä¸ªå±äºä½ æ‰‹åŠ¨åœ¨ versions/fdfadsf.py å»æ›´æ”¹ï¼Œä¸éœ€è¦æ¨¡å‹ç±»<br>alembic revision â€“autogenerate -m â€˜input your description for this versionâ€™  # è¿™æ˜¯è‡ªåŠ¨çš„ï¼Œå»ºè®®ç”¨è¿™ä¸ªï¼Œçœäº‹ï¼Œä¸è¿‡åœ¨ upgrade ä¹‹å‰ä¸€å®šè¦è‡ªå·±å† adjust ä¸€ä¸‹<br>è¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨ versions æ–‡ä»¶å¤¹é‡Œç”Ÿæˆä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œå‰è€…éœ€è¦æ‰‹åŠ¨æ·»åŠ ï¼Œåè€…è‡ªåŠ¨ç”Ÿæˆã€‚<br>è¿ç§»å‘½ä»¤ç”Ÿæˆåä¹‹åä¸è¦å¿˜è®°ä½¿ç”¨å‘½ä»¤ alembic upgrade head ä½¿æ•°æ®åº“ä¿æŒæœ€æ–°çš„çŠ¶æ€ã€‚</p>
<p>é¡¾åæ€ä¹‰ï¼Œ ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬<br>æ­¤æ—¶åœ¨è¯¥æ•°æ®åº“ä¸­ä¼šç”Ÿæˆä¸€ä¸ª alembic_version çš„è¡¨ï¼Œè®°å½•ç‰ˆæœ¬ä¿¡æ¯<br>æ³¨æ„ï¼Œå…¶ä¸­ä¸€æ—¦æŸä¸ªç‰ˆæœ¬ç¼ºå¤±ï¼Œé‚£åŸºæœ¬ä¸Šå°±å¯ä»¥é‡æ¥äº†ï¼Œalembic çš„æ“ä½œå°†æ— æ³•å®šä½ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸è¿‡ï¼ä¹Ÿå¯ä»¥è‡ªå·± hack ä¸€ä¸‹ï¼Œæ¯”å¦‚æ•°æ®åº“çš„ç‰ˆæœ¬å·ä¸åœ¨versionsé‡Œå¤´ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ªï¼ŒæŠŠç‰ˆæœ¬å·ç»™æ”¹äº†ï¼Œè¿™ä¸ªå¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªå·±å»ç©ï¼Œçµæ´»æ€§å¾ˆå¤§ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œè¿˜æ˜¯ä¸å¸Œæœ›ç‰ˆæœ¬çš„ç¼ºå¤±ã€‚<br>æœ€åä»‹ç»å‡ ä¸ªå‘½ä»¤çš„æ„æ€ï¼š<br>alembic current  # æ˜¾ç¤ºå½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬<br>alembic upgrade head/base/dfas(version num)  # head æŒ‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œbase åˆ™æ˜¯æœ€åˆç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šï¼Œç±»ä¼¼äº git<br>alembic downgrade base/dfsa(version num)  # é™çº§ï¼Œå¦‚æœæ˜¯ -1 çš„è¯ï¼Œå°±æ˜¯ç›´æ¥å›é€€ä¸€çº§  +/- num ä»£è¡¨å‰è¿›å’Œåé€€å¤šå°‘ä¸ªç‰ˆæœ¬<br>alembic head  # å½“å‰æœ€æ–°çš„ç‰ˆæœ¬å·æ˜¯å“ªä¸ª<br>alembic merge -m â€˜fsdfâ€™ asdf fdasf  # åˆå¹¶ä¸¤ä¸ª head<br>alembic -c test_alembic/alembic.ini dsfajf  # æŒ‡å®šç›®å½•<br>å…·ä½“æ¼”ç¤ºä¸€äº›å¯å‚è€ƒçš„æ­¥éª¤ï¼š<br>pip install alembicï¼Œå¯ä»¥ç”¨ /anaconda/bin/pip install alembic<br>alembic init alembic_dir<br>alembic revision â€”autogenerate  # è‡ªåŠ¨è„šæœ¬ï¼Œåˆå§‹åŒ–æ•°æ®åº“ï¼Œå¼ºè°ƒ ä½¿ç”¨ autogenerate æ˜¯æ— æ³•åœ¨ä¸æœ€æ–°ç‰ˆæœ¬å·ä¸ä¸€è‡´çš„æƒ…å†µä¸‹ä½¿ç”¨çš„<br>alembic revision -m â€˜fasdfadsâ€™  # æ‰‹åŠ¨è„šæœ¬<br>init data æ’å…¥æ•°æ®ï¼Œæ¥ä¸‹æ¥çš„æ“ä½œå°±æ˜¯åœ¨å­˜åœ¨æ•°æ®çš„æƒ…å†µä¸‹è¿›è¡Œæ“ä½œï¼Œé»˜è®¤ä½¿ç”¨ autogenerate<br>å¢åŠ å­—æ®µï¼Œåˆ é™¤å­—æ®µ<br>é‡å‘½åå­—æ®µï¼Œè‡ªåŠ¨è„šæœ¬ï¼Œæ‰‹åŠ¨è„šæœ¬ï¼Œå¼•ç”³åˆ°é‡å‘½åè¡¨æ ¼<br>ä½¿ç”¨ compare_type=Trueï¼Œç„¶åè‡ªåŠ¨è„šæœ¬ æ£€æµ‹å­—æ®µç±»å‹ã€é•¿åº¦æ”¹å˜ï¼Œå‚è€ƒè¯¥é“¾æ¥<br>å¼ºè°ƒä¸€ä¸‹ï¼Œautogenerate çš„å±€é™æ€§ï¼Œå‚è€ƒé“¾æ¥å†…å®¹<br>ç»Ÿä¸€å†ä»‹ç»ä¸€ä¸‹å‡ ä¸ªç›¸å…³çš„æ“ä½œå‘½ä»¤<br>å›¢é˜Ÿä½¿ç”¨æ–¹é¢ï¼Œå®‰åˆ© flask-script çš„åŠŸèƒ½ï¼Œenv.py ç»™äºˆäº†å……åˆ†è‡ªå®šä¹‰çš„å¯èƒ½ï¼Œå¯ä»¥å‚è€ƒo2o_systemçš„ä¿®æ”¹æ¨¡å¼ï¼Œå¯æ˜¯è¦å¼ºè°ƒçš„æ˜¯æ•°æ®åº“æ“ä½œæ˜¯ä¸ªæ•æ„Ÿå†…å®¹ï¼Œä¸ç®¡æ˜¯å¤šå¤§çš„å›¢é˜Ÿï¼Œæ“ä½œæ•°æ®åº“çš„äººæ€»ä¸ä¼šæœ‰å¤ªå¤šï¼Œè¿˜æœ‰å°±æ˜¯å¦‚ä½•ä½¿ç”¨ flask-script ç®€åŒ– å‘½ä»¤ çš„è¾“å…¥ã€‚</p>
<p>op.rename_table(<br>    â€˜old_nameâ€™,<br>    â€˜new_nameâ€™<br>)<br>op.alter_column(<br>    â€˜table_nameâ€™,<br>    â€˜old_nameâ€™,<br>    â€˜existing_typeâ€™,<br>    â€˜new_nameâ€™<br>)<br>ä¸€äº›è¿›é˜¶çš„è¯´æ˜ï¼š<br>branches çš„æ“ä½œï¼Œæ¶‰åŠåˆ°äº† merge heads ç­‰å‘½ä»¤ï¼Œç„¶åè¿˜å¯ä»¥æŒ‡å®š baseã€‚<br>offline mode<br>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œè‡ªå®šä¹‰ configuration<br>æ‰‹åŠ¨å®šä¹‰è„šæœ¬ä¸­è¿˜æœ‰æ›´å¤šçš„å†…å®¹å¯ä»¥å­¦ä¹ ï¼Œoperation æœ‰è®¸å¤šæ–¹æ³•ï¼Œæ¯”è¾ƒæœ‰ç”¨çš„æ˜¯æ‰¹é‡å¤„ç†çš„éƒ¨åˆ†<br>multidb æ¨¡æ¿</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible2.0 python Api</title>
    <url>/2020/04/20/Ansible2-0-python-Api/</url>
    <content><![CDATA[<h2 id="Ansible2-0-python-Api"><a href="#Ansible2-0-python-Api" class="headerlink" title="Ansible2.0 python Api"></a>Ansible2.0 python Api</h2><blockquote>
<p>Python 3.6.2  ansible 2.4.3.0</p>
</blockquote>
<p><a href="https://docs.ansible.com/ansible/latest/dev_guide/developing_api.html#python-api-example" target="_blank" rel="noopener">å®˜æ–¹ç¤ºä¾‹</a><br>æ³¨æ„: é»˜è®¤å®˜æ–¹ç¤ºä¾‹ä¸­Ansbileçš„è¿æ¥å‚æ•°ä½¿ç”¨çš„æ˜¯local,æ‰§è¡Œå‘½ä»¤æ“ä½œæ˜¯åœ¨æœ¬åœ°</p>
<p>ç¤ºä¾‹ä¿®æ”¹åè°ƒç”¨Ansibleçš„æ¨¡å—æ‰§è¡Œè¿œç«¯å‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python  </span><br><span class="line"># -*- coding: UTF-8 -*-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">import shutil</span><br><span class="line">from collections import namedtuple</span><br><span class="line">from ansible.parsing.dataloader import DataLoader</span><br><span class="line">from ansible.vars.manager import VariableManager</span><br><span class="line">from ansible.inventory.manager import InventoryManager</span><br><span class="line">from ansible.playbook.play import Play</span><br><span class="line">from ansible.executor.task_queue_manager import TaskQueueManager</span><br><span class="line">from ansible.plugins.callback import CallbackBase</span><br><span class="line">import ansible.constants as C</span><br><span class="line"></span><br><span class="line">class ResultCallback(CallbackBase):</span><br><span class="line">    &quot;&quot;&quot;A sample callback plugin used for performing an action as results come in</span><br><span class="line"></span><br><span class="line">    If you want to collect all results into a single object for processing at</span><br><span class="line">    the end of the execution, look into utilizing the &#96;&#96;json&#96;&#96; callback plugin</span><br><span class="line">    or writing your own custom callback plugin</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def v2_runner_on_ok(self, result, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;Print a json representation of the result</span><br><span class="line"></span><br><span class="line">        This method could store the result in an instance attribute for retrieval later</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        host &#x3D; result._host</span><br><span class="line">        print(json.dumps(&#123;host.name: result._result&#125;, indent&#x3D;4))</span><br><span class="line"></span><br><span class="line"># since API is constructed for CLI it expects certain options to always be set, named tuple &#39;fakes&#39; the args parsing options object</span><br><span class="line">Options &#x3D; namedtuple(&#39;Options&#39;, [&#39;connection&#39;, &#39;module_path&#39;, &#39;forks&#39;, &#39;become&#39;, &#39;become_method&#39;, &#39;become_user&#39;, &#39;check&#39;, &#39;diff&#39;])</span><br><span class="line">options &#x3D; Options(connection&#x3D;&#39;smart&#39;, module_path&#x3D;[&#39;&#x2F;Users&#x2F;zhao&#x2F;anaconda3&#x2F;lib&#x2F;python3.6&#x2F;site-packages&#x2F;ansible&#39;], forks&#x3D;10, become&#x3D;True, become_method&#x3D;&#39;sudo&#39;, become_user&#x3D;&#39;root&#39;, check&#x3D;False, diff&#x3D;False)</span><br><span class="line"></span><br><span class="line"># initialize needed objects</span><br><span class="line">loader &#x3D; DataLoader() # Takes care of finding and reading yaml, json and ini files</span><br><span class="line">passwords &#x3D; dict(vault_pass&#x3D;&#39;secret&#39;)</span><br><span class="line"></span><br><span class="line"># Instantiate our ResultCallback for handling results as they come in. Ansible expects this to be one of its main display outlets</span><br><span class="line">results_callback &#x3D; ResultCallback()</span><br><span class="line"></span><br><span class="line"># create inventory, use path to host config file as source or hosts in a comma separated string</span><br><span class="line"># æ­¤å¤„çš„sourceså‚æ•°å¯ä»¥æ˜¯hostsæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•,ä¹Ÿå¯ä»¥æ˜¯å®Œæ•´çš„æ–‡ä»¶è·¯å¾„,æˆ–è€…ä¸»æœºå­—ç¬¦ä¸²,ä½¿ç”¨é€—å·åˆ†å‰²</span><br><span class="line">inventory &#x3D; InventoryManager(loader&#x3D;loader, sources&#x3D;&#39;&#x2F;Users&#x2F;zhao&#x2F;work&#x2F;playbook&#x2F;inventory&#39;)</span><br><span class="line"></span><br><span class="line"># variable manager takes care of merging all the different sources to give you a unifed view of variables available in each context</span><br><span class="line">variable_manager &#x3D; VariableManager(loader&#x3D;loader, inventory&#x3D;inventory)</span><br><span class="line"></span><br><span class="line"># create datastructure that represents our play, including tasks, this is basically what our YAML loader does internally.</span><br><span class="line">play_source &#x3D;  dict(</span><br><span class="line">        name &#x3D; &quot;Ansible Play&quot;,</span><br><span class="line">        # éœ€è¦æ‰§è¡Œçš„ä¸»æœºæˆ–è€…ä¸»æœºç»„</span><br><span class="line">        hosts &#x3D; &#39;nginx-test&#39;,</span><br><span class="line">        gather_facts &#x3D; &#39;no&#39;,</span><br><span class="line">        tasks &#x3D; [</span><br><span class="line">            dict(action&#x3D;dict(module&#x3D;&#39;shell&#39;, args&#x3D;&#39;whoami&#39;), register&#x3D;&#39;shell_out&#39;),</span><br><span class="line">            dict(action&#x3D;dict(module&#x3D;&#39;debug&#39;, args&#x3D;dict(msg&#x3D;&#39;&#123;&#123;shell_out.stdout&#125;&#125;&#39;)))</span><br><span class="line">         ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"># Create play object, playbook objects use .load instead of init or new methods,</span><br><span class="line"># this will also automatically create the task objects from the info provided in play_source</span><br><span class="line">play &#x3D; Play().load(play_source, variable_manager&#x3D;variable_manager, loader&#x3D;loader)</span><br><span class="line"></span><br><span class="line"># Run it - instantiate task queue manager, which takes care of forking and setting up all objects to iterate over host list and tasks</span><br><span class="line">tqm &#x3D; None</span><br><span class="line">try:</span><br><span class="line">    tqm &#x3D; TaskQueueManager(</span><br><span class="line">              inventory&#x3D;inventory,</span><br><span class="line">              variable_manager&#x3D;variable_manager,</span><br><span class="line">              loader&#x3D;loader,</span><br><span class="line">              options&#x3D;options,</span><br><span class="line">              passwords&#x3D;passwords,</span><br><span class="line">              stdout_callback&#x3D;results_callback,  # Use our custom callback instead of the &#96;&#96;default&#96;&#96; callback plugin, which prints to stdout</span><br><span class="line">          )</span><br><span class="line">    result &#x3D; tqm.run(play) # most interesting data for a play is actually sent to the callback&#39;s methods</span><br><span class="line">finally:</span><br><span class="line">    # we always need to cleanup child procs and the structres we use to communicate with them</span><br><span class="line">    if tqm is not None:</span><br><span class="line">        tqm.cleanup()</span><br><span class="line"></span><br><span class="line">     # Remove ansible tmpdir</span><br><span class="line">    shutil.rmtree(C.DEFAULT_LOCAL_TMP, True)</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹:</span><br></pre></td></tr></table></figure>
<p>{<br>    â€œngx-brazil-test01br-t001.gru1.wecash.netâ€: {<br>        â€œchangedâ€: true,<br>        â€œendâ€: â€œ2018-06-20 10:59:36.486658â€,<br>        â€œstdoutâ€: â€œrootâ€,<br>        â€œcmdâ€: â€œwhoamiâ€,<br>        â€œrcâ€: 0,<br>        â€œstartâ€: â€œ2018-06-20 10:59:36.484856â€,<br>        â€œstderrâ€: â€œâ€,<br>        â€œdeltaâ€: â€œ0:00:00.001802â€,<br>        â€œinvocationâ€: {<br>            â€œmodule_argsâ€: {<br>                â€œwarnâ€: true,<br>                â€œexecutableâ€: null,<br>                â€œ_uses_shellâ€: true,<br>                â€œ_raw_paramsâ€: â€œwhoamiâ€,<br>                â€œremovesâ€: null,<br>                â€œcreatesâ€: null,<br>                â€œchdirâ€: null,<br>                â€œstdinâ€: null<br>            }<br>        },<br>        â€œ_ansible_parsedâ€: true,<br>        â€œstdout_linesâ€: [<br>            â€œrootâ€<br>        ],<br>        â€œstderr_linesâ€: [],<br>        â€œ_ansible_no_logâ€: false<br>    }<br>}<br>{<br>    â€œngx-brazil-test01br-t001.gru1.wecash.netâ€: {<br>        â€œmsgâ€: â€œrootâ€,<br>        â€œ_ansible_verbose_alwaysâ€: true,<br>        â€œ_ansible_no_logâ€: false,<br>        â€œchangedâ€: false<br>    }<br>}<br>```</p>
]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>Django è‡ªå®šä¹‰åˆ†é¡µå®ç°</title>
    <url>/2020/04/20/Django-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="Django-è‡ªå®šä¹‰åˆ†é¡µå®ç°"><a href="#Django-è‡ªå®šä¹‰åˆ†é¡µå®ç°" class="headerlink" title="Django è‡ªå®šä¹‰åˆ†é¡µå®ç°"></a>Django è‡ªå®šä¹‰åˆ†é¡µå®ç°</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2017&#x2F;9&#x2F;9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Page(object):</span><br><span class="line">    def __init__(self, current_page, all_count, base_url, per_page&#x3D;10, pager_page_count&#x3D;11):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        :param current_page: å½“å‰é¡µ</span><br><span class="line">        :param all_count: æ•°æ®æ€»æ¡æ•°</span><br><span class="line">        :param base_url: åˆ†é¡µçš„url</span><br><span class="line">        :param per_page: æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°</span><br><span class="line">        :param pager_page_count: æ¯é¡µæ˜¾ç¤ºçš„é¡µç æ•°é‡</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.current_page &#x3D; current_page</span><br><span class="line">        self.per_page &#x3D; per_page</span><br><span class="line">        self.all_count &#x3D; all_count</span><br><span class="line">        self.base_url &#x3D; base_url</span><br><span class="line">        self.pager_page_count &#x3D; pager_page_count</span><br><span class="line">        pager_count, b &#x3D; divmod(all_count, per_page)</span><br><span class="line">        if b !&#x3D; 0:</span><br><span class="line">            pager_count +&#x3D; 1</span><br><span class="line">        self.pager_count &#x3D; pager_count</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def start(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ•°æ®åº“è·å–å€¼çš„èµ·å§‹ç´¢å¼•ä½ç½®</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return (self.current_page - 1) * self.per_page</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def end(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ•°æ®åº“è·å–å€¼çš„ç»“æŸç´¢å¼•ä½ç½®</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return self.current_page * self.per_page</span><br><span class="line"></span><br><span class="line">    def page_html(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ¸²æŸ“çš„HTMLé¡µç </span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # é¡µç </span><br><span class="line">        pager_page_count &#x3D; self.pager_page_count</span><br><span class="line">        half_pager_page_count &#x3D; int(pager_page_count &#x2F; 2)</span><br><span class="line"></span><br><span class="line">        if self.pager_count &lt; self.pager_page_count:</span><br><span class="line">            pager_start &#x3D; 1</span><br><span class="line">            pager_end &#x3D; self.pager_count</span><br><span class="line">        else:</span><br><span class="line">            # æ•°æ®è¾ƒå¤šï¼Œé¡µç è¶…è¿‡11ï¼Œæœ€å°‘110æ¡</span><br><span class="line">            if self.current_page &lt;&#x3D; half_pager_page_count:</span><br><span class="line">                pager_start &#x3D; 1</span><br><span class="line">                pager_end &#x3D; pager_page_count</span><br><span class="line">            else:</span><br><span class="line">                if (self.current_page + half_pager_page_count) &gt; self.pager_count:</span><br><span class="line">                    pager_start &#x3D; self.pager_count - pager_page_count + 1</span><br><span class="line">                    pager_end &#x3D; self.pager_count</span><br><span class="line">                else:</span><br><span class="line">                    pager_start &#x3D; self.current_page - half_pager_page_count</span><br><span class="line">                    pager_end &#x3D; self.current_page + half_pager_page_count</span><br><span class="line">        page_list &#x3D; []</span><br><span class="line">        if self.current_page &lt;&#x3D; 1:</span><br><span class="line">            # prev &#x3D; &#39;&lt;a href&#x3D;&quot;#&quot;&gt;ä¸Šä¸€é¡µ&lt;&#x2F;a&gt;&#39;</span><br><span class="line">            prev &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot; aria-label&#x3D;&quot;Previous&quot;&gt;&lt;span aria-hidden&#x3D;&quot;true&quot;&gt;&amp;laquo;&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line">        else:</span><br><span class="line">            # prev &#x3D; &#39;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;ä¸Šä¸€é¡µ&lt;&#x2F;a&gt;&#39; % (self.base_url, self.current_page - 1,)</span><br><span class="line">            prev &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot; aria-label&#x3D;&quot;Previous&quot;&gt;&lt;span aria-hidden&#x3D;&quot;true&quot;&gt;&amp;laquo;&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % \</span><br><span class="line">                   (self.base_url, self.current_page - 1)</span><br><span class="line">        page_list.append(prev)</span><br><span class="line">        for i in range(pager_start, pager_end + 1):</span><br><span class="line">            if self.current_page &#x3D;&#x3D; i:</span><br><span class="line">                # tpl &#x3D; &#39;&lt;a class&#x3D;&quot;active&quot; href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&#39; % (self.base_url, i, i)</span><br><span class="line">                tpl &#x3D; &#39;&lt;li class&#x3D;&quot;active&quot;&gt;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.base_url, i, i)</span><br><span class="line">            else:</span><br><span class="line">                # tpl &#x3D; &#39;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&#39; % (self.base_url, i, i)</span><br><span class="line">                tpl &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;%s&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % (self.base_url, i, i)</span><br><span class="line">            page_list.append(tpl)</span><br><span class="line"></span><br><span class="line">        if self.current_page &gt;&#x3D; self.pager_count:</span><br><span class="line">            # nex &#x3D; &#39;&lt;a href&#x3D;&quot;#&quot;&gt;ä¸‹ä¸€é¡µ&lt;&#x2F;a&gt;&#39;</span><br><span class="line">            nex &#x3D; &#39;&lt;li class&#x3D;&quot;disabled&quot;&gt;&lt;a href&#x3D;&quot;#&quot; aria-label&#x3D;&quot;Next&quot;&gt;&lt;span aria-hidden&#x3D;&quot;true&quot;&gt;&amp;raquo;&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39;</span><br><span class="line">        else:</span><br><span class="line">            # nex &#x3D; &#39;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot;&gt;ä¸‹ä¸€é¡µ&lt;&#x2F;a&gt;&#39; % (self.base_url, self.current_page + 1,)</span><br><span class="line">            nex &#x3D; &#39;&lt;li&gt;&lt;a href&#x3D;&quot;%s?page&#x3D;%s&quot; aria-label&#x3D;&quot;Next&quot;&gt;&lt;span aria-hidden&#x3D;&quot;true&quot;&gt;&amp;raquo;&lt;&#x2F;span&gt;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#39; % \</span><br><span class="line">                  (self.base_url, self.current_page + 1)</span><br><span class="line">        page_list.append(nex)</span><br><span class="line">        page_str &#x3D; &quot;&quot;.join(page_list)</span><br><span class="line">        return page_str</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Ansible APIè°ƒç”¨æµ‹è¯•</title>
    <url>/2020/04/20/Ansible-API%E8%B0%83%E7%94%A8%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<h2 id="Ansible-APIè°ƒç”¨æµ‹è¯•"><a href="#Ansible-APIè°ƒç”¨æµ‹è¯•" class="headerlink" title="Ansible APIè°ƒç”¨æµ‹è¯•"></a>Ansible APIè°ƒç”¨æµ‹è¯•</h2><p>æœ¬æ–‡ä¸»è¦ä½œä¸ºè®°å½•å¹¶æœªå®é™…ä½¿ç”¨éªŒè¯</p>
<p>ä»¥ä¸‹ä»£ç æ˜¯åšä¸»æµ‹è¯•ä½¿ç”¨çš„ä»£ç ï¼Œåšä¸»æµ‹è¯•ä½¿ç”¨å¯†ç æ¥æµ‹è¯•ï¼Œå¦‚éœ€ç§˜é’¥åªè¦å°†passwordæ³¨é‡Šäº†å°±å¯ä»¥ä½¿ç”¨ç§˜é’¥äº†ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat test.py</span><br><span class="line"></span><br><span class="line">#! &#x2F;usr&#x2F;local&#x2F;bin&#x2F;python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">from  setup.ansible_api.runner import AdHocRunner, CommandRunner, PlayBookRunner</span><br><span class="line">from  setup.ansible_api.inventory import BaseInventory</span><br><span class="line"></span><br><span class="line">def  TestAdHocRunner():</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">         ä»¥ymlçš„å½¢å¼ æ‰§è¡Œå¤šä¸ªå‘½ä»¤</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        host_data &#x3D; [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;hostname&quot;: &quot;192.168.188.6&quot;,</span><br><span class="line">                &quot;ip&quot;: &quot;192.168.188.6&quot;,</span><br><span class="line">                &quot;port&quot;: 22,</span><br><span class="line">                &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">                &quot;password&quot;: &quot;admin12&quot;,</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">        inventory &#x3D; BaseInventory(host_data)</span><br><span class="line">        runner &#x3D; AdHocRunner(inventory)</span><br><span class="line"></span><br><span class="line">        tasks &#x3D; [</span><br><span class="line">            # &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;cron&quot;,&quot;args&quot;: &quot;name&#x3D;\&quot;sync time\&quot; minute&#x3D;\&quot;*&#x2F;3\&quot; job&#x3D;\&quot;&#x2F;usr&#x2F;sbin&#x2F;ntpdate time.nist.gov &amp;&gt; &#x2F;dev&#x2F;null\&quot;&quot; &#125;, &quot;name&quot;: &quot;run_cmd&quot;&#125;,</span><br><span class="line">            # &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;shell&quot;, &quot;args&quot;: &quot;ls &#x2F;root1&quot;&#125;, &quot;name&quot;: &quot;run_whoami&quot;&#125;,</span><br><span class="line">            # &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;copy&quot;, &quot;args&quot;: &quot;src&#x3D;&#x2F;home&#x2F;23.txt dest&#x3D;&#x2F;tmp&quot;,&quot;mode&quot;:&quot;0644&quot;&#125;, &quot;name&quot;: &quot;run_whoami&quot;&#125;,</span><br><span class="line">            # &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;setup&quot;, &quot;args&quot;: &quot;&quot;&#125;, &quot;name&quot;: &quot;run_whoami&quot;&#125;,</span><br><span class="line">            &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;ping&quot;, &quot;args&quot;: &quot;&quot;&#125;, &quot;name&quot;: &quot;run_whoami&quot;&#125;,</span><br><span class="line">            # &#123;&quot;action&quot;: &#123;&quot;module&quot;: &quot;yum&quot;, &quot;args&quot;: &quot;name&#x3D;httpd state&#x3D;latest&quot;&#125;, &quot;name&quot;: &quot;run_whoami&quot;&#125;,</span><br><span class="line">        ]</span><br><span class="line">        ret &#x3D; runner.run(tasks, &quot;all&quot;)</span><br><span class="line">        print(ret.results_summary)</span><br><span class="line">        print(ret.results_raw)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def TestCommandRunner():</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ‰§è¡Œå•ä¸ªå‘½ä»¤ï¼Œè¿”å›ç»“æœ</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        host_data &#x3D; [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;hostname&quot;: &quot;192.168.188.6&quot;,</span><br><span class="line">                &quot;ip&quot;: &quot;192.168.188.6&quot;,</span><br><span class="line">                &quot;port&quot;: 22,</span><br><span class="line">                &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">                &quot;password&quot;: &quot;admin12&quot;,</span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">        inventory &#x3D; BaseInventory(host_data)</span><br><span class="line">        runner &#x3D; CommandRunner(inventory)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        res &#x3D; runner.execute(&#39;who&#39;, &#39;all&#39;)</span><br><span class="line">        print(res.results_command)</span><br><span class="line">        print(res.results_raw)</span><br><span class="line">        print(res.results_command[&#39;192.168.188.6&#39;][&#39;stdout&#39;])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def TestPlayBookRunner():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">     ä»¥ymlçš„å½¢å¼ æ‰§è¡Œå¤šä¸ªå‘½ä»¤</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    host_data &#x3D; [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;hostname&quot;: &quot;192.168.188.6&quot;,</span><br><span class="line">            &quot;ip&quot;: &quot;192.168.188.5&quot;,</span><br><span class="line">            &quot;port&quot;: 22,</span><br><span class="line">            &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">            &quot;password&quot;: &quot;admin12&quot;,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    inventory &#x3D; BaseInventory(host_data)</span><br><span class="line">    path &#x3D; &#39;&#x2F;etc&#x2F;ansible&#x2F;webservice.yml&#39;</span><br><span class="line">    runner &#x3D; PlayBookRunner(playbook_path&#x3D;path,inventory&#x3D;inventory)</span><br><span class="line">    ret &#x3D; runner.run()</span><br><span class="line">    print(ret)</span><br><span class="line"></span><br><span class="line">def  TestInventoryRunner():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è¿”å›ä¸»æœºä¿¡æ¯ï¼Œç»„ä¿¡æ¯ï¼Œç»„å†…ä¸»æœºä¿¡æ¯</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    host_list &#x3D; [&#123;</span><br><span class="line">        &quot;hostname&quot;: &quot;testserver1&quot;,</span><br><span class="line">        &quot;ip&quot;: &quot;102.1.1.1&quot;,</span><br><span class="line">        &quot;port&quot;: 22,</span><br><span class="line">        &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;password&quot;,</span><br><span class="line">        &quot;private_key&quot;: &quot;&#x2F;tmp&#x2F;private_key&quot;,</span><br><span class="line">        &quot;become&quot;: &#123;</span><br><span class="line">            &quot;method&quot;: &quot;sudo&quot;,</span><br><span class="line">            &quot;user&quot;: &quot;root&quot;,</span><br><span class="line">            &quot;pass&quot;: None,</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;groups&quot;: [&quot;group1&quot;, &quot;group2&quot;],</span><br><span class="line">        &quot;vars&quot;: &#123;&quot;sexy&quot;: &quot;yes&quot;&#125;,</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        &quot;hostname&quot;: &quot;testserver2&quot;,</span><br><span class="line">        &quot;ip&quot;: &quot;8.8.8.8&quot;,</span><br><span class="line">        &quot;port&quot;: 2222,</span><br><span class="line">        &quot;username&quot;: &quot;root&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;password&quot;,</span><br><span class="line">        &quot;private_key&quot;: &quot;&#x2F;tmp&#x2F;private_key&quot;,</span><br><span class="line">        &quot;become&quot;: &#123;</span><br><span class="line">            &quot;method&quot;: &quot;su&quot;,</span><br><span class="line">            &quot;user&quot;: &quot;root&quot;,</span><br><span class="line">            &quot;pass&quot;: &quot;123&quot;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;groups&quot;: [&quot;group3&quot;, &quot;group4&quot;],</span><br><span class="line">        &quot;vars&quot;: &#123;&quot;love&quot;: &quot;yes&quot;&#125;,</span><br><span class="line">    &#125;]</span><br><span class="line"></span><br><span class="line">    inventory &#x3D; BaseInventory(host_list&#x3D;host_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print(&quot;#&quot;*10 + &quot;Hosts&quot; + &quot;#&quot;*10)</span><br><span class="line">    for host in inventory.hosts:</span><br><span class="line">        print(host)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print(&quot;#&quot; * 10 + &quot;Groups&quot; + &quot;#&quot; * 10)</span><br><span class="line">    for group in inventory.groups:</span><br><span class="line">        print(group)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    print(&quot;#&quot; * 10 + &quot;all group hosts&quot; + &quot;#&quot; * 10)</span><br><span class="line">    group &#x3D; inventory.get_group(&#39;all&#39;)</span><br><span class="line">    print(group.hosts)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    TestPlayBookRunner()</span><br><span class="line">    TestAdHocRunnerRunner()</span><br><span class="line">    TestCommandRunner()</span><br><span class="line">    TestInventoryRunner()</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æµ‹è¯•è°ƒç”¨AdHocçš„æµ‹è¯•ç»“æœï¼Œåšä¸»æ¯”è¾ƒæ‡’ï¼Œåªæµ‹è¯•ä¸€ä¸ªpingæ¨¡å—ï¼Œå…¶ä»–æ¨¡å—ç½‘å‹è¯·è‡ªè¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PLAY [Ansible Ad-hoc] **********************************************************</span><br><span class="line"></span><br><span class="line">TASK [ping] ********************************************************************</span><br><span class="line">ok: [192.168.188.6]</span><br><span class="line">&#123;&#39;ok&#39;: &#123;&#39;192.168.188.6&#39;: &#123;&#39;ping&#39;: &#123;&#39;invocation&#39;: &#123;&#39;module_args&#39;: &#123;&#39;data&#39;: &#39;pong&#39;&#125;&#125;, &#39;ping&#39;: &#39;pong&#39;, &#39;_ansible_parsed&#39;: True, &#39;_ansible_no_log&#39;: False, &#39;changed&#39;: False&#125;&#125;&#125;, &#39;failed&#39;: &#123;&#125;, &#39;unreachable&#39;: &#123;&#125;, &#39;skipped&#39;: &#123;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æµ‹è¯•è°ƒç”¨Commandçš„æµ‹è¯•ç»“æœï¼Œæµ‹è¯•åœ¨ç›®æ ‡æœºå™¨ä¸Šé¢ä½¿ç”¨whoå‘½ä»¤ï¼Œå…¶ä»–å‘½ä»¤ç½‘å‹è‡ªè¡Œæµ‹è¯•ã€‚å¦å¤–è°ƒç”¨TestCommandRunner()å¿…é¡»æ˜¯ä»¥ä¸‹æ¨¡å—â€™shellâ€™, â€˜rawâ€™, â€˜commandâ€™, â€˜scriptâ€™ï¼Œå…¶ä»–æ¨¡å—ï¼Œè¯·ä½¿ç”¨AdHocã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PLAY [Run command who on 192.168.188.6] ****************************************</span><br><span class="line"></span><br><span class="line">TASK [command] *****************************************************************</span><br><span class="line">changed: [192.168.188.6]</span><br><span class="line">&#123;&#39;192.168.188.6&#39;: &#123;&#39;cmd&#39;: &#39;who&#39;, &#39;stderr&#39;: &#39;&#39;, &#39;stdout&#39;: &#39;root     :0           2018-03-10 09:59 (:0)\nroot     pts&#x2F;1        2018-03-10 10:15 (192.168.188.7)&#39;, &#39;rc&#39;: 0, &#39;delta&#39;: &#39;0:00:00.017265&#39;&#125;&#125;</span><br><span class="line">&#123;&#39;ok&#39;: &#123;&#39;192.168.188.6&#39;: &#123;&#39;command&#39;: &#123;&#39;changed&#39;: True, &#39;end&#39;: &#39;2018-03-10 10:15:21.892560&#39;, &#39;stdout&#39;: &#39;root     :0           2018-03-10 09:59 (:0)\nroot     pts&#x2F;1        2018-03-10 10:15 (192.168.188.7)&#39;, &#39;cmd&#39;: &#39;who&#39;, &#39;rc&#39;: 0, &#39;start&#39;: &#39;2018-03-10 10:15:21.875295&#39;, &#39;stderr&#39;: &#39;&#39;, &#39;delta&#39;: &#39;0:00:00.017265&#39;, &#39;invocation&#39;: &#123;&#39;module_args&#39;: &#123;&#39;warn&#39;: True, &#39;executable&#39;: None, &#39;_uses_shell&#39;: True, &#39;_raw_params&#39;: &#39;who&#39;, &#39;removes&#39;: None, &#39;creates&#39;: None, &#39;chdir&#39;: None, &#39;stdin&#39;: None&#125;&#125;, &#39;_ansible_parsed&#39;: True, &#39;stdout_lines&#39;: [&#39;root     :0           2018-03-10 09:59 (:0)&#39;, &#39;root     pts&#x2F;1        2018-03-10 10:15 (192.168.188.7)&#39;], &#39;stderr_lines&#39;: [], &#39;_ansible_no_log&#39;: False&#125;&#125;&#125;, &#39;failed&#39;: &#123;&#125;, &#39;unreachable&#39;: &#123;&#125;, &#39;skipped&#39;: &#123;&#125;&#125;</span><br><span class="line">root     :0           2018-03-10 09:59 (:0)</span><br><span class="line">root     pts&#x2F;1        2018-03-10 10:15 (192.168.188.7)</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æµ‹è¯•è°ƒç”¨PlayBookçš„æµ‹è¯•ç»“æœã€‚<br>ä¸‹é¢æ˜¯åšä¸»ä½¿ç”¨çš„playbookæ–‡ä»¶ï¼Œåªæ˜¯ç®€å•çš„touchä¸€ä¸ª123.txtæ–‡ä»¶ï¼Œå…¶ä»–ç½‘å‹è‡ªè¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- hosts: te</span><br><span class="line">  remote_user: root</span><br><span class="line">  vars:</span><br><span class="line">    - touch_flile: 123.txt</span><br><span class="line">  tasks:</span><br><span class="line">    - name: touch file</span><br><span class="line">      shell: &quot;touch &#x2F;tmp&#x2F;&#123;&#123; touch_flile &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸‹ç»“æœæ˜¯ç»è¿‡åšä¸»jsonæ ¼å¼è½¬æ¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&#39;results&#39;: [&#123;</span><br><span class="line">		&#39;task&#39;: &#123;</span><br><span class="line">			&#39;name&#39;: &#39;Gathering Facts&#39;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#39;hosts&#39;: &#123;</span><br><span class="line">			&#39;192.168.188.6&#39;: &#123;</span><br><span class="line">				&#39;invocation&#39;: &#123;</span><br><span class="line">					&#39;module_args&#39;: &#123;</span><br><span class="line">						&#39;filter&#39;: &#39;*&#39;,</span><br><span class="line">						&#39;gather_subset&#39;: [&#39;all&#39;],</span><br><span class="line">						&#39;fact_path&#39;: &#39;&#x2F;etc&#x2F;ansible&#x2F;facts.d&#39;,</span><br><span class="line">						&#39;gather_timeout&#39;: 10</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				&#39;_ansible_parsed&#39;: True,</span><br><span class="line">				&#39;_ansible_verbose_override&#39;: True,</span><br><span class="line">				&#39;_ansible_no_log&#39;: False,</span><br><span class="line">				&#39;changed&#39;: False</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;, &#123;</span><br><span class="line">		&#39;task&#39;: &#123;</span><br><span class="line">			&#39;name&#39;: &#39;touch file&#39;</span><br><span class="line">		&#125;,</span><br><span class="line">		&#39;hosts&#39;: &#123;</span><br><span class="line">			&#39;192.168.188.6&#39;: &#123;</span><br><span class="line">				&#39;changed&#39;: True,</span><br><span class="line">				&#39;end&#39;: &#39;2018-03-10 18:14:52.078526&#39;,</span><br><span class="line">				&#39;stdout&#39;: &#39;&#39;,</span><br><span class="line">				&#39;cmd&#39;: &#39;touch &#x2F;tmp&#x2F;123.txt&#39;,</span><br><span class="line">				&#39;rc&#39;: 0,</span><br><span class="line">				&#39;start&#39;: &#39;2018-03-10 18:14:52.064544&#39;,</span><br><span class="line">				&#39;stderr&#39;: &#39;&#39;,</span><br><span class="line">				&#39;delta&#39;: &#39;0:00:00.013982&#39;,</span><br><span class="line">				&#39;invocation&#39;: &#123;</span><br><span class="line">					&#39;module_args&#39;: &#123;</span><br><span class="line">						&#39;warn&#39;: True,</span><br><span class="line">						&#39;executable&#39;: None,</span><br><span class="line">						&#39;_uses_shell&#39;: True,</span><br><span class="line">						&#39;_raw_params&#39;: &#39;touch &#x2F;tmp&#x2F;123.txt&#39;,</span><br><span class="line">						&#39;removes&#39;: None,</span><br><span class="line">						&#39;creates&#39;: None,</span><br><span class="line">						&#39;chdir&#39;: None,</span><br><span class="line">						&#39;stdin&#39;: None</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;,</span><br><span class="line">				&#39;warnings&#39;: [&#39;Consider using file module with state&#x3D;touch rather than running touch&#39;],</span><br><span class="line">				&#39;_ansible_parsed&#39;: True,</span><br><span class="line">				&#39;stdout_lines&#39;: [],</span><br><span class="line">				&#39;stderr_lines&#39;: [],</span><br><span class="line">				&#39;_ansible_no_log&#39;: False</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;],</span><br><span class="line">	&#39;status&#39;: &#123;</span><br><span class="line">		&#39;192.168.188.6&#39;: &#123;</span><br><span class="line">			&#39;ok&#39;: 2,</span><br><span class="line">			&#39;failures&#39;: 0,</span><br><span class="line">			&#39;unreachable&#39;: 0,</span><br><span class="line">			&#39;changed&#39;: 1,</span><br><span class="line">			&#39;skipped&#39;: 0</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æµ‹è¯•Inventory</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">##########Hosts##########</span><br><span class="line">testserver1</span><br><span class="line">testserver2</span><br><span class="line">##########Groups##########</span><br><span class="line">all</span><br><span class="line">ungrouped</span><br><span class="line">group1</span><br><span class="line">group2</span><br><span class="line">group3</span><br><span class="line">group4</span><br><span class="line">##########all group hosts##########</span><br><span class="line">[testserver1, testserver2]</span><br></pre></td></tr></table></figure>

<p><a href="http://www.panzxl.com/archives/42" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>Django èšåˆ</title>
    <url>/2020/04/20/Django-%E8%81%9A%E5%90%88/</url>
    <content><![CDATA[<h1 id="Django-èšåˆ"><a href="#Django-èšåˆ" class="headerlink" title="Django èšåˆ"></a>Django èšåˆ</h1><hr>

<ol>
<li>åœ¨æŸ¥è¯¢é›†ä¸Šç”Ÿæˆèšåˆ(aggregate)<br>aggregate()æ˜¯QuerySet çš„ä¸€ä¸ªç»ˆæ­¢å­å¥ï¼Œæ„æ€æ˜¯è¯´ï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ…å«ä¸€äº›é”®å€¼å¯¹çš„å­—å…¸ã€‚é”®çš„åç§°æ˜¯èšåˆå€¼çš„æ ‡è¯†ç¬¦ï¼Œå€¼æ˜¯è®¡ç®—å‡ºæ¥çš„èšåˆå€¼ã€‚é”®çš„åç§°æ˜¯æŒ‰ç…§å­—æ®µå’Œèšåˆå‡½æ•°çš„åç§°è‡ªåŠ¨ç”Ÿæˆå‡ºæ¥çš„ã€‚å¦‚æœä½ æƒ³è¦ä¸ºèšåˆå€¼æŒ‡å®šä¸€ä¸ªåç§°ï¼Œå¯ä»¥å‘èšåˆå­å¥æä¾›å®ƒã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Book.objects.aggregate(average_price&#x3D;Avg(&#39;price&#39;))</span><br><span class="line">&#123;&#39;average_price&#39;: 34.35&#125;</span><br></pre></td></tr></table></figure></li>
<li>ä¸ºæŸ¥è¯¢é›†çš„æ¯ä¸€é¡¹ç”Ÿæˆèšåˆ(annotate)<br>é€ä¸ªå¯¹è±¡çš„æ±‡æ€»ç»“æœå¯ä»¥ç”±annotate()å­å¥ç”Ÿæˆã€‚å½“annotate()å­å¥è¢«æŒ‡å®šä¹‹åï¼ŒQuerySetä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ä¼šè¢«æ³¨ä¸Šç‰¹å®šçš„å€¼ã€‚<br>è¿™äº›æ³¨è§£çš„è¯­æ³•éƒ½å’Œaggregate()å­å¥æ‰€ä½¿ç”¨çš„ç›¸åŒã€‚annotate()çš„æ¯ä¸ªå‚æ•°éƒ½æè¿°äº†å°†è¦è¢«è®¡ç®—çš„èšåˆã€‚æ¯”å¦‚ï¼Œç»™å›¾ä¹¦æ·»åŠ ä½œè€…æ•°é‡çš„æ³¨è§£ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Build an annotated queryset</span><br><span class="line">&gt;&gt;&gt; from django.db.models import Count</span><br><span class="line">&gt;&gt;&gt; q &#x3D; Book.objects.annotate(Count(&#39;authors&#39;))</span><br><span class="line"># Interrogate the first object in the queryset</span><br><span class="line">&gt;&gt;&gt; q[0]</span><br><span class="line">&lt;Book: The Definitive Guide to Django&gt;</span><br><span class="line">&gt;&gt;&gt; q[0].authors__count</span><br><span class="line">2</span><br><span class="line"># Interrogate the second object in the queryset</span><br><span class="line">&gt;&gt;&gt; q[1]</span><br><span class="line">&lt;Book: Practical Django Projects&gt;</span><br><span class="line">&gt;&gt;&gt; q[1].authors__count</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
å’Œä½¿ç”¨ aggregate()ä¸€æ ·ï¼Œæ³¨è§£çš„åç§°ä¹Ÿæ ¹æ®èšåˆå‡½æ•°çš„åç§°å’Œèšåˆå­—æ®µçš„åç§°å¾—åˆ°çš„ã€‚ä½ å¯ä»¥åœ¨æŒ‡å®šæ³¨è§£æ—¶ï¼Œä¸ºé»˜è®¤åç§°æä¾›ä¸€ä¸ªåˆ«åï¼š</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; q &#x3D; Book.objects.annotate(num_authors&#x3D;Count(&#39;authors&#39;))</span><br><span class="line">&gt;&gt;&gt; q[0].num_authors</span><br><span class="line">2</span><br><span class="line">&gt;&gt;&gt; q[1].num_authors</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>ä¸ aggregate() ä¸åŒçš„æ˜¯ï¼Œ annotate() ä¸æ˜¯ä¸€ä¸ªç»ˆæ­¢å­å¥ã€‚annotate()å­å¥çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªæŸ¥è¯¢é›† (QuerySet)ï¼›è¿™ä¸ª QuerySetå¯ä»¥ç”¨ä»»ä½•QuerySetæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼ŒåŒ…æ‹¬ filter(), order_by(), ç”šè‡³æ˜¯å†æ¬¡åº”ç”¨annotate()ã€‚</p>
<p><a href="http://python.usyiyi.cn/documents/django_182/topics/db/aggregation.html" target="_blank" rel="noopener">Django èšåˆ</a></p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Djangoåºåˆ—åŒ–</title>
    <url>/2020/04/20/Django%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    <content><![CDATA[<h2 id="Djangoåºåˆ—åŒ–"><a href="#Djangoåºåˆ—åŒ–" class="headerlink" title="Djangoåºåˆ—åŒ–"></a>Djangoåºåˆ—åŒ–</h2><h3 id="é—®é¢˜ä¸€"><a href="#é—®é¢˜ä¸€" class="headerlink" title="é—®é¢˜ä¸€"></a>é—®é¢˜ä¸€</h3><p>åºåˆ—åŒ–çš„modelä¸­å«choiceå­—æ®µä¿¡æ¯å­˜åœ¨çš„é—®é¢˜ï¼Œstatusä¼šæ˜¾ç¤ºæ•°å­—è€ŒéçŠ¶æ€ç›¸å…³çš„æ–‡æœ¬ï¼Œé€šè¿‡åœ¨<code>serializers.py</code>æ–‡ä»¶ä¸­æ·»åŠ å¦ä¸€ä¸ª<code>status_display</code>å­—æ®µç±»æ˜¾ç¤ºçŠ¶æ€æ–‡æœ¬ï¼Œä¾¿å¯ä»¥è§£å†³è¯¥é—®é¢˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from restâ€”â€”framework import serializers</span><br><span class="line">from .models import Sprint,Task</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">class TaskSerializer(serializers.ModelSerializer):</span><br><span class="line">   status_display &#x3D; serializers.SerializerMethodField()</span><br><span class="line">   </span><br><span class="line">   class Meta:</span><br><span class="line">       model &#x3D; Task</span><br><span class="line">       fields &#x3D; (&quot;id&quot;,&quot;name&quot;,&quot;description&quot;,&quot;sprint&quot;,&quot;status&quot;,&quot;status_display&quot;,&quot;order&quot;,&quot;assignred&quot;,&quot;started&quot;,&quot;due&quot;,&quot;completed&quot;,)</span><br><span class="line">       </span><br><span class="line">   def get_status_display(self,obj):</span><br><span class="line">       return obj.get_status_display()</span><br></pre></td></tr></table></figure>
<ul>
<li>status_display æ˜¯ä¸€ä¸ªåªè¯»å­—æ®µï¼Œè¿”å›åºåˆ—åŒ–å™¨ä¸­<code>get_status_display</code>ä¸­æ–¹æ³•çš„å€¼,è¯¥æ–¹æ³•çš„è¯­æ³•æ ¼å¼ä¸º<code>get</code> + ä¸‹åˆ’çº¿ + å­—æ®µåç§°ç»„æˆï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼Œ<code>get_status_display</code></li>
</ul>
<h3 id="é—®é¢˜äºŒ"><a href="#é—®é¢˜äºŒ" class="headerlink" title="é—®é¢˜äºŒ"></a>é—®é¢˜äºŒ</h3><blockquote>
<p>åºåˆ—åŒ–é‡åˆ°çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯: <code>assigned</code>æ˜¯ä¸€ä¸ªæŒ‡å‘<code>User</code>æ¨¡å‹ä¸­çš„å¤–é”®,è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ç”¨æˆ·çš„ä¸»é”®ï¼Œç„¶è€Œæˆ‘ä»¬çš„URLç»“æ„æœŸæœ›é€šè¿‡ç”¨æˆ·åæ¥å¼•ç”¨ç”¨æˆ·ï¼Œæˆ‘ä»¬åœ¨<code>serializers</code>ä¸­ä½¿ç”¨<code>SlugRelatedField</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜       </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class TaskSerializer(serializers.ModelSerializer):</span><br><span class="line">    assigned &#x3D; serializers.SlugRelatedField(</span><br><span class="line">        slug_field&#x3D;User.USERNAME_FIELD, required&#x3D;False, allow_null&#x3D;true,</span><br><span class="line">        queryset&#x3D;user.objects.all()</span><br><span class="line">    )</span><br><span class="line">    status_display &#x3D; serializers.SerializerMethodField()</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; Task</span><br><span class="line">        fields &#x3D; (</span><br><span class="line">            &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;sprint&quot;, &quot;status&quot;, &quot;status_display&quot;, &quot;order&quot;, &quot;assigned&quot;, &quot;started&quot;, &quot;due&quot;,</span><br><span class="line">            &quot;completed&quot;)</span><br><span class="line"></span><br><span class="line">    def get_status_display(self, obj):</span><br><span class="line">        return obj.get_status_display()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Djangoä¸­é—´ä»¶</title>
    <url>/2020/04/20/Django%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="Djangoä¸­é—´ä»¶"><a href="#Djangoä¸­é—´ä»¶" class="headerlink" title="Djangoä¸­é—´ä»¶"></a>Djangoä¸­é—´ä»¶</h2><p>Django1.9ç‰ˆæœ¬ä»¥åï¼Œæˆ‘ä»¬ä»æµè§ˆå™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚ Requestï¼Œå¾—åˆ°ä¸€ä¸ªå“åº”åçš„å†…å®¹ HttpResponse ï¼Œè¿™ä¸ªè¯·æ±‚ä¼ é€’åˆ° Djangoçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src="https://note.youdao.com/yws/api/personal/file/WEB04655a9c01957e832ef5e4d978b4e24c?method=download&shareKey=8d63de97ad045d5d59f417afb25f7f5a" alt="è¯·æ±‚åˆ°Djangoä¸­çš„å¤„ç†æµç¨‹å›¾">  </p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯å…ˆé€šè¿‡ä¸­é—´ä»¶ä¸­çš„ process_request å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å› None æˆ–è€… HttpResponse å¯¹è±¡ï¼Œå¦‚æœè¿”å›å‰è€…ï¼Œç»§ç»­å¤„ç†å…¶å®ƒä¸­é—´ä»¶ï¼Œå¦‚æœè¿”å›ä¸€ä¸ª HttpResponseï¼Œå°±å¤„ç†ä¸­æ­¢ï¼Œè¿”å›åˆ°ç½‘é¡µä¸Šã€‚</p>
<p>ä¸­é—´ä»¶ï¼ˆç±»ï¼‰çš„å‡ ç§æ–¹æ³•<br>ä¸­é—´ä»¶å¯ä»¥å®šä¹‰çš„å‡ ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<p>process_request(self,request) ï¼š åœ¨å¤„ç†urlè¯·æ±‚ä¹‹å‰æ‰§è¡Œ</p>
<p>process_view(self, request, callback, callback_args,<br>callback_kwargs) ï¼š è°ƒç”¨è§†å›¾ä¹‹å‰æ‰§è¡Œ</p>
<p>process_template_response(self,request,response) ï¼š åªæœ‰å½“viewså‡½æ•°ä¸­è¿”å›çš„å¯¹è±¡ä¸­å…·æœ‰renderæ–¹æ³•ï¼Œæ‰ä¼šç›´æ¥è°ƒç”¨</p>
<p>process_response(self, request, response) ï¼š åœ¨å“åº”è¿”å›æµè§ˆå™¨ä¹‹å‰è°ƒç”¨</p>
<p>è‡ªå®šä¹‰ä¸­é—´ä»¶<br>åœ¨Djangoä¸­æˆ‘ä»¬å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªç»§æ‰¿äº†MiddlewareMixinçš„ç±»ï¼Œæ¥å®ç°è‡ªå®šä¹‰ä¸­é—´ä»¶ã€‚é€šè¿‡from django.urls.deprecation import MiddlewareMixinå¯¼å…¥MiddlewareMixinã€‚</p>
<p>ä¸ºä¸­é—´ä»¶åˆ›å»ºä¸€ä¸ªç›®å½•Middleï¼Œå¹¶åœ¨Middleç›®å½•ä¸‹åˆ›å»ºmiddle1.py:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.utils.deprecation import MiddlewareMixin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class middle11(MiddlewareMixin):</span><br><span class="line">    def process_request(self, request):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶1è¯·æ±‚&quot;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶1è¿”å›&quot;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class middle2(MiddlewareMixin):</span><br><span class="line">    def process_request(self, request):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶2è¯·æ±‚&quot;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶2è¿”å›&quot;)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class middle3(MiddlewareMixin):</span><br><span class="line">    def process_request(self, request):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶3è¯·æ±‚&quot;)</span><br><span class="line"></span><br><span class="line">    def process_response(self, request, response):</span><br><span class="line">        print(&quot;ä¸­é—´ä»¶3è¿”å›&quot;)</span><br><span class="line">        return response</span><br></pre></td></tr></table></figure>
<p>åœ¨é¡¹ç›®ç›®å½•ä¸‹çš„settings.pyæ–‡ä»¶çš„MIDDLEWAREä¸­æ·»åŠ å¦‚ä¸‹ä¸‰è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;Middle.middle1.middle11&#39;,</span><br><span class="line">&#39;Middle.middle1.middle2&#39;,</span><br><span class="line">&#39;Middle.middle1.middle3&#39;,</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä¸€ä¸ªé¡µé¢çš„æ—¶å€™åœ¨æ§åˆ¶å°å°±ä¼šçœ‹åˆ°å¦‚ä¸‹çš„ç»“æœï¼š<br><img src="https://note.youdao.com/yws/api/personal/file/WEB7f08c20201bab55e63606763d5718b3f?method=download&shareKey=a861abec06c2fef7e33e026196e5f453" alt="middlewareè‡ªå®šä¹‰æ¼”ç¤ºç»“æœ">  </p>
<p>ä»è¿™é‡Œä¹Ÿå‘æˆ‘ä»¬è¯å®äº†å½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œä¼šé€šè¿‡æ‰€æœ‰çš„ä¸­é—´ä»¶å¤„ç†ï¼Œå¹¶ä¸”å½“è¯·æ±‚è·å¾—ç›¸åº”æ—¶ä¹Ÿä¼šé€šè¿‡ä¸­é—´ä»¶å»å¤„ç†ã€‚</p>
<h3 id="ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"><a href="#ä¸­é—´ä»¶åº”ç”¨åœºæ™¯" class="headerlink" title="ä¸­é—´ä»¶åº”ç”¨åœºæ™¯"></a>ä¸­é—´ä»¶åº”ç”¨åœºæ™¯</h3><p>ç”±äºä¸­é—´ä»¶å·¥ä½œåœ¨ è§†å›¾å‡½æ•°æ‰§è¡Œå‰ã€æ‰§è¡Œåé€‚åˆæ‰€æœ‰çš„è¯·æ±‚/ä¸€éƒ¨åˆ†è¯·æ±‚åšæ‰¹é‡å¤„ç†ã€‚</p>
<p>1ã€åšIPé™åˆ¶<br>æ”¾åœ¨ ä¸­é—´ä»¶ç±»çš„åˆ—è¡¨ä¸­ï¼Œé˜»æ­¢æŸäº›IPè®¿é—®äº†ï¼›</p>
<p>2.URLè®¿é—®è¿‡æ»¤<br>å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯loginè§†å›¾ï¼ˆæ”¾è¿‡ï¼‰</p>
<p>å¦‚æœè®¿é—®å…¶ä»–è§†å›¾ï¼ˆéœ€è¦æ£€æµ‹æ˜¯ä¸æ˜¯æœ‰sessionå·²ç»æœ‰äº†æ”¾è¡Œï¼Œæ²¡æœ‰è¿”å›loginï¼‰ï¼Œè¿™æ ·å°±çœå¾—åœ¨ å¤šä¸ªè§†å›¾å‡½æ•°ä¸Šå†™è£…é¥°å™¨äº†ï¼</p>
<p>3ã€ç¼“å­˜(CDN)<br>å®¢æˆ·ç«¯è¯·æ±‚æ¥äº†ï¼Œä¸­é—´ä»¶å»ç¼“å­˜çœ‹çœ‹æœ‰æ²¡æœ‰æ•°æ®ï¼Œæœ‰ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œæ²¡æœ‰å†å»é€»è¾‘å±‚ æ‰§è¡Œè§†å›¾å‡½æ•°</p>
<blockquote>
<p>æ³¨æ„ï¼šé¡¹ç›®ç›®å½•ä¸‹MIDDLEWAREä¸­â€™django.middleware.csrf.CsrfViewMiddlewareâ€™,ä¸ºç”¨æˆ·å®ç°é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ çš„åŠŸèƒ½ï¼Œåœ¨ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯å°†å®ƒæ³¨é‡Šæ‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¦‚æœä¸æ³¨é‡Šæ‰åœ¨è¡¨å•æäº¤çš„æ—¶å€™å°±ä¼šæŠ¥forbiddençš„é”™è¯¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆè¦ç”¨åˆ°é˜²æ­¢è·¨åŸŸè¯·æ±‚ï¼Œåˆä¸è¦æŠ¥é”™æˆ‘ä»¬åªéœ€è¦åœ¨è¡¨å•<from>æ ‡ç­¾ä¸­åŠ å…¥<code>{ csrf_token }</code>å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</from></p>
</blockquote>
<h3 id="ç»ƒä¹ ï¼š"><a href="#ç»ƒä¹ ï¼š" class="headerlink" title="ç»ƒä¹ ï¼š"></a>ç»ƒä¹ ï¼š</h3><p>1.åˆ©ç”¨ç”¨ä¸­é—´ä»¶ï¼Œå®ç°è®©æ‰€æœ‰é¡µé¢éƒ½å¿…é¡»åœ¨è¿›è¡Œç”¨æˆ·ç™»å½•åæ‰èƒ½è®¿é—®qin<br>2.ä¸­é—´ä»¶ç»Ÿè®¡ï¼ŒæŸä¸ªç½‘é¡µçš„è®¿é—®æ¬¡æ•°ã€‚</p>
<p><a href="https://www.jianshu.com/p/2889eaff70fa" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>  </p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>DjangoåŸºäºRBACçš„æƒé™ç»„ä»¶</title>
    <url>/2020/04/20/Django%E5%9F%BA%E4%BA%8ERBAC%E7%9A%84%E6%9D%83%E9%99%90%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="DjangoåŸºäºRBACçš„æƒé™ç»„ä»¶"><a href="#DjangoåŸºäºRBACçš„æƒé™ç»„ä»¶" class="headerlink" title="DjangoåŸºäºRBACçš„æƒé™ç»„ä»¶"></a>DjangoåŸºäºRBACçš„æƒé™ç»„ä»¶</h1><hr>

<h3 id="RBACå‰å¥"><a href="#RBACå‰å¥" class="headerlink" title="RBACå‰å¥"></a>RBACå‰å¥</h3><ol>
<li><p>RBACæ¦‚å¿µ<br>RBACï¼ˆRole-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ï¼Œå°±æ˜¯ç”¨æˆ·é€šè¿‡è§’è‰²ä¸æƒé™è¿›è¡Œå…³è”ã€‚ç®€å•åœ°è¯´ï¼Œä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰è‹¥å¹²è§’è‰²ï¼Œæ¯ä¸€ä¸ªè§’è‰²æ‹¥æœ‰è‹¥å¹²æƒé™ã€‚è¿™æ ·ï¼Œå°±æ„é€ æˆâ€œç”¨æˆ·-è§’è‰²-æƒé™â€çš„æˆæƒæ¨¡å‹ã€‚åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œç”¨æˆ·ä¸è§’è‰²ä¹‹é—´ï¼Œè§’è‰²ä¸æƒé™ä¹‹é—´ï¼Œä¸€èˆ¬è€…æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p>
</li>
<li><p>æ‰©å±•</p>
<ul>
<li>è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç†è§£ä¸ºä¸€å®šæ•°é‡çš„æƒé™çš„é›†åˆï¼Œæƒé™çš„è½½ä½“ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªè®ºå›ç³»ç»Ÿï¼Œâ€œè¶…çº§ç®¡ç†å‘˜â€ã€â€œç‰ˆä¸»â€éƒ½æ˜¯è§’è‰²ã€‚ç‰ˆä¸»å¯ç®¡ç†ç‰ˆå†…çš„å¸–å­ã€å¯ç®¡ç†ç‰ˆå†…çš„ç”¨æˆ·ç­‰ï¼Œè¿™äº›æ˜¯æƒé™ã€‚è¦ç»™æŸä¸ªç”¨æˆ·æˆäºˆè¿™äº›æƒé™ï¼Œä¸éœ€è¦ç›´æ¥å°†æƒé™æˆäºˆç”¨æˆ·ï¼Œå¯å°†â€œç‰ˆä¸»â€è¿™ä¸ªè§’è‰²èµ‹äºˆè¯¥ç”¨æˆ·ã€‚ </li>
<li>å½“ç”¨æˆ·çš„æ•°é‡éå¸¸å¤§æ—¶ï¼Œè¦ç»™ç³»ç»Ÿæ¯ä¸ªç”¨æˆ·é€ä¸€æˆæƒï¼ˆæˆè§’è‰²ï¼‰ï¼Œæ˜¯ä»¶éå¸¸çƒ¦ççš„äº‹æƒ…ã€‚è¿™æ—¶ï¼Œå°±éœ€è¦ç»™ç”¨æˆ·åˆ†ç»„ï¼Œæ¯ä¸ªç”¨æˆ·ç»„å†…æœ‰å¤šä¸ªç”¨æˆ·ã€‚é™¤äº†å¯ç»™ç”¨æˆ·æˆæƒå¤–ï¼Œè¿˜å¯ä»¥ç»™ç”¨æˆ·ç»„æˆæƒã€‚è¿™æ ·ä¸€æ¥ï¼Œç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰æƒé™ï¼Œå°±æ˜¯ç”¨æˆ·ä¸ªäººæ‹¥æœ‰çš„æƒé™ä¸è¯¥ç”¨æˆ·æ‰€åœ¨ç”¨æˆ·ç»„æ‹¥æœ‰çš„æƒé™ä¹‹å’Œã€‚</li>
<li>åœ¨åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæƒé™è¡¨ç°æˆä»€ä¹ˆï¼Ÿå¯¹åŠŸèƒ½æ¨¡å—çš„æ“ä½œï¼Œå¯¹ä¸Šä¼ æ–‡ä»¶çš„åˆ æ”¹ï¼Œèœå•çš„è®¿é—®ï¼Œç”šè‡³é¡µé¢ä¸ŠæŸä¸ªæŒ‰é’®ã€æŸä¸ªå›¾ç‰‡çš„å¯è§æ€§æ§åˆ¶ï¼Œéƒ½å¯å±äºæƒé™çš„èŒƒç•´ã€‚æœ‰äº›æƒé™è®¾è®¡ï¼Œä¼šæŠŠåŠŸèƒ½æ“ä½œä½œä¸ºä¸€ç±»ï¼Œè€ŒæŠŠæ–‡ä»¶ã€èœå•ã€é¡µé¢å…ƒç´ ç­‰ä½œä¸ºå¦ä¸€ç±»ï¼Œè¿™æ ·æ„æˆâ€œç”¨æˆ·-è§’è‰²-æƒé™-èµ„æºâ€çš„æˆæƒæ¨¡å‹ã€‚è€Œåœ¨åšæ•°æ®è¡¨å»ºæ¨¡æ—¶ï¼Œå¯æŠŠåŠŸèƒ½æ“ä½œå’Œèµ„æºç»Ÿä¸€ç®¡ç†ï¼Œä¹Ÿå°±æ˜¯éƒ½ç›´æ¥ä¸æƒé™è¡¨è¿›è¡Œå…³è”ï¼Œè¿™æ ·å¯èƒ½æ›´å…·ä¾¿æ·æ€§å’Œæ˜“æ‰©å±•æ€§ã€‚</li>
<li>è¯·ç•™æ„æƒé™è¡¨ä¸­æœ‰ä¸€åˆ—â€œæƒé™ç±»å‹â€ï¼Œæˆ‘ä»¬æ ¹æ®å®ƒçš„å–å€¼æ¥åŒºåˆ†æ˜¯å“ªä¸€ç±»æƒé™ï¼Œå¦‚â€œMENUâ€è¡¨ç¤ºèœå•çš„è®¿é—®æƒé™ã€â€œOPERATIONâ€è¡¨ç¤ºåŠŸèƒ½æ¨¡å—çš„æ“ä½œæƒé™ã€â€œFILEâ€è¡¨ç¤ºæ–‡ä»¶çš„ä¿®æ”¹æƒé™ã€â€œELEMENTâ€è¡¨ç¤ºé¡µé¢å…ƒç´ çš„å¯è§æ€§æ§åˆ¶ç­‰ã€‚</li>
<li>è¿™æ ·è®¾è®¡çš„å¥½å¤„æœ‰äºŒã€‚å…¶ä¸€ï¼Œä¸éœ€è¦åŒºåˆ†å“ªäº›æ˜¯æƒé™æ“ä½œï¼Œå“ªäº›æ˜¯èµ„æºï¼Œï¼ˆå®é™…ä¸Šï¼Œæœ‰æ—¶å€™ä¹Ÿä¸å¥½åŒºåˆ†ï¼Œå¦‚èœå•ï¼ŒæŠŠå®ƒç†è§£ä¸ºèµ„æºå‘¢è¿˜æ˜¯åŠŸèƒ½æ¨¡å—æƒé™å‘¢ï¼Ÿï¼‰ã€‚å…¶äºŒï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œå½“ç³»ç»Ÿè¦å¯¹æ–°çš„ä¸œè¥¿è¿›è¡Œæƒé™æ§åˆ¶æ—¶ï¼Œæˆ‘åªéœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„å…³è”è¡¨â€œæƒé™XXå…³è”è¡¨â€ï¼Œå¹¶ç¡®å®šè¿™ç±»æƒé™çš„æƒé™ç±»å‹å­—ç¬¦ä¸²ã€‚</li>
<li>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œæƒé™è¡¨ä¸æƒé™èœå•å…³è”è¡¨ã€æƒé™èœå•å…³è”è¡¨ä¸èœå•è¡¨éƒ½æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ï¼ˆæ–‡ä»¶ã€é¡µé¢æƒé™ç‚¹ã€åŠŸèƒ½æ“ä½œç­‰åŒç†ï¼‰ã€‚ä¹Ÿå°±æ˜¯æ¯æ·»åŠ ä¸€ä¸ªèœå•ï¼Œå°±å¾—åŒæ—¶å¾€è¿™ä¸‰ä¸ªè¡¨ä¸­å„æ’å…¥ä¸€æ¡è®°å½•ã€‚è¿™æ ·ï¼Œå¯ä»¥ä¸éœ€è¦æƒé™èœå•å…³è”è¡¨ï¼Œè®©æƒé™è¡¨ä¸èœå•è¡¨ç›´æ¥å…³è”ï¼Œæ­¤æ—¶ï¼Œé¡»åœ¨æƒé™è¡¨ä¸­æ–°å¢ä¸€åˆ—ç”¨æ¥ä¿å­˜èœå•çš„IDï¼Œæƒé™è¡¨é€šè¿‡â€œæƒé™ç±»å‹â€å’Œè¿™ä¸ªIDæ¥åŒºåˆ†æ˜¯ç§ç±»å‹ä¸‹çš„å“ªæ¡è®°å½•ã€‚</li>
<li>éšç€ç³»ç»Ÿçš„æ—¥ç›Šåºå¤§ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œå¯å¼•å…¥è§’è‰²ç»„å¯¹è§’è‰²è¿›è¡Œåˆ†ç±»ç®¡ç†ï¼Œè·Ÿç”¨æˆ·ç»„ä¸åŒï¼Œè§’è‰²ç»„ä¸å‚ä¸æˆæƒã€‚ä¾‹å¦‚ï¼šæŸç”µç½‘ç³»ç»Ÿçš„æƒé™ç®¡ç†æ¨¡å—ä¸­ï¼Œè§’è‰²å°±æ˜¯æŒ‚åœ¨åŒºå±€ä¸‹ï¼Œè€ŒåŒºå±€åœ¨è¿™é‡Œå¯å½“ä½œè§’è‰²ç»„ï¼Œå®ƒä¸å‚äºæƒé™åˆ†é…ã€‚å¦å¤–ï¼Œä¸ºæ–¹ä¾¿ä¸Šé¢å„ä¸»è¡¨è‡ªèº«çš„ç®¡ç†ä¸æŸ¥æ‰¾ï¼Œå¯é‡‡ç”¨æ ‘å‹ç»“æ„ï¼Œå¦‚èœå•æ ‘ã€åŠŸèƒ½æ ‘ç­‰ï¼Œå½“ç„¶è¿™äº›å¯ä¸éœ€è¦å‚äºæƒé™åˆ†é…ã€‚</li>
</ul>
</li>
<li><p>åŸºäºrbacçš„å®ç°<br><a href="https://github.com/shonenada/flask-rbac" target="_blank" rel="noopener">flask-rbac</a><br><a href="https://pypi.python.org/pypi/simple-rbac/0.1.1" target="_blank" rel="noopener">simple-rbac</a></p>
<br>

</li>
</ol>
<h3 id="çŸ¥è¯†ç‚¹å‚¨å¤‡"><a href="#çŸ¥è¯†ç‚¹å‚¨å¤‡" class="headerlink" title="çŸ¥è¯†ç‚¹å‚¨å¤‡"></a>çŸ¥è¯†ç‚¹å‚¨å¤‡</h3><ol>
<li>Django ORM<br>å¸¸ç”¨çš„ormæ–¹æ³•ï¼Œall,values,values_listç­‰<br>from models import User</li>
</ol>
<ul>
<li>all<br>models.User.objects.all(),è¿”å›å€¼ä¸ºquerysetç±»å‹ï¼Œå½¢å¦‚ï¼š[obj,obj,obj]</li>
<li>values<br>models.User.objects.values(â€˜idâ€™,â€™usernameâ€™,â€™passwordâ€™),è¿”å›å€¼ä¸ºquerysetç±»å‹ï¼Œå½¢å¦‚ï¼š[{â€˜idâ€™:1,â€™usernameâ€™:â€™shukeâ€™,â€™passwordâ€™:â€™123456â€™}]</li>
<li>values_list<br>models.User.objects.values_list(â€˜idâ€™,â€™usernameâ€™,â€™passwordâ€™),è¿”å›å€¼ä¸ºquerysetç±»å‹ï¼Œå½¢å¦‚: [(1,â€™shukeâ€™,â€™123456â€™),(2,â€™maryâ€™,â€™123456â€™)]</li>
</ul>
<ol start="2">
<li>ä¸€å¯¹å¤šåŠå¤šå¯¹å¤š</li>
</ol>
<ul>
<li>ä¸€å¯¹å¤šï¼ˆFKå¸¸ç”¨æ“ä½œï¼‰<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class A(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"></span><br><span class="line">class B(models.Model):</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    fk &#x3D; models.ForeignKey(to&#x3D;&quot;A&quot;)</span><br><span class="line"># è·¨è¡¨æ“ä½œ</span><br><span class="line">a. all()</span><br><span class="line">b_list &#x3D; models.B.objects.all()</span><br><span class="line">for item in b_list:</span><br><span class="line">    item.id</span><br><span class="line">    item.name</span><br><span class="line">    item.fk_id</span><br><span class="line">    item.fk</span><br><span class="line">    item.fk.name</span><br><span class="line">    item.fk.id</span><br><span class="line">b. values()</span><br><span class="line">b_list &#x3D; models.B.objects.values(&#39;id&#39;,&#39;name&#39;,&#39;fk_id&#39;,&#39;fk__name&#39;)</span><br><span class="line">for item in b_list:</span><br><span class="line">    item[&#39;id&#39;]</span><br><span class="line">    item[&#39;name&#39;]</span><br><span class="line">    item[&#39;fk_id&#39;]</span><br><span class="line">    item[&#39;fk__name&#39;]</span><br><span class="line">c. values_list()</span><br><span class="line">b_list &#x3D; models.B.objects.values_list(&#39;id&#39;,&#39;name&#39;,&#39;fk_id&#39;,&#39;fk__name&#39;)</span><br><span class="line">for item in b_list:</span><br><span class="line">    item[0]  # id</span><br><span class="line">    item[1]  # name</span><br><span class="line">    item[2]  # fk_id</span><br><span class="line">    item[3]  # fk__name</span><br><span class="line">d. æŸ¥æ‰¾åç§°æ˜¯&quot;Jack&quot;çš„ç”¨æˆ·æ‰€æœ‰Bè¡¨ä¸­çš„æ•°æ®</span><br><span class="line">models.B.objects.filter(fk__name&#x3D;&quot;Jack&quot;).all()</span><br></pre></td></tr></table></figure></li>
<li>å¤šå¯¹å¤š(ManyToMany)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class A(models.Model):</span><br><span class="line">    name &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line"></span><br><span class="line">class B(models.Model):</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    m2m &#x3D; models.ManyToMany(to&#x3D;&quot;A&quot;)</span><br><span class="line">PS: è‡ªåŠ¨ä¼šç”Ÿæˆç¬¬3å¼ è¡¨</span><br><span class="line">a. åœ¨Aå’ŒBè¡¨ä¸­å„æ’å…¥2æ¡æ•°æ®</span><br><span class="line">models.A.objects.create(name&#x3D;&quot;Jack&quot;)</span><br><span class="line">models.A.objects.create(name&#x3D;&quot;Mary&quot;)</span><br><span class="line"></span><br><span class="line">models.A.objects.create(title&#x3D;&quot;IT&quot;)</span><br><span class="line">models.A.objects.create(title&#x3D;&quot;CTO&quot;)</span><br><span class="line"></span><br><span class="line">b. CTOå’Œ[&#39;Jack&#39;,&#39;Mary&#39;]åˆ›å»ºå…³ç³»</span><br><span class="line">obj &#x3D; models.B.objects.get(title&#x3D;&quot;CTO&quot;)</span><br><span class="line">obj.m2m.add(1)   # æ­¤å¤„å¯ä»¥å†™idä¹Ÿå¯ä»¥å†™å…³è”çš„Aè¡¨ä¸­çš„obj</span><br><span class="line">obj.m2m.add(2)</span><br><span class="line"></span><br><span class="line">c. æŸ¥æ‰¾CTOçš„å…³è”çš„äºº</span><br><span class="line">obj &#x3D; models.B.objects.get(title&#x3D;&quot;CTO&quot;)</span><br><span class="line">obj.m2m.all()    # å¾—åˆ°ä¸€ä¸ªQuerySetåˆ—è¡¨ï¼Œå†…å®¹ä¸ºAè¡¨ä¸­çš„å¯¹è±¡</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="3">
<li>ä¸­é—´ä»¶<br>ä¸­é—´ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ªç±»ï¼ŒåŒ…å«2ä¸ªæ–¹æ³•,å½¢å¦‚:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class MiddleWare:</span><br><span class="line">    # æ‰€æœ‰çš„resquestè¯·æ±‚éƒ½éœ€è¦ç»è¿‡è¯¥æ–¹æ³•,ä¸”è¯¥æ–¹æ³•è¿”å›å€¼ä¸ºNoneæ—¶ï¼Œç»§ç»­è¯·æ±‚ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        pass</span><br><span class="line">    def process_response(self,request,response):</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure></li>
</ol>
<p><em>æ³¨: ä¸­é—´ä»¶ç¼–å†™å®Œæˆåéœ€è¦åœ¨settingsæ–‡ä»¶ä¸­è¿›è¡Œæ³¨å†Œä½¿ç”¨ï¼Œæ³¨å†Œæ—¶æ³¨æ„ä¸­é—´ä»¶é¡ºåº</em></p>
<ol start="4">
<li>Sessionä¸Cookieçš„åŒºåˆ«</li>
</ol>
<ul>
<li>ç”±äºHTTPåè®®æ˜¯æ— çŠ¶æ€çš„åè®®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯éœ€è¦è®°å½•ç”¨æˆ·çš„çŠ¶æ€æ—¶ï¼Œå°±éœ€è¦ç”¨æŸç§æœºåˆ¶æ¥è¯†å…·ä½“çš„ç”¨æˆ·ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯Session.å…¸å‹çš„åœºæ™¯æ¯”å¦‚è´­ç‰©è½¦ï¼Œå½“ä½ ç‚¹å‡»ä¸‹å•æŒ‰é’®æ—¶ï¼Œç”±äºHTTPåè®®æ— çŠ¶æ€ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ˜¯å“ªä¸ªç”¨æˆ·æ“ä½œçš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯è¦ä¸ºç‰¹å®šçš„ç”¨æˆ·åˆ›å»ºäº†ç‰¹å®šçš„Sessionï¼Œç”¨ç”¨äºæ ‡è¯†è¿™ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”è·Ÿè¸ªç”¨æˆ·ï¼Œè¿™æ ·æ‰çŸ¥é“è´­ç‰©è½¦é‡Œé¢æœ‰å‡ æœ¬ä¹¦ã€‚è¿™ä¸ªSessionæ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼Œæœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ã€‚åœ¨æœåŠ¡ç«¯ä¿å­˜Sessionçš„æ–¹æ³•å¾ˆå¤šï¼Œå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶éƒ½æœ‰ã€‚é›†ç¾¤çš„æ—¶å€™ä¹Ÿè¦è€ƒè™‘Sessionçš„è½¬ç§»ï¼Œåœ¨å¤§å‹çš„ç½‘ç«™ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸“é—¨çš„SessionæœåŠ¡å™¨é›†ç¾¤ï¼Œç”¨æ¥ä¿å­˜ç”¨æˆ·ä¼šè¯ï¼Œè¿™ä¸ªæ—¶å€™ Session ä¿¡æ¯éƒ½æ˜¯æ”¾åœ¨å†…å­˜çš„ï¼Œä½¿ç”¨ä¸€äº›ç¼“å­˜æœåŠ¡æ¯”å¦‚Memcachedä¹‹ç±»çš„æ¥æ”¾ Sessionã€‚</li>
<li>æ€è€ƒä¸€ä¸‹æœåŠ¡ç«¯å¦‚ä½•è¯†åˆ«ç‰¹å®šçš„å®¢æˆ·ï¼Ÿè¿™ä¸ªæ—¶å€™Cookieå°±ç™»åœºäº†ã€‚æ¯æ¬¡HTTPè¯·æ±‚çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯éƒ½ä¼šå‘é€ç›¸åº”çš„Cookieä¿¡æ¯åˆ°æœåŠ¡ç«¯ã€‚å®é™…ä¸Šå¤§å¤šæ•°çš„åº”ç”¨éƒ½æ˜¯ç”¨ Cookie æ¥å®ç°Sessionè·Ÿè¸ªçš„ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºSessionçš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨HTTPåè®®ä¸­å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œéœ€è¦åœ¨ Cookie é‡Œé¢è®°å½•ä¸€ä¸ªSession IDï¼Œä»¥åæ¯æ¬¡è¯·æ±‚æŠŠè¿™ä¸ªä¼šè¯IDå‘é€åˆ°æœåŠ¡å™¨ï¼Œæˆ‘å°±çŸ¥é“ä½ æ˜¯è°äº†ã€‚æœ‰äººé—®ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„æµè§ˆå™¨ç¦ç”¨äº† Cookie æ€ä¹ˆåŠï¼Ÿä¸€èˆ¬è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šä½¿ç”¨ä¸€ç§å«åšURLé‡å†™çš„æŠ€æœ¯æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªï¼Œå³æ¯æ¬¡HTTPäº¤äº’ï¼ŒURLåé¢éƒ½ä¼šè¢«é™„åŠ ä¸Šä¸€ä¸ªè¯¸å¦‚ sid=xxxxx è¿™æ ·çš„å‚æ•°ï¼ŒæœåŠ¡ç«¯æ®æ­¤æ¥è¯†åˆ«ç”¨æˆ·ã€‚</li>
<li>Cookieå…¶å®è¿˜å¯ä»¥ç”¨åœ¨ä¸€äº›æ–¹ä¾¿ç”¨æˆ·çš„åœºæ™¯ä¸‹ï¼Œè®¾æƒ³ä½ æŸæ¬¡ç™»é™†è¿‡ä¸€ä¸ªç½‘ç«™ï¼Œä¸‹æ¬¡ç™»å½•çš„æ—¶å€™ä¸æƒ³å†æ¬¡è¾“å…¥è´¦å·äº†ï¼Œæ€ä¹ˆåŠï¼Ÿè¿™ä¸ªä¿¡æ¯å¯ä»¥å†™åˆ°Cookieé‡Œé¢ï¼Œè®¿é—®ç½‘ç«™çš„æ—¶å€™ï¼Œç½‘ç«™é¡µé¢çš„è„šæœ¬å¯ä»¥è¯»å–è¿™ä¸ªä¿¡æ¯ï¼Œå°±è‡ªåŠ¨å¸®ä½ æŠŠç”¨æˆ·åç»™å¡«äº†ï¼Œèƒ½å¤Ÿæ–¹ä¾¿ä¸€ä¸‹ç”¨æˆ·ã€‚è¿™ä¹Ÿæ˜¯Cookieåç§°çš„ç”±æ¥ï¼Œç»™ç”¨æˆ·çš„ä¸€ç‚¹ç”œå¤´ã€‚</li>
<li>æ€»ç»“ï¼šSessionæ˜¯åœ¨æœåŠ¡ç«¯ä¿å­˜çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œç”¨æ¥è·Ÿè¸ªç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥ä¿å­˜åœ¨é›†ç¾¤ã€æ•°æ®åº“ã€æ–‡ä»¶ä¸­ï¼›Cookieæ˜¯å®¢æˆ·ç«¯ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥è®°å½•ç”¨æˆ·çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿæ˜¯å®ç°Sessionçš„ä¸€ç§æ–¹å¼ã€‚</li>
</ul>
<ol start="5">
<li>æ­£åˆ™æ¨¡å—re<br>re.match()æ–¹æ³•<br>å†³å®šREæ˜¯å¦åœ¨å­—ç¬¦ä¸²åˆšå¼€å§‹çš„ä½ç½®åŒ¹é…,è¿”å›_sre.SRE_Matchå¯¹è±¡ï¼Œå¦‚æœä¸èƒ½åŒ¹é…è¿”å›Noneã€‚<br>æ³¨ï¼šè¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯å®Œå…¨åŒ¹é…ã€‚å½“patternç»“æŸæ—¶è‹¥stringè¿˜æœ‰å‰©ä½™å­—ç¬¦ï¼Œä»ç„¶è§†ä¸ºæˆåŠŸã€‚æƒ³è¦å®Œå…¨åŒ¹é…ï¼Œå¯ä»¥åœ¨è¡¨è¾¾å¼æœ«å°¾åŠ ä¸Šè¾¹ç•ŒåŒ¹é…ç¬¦â€™$â€™<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ ¼å¼ï¼š</span><br><span class="line">re.match(pattern, string, flags&#x3D;0)</span><br><span class="line"></span><br><span class="line">print(re.match(&#39;com&#39;,&#39;comwww.runcomoob&#39;).group())</span><br><span class="line">print(re.match(&#39;com&#39;,&#39;Comwww.runcomoob&#39;,re.I).group())</span><br><span class="line">æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</span><br><span class="line">com</span><br><span class="line">com</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<br>

<h3 id="RBACå®ç°"><a href="#RBACå®ç°" class="headerlink" title="RBACå®ç°"></a>RBACå®ç°</h3><h4 id="å¼€å‘RBACæµç¨‹"><a href="#å¼€å‘RBACæµç¨‹" class="headerlink" title="å¼€å‘RBACæµç¨‹"></a>å¼€å‘RBACæµç¨‹</h4><ol>
<li>è¡¨ç»“æ„è®¾è®¡</li>
<li>Django Adminå½•å…¥æ•°æ®</li>
<li>ç”¨æˆ·ç™»é™†<ul>
<li>è·å–è§’è‰²</li>
<li>è·å–æƒé™</li>
<li>å¯¹æƒé™URLè¿›è¡Œå»é‡</li>
</ul>
</li>
<li>ç”Ÿæˆæƒé™ç»“æ„ä¿¡æ¯ï¼Œå†™å…¥sessionä¸­<br>{<br> 1: {<pre><code>&apos;urls&apos;: [&apos;/userinfo/&apos;, &apos;/userinfo/add/&apos;, &apos;/userinfo/(\\d+)/delete/&apos;, &apos;/userinfo/(\\d+)/change/&apos;],
&apos;codes&apos;: [&apos;list&apos;, &apos;add&apos;, &apos;del&apos;, &apos;edit&apos;]</code></pre> },<br> 2: {<pre><code>&apos;urls&apos;: [&apos;/order/&apos;, &apos;/order/add/&apos;, &apos;/order/(\\d+)/delete/&apos;, &apos;/order/(\\d+)/change/&apos;],
&apos;codes&apos;: [&apos;list&apos;, &apos;add&apos;, &apos;del&apos;, &apos;edit&apos;]</code></pre> }<br>}</li>
<li>æ³¨å†Œä¸­é—´ä»¶<ul>
<li>ç™½åå•</li>
<li>è·å–å½“å‰è®¿é—®url: request.path_info</li>
<li>sessionä¸­è·å–æƒé™ï¼Œè¿›è¡Œæƒé™è®¿é—®éªŒè¯</li>
</ul>
</li>
<li>è‡ªåŠ¨ç”Ÿæˆèœå•åŠŸèƒ½<ul>
<li>é‡‡ç”¨è‡ªå®šä¹‰tagæ–¹å¼å®ç°(inclusion_tag)</li>
<li>ä½œä¸ºæ¨¡æ¿ä½¿ç”¨{ menu_html request }æ–¹å¼å¯¼å…¥htmlæ–‡ä»¶ä¸­ä½¿ç”¨</li>
</ul>
</li>
<li>é€šè¿‡Django Adminåå°è¿›è¡Œç®¡ç†åŠç»´æŠ¤å·¥ä½œ <br>

</li>
</ol>
<h4 id="Django-ORMè¡¨ç»“æ„è®¾è®¡"><a href="#Django-ORMè¡¨ç»“æ„è®¾è®¡" class="headerlink" title="Django ORMè¡¨ç»“æ„è®¾è®¡"></a>Django ORMè¡¨ç»“æ„è®¾è®¡</h4><p><strong>5ä¸ªç±»6å¼ è¡¨</strong></p>
<ol>
<li>èœå•è¡¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Menu(models.Models):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    èœå•è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32,verbose_name&#x3D;&#39;èœå•æ ‡é¢˜&#39;)</span><br><span class="line">    </span><br><span class="line">     # django adminåå°æ˜¾ç¤ºç”¨</span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;èœå•è¡¨&quot;</span><br><span class="line">    # é‡å†™__str__æ–¹æ³•ï¼Œå®ä¾‹åŒ–åçš„å¯¹è±¡å°†ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å±•ç¤ºï¼Œä½†å®é™…æ˜¯ä¸€ä¸ªobj,æ‰€ä»¥ï¼Œè¯·ä¸è¦ç›¸ä¿¡ä½ çš„çœ¼ç›ï¼Œå¿…è¦æ—¶ä½¿ç”¨type(arg)è¿›è¡ŒéªŒè¯</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.title</span><br></pre></td></tr></table></figure></li>
<li>æƒé™ç»„è¡¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Group(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æƒé™ç»„</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    caption &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;ç»„åç§°&quot;)</span><br><span class="line">    menu &#x3D; models.ForeignKey(to&#x3D;&quot;Menu&quot;, default&#x3D;1, blank&#x3D;True, verbose_name&#x3D;&quot;å…³è”çš„èœå•&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;æƒé™ç»„&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.caption</span><br></pre></td></tr></table></figure></li>
<li>æƒé™è¡¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Permission(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æƒé™è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;æ ‡é¢˜&quot;)</span><br><span class="line">    url &#x3D; models.CharField(max_length&#x3D;128, verbose_name&#x3D;&quot;å«æ­£åˆ™çš„URL&quot;)</span><br><span class="line">    # menu_gpä¸ºnullè¯´æ˜æ˜¯titleä¸ºèœå•é¡¹</span><br><span class="line">    menu_gp &#x3D; models.ForeignKey(to&#x3D;&quot;Permission&quot;, null&#x3D;True, blank&#x3D;True, verbose_name&#x3D;&quot;é»˜è®¤é€‰ä¸­çš„ç»„å†…æƒé™ID&quot;, related_name&#x3D;&quot;pm&quot;)</span><br><span class="line">    code &#x3D; models.CharField(max_length&#x3D;16, verbose_name&#x3D;&quot;æƒé™ç &quot;)</span><br><span class="line">    group &#x3D; models.ForeignKey(to&#x3D;&quot;Group&quot;, blank&#x3D;True, verbose_name&#x3D;&quot;æ‰€å±ç»„&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;æƒé™è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.title</span><br></pre></td></tr></table></figure></li>
<li>ç”¨æˆ·è¡¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class User(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨æˆ·è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    username &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;ç”¨æˆ·å&quot;)</span><br><span class="line">    password &#x3D; models.CharField(max_length&#x3D;64, verbose_name&#x3D;&quot;å¯†ç &quot;)</span><br><span class="line">    email &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;é‚®ç®±&quot;)</span><br><span class="line">    roles &#x3D; models.ManyToManyField(to&#x3D;&quot;Role&quot;, blank&#x3D;True, verbose_name&#x3D;&quot;ç”¨æˆ·å…³è”çš„è§’è‰²&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;ç”¨æˆ·è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.username</span><br></pre></td></tr></table></figure></li>
<li>è§’è‰²è¡¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Role(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è§’è‰²è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;è§’è‰²åç§°&quot;)</span><br><span class="line">    permissions &#x3D; models.ManyToManyField(to&#x3D;&quot;Permission&quot;, blank&#x3D;True, verbose_name&#x3D;&quot;è§’è‰²å…³è”çš„æƒé™&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;è§’è‰²è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.title</span><br></pre></td></tr></table></figure></li>
<li>é™„åŠ </li>
</ol>
<ul>
<li>åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„ä¿¡æ¯</li>
<li>åˆ›å»ºè¶…çº§ç”¨æˆ·</li>
<li>åœ¨admin.pyä¸­æ³¨å†Œmodelsç±»</li>
<li>ç™»é™†adminç®¡ç†åå°æ·»åŠ æ•°æ®ï¼Œè¿›è¡Œç®¡ç†</li>
</ul>
<br>

<h3 id="settingsä¸­æ·»åŠ é…ç½®é¡¹"><a href="#settingsä¸­æ·»åŠ é…ç½®é¡¹" class="headerlink" title="settingsä¸­æ·»åŠ é…ç½®é¡¹"></a>settingsä¸­æ·»åŠ é…ç½®é¡¹</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ é…ç½®ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">vim projectname&#x2F;settings.py</span><br><span class="line"># ########################### æƒé™ç®¡ç†ç›¸å…³ ###########################3</span><br><span class="line">PERMISSION_MENU_KEY &#x3D; &quot;asdkjalsdf9uajsdf&quot;</span><br><span class="line">PERMISSION_URL_DICT_KEY &#x3D; &quot;iujmsufnsdflsdkf&quot;</span><br><span class="line"></span><br><span class="line">VALID_URL&#x3D; [</span><br><span class="line">    &#39;^&#x2F;login&#x2F;&#39;,</span><br><span class="line">    &quot;^&#x2F;admin*&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>


<h4 id="åˆå§‹åŒ–æƒé™ä¿¡æ¯"><a href="#åˆå§‹åŒ–æƒé™ä¿¡æ¯" class="headerlink" title="åˆå§‹åŒ–æƒé™ä¿¡æ¯"></a>åˆå§‹åŒ–æƒé™ä¿¡æ¯</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#cat rbac&#x2F;service&#x2F;init_permission.py</span><br><span class="line"></span><br><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line">def init_permission(request,user):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨æˆ·æƒé™ä¿¡æ¯åˆå§‹åŒ–ï¼Œè·å–å½“å‰ç”¨æˆ·æ‰€æœ‰æƒé™ä¿¡æ¯ï¼Œå¹¶ä¿å­˜åˆ°Sessionä¸­</span><br><span class="line">    æ­¤å¤„çš„requestä»¥åŠuserå‚æ•°å‡ä¸ºå¯¹è±¡ï¼Œuserä¸ºç™»é™†æˆåŠŸæ—¶åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°çš„userå¯¹è±¡</span><br><span class="line">    :param request:</span><br><span class="line">    :param user:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    # å»ç©ºå»é‡</span><br><span class="line">    permission_list &#x3D; user.roles.filter(permissions__id__isnull&#x3D;False).values(</span><br><span class="line">        &#39;permissions__id&#39;,</span><br><span class="line">        &#39;permissions__title&#39;,                # ç”¨æˆ·åˆ—è¡¨</span><br><span class="line">        &#39;permissions__url&#39;,</span><br><span class="line">        &#39;permissions__code&#39;,</span><br><span class="line">        &#39;permissions__menu_gp_id&#39;,           # ç»„å†…èœå•IDï¼ŒNullè¡¨ç¤ºæ˜¯èœå•</span><br><span class="line">        &#39;permissions__group_id&#39;,             # æƒé™çš„ç»„ID</span><br><span class="line">        &#39;permissions__group__menu_id&#39;,       # å½“å‰æƒé™æ‰€åœ¨ç»„çš„èœå•ID</span><br><span class="line">        &#39;permissions__group__menu__title&#39;,   # å½“å‰æƒé™æ‰€åœ¨ç»„çš„èœå•åç§°</span><br><span class="line">    ).distinct()</span><br><span class="line">    </span><br><span class="line">    # èœå•ç›¸å…³é…ç½®ï¼Œåœ¨inclusion_tagä¸­ä½¿ç”¨</span><br><span class="line">    menu_permission_list&#x3D; []</span><br><span class="line">    for item in permission_list:</span><br><span class="line">        tpl &#x3D; &#123;</span><br><span class="line">            &#39;id&#39;: item[&#39;permissions__id&#39;],</span><br><span class="line">            &#39;title&#39;: item[&#39;permissions__title&#39;],</span><br><span class="line">            &#39;url&#39;: item[&#39;permissions__url&#39;],</span><br><span class="line">            &#39;menu_gp_id&#39;: item[&#39;permissions_menu_gp_id&#39;],</span><br><span class="line">            &#39;menu_id&#39;: item[&#39;permissions__group__menu_id&#39;],</span><br><span class="line">            &#39;menu_title&#39;: item[&#39;permissions__group__menu__title&#39;] </span><br><span class="line">        &#125;</span><br><span class="line">        menu_permission_list.append(tpl)</span><br><span class="line">        request.session[settings.PERMISSION_MENU_KEY] &#x3D; menu_permission_list</span><br><span class="line">        # å½¢å¦‚</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;host&#x2F;&quot;,&quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,&quot;title&quot;: &quot;ä¸»æœºåˆ—è¡¨&quot;,&quot;id&quot;: 1,&quot;menu_gp_id&quot;: null,&quot;menu_id&quot;: 1&#125;,</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;host&#x2F;add&#x2F;&quot;,&quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,&quot;title&quot;: &quot;æ·»åŠ ä¸»æœº&quot;,&quot;id&quot;: 2,&quot;menu_gp_id&quot;: 1,&quot;menu_id&quot;: 1&#125;,</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;host&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,&quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,&quot;title&quot;: &quot;åˆ é™¤ä¸»æœº&quot;,&quot;id&quot;: 3,&quot;menu_gp_id&quot;: 1,&quot;menu_id&quot;: 1&#125;,</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;host&#x2F;(\\d+)&#x2F;change&#x2F;&quot;,&quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,&quot;title&quot;: &quot;ä¿®æ”¹ä¸»æœº&quot;,&quot;id&quot;: 4,&quot;menu_gp_id&quot;: 1,&quot;menu_id&quot;: 1&#125;</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;userinfo&#x2F;&quot;,&quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,&quot;title&quot;: &quot;ç”¨æˆ·åˆ—è¡¨&quot;,&quot;id&quot;: 5,&quot;menu_gp_id&quot;: null,&quot;menu_id&quot;: 2&#125;,</span><br><span class="line">        &#123;&quot;url&quot;: &quot;&#x2F;userinfo&#x2F;add&#x2F;&quot;,&quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,&quot;title&quot;: &quot;æ·»åŠ ç”¨æˆ·&quot;,&quot;id&quot;: 6,&quot;menu_gp_id&quot;: 5,&quot;menu_id&quot;: 2&#125;,</span><br><span class="line">        ......</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # æƒé™ç›¸å…³ï¼Œä¸­é—´ä»¶ä½¿ç”¨</span><br><span class="line">    permission_dict &#x3D; &#123;&#125;</span><br><span class="line">    for item in permission_list:</span><br><span class="line">        group_id &#x3D; item[&#39;permissions__group_id&#39;]</span><br><span class="line">        code &#x3D; item[&#39;permissions__code&#39;]</span><br><span class="line">        url &#x3D; item[&#39;permissions__url&#39;]</span><br><span class="line">        if group_id in permission_dict:</span><br><span class="line">            permission_dict[group_id][&#39;codes&#39;].append(code)</span><br><span class="line">            permission_dict[group_id][&#39;urls&#39;].append(url)</span><br><span class="line">        else:</span><br><span class="line">            permission_dict[group_id] &#x3D; &#123;&quot;codes&quot;: [code, ], &quot;urls&quot;: [url, ]&#125;</span><br><span class="line">    request.session[settings.PERMISSION_URL_DICT_KEY] &#x3D; permission_dict</span><br><span class="line">    # å½¢å¦‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;1&quot;: &#123;</span><br><span class="line">            &quot;codes&quot;: [&quot;list&quot;,&quot;add&quot;,&quot;delete&quot;,&quot;edit&quot;],</span><br><span class="line">            &quot;urls&quot;: [&quot;&#x2F;host&#x2F;&quot;,&quot;&#x2F;host&#x2F;add&#x2F;&quot;,&quot;&#x2F;host&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,&quot;&#x2F;host&#x2F;(\\d+)&#x2F;change&#x2F;&quot;]</span><br><span class="line">         &#125;,</span><br><span class="line">        &quot;2&quot;: &#123;</span><br><span class="line">            &quot;codes&quot;: [&quot;list&quot;,&quot;add&quot;,&quot;delete&quot;,&quot;change&quot;],</span><br><span class="line">            &quot;urls&quot;: [&quot;&#x2F;userinfo&#x2F;&quot;,&quot;&#x2F;userinfo&#x2F;add&#x2F;&quot;,&quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,&quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;change&#x2F;&quot;]</span><br><span class="line">         &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><em>æ³¨: ç”¨æˆ·ç™»é™†æˆåŠŸåè¿›è¡Œåˆå§‹åŒ–æƒé™ä¿¡æ¯,åœ¨å¤„ç†ç”¨æˆ·æƒé™æ—¶éœ€è¦è¿›è¡Œæ•°æ®å»é‡</em></p>
<h3 id="èœå•ListåŠæƒé™Dictæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š"><a href="#èœå•ListåŠæƒé™Dictæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š" class="headerlink" title="èœå•ListåŠæƒé™Dictæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š"></a>èœå•ListåŠæƒé™Dictæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># èœå•List request.session[settings.PERMISSION_MENU_KEY]</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;host&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;ä¸»æœºåˆ—è¡¨&quot;,</span><br><span class="line">        &quot;id&quot;: 1,</span><br><span class="line">        &quot;menu_gp_id&quot;: null,</span><br><span class="line">        &quot;menu_id&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;host&#x2F;add&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;æ·»åŠ ä¸»æœº&quot;,</span><br><span class="line">        &quot;id&quot;: 2,</span><br><span class="line">        &quot;menu_gp_id&quot;: 1,</span><br><span class="line">        &quot;menu_id&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;host&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;åˆ é™¤ä¸»æœº&quot;,</span><br><span class="line">        &quot;id&quot;: 3,</span><br><span class="line">        &quot;menu_gp_id&quot;: 1,</span><br><span class="line">        &quot;menu_id&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;host&#x2F;(\\d+)&#x2F;change&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;ä¿®æ”¹ä¸»æœº&quot;,</span><br><span class="line">        &quot;id&quot;: 4,</span><br><span class="line">        &quot;menu_gp_id&quot;: 1,</span><br><span class="line">        &quot;menu_id&quot;: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;userinfo&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;ç”¨æˆ·åˆ—è¡¨&quot;,</span><br><span class="line">        &quot;id&quot;: 5,</span><br><span class="line">        &quot;menu_gp_id&quot;: null,</span><br><span class="line">        &quot;menu_id&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;userinfo&#x2F;add&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;æ·»åŠ ç”¨æˆ·&quot;,</span><br><span class="line">        &quot;id&quot;: 6,</span><br><span class="line">        &quot;menu_gp_id&quot;: 5,</span><br><span class="line">        &quot;menu_id&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;åˆ é™¤ç”¨æˆ·&quot;,</span><br><span class="line">        &quot;id&quot;: 7,</span><br><span class="line">        &quot;menu_gp_id&quot;: 5,</span><br><span class="line">        &quot;menu_id&quot;: 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;url&quot;: &quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;change&#x2F;&quot;,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,</span><br><span class="line">        &quot;title&quot;: &quot;ä¿®æ”¹ç”¨æˆ·&quot;,</span><br><span class="line">        &quot;id&quot;: 8,</span><br><span class="line">        &quot;menu_gp_id&quot;: 5,</span><br><span class="line">        &quot;menu_id&quot;: 2</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># æƒé™Dict request.session[settings.PERMISSION_URL_DICT_KEY]</span><br><span class="line">&#123;</span><br><span class="line">    &quot;1&quot;: &#123;</span><br><span class="line">        &quot;codes&quot;: [</span><br><span class="line">            &quot;list&quot;,</span><br><span class="line">            &quot;add&quot;,</span><br><span class="line">            &quot;delete&quot;,</span><br><span class="line">            &quot;edit&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;urls&quot;: [</span><br><span class="line">            &quot;&#x2F;host&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;host&#x2F;add&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;host&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;host&#x2F;(\\d+)&#x2F;change&#x2F;&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;2&quot;: &#123;</span><br><span class="line">        &quot;codes&quot;: [</span><br><span class="line">            &quot;list&quot;,</span><br><span class="line">            &quot;add&quot;,</span><br><span class="line">            &quot;delete&quot;,</span><br><span class="line">            &quot;change&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;urls&quot;: [</span><br><span class="line">            &quot;&#x2F;userinfo&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;userinfo&#x2F;add&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;delete&#x2F;&quot;,</span><br><span class="line">            &quot;&#x2F;userinfo&#x2F;(\\d+)&#x2F;change&#x2F;&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<h4 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat rbac&#x2F;middleware&#x2F;rbac.py</span><br><span class="line"></span><br><span class="line">from django.shortcuts import redirect,HttpResponse</span><br><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line"># åœ¨åç»­ç‰ˆæœ¬ä¸­å¯èƒ½ä¼šè¢«åºŸå¼ƒï¼Œæ•…åœ¨æ­¤ç›´æ¥å¼•å…¥</span><br><span class="line">#from django.utils.deprecation import MiddlewareMixin</span><br><span class="line">class MiddlewareMixin(object):</span><br><span class="line">    def __init__(self, get_response&#x3D;None):</span><br><span class="line">        self.get_response &#x3D; get_response</span><br><span class="line">        super(MiddlewareMixin, self).__init__()</span><br><span class="line"></span><br><span class="line">    def __call__(self, request):</span><br><span class="line">        response &#x3D; None</span><br><span class="line">        if hasattr(self, &#39;process_request&#39;):</span><br><span class="line">            response &#x3D; self.process_request(request)</span><br><span class="line">        if not response:</span><br><span class="line">            response &#x3D; self.get_response(request)</span><br><span class="line">        if hasattr(self, &#39;process_response&#39;):</span><br><span class="line">            response &#x3D; self.process_response(request, response)</span><br><span class="line">        return response</span><br><span class="line"></span><br><span class="line">class RbacMiddleware(MiddlewareMixin):</span><br><span class="line">    def process_request(self,request):</span><br><span class="line">        # 1. å½“å‰è¯·æ±‚URL</span><br><span class="line">        current_request_url &#x3D; request.path_info</span><br><span class="line"></span><br><span class="line">        # 2. å¤„ç†ç™½åå•,å¦‚loginåŠadminé¡µé¢éœ€å¼€æ”¾è®¿é—®æƒé™ï¼Œæ ¹æ®å®é™…æƒ…å†µè€Œå®š</span><br><span class="line">        for url in settings.VALID_URL_LIST:</span><br><span class="line">            if re.match(url,current_request_url):</span><br><span class="line">                return None</span><br><span class="line"></span><br><span class="line">        # 3. è·å–sessionä¸­ä¿å­˜çš„æƒé™ä¿¡æ¯</span><br><span class="line">        permission_dict &#x3D; request.session.get(settings.PERMISSION_MENU_LIST)</span><br><span class="line">        if not permission_dict:</span><br><span class="line">            # ç™»é™†é¡µé¢</span><br><span class="line">            return redirect(settings.RBAC_LOGIN_URL)</span><br><span class="line"></span><br><span class="line">        flag &#x3D; False</span><br><span class="line">        for group_id, values in permission_dict.items():</span><br><span class="line">            for url in values[&#39;urls&#39;]:</span><br><span class="line">                regex &#x3D; settings.URL_FORMAT.format(url)</span><br><span class="line">                if re.match(regex, current_request_url):</span><br><span class="line">                    flag &#x3D; True</span><br><span class="line">                    break</span><br><span class="line">            if flag:</span><br><span class="line">                break</span><br><span class="line">        if not flag:</span><br><span class="line">            # æ— æƒè®¿é—®é¡µé¢ï¼Œå¯ä»¥ç›´æ¥redirect</span><br><span class="line">            return HttpResponse(&#39;æ— æƒè®¿é—®&#39;)</span><br></pre></td></tr></table></figure>
<br>

<h4 id="è‡ªåŠ¨ç”Ÿæˆèœå•template-tags"><a href="#è‡ªåŠ¨ç”Ÿæˆèœå•template-tags" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆèœå•template tags"></a>è‡ªåŠ¨ç”Ÿæˆèœå•template tags</h4><ol>
<li>template tagséƒ¨åˆ†<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2017&#x2F;11&#x2F;20</span><br><span class="line"></span><br><span class="line">from django.conf import settings</span><br><span class="line">from django.template import Library</span><br><span class="line">import re</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">register &#x3D; Library()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@register.inclusion_tag(&#39;menu.html&#39;)</span><br><span class="line">def menu_html(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è·å–sessionä¸­çš„èœå•ä¿¡æ¯ï¼ŒåŒ¹é…å½“å‰URLï¼Œç”Ÿæˆèœå•</span><br><span class="line">    :param request: è¯·æ±‚çš„requstå¯¹è±¡</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    menu_list &#x3D; request.session.get(settings.PERMISSION_MENU_KEY)</span><br><span class="line">    # å½“å‰è¯·æ±‚URL</span><br><span class="line">    current_url &#x3D; request.path_info</span><br><span class="line"></span><br><span class="line">    menu_dict &#x3D; &#123;&#125;</span><br><span class="line">    # menu_gp_idä¸ºç©ºåˆ™æ˜¯èœå•</span><br><span class="line">    for item in menu_list:</span><br><span class="line">        if not item[&#39;menu_gp_id&#39;]:</span><br><span class="line">            menu_dict[item[&#39;id&#39;]] &#x3D; item</span><br><span class="line"></span><br><span class="line">    for item in menu_list:</span><br><span class="line">        regax &#x3D; &quot;^&#123;0&#125;$&quot;.format(item[&#39;url&#39;])</span><br><span class="line">        if re.match(regax, current_url):</span><br><span class="line">            menu_gp_id &#x3D; item[&#39;menu_gp_id&#39;]</span><br><span class="line">            if menu_gp_id:</span><br><span class="line">                menu_dict[menu_gp_id][&#39;active&#39;] &#x3D; True</span><br><span class="line">            else:</span><br><span class="line">                menu_dict[item[&#39;id&#39;]][&#39;active&#39;] &#x3D; True</span><br><span class="line"></span><br><span class="line">    result &#x3D; &#123;&#125;</span><br><span class="line">    for item in menu_dict.values():</span><br><span class="line">        active &#x3D; item.get(&#39;active&#39;)</span><br><span class="line">        menu_id &#x3D; item[&#39;menu_id&#39;]</span><br><span class="line">        if menu_id in result:</span><br><span class="line">            result[menu_id][&#39;children&#39;].append(&#123;&#39;title&#39;: item[&#39;title&#39;], &#39;url&#39;: item[&#39;url&#39;], &#39;active&#39;: active&#125;)</span><br><span class="line">            if active:</span><br><span class="line">                result[menu_id][&#39;active&#39;] &#x3D; True</span><br><span class="line">        else:</span><br><span class="line">            result[menu_id] &#x3D; &#123;</span><br><span class="line">                &#39;menu_id&#39;: item[&#39;menu_id&#39;],</span><br><span class="line">                &#39;menu_title&#39;: item[&#39;menu_title&#39;],</span><br><span class="line">                &#39;active&#39;: active,</span><br><span class="line">                &#39;children&#39;: [</span><br><span class="line">                    &#123;&#39;title&#39;: item[&#39;title&#39;], &#39;url&#39;: item[&#39;url&#39;], &#39;active&#39;: active&#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">    print(json.dumps(result, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line">    return &#123;&#39;menu_dict&#39;: result&#125;</span><br></pre></td></tr></table></figure></li>
<li>ç”Ÿæˆçš„èœå•æ ‘æ ¼å¼å¦‚ä¸‹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;1&quot;: &#123;</span><br><span class="line">        &quot;children&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;url&quot;: &quot;&#x2F;host&#x2F;&quot;,</span><br><span class="line">                &quot;active&quot;: null,</span><br><span class="line">                &quot;title&quot;: &quot;ä¸»æœºåˆ—è¡¨&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;menu_id&quot;: 1,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ä¸»æœºç®¡ç†&quot;,</span><br><span class="line">        &quot;active&quot;: null</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;2&quot;: &#123;</span><br><span class="line">        &quot;children&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;url&quot;: &quot;&#x2F;userinfo&#x2F;&quot;,</span><br><span class="line">                &quot;active&quot;: null,</span><br><span class="line">                &quot;title&quot;: &quot;ç”¨æˆ·åˆ—è¡¨&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;menu_id&quot;: 2,</span><br><span class="line">        &quot;menu_title&quot;: &quot;ç”¨æˆ·ç®¡ç†&quot;,</span><br><span class="line">        &quot;active&quot;: null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>menu_tpl.htmléƒ¨åˆ†<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;% for k,item in menu_dict.items %&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;item&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;item-title&quot;&gt; &#123;&#123; item.menu_title &#125;&#125; &lt;&#x2F;div&gt;</span><br><span class="line">        &#123;% if item.active %&#125;</span><br><span class="line">            &lt;div class&#x3D;&quot;item-permission&quot;&gt;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">            &lt;div class&#x3D;&quot;item-permission hide&quot;&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">            &#123;% for v in item.children %&#125;</span><br><span class="line">                &#123;% if v.active %&#125;</span><br><span class="line">                    &lt;a href&#x3D;&quot;&#123;&#123; v.url &#125;&#125;&quot; class&#x3D;&quot;active&quot;&gt;&#123;&#123; v.title &#125;&#125;&lt;&#x2F;a&gt;</span><br><span class="line">                &#123;% else %&#125;</span><br><span class="line">                    &lt;a href&#x3D;&quot;&#123;&#123; v.url &#125;&#125;&quot;&gt;&#123;&#123; v.title &#125;&#125;&lt;&#x2F;a&gt;</span><br><span class="line">                &#123;% endif %&#125;</span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></li>
<li>HTMLéƒ¨åˆ†ä½¿ç”¨tags<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸Šæ–‡ä¸­çš„menu_htmlå‡½æ•°ä¾èµ–requestå‚æ•°ï¼Œæ­¤å¤„éœ€è¦ä¼ å…¥</span><br><span class="line">&#123; load rbac &#125;</span><br><span class="line">&#123; menu_html request &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><em>æ³¨: è‡ªå®šä¹‰tagsåªæ”¯æŒä¼ å…¥1ä¸ªå‚æ•°</em><br><br></p>
<h4 id="æ³¨å†Œä¸­é—´ä»¶ä½¿ç”¨"><a href="#æ³¨å†Œä¸­é—´ä»¶ä½¿ç”¨" class="headerlink" title="æ³¨å†Œä¸­é—´ä»¶ä½¿ç”¨"></a>æ³¨å†Œä¸­é—´ä»¶ä½¿ç”¨</h4><p>project/settings.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE &#x3D; [</span><br><span class="line">    &#39;django.middleware.security.SecurityMiddleware&#39;,</span><br><span class="line">    &#39;django.contrib.sessions.middleware.SessionMiddleware&#39;,</span><br><span class="line">    &#39;django.middleware.common.CommonMiddleware&#39;,</span><br><span class="line">    &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span><br><span class="line">    &#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;,</span><br><span class="line">    &#39;django.contrib.messages.middleware.MessageMiddleware&#39;,</span><br><span class="line">    &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span><br><span class="line">    &#39;rbac.middleware.rbac.RbacMiddleware&#39;,</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="ç»´æŠ¤"><a href="#ç»´æŠ¤" class="headerlink" title="ç»´æŠ¤"></a>ç»´æŠ¤</h4><p>åœ¨Django Adminä¸­ç»´æŠ¤rbacçš„æƒé™ç³»ç»Ÿå¹¶ä½¿ç”¨<br><br></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡³æ­¤ï¼ŒåŸºäºroleå®ç°çš„rbacç»„ä»¶åŸºæœ¬å¼€å‘å®Œæˆï¼Œåœ¨Djangoä¸­ä½œä¸ºappå¼•å…¥åœ¨settingsæ–‡ä»¶ä¸­æ³¨å†Œåå°±å¯ä»¥ç”Ÿæ•ˆä½¿ç”¨äº†,engoy it!</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Dockeréƒ¨ç½²Django+Vueå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®</title>
    <url>/2020/04/20/Docker%E9%83%A8%E7%BD%B2Django-Vue%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<h2 id="Dockeréƒ¨ç½²Django-Vueå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®"><a href="#Dockeréƒ¨ç½²Django-Vueå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®" class="headerlink" title="Dockeréƒ¨ç½²Django+Vueå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®"></a>Dockeréƒ¨ç½²Django+Vueå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®</h2><blockquote>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»ä½¿ç”¨Dockerç¯å¢ƒéƒ¨ç½²ä¸€ä¸ªDjango Restå’ŒVueç»“åˆçš„å‰åç«¯åˆ†ç¦»é¡¹ç›®.</p>
</blockquote>
<h3 id="å‰ç«¯Vue"><a href="#å‰ç«¯Vue" class="headerlink" title="å‰ç«¯Vue"></a>å‰ç«¯Vue</h3><h4 id="ä½¿ç”¨Makefileç¼–è¯‘æ‰“åŒ…"><a href="#ä½¿ç”¨Makefileç¼–è¯‘æ‰“åŒ…" class="headerlink" title="ä½¿ç”¨Makefileç¼–è¯‘æ‰“åŒ…"></a>ä½¿ç”¨Makefileç¼–è¯‘æ‰“åŒ…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#</span><br><span class="line"># cmdb-frontend makefile</span><br><span class="line">#</span><br><span class="line">SHELL :&#x3D; &#x2F;bin&#x2F;bash</span><br><span class="line">PATH  :&#x3D; node_modules&#x2F;.bin:$(PATH)</span><br><span class="line"></span><br><span class="line">NOW :&#x3D; $(shell date +&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">PROJECT :&#x3D; cmdb-frontend</span><br><span class="line">PKG_NAME :&#x3D; $(PROJECT).tar.gz</span><br><span class="line"></span><br><span class="line"># Docker</span><br><span class="line">REGISTRY :&#x3D; wcr.shuke.net</span><br><span class="line">NAME :&#x3D; devops&#x2F;$(PROJECT)</span><br><span class="line">TAG :&#x3D; v$(shell date +&quot;%Y%m%d&quot;)</span><br><span class="line">IMG :&#x3D; $(REGISTRY)&#x2F;$(NAME):$(TAG)</span><br><span class="line"></span><br><span class="line"># update helm values.yaml</span><br><span class="line">CONTENT :&#x3D; $(subst TAG,$(TAG),&#39;9 s&#x2F;.*&#x2F;  tag\: TAG&#x2F;g&#39;)</span><br><span class="line"></span><br><span class="line">all : install pkg build-img</span><br><span class="line">.PHONY: all</span><br><span class="line"></span><br><span class="line">install:</span><br><span class="line">	@echo -e &quot;\033[32m$(NOW): Build $&#123;PROJECT&#125; project\033[0m&quot;</span><br><span class="line">	npm run build</span><br><span class="line"></span><br><span class="line">pkg:</span><br><span class="line">	@echo -e &quot;\033[32m$(NOW): start packing\033[0m&quot;</span><br><span class="line">	tar zcf $(PKG_NAME) dist&#x2F;*</span><br><span class="line"></span><br><span class="line">build-img:</span><br><span class="line">	@echo -e &quot;\033[32m$(NOW): Start build image...\033[0m&quot;</span><br><span class="line">	cp -Ra dist nginx&#x2F;</span><br><span class="line">	docker build -t $(IMG) nginx</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	@echo -e &quot;\033[32m$(NOW): clean...\033[0m&quot;</span><br><span class="line">	-rm -rf $(PKG_NAME) dist nginx&#x2F;dist</span><br><span class="line">	-docker rmi $(IMG)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨: åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ<code>make all</code>å‘½ä»¤è¿›è¡Œç¼–è¯‘æ‰“åŒ…æ“ä½œä»¥åŠç”Ÿæˆdockeré•œåƒ.</p>
<h4 id="Nginxé…ç½®æ–‡ä»¶"><a href="#Nginxé…ç½®æ–‡ä»¶" class="headerlink" title="Nginxé…ç½®æ–‡ä»¶"></a>Nginxé…ç½®æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat cmdb.shuke.net.conf</span><br><span class="line">upstream cmdb-backend &#123;</span><br><span class="line">    server web:8000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">	listen 80;</span><br><span class="line">	server_name cmdb.shuke.net;</span><br><span class="line"></span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">    	    root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            try_files $uri $uri&#x2F; &#x2F;index.html @fallback;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">        location @fallback &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">	        proxy_pass    http:&#x2F;&#x2F;cmdb-backend;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨: éœ€å°†nginxé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°Dokceré•œåƒä¸­è¦†ç›–é»˜è®¤çš„é…ç½®æ–‡ä»¶</p>
<h4 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#</span><br><span class="line"># CMDB Frontend Nginx Dockerfile</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">FROM wcr.shuke.net&#x2F;base&#x2F;nginx:1.14.2</span><br><span class="line"></span><br><span class="line">LABEL maintainer&#x3D;&quot;shu_ke163@163.com&quot;</span><br><span class="line"></span><br><span class="line">COPY dist &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line"></span><br><span class="line">COPY cmdb.shuke.net.conf &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br><span class="line"></span><br><span class="line">WORKDIR &#x2F;etc&#x2F;nginx</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨: æ­¤å¤„çš„nginxé•œåƒå¯ä»¥ä½¿ç”¨Docker Hubå®˜æ–¹çš„é•œåƒä¹Ÿå¯ä»¥è‡ªå®šä¹‰.</p>
<h3 id="åç«¯Django"><a href="#åç«¯Django" class="headerlink" title="åç«¯Django"></a>åç«¯Django</h3><h4 id="Dockerfile-1"><a href="#Dockerfile-1" class="headerlink" title="Dockerfile"></a>Dockerfile</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#</span><br><span class="line"># Django CMDB</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">FROM python:3</span><br><span class="line">ENV PYTHONUNBUFFERED 1</span><br><span class="line">RUN mkdir &#x2F;code</span><br><span class="line">WORKDIR &#x2F;code</span><br><span class="line">ADD requirements.txt &#x2F;code&#x2F;</span><br><span class="line">RUN pip install  --no-cache-dir -r requirements.txt</span><br><span class="line">ADD . &#x2F;code&#x2F;</span><br><span class="line">EXPOSE 8000</span><br><span class="line">CMD [&quot;python&quot;, &quot;.&#x2F;manage.py runserver 0.0.0.0:8000&quot;]</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨: å°†Dockerfileæ”¾å…¥Djangoçš„é¡¹ç›®æ ¹èŠ‚ç‚¹ç›®å½•ä¸‹,ç”¨äºæ„å»ºåç«¯å®¹å™¨</p>
<h4 id="docker-compose-yml-æ–‡ä»¶"><a href="#docker-compose-yml-æ–‡ä»¶" class="headerlink" title="docker-compose.yml æ–‡ä»¶"></a>docker-compose.yml æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:4</span><br><span class="line">    container_name: cmdb-redis</span><br><span class="line">  db:</span><br><span class="line">    image: mysql:5.6</span><br><span class="line">    container_name: cmdb-mysql</span><br><span class="line">    volumes:</span><br><span class="line">      - ~&#x2F;data&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: admin123</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3307:3306&quot;</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    image: cmdb-backend:v1.0.0</span><br><span class="line">    container_name: cmdb-backend</span><br><span class="line">    command: python3 manage.py runserver 0.0.0.0:8000</span><br><span class="line">    volumes:</span><br><span class="line">      - .:&#x2F;code</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:8000&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - redis</span><br><span class="line">      - db</span><br><span class="line">    links:</span><br><span class="line">      - redis</span><br><span class="line">      - db</span><br><span class="line">  nginx:</span><br><span class="line">   # å‰ç«¯Vueé¡¹ç›®Dockerfileæ‰€åœ¨ç›®å½• </span><br><span class="line">    build: ..&#x2F;cmdb-frontend&#x2F;nginx&#x2F;</span><br><span class="line">    image: cmdb-frontend:v1.0.0</span><br><span class="line">    container_name: cmdb-nginx</span><br><span class="line">    ports:</span><br><span class="line">      - 9000:80</span><br><span class="line">    depends_on:</span><br><span class="line">      - web</span><br><span class="line">    links:</span><br><span class="line">      - web</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure>
<p>âš ï¸ æ³¨: ä½¿ç”¨docker-compose è¿›è¡Œç®¡ç†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–,åŒ…æ‹¬redis/mysql/django/nginxå®¹å™¨,æ§åˆ¶æ•´ä¸ªé¡¹ç›®æ‰€ä¾èµ–çš„æ‰€æœ‰å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ,ä½¿ç”¨<code>docker-compose up -d</code>å‘½ä»¤æ‹‰å–æˆ–ç”Ÿæˆé•œåƒå¹¶å¯åŠ¨é¡¹ç›®ä¾èµ–çš„æ‰€æœ‰å®¹å™¨</p>
<h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. docker-compose build web   æ„å»ºåç«¯Djangoé¡¹ç›®å®¹å™¨</span><br><span class="line">2. docker-compose build nginx æ„å»ºå‰ç«¯Vueé¡¹ç›®å®¹å™¨</span><br><span class="line">3. docker-compose up å‰å°å¯åŠ¨é¡¹ç›®</span><br><span class="line">4. docker-compose up åå°å¯åŠ¨é¡¹ç›®</span><br><span class="line">5. docker-compose images æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰é•œåƒ</span><br><span class="line">6. docker-compose ps æŸ¥çœ‹é¡¹ç›®æ‰€æœ‰å®¹å™¨</span><br><span class="line">7. docker-compose logs -f [service name] å¦‚:web&#x2F;nginx  æŸ¥çœ‹å®¹å™¨logä¿¡æ¯</span><br><span class="line">8. docker-compose config æŸ¥çœ‹docker-compose.ymlæ–‡ä»¶å†…å®¹å¹¶æ ¡éªŒ</span><br><span class="line">9. $ docker-compose port nginx 80   # æŸ¥çœ‹æœåŠ¡çš„ç«¯å£æ˜ å°„</span><br><span class="line">0.0.0.0:9000</span><br><span class="line">10. docker-compose stop db åœæ­¢å•ä¸ªå®¹å™¨</span><br><span class="line">11. docker-compose start db å¯åŠ¨å•ä¸ªå®¹å™¨</span><br><span class="line">12. docker-compose restart db é‡å¯å•ä¸ªå®¹å™¨</span><br><span class="line">13. docker-compose start   å¯åŠ¨æ‰€æœ‰å®¹å™¨</span><br><span class="line">14. docker-compose stop  åœæ­¢æ‰€æœ‰å®¹å™¨</span><br><span class="line">15. docker-compose restart  é‡å¯æ‰€æœ‰å®¹å™¨</span><br><span class="line">16. docker-compose rm  åˆ é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨</span><br><span class="line"></span><br><span class="line"># ä»¥ä¸‹æ˜¯æ‰€æœ‰çš„docker-composeä¸€äº›å‘½ä»¤å‚æ•°</span><br><span class="line">Commands:</span><br><span class="line">  build              Build or rebuild services</span><br><span class="line">  bundle             Generate a Docker bundle from the Compose file</span><br><span class="line">  config             Validate and view the Compose file</span><br><span class="line">  create             Create services</span><br><span class="line">  down               Stop and remove containers, networks, images, and volumes</span><br><span class="line">  events             Receive real time events from containers</span><br><span class="line">  exec               Execute a command in a running container</span><br><span class="line">  help               Get help on a command</span><br><span class="line">  images             List images</span><br><span class="line">  kill               Kill containers</span><br><span class="line">  logs               View output from containers</span><br><span class="line">  pause              Pause services</span><br><span class="line">  port               Print the public port for a port binding</span><br><span class="line">  ps                 List containers</span><br><span class="line">  pull               Pull service images</span><br><span class="line">  push               Push service images</span><br><span class="line">  restart            Restart services</span><br><span class="line">  rm                 Remove stopped containers</span><br><span class="line">  run                Run a one-off command</span><br><span class="line">  scale              Set number of containers for a service</span><br><span class="line">  start              Start services</span><br><span class="line">  stop               Stop services</span><br><span class="line">  top                Display the running processes</span><br><span class="line">  unpause            Unpause services</span><br><span class="line">  up                 Create and start containers</span><br><span class="line">  version            Show the Docker-Compose version information</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Docker</category>
      </categories>
      <tags>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>DjangoåŸºäºAdminåŸç†å®ç°çš„CURDç»„ä»¶</title>
    <url>/2020/04/20/Django%E5%9F%BA%E4%BA%8EAdmin%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E7%9A%84CURD%E7%BB%84%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="DjangoåŸºäºAdminåŸç†å®ç°çš„CURDç»„ä»¶"><a href="#DjangoåŸºäºAdminåŸç†å®ç°çš„CURDç»„ä»¶" class="headerlink" title="DjangoåŸºäºAdminåŸç†å®ç°çš„CURDç»„ä»¶"></a>DjangoåŸºäºAdminåŸç†å®ç°çš„CURDç»„ä»¶</h1><hr>
<br>

<h2 id="Djangoç®¡ç†åå°admin"><a href="#Djangoç®¡ç†åå°admin" class="headerlink" title="Djangoç®¡ç†åå°admin"></a>Djangoç®¡ç†åå°admin</h2><p>å¸¸ç”¨å…±29ä¸ªåŠŸèƒ½: <a href="http://www.cnblogs.com/wupeiqi/articles/7444717.html" target="_blank" rel="noopener">å‚è€ƒ</a></p>
<ol>
<li>åœ¨é¡¹ç›®çš„appä¸­çš„admin.pyæ–‡ä»¶ä¸­æ³¨å†Œmodelsç±»ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat app_name&#x2F;admin.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.contrib.admin import ModelAdmin</span><br><span class="line">from . import models</span><br><span class="line">from django.shortcuts import HttpResponse</span><br><span class="line">from django.forms import ModelForm</span><br><span class="line">from django.forms import fields</span><br><span class="line">from django.forms import widgets</span><br><span class="line"></span><br><span class="line"># ç”¨æˆ·è¡¨,è‡ªå®šä¹‰adminåå°é”™è¯¯ä¿¡æ¯æç¤º</span><br><span class="line">class UserModelForm(ModelForm):</span><br><span class="line">    others &#x3D; fields.CharField()</span><br><span class="line">    class Meta:</span><br><span class="line">        model &#x3D; models.UserInfo</span><br><span class="line">        fields &#x3D; &quot;__all__&quot;</span><br><span class="line">        error_messages &#x3D; &#123;</span><br><span class="line">            &#39;name&#39;:&#123;&#39;required&#39;:&#39;ç”¨æˆ·åä¸èƒ½é—®ç©º&#39;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">class UserInfoModelAdmin(ModelAdmin):</span><br><span class="line">    # ä½¿ç”¨è‡ªå®šä¹‰çš„formè¡¨å•éªŒè¯åŠŸèƒ½</span><br><span class="line">    form &#x3D; UserModelForm</span><br><span class="line"></span><br><span class="line">    # 1.å®šä¹‰åˆ—è¡¨é¡µé¢ï¼Œæ˜¾ç¤ºåˆ—æ•°æ®</span><br><span class="line">    list_display &#x3D; [&#39;name&#39;,&#39;pwd&#39;,&#39;email&#39;]</span><br><span class="line"></span><br><span class="line">    def email(self, obj):</span><br><span class="line">        return obj.name + obj.pwd</span><br><span class="line"></span><br><span class="line">    email.empty_value_display &#x3D; &quot;é»˜è®¤ä¸ºç©ºæ—¶æ˜¾ç¤ºçš„å€¼&quot;</span><br><span class="line"></span><br><span class="line">    # 2.å®šä¹‰åˆ—è¡¨é¡µé¢ï¼Œåˆ—å¯ä»¥è¿›è¡Œç‚¹å‡»è¿›å…¥ç¼–è¾‘é¡µé¢</span><br><span class="line">    list_display_links &#x3D; [&#39;pwd&#39;]</span><br><span class="line">    </span><br><span class="line">    # 3.å®šä¹‰åˆ—è¡¨é¡µé¢ï¼Œå¿«é€Ÿæœç´¢</span><br><span class="line">    list_filter &#x3D; [&#39;ut&#39;]</span><br><span class="line">    </span><br><span class="line">    # 4.å®šä¹‰åˆ—è¡¨é¡µé¢ï¼Œåˆ†é¡µåŠŸèƒ½</span><br><span class="line">    list_per_page &#x3D; 10</span><br><span class="line">    </span><br><span class="line">    # 5. åˆ—æ˜¯å¦å¯ç¼–è¾‘</span><br><span class="line">    list_editable &#x3D; [&#39;name&#39;]</span><br><span class="line"></span><br><span class="line">    # 6. æŸ¥è¯¢åˆ—</span><br><span class="line">    search_fields &#x3D; [&#39;name&#39;,&#39;pwd&#39;]</span><br><span class="line"></span><br><span class="line">    # 7. æ˜¯å¦åœ¨é¡µé¢é¡¶ç«¯æ˜¾ç¤ºä¿å­˜æŒ‰é’®</span><br><span class="line">    # save_on_top &#x3D; True</span><br><span class="line"></span><br><span class="line">    # 8. ä¸‹æ‹‰é€‰é¡¹çš„æ‰¹é‡æ“ä½œï¼Œç±»ä¼¼äºæ‰¹é‡åˆ é™¤åŠŸèƒ½</span><br><span class="line">    def func(self, request, queryset):</span><br><span class="line">        print(self, request, queryset)</span><br><span class="line">        id_list &#x3D; request.POST.getlist(&#39;_selected_action&#39;)</span><br><span class="line">        # models.UserInfo.objects.filter(id__in&#x3D;id_list).delete()</span><br><span class="line"></span><br><span class="line">    func.short_description &#x3D; &quot;æ‰¹é‡åˆå§‹åŒ–&quot;</span><br><span class="line"></span><br><span class="line">    actions &#x3D; [func, ]</span><br><span class="line"></span><br><span class="line">    # 9. åˆ—è¡¨é¡µé¢ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶</span><br><span class="line">    change_list_template &#x3D; [&#39;xxx.html&#39;]</span><br><span class="line">    </span><br><span class="line">    # raw_id_fields &#x3D; [&#39;ut&#39;,]</span><br><span class="line">    # fields &#x3D; [&#39;name&#39;]</span><br><span class="line">    # exclude &#x3D; [&#39;name&#39;,]</span><br><span class="line">    </span><br><span class="line">    # 10. åˆ†ç±»å±•ç¤º</span><br><span class="line">    # fieldsets &#x3D; (</span><br><span class="line">    #     (&#39;åŸºæœ¬æ•°æ®&#39;, &#123;</span><br><span class="line">    #         &#39;fields&#39;: (&#39;name&#39;,)</span><br><span class="line">    #     &#125;),</span><br><span class="line">    #     (&#39;å…¶ä»–&#39;, &#123;</span><br><span class="line">    #         &#39;classes&#39;: (&#39;collapse&#39;, &#39;wide&#39;, &#39;extrapretty&#39;),  # &#39;collapse&#39;,&#39;wide&#39;, &#39;extrapretty&#39;</span><br><span class="line">    #         &#39;fields&#39;: (&#39;pwd&#39;, &#39;ut&#39;),</span><br><span class="line">    #     &#125;),</span><br><span class="line">    # )</span><br><span class="line"></span><br><span class="line">    # 11.å¿«é€Ÿè¿‡æ»¤</span><br><span class="line">    # filter_vertical &#x3D; (&quot;roles&quot;,)</span><br><span class="line">    filter_horizontal &#x3D; (&quot;roles&quot;,)</span><br><span class="line">    </span><br><span class="line">    # 12. æ’åº</span><br><span class="line">    ordering &#x3D; [&#39;-id&#39;]</span><br><span class="line"></span><br><span class="line"># æ³¨å†Œä½¿ç”¨è‡ªå®šä¹‰çš„UserInfoModelAdminç±»çš„é¡µé¢å±•ç¤ºè§„åˆ™</span><br><span class="line">admin.site.register(models.UserInfo,UserInfoModelAdmin)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 2. ç”¨æˆ·ç±»å‹è¡¨(åŸºäºModelAdminç±»)</span><br><span class="line">class UserTypeModelAdmin(ModelAdmin):</span><br><span class="line">    list_display &#x3D; [&#39;title&#39;]</span><br><span class="line">    </span><br><span class="line">admin.site.register(models.UserType,UserTypeModelAdmin)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><em>æ³¨: é»˜è®¤ä½¿ç”¨ModelAdminç±»è¿›è¡Œåå°æ“ä½œï¼Œå¯ä»¥å®šä¹‰è‡ªå·±çš„calssï¼Œé€šè¿‡ç»§æ‰¿ModelAdminç±»å®ç°å®šåˆ¶é¡µé¢å±•ç¤ºåŠŸèƒ½</em><br>2. Djangoè‡ªå¸¦AdminåŸç†<br>2.1 æ¯æ³¨å†Œä¸€ä¸ªmodelç±»ï¼ŒDjangoå†…éƒ¨ä¼šç”Ÿæˆ4ä¸ªå¯¹åº”çš„å¢åˆ æ”¹æŸ¥URLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">URL:</span><br><span class="line">    &#x2F;admin&#x2F;app_name&#x2F;model_name&#x2F;</span><br><span class="line">    &#x2F;admin&#x2F;app_name&#x2F;model_name&#x2F;add&#x2F;</span><br><span class="line">    &#x2F;admin&#x2F;app_name&#x2F;model_name&#x2F;1&#x2F;change&#x2F;</span><br><span class="line">    &#x2F;admin&#x2F;app_name&#x2F;model_name&#x2F;1&#x2F;delete&#x2F;</span><br><span class="line">    ä¾‹ï¼š&#x2F;admin&#x2F;app01&#x2F;userinfo&#x2F;</span><br></pre></td></tr></table></figure>
<p>2.2 å†…éƒ¨å®ç°æœºåˆ¶</p>
<ul>
<li>åœ¨appä¸‹é¢çš„admin.pyæ–‡ä»¶ä¸­æ³¨å†Œmodelsç±»;</li>
<li>Djangoç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šå¾ªç¯æ‰€æœ‰appä¸‹é¢çš„adminæ–‡ä»¶ä¸­æ³¨å†Œçš„modelsç±»ï¼Œä¸ºæ¯ä¸ªmodelsç±»ç”Ÿæˆå¯¹åº”çš„å¢åˆ æ”¹æŸ¥4ä¸ªURL;</li>
<li>æ¯ä¸ªæ³¨å†Œçš„modelç±»ä¼šå°è£…ä¸€ä¸ªç”¨äºå¤„ç†å½“å‰ç±»æ‰€å¯¹åº”çš„URLçš„viewå¯¹è±¡,ç”¨äºå¤„ç†CURDæ“ä½œï¼Œé»˜è®¤ä¸ºModelAdminç±»å¯¹è±¡;<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. self.model&#x3D;models.UserInfo</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;userinfo&#x2F;                obj1.changelist_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;userinfo&#x2F;add&#x2F;            obj1.add_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;userinfo&#x2F;(\d+)&#x2F;delete&#x2F;   obj1.delete_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;userinfo&#x2F;(\d+)&#x2F;change&#x2F;   obj1.change_view</span><br><span class="line"></span><br><span class="line">2. self.model&#x3D;models.UserType</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;usertype&#x2F;                obj2.changelist_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;usertype&#x2F;add&#x2F;            obj2.add_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;usertype&#x2F;(\d+)&#x2F;delete&#x2F;   obj2.delete_view</span><br><span class="line">&#x2F;admin&#x2F;app01&#x2F;usertype&#x2F;(\d+)&#x2F;change&#x2F;   obj2.change_view</span><br></pre></td></tr></table></figure>
<br>

</li>
</ul>
<h2 id="è‡ªå®šä¹‰å®ç°CURDç±»ä¼¼AdminåŠŸèƒ½"><a href="#è‡ªå®šä¹‰å®ç°CURDç±»ä¼¼AdminåŠŸèƒ½" class="headerlink" title="è‡ªå®šä¹‰å®ç°CURDç±»ä¼¼AdminåŠŸèƒ½"></a>è‡ªå®šä¹‰å®ç°CURDç±»ä¼¼AdminåŠŸèƒ½</h2><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ul>
<li>äº†è§£djangoå¯åŠ¨æ—¶æ‰§è¡Œçš„å¯åŠ¨æ–‡ä»¶é¡ºåº</li>
<li>åˆ¶ä½œå¯åŠ¨æ–‡ä»¶</li>
<li>settings.pyé…ç½®æ–‡ä»¶ä¸­æ³¨å†Œå¯åŠ¨æ–‡ä»¶ä½¿å…¨å±€ç”Ÿæ•ˆ</li>
<li>å®ç°ç»„ä»¶CURDä¸šåŠ¡é€»è¾‘</li>
<li>ä¸»è¦å‚è€ƒDjango Adminçš„å®ç°ï¼Œåˆ©ç”¨å•åˆ©æ¨¡å¼å’ŒincludeåŸç†å®ç°è·¯ç”±åˆ†å‘</li>
</ul>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p><em>å‡è®¾ç»„ä»¶appåç§°ä¸º: arya</em></p>
<ol>
<li>Djangoç¨‹åºå¯åŠ¨é¡ºåº<br>åœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œdjangoä¼šæ ¹æ®é…ç½®é¡¹INSTALLED_APPSä¸­æ³¨å†Œçš„å¯åŠ¨æ–‡ä»¶ï¼Œéå†æ¯ä¸ªAppä¸‹é¢å¯¹åº”çš„æ³¨å†Œå¯åŠ¨æ–‡ä»¶,åœ¨aryaç»„ä»¶ä¸‹é¢çš„app.pyæ–‡ä»¶ä¸­å®ç°readyæ–¹æ³•æ¿€æ´»å¯åŠ¨æ–‡ä»¶,å¦‚ä¸‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># arya&#x2F;app.py</span><br><span class="line"></span><br><span class="line">from django.apps import AppConfig</span><br><span class="line"></span><br><span class="line">class AryaConfig(AppConfig):</span><br><span class="line">    name &#x3D; &#39;arya&#39;</span><br><span class="line"></span><br><span class="line">    # Djangoå¯åŠ¨æ—¶è‡ªåŠ¨æ‰«ææ‰€æœ‰appä¸‹é¢çš„aryaæ¨¡å—</span><br><span class="line">    def ready(self):</span><br><span class="line">        from django.utils.module_loading import autodiscover_modules</span><br><span class="line">        autodiscover_modules(&#39;arya&#39;)</span><br></pre></td></tr></table></figure></li>
<li>åœ¨é¡¹ç›®çš„setting.pyæ–‡ä»¶ä¸­é…ç½®ï¼Œæ¿€æ´»ç»„ä»¶ï¼Œä½¿å…¨å±€ç”Ÿæ•ˆï¼Œæ­¤æ—¶Djangoå¯åŠ¨æ—¶ï¼Œåœ¨å®Œå…¨å¯åŠ¨å‰ï¼Œä¾¿ä¼šæ‰«ææ‰€æœ‰appä¸‹é¢çš„arya.pyæ–‡ä»¶å¹¶åŠ è½½ç”Ÿæ•ˆ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS &#x3D; [</span><br><span class="line">    ...</span><br><span class="line">    &#39;arya.apps.AryaConfig&#39;,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li>æ ¸å¿ƒä»£ç é€»è¾‘å®ç°<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat arya&#x2F;seevice&#x2F;v1.py</span><br><span class="line"></span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from django.shortcuts import render, HttpResponse, redirect</span><br><span class="line"></span><br><span class="line">class AryaConfig(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ¯ä¸ªmodelsç±»çš„URLå¯¹åº”å¤„ç†çš„Viewå®ç°</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, model_class, site):</span><br><span class="line">        self.model_class &#x3D; model_class</span><br><span class="line">        # Viewå¯¹è±¡</span><br><span class="line">        self.site &#x3D; site</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def urls(self):</span><br><span class="line">        partterns &#x3D; [</span><br><span class="line">            url(r&#39;^$&#39;, self.changelist_view),</span><br><span class="line">            url(r&#39;^add&#x2F;&#39;, self.add_view),</span><br><span class="line">            url(r&#39;^(\d+)&#x2F;change&#x2F;$&#39;, self.change_view),</span><br><span class="line">            url(r&#39;^(\d+)&#x2F;delete&#x2F;$&#39;, self.delete_view)</span><br><span class="line">        ]</span><br><span class="line">        return partterns</span><br><span class="line"></span><br><span class="line">    def changelist_view(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        åˆ—è¡¨è¯•å›¾</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # return HttpResponse(&quot;åˆ—è¡¨é¡µé¢&quot;)</span><br><span class="line">        return render(request, &#39;arya&#x2F;changelist.html&#39;)</span><br><span class="line"></span><br><span class="line">    def add_view(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ·»åŠ è¯•å›¾</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return HttpResponse(&quot;æ·»åŠ è¯•å›¾&quot;)</span><br><span class="line"></span><br><span class="line">    def change_view(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ä¿®æ”¹è¯•å›¾</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return HttpResponse(&quot;ä¿®æ”¹è¯•å›¾&quot;)</span><br><span class="line"></span><br><span class="line">    def delete_view(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        åˆ é™¤è¯•å›¾</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return HttpResponse(&quot;åˆ é™¤è¯•å›¾&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AryaSite(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å®ç°ç±»ä¼¼äºadmin.site.register()åŠŸèƒ½</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # å­˜æ”¾æ‰€æœ‰çš„modelsç±»åŠå¯¹åº”å¤„ç†UTRLçš„çš„viewå¯¹è±¡</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self._registry &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def register(self, class_name, config_class):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ³¨å†Œæ–¹æ³•,å°è£…å¯¹è±¡</span><br><span class="line">        self._registry &#x3D; &#123;</span><br><span class="line">            module.UserInfo: obj1,  # obj1 &#x3D; AryaConfig(models.UserInfo,site),</span><br><span class="line">            module.UserType: obj2,  # obj2 &#x3D; AryaConfig(models.UserType,site),</span><br><span class="line">        &#125;</span><br><span class="line">        :param class_name: modelsç±»</span><br><span class="line">        :param config_class: å¯¹åº”çš„Viewç±»(AryaConfig)</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self._registry[class_name] &#x3D; config_class(class_name, self)</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def urls(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å¤„ç†å­è·¯ç”±</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        partterns &#x3D; [</span><br><span class="line">            url(r&#39;^login&#x2F;$&#39;, self.login),</span><br><span class="line">            url(r&#39;^logout&#x2F;$&#39;, self.logout),</span><br><span class="line">        ]</span><br><span class="line">        # å¾ªç¯self._registryå±æ€§é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œkeyä¸ºmodelsç±»ï¼Œvalueä¸ºURLSå¯¹åº”å¤„ç†çš„ç±»objå¯¹è±¡</span><br><span class="line">        for model_class, arya_config_obj in self._registry.items():</span><br><span class="line">            # åˆ†åˆ«ä¸ºappåç§°å’Œmodelsçš„ç±»åç§°</span><br><span class="line">            print(&quot;*&quot; * 50)</span><br><span class="line">            print(model_class._meta.app_label, model_class._meta.model_name)</span><br><span class="line">            app_model_name_urls &#x3D; r&#39;^&#123;0&#125;&#x2F;&#123;1&#125;&#x2F;&#39;.format(model_class._meta.app_label, model_class._meta.model_name)</span><br><span class="line">            # arya_config_obj.urls self._registryå­—å…¸ä¸­å­˜æ”¾çš„valueså¯¹è±¡objä¸‹é¢çš„urlsæ–¹æ³•</span><br><span class="line">            pt &#x3D; url(app_model_name_urls, (arya_config_obj.urls, None, None))</span><br><span class="line">            partterns.append(pt)</span><br><span class="line">        # 3å…ƒç»„</span><br><span class="line">        return partterns, None, None</span><br><span class="line"></span><br><span class="line">    def login(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ç™»é™†</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return redirect(&#39;login&#39;)</span><br><span class="line"></span><br><span class="line">    def logout(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        é€€å‡º</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return redirect(&#39;login&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å®ä¾‹åŒ–ï¼Œåˆ©ç”¨å•ä¾‹æ¨¡å¼</span><br><span class="line">site &#x3D; AryaSite()</span><br></pre></td></tr></table></figure>
<br>

</li>
</ol>
<h3 id="å¼•å…¥aryaç»„ä»¶å¹¶ä½¿ç”¨"><a href="#å¼•å…¥aryaç»„ä»¶å¹¶ä½¿ç”¨" class="headerlink" title="å¼•å…¥aryaç»„ä»¶å¹¶ä½¿ç”¨"></a>å¼•å…¥aryaç»„ä»¶å¹¶ä½¿ç”¨</h3><ol>
<li><p>åˆ›å»ºappï¼Œå¼•å…¥aryaç»„ä»¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºå¤šä¸ªappï¼Œå¹¶åœ¨æ¯ä¸ªappä¸‹é¢åˆ›å»ºarya.pyæ–‡ä»¶ï¼Œç”¨äºå®ç°CURDæ“ä½œ</span><br><span class="line">django startapp app01</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li><p>åœ¨app01ä¸‹é¢åˆ›å»ºmodelsæ¨¡å‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat app01&#x2F;models.py</span><br><span class="line"></span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class UserType(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨æˆ·ç±»å‹è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    title &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;ç”¨æˆ·ç±»å‹&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;ç”¨æˆ·ç±»å‹è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Role(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è§’è‰²è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    caption &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;è§’è‰²å&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;è§’è‰²è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.caption</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨æˆ·è¡¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    username &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;ç”¨æˆ·å&quot;)</span><br><span class="line">    password &#x3D; models.CharField(max_length&#x3D;64, verbose_name&#x3D;&quot;å¯†ç &quot;)</span><br><span class="line">    email &#x3D; models.CharField(max_length&#x3D;32, verbose_name&#x3D;&quot;é‚®ç®±&quot;)</span><br><span class="line">    ut &#x3D; models.ForeignKey(to&#x3D;&quot;UserType&quot;, blank&#x3D;True, verbose_name&#x3D;&quot;ç”¨æˆ·ç±»å‹&quot;)</span><br><span class="line">    roles &#x3D; models.ManyToManyField(to&#x3D;&quot;Role&quot;, blank&#x3D;True, verbose_name&#x3D;&quot;æ‰€å±è§’è‰²&quot;)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        verbose_name_plural &#x3D; &quot;ç”¨æˆ·è¡¨&quot;</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.username</span><br></pre></td></tr></table></figure></li>
<li><p>ç”Ÿæˆè¡¨ç»“æ„å¹¶åˆ¶ä½œéƒ¨åˆ†å±•ç¤ºæ•°æ®ï¼Œå¯ä»¥ç›´æ¥åœ¨è¡¨ä¸­æ·»åŠ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡adminåå°è¿›è¡Œæ·»åŠ </p>
</li>
<li><p>åœ¨app01ä¸­çš„arya.pyæ–‡ä»¶ä¸­æ³¨å†Œmodelsç±»å¹¶è‡ªå®šä¹‰å®ç°å±•ç¤ºUI</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat app01&#x2F;arya.py</span><br><span class="line"></span><br><span class="line">from arya.service import v1</span><br><span class="line">from . import models</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"># è‡ªå®šä¹‰å±æ€§æ§åˆ¶UIå±•ç¤º</span><br><span class="line">class UserInfoConfig(v1.AryaConfig):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯UI</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    list_display &#x3D; [&#39;username&#39;, &#39;ut&#39;, &#39;roles&#39;, &#39;email&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserTypeConfig(v1.AryaConfig):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è‡ªå®šä¹‰ç”¨æˆ·ç±»å‹UI</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    list_display &#x3D; [&#39;title&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class RoleConfig(v1.AryaConfig):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è‡ªå®šä¹‰è§’è‰²UI</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    list_display &#x3D; [&#39;caption&#39;]</span><br><span class="line"></span><br><span class="line"># æ³¨å†Œmodels</span><br><span class="line">v1.site.register(models.UserInfo, UserInfoConfig)</span><br><span class="line">v1.site.register(models.UserType, UserTypeConfig)</span><br><span class="line">v1.site.register(models.Role, RoleConfig)</span><br></pre></td></tr></table></figure></li>
<li><p>åœ¨é¡¹ç›®ä¸­åº”ç”¨aryaç»„ä»¶ï¼Œä½¿URLç”Ÿæ•ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#cat project_name&#x2F;urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from arya.service import v1</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line"># urlçš„ç¬¬äºŒä¸ªå‚æ•°è¿”å›ç±»å‹ä¸º([],None,None)çš„å…ƒç»„,æºç è§includeæ–¹æ³•</span><br><span class="line"># æ­¤å¤„çš„loginå’Œlogutä¹Ÿå¯ä»¥ä½¿ç”¨arya&#x2F;service&#x2F;v1.pyæ–‡ä»¶ä¸­å®šä¹‰çš„è·¯ç”±ï¼Œç¤ºä¾‹ä¸ºè‡ªå·±å®ç°</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    # æ­¤å¤„ä¼šç”Ÿæˆå¯¹åº”çš„å¤šä¸ªURLå­è·¯ç”±</span><br><span class="line">    url(r&#39;^arya&#x2F;&#39;, v1.site.urls),</span><br><span class="line">    url(r&#39;^index&#x2F;$&#39;, views.index, name&#x3D;&quot;index&quot;),</span><br><span class="line">    url(r&#39;^login&#x2F;$&#39;, views.login, name&#x3D;&quot;login&quot;),</span><br><span class="line">    url(r&#39;^logout&#x2F;$&#39;, views.logout, name&#x3D;&quot;logout&quot;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
<li><p>è·¯ç”±è¯•å›¾å¤„ç†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat project_name&#x2F;views.py</span><br><span class="line"></span><br><span class="line">from django.shortcuts import render, redirect</span><br><span class="line">from app01 import models</span><br><span class="line"></span><br><span class="line">def login(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç™»é™†</span><br><span class="line">    :param request:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if request.method &#x3D;&#x3D; &quot;GET&quot;:</span><br><span class="line">        return render(request, &#39;login.html&#39;)</span><br><span class="line">    else:</span><br><span class="line">        username &#x3D; request.POST.get(&#39;username&#39;)</span><br><span class="line">        password &#x3D; request.POST.get(&#39;password&#39;)</span><br><span class="line">        obj &#x3D; models.UserInfo.objects.filter(username&#x3D;username, password&#x3D;password).first()</span><br><span class="line">        if obj:</span><br><span class="line">            request.session[&#39;userinfo&#39;] &#x3D; &#123;&#39;username&#39;: obj.username, &#39;is_login&#39;: True&#125;</span><br><span class="line">            return redirect(&#39;index&#39;)</span><br><span class="line">        return render(request, &#39;login.html&#39;, &#123;&#39;msg&#39;: &#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def logout(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    é€€å‡º</span><br><span class="line">    :param request:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if request.method &#x3D;&#x3D; &quot;GET&quot;:</span><br><span class="line">        return redirect(&#39;login&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    é¦–é¡µ</span><br><span class="line">    :param request:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    if request.method &#x3D;&#x3D; &quot;GET&quot;:</span><br><span class="line">        return render(request, &#39;index.html&#39;)</span><br></pre></td></tr></table></figure></li>
<li><p>é¡¹ç›®URL<br>æ­¤æ—¶åœ¨é¡¹ç›®çš„è·¯ç”±ä¸­å·²ç»å­˜åœ¨å¯¹åº”å¢åˆ æ”¹æŸ¥çš„4ä¸ªURLï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># app_nmae åº”ç”¨å</span><br><span class="line"># models_name modelsç±»åå°å†™</span><br><span class="line">arya&#x2F;app_name&#x2F;models_name&#x2F;</span><br><span class="line">arya&#x2F;app_name&#x2F;models_name&#x2F;add&#x2F;</span><br><span class="line">arya&#x2F;app_name&#x2F;models_name&#x2F;(\d+)&#x2F;change&#x2F;</span><br><span class="line">arya&#x2F;app_name&#x2F;models_name&#x2F;(\d+)&#x2F;delete&#x2F;</span><br><span class="line"># åœ¨è¯¥ç¤ºä¾‹ä¸­ä¸º: </span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;arya&#x2F;app01&#x2F;userinfo&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;arya&#x2F;app01&#x2F;userinfo&#x2F;add&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;arya&#x2F;app01&#x2F;userinfo&#x2F;()</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰©å±•<br>åœ¨æ¯ä¸ªappä¸‹é¢çš„arya.pyæ–‡ä»¶ä¸­ç»§æ‰¿aryaç»„ä»¶ä¸­çš„service.v1.AryaConfigç±»ï¼Œè‡ªå·±å†…éƒ¨å®ç°å¤„ç†URLçš„viewä»¥åŠå®šåˆ¶åŒ–æ“ä½œ</p>
<br>  

</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>  è‡³æ­¤ï¼Œè‡ªå®šä¹‰å®ç°çš„ç±»ä¼¼Django adminç»„ä»¶åŸºæœ¬å¼€å‘å®Œæˆï¼Œèƒ½å¤Ÿæ»¡è¶³modelsæ¨¡å‹æ•°æ®çš„CURDæ“ä½œã€‚åœ¨Djangoä¸­ä½œä¸ºappå¼•å…¥CustAdminç»„ä»¶ï¼Œç„¶ååœ¨settingsæ–‡ä»¶ä¸­æ³¨å†Œåå°±<br>å¯ä»¥ç”Ÿæ•ˆä½¿ç”¨äº†,engoy it!</p>
<p><a href="https://github.com/shuke163/CustAdmin" target="_blank" rel="noopener">github</a></p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskä¹‹è·¯-å‰æˆ</title>
    <url>/2020/04/20/Flask%E4%B9%8B%E8%B7%AF-%E5%89%8D%E6%88%8F/</url>
    <content><![CDATA[<h2 id="Flaskä¹‹è·¯-å‰æˆ"><a href="#Flaskä¹‹è·¯-å‰æˆ" class="headerlink" title="Flaskä¹‹è·¯-å‰æˆ"></a>Flaskä¹‹è·¯-å‰æˆ</h2><p>ä»¥ä¸‹å†…å®¹éƒ½æ˜¯å­¦ä¹ Flaskæ¡†æ¶ä¹‹å‰éœ€è¦äº†è§£çš„çŸ¥è¯†ç‚¹,æ•²é»‘æ¿â€¦</p>
<h3 id="ä¸€-Flaskå‰æˆä¹‹è£…é¥°å™¨"><a href="#ä¸€-Flaskå‰æˆä¹‹è£…é¥°å™¨" class="headerlink" title="ä¸€. Flaskå‰æˆä¹‹è£…é¥°å™¨"></a>ä¸€. Flaskå‰æˆä¹‹è£…é¥°å™¨</h3><h4 id="1-1-æ— å‚è£…é¥°å™¨"><a href="#1-1-æ— å‚è£…é¥°å™¨" class="headerlink" title="1.1 æ— å‚è£…é¥°å™¨"></a>1.1 æ— å‚è£…é¥°å™¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;4&#x2F;15</span><br><span class="line"></span><br><span class="line">def wapper(f):</span><br><span class="line">    def inner(*args, **kwargs):</span><br><span class="line">        return f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"># 1. ç«‹å³æ‰§è¡Œwapperå‡½æ•°,å¹¶ä¸”å°†è¢«è£…é¥°çš„å‡½æ•°å½“ä½œå‚æ•°ä¼ é€’</span><br><span class="line"># 2. æ­¤æ—¶çš„func&#x3D;inner</span><br><span class="line">@wapper</span><br><span class="line">def func(arg):</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func(123)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; 123</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>

<h4 id="2-å¸¦å‚æ•°çš„è£…é¥°å™¨"><a href="#2-å¸¦å‚æ•°çš„è£…é¥°å™¨" class="headerlink" title="2. å¸¦å‚æ•°çš„è£…é¥°å™¨"></a>2. å¸¦å‚æ•°çš„è£…é¥°å™¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def outer(num):</span><br><span class="line">    def wapper(f):</span><br><span class="line">        def inner(*args, **kwargs):</span><br><span class="line">            return f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        return inner</span><br><span class="line"></span><br><span class="line">    print(num)</span><br><span class="line">    return wapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># é¦–å…ˆæ‰§è¡Œwapper(666)ï¼Œè·å¾—è¿”å›å€¼;@wapper;æ­¤æ—¶@wapper,å†æ‰§è¡Œwapper(func)å‡½æ•°,è·å¾—è¿”å›å€¼innerï¼Œæ­¤æ—¶:func&#x3D;innerå‡½æ•°</span><br><span class="line">@outer(666)</span><br><span class="line">def func(arg):</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line">func(&#39;Hello&#39;)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">666</span><br><span class="line">Hello</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<h4 id="4-æ‰©å±•"><a href="#4-æ‰©å±•" class="headerlink" title="4. æ‰©å±•"></a>4. æ‰©å±•</h4><p>è¿™é‡Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªfunctoolsæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—æ˜¯å®ƒèƒ½å°†è£…é¥°è¿‡çš„å‡½æ•°çš„ç‰¹æ®Šå±æ€§ä¿ç•™,å¯¹äºè¿™ä¸ªfunctools.wrapsè£…é¥°å™¨ï¼Œç›¸å½“äºwrapper = functools.wraps(func)(wrapper)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import  functools</span><br><span class="line">def wapper(func):</span><br><span class="line">    @functools.wraps(func)</span><br><span class="line">    def inner(*args,**kwargs):</span><br><span class="line">        return func(*args,**kwargs)</span><br><span class="line">    return inner</span><br><span class="line">@wapper</span><br><span class="line">def index():</span><br><span class="line">    print(&quot;hello world ,from index&quot;)</span><br><span class="line">@wapper</span><br><span class="line">def order():</span><br><span class="line">    print(&quot;hell world ,from order&quot;)</span><br><span class="line"></span><br><span class="line">print(index.__name__) </span><br><span class="line">print(order.__name__) </span><br><span class="line">##########  ä½¿ç”¨functools.wraps(å‡½æ•°) #############</span><br><span class="line">index</span><br><span class="line">order</span><br><span class="line">########## ä¸ä½¿ç”¨functools.wraps(å‡½æ•°)#####################</span><br><span class="line">inner</span><br><span class="line">inner</span><br></pre></td></tr></table></figure>
<h3 id="äºŒ-Flaskå‰æˆä¹‹é¢å‘å¯¹è±¡"><a href="#äºŒ-Flaskå‰æˆä¹‹é¢å‘å¯¹è±¡" class="headerlink" title="äºŒ. Flaskå‰æˆä¹‹é¢å‘å¯¹è±¡"></a>äºŒ. Flaskå‰æˆä¹‹é¢å‘å¯¹è±¡</h3><p>é¢å‘å¯¹è±¡3å¤§ç‰¹æ€§: ç»§æ‰¿ å°è£… å¤šæ€</p>
<ul>
<li>ç»§æ‰¿<br>å­ç±»ç»§æ‰¿çˆ¶ç±»<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Parent(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def talk(self):</span><br><span class="line">        print(&quot;Say Hello!&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Child(Parent):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c1 &#x3D; Child()</span><br><span class="line">c1.talk()</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; Say Hello!</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">PS: åœ¨python3.xä¸­ç±»çš„ç»§æ‰¿éµå¾ªå¹¿åº¦ä¼˜å…ˆåŸåˆ™,åœ¨python2.xä¸­éµå¾ªæ·±åº¦ä¼˜å…ˆåŸåˆ™</span><br></pre></td></tr></table></figure></li>
<li>å°è£…<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. ç¤ºä¾‹</span><br><span class="line">class Foo(object):</span><br><span class="line">    def __init__(self, age, name):</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line"># æ­¤å¤„çš„18å’Œ&#39;shuke&#39;è¢«å°è£…åˆ°Fooç±»ä¸­</span><br><span class="line">f1 &#x3D; Foo(18, &#39;shuke&#39;)</span><br><span class="line"></span><br><span class="line">2. ç¤ºä¾‹</span><br><span class="line">class Bar(object):</span><br><span class="line">    def __init__(self, counter, obj):</span><br><span class="line">        self.age &#x3D; counter</span><br><span class="line">        self.obj &#x3D; obj</span><br><span class="line"></span><br><span class="line"># æ­¤å¤„çš„self.objå³ä¸ºFooç±»çš„å¯¹è±¡f1</span><br><span class="line">b1 &#x3D; Bar(1, f1)</span><br><span class="line"></span><br><span class="line">3. ç¤ºä¾‹</span><br><span class="line">class Bar(object):</span><br><span class="line">    def __init__(self, counter):</span><br><span class="line">        self.age &#x3D; counter</span><br><span class="line">        self.obj &#x3D; Foo(18, &#39;shuke&#39;)</span><br><span class="line">        </span><br><span class="line"># æ­¤å¤„çš„self.objå³ä¸ºFooç±»çš„å¯¹è±¡</span><br><span class="line">b1 &#x3D; Bar(1)</span><br></pre></td></tr></table></figure></li>
<li>å¤šæ€<br>é¸­å­æ¨¡å‹</li>
</ul>
<p>PS: ä¸€ä¸ªpyæ–‡ä»¶ä¸­çš„å‡½æ•°å¯ä»¥è¢«å½“ä½œæ¨¡å—å¯¼å…¥,åœ¨å…¶ä»–æ–‡ä»¶ä¸­è°ƒç”¨å³ä¸ºå°è£…æ€æƒ³</p>
<h3 id="ä¸‰-pythonä¸­ä»€ä¹ˆåé¢å¯ä»¥åŠ æ‹¬å·"><a href="#ä¸‰-pythonä¸­ä»€ä¹ˆåé¢å¯ä»¥åŠ æ‹¬å·" class="headerlink" title="ä¸‰. pythonä¸­ä»€ä¹ˆåé¢å¯ä»¥åŠ æ‹¬å·"></a>ä¸‰. pythonä¸­ä»€ä¹ˆåé¢å¯ä»¥åŠ æ‹¬å·</h3><h4 id="3-1-åŸºæœ¬å½¢å¼å¦‚ä¸‹"><a href="#3-1-åŸºæœ¬å½¢å¼å¦‚ä¸‹" class="headerlink" title="3.1 åŸºæœ¬å½¢å¼å¦‚ä¸‹"></a>3.1 åŸºæœ¬å½¢å¼å¦‚ä¸‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def func(arg):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”±äºargåœ¨å‡½æ•°ä¸­åŠ æ‹¬å·ï¼Œæ‰€ä»¥åŸºæœ¬ä¸Šåªæœ‰4ä¸­è¡¨ç°å½¢å¼</span><br><span class="line">    :param arg: </span><br><span class="line">    :return: </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    arg()</span><br></pre></td></tr></table></figure>
<p>a. å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def f1():</span><br><span class="line">    print(&quot;f1&quot;)</span><br><span class="line">    </span><br><span class="line">func(f1)</span><br></pre></td></tr></table></figure>
<p>b. ç±»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo(object):</span><br><span class="line">    pass</span><br><span class="line"># æ‰§è¡Œç±».__init__æ„é€ æ–¹æ³•</span><br><span class="line">func(Foo)</span><br></pre></td></tr></table></figure>
<p>c. æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class F3(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def example(self):</span><br><span class="line">        print(&quot;F3&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj &#x3D; F3()</span><br><span class="line">func(obj.example)</span><br></pre></td></tr></table></figure>
<p>d. å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class F4(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def __call__(self, *args, **kwargs):</span><br><span class="line">        print(&quot;callæ–¹æ³•&quot;)</span><br><span class="line"></span><br><span class="line">obj &#x3D; F4()</span><br><span class="line">obj()</span><br><span class="line">&#39;&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; callæ–¹æ³•</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">func(obj)</span><br></pre></td></tr></table></figure>

<h4 id="å»¶ä¼¸-å‡½æ•°ä¸æ–¹æ³•çš„åŒºåˆ«"><a href="#å»¶ä¼¸-å‡½æ•°ä¸æ–¹æ³•çš„åŒºåˆ«" class="headerlink" title="å»¶ä¼¸(å‡½æ•°ä¸æ–¹æ³•çš„åŒºåˆ«)"></a>å»¶ä¼¸(å‡½æ•°ä¸æ–¹æ³•çš„åŒºåˆ«)</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class F3(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def example(self):</span><br><span class="line">        print(&quot;F3&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj &#x3D; F3()</span><br><span class="line"># æ–¹æ³•</span><br><span class="line">obj.example()</span><br><span class="line"># å‡½æ•°</span><br><span class="line">F3.example</span><br></pre></td></tr></table></figure>
<h4 id="ç§‘å­¦ä¾æ®"><a href="#ç§‘å­¦ä¾æ®" class="headerlink" title="ç§‘å­¦ä¾æ®"></a>ç§‘å­¦ä¾æ®</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from types import MethodType, FunctionType</span><br><span class="line"></span><br><span class="line">class F3(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def example(self):</span><br><span class="line">        print(&quot;F3&quot;)</span><br><span class="line"></span><br><span class="line">ret1 &#x3D; isinstance(F3.example, MethodType)</span><br><span class="line">ret2 &#x3D; isinstance(F3.example, FunctionType)</span><br><span class="line">print(ret1, ret2)</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; False True</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">obj &#x3D; F3()</span><br><span class="line">ret3 &#x3D; isinstance(obj.example, MethodType)</span><br><span class="line">ret4 &#x3D; isinstance(obj.example, FunctionType)</span><br><span class="line">print(ret3, ret4)</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; True False</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Flask</category>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>GitLab è‡ªåŠ¨è§¦å‘ Jenkins æ„å»º</title>
    <url>/2020/04/20/GitLab-%E8%87%AA%E5%8A%A8%E8%A7%A6%E5%8F%91-Jenkins-%E6%9E%84%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="GitLab-è‡ªåŠ¨è§¦å‘-Jenkins-æ„å»º"><a href="#GitLab-è‡ªåŠ¨è§¦å‘-Jenkins-æ„å»º" class="headerlink" title="GitLab è‡ªåŠ¨è§¦å‘ Jenkins æ„å»º"></a>GitLab è‡ªåŠ¨è§¦å‘ Jenkins æ„å»º</h2><p><a href="https://www.wolfcstech.com/2018/03/26/gitlab_trigger_jenkins_build/" target="_blank" rel="noopener">GitLab è‡ªåŠ¨è§¦å‘ Jenkins æ„å»º</a></p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>FlaskçŸ¥è¯†ç‚¹æ€»ç»“</title>
    <url>/2020/04/20/Flask%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<blockquote class="blockquote-center">ä¼˜ç§€çš„äººï¼Œä¸æ˜¯ä¸åˆç¾¤ï¼Œè€Œæ˜¯ä»–ä»¬åˆç¾¤çš„äººé‡Œé¢æ²¡æœ‰ä½ </blockquote>


<h2 id="Python-ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ"><a href="#Python-ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ" class="headerlink" title="Python ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ"></a>Python ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ</h2><p>åœ¨ Python ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½ç›´æ¥ç”¨è‡ªå¸¦çš„ logging æ¨¡å—æ¥è®°å½•æ—¥å¿—ï¼ŒåŒ…æ‹¬æˆ‘ä¹‹å‰çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ã€‚åœ¨ä½¿ç”¨æ—¶æˆ‘ä»¬éœ€è¦é…ç½®ä¸€äº› Handlerã€Formatter æ¥è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚æŠŠæ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ä½ç½®ï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªä¸åŒçš„è¾“å‡ºæ ¼å¼ï¼Œæˆ–è€…è®¾ç½®æ—¥å¿—åˆ†å—å’Œå¤‡ä»½ã€‚ä½†å…¶å®ä¸ªäººæ„Ÿè§‰ logging ç”¨èµ·æ¥å…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ç”¨ï¼Œå…¶å®ä¸»è¦è¿˜æ˜¯é…ç½®è¾ƒä¸ºç¹ç.</p>
<h2 id="å¸¸è§ä½¿ç”¨"><a href="#å¸¸è§ä½¿ç”¨" class="headerlink" title="å¸¸è§ä½¿ç”¨"></a>å¸¸è§ä½¿ç”¨</h2><p>é¦–å…ˆçœ‹çœ‹ logging å¸¸è§çš„è§£å†³æ–¹æ¡ˆå§ï¼Œæˆ‘ä¸€èˆ¬ä¼šé…ç½®è¾“å‡ºåˆ°æ–‡ä»¶ã€æ§åˆ¶å°å’Œ Elasticsearchã€‚è¾“å‡ºåˆ°æ§åˆ¶å°å°±ä»…ä»…æ˜¯æ–¹ä¾¿ç›´æ¥æŸ¥çœ‹çš„ï¼›è¾“å‡ºåˆ°æ–‡ä»¶æ˜¯æ–¹ä¾¿ç›´æ¥å­˜å‚¨ï¼Œä¿ç•™æ‰€æœ‰å†å²è®°å½•çš„å¤‡ä»½ï¼›è¾“å‡ºåˆ° Elasticsearchï¼Œç›´æ¥å°† Elasticsearch ä½œä¸ºå­˜å‚¨å’Œåˆ†æçš„ä¸­å¿ƒï¼Œä½¿ç”¨ Kibana å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ†æå’ŒæŸ¥çœ‹è¿è¡Œæƒ…å†µã€‚<br>æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘åŸºæœ¬ä¼šå¯¹ logging åšå¦‚ä¸‹çš„å°è£…å†™æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mport logging</span><br><span class="line">import sys</span><br><span class="line">from os import makedirs</span><br><span class="line">from os.path import dirname, exists</span><br><span class="line"></span><br><span class="line">from cmreslogging.handlers import CMRESHandler</span><br><span class="line"></span><br><span class="line">loggers &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">LOG_ENABLED &#x3D; True  # æ˜¯å¦å¼€å¯æ—¥å¿—</span><br><span class="line">LOG_TO_CONSOLE &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">LOG_TO_FILE &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ°æ–‡ä»¶</span><br><span class="line">LOG_TO_ES &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ° Elasticsearch</span><br><span class="line"></span><br><span class="line">LOG_PATH &#x3D; &#39;.&#x2F;runtime.log&#39;  # æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line">LOG_LEVEL &#x3D; &#39;DEBUG&#39;  # æ—¥å¿—çº§åˆ«</span><br><span class="line">LOG_FORMAT &#x3D; &#39;%(levelname)s - %(asctime)s - process: %(process)d - %(filename)s - %(name)s - %(lineno)d - %(module)s - %(message)s&#39;  # æ¯æ¡æ—¥å¿—è¾“å‡ºæ ¼å¼</span><br><span class="line">ELASTIC_SEARCH_HOST &#x3D; &#39;eshost&#39;  # Elasticsearch Host</span><br><span class="line">ELASTIC_SEARCH_PORT &#x3D; 9200  # Elasticsearch Port</span><br><span class="line">ELASTIC_SEARCH_INDEX &#x3D; &#39;runtime&#39;  # Elasticsearch Index Name</span><br><span class="line">APP_ENVIRONMENT &#x3D; &#39;dev&#39;  # è¿è¡Œç¯å¢ƒï¼Œå¦‚æµ‹è¯•ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">def get_logger(name&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    get logger by name</span><br><span class="line">    :param name: name of logger</span><br><span class="line">    :return: logger</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    global loggers</span><br><span class="line"></span><br><span class="line">    if not name: name &#x3D; __name__</span><br><span class="line"></span><br><span class="line">    if loggers.get(name):</span><br><span class="line">        return loggers.get(name)</span><br><span class="line"></span><br><span class="line">    logger &#x3D; logging.getLogger(name)</span><br><span class="line">    logger.setLevel(LOG_LEVEL)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">    if LOG_ENABLED and LOG_TO_CONSOLE:</span><br><span class="line">        stream_handler &#x3D; logging.StreamHandler(sys.stdout)</span><br><span class="line">        stream_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        stream_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ°æ–‡ä»¶</span><br><span class="line">    if LOG_ENABLED and LOG_TO_FILE:</span><br><span class="line">        # å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ—¥å¿—æ–‡ä»¶æ–‡ä»¶å¤¹</span><br><span class="line">        log_dir &#x3D; dirname(log_path)</span><br><span class="line">        if not exists(log_dir): makedirs(log_dir)</span><br><span class="line">        # æ·»åŠ  FileHandler</span><br><span class="line">        file_handler &#x3D; logging.FileHandler(log_path, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line">        file_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        file_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ° Elasticsearch</span><br><span class="line">    if LOG_ENABLED and LOG_TO_ES:</span><br><span class="line">        # æ·»åŠ  CMRESHandler</span><br><span class="line">        es_handler &#x3D; CMRESHandler(hosts&#x3D;[&#123;&#39;host&#39;: ELASTIC_SEARCH_HOST, &#39;port&#39;: ELASTIC_SEARCH_PORT&#125;],</span><br><span class="line">                                  # å¯ä»¥é…ç½®å¯¹åº”çš„è®¤è¯æƒé™</span><br><span class="line">                                  auth_type&#x3D;CMRESHandler.AuthType.NO_AUTH,  </span><br><span class="line">                                  es_index_name&#x3D;ELASTIC_SEARCH_INDEX,</span><br><span class="line">                                  # ä¸€ä¸ªæœˆåˆ†ä¸€ä¸ª Index</span><br><span class="line">                                  index_name_frequency&#x3D;CMRESHandler.IndexNameFrequency.MONTHLY,</span><br><span class="line">                                  # é¢å¤–å¢åŠ ç¯å¢ƒæ ‡è¯†</span><br><span class="line">                                  es_additional_fields&#x3D;&#123;&#39;environment&#39;: APP_ENVIRONMENT&#125;  </span><br><span class="line">                                  )</span><br><span class="line">        es_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        es_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(es_handler)</span><br><span class="line"></span><br><span class="line">    # ä¿å­˜åˆ°å…¨å±€ loggers</span><br><span class="line">    loggers[name] &#x3D; logger</span><br><span class="line">    return logger</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰å®Œäº†æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿåªéœ€è¦ä½¿ç”¨å®šä¹‰çš„æ–¹æ³•è·å–ä¸€ä¸ª loggerï¼Œç„¶å log å¯¹åº”çš„å†…å®¹å³å¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger &#x3D; get_logger()</span><br><span class="line">logger.debug(&#39;this is a message&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEBUG - 2019-10-11 22:27:35,923 - process: 99490 - logger.py - __main__ - 81 - logger - this is a message</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå®šä¹‰çš„åŸºæœ¬å®ç°å§ã€‚é¦–å…ˆè¿™é‡Œä¸€äº›å¸¸é‡æ˜¯ç”¨æ¥å®šä¹‰ <code>logging</code> æ¨¡å—çš„ä¸€äº›åŸºæœ¬å±æ€§çš„ï¼Œæ¯”å¦‚ LOG_ENABLED ä»£è¡¨æ˜¯å¦å¼€å¯æ—¥å¿—åŠŸèƒ½ï¼Œ<code>LOG_TO_E</code>S ä»£è¡¨æ˜¯å¦å°†æ—¥å¿—è¾“å‡ºåˆ° Elasticsearchï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ—¥å¿—åŸºæœ¬é…ç½®ï¼Œå¦‚ <code>LOG_FORMAT</code> é…ç½®äº†æ—¥å¿—æ¯ä¸ªæ¡ç›®è¾“å‡ºçš„åŸºæœ¬æ ¼å¼ï¼Œå¦å¤–è¿˜æœ‰ä¸€äº›è¿æ¥çš„å¿…è¦ä¿¡æ¯ã€‚è¿™äº›å˜é‡å¯ä»¥å’Œè¿è¡Œæ—¶çš„å‘½ä»¤è¡Œæˆ–ç¯å¢ƒå˜é‡å¯¹æ¥èµ·æ¥ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°ä¸€äº›å¼€å…³å’Œé…ç½®çš„æ›´æ¢ã€‚</p>
<p>ç„¶åå®šä¹‰äº†è¿™ä¹ˆä¸€ä¸ª <code>get_logger</code> æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•° nameã€‚é¦–å…ˆè¯¥æ–¹æ³•æ‹¿åˆ° name ä¹‹åï¼Œä¼šåˆ°å…¨å±€çš„ loggers å˜é‡é‡Œé¢æŸ¥æ‰¾ï¼Œloggers å˜é‡æ˜¯ä¸€ä¸ªå…¨å±€å­—å…¸ï¼Œå¦‚æœæœ‰å·²ç»å£°æ˜è¿‡çš„ loggerï¼Œç›´æ¥å°†å…¶è·å–è¿”å›å³å¯ï¼Œä¸ç”¨å†å°†å…¶äºŒæ¬¡åˆå§‹åŒ–ã€‚å¦‚æœ loggers é‡Œé¢æ²¡æœ‰æ‰¾åˆ° name å¯¹åº”çš„ loggerï¼Œé‚£å°±è¿›è¡Œåˆ›å»ºå³å¯ã€‚åˆ›å»º logger ä¹‹åï¼Œå¯ä»¥ä¸ºå…¶æ·»åŠ å„ç§å¯¹åº”çš„ Handlerï¼Œå¦‚è¾“å‡ºåˆ°æ§åˆ¶å°å°±ç”¨ StreamHandlerï¼Œè¾“å‡ºåˆ°æ–‡ä»¶å°±ç”¨ FileHandler æˆ– RotatingFileHandlerï¼Œè¾“å‡ºåˆ° Elasticsearch å°±ç”¨ CMRESHandlerï¼Œåˆ†åˆ«é…ç½®å¥½å¯¹åº”çš„ä¿¡æ¯å³å¯ã€‚</p>
<p>æœ€åå‘¢ï¼Œå°†æ–°å»ºçš„ logger ä¿å­˜åˆ°å…¨å±€çš„ loggers é‡Œé¢å¹¶è¿”å›å³å¯ï¼Œè¿™æ ·å¦‚æœæœ‰åŒåçš„ logger ä¾¿å¯ä»¥ç›´æ¥æŸ¥æ‰¾ loggers ç›´æ¥è¿”å›äº†ã€‚<br>åœ¨è¿™é‡Œä¾èµ–äº†é¢å¤–çš„è¾“å‡ºåˆ° Elasticsearch çš„åŒ…ï¼Œå«åš CMRESHandlerï¼Œå®ƒå¯ä»¥æ”¯æŒå°†æ—¥å¿—è¾“å‡ºåˆ° Elasticsearch é‡Œé¢ï¼Œå¦‚æœè¦ä½¿ç”¨çš„è¯å¯ä»¥å®‰è£…ä¸€ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install CMRESHandler</span><br></pre></td></tr></table></figure>
<p>å…¶ GitHub åœ°å€æ˜¯ï¼š<code>https://github.com/cmanaha/python-elasticsearch-logger</code>ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹çœ‹å®ƒçš„å®˜æ–¹è¯´æ˜ï¼Œå¦‚é…ç½®è®¤è¯ä¿¡æ¯ï¼Œé…ç½® Index åˆ†éš”ä¿¡æ¯ç­‰ç­‰ã€‚<br>å¥½ï¼Œä¸Šé¢å°±æ˜¯æˆ‘ä¹‹å‰å¸¸ç”¨çš„ logging é…ç½®ï¼Œé€šè¿‡å¦‚ä¸Šçš„é…ç½®ï¼Œæˆ‘å°±å¯ä»¥å®ç°å°† logging è¾“å‡ºåˆ°ä¸‰ä¸ªä½ç½®ï¼Œå¹¶å¯ä»¥å®ç°å¯¹åº”çš„æ•ˆæœã€‚æ¯”å¦‚è¾“å‡ºåˆ° Elasticsearch ä¹‹åï¼Œæˆ‘å°±å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ Kibana æ¥æŸ¥çœ‹å½“å‰è¿è¡Œæƒ…å†µï¼ŒERROR Log çš„æ¯”ä¾‹ç­‰ç­‰.<br>ä¹Ÿå¯ä»¥åœ¨å®ƒçš„åŸºç¡€ä¸Šåšæ›´è¿›ä¸€æ­¥çš„ç»Ÿè®¡åˆ†æ.</p>
<h2 id="loguru"><a href="#loguru" class="headerlink" title="loguru"></a>loguru</h2><p>ä¸Šé¢çš„å®ç°æ–¹å¼å·²ç»æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¯è¡Œçš„é…ç½®æ–¹æ¡ˆäº†ã€‚ç„¶è€Œï¼Œæˆ‘è¿˜æ˜¯ä¼šæ„Ÿè§‰åˆ°æœ‰äº› Handler é…èµ·æ¥éº»çƒ¦ï¼Œå°¤å…¶æ˜¯æ–°å»ºä¸€ä¸ªé¡¹ç›®çš„å¾ˆå¤šæ—¶å€™æ‡’å¾—å»å†™ä¸€äº›é…ç½®ã€‚å³ä½¿æ˜¯ä¸ç”¨ä¸Šæ–‡çš„é…ç½®ï¼Œç”¨æœ€åŸºæœ¬çš„å‡ è¡Œ logging é…ç½®ï¼Œåƒå¦‚ä¸‹çš„é€šç”¨é…ç½®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import logging</span><br><span class="line">logging.basicConfig(level &#x3D; logging.INFO,format &#x3D; &#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;)</span><br><span class="line">logger &#x3D; logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä¹Ÿæ‡’å¾—å»å†™ï¼Œæ„Ÿè§‰å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„å®ç°æ–¹å¼ã€‚<br>æœ‰éœ€æ±‚å°±æœ‰åŠ¨åŠ›å•Šï¼Œè¿™ä¸ï¼Œå°±æœ‰äººå®ç°äº†è¿™ä¹ˆä¸€ä¸ªåº“ï¼Œå«åš loguruï¼Œå¯ä»¥å°† log çš„é…ç½®å’Œä½¿ç”¨æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ã€‚<br>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„å§.</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆï¼Œè¿™ä¸ªåº“çš„å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œå°±ç”¨åŸºæœ¬çš„ pip å®‰è£…å³å¯ï¼ŒPython 3 ç‰ˆæœ¬çš„å®‰è£…å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install loguru</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®é‡Œä½¿ç”¨è¿™ä¸ª loguru åº“äº†.</p>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>é‚£ä¹ˆè¿™ä¸ªåº“æ€ä¹ˆæ¥ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªå®ä¾‹æ„Ÿå—ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">logger.debug(&#39;this is a debug message&#39;)</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å§ï¼Œä¸éœ€è¦é…ç½®ä»€ä¹ˆä¸œè¥¿ï¼Œç›´æ¥å¼•å…¥ä¸€ä¸ª loggerï¼Œç„¶åè°ƒç”¨å…¶ debug æ–¹æ³•å³å¯ã€‚</p>
<p>åœ¨ loguru é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä¸»è¦å¯¹è±¡ï¼Œé‚£å°±æ˜¯ loggerï¼Œloguru é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª loggerï¼Œè€Œä¸”å®ƒå·²ç»è¢«æå‰é…ç½®äº†ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯”è¾ƒå‹å¥½çš„æ ¼å¼åŒ–ã€æ–‡æœ¬é¢œè‰²ä¿¡æ¯ç­‰ç­‰ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-10-13 22:46:12.367 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å…¶é»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯ä¸Šé¢çš„å†…å®¹ï¼Œæœ‰æ—¶é—´ã€çº§åˆ«ã€æ¨¡å—åã€è¡Œå·ä»¥åŠæ—¥å¿—ä¿¡æ¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º loggerï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼Œå¦å¤–å…¶è¾“å‡ºè¿˜æ˜¯å½©è‰²çš„ï¼Œçœ‹èµ·æ¥ä¼šæ›´åŠ å‹å¥½ã€‚</p>
<p>ä»¥ä¸Šçš„æ—¥å¿—ä¿¡æ¯æ˜¯ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°çš„ï¼Œå¹¶æ²¡æœ‰è¾“å‡ºåˆ°å…¶ä»–çš„åœ°æ–¹ï¼Œå¦‚æœæƒ³è¦è¾“å‡ºåˆ°å…¶ä»–çš„ä½ç½®ï¼Œæ¯”å¦‚å­˜ä¸ºæ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€è¡Œä»£ç å£°æ˜å³å¯ã€‚</p>
<p>ä¾‹å¦‚å°†ç»“æœåŒæ—¶è¾“å‡ºåˆ°ä¸€ä¸ª runtime.log æ–‡ä»¶é‡Œé¢ï¼Œå¯ä»¥è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">logger.add(&#39;runtime.log&#39;)</span><br><span class="line">logger.debug(&#39;this is a debug&#39;)</span><br></pre></td></tr></table></figure>
<p>å¾ˆç®€å•å§ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å†å£°æ˜ä¸€ä¸ª FileHandler äº†ï¼Œå°±ä¸€è¡Œ add è¯­å¥æå®šï¼Œè¿è¡Œä¹‹åä¼šå‘ç°ç›®å½•ä¸‹ runtime.log é‡Œé¢åŒæ ·å‡ºç°äº†åˆšåˆšæ§åˆ¶å°è¾“å‡ºçš„ DEBUG ä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢å°±æ˜¯ä¸€äº›åŸºæœ¬çš„ä½¿ç”¨ï¼Œä½†è¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸‹å®ƒçš„ä¸€äº›åŠŸèƒ½æ¨¡å—.</p>
<h2 id="è¯¦ç»†ä½¿ç”¨"><a href="#è¯¦ç»†ä½¿ç”¨" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h2><p>æ—¢ç„¶æ˜¯æ—¥å¿—ï¼Œé‚£ä¹ˆæœ€å¸¸è§çš„å°±æ˜¯è¾“å‡ºåˆ°æ–‡ä»¶äº†ã€‚loguru å¯¹è¾“å‡ºåˆ°æ–‡ä»¶çš„é…ç½®æœ‰éå¸¸å¼ºå¤§çš„æ”¯æŒï¼Œæ¯”å¦‚æ”¯æŒè¾“å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ï¼Œåˆ†çº§åˆ«åˆ†åˆ«è¾“å‡ºï¼Œè¿‡å¤§åˆ›å»ºæ–°æ–‡ä»¶ï¼Œè¿‡ä¹…è‡ªåŠ¨åˆ é™¤ç­‰ç­‰ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹è¿™äº›æ€æ ·æ¥å®ç°ï¼Œè¿™é‡ŒåŸºæœ¬ä¸Šå°±æ˜¯ add æ–¹æ³•çš„ä½¿ç”¨ä»‹ç»ã€‚å› ä¸ºè¿™ä¸ª add æ–¹æ³•å°±ç›¸å½“äºç»™ logger æ·»åŠ äº†ä¸€ä¸ª Handlerï¼Œå®ƒç»™æˆ‘ä»¬æš´éœ²äº†è®¸å¤šå‚æ•°æ¥å®ç° Handler çš„é…ç½®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚<br>é¦–å…ˆçœ‹çœ‹å®ƒçš„æ–¹æ³•å®šä¹‰å§:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def add(</span><br><span class="line">        self,</span><br><span class="line">        sink,</span><br><span class="line">        *,</span><br><span class="line">        level&#x3D;_defaults.LOGURU_LEVEL,</span><br><span class="line">        format&#x3D;_defaults.LOGURU_FORMAT,</span><br><span class="line">        filter&#x3D;_defaults.LOGURU_FILTER,</span><br><span class="line">        colorize&#x3D;_defaults.LOGURU_COLORIZE,</span><br><span class="line">        serialize&#x3D;_defaults.LOGURU_SERIALIZE,</span><br><span class="line">        backtrace&#x3D;_defaults.LOGURU_BACKTRACE,</span><br><span class="line">        diagnose&#x3D;_defaults.LOGURU_DIAGNOSE,</span><br><span class="line">        enqueue&#x3D;_defaults.LOGURU_ENQUEUE,</span><br><span class="line">        catch&#x3D;_defaults.LOGURU_CATCH,</span><br><span class="line">        **kwargs</span><br><span class="line">    ):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>çœ‹çœ‹å®ƒçš„æºä»£ç ï¼Œå®ƒæ”¯æŒè¿™ä¹ˆå¤šçš„å‚æ•°ï¼Œå¦‚ levelã€formatã€filterã€color ç­‰ç­‰ã€‚</p>
<blockquote>
<p>sink<br>å¦å¤–æˆ‘ä»¬è¿˜æ³¨æ„åˆ°å®ƒæœ‰ä¸ªéå¸¸é‡è¦çš„å‚æ•° sinkï¼Œæˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<code>https://loguru.readthedocs.io/en/stable/api/logger.html#sink</code>ï¼Œå¯ä»¥äº†è§£åˆ°é€šè¿‡ sink æˆ‘ä»¬å¯ä»¥ä¼ å…¥å¤šç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œæ±‡æ€»å¦‚ä¸‹:</p>
</blockquote>
<ul>
<li>sink å¯ä»¥ä¼ å…¥ä¸€ä¸ª file å¯¹è±¡ï¼Œä¾‹å¦‚ sys.stderr æˆ–è€… open(â€˜file.logâ€™, â€˜wâ€™) éƒ½å¯ä»¥ã€‚</li>
<li>sink å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ª str å­—ç¬¦ä¸²æˆ–è€… pathlib.Path å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä»£è¡¨æ–‡ä»¶è·¯å¾„çš„ï¼Œå¦‚æœè¯†åˆ«åˆ°æ˜¯è¿™ç§ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”è·¯å¾„çš„æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—è¾“å‡ºè¿›å»ã€‚</li>
<li>sink å¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰è¾“å‡ºå®ç°ã€‚</li>
<li>sink å¯ä»¥æ˜¯ä¸€ä¸ª logging æ¨¡å—çš„ Handlerï¼Œæ¯”å¦‚ FileHandlerã€StreamHandler ç­‰ç­‰ï¼Œæˆ–è€…ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°çš„ CMRESHandler ç…§æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°è‡ªå®šä¹‰ Handler çš„é…ç½®ã€‚</li>
<li>sink è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œå…·ä½“çš„å®ç°è§„èŒƒå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£.<br>æ‰€ä»¥è¯´ï¼Œåˆšæ‰æˆ‘ä»¬æ‰€æ¼”ç¤ºçš„è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä»…ä»…ç»™å®ƒä¼ äº†ä¸€ä¸ª str å­—ç¬¦ä¸²è·¯å¾„ï¼Œä»–å°±ç»™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå°±æ˜¯è¿™ä¸ªåŸç†ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>format, filter, level<br>ä¸‹é¢æˆ‘ä»¬å†äº†è§£ä¸‹å®ƒçš„å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚ formatã€filterã€level ç­‰ç­‰ã€‚<br>å…¶å®å®ƒä»¬çš„æ¦‚å¿µå’Œæ ¼å¼å’Œ logging æ¨¡å—éƒ½æ˜¯åŸºæœ¬ä¸€æ ·çš„äº†ï¼Œä¾‹å¦‚è¿™é‡Œä½¿ç”¨ formatã€filterã€level æ¥è§„å®šè¾“å‡ºçš„æ ¼å¼:</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, format&#x3D;&quot;&#123;time&#125; &#123;level&#125; &#123;message&#125;&quot;, filter&#x3D;&quot;my_module&quot;, level&#x3D;&quot;INFO&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ é™¤sink<br>å¦å¤–æ·»åŠ  sink ä¹‹åæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œåˆ é™¤ï¼Œç›¸å½“äºé‡æ–°åˆ·æ–°å¹¶å†™å…¥æ–°çš„å†…å®¹ã€‚<br>åˆ é™¤çš„æ—¶å€™æ ¹æ®åˆšåˆš add æ–¹æ³•è¿”å›çš„ id è¿›è¡Œåˆ é™¤å³å¯ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">trace &#x3D; logger.add(&#39;runtime.log&#39;)</span><br><span class="line">logger.debug(&#39;this is a debug message&#39;)</span><br><span class="line">logger.remove(trace)</span><br><span class="line">logger.debug(&#39;this is another debug message&#39;)</span><br></pre></td></tr></table></figure>
<p>çœ‹è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆ add äº†ä¸€ä¸ª sinkï¼Œç„¶åè·å–å®ƒçš„è¿”å›å€¼ï¼Œèµ‹å€¼ä¸º traceã€‚éšåè¾“å‡ºäº†ä¸€æ¡æ—¥å¿—ï¼Œç„¶åå°† trace å˜é‡ä¼ ç»™ remove æ–¹æ³•ï¼Œå†æ¬¡è¾“å‡ºä¸€æ¡æ—¥å¿—ï¼Œçœ‹çœ‹ç»“æœæ˜¯æ€æ ·çš„ã€‚<br>æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br><span class="line">2019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:6 - this is another debug message</span><br></pre></td></tr></table></figure>
<p>æ—¥å¿—æ–‡ä»¶ runtime.log å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨ remove æ–¹æ³•ä¹‹åï¼Œç¡®å®å°†å†å² log åˆ é™¤äº†ã€‚<br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°æ—¥å¿—çš„åˆ·æ–°é‡æ–°å†™å…¥æ“ä½œã€‚</p>
<blockquote>
<p>rotation é…ç½®<br>ç”¨äº† loguru æˆ‘ä»¬è¿˜å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ rotation é…ç½®ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ä¸€å¤©è¾“å‡ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæˆ–è€…æ–‡ä»¶å¤ªå¤§äº†è‡ªåŠ¨åˆ†éš”æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ add æ–¹æ³•çš„ rotation å‚æ•°è¿›è¡Œé…ç½®ã€‚<br>æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&quot;500 MB&quot;)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„é…ç½®æˆ‘ä»¬å°±å¯ä»¥å®ç°æ¯ 500MB å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ª log æ–‡ä»¶è¿‡å¤§å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨é…ç½® log åå­—æ—¶åŠ ä¸Šäº†ä¸€ä¸ª time å ä½ç¬¦ï¼Œè¿™æ ·åœ¨ç”Ÿæˆæ—¶å¯ä»¥è‡ªåŠ¨å°†æ—¶é—´æ›¿æ¢è¿›å»ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ååŒ…å«æ—¶é—´çš„ log æ–‡ä»¶ã€‚<br>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ rotation å‚æ•°å®ç°å®šæ—¶åˆ›å»º log æ–‡ä»¶ï¼Œä¾‹å¦‚:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&#39;00:00&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥å®ç°æ¯å¤© 0 ç‚¹æ–°åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶è¾“å‡ºäº†ã€‚<br>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® log æ–‡ä»¶çš„å¾ªç¯æ—¶é—´ï¼Œæ¯”å¦‚æ¯éš”ä¸€å‘¨åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶ï¼Œå†™æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&#39;1 week&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€å‘¨åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶äº†ã€‚</p>
<blockquote>
<p>retention é…ç½®<br>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€äº›éå¸¸ä¹…è¿œçš„ log å¯¹æˆ‘ä»¬æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„äº†ï¼Œå®ƒç™½ç™½å æ®äº†ä¸€äº›å­˜å‚¨ç©ºé—´ï¼Œä¸æ¸…é™¤æ‰å°±ä¼šéå¸¸æµªè´¹ã€‚retention è¿™ä¸ªå‚æ•°å¯ä»¥é…ç½®æ—¥å¿—çš„æœ€é•¿ä¿ç•™æ—¶é—´ã€‚<br>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®¾ç½®æ—¥å¿—æ–‡ä»¶æœ€é•¿ä¿ç•™ 10 å¤©ï¼Œå¯ä»¥è¿™ä¹ˆæ¥é…ç½®:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, retention&#x3D;&#39;10 days&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ · log æ–‡ä»¶é‡Œé¢å°±ä¼šä¿ç•™æœ€æ–° 10 å¤©çš„ logï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒ log æ²‰ç§¯çš„é—®é¢˜å•¦ã€‚</p>
<blockquote>
<p>compression é…ç½®<br>loguru è¿˜å¯ä»¥é…ç½®æ–‡ä»¶çš„å‹ç¼©æ ¼å¼ï¼Œæ¯”å¦‚ä½¿ç”¨ zip æ–‡ä»¶æ ¼å¼ä¿å­˜ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, compression&#x3D;&#39;zip&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥æ›´åŠ èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p>
<blockquote>
<p>å­—ç¬¦ä¸²æ ¼å¼åŒ–<br>loguru åœ¨è¾“å‡º log çš„æ—¶å€™è¿˜æä¾›äº†éå¸¸å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½ï¼Œåƒè¿™æ ·:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.info(&#39;If you are using Python &#123;&#125;, prefer &#123;feature&#125; of course!&#39;, 3.6, feature&#x3D;&#39;f-strings&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨æ·»åŠ å‚æ•°å°±éå¸¸æ–¹ä¾¿äº†ã€‚</p>
<blockquote>
<p>Traceback è®°å½•<br>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¦‚æœé‡åˆ°è¿è¡Œé”™è¯¯ï¼Œè€Œæˆ‘ä»¬åœ¨æ‰“å°è¾“å‡º log çš„æ—¶å€™ä¸‡ä¸€ä¸å°å¿ƒæ²¡æœ‰é…ç½®å¥½ Traceback çš„è¾“å‡ºï¼Œå¾ˆæœ‰å¯èƒ½æˆ‘ä»¬å°±æ²¡æ³•è¿½è¸ªé”™è¯¯æ‰€åœ¨äº†ã€‚<br>ä½†ç”¨äº† loguru ä¹‹åï¼Œæˆ‘ä»¬ç”¨å®ƒæä¾›çš„è£…é¥°å™¨å°±å¯ä»¥ç›´æ¥è¿›è¡Œ Traceback çš„è®°å½•ï¼Œç±»ä¼¼è¿™æ ·çš„é…ç½®å³å¯:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@logger.catch</span><br><span class="line">def my_function(x, y, z):</span><br><span class="line">    # An error? It&#39;s caught anyway!</span><br><span class="line">    return 1 &#x2F; (x + y + z)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åšä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¸‰ä¸ªå‚æ•°éƒ½ä¼ å…¥ 0ï¼Œç›´æ¥å¼•å‘é™¤ä»¥ 0 çš„é”™è¯¯ï¼Œçœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">my_function(0, 0, 0)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå¯ä»¥å‘ç° log é‡Œé¢å°±å‡ºç°äº† Traceback ä¿¡æ¯ï¼Œè€Œä¸”ç»™æˆ‘ä»¬è¾“å‡ºäº†å½“æ—¶çš„å˜é‡å€¼ï¼ŒçœŸçš„æ˜¯ä¸èƒ½å†èµäº†ï¼ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; File &quot;run.py&quot;, line 15, in &lt;module&gt;</span><br><span class="line">    my_function(0, 0, 0)</span><br><span class="line">    â”” &lt;function my_function at 0x1171dd510&gt;</span><br><span class="line"></span><br><span class="line">  File &quot;&#x2F;private&#x2F;var&#x2F;py&#x2F;logurutest&#x2F;demo5.py&quot;, line 13, in my_function</span><br><span class="line">    return 1 &#x2F; (x + y + z)</span><br><span class="line">                â”‚   â”‚   â”” 0</span><br><span class="line">                â”‚   â”” 0</span><br><span class="line">                â”” 0</span><br><span class="line"></span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œç”¨ loguru å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°æ—¥å¿—è¿½è¸ªï¼Œdebug æ•ˆç‡å¯èƒ½è¦é«˜ä¸Šåå€äº†ï¼Ÿ<br>å¦å¤– loguru è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€å±•å¼€è®²è§£äº†ï¼Œæ›´å¤šçš„å†…å®¹å¤§å®¶å¯ä»¥çœ‹çœ‹ loguru çš„å®˜æ–¹æ–‡æ¡£è¯¦ç»†äº†è§£ä¸€ä¸‹ï¼š<code>https://loguru.readthedocs.io/en/stable/index.html</code><br>çœ‹å®Œä¹‹åï¼Œæ˜¯æ—¶å€™æŠŠè‡ªå·±çš„ logging æ¨¡å—æ›¿æ¢æˆ loguru å•¦ï¼</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Flaskä¹‹è·¯(ä¸€)</title>
    <url>/2020/04/20/Flask%E4%B9%8B%E8%B7%AF-%E4%B8%80/</url>
    <content><![CDATA[<h2 id="Flaskä¹‹è·¯-ä¸€"><a href="#Flaskä¹‹è·¯-ä¸€" class="headerlink" title="Flaskä¹‹è·¯(ä¸€)"></a>Flaskä¹‹è·¯(ä¸€)</h2><h3 id="ä¸€-ç®€ä»‹"><a href="#ä¸€-ç®€ä»‹" class="headerlink" title="ä¸€. ç®€ä»‹"></a>ä¸€. ç®€ä»‹</h3><p>Flaskæ˜¯ä¸€ä¸ªåŸºäºPythonå¼€å‘å¹¶ä¸”ä¾èµ–jinja2æ¨¡æ¿å’ŒWerkzeug WSGIæœåŠ¡çš„ä¸€ä¸ªå¾®å‹æ¡†æ¶ï¼Œå¯¹äºWerkzeugæœ¬è´¨æ˜¯SocketæœåŠ¡ç«¯ï¼Œå…¶ç”¨äºæ¥æ”¶httpè¯·æ±‚å¹¶å¯¹è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œç„¶åè§¦å‘Flaskæ¡†æ¶ï¼Œå¼€å‘äººå‘˜åŸºäºFlaskæ¡†æ¶æä¾›çš„åŠŸèƒ½å¯¹è¯·æ±‚è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ï¼Œå¦‚æœè¦è¿”å›ç»™ç”¨æˆ·å¤æ‚çš„å†…å®¹æ—¶ï¼Œéœ€è¦å€ŸåŠ©jinja2æ¨¡æ¿æ¥å®ç°å¯¹æ¨¡æ¿çš„å¤„ç†ï¼Œå³ï¼šå°†æ¨¡æ¿å’Œæ•°æ®è¿›è¡Œæ¸²æŸ“ï¼Œå°†æ¸²æŸ“åçš„å­—ç¬¦ä¸²è¿”å›ç»™ç”¨æˆ·æµè§ˆå™¨ã€‚</p>
<p>â€œå¾®â€(micro) å¹¶ä¸è¡¨ç¤ºä½ éœ€è¦æŠŠæ•´ä¸ª Web åº”ç”¨å¡è¿›å•ä¸ª Python æ–‡ä»¶ï¼ˆè™½ç„¶ç¡®å®å¯ä»¥ ï¼‰ï¼Œä¹Ÿä¸æ„å‘³ç€ Flask åœ¨åŠŸèƒ½ä¸Šæœ‰æ‰€æ¬ ç¼ºã€‚å¾®æ¡†æ¶ä¸­çš„â€œå¾®â€æ„å‘³ç€ Flask æ—¨åœ¨ä¿æŒæ ¸å¿ƒç®€å•è€Œæ˜“äºæ‰©å±•ã€‚Flask ä¸ä¼šæ›¿ä½ åšå‡ºå¤ªå¤šå†³ç­–â€”â€”æ¯”å¦‚ä½¿ç”¨ä½•ç§æ•°æ®åº“ã€‚è€Œé‚£äº› Flask æ‰€é€‰æ‹©çš„â€”â€”æ¯”å¦‚ä½¿ç”¨ä½•ç§æ¨¡æ¿å¼•æ“â€”â€”åˆ™å¾ˆå®¹æ˜“æ›¿æ¢ã€‚é™¤æ­¤ä¹‹å¤–çš„ä¸€åˆ‡éƒ½ç”±å¯ç”±ä½ æŒæ¡ã€‚å¦‚æ­¤ï¼ŒFlask å¯ä»¥ä¸æ‚¨ç è”ç’§åˆã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlask ä¸åŒ…å«æ•°æ®åº“æŠ½è±¡å±‚ã€è¡¨å•éªŒè¯ï¼Œæˆ–æ˜¯å…¶å®ƒä»»ä½•å·²æœ‰å¤šç§åº“å¯ä»¥èƒœä»»çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼ŒFlask æ”¯æŒç”¨æ‰©å±•æ¥ç»™åº”ç”¨æ·»åŠ è¿™äº›åŠŸèƒ½ï¼Œå¦‚åŒæ˜¯ Flask æœ¬èº«å®ç°çš„ä¸€æ ·ã€‚ä¼—å¤šçš„æ‰©å±•æä¾›äº†æ•°æ®åº“é›†æˆã€è¡¨å•éªŒè¯ã€ä¸Šä¼ å¤„ç†ã€å„ç§å„æ ·çš„å¼€æ”¾è®¤è¯æŠ€æœ¯ç­‰åŠŸèƒ½ã€‚Flask ä¹Ÿè®¸æ˜¯â€œå¾®å°â€çš„ï¼Œä½†å®ƒå·²å‡†å¤‡å¥½åœ¨éœ€æ±‚ç¹æ‚çš„ç”Ÿäº§ç¯å¢ƒä¸­æŠ•å…¥ä½¿ç”¨ã€‚</p>
<h4 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install flask</span><br></pre></td></tr></table></figure>
<h4 id="2-WSGIå®ç°åŸç†"><a href="#2-WSGIå®ç°åŸç†" class="headerlink" title="2. WSGIå®ç°åŸç†"></a>2. WSGIå®ç°åŸç†</h4><p>Flaskä¾èµ–werkzeugæ¨¡å—å®ç°äº†WSGiåè®®,ç›‘å¬socketçš„è¯·æ±‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from werkzeug.wrappers import Request, Response</span><br><span class="line"></span><br><span class="line">@Request.application</span><br><span class="line">def hello(request):</span><br><span class="line">    return Response(&#39;Hello World!&#39;)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    from werkzeug.serving import run_simple</span><br><span class="line">    run_simple(&#39;localhost&#39;, 4000, hello)</span><br><span class="line"></span><br><span class="line">werkzeug</span><br></pre></td></tr></table></figure>

<h4 id="3-åŸºæœ¬ä½¿ç”¨"><a href="#3-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3. åŸºæœ¬ä½¿ç”¨"></a>3. åŸºæœ¬ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def hello_world():</span><br><span class="line">    return &#39;Hello World!&#39;</span><br><span class="line">    </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>



<h3 id="äºŒ-è·¯ç”±ç³»ç»Ÿæºç åˆ†æ"><a href="#äºŒ-è·¯ç”±ç³»ç»Ÿæºç åˆ†æ" class="headerlink" title="äºŒ. è·¯ç”±ç³»ç»Ÿæºç åˆ†æ"></a>äºŒ. è·¯ç”±ç³»ç»Ÿæºç åˆ†æ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">def index():</span><br><span class="line">    return &#39;Hello World!!&#39;</span><br><span class="line"></span><br><span class="line"># appå¯¹è±¡çš„runæ–¹æ³•ä¸­,self.add_url_rule(rule, endpoint, f, **options)</span><br><span class="line"># æ­¤å¤„çš„ruleæ˜¯è¯·æ±‚çš„uriè·¯å¾„ï¼Œendpointç±»ä¼¼äºDjangoä¸­è·¯ç”±ç³»ç»Ÿçš„nameå‚æ•°ï¼Œç”¨äºåå‘ç”ŸæˆURL,å‚æ•°fä¸ºè§¦å‘æ‰§è¡Œçš„å‡½æ•°fun,æ­¤å¤„ä¹Ÿå¯ä»¥æ˜¯classå¯¹è±¡ï¼Œä¼šè§¦å‘å¯¹è±¡çš„__call__æ–¹æ³•</span><br><span class="line">app.add_url_rule(&#39;&#x2F;index&#39;, &#39;index&#39;, index)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    # 1. è¯·æ±‚è¿›æ¥é¦–å…ˆä¼šè§¦å‘run_simpleå‡½æ•°è¿è¡Œ,åŒæ—¶æ‰§è¡Œapp.__call__æ–¹æ³•</span><br><span class="line">    # å°è£…è¯·æ±‚</span><br><span class="line">    # è·¯ç”±åŒ¹é…</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰-Flaskçš„è£…é¥°å™¨"><a href="#ä¸‰-Flaskçš„è£…é¥°å™¨" class="headerlink" title="ä¸‰. Flaskçš„è£…é¥°å™¨"></a>ä¸‰. Flaskçš„è£…é¥°å™¨</h3><h4 id="3-1-è£…é¥°å™¨"><a href="#3-1-è£…é¥°å™¨" class="headerlink" title="3.1 è£…é¥°å™¨"></a>3.1 è£…é¥°å™¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;4&#x2F;15</span><br><span class="line"></span><br><span class="line"># 1. æ— å‚è£…é¥°å™¨</span><br><span class="line">def wapper(f):</span><br><span class="line">    def inner(*args, **kwargs):</span><br><span class="line">        return f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"># 1. ç«‹å³æ‰§è¡Œwapperå‡½æ•°,å¹¶ä¸”å°†è¢«è£…é¥°çš„å‡½æ•°å½“ä½œå‚æ•°ä¼ é€’</span><br><span class="line"># 2. æ­¤æ—¶çš„func&#x3D;inner</span><br><span class="line">@wapper</span><br><span class="line">def func(arg):</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func(123)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&gt;&gt;&gt; 123</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 2. å¸¦å‚æ•°çš„è£…é¥°å™¨,æ­¤å¤„ä¸º3å±‚çš„å‡½æ•°åµŒå¥—</span><br><span class="line">def outer(num):</span><br><span class="line">    def wapper(f):</span><br><span class="line">        def inner(*args, **kwargs):</span><br><span class="line">            return f(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">        return inner</span><br><span class="line"></span><br><span class="line">    print(num)</span><br><span class="line">    return wapper</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># é¦–å…ˆæ‰§è¡Œwapper(666)ï¼Œè·å¾—è¿”å›å€¼;@wapper;æ­¤æ—¶@wapper,å†æ‰§è¡Œwapper(func)å‡½æ•°,è·å¾—è¿”å›å€¼innerï¼Œæ­¤æ—¶:func&#x3D;innerå‡½æ•°</span><br><span class="line">@outer(666)</span><br><span class="line">def func(arg):</span><br><span class="line">    print(arg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func(&#39;Hello&#39;)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">666</span><br><span class="line">Hello</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-Flaskä¸­çš„è·¯ç”±è£…é¥°å™¨"><a href="#3-2-Flaskä¸­çš„è·¯ç”±è£…é¥°å™¨" class="headerlink" title="3.2 Flaskä¸­çš„è·¯ç”±è£…é¥°å™¨"></a>3.2 Flaskä¸­çš„è·¯ç”±è£…é¥°å™¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)   #app.routerå‡½æ•°è£…è¿”å›decoratorå¯¹è±¡:å½¢å…¥@decorator</span><br><span class="line">def hello_world():</span><br><span class="line">    return &#39;Hello World!&#39;</span><br></pre></td></tr></table></figure>
<p>âš ï¸  Flaskä¸­è·¯ç”±ç³»ç»Ÿä½¿ç”¨çš„å°±æ˜¯å¸¦å‚æ•°çš„è£…é¥°å™¨å½¢å¼,æœ¬è´¨æ˜¯å°è£…æˆruleå¯¹è±¡,æ·»åŠ åˆ°app.url_mapå±æ€§ä¸­</p>
<h4 id="3-3-Flaskä¸­è®¤è¯çš„è£…é¥°å™¨ç”¨æ³•"><a href="#3-3-Flaskä¸­è®¤è¯çš„è£…é¥°å™¨ç”¨æ³•" class="headerlink" title="3.3 Flaskä¸­è®¤è¯çš„è£…é¥°å™¨ç”¨æ³•"></a>3.3 Flaskä¸­è®¤è¯çš„è£…é¥°å™¨ç”¨æ³•</h4><p>a. functools æ¨¡å—ä½¿ç”¨ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import functools</span><br><span class="line">def wapper(func):</span><br><span class="line">    @functools.wraps(func)</span><br><span class="line">    def inner(*args,**kwargs):</span><br><span class="line">        return func(*args,**kwargs)</span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line">@wapper</span><br><span class="line">def index():</span><br><span class="line">    print(&#39;å‡½æ•°å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">@wapper</span><br><span class="line">def order():</span><br><span class="line">    print(&#39;å‡½æ•°å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">print(index.__name__)</span><br><span class="line">print(order.__name__)</span><br></pre></td></tr></table></figure>
<p>b. Flaskä¸­åº”ç”¨ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import functools</span><br><span class="line">from flask import Flask,render_template,request,redirect,session</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__,template_folder&#x3D;&quot;templates&quot;)</span><br><span class="line">app.secret_key &#x3D; &#39;as923lrjks9d8fwlkxlduf&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def auth(func):</span><br><span class="line">    @functools.wraps(func)</span><br><span class="line">    def inner(*args,**kwargs):</span><br><span class="line">        user_info &#x3D; session.get(&#39;user_info&#39;)</span><br><span class="line">        if not user_info:</span><br><span class="line">            return redirect(&#39;&#x2F;login&#39;)</span><br><span class="line">        return func(*args,**kwargs)</span><br><span class="line">    return inner</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;order: innerå‡½æ•°, name: order</span><br><span class="line">    &#x2F;index: innerå‡½æ•°, name: index</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;order&#39;,methods&#x3D;[&#39;GET&#39;])</span><br><span class="line">@auth</span><br><span class="line">def order():</span><br><span class="line">    user_info &#x3D; session.get(&#39;user_info&#39;)</span><br><span class="line">    if not user_info:</span><br><span class="line">        return redirect(&#39;&#x2F;login&#39;)</span><br><span class="line"></span><br><span class="line">    return render_template(&#39;index.html&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;index&#39;,methods&#x3D;[&#39;GET&#39;])</span><br><span class="line">@auth</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&#39;index.html&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;login&#39;,methods&#x3D;[&#39;GET&#39;,&#39;POST&#39;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method &#x3D;&#x3D; &quot;GET&quot;:</span><br><span class="line">        return render_template(&#39;login.html&#39;)</span><br><span class="line">    else:</span><br><span class="line">        user &#x3D; request.form.get(&#39;user&#39;)</span><br><span class="line">        pwd &#x3D; request.form.get(&#39;pwd&#39;)</span><br><span class="line">        if user &#x3D;&#x3D; &#39;shuke&#39; and pwd &#x3D;&#x3D; &#39;123&#39;:</span><br><span class="line">            session[&#39;user_info&#39;] &#x3D; user</span><br><span class="line">            return redirect(&#39;&#x2F;index&#39;)</span><br><span class="line">        # return render_template(&#39;login.html&#39;,msg &#x3D; &quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;,error &#x3D; &quot;è¯·æ³¨å†Œ&quot;)</span><br><span class="line">        return render_template(&#39;login.html&#39;,**&#123;&#39;msg&#39;:&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;&#125;)</span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;logout&#39;,methods&#x3D;[&#39;GET&#39;])</span><br><span class="line">def logout():</span><br><span class="line">    del session[&#39;user_info&#39;]</span><br><span class="line">    return redirect(&#39;&#x2F;login&#39;)</span><br><span class="line">    </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>âš ï¸  æ­¤å¤„,ä½¿ç”¨authè£…é¥°å™¨çš„æ—¶å€™å¤šä¸ªå‡½æ•°ä¼šå¯¹åº”åˆ°åŒä¸€ä¸ªåŒä¸€ä¸ªè£…é¥°å™¨å‡½æ•°innerå¯¹è±¡,Flaskå¯åŠ¨ä¼šæŠ¥é”™;<br>æ­¤æ—¶å¯ä»¥ä½¿ç”¨endpointå‚æ•°è§£å†³æ­¤é—®é¢˜,Flaskå†…éƒ¨é»˜è®¤ä½¿ç”¨å‡½æ•°çš„<strong>name</strong>è·å–çš„å‡½æ•°åä½œä¸ºendpointå‚æ•°;<br>æˆ–è€…åˆ©ç”¨functoolsæ¨¡å—ä¿ç•™è¢«è£…é¥°å‡½æ•°çš„å…ƒä¿¡æ¯;<br>åœ¨å®é™…åº”ç”¨ä¸­å»ºè®®ä½¿ç”¨ç±»ä¼¼äºDjangoçš„ä¸­é—´ä»¶æ–¹å¼æ›´ä¼˜é›…çš„æ–¹å¼è§£å†³;</p>
<h3 id="å››-é…ç½®æ–‡ä»¶"><a href="#å››-é…ç½®æ–‡ä»¶" class="headerlink" title="å››. é…ç½®æ–‡ä»¶"></a>å››. é…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">flaskä¸­çš„é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªflask.config.Configå¯¹è±¡ï¼ˆç»§æ‰¿å­—å…¸ï¼‰,é»˜è®¤é…ç½®ä¸ºï¼š</span><br><span class="line">    &#123;</span><br><span class="line">        &#39;DEBUG&#39;:                                get_debug_flag(default&#x3D;False),  æ˜¯å¦å¼€å¯Debugæ¨¡å¼</span><br><span class="line">        &#39;TESTING&#39;:                              False,                          æ˜¯å¦å¼€å¯æµ‹è¯•æ¨¡å¼</span><br><span class="line">        &#39;PROPAGATE_EXCEPTIONS&#39;:                 None,                          </span><br><span class="line">        &#39;PRESERVE_CONTEXT_ON_EXCEPTION&#39;:        None,</span><br><span class="line">        &#39;SECRET_KEY&#39;:                           None,</span><br><span class="line">        &#39;PERMANENT_SESSION_LIFETIME&#39;:           timedelta(days&#x3D;31),</span><br><span class="line">        &#39;USE_X_SENDFILE&#39;:                       False,</span><br><span class="line">        &#39;LOGGER_NAME&#39;:                          None,</span><br><span class="line">        &#39;LOGGER_HANDLER_POLICY&#39;:               &#39;always&#39;,</span><br><span class="line">        &#39;SERVER_NAME&#39;:                          None,</span><br><span class="line">        &#39;APPLICATION_ROOT&#39;:                     None,</span><br><span class="line">        &#39;SESSION_COOKIE_NAME&#39;:                  &#39;session&#39;,</span><br><span class="line">        &#39;SESSION_COOKIE_DOMAIN&#39;:                None,</span><br><span class="line">        &#39;SESSION_COOKIE_PATH&#39;:                  None,</span><br><span class="line">        &#39;SESSION_COOKIE_HTTPONLY&#39;:              True,</span><br><span class="line">        &#39;SESSION_COOKIE_SECURE&#39;:                False,</span><br><span class="line">        &#39;SESSION_REFRESH_EACH_REQUEST&#39;:         True,</span><br><span class="line">        &#39;MAX_CONTENT_LENGTH&#39;:                   None,</span><br><span class="line">        &#39;SEND_FILE_MAX_AGE_DEFAULT&#39;:            timedelta(hours&#x3D;12),</span><br><span class="line">        &#39;TRAP_BAD_REQUEST_ERRORS&#39;:              False,</span><br><span class="line">        &#39;TRAP_HTTP_EXCEPTIONS&#39;:                 False,</span><br><span class="line">        &#39;EXPLAIN_TEMPLATE_LOADING&#39;:             False,</span><br><span class="line">        &#39;PREFERRED_URL_SCHEME&#39;:                 &#39;http&#39;,</span><br><span class="line">        &#39;JSON_AS_ASCII&#39;:                        True,</span><br><span class="line">        &#39;JSON_SORT_KEYS&#39;:                       True,</span><br><span class="line">        &#39;JSONIFY_PRETTYPRINT_REGULAR&#39;:          True,</span><br><span class="line">        &#39;JSONIFY_MIMETYPE&#39;:                     &#39;application&#x2F;json&#39;,</span><br><span class="line">        &#39;TEMPLATES_AUTO_RELOAD&#39;:                None,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ä¸€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    app.config[&#39;DEBUG&#39;] &#x3D; True</span><br><span class="line"> </span><br><span class="line">    PSï¼š ç”±äºConfigå¯¹è±¡æœ¬è´¨ä¸Šæ˜¯å­—å…¸ï¼Œæ‰€ä»¥è¿˜å¯ä»¥ä½¿ç”¨app.config.update(...)</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line">æ–¹å¼äºŒï¼š</span><br></pre></td></tr></table></figure>
<pre><code>app.config.from_pyfile(&quot;pythonæ–‡ä»¶åç§°&quot;)
    å¦‚ï¼š
        settings.py
            DEBUG = True
        app.config.from_pyfile(&quot;settings.py&quot;)

app.config.from_envvar(&quot;ç¯å¢ƒå˜é‡åç§°&quot;)
    ç¯å¢ƒå˜é‡çš„å€¼ä¸ºpythonæ–‡ä»¶åç§°åç§°ï¼Œå†…éƒ¨è°ƒç”¨from_pyfileæ–¹æ³•

app.config.from_json(&quot;jsonæ–‡ä»¶åç§°&quot;)
    JSONæ–‡ä»¶åç§°ï¼Œå¿…é¡»æ˜¯jsonæ ¼å¼ï¼Œå› ä¸ºå†…éƒ¨ä¼šæ‰§è¡Œjson.loads

app.config.from_mapping({&apos;DEBUG&apos;:True})
    å­—å…¸æ ¼å¼

app.config.from_object(&quot;pythonç±»æˆ–ç±»çš„è·¯å¾„&quot;)

    app.config.from_object(&apos;pro_flask.settings.TestingConfig&apos;)

    settings.py å†…å®¹

        class Config(object):
            DEBUG = False
            TESTING = False
            DATABASE_URI = &apos;sqlite://:memory:&apos;

        class ProductionConfig(Config):
            DATABASE_URI = &apos;mysql://user@localhost/foo&apos;

        class DevelopmentConfig(Config):
            DEBUG = True

        class TestingConfig(Config):
            TESTING = True</code></pre><p>PS: ä»sys.pathä¸­å·²ç»å­˜åœ¨çš„è·¯å¾„ä¸‹å¼€å§‹æŸ¥æ‰¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">PS: settings.pyæ–‡ä»¶é»˜è®¤è·¯å¾„è¦æ”¾åœ¨ç¨‹åºroot_pathç›®å½•ï¼Œå¦‚æœinstance_relative_configä¸ºTrueï¼Œåˆ™å°±æ˜¯instance_pathç›®å½•</span><br><span class="line"></span><br><span class="line">### äº”. è·¯ç”±ç³»ç»Ÿ</span><br><span class="line">#### 5.1 è·¯ç”±åŸºæœ¬ä½¿ç”¨</span><br><span class="line">- @app.route(&#39;&#x2F;user&#x2F;&lt;username&gt;&#39;)</span><br><span class="line">- @app.route(&#39;&#x2F;post&#x2F;&lt;int:post_id&gt;&#39;)</span><br><span class="line">- @app.route(&#39;&#x2F;post&#x2F;&lt;float:post_id&gt;&#39;)</span><br><span class="line">- @app.route(&#39;&#x2F;post&#x2F;&lt;path:path&gt;&#39;)</span><br><span class="line">- @app.route(&#39;&#x2F;login&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line"></span><br><span class="line">å¸¸ç”¨è·¯ç”±ç³»ç»Ÿæœ‰ä»¥ä¸Šäº”ç§ï¼Œæ‰€æœ‰çš„è·¯ç”±ç³»ç»Ÿéƒ½æ˜¯åŸºäºä»¥ä¸‹å¯¹åº”å…³ç³»æ¥å¤„ç†:</span><br></pre></td></tr></table></figure>
<p>DEFAULT_CONVERTERS = {<br>    â€˜defaultâ€™:          UnicodeConverter,<br>    â€˜stringâ€™:           UnicodeConverter,<br>    â€˜anyâ€™:              AnyConverter,<br>    â€˜pathâ€™:             PathConverter,<br>    â€˜intâ€™:              IntegerConverter,<br>    â€˜floatâ€™:            FloatConverter,<br>    â€˜uuidâ€™:             UUIDConverter,<br>}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 5.2 æ³¨å†Œè·¯ç”±åŸç†</span><br></pre></td></tr></table></figure>
<p>def auth(func):<br>            def inner(<em>args, *</em>kwargs):<br>                print(â€˜beforeâ€™)<br>                result = func(<em>args, *</em>kwargs)<br>                print(â€˜afterâ€™)<br>                return result</p>
<pre><code>return inner

@app.route(&apos;/index.html&apos;,methods=[&apos;GET&apos;,&apos;POST&apos;],endpoint=&apos;index&apos;)
@auth
def index():
    return &apos;Index&apos;
æˆ–
def index():
    return &quot;Index&quot;

self.add_url_rule(rule=&apos;/index.html&apos;, endpoint=&quot;index&quot;, view_func=index, methods=[&quot;GET&quot;,&quot;POST&quot;])
or
app.add_url_rule(rule=&apos;/index.html&apos;, endpoint=&quot;index&quot;, view_func=index, methods=[&quot;GET&quot;,&quot;POST&quot;])
app.view_functions[&apos;index&apos;] = index
æˆ–
def auth(func):
    def inner(*args, **kwargs):
        print(&apos;before&apos;)
        result = func(*args, **kwargs)
        print(&apos;after&apos;)
        return result

return inner

class IndexView(views.View):
    methods = [&apos;GET&apos;]
    decorators = [auth, ]

    def dispatch_request(self):
        print(&apos;Index&apos;)
        return &apos;Index!&apos;

app.add_url_rule(&apos;/index&apos;, view_func=IndexView.as_view(name=&apos;index&apos;))  # name=endpoint
æˆ–
class IndexView(views.MethodView):
    methods = [&apos;GET&apos;]
    decorators = [auth, ]

    def get(self):
        return &apos;Index.GET&apos;

    def post(self):
        return &apos;Index.POST&apos;

app.add_url_rule(&apos;/index&apos;, view_func=IndexView.as_view(name=&apos;index&apos;))  # name=endpoint

@app.routeå’Œapp.add_url_ruleå‚æ•°ï¼š
    rule,                       URLè§„åˆ™
    view_func,                  è§†å›¾å‡½æ•°åç§°
    defaults=None,              é»˜è®¤å€¼,å½“URLä¸­æ— å‚æ•°ï¼Œå‡½æ•°éœ€è¦å‚æ•°æ—¶ï¼Œä½¿ç”¨defaults={&apos;k&apos;:&apos;v&apos;}ä¸ºå‡½æ•°æä¾›å‚æ•°
    endpoint=None,              åç§°ï¼Œç”¨äºåå‘ç”ŸæˆURLï¼Œå³ï¼š url_for(&apos;åç§°&apos;)
    methods=None,               å…è®¸çš„è¯·æ±‚æ–¹å¼ï¼Œå¦‚ï¼š[&quot;GET&quot;,&quot;POST&quot;]


    strict_slashes=None,        å¯¹URLæœ€åçš„ / ç¬¦å·æ˜¯å¦ä¸¥æ ¼è¦æ±‚ï¼Œ
                                å¦‚ï¼š
                                    @app.route(&apos;/index&apos;,strict_slashes=False)ï¼Œ
                                        è®¿é—® http://www.xx.com/index/ æˆ– http://www.xx.com/indexå‡å¯
                                    @app.route(&apos;/index&apos;,strict_slashes=True)
                                        ä»…è®¿é—® http://www.xx.com/index 
    redirect_to=None,           é‡å®šå‘åˆ°æŒ‡å®šåœ°å€
                                å¦‚ï¼š
                                    @app.route(&apos;/index/&lt;int:nid&gt;&apos;, redirect_to=&apos;/home/&lt;nid&gt;&apos;)
                                    æˆ–
                                    def func(adapter, nid):
                                        return &quot;/home/888&quot;
                                    @app.route(&apos;/index/&lt;int:nid&gt;&apos;, redirect_to=func)
    subdomain=None,             å­åŸŸåè®¿é—®
                                        from flask import Flask, views, url_for

                                        app = Flask(import_name=__name__)
                                        app.config[&apos;SERVER_NAME&apos;] = &apos;wupeiqi.com:5000&apos;


                                        @app.route(&quot;/&quot;, subdomain=&quot;admin&quot;)
                                        def static_index():
                                            &quot;&quot;&quot;Flask supports static subdomains
                                            This is available at static.your-domain.tld&quot;&quot;&quot;
                                            return &quot;static.your-domain.tld&quot;

                                        @app.route(&quot;/dynamic&quot;, subdomain=&quot;&lt;username&gt;&quot;)
                                        def username_index(username):
                                            &quot;&quot;&quot;Dynamic subdomains are also supported
                                            Try going to user1.your-domain.tld/dynamic&quot;&quot;&quot;
                                            return username + &quot;.your-domain.tld&quot;

                                        if __name__ == &apos;__main__&apos;:
                                            app.run()</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 5.3 è‡ªå®šä¹‰æ­£åˆ™è·¯ç”±åŒ¹é…</span><br></pre></td></tr></table></figure>
<p>from flask import Flask, views, url_for<br>            from werkzeug.routing import BaseConverter</p>
<pre><code>app = Flask(import_name=__name__)


class RegexConverter(BaseConverter):
    &quot;&quot;&quot;
    è‡ªå®šä¹‰URLåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼
    &quot;&quot;&quot;
    def __init__(self, map, regex):
        super(RegexConverter, self).__init__(map)
        self.regex = regex

    def to_python(self, value):
        &quot;&quot;&quot;
        è·¯ç”±åŒ¹é…æ—¶ï¼ŒåŒ¹é…æˆåŠŸåä¼ é€’ç»™è§†å›¾å‡½æ•°ä¸­å‚æ•°çš„å€¼
        :param value: 
        :return: 
        &quot;&quot;&quot;
        return int(value)

    def to_url(self, value):
        &quot;&quot;&quot;
        ä½¿ç”¨url_foråå‘ç”ŸæˆURLæ—¶ï¼Œä¼ é€’çš„å‚æ•°ç»è¿‡è¯¥æ–¹æ³•å¤„ç†ï¼Œè¿”å›çš„å€¼ç”¨äºç”ŸæˆURLä¸­çš„å‚æ•°
        :param value: 
        :return: 
        &quot;&quot;&quot;
        val = super(RegexConverter, self).to_url(value)
        return val

# æ·»åŠ åˆ°flaskä¸­
app.url_map.converters[&apos;regex&apos;] = RegexConverter


@app.route(&apos;/index/&lt;regex(&quot;\d+&quot;):nid&gt;&apos;)
def index(nid):
    print(url_for(&apos;index&apos;, nid=&apos;888&apos;))
    return &apos;Index&apos;

if __name__ == &apos;__main__&apos;:
    app.run()</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### äº”. </span><br><span class="line">1. æ¨¡æ¿çš„ä½¿ç”¨</span><br><span class="line">Flaskä½¿ç”¨çš„æ˜¯Jinja2æ¨¡æ¿ï¼Œæ‰€ä»¥å…¶è¯­æ³•å’ŒDjangoæ— å·®åˆ«</span><br><span class="line">2. è‡ªå®šä¹‰æ¨¡æ¿æ–¹æ³•</span><br><span class="line">Flaskä¸­è‡ªå®šä¹‰æ¨¡æ¿æ–¹æ³•çš„æ–¹å¼å’ŒBottleç›¸ä¼¼ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°å¹¶é€šè¿‡å‚æ•°çš„å½¢å¼ä¼ å…¥render_templateï¼Œå¦‚ï¼š</span><br></pre></td></tr></table></figure>
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <h1>è‡ªå®šä¹‰å‡½æ•°</h1>
    

</body>
</html>

<p>html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line"># cat run.py</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from flask import Flask,render_template</span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def wupeiqi():</span><br><span class="line">    return &#39;&lt;h1&gt;Wupeiqi&lt;&#x2F;h1&gt;&#39;</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;login&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def login():</span><br><span class="line">    return render_template(&#39;login.html&#39;, ww&#x3D;wupeiqi)</span><br><span class="line"> </span><br><span class="line">app.run()</span><br></pre></td></tr></table></figure>
<p>example.html</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;% macro input(name, type&#x3D;&#39;text&#39;, value&#x3D;&#39;&#39;) %&#125;</span><br><span class="line">        &lt;input type&#x3D;&quot;&#123;&#123; type &#125;&#125;&quot; name&#x3D;&quot;&#123;&#123; name &#125;&#125;&quot; value&#x3D;&quot;&#123;&#123; value &#125;&#125;&quot;&gt;</span><br><span class="line">    &#123;% endmacro %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;&#123; input(&#39;n1&#39;) &#125;&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% include &#39;tp.html&#39; %&#125;</span><br><span class="line"></span><br><span class="line">    &lt;h1&gt;asdf&#123;&#123; v.k1&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>æ³¨âš ï¸ï¼šMarkupç­‰ä»·djangoçš„mark_safe</p>
<h3 id="å…­-è¯·æ±‚å’Œå“åº”"><a href="#å…­-è¯·æ±‚å’Œå“åº”" class="headerlink" title="å…­. è¯·æ±‚å’Œå“åº”"></a>å…­. è¯·æ±‚å’Œå“åº”</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">    from flask import request</span><br><span class="line">    from flask import render_template</span><br><span class="line">    from flask import redirect</span><br><span class="line">    from flask import make_response</span><br><span class="line"></span><br><span class="line">    app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @app.route(&#39;&#x2F;login.html&#39;, methods&#x3D;[&#39;GET&#39;, &quot;POST&quot;])</span><br><span class="line">    def login():</span><br><span class="line"></span><br><span class="line">        # è¯·æ±‚ç›¸å…³ä¿¡æ¯</span><br><span class="line">        # request.method</span><br><span class="line">        # request.args</span><br><span class="line">        # request.form</span><br><span class="line">        # request.values</span><br><span class="line">        # request.cookies</span><br><span class="line">        # request.headers</span><br><span class="line">        # request.path</span><br><span class="line">        # request.full_path</span><br><span class="line">        # request.script_root</span><br><span class="line">        # request.url</span><br><span class="line">        # request.base_url</span><br><span class="line">        # request.url_root</span><br><span class="line">        # request.host_url</span><br><span class="line">        # request.host</span><br><span class="line">        # request.files</span><br><span class="line">        # obj &#x3D; request.files[&#39;the_file_name&#39;]</span><br><span class="line">        # obj.save(&#39;&#x2F;var&#x2F;www&#x2F;uploads&#x2F;&#39; + secure_filename(f.filename))</span><br><span class="line"></span><br><span class="line">        # å“åº”ç›¸å…³ä¿¡æ¯</span><br><span class="line">        # return &quot;å­—ç¬¦ä¸²&quot;</span><br><span class="line">        # return render_template(&#39;htmlæ¨¡æ¿è·¯å¾„&#39;,**&#123;&#125;)</span><br><span class="line">        # return redirect(&#39;&#x2F;index.html&#39;)</span><br><span class="line"></span><br><span class="line">        # response &#x3D; make_response(render_template(&#39;index.html&#39;))</span><br><span class="line">        # responseæ˜¯flask.wrappers.Responseç±»å‹</span><br><span class="line">        # response.delete_cookie(&#39;key&#39;)</span><br><span class="line">        # response.set_cookie(&#39;key&#39;, &#39;value&#39;)</span><br><span class="line">        # response.headers[&#39;X-Something&#39;] &#x3D; &#39;A value&#39;</span><br><span class="line">        # return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        return &quot;å†…å®¹&quot;</span><br><span class="line"></span><br><span class="line">    if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">        app.run()</span><br></pre></td></tr></table></figure>
<h3 id="ä¸ƒ-Session"><a href="#ä¸ƒ-Session" class="headerlink" title="ä¸ƒ. Session"></a>ä¸ƒ. Session</h3><p>é™¤è¯·æ±‚å¯¹è±¡ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª session å¯¹è±¡ã€‚å®ƒå…è®¸ä½ åœ¨ä¸åŒè¯·æ±‚é—´å­˜å‚¨ç‰¹å®šç”¨æˆ·çš„ä¿¡æ¯ã€‚å®ƒæ˜¯åœ¨ Cookies çš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œå¹¶ä¸”å¯¹ Cookies è¿›è¡Œå¯†é’¥ç­¾åè¦ä½¿ç”¨ä¼šè¯ï¼Œä½ éœ€è¦è®¾ç½®ä¸€ä¸ªå¯†é’¥ã€‚<br>è®¾ç½®ï¼šsession[â€˜usernameâ€™] ï¼ â€˜xxxâ€™<br>åˆ é™¤ï¼šsession.pop(â€˜usernameâ€™, None)</p>
<ol>
<li>åŸºæœ¬ä½¿ç”¨<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask, session, redirect, url_for, escape, request</span><br><span class="line"> </span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    if &#39;username&#39; in session:</span><br><span class="line">        return &#39;Logged in as %s&#39; % escape(session[&#39;username&#39;])</span><br><span class="line">    return &#39;You are not logged in&#39;</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;login&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def login():</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        session[&#39;username&#39;] &#x3D; request.form[&#39;username&#39;]</span><br><span class="line">        return redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return &#39;&#39;&#39;</span><br><span class="line">        &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type&#x3D;text name&#x3D;username&gt;</span><br><span class="line">            &lt;p&gt;&lt;input type&#x3D;submit value&#x3D;Login&gt;</span><br><span class="line">        &lt;&#x2F;form&gt;</span><br><span class="line">    &#39;&#39;&#39;</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;logout&#39;)</span><br><span class="line">def logout():</span><br><span class="line">    # remove the username from the session if it&#39;s there</span><br><span class="line">    session.pop(&#39;username&#39;, None)</span><br><span class="line">    return redirect(url_for(&#39;index&#39;))</span><br><span class="line"> </span><br><span class="line"># set the secret key.  keep this really secret:</span><br><span class="line">app.secret_key &#x3D; &#39;A0Zr98j&#x2F;3yX R~XHH!jmN]LWX&#x2F;,?RT&#39;</span><br></pre></td></tr></table></figure></li>
<li>è‡ªå®šä¹‰Session<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip3 install Flask-Session</span><br><span class="line">        </span><br><span class="line">        run.py</span><br><span class="line">            from flask import Flask</span><br><span class="line">            from flask import session</span><br><span class="line">            from pro_flask.utils.session import MySessionInterface</span><br><span class="line">            app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">            app.secret_key &#x3D; &#39;A0Zr98j&#x2F;3yX R~XHH!jmN]LWX&#x2F;,?RT&#39;</span><br><span class="line">            app.session_interface &#x3D; MySessionInterface()</span><br><span class="line"></span><br><span class="line">            @app.route(&#39;&#x2F;login.html&#39;, methods&#x3D;[&#39;GET&#39;, &quot;POST&quot;])</span><br><span class="line">            def login():</span><br><span class="line">                print(session)</span><br><span class="line">                session[&#39;user1&#39;] &#x3D; &#39;alex&#39;</span><br><span class="line">                session[&#39;user2&#39;] &#x3D; &#39;alex&#39;</span><br><span class="line">                del session[&#39;user2&#39;]</span><br><span class="line"></span><br><span class="line">                return &quot;å†…å®¹&quot;</span><br><span class="line"></span><br><span class="line">            if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">                app.run()</span><br><span class="line"></span><br><span class="line">        session.py</span><br><span class="line">            #!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">            # -*- coding:utf-8 -*-</span><br><span class="line">            import uuid</span><br><span class="line">            import json</span><br><span class="line">            from flask.sessions import SessionInterface</span><br><span class="line">            from flask.sessions import SessionMixin</span><br><span class="line">            from itsdangerous import Signer, BadSignature, want_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            class MySession(dict, SessionMixin):</span><br><span class="line">                def __init__(self, initial&#x3D;None, sid&#x3D;None):</span><br><span class="line">                    self.sid &#x3D; sid</span><br><span class="line">                    self.initial &#x3D; initial</span><br><span class="line">                    super(MySession, self).__init__(initial or ())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                def __setitem__(self, key, value):</span><br><span class="line">                    super(MySession, self).__setitem__(key, value)</span><br><span class="line"></span><br><span class="line">                def __getitem__(self, item):</span><br><span class="line">                    return super(MySession, self).__getitem__(item)</span><br><span class="line"></span><br><span class="line">                def __delitem__(self, key):</span><br><span class="line">                    super(MySession, self).__delitem__(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            class MySessionInterface(SessionInterface):</span><br><span class="line">                session_class &#x3D; MySession</span><br><span class="line">                container &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">                def __init__(self):</span><br><span class="line">                    import redis</span><br><span class="line">                    self.redis &#x3D; redis.Redis()</span><br><span class="line"></span><br><span class="line">                def _generate_sid(self):</span><br><span class="line">                    return str(uuid.uuid4())</span><br><span class="line"></span><br><span class="line">                def _get_signer(self, app):</span><br><span class="line">                    if not app.secret_key:</span><br><span class="line">                        return None</span><br><span class="line">                    return Signer(app.secret_key, salt&#x3D;&#39;flask-session&#39;,</span><br><span class="line">                                  key_derivation&#x3D;&#39;hmac&#39;)</span><br><span class="line"></span><br><span class="line">                def open_session(self, app, request):</span><br><span class="line">                    &quot;&quot;&quot;</span><br><span class="line">                    ç¨‹åºåˆšå¯åŠ¨æ—¶æ‰§è¡Œï¼Œéœ€è¦è¿”å›ä¸€ä¸ªsessionå¯¹è±¡</span><br><span class="line">                    &quot;&quot;&quot;</span><br><span class="line">                    sid &#x3D; request.cookies.get(app.session_cookie_name)</span><br><span class="line">                    if not sid:</span><br><span class="line">                        sid &#x3D; self._generate_sid()</span><br><span class="line">                        return self.session_class(sid&#x3D;sid)</span><br><span class="line"></span><br><span class="line">                    signer &#x3D; self._get_signer(app)</span><br><span class="line">                    try:</span><br><span class="line">                        sid_as_bytes &#x3D; signer.unsign(sid)</span><br><span class="line">                        sid &#x3D; sid_as_bytes.decode()</span><br><span class="line">                    except BadSignature:</span><br><span class="line">                        sid &#x3D; self._generate_sid()</span><br><span class="line">                        return self.session_class(sid&#x3D;sid)</span><br><span class="line"></span><br><span class="line">                    # sessionä¿å­˜åœ¨redisä¸­</span><br><span class="line">                    # val &#x3D; self.redis.get(sid)</span><br><span class="line">                    # sessionä¿å­˜åœ¨å†…å­˜ä¸­</span><br><span class="line">                    val &#x3D; self.container.get(sid)</span><br><span class="line"></span><br><span class="line">                    if val is not None:</span><br><span class="line">                        try:</span><br><span class="line">                            data &#x3D; json.loads(val)</span><br><span class="line">                            return self.session_class(data, sid&#x3D;sid)</span><br><span class="line">                        except:</span><br><span class="line">                            return self.session_class(sid&#x3D;sid)</span><br><span class="line">                    return self.session_class(sid&#x3D;sid)</span><br><span class="line"></span><br><span class="line">                def save_session(self, app, session, response):</span><br><span class="line">                    &quot;&quot;&quot;</span><br><span class="line">                    ç¨‹åºç»“æŸå‰æ‰§è¡Œï¼Œå¯ä»¥ä¿å­˜sessionä¸­æ‰€æœ‰çš„å€¼</span><br><span class="line">                    å¦‚ï¼š</span><br><span class="line">                        ä¿å­˜åˆ°resit</span><br><span class="line">                        å†™å…¥åˆ°ç”¨æˆ·cookie</span><br><span class="line">                    &quot;&quot;&quot;</span><br><span class="line">                    domain &#x3D; self.get_cookie_domain(app)</span><br><span class="line">                    path &#x3D; self.get_cookie_path(app)</span><br><span class="line">                    httponly &#x3D; self.get_cookie_httponly(app)</span><br><span class="line">                    secure &#x3D; self.get_cookie_secure(app)</span><br><span class="line">                    expires &#x3D; self.get_expiration_time(app, session)</span><br><span class="line"></span><br><span class="line">                    val &#x3D; json.dumps(dict(session))</span><br><span class="line"></span><br><span class="line">                    # sessionä¿å­˜åœ¨redisä¸­</span><br><span class="line">                    # self.redis.setex(name&#x3D;session.sid, value&#x3D;val, time&#x3D;app.permanent_session_lifetime)</span><br><span class="line">                    # sessionä¿å­˜åœ¨å†…å­˜ä¸­</span><br><span class="line">                    self.container.setdefault(session.sid, val)</span><br><span class="line"></span><br><span class="line">                    session_id &#x3D; self._get_signer(app).sign(want_bytes(session.sid))</span><br><span class="line"></span><br><span class="line">                    response.set_cookie(app.session_cookie_name, session_id,</span><br><span class="line">                                        expires&#x3D;expires, httponly&#x3D;httponly,</span><br><span class="line">                                        domain&#x3D;domain, path&#x3D;path, secure&#x3D;secure)</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬ä¸‰æ–¹Session<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">pip3 install redis</span><br><span class="line">pip3 install flask-session</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from flask import Flask, session, redirect</span><br><span class="line">from flask.ext.session import Session</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">app.debug &#x3D; True</span><br><span class="line">app.secret_key &#x3D; &#39;asdfasdfasd&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.config[&#39;SESSION_TYPE&#39;] &#x3D; &#39;redis&#39;</span><br><span class="line">from redis import Redis</span><br><span class="line">app.config[&#39;SESSION_REDIS&#39;] &#x3D; Redis(host&#x3D;&#39;192.168.0.94&#39;,port&#x3D;&#39;6379&#39;)</span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;login&#39;)</span><br><span class="line">def login():</span><br><span class="line">    session[&#39;username&#39;] &#x3D; &#39;alex&#39;</span><br><span class="line">    return redirect(&#39;&#x2F;index&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;index&#39;)</span><br><span class="line">def index():</span><br><span class="line">    name &#x3D; session[&#39;username&#39;]</span><br><span class="line">    return name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<h3 id="å…«-è“å›¾-Blueprint"><a href="#å…«-è“å›¾-Blueprint" class="headerlink" title="å…«. è“å›¾(Blueprint)"></a>å…«. è“å›¾(Blueprint)</h3>è“å›¾ç”¨äºä¸ºåº”ç”¨æä¾›ç›®å½•åˆ’åˆ†ï¼š</li>
</ol>
<ul>
<li>å°å‹åº”ç”¨ç¨‹åºï¼šç¤ºä¾‹</li>
<li>å¤§å‹åº”ç”¨ç¨‹åºï¼šç¤ºä¾‹</li>
<li>å…¶ä»–ï¼š<ul>
<li>è“å›¾URLå‰ç¼€ï¼šxxx = Blueprint(â€˜accountâ€™, <strong>name</strong>,url_prefix=â€™/xxxâ€™)</li>
<li>è“å›¾å­åŸŸåï¼šxxx = Blueprint(â€˜accountâ€™, <strong>name</strong>,subdomain=â€™adminâ€™)</li>
<li>å‰æéœ€è¦ç»™é…ç½®SERVER_NAMEï¼š app.config[â€˜SERVER_NAMEâ€™] = â€˜<a href="http://www.shuke.com:5000&#39;">www.shuke.com:5000&#39;</a><br>è®¿é—®æ—¶ï¼š<a href="http://www.shuke.com:5000/login.html" target="_blank" rel="noopener">www.shuke.com:5000/login.html</a></li>
</ul>
</li>
</ul>
<h3 id="ä¹-é—ªç°-message"><a href="#ä¹-é—ªç°-message" class="headerlink" title="ä¹. é—ªç°(message)"></a>ä¹. é—ªç°(message)</h3><p>messageæ˜¯ä¸€ä¸ªåŸºäºSessionå®ç°çš„ç”¨äºä¿å­˜æ•°æ®çš„é›†åˆï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼šä½¿ç”¨ä¸€æ¬¡å°±åˆ é™¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask, flash, redirect, render_template, request, get_flashed_messages</span><br><span class="line"></span><br><span class="line">        app &#x3D; Flask(__name__)</span><br><span class="line">        app.secret_key &#x3D; &#39;some_secret&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        @app.route(&#39;&#x2F;&#39;)</span><br><span class="line">        def index1():</span><br><span class="line">            messages &#x3D; get_flashed_messages()</span><br><span class="line">            print(messages)</span><br><span class="line">            return &quot;Index1&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        @app.route(&#39;&#x2F;set&#39;)</span><br><span class="line">        def index2():</span><br><span class="line">            v &#x3D; request.args.get(&#39;p&#39;)</span><br><span class="line">            flash(v)</span><br><span class="line">            return &#39;ok&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">            app.run()</span><br></pre></td></tr></table></figure>

<h3 id="å-ä¸­é—´ä»¶"><a href="#å-ä¸­é—´ä»¶" class="headerlink" title="å. ä¸­é—´ä»¶"></a>å. ä¸­é—´ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from flask import Flask, flash, redirect, render_template, request</span><br><span class="line"> </span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line">app.secret_key &#x3D; &#39;some_secret&#39;</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index1():</span><br><span class="line">    return render_template(&#39;index.html&#39;)</span><br><span class="line"> </span><br><span class="line">@app.route(&#39;&#x2F;set&#39;)</span><br><span class="line">def index2():</span><br><span class="line">    v &#x3D; request.args.get(&#39;p&#39;)</span><br><span class="line">    flash(v)</span><br><span class="line">    return &#39;ok&#39;</span><br><span class="line"> </span><br><span class="line">class MiddleWare:</span><br><span class="line">    def __init__(self,wsgi_app):</span><br><span class="line">        self.wsgi_app &#x3D; wsgi_app</span><br><span class="line"> </span><br><span class="line">    def __call__(self, *args, **kwargs):</span><br><span class="line"> </span><br><span class="line">        return self.wsgi_app(*args, **kwargs)</span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    app.wsgi_app &#x3D; MiddleWare(app.wsgi_app)</span><br><span class="line">    app.run(port&#x3D;9999)</span><br></pre></td></tr></table></figure>

<h3 id="åä¸€-è¯·æ±‚æ‰©å±•"><a href="#åä¸€-è¯·æ±‚æ‰©å±•" class="headerlink" title="åä¸€. è¯·æ±‚æ‰©å±•"></a>åä¸€. è¯·æ±‚æ‰©å±•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from flask import Flask, Request, render_template</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__, template_folder&#x3D;&#39;templates&#39;)</span><br><span class="line">app.debug &#x3D; True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.before_first_request</span><br><span class="line">def before_first_request1():</span><br><span class="line">    print(&#39;before_first_request1&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.before_first_request</span><br><span class="line">def before_first_request2():</span><br><span class="line">    print(&#39;before_first_request2&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.before_request</span><br><span class="line">def before_request1():</span><br><span class="line">    Request.nnn &#x3D; 123</span><br><span class="line">    print(&#39;before_request1&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.before_request</span><br><span class="line">def before_request2():</span><br><span class="line">    print(&#39;before_request2&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.after_request</span><br><span class="line">def after_request1(response):</span><br><span class="line">    print(&#39;before_request1&#39;, response)</span><br><span class="line">    return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.after_request</span><br><span class="line">def after_request2(response):</span><br><span class="line">    print(&#39;before_request2&#39;, response)</span><br><span class="line">    return response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.errorhandler(404)</span><br><span class="line">def page_not_found(error):</span><br><span class="line">    return &#39;This page does not exist&#39;, 404</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.template_global()</span><br><span class="line">def sb(a1, a2):</span><br><span class="line">    return a1 + a2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.template_filter()</span><br><span class="line">def db(a1, a2, a3):</span><br><span class="line">    return a1 + a2 + a3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def hello_world():</span><br><span class="line">    return render_template(&#39;hello.html&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<h3 id="åäºŒ-Flaskæ’ä»¶"><a href="#åäºŒ-Flaskæ’ä»¶" class="headerlink" title="åäºŒ. Flaskæ’ä»¶"></a>åäºŒ. Flaskæ’ä»¶</h3><ul>
<li>WTForms    </li>
<li>SQLAchemy</li>
</ul>
<h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><a href="http://www.cnblogs.com/wupeiqi/articles/7552008.html" target="_blank" rel="noopener">Flask-æ­¦æ²›é½-åšå®¢å›­</a><br><a href="http://docs.jinkan.org/docs/flask/" target="_blank" rel="noopener">æ¬¢è¿ä½¿ç”¨ Flask â€” Flask 0.10.1 æ–‡æ¡£</a><br><a href="http://flask.pocoo.org/docs/0.12/" target="_blank" rel="noopener">Welcome to Flask â€” Flask Documentation  (0.12)</a><br><a href="https://wizardforcel.gitbooks.io/explore-flask/content/index.html" target="_blank" rel="noopener">Flask ä¹‹æ—…</a> </p>
]]></content>
      <categories>
        <category>Flask</category>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
        <tag>Flask</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins-file Example</title>
    <url>/2020/04/20/Jenkins-file-Example/</url>
    <content><![CDATA[<h2 id="Jenkins-file-example"><a href="#Jenkins-file-example" class="headerlink" title="Jenkins file example"></a>Jenkins file example</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">properties([buildDiscarder(logRotator(artifactNumToKeepStr: &#39;10&#39;, numToKeepStr: &#39;10&#39;))])</span><br><span class="line">node(&#39;build&#39;) &#123;</span><br><span class="line">    def serviceName  &#x3D; &quot;&quot;</span><br><span class="line">    def warFilePath &#x3D; [</span><br><span class="line">         &#39;external-api-web&#x2F;target&#x2F;external-api-web-1.0-SNAPSHOT.jar&#39;</span><br><span class="line">    ]</span><br><span class="line">    def artifactsPath &#x3D; &quot;devops-artifacts&quot;</span><br><span class="line">    def artifactOssPath &#x3D; &quot;bi&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">    sh &quot;echo $&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">    def tempFolder &#x3D; &quot;&#x2F;tmp&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">    def git_commit_id &#x3D; &quot;&quot;</span><br><span class="line">    def artifact &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">    stage(&#39;Preparation&#39;) &#123;</span><br><span class="line">        deleteDir()</span><br><span class="line">        sh &quot;rm -rf $&#123; tempFolder &#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        stage(&#39;Clone from SCM&#39;) &#123;</span><br><span class="line">            &#x2F;&#x2F; checkout scm</span><br><span class="line">            checkout poll: false,</span><br><span class="line">                     scm: [$class: &#39;GitSCM&#39;,</span><br><span class="line">                           branches: [[name: &#39;master&#39;]],</span><br><span class="line">                                       doGenerateSubmoduleConfigurations: false,</span><br><span class="line">                                       submoduleCfg: [],</span><br><span class="line">                                       userRemoteConfigs: [[credentialsId: &#39;7bc6cda9-a250-4d99-962c-e2ede002db06&#39;,</span><br><span class="line">                                                            url: &#39;git@git.wecash.net:bi&#x2F;external-api.git&#39;]]]</span><br><span class="line">            git_commit_id &#x3D; sh(returnStdout: true, script: &#39;git rev-parse --short HEAD&#39;).trim() &#x2F;&#x2F;éœ€è¦è·å–shellè¿”å›å€¼æ“ä½œ</span><br><span class="line">            git_committer &#x3D; sh(returnStdout: true, script: &quot;git log -1 --format&#x3D;&#39;%ae&#39;&quot;).trim()</span><br><span class="line">            sh &quot;echo $&#123; git_committer &#125;&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Build&#39;) &#123;</span><br><span class="line">           withMaven(mavenSettingsConfig: &#39;02e95d2b-6bb6-457d-943f-13c63095e500&#39;,</span><br><span class="line">                  globalMavenSettingsConfig: &#39;bfa90212-2742-4611-aa71-8e0ec76d0c28&#39;,</span><br><span class="line">                  jdk: &#39;Oracle JDK 8&#39;, maven: &#39;Maven 3&#39;) &#123;</span><br><span class="line">                switch(env.BRANCH_NAME) &#123;</span><br><span class="line">                    case &quot;master&quot;:</span><br><span class="line">                        sh &quot;echo this is master branch.&quot;</span><br><span class="line">                        sh &quot;mvn clean install -Pprod -Dmaven.test.skip&#x3D;true&quot;</span><br><span class="line">                        break</span><br><span class="line">                    case &quot;dev&quot;:</span><br><span class="line">                        sh &quot;echo this is dev branch.&quot;</span><br><span class="line">                        sh &quot;mvn clean install -Pdev -Dmaven.test.skip&#x3D;true&quot;</span><br><span class="line">                        break</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Run Tests&#39;) &#123;</span><br><span class="line">            sh &quot;echo &#39;No tests to do.&#39;&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Update to Aliyun OSS&#39;) &#123;</span><br><span class="line">            sh &quot;mkdir -p $&#123; tempFolder &#125;&quot;</span><br><span class="line">            sh &quot;echo $&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">            sh &quot; echo $&#123; artifactOssPath &#125;&quot;</span><br><span class="line">            for ( servicePath in warFilePath ) &#123;</span><br><span class="line">                serviceName &#x3D; sh(returnStdout: true, script: &quot;basename $&#123; servicePath &#125; | cut -d . -f 1&quot;).trim()</span><br><span class="line">                serviceFullName &#x3D; sh(returnStdout: true, script: &quot;basename $&#123; servicePath &#125;&quot;).trim()</span><br><span class="line">                sh &quot;mv $&#123; servicePath &#125; $&#123; tempFolder &#125;&#x2F;$&#123; serviceFullName &#125;&quot;</span><br><span class="line">                artifact &#x3D; &quot;$&#123; serviceName &#125;_$&#123; env.BUILD_NUMBER &#125;-$&#123; env.BRANCH_NAME &#125;-$&#123; git_commit_id &#125;.tar.gz&quot;</span><br><span class="line">                sh &quot;mkdir -p $&#123; artifactsPath &#125; &amp;&amp; tar czf $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -C $&#123; tempFolder &#125; $&#123; serviceFullName &#125;&quot;</span><br><span class="line">                sh &quot;upload-flash -f $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -t $&#123; artifactOssPath &#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Archive artifacts&#39;) &#123;</span><br><span class="line">            archiveArtifacts allowEmptyArchive: true, artifacts: &quot;$&#123; artifactsPath &#125;&#x2F;*&quot;, fingerprint: true, onlyIfSuccessful: true</span><br><span class="line">            currentBuild.result &#x3D; &#39;SUCCESS&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (e) &#123;</span><br><span class="line">        currentBuild.result &#x3D; &quot;FAILED&quot;</span><br><span class="line">        throw e</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">&#x2F;&#x2F;        notifyBuild(currentBuild.result,git_committer)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def notifyBuild(String buildStatus &#x3D; &#39;STARTED&#39;,String GitCommitter) &#123;</span><br><span class="line">  &#x2F;&#x2F; build status of null means successful</span><br><span class="line">  buildStatus &#x3D;  buildStatus ?: &#39;SUCCESSFUL&#39;</span><br><span class="line"></span><br><span class="line">  def subject &#x3D; &quot;$&#123;buildStatus&#125;: Job &#39;$&#123;env.JOB_NAME&#125; [$&#123;env.BUILD_NUMBER&#125;]&#39;&quot;</span><br><span class="line">  def summary &#x3D; &quot;$&#123;subject&#125; ($&#123;env.BUILD_URL&#125;)&quot;</span><br><span class="line">  def details &#x3D; &quot;&quot;&quot;STARTED: Job &#39;$&#123;env.JOB_NAME&#125; [BUILD_NUMBER:$&#123;env.BUILD_NUMBER&#125;]&#39;</span><br><span class="line">                   Check console output at &quot;$&#123;env.BUILD_URL&#125;&quot;&gt;$&#123;env.JOB_NAME&#125; [$&#123;env.BUILD_NUMBER&#125;]&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; Send notifications</span><br><span class="line">  mail (</span><br><span class="line">      to: GitCommitter,</span><br><span class="line">      subject: subject,</span><br><span class="line">      body: details,</span><br><span class="line">      recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;]]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins file æ„å»ºç¤ºä¾‹</title>
    <url>/2020/04/20/Jenkins-file-%E6%9E%84%E5%BB%BA%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="Jenkins-file-æ„å»ºç¤ºä¾‹"><a href="#Jenkins-file-æ„å»ºç¤ºä¾‹" class="headerlink" title="Jenkins file æ„å»ºç¤ºä¾‹"></a>Jenkins file æ„å»ºç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;pipeline &#123;</span><br><span class="line">    &#x2F;&#x2F;åœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡ŒPipeline</span><br><span class="line">    &#x2F;&#x2F;</span><br><span class="line">    agent &#123;</span><br><span class="line">        node &#123;</span><br><span class="line">            label &quot;PTtest&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    options &#123;</span><br><span class="line">        buildDiscarder(logRotator(numToKeepStr: &#39;5&#39;))</span><br><span class="line">        disableConcurrentBuilds()</span><br><span class="line">    &#125;</span><br><span class="line">    tools &#123;</span><br><span class="line">        jdk &#39;Oracle JDK 8&#39;</span><br><span class="line">        maven &#39;Maven 3&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        def serviceName  &#x3D; &quot;&quot;</span><br><span class="line">        &#x2F;&#x2F; hosts must be splited by dot</span><br><span class="line">        def warFilePath &#x3D; &#39;mywo-crud-provider&#x2F;target&#x2F;mywo-crud-provider.war&#39;</span><br><span class="line">        def hosts &#x3D; &quot;10.41.118.137&quot;</span><br><span class="line">        def deploy_user &#x3D; &quot;app-deploy&quot;</span><br><span class="line">        def artifactsPath &#x3D; &quot;devops-artifacts&quot;</span><br><span class="line">        def department &#x3D; &quot;meiwozufang&quot;</span><br><span class="line">        def artifactOssPath &#x3D; &quot;$&#123; department &#125;&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">        def tempFolder &#x3D; &quot;$&#123; WORKSPACE &#125;&#x2F;$&#123; env.JOB_NAME &#125;&#x2F;$&#123; env.BUILD_NUMBER &#125;&quot;</span><br><span class="line">        def target_dir &#x3D; &quot;&#x2F;data&#x2F;services&#x2F;tomcat-mywo-crud-8090&quot;</span><br><span class="line">        def git_commit_id &#x3D; &quot;&quot;</span><br><span class="line">        def artifact &#x3D; &quot;&quot;</span><br><span class="line">        def jmeterHome &#x3D; &quot;&#x2F;home&#x2F;jenkins&#x2F;apache-jmeter-3.1&quot;</span><br><span class="line">        def antHome &#x3D; &quot;&#x2F;home&#x2F;jenkins&#x2F;apache-ant-1.9.9&quot;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&#39;Preparation&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;rm -rf &#x2F;tmp&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Checkout code&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;starting fetchCode......&quot;</span><br><span class="line">                checkout scm</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;SonarQube analysis&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;starting codeAnalyze......&quot;</span><br><span class="line">                script &#123;</span><br><span class="line">                    echo &quot;starting script......&quot;</span><br><span class="line">                    def sonarqubeScannerHome &#x3D; tool name: &#39;SonarQube Scanner&#39;</span><br><span class="line">                    withSonarQubeEnv(&#39;SonarQube-Public&#39;) &#123;</span><br><span class="line">                        sh &quot;$&#123;sonarqubeScannerHome&#125;&#x2F;bin&#x2F;sonar-scanner&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#x2F;&#x2F;       stage(&quot;SonarQube Quality Gate&quot;) &#123;</span><br><span class="line"> &#x2F;&#x2F;           when &#123;</span><br><span class="line"> &#x2F;&#x2F;               branch fuck</span><br><span class="line"> &#x2F;&#x2F;           &#125;</span><br><span class="line"> &#x2F;&#x2F;           steps &#123;</span><br><span class="line"> &#x2F;&#x2F;               echo &quot;starting waitForQualityGate......&quot;</span><br><span class="line"> &#x2F;&#x2F;               script &#123;</span><br><span class="line"> &#x2F;&#x2F;                   echo &quot;starting script......&quot;</span><br><span class="line"> &#x2F;&#x2F;                    timeout(time: 1, unit: &#39;HOURS&#39;) &#123;</span><br><span class="line"> &#x2F;&#x2F;                      def qg &#x3D; waitForQualityGate()</span><br><span class="line"> &#x2F;&#x2F;                      if (qg.status !&#x3D; &#39;OK&#39;) &#123;</span><br><span class="line"> &#x2F;&#x2F;                         error &quot;Pipeline aborted due to quality gate failure: $&#123;qg.status&#125;&quot;</span><br><span class="line"> &#x2F;&#x2F;                      &#125;</span><br><span class="line"> &#x2F;&#x2F;                    &#125;</span><br><span class="line"> &#x2F;&#x2F;               &#125;</span><br><span class="line"> &#x2F;&#x2F;           &#125;</span><br><span class="line"> &#x2F;&#x2F;       &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Compile branch master&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;master&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                withMaven(globalMavenSettingsConfig: &#39;bfa90212-2742-4611-aa71-8e0ec76d0c28&#39;, jdk: &#39;Oracle JDK 8&#39;, maven: &#39;Maven 3&#39;, mavenSettingsConfig: &#39;02e95d2b-6bb6-457d-943f-13c63095e500&#39;) &#123;</span><br><span class="line">                    sh &quot;mvn -Dmaven.test.skip&#x3D;true  clean package -U -DskipTests&#x3D;True&quot;</span><br><span class="line">                    sh &quot;echo this is master branch.&quot;</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Compile branch test&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                withMaven(globalMavenSettingsConfig: &#39;bfa90212-2742-4611-aa71-8e0ec76d0c28&#39;, jdk: &#39;Oracle JDK 8&#39;, maven: &#39;Maven 3&#39;, mavenSettingsConfig: &#39;02e95d2b-6bb6-457d-943f-13c63095e500&#39;) &#123;</span><br><span class="line">                    sh &quot;mvn -Dmaven.test.skip&#x3D;true  clean package -U -DskipTests&#x3D;True&quot;</span><br><span class="line">                    sh &quot;echo this is test branch.&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Package &amp; Upload to OSS&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;mkdir -p $&#123; tempFolder &#125;&quot;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh &quot;echo Upload to OSS.&quot;</span><br><span class="line">                    git_commit_id &#x3D; sh(returnStdout: true, script: &#39;git rev-parse --short HEAD&#39;).trim() &#x2F;&#x2F;éœ€è¦è·å–shellè¿”å›å€¼æ“ä½œ</span><br><span class="line">                    serviceName &#x3D; sh(returnStdout: true, script: &quot;basename $&#123; warFilePath &#125; | cut -d . -f 1&quot;).trim()</span><br><span class="line">                    sh &quot;mv $&#123; warFilePath &#125; $&#123; tempFolder &#125;&#x2F;ROOT.war&quot;</span><br><span class="line">                    artifact &#x3D; &quot;$&#123; serviceName &#125;_$&#123; env.BUILD_NUMBER &#125;-$&#123; env.BRANCH_NAME &#125;-$&#123; git_commit_id &#125;.tar.gz&quot;</span><br><span class="line">                    sh &quot;mkdir -p $&#123; artifactsPath &#125; &amp;&amp; tar czf $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -C $&#123; tempFolder &#125; ROOT.war&quot;</span><br><span class="line">                    sh &quot;upload-flash -f $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -t $&#123; artifactOssPath &#125;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Deploy Package&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    echo &quot;starting deploy......&quot;</span><br><span class="line">                    &#x2F;&#x2F; è¿ç»´äººå‘˜ç»´æŠ¤ç§æœ‰ä»“åº“ï¼Œä¿å­˜ansible-playbookçš„é…ç½®æ–‡ä»¶</span><br><span class="line">                    git([url: &#39;git@git.shuke.com:shuke&#x2F;ansiblefiles.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7bc6cda9-a250-4d99-962c-e2ede002db06&#39;])</span><br><span class="line">                    withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;ansible_deploy:1.0.4&#39;]) &#123;</span><br><span class="line">                            sh &quot;ansible-playbook -i hosts --extra-vars &#39;warFilePath&#x3D;$&#123; tempFolder &#125;&#x2F;ROOT.war target_dir&#x3D;$&#123; target_dir &#125;&#39; -vv deploy_war.yml -l $&#123; hosts &#125;&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Integration Test&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            parallel &#123;</span><br><span class="line">                stage(&#39;API Test&#39;) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo &quot;starting API......&quot;  </span><br><span class="line">                        echo &quot;starting fetchAPI......&quot;</span><br><span class="line">                        dir(&#39;API&#39;) &#123;</span><br><span class="line">                            echo &quot;starting APIScript......&quot;</span><br><span class="line">                            git([url: &#39;git@git.shuke.com:api_test&#x2F;RentHouse.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                            script &#123;</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;robotframework:1.0.1&#39;]) &#123;</span><br><span class="line">                                            sh &quot;pybot RentHouse_API_Test&#x2F;test&quot;</span><br><span class="line">                                        &#125; </span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;catch (exc) &#123;</span><br><span class="line">                                   echo &#39;Something failed, I should sound the klaxons!&#39;</span><br><span class="line">                                   emailContent &#x3D;  &quot;APIæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">                                &#125;finally&#123;</span><br><span class="line">                                  sh &quot;cp -r .&#x2F;output.xml &#x2F;home&#x2F;jenkins&#x2F;public&#x2F;outputRentHouse_API_Prduction.xml&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">&#x2F;&#x2F;                stage(&#39;UI&#39;) &#123;</span><br><span class="line">&#x2F;&#x2F;                    steps &#123;</span><br><span class="line">&#x2F;&#x2F;                      echo &quot;starting UI......&quot;</span><br><span class="line">&#x2F;&#x2F;                    &#x2F;&#x2F;   æµ‹è¯•é—ªé“¶UI</span><br><span class="line">&#x2F;&#x2F;                        dir(&#39;UI&#39;) &#123;</span><br><span class="line">&#x2F;&#x2F;                            git([url: &#39;git@git.shuke.com:ui_test&#x2F;Wecash_RentalHouse.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">&#x2F;&#x2F;                            script &#123;</span><br><span class="line">&#x2F;&#x2F;                                echo &quot;starting UIScript......&quot;</span><br><span class="line">&#x2F;&#x2F;                                try &#123;</span><br><span class="line">&#x2F;&#x2F;                                   &#x2F;&#x2F;sh &quot;cd &#x2F;gg&quot;</span><br><span class="line">&#x2F;&#x2F;                                   echo &quot;starting UIScript......&quot;</span><br><span class="line">&#x2F;&#x2F;                                   &#x2F;&#x2F; æ‰§è¡Œé€Ÿåº¦å¤ªæ…¢ï¼Œå…ˆæ³¨é‡Šä»£ç </span><br><span class="line">&#x2F;&#x2F;                                   withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">&#x2F;&#x2F;                                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;python-chromedriver:2.7-alpine3.7-selenium&#39;]) &#123;</span><br><span class="line">&#x2F;&#x2F;                                            sh &quot;python TestSuite&#x2F;Runner.py All All business-renthouse&quot;</span><br><span class="line">&#x2F;&#x2F;                                        &#125;</span><br><span class="line">&#x2F;&#x2F;                                    &#125;</span><br><span class="line">&#x2F;&#x2F;                                    sh &quot;&#x2F;usr&#x2F;bin&#x2F;python TestSuite&#x2F;Runner.py All All business-renthouse&quot;</span><br><span class="line">&#x2F;&#x2F;                                &#125;catch (exc) &#123;</span><br><span class="line">&#x2F;&#x2F;                                   echo &#39;Something failed, I should sound the klaxons!&#39;</span><br><span class="line">&#x2F;&#x2F;                                   emailContent &#x3D; &quot;UIæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">&#x2F;&#x2F;                                &#125;</span><br><span class="line">&#x2F;&#x2F;                            &#125;</span><br><span class="line">&#x2F;&#x2F;                        &#125;</span><br><span class="line">&#x2F;&#x2F;                    &#125;</span><br><span class="line">&#x2F;&#x2F;                &#125;</span><br><span class="line">                stage(&#39;PT&#39;) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo &quot;starting PT......&quot;</span><br><span class="line">                        dir(&#39;PT&#39;) &#123;</span><br><span class="line">                            git credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;, url: &#39;git@git.shuke.com:p_test&#x2F;MeiWo.git&#39;</span><br><span class="line">                        &#125;</span><br><span class="line">                        dir(&#39;Tools&#39;) &#123;</span><br><span class="line">                            script &#123;</span><br><span class="line">                                echo &quot;starting PTScript......&quot;</span><br><span class="line">                                git([url: &#39;git@git.shuke.com:gonghui&#x2F;script.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    withEnv([&quot;JAVA_HOME&#x3D;$&#123;tool &#39;Oracle JDK 8&#39;&#125;&quot;]) &#123;</span><br><span class="line">                                        sh &quot;$&#123;antHome&#125;&#x2F;bin&#x2F;ant -f $&#123; WORKSPACE &#125;&#x2F;Tools&#x2F;PerformFilesWithPipline&#x2F;build.xml -Dname&#x3D;MeiWo -Denv&#x3D;Test -DJOB_NAME&#x3D;$&#123;JOB_NAME&#125; -DWORKSPACE&#x3D;$&#123;WORKSPACE&#125; -DjmeterHome&#x3D;$&#123;jmeterHome&#125; run&quot;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    echo &quot;starting PTAnalyze......&quot;</span><br><span class="line">                                    sh &quot;python $&#123; WORKSPACE &#125;&#x2F;Tools&#x2F;PerformFilesWithPipline&#x2F;jmeterQYWeiXinWithTimeoutArgu.py $&#123; WORKSPACE &#125;&#x2F;PT&#x2F;results&#x2F; MeiWo 2 5 500 4000&quot;</span><br><span class="line">                                    sh &quot;cp -r $&#123; WORKSPACE &#125;&#x2F;PT&#x2F;results&#x2F;ParseOri.html &#x2F;home&#x2F;jenkins&#x2F;public&#x2F;&quot;</span><br><span class="line">                                &#125;catch (exc) &#123;</span><br><span class="line">                                    echo &#39;PTæ‰§è¡ŒæŠ¥é”™äº†!!&#39;</span><br><span class="line">                                    emailContent &#x3D; &quot;PTæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;conformReport&amp;noticify&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                 echo &quot;starting email......&quot;</span><br><span class="line">                 </span><br><span class="line">                dir(&#39;conformresult&#39;) &#123;</span><br><span class="line">                    script&#123;</span><br><span class="line">                        git([url: &#39;git@git.shuke.com:gonghui&#x2F;script.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                        withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                            withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;python3.6.5:1.0.0&#39;,args: &#39;-v &#x2F;data&#x2F;docker&#x2F;jenkins-slave-prod&#x2F;public:&#x2F;home&#x2F;jenkins&#x2F;public&#39;]) &#123;</span><br><span class="line">                                sh &quot;python3 parseScript&#x2F;conformReport.py &#x2F;home&#x2F;jenkins&#x2F;public $&#123; email_list &#125; $&#123;JOB_NAME&#125;-Build&#x2F;&#x2F;$&#123;BUILD_ID&#125;-&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            echo &#39;always!&#39;</span><br><span class="line">            deleteDir()</span><br><span class="line">        &#125;</span><br><span class="line">        success &#123;</span><br><span class="line">            emailext body: &quot;Pipeline Success: Please Go to deploy if you pushed master just now&quot;,</span><br><span class="line">                recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;], [$class: &#39;RequesterRecipientProvider&#39;]],</span><br><span class="line">                subject: &quot;&#39;$&#123;JOB_NAME&#125;&#39; ($&#123;BUILD_NUMBER&#125;)times SUCCESS&quot;,</span><br><span class="line">                to: &#39;&#39;</span><br><span class="line">            echo &#39;success!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            emailext body: &quot;Pipeline error: Please go to $&#123;BUILD_URL&#125; and verify the build \n $&#123; emailContent &#125;&quot;,</span><br><span class="line">                recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;], [$class: &#39;RequesterRecipientProvider&#39;]],</span><br><span class="line">                subject: &quot;&#39;$&#123;JOB_NAME&#125;&#39; ($&#123;BUILD_NUMBER&#125;)times FAILED&quot;,</span><br><span class="line">                to: &#39;&#39;</span><br><span class="line">            echo &#39;failure!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        unstable &#123;</span><br><span class="line">            echo &#39;unstable!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        changed &#123;</span><br><span class="line">            echo &#39;changed!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Jenkins-python-deploy</title>
    <url>/2020/04/20/Jenkins-python-deploy/</url>
    <content><![CDATA[<h2 id="Jenkins-python-deploy"><a href="#Jenkins-python-deploy" class="headerlink" title="Jenkins python deploy"></a>Jenkins python deploy</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">echo $WORKSPACE</span><br><span class="line">PROJECT_NAME&#x3D;$&#123;JOB_NAME#*-&#125;</span><br><span class="line">PLAYBOOK_PATH&#x3D;$&#123;WORKSPACE&#125;&#x2F;..&#x2F;brazil_ansible_playbook</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># éƒ¨ç½²</span><br><span class="line">cd $&#123;PLAYBOOK_PATH&#125;</span><br><span class="line">ansible-playbook -l $&#123;Host&#125; \</span><br><span class="line">-i $&#123;PLAYBOOK_PATH&#125;&#x2F;inventory&#x2F;brazil  \</span><br><span class="line">$&#123;PLAYBOOK_PATH&#125;&#x2F;python_deploy.yml \</span><br><span class="line">-e &quot;&#123;&#39;deploy_from&#39;: &#39;$&#123;WORKSPACE&#125;&#39;,&#39;deploy_dest&#39;:&#39;&#x2F;data&#x2F;services&#x2F;$&#123;PROJECT_NAME&#125;&#39;,&#39;project_name&#39;: &#39;$&#123;PROJECT_NAME&#125;&#39;, &#39;python_version&#39;: &#39;3.6&#39;,&#39;conda_env&#39;: &#39;$&#123;PROJECT_NAME&#125;&#39;,&#39;task_name&#39;: &#39;gunicorn&#39;, &#39;run_file&#39;: &#39;server.py&#39;&#125;&quot; --tags  update_code,envs_init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># RESTART</span><br><span class="line">ansible -i $&#123;PLAYBOOK_PATH&#125;&#x2F;inventory&#x2F;brazil $&#123;Host&#125; -m shell -a &quot;supervisorctl restart $&#123;PROJECT_NAME&#125;&quot; -b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># STATUS</span><br><span class="line">ansible -i $&#123;PLAYBOOK_PATH&#125;&#x2F;inventory&#x2F;brazil $&#123;Host&#125; -m shell -a &quot;supervisorctl status $&#123;PROJECT_NAME&#125;&quot; -b</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>Kong-api-gateway</title>
    <url>/2020/04/20/Kong-api-gateway/</url>
    <content><![CDATA[<h1 id="Kong-api-gateway"><a href="#Kong-api-gateway" class="headerlink" title="Kong-api-gateway"></a>Kong-api-gateway</h1><hr>

<p><a href="https://getkong.org" target="_blank" rel="noopener">Kongå®˜æ–¹ç½‘ç«™</a></p>
<h2 id="1-Install"><a href="#1-Install" class="headerlink" title="1. Install"></a>1. Install</h2><p><a href="https://konghq.com/install/" target="_blank" rel="noopener">install-kong</a></p>
<h2 id="2-postgresql"><a href="#2-postgresql" class="headerlink" title="2. postgresql"></a>2. postgresql</h2><ol>
<li>å®‰è£…<br>sudo apt-get install postgresql-9.6<br>å®‰è£…å®Œæˆåï¼Œé»˜è®¤ä¼šï¼š</li>
</ol>
<p>ï¼ˆ1ï¼‰åˆ›å»ºåä¸ºâ€postgresâ€çš„Linuxç”¨æˆ·</p>
<p>ï¼ˆ2ï¼‰åˆ›å»ºåä¸ºâ€postgresâ€ã€ä¸å¸¦å¯†ç çš„é»˜è®¤æ•°æ®åº“è´¦å·ä½œä¸ºæ•°æ®åº“ç®¡ç†å‘˜</p>
<p>ï¼ˆ3ï¼‰åˆ›å»ºåä¸ºâ€postgresâ€çš„è¡¨</p>
<p>å®‰è£…å®Œæˆåçš„ä¸€äº›é»˜è®¤ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<p>config /etc/postgresql/9.5/main<br>data /var/lib/postgresql/9.5/main<br>locale en_US.UTF-8<br>socket /var/run/postgresql<br>port 5432</p>
<p>å®‰è£…å®Œåä¼šæœ‰PostgreSQLçš„å®¢æˆ·ç«¯psqlï¼Œé€šè¿‡ sudo -u postgres psql è¿›å…¥ï¼Œæç¤ºç¬¦å˜æˆï¼š postgres=#<br>åœ¨è¿™é‡Œå¯ç”¨æ‰§è¡ŒSQLè¯­å¥å’Œpsqlçš„åŸºæœ¬å‘½ä»¤ã€‚å¯ç”¨çš„åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\passwordï¼šè®¾ç½®å¯†ç </span><br><span class="line">\qï¼šé€€å‡º</span><br><span class="line">\hï¼šæŸ¥çœ‹SQLå‘½ä»¤çš„è§£é‡Šï¼Œæ¯”å¦‚\h selectã€‚</span><br><span class="line">\?ï¼šæŸ¥çœ‹psqlå‘½ä»¤åˆ—è¡¨ã€‚</span><br><span class="line">\lï¼šåˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ã€‚</span><br><span class="line">\c [database_name]ï¼šè¿æ¥å…¶ä»–æ•°æ®åº“ã€‚</span><br><span class="line">\dï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨æ ¼ã€‚</span><br><span class="line">\d [table_name]ï¼šåˆ—å‡ºæŸä¸€å¼ è¡¨æ ¼çš„ç»“æ„ã€‚</span><br><span class="line">\duï¼šåˆ—å‡ºæ‰€æœ‰ç”¨æˆ·ã€‚</span><br><span class="line">\eï¼šæ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨ã€‚</span><br><span class="line">\conninfoï¼šåˆ—å‡ºå½“å‰æ•°æ®åº“å’Œè¿æ¥çš„ä¿¡æ¯ã€‚</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç <br>ä»¥Linuxç”¨æˆ·â€postgresâ€çš„èº«ä»½ï¼ˆæ­¤æ—¶åªæœ‰è¯¥ç”¨æˆ·æœ‰psqlå‘½ä»¤ï¼‰æ‰§è¡Œpsqlå®¢æˆ·ç«¯ï¼Œè¿›å…¥è¯¥å®¢æˆ·ç«¯çš„æç¤ºç¬¦ç•Œé¢ï¼ˆè¿™é‡Œç³»ç»Ÿç”¨æˆ·åã€æ•°æ®åº“ç”¨æˆ·åã€æ•°æ®åº“åéƒ½ä¸ºpostgresï¼Œæ•…å¯é‡‡ç”¨ç®€å†™å½¢å¼ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo -u postgres psql</span><br><span class="line">postgres&#x3D;# alter user postgres with password &#39;123456&#39;;</span><br></pre></td></tr></table></figure>
<p>è‹¥è¦åˆ é™¤è¯¥ç®¡ç†å‘˜çš„å¯†ç ï¼Œåˆ™å¯ç”¨å‘½ä»¤ï¼šsudo -u postgres psql -d postgres</p>
</li>
<li><p>é…ç½®è¿œç¨‹è¿æ¥<br>å®‰è£…å®Œæˆåï¼Œé»˜è®¤åªèƒ½æœ¬åœ°æ‰èƒ½è¿æ¥æ•°æ®åº“ï¼Œå…¶ä»–æœºå­è®¿é—®ä¸äº†ï¼Œéœ€è¦è¿›è¡Œé…ç½®ã€‚ï¼ˆä»¥ä¸‹ç¤ºä¾‹å¼€æ”¾äº†æœ€å¤§è¿æ¥æƒé™ï¼Œå®é™…é…ç½®æ ¹æ®ä½ çš„éœ€è¦è€Œå®šï¼‰</p>
</li>
<li><p>1 ä¿®æ”¹ç›‘å¬åœ°å€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;postgresql&#x2F;9.5&#x2F;main&#x2F;postgresql.conf </span><br><span class="line">å°† #listen_addresses &#x3D; &#39;localhost&#39; çš„æ³¨é‡Šå»æ‰å¹¶æ”¹ä¸º listen_addresses &#x3D; &#39;*&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>ä¿®æ”¹å¯è®¿é—®ç”¨æˆ·çš„IPæ®µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo gedit &#x2F;etc&#x2F;postgresql&#x2F;9.5&#x2F;main&#x2F;pg_hba.conf </span><br><span class="line">åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š host all all 0.0.0.0 0.0.0.0 md5 ï¼Œè¡¨ç¤ºå…è®¸ä»»ä½•IPè¿æ¥</span><br></pre></td></tr></table></figure></li>
<li><p>å¯åŠ¨æ•°æ®åº“</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;postgresql start</span><br></pre></td></tr></table></figure></li>
<li><p>æ·»åŠ ç”¨æˆ·åŠæˆæƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¿è¡Œç³»ç»Ÿç”¨æˆ·&quot;postgres&quot;çš„psqlå‘½ä»¤ï¼Œè¿›å…¥å®¢æˆ·ç«¯ï¼š</span><br><span class="line">sudo -u postgres psql</span><br><span class="line">åˆ›å»ºç”¨æˆ·&quot;kong&quot;å¹¶è®¾ç½®å¯†ç ï¼š</span><br><span class="line">postgres&#x3D;# create user kong with password &#39;123456&#39;;</span><br><span class="line">åˆ›å»ºæ•°æ®åº“kongï¼Œæ‰€æœ‰è€…ä¸ºkongï¼š</span><br><span class="line">postgres&#x3D;# create database kong owner kong;</span><br><span class="line">å°†konhgæ•°æ®åº“çš„æ‰€æœ‰æƒé™èµ‹äºˆkongç”¨æˆ·ï¼Œå¦åˆ™kongåªèƒ½ç™»å½•psqlï¼Œæ²¡æœ‰ä»»ä½•æ•°æ®åº“æ“ä½œæƒé™ï¼š</span><br><span class="line">grant all privileges on database kong to kong;. æ·»åŠ ç”¨æˆ·åŠæˆæƒ</span><br></pre></td></tr></table></figure></li>
<li><p>æŸ¥çœ‹<br>postgres=# \du å¾—åˆ°ç”¨æˆ·åˆ—è¡¨<br>postgres=# \l  å¾—åˆ°æ•°æ®åº“åˆ—è¡¨<br>åˆ é™¤<br>postgres=# drop database kong<br>postgres=# drop user kong</p>
</li>
<li><p>å¸¸ç”¨æ“ä½œå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ›å»ºæ–°è¡¨ </span><br><span class="line">CREATE TABLE user_tbl(name VARCHAR(20), signup_date DATE);</span><br><span class="line"># æ’å…¥æ•°æ® </span><br><span class="line">INSERT INTO user_tbl(name, signup_date) VALUES(&#39;å¼ ä¸‰&#39;, &#39;2013-12-22&#39;);</span><br><span class="line"># é€‰æ‹©è®°å½• </span><br><span class="line">SELECT * FROM user_tbl;</span><br><span class="line"># æ›´æ–°æ•°æ® </span><br><span class="line">UPDATE user_tbl set name &#x3D; &#39;æå››&#39; WHERE name &#x3D; &#39;å¼ ä¸‰&#39;;</span><br><span class="line"># åˆ é™¤è®°å½• </span><br><span class="line">DELETE FROM user_tbl WHERE name &#x3D; &#39;æå››&#39; ;</span><br><span class="line"># æ·»åŠ æ ä½ </span><br><span class="line">ALTER TABLE user_tbl ADD email VARCHAR(40);</span><br><span class="line"># æ›´æ–°ç»“æ„ </span><br><span class="line">ALTER TABLE user_tbl ALTER COLUMN signup_date SET NOT NULL;</span><br><span class="line"># æ›´åæ ä½ </span><br><span class="line">ALTER TABLE user_tbl RENAME COLUMN signup_date TO signup;</span><br><span class="line"># åˆ é™¤æ ä½ </span><br><span class="line">ALTER TABLE user_tbl DROP COLUMN email;</span><br><span class="line"># è¡¨æ ¼æ›´å </span><br><span class="line">ALTER TABLE user_tbl RENAME TO backup_tbl;</span><br><span class="line"># åˆ é™¤è¡¨æ ¼ </span><br><span class="line">DROP TABLE IF EXISTS backup_tbl;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="3-Kong-Dashboard"><a href="#3-Kong-Dashboard" class="headerlink" title="3. Kong-Dashboard"></a>3. Kong-Dashboard</h2><ul>
<li><a href="https://github.com/pantsel/konga" target="_blank" rel="noopener">Konga</a></li>
<li><a href="https://www.npmjs.com/package/kong-dashboard" target="_blank" rel="noopener">Kong-dashboard-node</a></li>
<li><a href="https://github.com/PGBI/kong-dashboard" target="_blank" rel="noopener">Kong-dashboard-github</a></li>
</ul>
]]></content>
      <categories>
        <category>Kong</category>
      </categories>
      <tags>
        <tag>Kong</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkins-python-api</title>
    <url>/2020/04/20/Jenkins-python-api/</url>
    <content><![CDATA[<h1 id="Jenkins-python-api"><a href="#Jenkins-python-api" class="headerlink" title="Jenkins-python-api"></a>Jenkins-python-api</h1><hr>

<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Jenkinsä½œä¸ºæœ€æµè¡Œçš„è‡ªåŠ¨åŒ–æµç¨‹çš„æ ¸å¿ƒå·¥å…·ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒè‡ªå¸¦çš„web-uiå®Œå…¨å¯ä»¥æ»¡è¶³æ—¥å¸¸çš„æ„å»ºåŠå‘å¸ƒå·¥ä½œï¼Œä½†æ˜¯å¦‚æœéœ€è¦å’Œå…¶ä»–ç³»ç»Ÿåšé›†æˆå°±å¿…é¡»äºŒæ¬¡å¼€å‘æˆ–è€…é€šè¿‡APIæ–¹å¼è¿›è¡Œäº¤äº’äº†ã€‚</p>
<h2 id="Jenkinsä»‹ç»åŠç›¸å…³"><a href="#Jenkinsä»‹ç»åŠç›¸å…³" class="headerlink" title="Jenkinsä»‹ç»åŠç›¸å…³"></a>Jenkinsä»‹ç»åŠç›¸å…³</h2><p><a href="https://www.w3cschool.cn/jenkins/jenkins-5h3228n2.html" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a></p>
<h2 id="pythonç‰ˆæœ¬çš„APIè°ƒç”¨"><a href="#pythonç‰ˆæœ¬çš„APIè°ƒç”¨" class="headerlink" title="pythonç‰ˆæœ¬çš„APIè°ƒç”¨"></a>pythonç‰ˆæœ¬çš„APIè°ƒç”¨</h2><h3 id="ç›®å‰pythonç‰ˆæœ¬çš„APIä¸»è¦æœ‰ä¸¤ä¸ªç¬¬ä¸‰æ–¹åŒ…"><a href="#ç›®å‰pythonç‰ˆæœ¬çš„APIä¸»è¦æœ‰ä¸¤ä¸ªç¬¬ä¸‰æ–¹åŒ…" class="headerlink" title="ç›®å‰pythonç‰ˆæœ¬çš„APIä¸»è¦æœ‰ä¸¤ä¸ªç¬¬ä¸‰æ–¹åŒ…"></a>ç›®å‰pythonç‰ˆæœ¬çš„APIä¸»è¦æœ‰ä¸¤ä¸ªç¬¬ä¸‰æ–¹åŒ…</h3><ol>
<li>JenkinsApi</li>
</ol>
<ul>
<li><a href="https://github.com/pycontribs/jenkinsapi" target="_blank" rel="noopener">github</a></li>
<li><a href="https://jenkinsapi.readthedocs.io/en/latest/api.html" target="_blank" rel="noopener">æ–‡æ¡£</a></li>
</ul>
<ol start="2">
<li>Python Jenkins</li>
</ol>
<ul>
<li><a href="https://github.com/openstack/python-jenkins" target="_blank" rel="noopener">github</a></li>
<li><a href="http://python-jenkins.readthedocs.io/en/latest/api.html" target="_blank" rel="noopener">æ–‡æ¡£</a></li>
</ul>
<h2 id="APIç¤ºä¾‹"><a href="#APIç¤ºä¾‹" class="headerlink" title="APIç¤ºä¾‹"></a>APIç¤ºä¾‹</h2><h3 id="JenkinsAPiæ¨¡å—"><a href="#JenkinsAPiæ¨¡å—" class="headerlink" title="JenkinsAPiæ¨¡å—"></a>JenkinsAPiæ¨¡å—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;1&#x2F;17</span><br><span class="line"></span><br><span class="line">from jenkinsapi.jenkins import Jenkins</span><br><span class="line">from jenkinsapi.build import Build</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_server_instance():</span><br><span class="line">    jenkins_url &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;</span><br><span class="line">    server &#x3D; Jenkins(jenkins_url, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;)</span><br><span class="line">    return server</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">server &#x3D; get_server_instance()</span><br><span class="line"></span><br><span class="line"># 1. ç‰ˆæœ¬</span><br><span class="line">print(server.version)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">2.101</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 2. æ‰€æœ‰çš„jobåˆ—è¡¨</span><br><span class="line">print(server.keys())</span><br><span class="line">print(server.get_jobs_list())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#39;ansible-playbook&#39;, &#39;my-github&#39;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 3. å…¨å±€ä¿¡æ¯æŸ¥çœ‹</span><br><span class="line">server.pprint()</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.Hudson&#39;,</span><br><span class="line"> &#39;jobs&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;,</span><br><span class="line">           &#39;color&#39;: &#39;blue&#39;,</span><br><span class="line">           &#39;name&#39;: &#39;ansible-playbook&#39;,</span><br><span class="line">           &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;&#125;,</span><br><span class="line">          &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;,</span><br><span class="line">           &#39;color&#39;: &#39;disabled&#39;,</span><br><span class="line">           &#39;name&#39;: &#39;my-github&#39;,</span><br><span class="line">           &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;&#125;]&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 3. æŒ‡å®šjobçš„config.xmlé…ç½®</span><br><span class="line">print(&quot;my-github job config:\n&quot;, server[&#39;my-github&#39;].get_config())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">my-github job config:</span><br><span class="line"> &lt;?xml version&#x3D;&#39;1.0&#39; encoding&#x3D;&#39;UTF-8&#39;?&gt;</span><br><span class="line">&lt;project&gt;</span><br><span class="line">  &lt;actions&#x2F;&gt;</span><br><span class="line">  &lt;description&gt;&lt;&#x2F;description&gt;</span><br><span class="line">  &lt;keepDependencies&gt;false&lt;&#x2F;keepDependencies&gt;</span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;com.coravy.hudson.plugins.github.GithubProjectProperty plugin&#x3D;&quot;github@1.28.1&quot;&gt;</span><br><span class="line">      &lt;projectUrl&gt;https:&#x2F;&#x2F;github.com&#x2F;shuke163&#x2F;CustAdmin.git&#x2F;&lt;&#x2F;projectUrl&gt;</span><br><span class="line">      &lt;displayName&gt;Admin&lt;&#x2F;displayName&gt;</span><br><span class="line">    &lt;&#x2F;com.coravy.hudson.plugins.github.GithubProjectProperty&gt;</span><br><span class="line">    &lt;jenkins.model.BuildDiscarderProperty&gt;</span><br><span class="line">      &lt;strategy class&#x3D;&quot;hudson.tasks.LogRotator&quot;&gt;</span><br><span class="line">        &lt;daysToKeep&gt;-1&lt;&#x2F;daysToKeep&gt;</span><br><span class="line">        &lt;numToKeep&gt;5&lt;&#x2F;numToKeep&gt;</span><br><span class="line">        &lt;artifactDaysToKeep&gt;-1&lt;&#x2F;artifactDaysToKeep&gt;</span><br><span class="line">        &lt;artifactNumToKeep&gt;-1&lt;&#x2F;artifactNumToKeep&gt;</span><br><span class="line">      &lt;&#x2F;strategy&gt;</span><br><span class="line">    &lt;&#x2F;jenkins.model.BuildDiscarderProperty&gt;</span><br><span class="line">    &lt;hudson.model.ParametersDefinitionProperty&gt;</span><br><span class="line">      &lt;parameterDefinitions&gt;</span><br><span class="line">        &lt;hudson.model.ChoiceParameterDefinition&gt;</span><br><span class="line">          &lt;name&gt;ip&lt;&#x2F;name&gt;</span><br><span class="line">          &lt;description&gt;ip&lt;&#x2F;description&gt;</span><br><span class="line">          &lt;choices class&#x3D;&quot;java.util.Arrays$ArrayList&quot;&gt;</span><br><span class="line">            &lt;a class&#x3D;&quot;string-array&quot;&gt;</span><br><span class="line">              &lt;string&gt;127.0.0.1&lt;&#x2F;string&gt;</span><br><span class="line">            &lt;&#x2F;a&gt;</span><br><span class="line">          &lt;&#x2F;choices&gt;</span><br><span class="line">        &lt;&#x2F;hudson.model.ChoiceParameterDefinition&gt;</span><br><span class="line">      &lt;&#x2F;parameterDefinitions&gt;</span><br><span class="line">    &lt;&#x2F;hudson.model.ParametersDefinitionProperty&gt;</span><br><span class="line">  &lt;&#x2F;properties&gt;</span><br><span class="line">  &lt;scm class&#x3D;&quot;hudson.scm.NullSCM&quot;&#x2F;&gt;</span><br><span class="line">  &lt;canRoam&gt;true&lt;&#x2F;canRoam&gt;</span><br><span class="line">  &lt;disabled&gt;true&lt;&#x2F;disabled&gt;</span><br><span class="line">  &lt;blockBuildWhenDownstreamBuilding&gt;false&lt;&#x2F;blockBuildWhenDownstreamBuilding&gt;</span><br><span class="line">  &lt;blockBuildWhenUpstreamBuilding&gt;false&lt;&#x2F;blockBuildWhenUpstreamBuilding&gt;</span><br><span class="line">  &lt;triggers&#x2F;&gt;</span><br><span class="line">  &lt;concurrentBuild&gt;false&lt;&#x2F;concurrentBuild&gt;</span><br><span class="line">  &lt;builders&gt;</span><br><span class="line">    &lt;hudson.tasks.Shell&gt;</span><br><span class="line">      &lt;command&gt;echo $ip&lt;&#x2F;command&gt;</span><br><span class="line">    &lt;&#x2F;hudson.tasks.Shell&gt;</span><br><span class="line">  &lt;&#x2F;builders&gt;</span><br><span class="line">  &lt;publishers&#x2F;&gt;</span><br><span class="line">  &lt;buildWrappers&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 4. å¾—åˆ°çš„æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰jobsçš„ç”Ÿæˆå™¨å¯¹è±¡</span><br><span class="line">print(server.get_jobs())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#39;ansible-playbook&#39;, &#39;my-github&#39;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 5. æ‰€æœ‰çš„jobæè¿°</span><br><span class="line">for job_name, job_instance in server.get_jobs():</span><br><span class="line">    print(&#39;Job Name:%s&#39; % (job_instance.name))</span><br><span class="line">    print(&#39;Job Description:%s&#39; % (job_instance.get_description()))</span><br><span class="line">    print(&#39;Is Job running:%s&#39; % (job_instance.is_running()))</span><br><span class="line">    print(&#39;Is Job enabled:%s&#39; % (job_instance.is_enabled()))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Job Name:ansible-playbook</span><br><span class="line">Job Description:ansible playbook</span><br><span class="line">Is Job running:False</span><br><span class="line">Is Job enabled:True</span><br><span class="line">Job Name:my-github</span><br><span class="line">Job Description:</span><br><span class="line">Is Job running:False</span><br><span class="line">Is Job enabled:True</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 6. Disable&#x2F;Enable a Jenkins Job</span><br><span class="line">job_name &#x3D; &#39;my-github&#39;</span><br><span class="line">if (server.has_job(job_name)):</span><br><span class="line">    job_instance &#x3D; server.get_job(job_name)</span><br><span class="line">    job_instance.disable()</span><br><span class="line">    print(&#39;Name:%s,Is Job Enabled ?:%s&#39; % (job_name, job_instance.is_enabled()))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Name:my-github,Is Job Enabled ?:False</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 7. CURD Job</span><br><span class="line">server.create_job()</span><br><span class="line">server.delete_job(&#39;ansible-playbook&#39;)</span><br><span class="line">server.copy_job(&#39;my-job&#39;, &#39;new-my-job&#39;)</span><br><span class="line">server.rename_job(&#39;my-github&#39;, &#39;new-my-github&#39;)</span><br><span class="line"></span><br><span class="line"># 8. Get Plugin details</span><br><span class="line">for plugin in server.get_plugins().values():</span><br><span class="line">    print(&quot;Short Name:%s&quot; % (plugin.shortName))</span><br><span class="line">    print(&quot;Long Name:%s&quot; % (plugin.longName))</span><br><span class="line">    print(&quot;Version:%s&quot; % (plugin.version))</span><br><span class="line">    print(&quot;URL:%s&quot; % (plugin.url))</span><br><span class="line">    print(&quot;Active:%s&quot; % (plugin.active))</span><br><span class="line">    print(&quot;Enabled:%s&quot; % (plugin.enabled))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Short Name:jsch</span><br><span class="line">Long Name:Jenkins JSch dependency plugin</span><br><span class="line">Version:0.1.54.1</span><br><span class="line">URL:http:&#x2F;&#x2F;wiki.jenkins-ci.org&#x2F;display&#x2F;JENKINS&#x2F;JSch+plugin</span><br><span class="line">Active:True</span><br><span class="line">Enabled:True</span><br><span class="line">Short Name:ws-cleanup</span><br><span class="line">Long Name:Jenkins Workspace Cleanup Plugin</span><br><span class="line">Version:0.34</span><br><span class="line">URL:http:&#x2F;&#x2F;wiki.jenkins-ci.org&#x2F;display&#x2F;JENKINS&#x2F;Workspace+Cleanup+Plugin</span><br><span class="line">Active:True</span><br><span class="line">Enabled:True</span><br><span class="line">......</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 9. ä»å·²å®Œæˆçš„æ„å»ºä¸­è·å–ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">def getSCMInfroFromLatestGoodBuild(url, jobName, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;):</span><br><span class="line">    J &#x3D; Jenkins(url, username, password)</span><br><span class="line">    job &#x3D; J[jobName]</span><br><span class="line">    lgb &#x3D; job.get_last_good_build()</span><br><span class="line">    return lgb.get_revision()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version &#x3D; getSCMInfroFromLatestGoodBuild(&quot;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&quot;, &#39;ansible-playbook&#39;)</span><br><span class="line">print(version)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">21c2b6ff6c842a86969f36f75424e17ae27eae68</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 10. å…¶ä»–</span><br><span class="line">print(server.__dict__)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;admin123&#39;, &#39;requester&#39;: &lt;jenkinsapi.utils.requester.Requester object at 0x103423710&gt;, &#39;lazy&#39;: False, &#39;jobs_container&#39;: None, &#39;_data&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.Hudson&#39;, &#39;jobs&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;ansible-playbook&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;color&#39;: &#39;blue&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-github&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;, &#39;color&#39;: &#39;disabled&#39;&#125;]&#125;, &#39;baseurl&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#39;&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">jobs &#x3D; server.__dict__[&#39;_data&#39;][&#39;jobs&#39;]</span><br><span class="line">print(server.resolve_job_folders(jobs))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;ansible-playbook&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;color&#39;: &#39;blue&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-github&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;, &#39;color&#39;: &#39;disabled&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># baseurl</span><br><span class="line">print(server.baseurl)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># username</span><br><span class="line">print(server.username)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">admin</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># password</span><br><span class="line">print(server.password)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">admin123</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># åˆ¤æ–­jobæ˜¯å¦å­˜åœ¨</span><br><span class="line">print(server.has_job(&#39;prod-java&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">False</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">print(server.get_queue())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;queue</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¯•å›¾</span><br><span class="line">print(server.views.keys())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#39;My View&#39;, &#39;all&#39;, &#39;myview&#39;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># åˆ é™¤è¯•å›¾</span><br><span class="line">server.delete_view_by_url(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;testview&#x2F;&#39;)</span><br><span class="line"></span><br><span class="line"># è·å–æœ€åä¸€æ¬¡æ„å»º</span><br><span class="line">print(server[&#39;ansible-playbook&#39;].get_last_good_build())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook #27</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># BUILDæ„å»ºç›¸å…³</span><br><span class="line"># 1. æ„å»º(æ–¹å¼ä¸€)</span><br><span class="line">params &#x3D; &#123;&#39;Branch&#39;: &#39;oriin&#x2F;master&#39;, &#39;host&#39;: &#39;192.168.1.100&#39;&#125;</span><br><span class="line">ret &#x3D; server.build_job(&#39;ansible-playbook&#39;, params)</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line"># æ–¹å¼äºŒ</span><br><span class="line">job &#x3D; server[&#39;ansible-playbook&#39;]</span><br><span class="line">run_job &#x3D; job.invoke(build_params&#x3D;params)</span><br><span class="line">number &#x3D; run_job.__dict__[&#39;_data&#39;][&#39;executable&#39;][&#39;number&#39;]</span><br><span class="line">build_url &#x3D; run_job.__dict__[&#39;_data&#39;][&#39;executable&#39;][&#39;url&#39;]</span><br><span class="line">print(&quot;ç¬¬%dæ¬¡æ„å»º: %s&quot; % (number, build_url))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ç¬¬40æ¬¡æ„å»º: http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># ç»“æœæŸ¥è¯¢</span><br><span class="line"># 1. æ–¹å¼ä¸€</span><br><span class="line">job &#x3D; server.get_job(&#39;ansible-playbook&#39;)</span><br><span class="line">print(job.__dict__[&#39;_data&#39;][&#39;builds&#39;])</span><br><span class="line">url &#x3D; job.__dict__[&#39;_data&#39;][&#39;lastBuild&#39;][&#39;url&#39;]</span><br><span class="line">number &#x3D; job.__dict__[&#39;_data&#39;][&#39;lastBuild&#39;][&#39;number&#39;]</span><br><span class="line">obj &#x3D; Build(url, number, job)</span><br><span class="line"></span><br><span class="line"># 2. æ–¹å¼äºŒ</span><br><span class="line">job &#x3D; server[&#39;ansible-playbook&#39;]</span><br><span class="line">url &#x3D; job.__dict__[&#39;_data&#39;][&#39;lastBuild&#39;][&#39;url&#39;]</span><br><span class="line">number &#x3D; job.__dict__[&#39;_data&#39;][&#39;lastBuild&#39;][&#39;number&#39;]</span><br><span class="line">obj &#x3D; Build(url, number, job)</span><br><span class="line"></span><br><span class="line"># å…¨å±€ä¿¡æ¯</span><br><span class="line">print(obj.pprint())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;,</span><br><span class="line"> &#39;actions&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersAction&#39;,</span><br><span class="line">              &#39;parameters&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterValue&#39;,</span><br><span class="line">                              &#39;name&#39;: &#39;Branch&#39;,</span><br><span class="line">                              &#39;value&#39;: &#39;oriin&#x2F;master&#39;&#125;,</span><br><span class="line">                             &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;,</span><br><span class="line">                              &#39;name&#39;: &#39;host&#39;,</span><br><span class="line">                              &#39;value&#39;: &#39;192.168.1.100&#39;&#125;]&#125;,</span><br><span class="line">             &#123;&#39;_class&#39;: &#39;hudson.model.CauseAction&#39;,</span><br><span class="line">              &#39;causes&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.Cause$UserIdCause&#39;,</span><br><span class="line">                          &#39;shortDescription&#39;: &#39;Started by user ç®¡ç†å‘˜&#39;,</span><br><span class="line">                          &#39;userId&#39;: &#39;admin&#39;,</span><br><span class="line">                          &#39;userName&#39;: &#39;ç®¡ç†å‘˜&#39;&#125;]&#125;,</span><br><span class="line">             &#123;&#125;,</span><br><span class="line">             ......</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_result_url())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;testReport&#x2F;api&#x2F;python</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.is_running())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">False</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.stop())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">True</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.is_good())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">True</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_number())</span><br><span class="line">print(obj.buildno)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">40</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_status())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">SUCCESS</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_revision())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">21c2b6ff6c842a86969f36f75424e17ae27eae68</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_revision_branch())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_console())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Started by user Ã§Â®Â¡Ã§ÂÂ†Ã¥Â‘Â˜</span><br><span class="line">[EnvInject] - Loading node environment variables.</span><br><span class="line">Building in workspace &#x2F;Users&#x2F;zhao&#x2F;data&#x2F;workspace&#x2F;workspace&#x2F;ansible-playbook</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse --is-inside-work-tree # timeout&#x3D;10</span><br><span class="line">Fetching changes from the remote Git repository</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git config remote.origin.url git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git --version # timeout&#x3D;10</span><br><span class="line">using GIT_SSH to set credentials deploy key</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git fetch --tags --progress git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">Checking out Revision 21c2b6ff6c842a86969f36f75424e17ae27eae68 (refs&#x2F;remotes&#x2F;origin&#x2F;master)</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git config core.sparsecheckout # timeout&#x3D;10</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git checkout -f 21c2b6ff6c842a86969f36f75424e17ae27eae68</span><br><span class="line">Commit message: &quot;update tomcat root mode&quot;</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-list --no-walk 21c2b6ff6c842a86969f36f75424e17ae27eae68 # timeout&#x3D;10</span><br><span class="line">[ansible-playbook] $ &#x2F;bin&#x2F;sh -xe &#x2F;Users&#x2F;Shared&#x2F;Jenkins&#x2F;tmp&#x2F;jenkins280834745018509074.sh</span><br><span class="line">+ echo 192.168.1.100</span><br><span class="line">192.168.1.100</span><br><span class="line">+ echo test</span><br><span class="line">test</span><br><span class="line">+ echo http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;</span><br><span class="line">+ echo 40</span><br><span class="line">40</span><br><span class="line">+ echo jenkins-ansible-playbook-40</span><br><span class="line">jenkins-ansible-playbook-40</span><br><span class="line">Recording fingerprints</span><br><span class="line">Finished: SUCCESS</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">print(obj.get_causes())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;_class&#39;: &#39;hudson.model.Cause$UserIdCause&#39;, &#39;shortDescription&#39;: &#39;Started by user ç®¡ç†å‘˜&#39;, &#39;userId&#39;: &#39;admin&#39;, &#39;userName&#39;: &#39;ç®¡ç†å‘˜&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_params())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;Branch&#39;: &#39;oriin&#x2F;master&#39;, &#39;host&#39;: &#39;192.168.1.100&#39;&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_env_vars())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;BUILD_CAUSE&#39;: &#39;MANUALTRIGGER&#39;, &#39;BUILD_CAUSE_MANUALTRIGGER&#39;: &#39;true&#39;, &#39;BUILD_DISPLAY_NAME&#39;: &#39;#40&#39;, &#39;BUILD_ID&#39;: &#39;40&#39;, &#39;BUILD_NUMBER&#39;: &#39;40&#39;, &#39;BUILD_TAG&#39;: &#39;jenkins-ansible-playbook-40&#39;, &#39;BUILD_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;&#39;, &#39;Branch&#39;: &#39;oriin&#x2F;master&#39;, &#39;EXECUTOR_NUMBER&#39;: &#39;1&#39;, &#39;HUDSON_HOME&#39;: &#39;&#x2F;Users&#x2F;zhao&#x2F;data&#x2F;workspace&#39;, &#39;HUDSON_SERVER_COOKIE&#39;: &#39;5634a2d507063d61&#39;, &#39;HUDSON_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, &#39;JENKINS_HOME&#39;: &#39;&#x2F;Users&#x2F;zhao&#x2F;data&#x2F;workspace&#39;, &#39;JENKINS_SERVER_COOKIE&#39;: &#39;5634a2d507063d61&#39;, &#39;JENKINS_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, &#39;JOB_BASE_NAME&#39;: &#39;ansible-playbook&#39;, &#39;JOB_NAME&#39;: &#39;ansible-playbook&#39;, &#39;JOB_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;NODE_LABELS&#39;: &#39;master&#39;, &#39;NODE_NAME&#39;: &#39;master&#39;, &#39;ROOT_BUILD_CAUSE&#39;: &#39;MANUALTRIGGER&#39;, &#39;ROOT_BUILD_CAUSE_MANUALTRIGGER&#39;: &#39;true&#39;, &#39;RUN_CHANGES_DISPLAY_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;display&#x2F;redirect?page&#x3D;changes&#39;, &#39;RUN_DISPLAY_URL&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;display&#x2F;redirect&#39;, &#39;TEST_ARGS&#39;: &#39;test&#39;, &#39;host&#39;: &#39;192.168.1.100&#39;&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.job)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(obj.get_data(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;api&#x2F;python&#x2F;?pretty&#x3D;true&#39;))</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;actions&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersAction&#39;, &#39;parameters&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterValue&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;value&#39;: &#39;oriin&#x2F;master&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;name&#39;: &#39;host&#39;, &#39;value&#39;: &#39;192.168.1.100&#39;&#125;]&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.CauseAction&#39;, &#39;causes&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.Cause$UserIdCause&#39;, &#39;shortDescription&#39;: &#39;Started by user ç®¡ç†å‘˜&#39;, &#39;userId&#39;: &#39;admin&#39;, &#39;userName&#39;: &#39;ç®¡ç†å‘˜&#39;&#125;]&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.BuildData&#39;, &#39;buildsByBranchName&#39;: &#123;&#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.Build&#39;, &#39;buildNumber&#39;: 40, &#39;buildResult&#39;: None, &#39;marked&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;revision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;&#125;&#125;, &#39;lastBuiltRevision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;remoteUrls&#39;: [&#39;git@git.idbc.net:ansible-roles&#x2F;zff.ansible.git&#39;], &#39;scmName&#39;: &#39;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitTagAction&#39;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;], &#39;artifacts&#39;: [], &#39;building&#39;: False, &#39;description&#39;: None, &#39;displayName&#39;: &#39;#40&#39;, &#39;duration&#39;: 735, &#39;estimatedDuration&#39;: 897, &#39;executor&#39;: None, &#39;fullDisplayName&#39;: &#39;ansible-playbook #40&#39;, &#39;id&#39;: &#39;40&#39;, &#39;keepLog&#39;: False, &#39;number&#39;: 40, &#39;queueId&#39;: 21, &#39;result&#39;: &#39;SUCCESS&#39;, &#39;timestamp&#39;: 1516172959444, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;40&#x2F;&#39;, &#39;builtOn&#39;: &#39;&#39;, &#39;changeSet&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitChangeSetList&#39;, &#39;items&#39;: [], &#39;kind&#39;: &#39;git&#39;&#125;, &#39;culprits&#39;: []&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Some-API"><a href="#Some-API" class="headerlink" title="Some API"></a>Some API</h4><p>This module is a collection of helpful, high-level functions for automating common tasks. Many of these functions were designed to be exposed to the command-line, hence they have simple string arguments.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from jenkinsapi import api as API</span><br><span class="line">server &#x3D; get_server_instance()</span><br><span class="line">jobs &#x3D; server.get_jobs_list()</span><br><span class="line"></span><br><span class="line"># 1. ç­‰å¾…æ‰€æœ‰jobæ‰§è¡Œå®Œæˆ</span><br><span class="line">ret &#x3D; API.block_until_complete(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, jobs, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;, ssl_verify&#x3D;False)</span><br><span class="line">print(ret)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Waiting for jobs &quot;ansible-playbook&quot; to complete. Will wait another 12000s</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 2. job æ„å»ºçš„å®Œæ•´åç§°</span><br><span class="line">ret &#x3D; API.get_build(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, &#39;ansible-playbook&#39;, 66, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;,</span><br><span class="line">                    ssl_verify&#x3D;False)</span><br><span class="line">print(ret)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook #66</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 3. æœ€åä¸€æ¬¡æ„å»º</span><br><span class="line">ret &#x3D; API.get_latest_build(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, &#39;ansible-playbook&#39;, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;,</span><br><span class="line">                           ssl_verify&#x3D;False)</span><br><span class="line">print(ret)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook #66</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 4. æœ€åä¸€æ¬¡å®Œæ•´æ„å»º</span><br><span class="line">ret &#x3D; API.get_latest_complete_build(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;, &#39;ansible-playbook&#39;, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;,</span><br><span class="line">                                    ssl_verify&#x3D;False)</span><br><span class="line">print(ret)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook #66</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 5. æŸ¥è¯¢è¯•å›¾ä¿¡æ¯</span><br><span class="line">ret &#x3D; API.get_nested_view_from_url(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;&#39;, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;,</span><br><span class="line">                                   ssl_verify&#x3D;False)</span><br><span class="line">print(ret.get_config_xml_url())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;config.xml</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(ret.get_job_dict())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;ansible-playbook&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;my-github&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(ret.pprint())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.ListView&#39;,</span><br><span class="line"> &#39;description&#39;: &#39;æµ‹è¯•è¯•å›¾&#39;,</span><br><span class="line"> &#39;jobs&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;,</span><br><span class="line">           &#39;color&#39;: &#39;blue&#39;,</span><br><span class="line">           &#39;name&#39;: &#39;ansible-playbook&#39;,</span><br><span class="line">           &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;&#125;,</span><br><span class="line">          &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;,</span><br><span class="line">           &#39;color&#39;: &#39;disabled&#39;,</span><br><span class="line">           &#39;name&#39;: &#39;my-github&#39;,</span><br><span class="line">           &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;&#125;],</span><br><span class="line"> &#39;name&#39;: &#39;myview&#39;,</span><br><span class="line"> &#39;property&#39;: [],</span><br><span class="line"> &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;&#39;&#125;</span><br><span class="line">None</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(ret.get_config())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;hudson.model.ListView&gt;</span><br><span class="line">  &lt;name&gt;myview&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;description&gt;æµ‹è¯•è¯•å›¾&lt;&#x2F;description&gt;</span><br><span class="line">  &lt;filterExecutors&gt;false&lt;&#x2F;filterExecutors&gt;</span><br><span class="line">  &lt;filterQueue&gt;false&lt;&#x2F;filterQueue&gt;</span><br><span class="line">  &lt;properties class&#x3D;&quot;hudson.model.View$PropertyList&quot;&#x2F;&gt;</span><br><span class="line">  &lt;jobNames&gt;</span><br><span class="line">    &lt;comparator class&#x3D;&quot;hudson.util.CaseInsensitiveComparator&quot;&#x2F;&gt;</span><br><span class="line">    &lt;string&gt;ansible-playbook&lt;&#x2F;string&gt;</span><br><span class="line">    &lt;string&gt;my-github&lt;&#x2F;string&gt;</span><br><span class="line">  &lt;&#x2F;jobNames&gt;</span><br><span class="line">  &lt;jobFilters&#x2F;&gt;</span><br><span class="line">  &lt;columns&gt;</span><br><span class="line">    &lt;hudson.views.StatusColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.WeatherColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.JobColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.LastSuccessColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.LastDurationColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.BuildButtonColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.plugins.git.GitBranchSpecifierColumn plugin&#x3D;&quot;git@3.7.0&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;columns&gt;</span><br><span class="line">  &lt;recurse&gt;false&lt;&#x2F;recurse&gt;</span><br><span class="line">&lt;&#x2F;hudson.model.ListView&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># 6. ç±»ä¼¼ä¸get_nested_view_from_urlå‡½æ•°</span><br><span class="line">ret &#x3D; API.get_view_from_url(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;&#39;, username&#x3D;&#39;admin&#39;, password&#x3D;&#39;admin123&#39;,</span><br><span class="line">                            ssl_verify&#x3D;False)</span><br><span class="line">print(ret.get_job_dict())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;ansible-playbook&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;my-github&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">print(ret.get_config_xml_url())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;config.xml</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>


<h3 id="Python-Jenkinsæ¨¡å—"><a href="#Python-Jenkinsæ¨¡å—" class="headerlink" title="Python Jenkinsæ¨¡å—"></a>Python Jenkinsæ¨¡å—</h3><h4 id="Working-with-Jenkins-Jobs"><a href="#Working-with-Jenkins-Jobs" class="headerlink" title="Working with Jenkins Jobs"></a>Working with Jenkins Jobs</h4><p>This is an example showing how to create, configure and delete Jenkins jobs.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;1&#x2F;17</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import jenkins</span><br><span class="line"></span><br><span class="line">server &#x3D; jenkins.Jenkins(&#39;http:&#x2F;&#x2F;127.0.0.1:8080&#39;, username&#x3D;&quot;admin&quot;, password&#x3D;&quot;admin123&quot;)</span><br><span class="line">params &#x3D; &#123;&#39;Branch&#39;: &#39;oriin&#x2F;master&#39;, &#39;host&#39;: &#39;192.168.1.110&#39;&#125;</span><br><span class="line"></span><br><span class="line"># serverå¯¹è±¡</span><br><span class="line"># Jenkinsçš„jobæ•°é‡</span><br><span class="line">print(server.jobs_count())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">2</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># Jenkins-web-ui</span><br><span class="line">print(server.server)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># æ‰€æœ‰çš„jobä¿¡æ¯</span><br><span class="line">all_jobs_li &#x3D; server.get_all_jobs()</span><br><span class="line">for item in all_jobs_li:</span><br><span class="line">    print(&#39;name: %s&#39; % item[&#39;name&#39;], &#39;URL: &#39;, item[&#39;url&#39;])</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">name: ansible-playbook URL:  http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;</span><br><span class="line">name: my-github URL:  http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># è´¦æˆ·ä¿¡æ¯æè¿°</span><br><span class="line">print(server.get_whoami())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.User&#39;, &#39;absoluteUrl&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;user&#x2F;admin&#39;, &#39;description&#39;: &#39;æœ¬åœ°æµ‹è¯•&#39;, &#39;fullName&#39;: &#39;ç®¡ç†å‘˜&#39;, &#39;id&#39;: &#39;admin&#39;, &#39;property&#39;: [&#123;&#39;_class&#39;: &#39;jenkins.security.ApiTokenProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;com.cloudbees.plugins.credentials.UserCredentialsProvider$UserCredentialsProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.tasks.Mailer$UserProperty&#39;, &#39;address&#39;: &#39;admin@163.com&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.emailext.watching.EmailExtWatchAction$UserProperty&#39;, &#39;triggers&#39;: []&#125;, &#123;&#39;_class&#39;: &#39;jenkins.security.LastGrantedAuthoritiesProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;org.jenkinsci.plugins.displayurlapi.user.PreferredProviderUserProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.PaneStatusProperties&#39;&#125;, &#123;&#39;_class&#39;: &#39;org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.security.HudsonPrivateSecurityRealm$Details&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.MyViewsProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.search.UserSearchProperty&#39;, &#39;insensitiveSearch&#39;: True&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.favorite.user.FavoriteUserProperty&#39;&#125;]&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># auth</span><br><span class="line">print(server.auth)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">b&#39;Basic YWRtaW46YWRtaW4xMjM&#x3D;&#39;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># DEBUG Jobä¿¡æ¯</span><br><span class="line">print(server.debug_job_info(&#39;ansible-playbook&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">_class hudson.model.FreeStyleProject</span><br><span class="line">actions [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersDefinitionProperty&#39;, &#39;parameterDefinitions&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterDefinition&#39;, &#39;defaultParameterValue&#39;: None, &#39;description&#39;: &#39;åˆ†æ”¯&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;type&#39;: &#39;PT_BRANCH&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterDefinition&#39;, &#39;defaultParameterValue&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;value&#39;: &#39;127.0.0.1,127.0.0.2,127.0.0.1&#39;&#125;, &#39;description&#39;: &#39;æœ¬æœº&#39;, &#39;name&#39;: &#39;host&#39;, &#39;type&#39;: &#39;StringParameterDefinition&#39;&#125;]&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;com.cloudbees.plugins.credentials.ViewCredentialsAction&#39;&#125;]</span><br><span class="line">description ansible playbook</span><br><span class="line">displayName ansible-playbook</span><br><span class="line">displayNameOrNull None</span><br><span class="line">fullDisplayName ansible-playbook</span><br><span class="line">fullName ansible-playbook</span><br><span class="line">name ansible-playbook</span><br><span class="line">url http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;</span><br><span class="line">buildable True</span><br><span class="line">......</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">####### CURD Job #######</span><br><span class="line"></span><br><span class="line"># Jobæ˜¯å¦å­˜åœ¨</span><br><span class="line">print(server.job_exists(&#39;my-api&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">True or None</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># è·å–æ‰€æœ‰çš„Job</span><br><span class="line">print(server.get_jobs())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;ansible-playbook&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;color&#39;: &#39;aborted&#39;, &#39;fullname&#39;: &#39;ansible-playbook&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-api&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-api&#x2F;&#39;, &#39;color&#39;: &#39;notbuilt&#39;, &#39;fullname&#39;: &#39;my-api&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-github&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;, &#39;color&#39;: &#39;disabled&#39;, &#39;fullname&#39;: &#39;my-github&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºJob</span><br><span class="line">server.create_job(&#39;API&#39;, jenkins.RECONFIG_XML)</span><br><span class="line"></span><br><span class="line"># åˆ é™¤Job</span><br><span class="line">server.delete_job(&#39;my-api&#39;)</span><br><span class="line"></span><br><span class="line"># å¤åˆ¶job</span><br><span class="line">server.copy_job(&#39;my-github&#39;, &#39;copy-my-github&#39;)</span><br><span class="line"></span><br><span class="line"># enable job</span><br><span class="line">server.enable_job(&#39;copy-my-github&#39;)</span><br><span class="line"></span><br><span class="line"># ç¦ç”¨Job</span><br><span class="line">server.disable_job(&#39;copy-my-github&#39;)</span><br><span class="line"></span><br><span class="line"># é‡æ–°é…ç½®Job</span><br><span class="line">server.reconfig_job(&#39;copy-my-github&#39;, jenkins.RECONFIG_XML)</span><br><span class="line"></span><br><span class="line"># é‡å‘½åJob</span><br><span class="line">server.rename_job(&#39;API&#39;, &#39;my-api&#39;)</span><br><span class="line"></span><br><span class="line"># è§¦å‘Jobè¿è¡Œ</span><br><span class="line"># è§¦å‘Job(æ–¹å¼ä¸€)</span><br><span class="line">server.build_job_url(&#39;ansible-playbook&#39;, parameters&#x3D;params)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;buildWithParameters?Branch&#x3D;oriin%2Fmaster&amp;host&#x3D;192.168.1.110</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"># è§¦å‘Job(æ–¹å¼äºŒ)</span><br><span class="line">server.build_job(&#39;ansible-playbook&#39;, parameters&#x3D;params)</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŒ‡å®šæ„å»ºç¼–å·çš„è¾“å‡º</span><br><span class="line">print(server.get_build_console_output(&#39;ansible-playbook&#39;, 41))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Started by user ç®¡ç†å‘˜</span><br><span class="line">[EnvInject] - Loading node environment variables.</span><br><span class="line">Building in workspace &#x2F;Users&#x2F;zhao&#x2F;data&#x2F;workspace&#x2F;workspace&#x2F;ansible-playbook</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse --is-inside-work-tree # timeout&#x3D;10</span><br><span class="line">Fetching changes from the remote Git repository</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git config remote.origin.url git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git # timeout&#x3D;10</span><br><span class="line">Fetching upstream changes from git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git --version # timeout&#x3D;10</span><br><span class="line">using GIT_SSH to set credentials deploy key</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git fetch --tags --progress git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-parse refs&#x2F;remotes&#x2F;origin&#x2F;origin&#x2F;master^&#123;commit&#125; # timeout&#x3D;10</span><br><span class="line">Checking out Revision 21c2b6ff6c842a86969f36f75424e17ae27eae68 (refs&#x2F;remotes&#x2F;origin&#x2F;master)</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git config core.sparsecheckout # timeout&#x3D;10</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git checkout -f 21c2b6ff6c842a86969f36f75424e17ae27eae68</span><br><span class="line">Commit message: &quot;update tomcat root mode&quot;</span><br><span class="line"> &gt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;git rev-list --no-walk 21c2b6ff6c842a86969f36f75424e17ae27eae68 # timeout&#x3D;10</span><br><span class="line">[ansible-playbook] $ &#x2F;bin&#x2F;sh -xe &#x2F;Users&#x2F;Shared&#x2F;Jenkins&#x2F;tmp&#x2F;jenkins5080034200775659821.sh</span><br><span class="line">+ echo 192.168.1.110</span><br><span class="line">192.168.1.110</span><br><span class="line">+ echo test</span><br><span class="line">test</span><br><span class="line">+ echo http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;41&#x2F;</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;41&#x2F;</span><br><span class="line">+ echo 41</span><br><span class="line">41</span><br><span class="line">+ echo jenkins-ansible-playbook-41</span><br><span class="line">jenkins-ansible-playbook-41</span><br><span class="line">Finished: SUCCESS</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># ä¸‹ä¸€æ¬¡æ„å»ºç¼–å·,æ­¥é•¿ä¸º5</span><br><span class="line">next_bn &#x3D; server.get_job_info(&#39;ansible-playbook&#39;)[&#39;nextBuildNumber&#39;]</span><br><span class="line">server.set_next_build_number(&#39;ansible-playbook&#39;, next_bn + 5)</span><br><span class="line"></span><br><span class="line"># æŒ‡å®šç¼–å·çš„æ„å»ºJobä¿¡æ¯</span><br><span class="line">print(server.get_build_info(&#39;ansible-playbook&#39;, 48))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;actions&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersAction&#39;, &#39;parameters&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterValue&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;value&#39;: &#39;oriin&#x2F;master&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;name&#39;: &#39;host&#39;, &#39;value&#39;: &#39;192.168.1.110&#39;&#125;]&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.CauseAction&#39;, &#39;causes&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.Cause$UserIdCause&#39;, &#39;shortDescription&#39;: &#39;Started by user ç®¡ç†å‘˜&#39;, &#39;userId&#39;: &#39;admin&#39;, &#39;userName&#39;: &#39;ç®¡ç†å‘˜&#39;&#125;]&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.BuildData&#39;, &#39;buildsByBranchName&#39;: &#123;&#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.Build&#39;, &#39;buildNumber&#39;: 48, &#39;buildResult&#39;: None, &#39;marked&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;revision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;&#125;&#125;, &#39;lastBuiltRevision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;remoteUrls&#39;: [&#39;git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git&#39;], &#39;scmName&#39;: &#39;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitTagAction&#39;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;], &#39;artifacts&#39;: [], &#39;building&#39;: False, &#39;description&#39;: None, &#39;displayName&#39;: &#39;#48&#39;, &#39;duration&#39;: 1861, &#39;estimatedDuration&#39;: 4305, &#39;executor&#39;: None, &#39;fullDisplayName&#39;: &#39;ansible-playbook #48&#39;, &#39;id&#39;: &#39;48&#39;, &#39;keepLog&#39;: False, &#39;number&#39;: 48, &#39;queueId&#39;: 24, &#39;result&#39;: &#39;SUCCESS&#39;, &#39;timestamp&#39;: 1516185645519, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;48&#x2F;&#39;, &#39;builtOn&#39;: &#39;&#39;, &#39;changeSet&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitChangeSetList&#39;, &#39;items&#39;: [], &#39;kind&#39;: &#39;git&#39;&#125;, &#39;culprits&#39;: []&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># è·å–æ­£åœ¨è¿è¡Œçš„Jobï¼Œä¸€èˆ¬ç»“åˆbuild_jobæ–¹æ³•ä¸€èµ·ä½¿ç”¨</span><br><span class="line">print(server.get_running_builds())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;name&#39;: &#39;ansible-playbook&#39;, &#39;number&#39;: 57, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;57&#x2F;&#39;, &#39;node&#39;: &#39;(master)&#39;, &#39;executor&#39;: 1&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># ç»ˆæ­¢æŒ‡å®šç¼–å·çš„Job</span><br><span class="line">server.stop_build(&#39;ansible-playbook&#39;, 62)</span><br><span class="line"></span><br><span class="line"># è·å–Jobåç§°</span><br><span class="line">print(server.get_job_name(&#39;ansible-playbook&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">ansible-playbook</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># æ–­è¨€Jobæ˜¯å¦å­˜åœ¨</span><br><span class="line">print(server.assert_job_exists(&#39;ansible-playbook&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">å­˜åœ¨åˆ™è¿”å›Noneï¼Œä¸å­˜åœ¨åˆ™æŠ›å‡ºé”™è¯¯ä¿¡æ¯</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># è¯¥Jobæ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯</span><br><span class="line">print(server.get_job_info(&#39;ansible-playbook&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;actions&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersDefinitionProperty&#39;, &#39;parameterDefinitions&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterDefinition&#39;, &#39;defaultParameterValue&#39;: None, &#39;description&#39;: &#39;åˆ†æ”¯&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;type&#39;: &#39;PT_BRANCH&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterDefinition&#39;, &#39;defaultParameterValue&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;value&#39;: &#39;127.0.0.1,127.0.0.2,127.0.0.1&#39;&#125;, &#39;description&#39;: &#39;æœ¬æœº&#39;, &#39;name&#39;: &#39;host&#39;, &#39;type&#39;: &#39;StringParameterDefinition&#39;&#125;]&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;com.cloudbees.plugins.credentials.ViewCredentialsAction&#39;&#125;], &#39;description&#39;: &#39;ansible playbook&#39;, &#39;displayName&#39;: &#39;ansible-playbook&#39;, &#39;displayNameOrNull&#39;: None, &#39;fullDisplayName&#39;: &#39;ansible-playbook&#39;, &#39;fullName&#39;: &#39;ansible-playbook&#39;, &#39;name&#39;: &#39;ansible-playbook&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;buildable&#39;: True, &#39;builds&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 62, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;62&#x2F;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 61, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;61&#x2F;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 60, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;60&#x2F;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 59, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;59&#x2F;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 58, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;58&#x2F;&#39;&#125;], &#39;color&#39;: &#39;aborted&#39;, &#39;firstBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 58, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;58&#x2F;&#39;&#125;, &#39;healthReport&#39;: [&#123;&#39;description&#39;: &#39;Build stability: No recent builds failed.&#39;, &#39;iconClassName&#39;: &#39;icon-health-80plus&#39;, &#39;iconUrl&#39;: &#39;health-80plus.png&#39;, &#39;score&#39;: 100&#125;], &#39;inQueue&#39;: False, &#39;keepDependencies&#39;: False, &#39;lastBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 62, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;62&#x2F;&#39;&#125;, &#39;lastCompletedBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 62, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;62&#x2F;&#39;&#125;, &#39;lastFailedBuild&#39;: None, &#39;lastStableBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 61, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;61&#x2F;&#39;&#125;, &#39;lastSuccessfulBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 61, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;61&#x2F;&#39;&#125;, &#39;lastUnstableBuild&#39;: None, &#39;lastUnsuccessfulBuild&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;number&#39;: 62, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;62&#x2F;&#39;&#125;, &#39;nextBuildNumber&#39;: 63, &#39;property&#39;: [&#123;&#39;_class&#39;: &#39;jenkins.model.BuildDiscarderProperty&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.ParametersDefinitionProperty&#39;, &#39;parameterDefinitions&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterDefinition&#39;, &#39;defaultParameterValue&#39;: None, &#39;description&#39;: &#39;åˆ†æ”¯&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;type&#39;: &#39;PT_BRANCH&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterDefinition&#39;, &#39;defaultParameterValue&#39;: &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;name&#39;: &#39;host&#39;, &#39;value&#39;: &#39;127.0.0.1,127.0.0.2,127.0.0.1&#39;&#125;, &#39;description&#39;: &#39;æœ¬æœº&#39;, &#39;name&#39;: &#39;host&#39;, &#39;type&#39;: &#39;StringParameterDefinition&#39;&#125;]&#125;], &#39;queueItem&#39;: None, &#39;concurrentBuild&#39;: False, &#39;downstreamProjects&#39;: [], &#39;labelExpression&#39;: None, &#39;scm&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitSCM&#39;&#125;, &#39;upstreamProjects&#39;: []&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è¯¥è¯•å›¾ä¸‹æ‰€æœ‰çš„Job</span><br><span class="line">print(server.get_jobs(&#39;myview&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;ansible-playbook&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;&#39;, &#39;color&#39;: &#39;aborted&#39;, &#39;fullname&#39;: &#39;ansible-playbook&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-api&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-api&#x2F;&#39;, &#39;color&#39;: &#39;notbuilt&#39;, &#39;fullname&#39;: &#39;my-api&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleProject&#39;, &#39;name&#39;: &#39;my-github&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;my-github&#x2F;&#39;, &#39;color&#39;: &#39;disabled&#39;, &#39;fullname&#39;: &#39;my-github&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># æ­£åˆ™åŒ¹é…è·å–Jobä¿¡æ¯</span><br><span class="line"># print(server.get_job_info_regex(&#39;^my&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">Jobç›¸å…³ä¿¡æ¯</span><br><span class="line">....</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># è·å–æœ€åä¸€æ¬¡æ„å»ºçš„Jobä¿¡æ¯</span><br><span class="line"># build a parameterized job</span><br><span class="line"># requires creating and configuring the ansible-playbook job to accept &#39;param1&#39; &amp; &#39;param2&#39;</span><br><span class="line">job_name &#x3D; &quot;ansible-playbook&quot;</span><br><span class="line">server.build_job(job_name, &#123;&#39;Branch&#39;: &#39;oriin&#x2F;master&#39;, &#39;host&#39;: &#39;192.168.1.110&#39;&#125;)</span><br><span class="line">last_build_number &#x3D; server.get_job_info(job_name)[&#39;lastCompletedBuild&#39;][&#39;number&#39;]</span><br><span class="line">build_info &#x3D; server.get_build_info(job_name, last_build_number)</span><br><span class="line">print(build_info)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&#123;&#39;_class&#39;: &#39;hudson.model.FreeStyleBuild&#39;, &#39;actions&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.ParametersAction&#39;, &#39;parameters&#39;: [&#123;&#39;_class&#39;: &#39;net.uaznia.lukanus.hudson.plugins.gitparameter.GitParameterValue&#39;, &#39;name&#39;: &#39;Branch&#39;, &#39;value&#39;: &#39;origin&#x2F;master&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.StringParameterValue&#39;, &#39;name&#39;: &#39;host&#39;, &#39;value&#39;: &#39;127.0.0.1,127.0.0.2,127.0.0.105&#39;&#125;]&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.CauseAction&#39;, &#39;causes&#39;: [&#123;&#39;_class&#39;: &#39;hudson.model.Cause$UserIdCause&#39;, &#39;shortDescription&#39;: &#39;Started by user ç®¡ç†å‘˜&#39;, &#39;userId&#39;: &#39;admin&#39;, &#39;userName&#39;: &#39;ç®¡ç†å‘˜&#39;&#125;]&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.BuildData&#39;, &#39;buildsByBranchName&#39;: &#123;&#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.util.Build&#39;, &#39;buildNumber&#39;: 62, &#39;buildResult&#39;: None, &#39;marked&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;revision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;&#125;&#125;, &#39;lastBuiltRevision&#39;: &#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;branch&#39;: [&#123;&#39;SHA1&#39;: &#39;21c2b6ff6c842a86969f36f75424e17ae27eae68&#39;, &#39;name&#39;: &#39;refs&#x2F;remotes&#x2F;origin&#x2F;master&#39;&#125;]&#125;, &#39;remoteUrls&#39;: [&#39;git@git.icbc.net:ansible-roles&#x2F;zff.ansible.git&#39;], &#39;scmName&#39;: &#39;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitTagAction&#39;&#125;, &#123;&#125;, &#123;&#39;_class&#39;: &#39;jenkins.model.InterruptedBuildAction&#39;&#125;, &#123;&#125;, &#123;&#125;, &#123;&#125;], &#39;artifacts&#39;: [], &#39;building&#39;: False, &#39;description&#39;: None, &#39;displayName&#39;: &#39;#62&#39;, &#39;duration&#39;: 7069, &#39;estimatedDuration&#39;: 7681, &#39;executor&#39;: None, &#39;fullDisplayName&#39;: &#39;ansible-playbook #62&#39;, &#39;id&#39;: &#39;62&#39;, &#39;keepLog&#39;: False, &#39;number&#39;: 62, &#39;queueId&#39;: 33, &#39;result&#39;: &#39;ABORTED&#39;, &#39;timestamp&#39;: 1516186369042, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;job&#x2F;ansible-playbook&#x2F;62&#x2F;&#39;, &#39;builtOn&#39;: &#39;&#39;, &#39;changeSet&#39;: &#123;&#39;_class&#39;: &#39;hudson.plugins.git.GitChangeSetList&#39;, &#39;items&#39;: [], &#39;kind&#39;: &#39;git&#39;&#125;, &#39;culprits&#39;: []&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># shutdown jenkins</span><br><span class="line">server.quiet_down()</span><br></pre></td></tr></table></figure>
<h4 id="Working-with-Jenkins-Views"><a href="#Working-with-Jenkins-Views" class="headerlink" title="Working with Jenkins Views"></a>Working with Jenkins Views</h4><p>This is an example showing how to create, configure and delete Jenkins views.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è¯•å›¾ç›¸å…³</span><br><span class="line">print(server.get_views())</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">[&#123;&#39;_class&#39;: &#39;hudson.model.AllView&#39;, &#39;name&#39;: &#39;all&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;&#39;&#125;, &#123;&#39;_class&#39;: &#39;hudson.model.ListView&#39;, &#39;name&#39;: &#39;myview&#39;, &#39;url&#39;: &#39;http:&#x2F;&#x2F;127.0.0.1:8080&#x2F;view&#x2F;myview&#x2F;&#39;&#125;]</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># CURD VIEW</span><br><span class="line">server.view_exists()</span><br><span class="line">server.create_view(&#39;EMPTY&#39;, jenkins.EMPTY_VIEW_CONFIG_XML)</span><br><span class="line">views &#x3D; server.get_views()</span><br><span class="line">server.delete_view(&#39;EMPTY&#39;)</span><br><span class="line">server.reconfig_view(&#39;newview&#39;,jenkins.EMPTY_VIEW_CONFIG_XML)</span><br><span class="line">server.get_view_name(&#39;EMPTY&#39;)</span><br><span class="line">view_config &#x3D; server.get_view_config(&#39;EMPTY&#39;)</span><br><span class="line"># è·å–è¯•å›¾ä¸‹æ‰€æœ‰çš„job</span><br><span class="line">print(server._get_view_jobs(&#39;myview&#39;))</span><br><span class="line"></span><br><span class="line"># è¯•å›¾é…ç½®ä¿¡æ¯</span><br><span class="line">print(server.get_view_config(&#39;myview&#39;))</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;hudson.model.ListView&gt;</span><br><span class="line">  &lt;name&gt;myview&lt;&#x2F;name&gt;</span><br><span class="line">  &lt;description&gt;æµ‹è¯•è¯•å›¾&lt;&#x2F;description&gt;</span><br><span class="line">  &lt;filterExecutors&gt;false&lt;&#x2F;filterExecutors&gt;</span><br><span class="line">  &lt;filterQueue&gt;false&lt;&#x2F;filterQueue&gt;</span><br><span class="line">  &lt;properties class&#x3D;&quot;hudson.model.View$PropertyList&quot;&#x2F;&gt;</span><br><span class="line">  &lt;jobNames&gt;</span><br><span class="line">    &lt;comparator class&#x3D;&quot;hudson.util.CaseInsensitiveComparator&quot;&#x2F;&gt;</span><br><span class="line">    &lt;string&gt;ansible-playbook&lt;&#x2F;string&gt;</span><br><span class="line">    &lt;string&gt;my-github&lt;&#x2F;string&gt;</span><br><span class="line">  &lt;&#x2F;jobNames&gt;</span><br><span class="line">  &lt;jobFilters&#x2F;&gt;</span><br><span class="line">  &lt;columns&gt;</span><br><span class="line">    &lt;hudson.views.StatusColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.WeatherColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.JobColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.LastSuccessColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.LastDurationColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.views.BuildButtonColumn&#x2F;&gt;</span><br><span class="line">    &lt;hudson.plugins.git.GitBranchSpecifierColumn plugin&#x3D;&quot;git@3.7.0&quot;&#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;columns&gt;</span><br><span class="line">  &lt;recurse&gt;false&lt;&#x2F;recurse&gt;</span><br><span class="line">&lt;&#x2F;hudson.model.ListView&gt;</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å»ºè®®ä½¿ç”¨Python Jenkinsæ¨¡å—ï¼Œç›¸å¯¹JenkinsApiè€Œè¨€ï¼Œæ¨¡å—å°è£…çš„æ›´å¥½ã€‚æ¥å£è°ƒç”¨æ›´æ–¹ä¾¿ï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹,æ¨¡å—å†…å®¹ä¸æ˜¯å¾ˆå¤šï¼Œå¯ä»¥è‡ªå·±ç ”è¯»æºç è¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œæ–¹ä¾¿ä¸å…¶ä»–ç³»ç»Ÿé›†æˆï¼Œæ›´å¥½çš„è½åœ°DevOpsæ–¹æ¡ˆçš„å®æ–½;</p>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>Jenkinsfile æ„å»ºç¤ºä¾‹</title>
    <url>/2020/04/20/Jenkinsfile-%E6%9E%84%E5%BB%BA%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="Jenkinsfile-æ„å»ºç¤ºä¾‹"><a href="#Jenkinsfile-æ„å»ºç¤ºä¾‹" class="headerlink" title="Jenkinsfile æ„å»ºç¤ºä¾‹"></a>Jenkinsfile æ„å»ºç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;pipeline &#123;</span><br><span class="line">    &#x2F;&#x2F;åœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šæ‰§è¡ŒPipeline</span><br><span class="line">    &#x2F;&#x2F;</span><br><span class="line">    agent &#123;</span><br><span class="line">        node &#123;</span><br><span class="line">            label &quot;PTtest&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    options &#123;</span><br><span class="line">        buildDiscarder(logRotator(numToKeepStr: &#39;5&#39;))</span><br><span class="line">        disableConcurrentBuilds()</span><br><span class="line">    &#125;</span><br><span class="line">    tools &#123;</span><br><span class="line">        jdk &#39;Oracle JDK 8&#39;</span><br><span class="line">        maven &#39;Maven 3&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    environment &#123;</span><br><span class="line">        def serviceName  &#x3D; &quot;&quot;</span><br><span class="line">        &#x2F;&#x2F; hosts must be splited by dot</span><br><span class="line">        def warFilePath &#x3D; &#39;mywo-crud-provider&#x2F;target&#x2F;mywo-crud-provider.war&#39;</span><br><span class="line">        def hosts &#x3D; &quot;10.41.118.137&quot;</span><br><span class="line">        def deploy_user &#x3D; &quot;app-deploy&quot;</span><br><span class="line">        def artifactsPath &#x3D; &quot;devops-artifacts&quot;</span><br><span class="line">        def department &#x3D; &quot;meiwozufang&quot;</span><br><span class="line">        def artifactOssPath &#x3D; &quot;$&#123; department &#125;&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">        def tempFolder &#x3D; &quot;$&#123; WORKSPACE &#125;&#x2F;$&#123; env.JOB_NAME &#125;&#x2F;$&#123; env.BUILD_NUMBER &#125;&quot;</span><br><span class="line">        def target_dir &#x3D; &quot;&#x2F;data&#x2F;services&#x2F;tomcat-mywo-crud-8090&quot;</span><br><span class="line">        def git_commit_id &#x3D; &quot;&quot;</span><br><span class="line">        def artifact &#x3D; &quot;&quot;</span><br><span class="line">        def jmeterHome &#x3D; &quot;&#x2F;home&#x2F;jenkins&#x2F;apache-jmeter-3.1&quot;</span><br><span class="line">        def antHome &#x3D; &quot;&#x2F;home&#x2F;jenkins&#x2F;apache-ant-1.9.9&quot;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    stages &#123;</span><br><span class="line">        stage(&#39;Preparation&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;rm -rf &#x2F;tmp&#x2F;$&#123; env.JOB_NAME &#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Checkout code&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;starting fetchCode......&quot;</span><br><span class="line">                checkout scm</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;SonarQube analysis&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                echo &quot;starting codeAnalyze......&quot;</span><br><span class="line">                script &#123;</span><br><span class="line">                    echo &quot;starting script......&quot;</span><br><span class="line">                    def sonarqubeScannerHome &#x3D; tool name: &#39;SonarQube Scanner&#39;</span><br><span class="line">                    withSonarQubeEnv(&#39;SonarQube-Public&#39;) &#123;</span><br><span class="line">                        sh &quot;$&#123;sonarqubeScannerHome&#125;&#x2F;bin&#x2F;sonar-scanner&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#x2F;&#x2F;       stage(&quot;SonarQube Quality Gate&quot;) &#123;</span><br><span class="line"> &#x2F;&#x2F;           when &#123;</span><br><span class="line"> &#x2F;&#x2F;               branch fuck</span><br><span class="line"> &#x2F;&#x2F;           &#125;</span><br><span class="line"> &#x2F;&#x2F;           steps &#123;</span><br><span class="line"> &#x2F;&#x2F;               echo &quot;starting waitForQualityGate......&quot;</span><br><span class="line"> &#x2F;&#x2F;               script &#123;</span><br><span class="line"> &#x2F;&#x2F;                   echo &quot;starting script......&quot;</span><br><span class="line"> &#x2F;&#x2F;                    timeout(time: 1, unit: &#39;HOURS&#39;) &#123;</span><br><span class="line"> &#x2F;&#x2F;                      def qg &#x3D; waitForQualityGate()</span><br><span class="line"> &#x2F;&#x2F;                      if (qg.status !&#x3D; &#39;OK&#39;) &#123;</span><br><span class="line"> &#x2F;&#x2F;                         error &quot;Pipeline aborted due to quality gate failure: $&#123;qg.status&#125;&quot;</span><br><span class="line"> &#x2F;&#x2F;                      &#125;</span><br><span class="line"> &#x2F;&#x2F;                    &#125;</span><br><span class="line"> &#x2F;&#x2F;               &#125;</span><br><span class="line"> &#x2F;&#x2F;           &#125;</span><br><span class="line"> &#x2F;&#x2F;       &#125;</span><br><span class="line"></span><br><span class="line">        stage(&#39;Compile branch master&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;master&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                withMaven(globalMavenSettingsConfig: &#39;bfa90212-2742-4611-aa71-8e0ec76d0c28&#39;, jdk: &#39;Oracle JDK 8&#39;, maven: &#39;Maven 3&#39;, mavenSettingsConfig: &#39;02e95d2b-6bb6-457d-943f-13c63095e500&#39;) &#123;</span><br><span class="line">                    sh &quot;mvn -Dmaven.test.skip&#x3D;true  clean package -U -DskipTests&#x3D;True&quot;</span><br><span class="line">                    sh &quot;echo this is master branch.&quot;</span><br><span class="line">                &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Compile branch test&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                withMaven(globalMavenSettingsConfig: &#39;bfa90212-2742-4611-aa71-8e0ec76d0c28&#39;, jdk: &#39;Oracle JDK 8&#39;, maven: &#39;Maven 3&#39;, mavenSettingsConfig: &#39;02e95d2b-6bb6-457d-943f-13c63095e500&#39;) &#123;</span><br><span class="line">                    sh &quot;mvn -Dmaven.test.skip&#x3D;true  clean package -U -DskipTests&#x3D;True&quot;</span><br><span class="line">                    sh &quot;echo this is test branch.&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Package &amp; Upload to OSS&#39;) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh &quot;mkdir -p $&#123; tempFolder &#125;&quot;</span><br><span class="line">                script &#123;</span><br><span class="line">                    sh &quot;echo Upload to OSS.&quot;</span><br><span class="line">                    git_commit_id &#x3D; sh(returnStdout: true, script: &#39;git rev-parse --short HEAD&#39;).trim() &#x2F;&#x2F;éœ€è¦è·å–shellè¿”å›å€¼æ“ä½œ</span><br><span class="line">                    serviceName &#x3D; sh(returnStdout: true, script: &quot;basename $&#123; warFilePath &#125; | cut -d . -f 1&quot;).trim()</span><br><span class="line">                    sh &quot;mv $&#123; warFilePath &#125; $&#123; tempFolder &#125;&#x2F;ROOT.war&quot;</span><br><span class="line">                    artifact &#x3D; &quot;$&#123; serviceName &#125;_$&#123; env.BUILD_NUMBER &#125;-$&#123; env.BRANCH_NAME &#125;-$&#123; git_commit_id &#125;.tar.gz&quot;</span><br><span class="line">                    sh &quot;mkdir -p $&#123; artifactsPath &#125; &amp;&amp; tar czf $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -C $&#123; tempFolder &#125; ROOT.war&quot;</span><br><span class="line">                    sh &quot;upload-flash -f $&#123; artifactsPath &#125;&#x2F;$&#123; artifact &#125; -t $&#123; artifactOssPath &#125;&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Deploy Package&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                script &#123;</span><br><span class="line">                    echo &quot;starting deploy......&quot;</span><br><span class="line">                    &#x2F;&#x2F; è¿ç»´äººå‘˜ç»´æŠ¤ç§æœ‰ä»“åº“ï¼Œä¿å­˜ansible-playbookçš„é…ç½®æ–‡ä»¶</span><br><span class="line">                    git([url: &#39;git@git.shuke.com:shuke&#x2F;ansiblefiles.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7bc6cda9-a250-4d99-962c-e2ede002db06&#39;])</span><br><span class="line">                    withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;ansible_deploy:1.0.4&#39;]) &#123;</span><br><span class="line">                            sh &quot;ansible-playbook -i hosts --extra-vars &#39;warFilePath&#x3D;$&#123; tempFolder &#125;&#x2F;ROOT.war target_dir&#x3D;$&#123; target_dir &#125;&#39; -vv deploy_war.yml -l $&#123; hosts &#125;&quot;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;Integration Test&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            parallel &#123;</span><br><span class="line">                stage(&#39;API Test&#39;) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo &quot;starting API......&quot;  </span><br><span class="line">                        echo &quot;starting fetchAPI......&quot;</span><br><span class="line">                        dir(&#39;API&#39;) &#123;</span><br><span class="line">                            echo &quot;starting APIScript......&quot;</span><br><span class="line">                            git([url: &#39;git@git.shuke.com:api_test&#x2F;RentHouse.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                            script &#123;</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;robotframework:1.0.1&#39;]) &#123;</span><br><span class="line">                                            sh &quot;pybot RentHouse_API_Test&#x2F;test&quot;</span><br><span class="line">                                        &#125; </span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;catch (exc) &#123;</span><br><span class="line">                                   echo &#39;Something failed, I should sound the klaxons!&#39;</span><br><span class="line">                                   emailContent &#x3D;  &quot;APIæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">                                &#125;finally&#123;</span><br><span class="line">                                  sh &quot;cp -r .&#x2F;output.xml &#x2F;home&#x2F;jenkins&#x2F;public&#x2F;outputRentHouse_API_Prduction.xml&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">&#x2F;&#x2F;                stage(&#39;UI&#39;) &#123;</span><br><span class="line">&#x2F;&#x2F;                    steps &#123;</span><br><span class="line">&#x2F;&#x2F;                      echo &quot;starting UI......&quot;</span><br><span class="line">&#x2F;&#x2F;                    &#x2F;&#x2F;   æµ‹è¯•é—ªé“¶UI</span><br><span class="line">&#x2F;&#x2F;                        dir(&#39;UI&#39;) &#123;</span><br><span class="line">&#x2F;&#x2F;                            git([url: &#39;git@git.shuke.com:ui_test&#x2F;Wecash_RentalHouse.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">&#x2F;&#x2F;                            script &#123;</span><br><span class="line">&#x2F;&#x2F;                                echo &quot;starting UIScript......&quot;</span><br><span class="line">&#x2F;&#x2F;                                try &#123;</span><br><span class="line">&#x2F;&#x2F;                                   &#x2F;&#x2F;sh &quot;cd &#x2F;gg&quot;</span><br><span class="line">&#x2F;&#x2F;                                   echo &quot;starting UIScript......&quot;</span><br><span class="line">&#x2F;&#x2F;                                   &#x2F;&#x2F; æ‰§è¡Œé€Ÿåº¦å¤ªæ…¢ï¼Œå…ˆæ³¨é‡Šä»£ç </span><br><span class="line">&#x2F;&#x2F;                                   withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">&#x2F;&#x2F;                                        withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;python-chromedriver:2.7-alpine3.7-selenium&#39;]) &#123;</span><br><span class="line">&#x2F;&#x2F;                                            sh &quot;python TestSuite&#x2F;Runner.py All All business-renthouse&quot;</span><br><span class="line">&#x2F;&#x2F;                                        &#125;</span><br><span class="line">&#x2F;&#x2F;                                    &#125;</span><br><span class="line">&#x2F;&#x2F;                                    sh &quot;&#x2F;usr&#x2F;bin&#x2F;python TestSuite&#x2F;Runner.py All All business-renthouse&quot;</span><br><span class="line">&#x2F;&#x2F;                                &#125;catch (exc) &#123;</span><br><span class="line">&#x2F;&#x2F;                                   echo &#39;Something failed, I should sound the klaxons!&#39;</span><br><span class="line">&#x2F;&#x2F;                                   emailContent &#x3D; &quot;UIæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">&#x2F;&#x2F;                                &#125;</span><br><span class="line">&#x2F;&#x2F;                            &#125;</span><br><span class="line">&#x2F;&#x2F;                        &#125;</span><br><span class="line">&#x2F;&#x2F;                    &#125;</span><br><span class="line">&#x2F;&#x2F;                &#125;</span><br><span class="line">                stage(&#39;PT&#39;) &#123;</span><br><span class="line">                    steps &#123;</span><br><span class="line">                        echo &quot;starting PT......&quot;</span><br><span class="line">                        dir(&#39;PT&#39;) &#123;</span><br><span class="line">                            git credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;, url: &#39;git@git.shuke.com:p_test&#x2F;MeiWo.git&#39;</span><br><span class="line">                        &#125;</span><br><span class="line">                        dir(&#39;Tools&#39;) &#123;</span><br><span class="line">                            script &#123;</span><br><span class="line">                                echo &quot;starting PTScript......&quot;</span><br><span class="line">                                git([url: &#39;git@git.shuke.com:gonghui&#x2F;script.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                                try &#123;</span><br><span class="line">                                    withEnv([&quot;JAVA_HOME&#x3D;$&#123;tool &#39;Oracle JDK 8&#39;&#125;&quot;]) &#123;</span><br><span class="line">                                        sh &quot;$&#123;antHome&#125;&#x2F;bin&#x2F;ant -f $&#123; WORKSPACE &#125;&#x2F;Tools&#x2F;PerformFilesWithPipline&#x2F;build.xml -Dname&#x3D;MeiWo -Denv&#x3D;Test -DJOB_NAME&#x3D;$&#123;JOB_NAME&#125; -DWORKSPACE&#x3D;$&#123;WORKSPACE&#125; -DjmeterHome&#x3D;$&#123;jmeterHome&#125; run&quot;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    echo &quot;starting PTAnalyze......&quot;</span><br><span class="line">                                    sh &quot;python $&#123; WORKSPACE &#125;&#x2F;Tools&#x2F;PerformFilesWithPipline&#x2F;jmeterQYWeiXinWithTimeoutArgu.py $&#123; WORKSPACE &#125;&#x2F;PT&#x2F;results&#x2F; MeiWo 2 5 500 4000&quot;</span><br><span class="line">                                    sh &quot;cp -r $&#123; WORKSPACE &#125;&#x2F;PT&#x2F;results&#x2F;ParseOri.html &#x2F;home&#x2F;jenkins&#x2F;public&#x2F;&quot;</span><br><span class="line">                                &#125;catch (exc) &#123;</span><br><span class="line">                                    echo &#39;PTæ‰§è¡ŒæŠ¥é”™äº†!!&#39;</span><br><span class="line">                                    emailContent &#x3D; &quot;PTæ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™äº†ï¼ï¼&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;  </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stage(&#39;conformReport&amp;noticify&#39;) &#123;</span><br><span class="line">            when &#123;</span><br><span class="line">                branch &#39;test&#39;</span><br><span class="line">            &#125;</span><br><span class="line">            steps &#123;</span><br><span class="line">                 echo &quot;starting email......&quot;</span><br><span class="line">                 </span><br><span class="line">                dir(&#39;conformresult&#39;) &#123;</span><br><span class="line">                    script&#123;</span><br><span class="line">                        git([url: &#39;git@git.shuke.com:gonghui&#x2F;script.git&#39;, branch: &#39;master&#39;, credentialsId: &#39;7726e85b-f455-40d1-b12c-447ecac70f23&#39;])</span><br><span class="line">                        withDockerRegistry([credentialsId: &#39;82a6a986-3f85-49f9-a926-0edf499fd1e3&#39;, url: &#39;https:&#x2F;&#x2F;dockerhub.shuke.com:5000&#39;]) &#123;</span><br><span class="line">                            withDockerContainer([image: &#39;dockerhub.shuke.com:5000&#x2F;test&#x2F;python3.6.5:1.0.0&#39;,args: &#39;-v &#x2F;data&#x2F;docker&#x2F;jenkins-slave-prod&#x2F;public:&#x2F;home&#x2F;jenkins&#x2F;public&#39;]) &#123;</span><br><span class="line">                                sh &quot;python3 parseScript&#x2F;conformReport.py &#x2F;home&#x2F;jenkins&#x2F;public $&#123; email_list &#125; $&#123;JOB_NAME&#125;-Build&#x2F;&#x2F;$&#123;BUILD_ID&#125;-&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    post &#123;</span><br><span class="line">        always &#123;</span><br><span class="line">            echo &#39;always!&#39;</span><br><span class="line">            deleteDir()</span><br><span class="line">        &#125;</span><br><span class="line">        success &#123;</span><br><span class="line">            emailext body: &quot;Pipeline Success: Please Go to deploy if you pushed master just now&quot;,</span><br><span class="line">                recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;], [$class: &#39;RequesterRecipientProvider&#39;]],</span><br><span class="line">                subject: &quot;&#39;$&#123;JOB_NAME&#125;&#39; ($&#123;BUILD_NUMBER&#125;)times SUCCESS&quot;,</span><br><span class="line">                to: &#39;&#39;</span><br><span class="line">            echo &#39;success!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        failure &#123;</span><br><span class="line">            emailext body: &quot;Pipeline error: Please go to $&#123;BUILD_URL&#125; and verify the build \n $&#123; emailContent &#125;&quot;,</span><br><span class="line">                recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;], [$class: &#39;RequesterRecipientProvider&#39;]],</span><br><span class="line">                subject: &quot;&#39;$&#123;JOB_NAME&#125;&#39; ($&#123;BUILD_NUMBER&#125;)times FAILED&quot;,</span><br><span class="line">                to: &#39;&#39;</span><br><span class="line">            echo &#39;failure!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        unstable &#123;</span><br><span class="line">            echo &#39;unstable!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">        changed &#123;</span><br><span class="line">            echo &#39;changed!&#39;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title> Logrotateæ—¥å¿—åˆ‡å‰²</title>
    <url>/2020/04/20/Logrotate%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2/</url>
    <content><![CDATA[<h2 id="Logrotateæ—¥å¿—åˆ‡å‰²"><a href="#Logrotateæ—¥å¿—åˆ‡å‰²" class="headerlink" title="Logrotateæ—¥å¿—åˆ‡å‰²"></a>Logrotateæ—¥å¿—åˆ‡å‰²</h2><h3 id="crontabé…ç½®"><a href="#crontabé…ç½®" class="headerlink" title="crontabé…ç½®"></a>crontabé…ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">59 23 * * * &#x2F;usr&#x2F;sbin&#x2F;logrotate  -f  &#x2F;data&#x2F;scripts&#x2F;logrotate_pylog.conf</span><br></pre></td></tr></table></figure>

<h3 id="logrotateé…ç½®"><a href="#logrotateé…ç½®" class="headerlink" title="logrotateé…ç½®"></a>logrotateé…ç½®</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;data&#x2F;service&#x2F;proxy-pool-master-select&#x2F;nohup.out</span><br><span class="line">&#123;</span><br><span class="line">    rotate 1</span><br><span class="line">    daily</span><br><span class="line">    dateext</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    copytruncate</span><br><span class="line">    olddir &#x2F;data&#x2F;service&#x2F;proxy-pool-master-select</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;data&#x2F;service&#x2F;proxy-pool-master-core&#x2F;nohup.out</span><br><span class="line">&#123;</span><br><span class="line">    rotate 1</span><br><span class="line">    daily</span><br><span class="line">    dateext</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    copytruncate</span><br><span class="line">    olddir &#x2F;data&#x2F;service&#x2F;proxy-pool-master-core</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>JVMè°ƒä¼˜å‘½ä»¤</title>
    <url>/2020/04/20/JVM%E8%B0%83%E4%BC%98%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="JVMè°ƒä¼˜å‘½ä»¤"><a href="#JVMè°ƒä¼˜å‘½ä»¤" class="headerlink" title="JVMè°ƒä¼˜å‘½ä»¤"></a>JVMè°ƒä¼˜å‘½ä»¤</h2><blockquote>
<p>è¿ç”¨jvmè‡ªå¸¦çš„å‘½ä»¤å¯ä»¥æ–¹ä¾¿çš„åœ¨ç”Ÿäº§ç›‘æ§å’Œæ‰“å°å †æ ˆçš„æ—¥å¿—ä¿¡æ¯å¸®å¿™æˆ‘ä»¬æ¥å®šä½é—®é¢˜ï¼è™½ç„¶jvmè°ƒä¼˜æˆç†Ÿçš„å·¥å…·å·²ç»æœ‰å¾ˆå¤šï¼šjconsoleã€å¤§åé¼é¼çš„VisualVMï¼ŒIBMçš„Memory Analyzerç­‰ç­‰ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œä¸€æ–¹é¢å·¥å…·çš„ä½¿ç”¨ä¼šæœ‰æ‰€é™åˆ¶ï¼Œå¦ä¸€æ–¹é¢å–œæ¬¢è£…Xçš„æˆ‘ä»¬ï¼Œæ€»å–œæ¬¢åœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™åœ¨ç»ˆç«¯è¾“å…¥ä¸€äº›å‘½ä»¤æ¥è§£å†³ã€‚æ‰€æœ‰çš„å·¥å…·å‡ ä¹éƒ½æ˜¯ä¾èµ–äºjdkçš„æ¥å£å’Œåº•å±‚çš„è¿™äº›å‘½ä»¤ï¼Œç ”ç©¶è¿™äº›å‘½ä»¤çš„ä½¿ç”¨ä¹Ÿè®©æˆ‘ä»¬æ›´èƒ½äº†è§£jvmæ„æˆå’Œç‰¹æ€§ã€‚<br>Sun JDKç›‘æ§å’Œæ•…éšœå¤„ç†å‘½ä»¤æœ‰jps jstat jmap jhat jstack jinfoä¸‹é¢åšä¸€ä¸€ä»‹ç»</p>
</blockquote>
<h3 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h3><blockquote>
<p>JVM Process Status Tool,æ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚</p>
</blockquote>
<p>å‘½ä»¤æ ¼å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jps [options] [hostid]</span><br></pre></td></tr></table></figure>
<p>optionå‚æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-l : è¾“å‡ºä¸»ç±»å…¨åæˆ–jarè·¯å¾„</span><br><span class="line">-q : åªè¾“å‡ºLVMID</span><br><span class="line">-m : è¾“å‡ºJVMå¯åŠ¨æ—¶ä¼ é€’ç»™main()çš„å‚æ•°</span><br><span class="line">-v : è¾“å‡ºJVMå¯åŠ¨æ—¶æ˜¾ç¤ºæŒ‡å®šçš„JVMå‚æ•°</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­<code>[option]ã€[hostid]</code>å‚æ•°ä¹Ÿå¯ä»¥ä¸å†™</p>
<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jps -mlv</span><br><span class="line">1808 &#x2F;data&#x2F;services&#x2F;brazil_DivisionCaseTools&#x2F;DivisionCaseTools_br-1.0.jar --spring.profiles.active&#x3D;br-prod -Xmx1024M -Duser.timezone&#x3D;America&#x2F;Sao_Paulo</span><br><span class="line">8196 &#x2F;data&#x2F;services&#x2F;brazil_phonebook&#x2F;phonebook_br-0.0.1-SNAPSHOT.jar --spring.profiles.active&#x3D;br-prod -Xmx1024M -Duser.timezone&#x3D;America&#x2F;Sao_Paulo</span><br><span class="line">4756 org.apache.catalina.startup.Bootstrap start -Djava.util.logging.config.file&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter&#x2F;conf&#x2F;logging.properties -Djava.util.logging.manager&#x3D;org.apache.juli.ClassLoaderLogManager -Xmx1G -Xms1G -XX:MetaspaceSize&#x3D;128M -XX:MaxMetaspaceSize&#x3D;128M -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter&#x2F;logs&#x2F;dump -XX:+PrintClassHistogram -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintHeapAtGC -Xloggc:&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter&#x2F;logs&#x2F;gc.log -Djdk.tls.ephemeralDHKeySize&#x3D;2048 -Djava.protocol.handler.pkgs&#x3D;org.apache.catalina.webresources -Djava.endorsed.dirs&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter&#x2F;endorsed -Dcatalina.base&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter -Dcatalina.home&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter -Djava.io.tmpdir&#x3D;&#x2F;data&#x2F;services&#x2F;brazil_AuthCenter&#x2F;temp</span><br><span class="line">3928 &#x2F;data&#x2F;soft&#x2F;lts&#x2F;lts-task-tracker&#x2F;prod&#x2F;lts-tasktracker-springboot-1.6.9.jar -Duser.timezone&#x3D;America&#x2F;Sao_Paulo -Xmx256M</span><br></pre></td></tr></table></figure>

<h3 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h3><blockquote>
<p>jstat(JVM statistics Monitoring)æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p>
</blockquote>
<h4 id="å‘½ä»¤æ ¼å¼"><a href="#å‘½ä»¤æ ¼å¼" class="headerlink" title="å‘½ä»¤æ ¼å¼"></a>å‘½ä»¤æ ¼å¼</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jstat [option] LVMID [interval] [count]</span><br></pre></td></tr></table></figure>
<p>è¡¥å……:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å †å†…å­˜ &#x3D; å¹´è½»ä»£ + å¹´è€ä»£ + æ°¸ä¹…ä»£ + å…ƒæ•°æ®åŒº</span><br><span class="line">å¹´è½»ä»£ &#x3D; EdenåŒº + ä¸¤ä¸ªSurvivoråŒºï¼ˆFromå’ŒToï¼‰</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; jstat -options</span><br><span class="line"></span><br><span class="line">-class æ˜¾ç¤ºClassLoadçš„ç›¸å…³ä¿¡æ¯ï¼›</span><br><span class="line">-compiler æ˜¾ç¤ºJITç¼–è¯‘çš„ç›¸å…³ä¿¡æ¯ï¼›</span><br><span class="line">-gc æ˜¾ç¤ºå’Œgcç›¸å…³çš„å †ä¿¡æ¯ï¼›</span><br><span class="line">-gccapacity ã€€ã€€ æ˜¾ç¤ºå„ä¸ªä»£çš„å®¹é‡ä»¥åŠä½¿ç”¨æƒ…å†µï¼›</span><br><span class="line">-gcmetacapacity æ˜¾ç¤ºmetaspaceçš„å¤§å°</span><br><span class="line">-gcnew æ˜¾ç¤ºæ–°ç”Ÿä»£ä¿¡æ¯ï¼›</span><br><span class="line">-gcnewcapacity æ˜¾ç¤ºæ–°ç”Ÿä»£å¤§å°å’Œä½¿ç”¨æƒ…å†µï¼›</span><br><span class="line">-gcold æ˜¾ç¤ºè€å¹´ä»£å’Œæ°¸ä¹…ä»£çš„ä¿¡æ¯ï¼›</span><br><span class="line">-gcoldcapacity æ˜¾ç¤ºè€å¹´ä»£çš„å¤§å°ï¼›</span><br><span class="line">-gcutilã€€ã€€ æ˜¾ç¤ºåƒåœ¾æ”¶é›†ä¿¡æ¯ï¼›</span><br><span class="line">-gccause æ˜¾ç¤ºåƒåœ¾å›æ”¶çš„ç›¸å…³ä¿¡æ¯ï¼ˆé€š-gcutilï¼‰,åŒæ—¶æ˜¾ç¤ºæœ€åä¸€æ¬¡æˆ–å½“å‰æ­£åœ¨å‘ç”Ÿçš„åƒåœ¾å›æ”¶çš„è¯±å› ï¼›</span><br><span class="line">-printcompilation è¾“å‡ºJITç¼–è¯‘çš„æ–¹æ³•ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>å‚æ•°åç§° | å‚æ•°è¯´æ˜<br>â€”|â€”|â€”<br>class | ç”¨äºæŸ¥çœ‹ç±»åŠ è½½æƒ…å†µçš„ç»Ÿè®¡ï¼Œæ˜¾ç¤ºåŠ è½½classçš„æ•°é‡ï¼ŒåŠæ‰€å ç©ºé—´ç­‰ä¿¡æ¯ã€‚<br>compiler | æŸ¥çœ‹HotSpotä¸­å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æƒ…å†µçš„ç»Ÿè®¡<br>gc | æŸ¥çœ‹JVMä¸­å †çš„åƒåœ¾æ”¶é›†æƒ…å†µçš„ç»Ÿè®¡ï¼Œå¯ä»¥æ˜¾ç¤ºgcçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹gcçš„æ¬¡æ•°ï¼ŒåŠæ—¶é—´ã€‚å…¶ä¸­æœ€åäº”é¡¹ï¼Œåˆ†åˆ«æ˜¯young gcçš„æ¬¡æ•°ï¼Œyoung gcçš„æ—¶é—´ï¼Œfull gcçš„æ¬¡æ•°ï¼Œfull gcçš„æ—¶é—´ï¼Œgcçš„æ€»æ—¶é—´ã€‚<br>gccapacity | æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä¹…ä»£çš„å­˜å‚¨å®¹é‡æƒ…å†µï¼Œå¯ä»¥æ˜¾ç¤ºï¼ŒVMå†…å­˜ä¸­ä¸‰ä»£ï¼ˆyoung,old,permï¼‰å¯¹è±¡çš„ä½¿ç”¨å’Œå ç”¨å¤§å°<br>gccause | æŸ¥çœ‹åƒåœ¾æ”¶é›†çš„ç»Ÿè®¡æƒ…å†µï¼ˆè¿™ä¸ªå’Œ-gcutilé€‰é¡¹ä¸€æ ·ï¼‰ï¼Œå¦‚æœæœ‰å‘ç”Ÿåƒåœ¾æ”¶é›†ï¼Œå®ƒè¿˜ä¼šæ˜¾ç¤ºæœ€åä¸€æ¬¡åŠå½“å‰æ­£åœ¨å‘ç”Ÿåƒåœ¾æ”¶é›†çš„åŸå› <br>gcmetacapacity | æ˜¾ç¤ºå…³äºmetaspaceå¤§å°çš„ç»Ÿè®¡ä¿¡æ¯ã€‚<br>gcnew | æŸ¥çœ‹æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†çš„æƒ…å†µï¼Œnewå¯¹è±¡çš„ä¿¡æ¯<br>gcnewcapacity | ç”¨äºæŸ¥çœ‹æ–°ç”Ÿä»£çš„å­˜å‚¨å®¹é‡æƒ…å†µï¼Œnewå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡<br>gcold | ç”¨äºæŸ¥çœ‹è€ç”Ÿä»£åŠæŒä¹…ä»£å‘ç”ŸGCçš„æƒ…å†µï¼Œoldå¯¹è±¡çš„ä¿¡æ¯<br>gcoldcapacity | ç”¨äºæŸ¥çœ‹è€ç”Ÿä»£çš„å®¹é‡ï¼Œoldå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡<br>gcpermcapacity | ç”¨äºæŸ¥çœ‹æŒä¹…ä»£çš„å®¹é‡ï¼Œpermå¯¹è±¡çš„ä¿¡æ¯åŠå…¶å ç”¨é‡<br>gcutil | æŸ¥çœ‹æ–°ç”Ÿä»£ã€è€ç”Ÿä»£åŠæŒä»£åƒåœ¾æ”¶é›†çš„æƒ…å†µ<br>printcompilation | å½“å‰VMæ‰§è¡Œçš„ä¿¡æ¯</p>
<h3 id="å‚æ•°ä½¿ç”¨ç¤ºä¾‹"><a href="#å‚æ•°ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="å‚æ•°ä½¿ç”¨ç¤ºä¾‹"></a>å‚æ•°ä½¿ç”¨ç¤ºä¾‹</h3><ol>
<li>jstat -gc  pid  åƒåœ¾å›æ”¶ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jstat -gc 1808</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">1536.0 1536.0 288.0   0.0   346112.0 136222.0  233472.0   151382.5  60416.0 58963.1 6912.0 6587.0  32144   93.009   5      0.469   93.478</span><br><span class="line">- S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">- S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">- S0Uï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- S1Uï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">- EUï¼šä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- OCï¼šè€å¹´ä»£å¤§å°</span><br><span class="line"></span><br><span class="line">- OUï¼šè€å¹´ä»£ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- MCï¼šæ–¹æ³•åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">- MUï¼šæ–¹æ³•åŒºä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- CCSC:å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">- CCSU:å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">- YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line"></span><br><span class="line">- FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">- FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line"></span><br><span class="line">- GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</span><br></pre></td></tr></table></figure></li>
<li>jstat -gcutil pid  æ€»åƒåœ¾å›æ”¶ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jstat -gcutil 1808</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line"> 18.75   0.00  39.38  64.84  97.60  95.30  32144   93.009     5    0.469   93.478</span><br><span class="line"> S0ï¼šå¹¸å­˜1åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">S1ï¼šå¹¸å­˜2åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">Eï¼šä¼Šç”¸å›­åŒºä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">Oï¼šè€å¹´ä»£ä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">Mï¼šå…ƒæ•°æ®åŒºä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">CCSï¼šå‹ç¼©ä½¿ç”¨æ¯”ä¾‹</span><br><span class="line"></span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line"></span><br><span class="line">GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</span><br></pre></td></tr></table></figure></li>
<li>jstat -gcnew  pid æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jstat -gcnew 1808</span><br><span class="line"> S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line">1536.0 1536.0  288.0    0.0 15  15 1536.0 346112.0 136299.9  32144   93.009</span><br><span class="line">- S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">- S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">- S0Uï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- S1Uï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- TT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">- MTT:å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">- DSS:æœŸæœ›çš„å¹¸å­˜åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">- ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">- EUï¼šä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°</span><br><span class="line"></span><br><span class="line">- YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">- YGCTï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br></pre></td></tr></table></figure></li>
<li>jstat -gccapacity pid å †å†…å­˜ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> è®°å¿†è¿™ä¸ªå‘½ä»¤å¯ä»¥æ ¹æ®å•è¯ç»„åˆè®°å¿†</span><br><span class="line"> -gc &#x3D;&gt; åç§°</span><br><span class="line"> capacity &#x3D;&gt; å®¹é‡</span><br><span class="line">root@jav-collection01br-p001:~# jstat -gccapacity 1808</span><br><span class="line"> NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC    YGC    FGC</span><br><span class="line"> 40960.0 349184.0 349184.0 1536.0 1536.0 346112.0    81920.0   699392.0   233472.0   233472.0      0.0 1103872.0  60416.0      0.0 1048576.0   6912.0  32144     5</span><br><span class="line">NGCMNï¼šæ–°ç”Ÿä»£æœ€å°å®¹é‡</span><br><span class="line"></span><br><span class="line">NGCMXï¼šæ–°ç”Ÿä»£æœ€å¤§å®¹é‡</span><br><span class="line"></span><br><span class="line">NGCï¼šå½“å‰æ–°ç”Ÿä»£å®¹é‡</span><br><span class="line"></span><br><span class="line">S0Cï¼šç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">S1Cï¼šç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">ECï¼šä¼Šç”¸å›­åŒºçš„å¤§å°</span><br><span class="line"></span><br><span class="line">OGCMNï¼šè€å¹´ä»£æœ€å°å®¹é‡</span><br><span class="line"></span><br><span class="line">OGCMXï¼šè€å¹´ä»£æœ€å¤§å®¹é‡</span><br><span class="line"></span><br><span class="line">OGCï¼šå½“å‰è€å¹´ä»£å¤§å°</span><br><span class="line"></span><br><span class="line">OC:å½“å‰è€å¹´ä»£å¤§å°</span><br><span class="line"></span><br><span class="line">MCMN:æœ€å°å…ƒæ•°æ®å®¹é‡</span><br><span class="line"></span><br><span class="line">MCMXï¼šæœ€å¤§å…ƒæ•°æ®å®¹é‡</span><br><span class="line"></span><br><span class="line">MCï¼šå½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSMNï¼šæœ€å°å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSMXï¼šæœ€å¤§å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSCï¼šå½“å‰å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">YGCï¼šå¹´è½»ä»£gcæ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCï¼šè€å¹´ä»£GCæ¬¡æ•°</span><br></pre></td></tr></table></figure></li>
<li>jstat -gcmetacapacity pid   å…ƒæ•°æ®ç©ºé—´ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jstat -gcmetacapacity 1808</span><br><span class="line">   MCMN       MCMX        MC       CCSMN      CCSMX       CCSC     YGC   FGC    FGCT     GCT</span><br><span class="line">       0.0  1103872.0    60416.0        0.0  1048576.0     6912.0 32144     5    0.469   93.478</span><br><span class="line">MCMN:æœ€å°å…ƒæ•°æ®å®¹é‡</span><br><span class="line"></span><br><span class="line">MCMXï¼šæœ€å¤§å…ƒæ•°æ®å®¹é‡</span><br><span class="line"></span><br><span class="line">MCï¼šå½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSMNï¼šæœ€å°å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSMXï¼šæœ€å¤§å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">CCSCï¼šå½“å‰å‹ç¼©ç±»ç©ºé—´å¤§å°</span><br><span class="line"></span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line"></span><br><span class="line">GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</span><br></pre></td></tr></table></figure></li>
<li>jstat -gcnewcapacity pid æ–°ç”Ÿä»£å†…å­˜ç©ºé—´ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@jav-collection01br-p001:~# jstat -gcnewcapacity 1808</span><br><span class="line">  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC</span><br><span class="line">   40960.0   349184.0   349184.0 116224.0   1536.0 116224.0   1536.0   348160.0   346112.0 32144     5</span><br><span class="line">NGCMNï¼šæ–°ç”Ÿä»£æœ€å°å®¹é‡</span><br><span class="line"></span><br><span class="line">NGCMXï¼šæ–°ç”Ÿä»£æœ€å¤§å®¹é‡</span><br><span class="line"></span><br><span class="line">NGCï¼šå½“å‰æ–°ç”Ÿä»£å®¹é‡</span><br><span class="line"></span><br><span class="line">S0CMXï¼šæœ€å¤§å¹¸å­˜1åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">S0Cï¼šå½“å‰å¹¸å­˜1åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">S1CMXï¼šæœ€å¤§å¹¸å­˜2åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">S1Cï¼šå½“å‰å¹¸å­˜2åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">ECMXï¼šæœ€å¤§ä¼Šç”¸å›­åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">ECï¼šå½“å‰ä¼Šç”¸å›­åŒºå¤§å°</span><br><span class="line"></span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCï¼šè€å¹´ä»£å›æ”¶æ¬¡æ•°</span><br></pre></td></tr></table></figure></li>
<li>jstat -gcoldcapacity pid è€å¹´ä»£å†…å­˜ç©ºé—´ç»Ÿè®¡<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ¯éš”2ç§’é‡‡é›†ä¸€æ¬¡æ•°æ®</span><br><span class="line">root@jav-collection01br-p001:~# jstat -gcoldcapacity 1808 2000</span><br><span class="line">   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT</span><br><span class="line">    81920.0    699392.0    233472.0    233472.0 32144     5    0.469   93.478</span><br><span class="line">OGCMNï¼šè€å¹´ä»£æœ€å°å®¹é‡</span><br><span class="line"></span><br><span class="line">OGCMXï¼šè€å¹´ä»£æœ€å¤§å®¹é‡</span><br><span class="line"></span><br><span class="line">OGCï¼šå½“å‰è€å¹´ä»£å¤§å°</span><br><span class="line"></span><br><span class="line">OCï¼šè€å¹´ä»£å¤§å°</span><br><span class="line"></span><br><span class="line">YGCï¼šå¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</span><br><span class="line"></span><br><span class="line">FGCTï¼šè€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´</span><br><span class="line"></span><br><span class="line">GCTï¼šåƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h2><p><a href="https://www.cnblogs.com/ityouknow/p/5714703.html" target="_blank" rel="noopener">jvmç³»åˆ—(å››):jvmè°ƒä¼˜-å‘½ä»¤å¤§å…¨ï¼ˆjps jstat jmap jhat jstack jinfoï¼‰ - çº¯æ´çš„å¾®ç¬‘ - åšå®¢å›­</a><br><a href="https://blog.csdn.net/u010758410/article/details/80315927" target="_blank" rel="noopener">JVM å †å†…å­˜è®¾ç½®åŸç† - æœ¨å­æœ¨æ³—çš„åšå®¢ - CSDNåšå®¢</a><br><a href="https://www.jianshu.com/p/ff46acfad03f" target="_blank" rel="noopener">jvmå †å†…å­˜è®¾ç½®è®²è§£ - ç®€ä¹¦</a><br><a href="https://www.jianshu.com/p/845924a1b8f2" target="_blank" rel="noopener">jstatå‘½ä»¤æ€»ç»“ - ç®€ä¹¦</a><br><a href="https://www.jianshu.com/p/a09e08065720" target="_blank" rel="noopener">é˜¿é‡Œå‘˜å·¥éƒ½æ˜¯è¿™æ ·æ’æŸ¥Javaé—®é¢˜çš„ï¼Œé™„å·¥å…·å• - ç®€ä¹¦</a></p>
]]></content>
      <categories>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Lsof VS netstat</title>
    <url>/2020/04/20/Lsof-VS-netstat/</url>
    <content><![CDATA[<h2 id="Lsof-VS-netstat"><a href="#Lsof-VS-netstat" class="headerlink" title="Lsof VS netstat"></a>Lsof VS netstat</h2><p>ä¼—æ‰€å‘¨çŸ¥æ°´æœç³»ç»Ÿå†…æ ¸æ˜¯æœ‰ BSD è¡€ç»Ÿçš„ Darwinï¼ŒOS X è‡ªå¸¦çš„å¾ˆå¤š CLI å·¥å…·ä¹Ÿæ˜¯ BSD style çš„ï¼Œæœ‰ä¸€éƒ¨åˆ†ä½¿ç”¨èµ·æ¥å’Œ Linux æ— å¼‚ï¼Œæœ‰ä¸€éƒ¨åˆ†å¯ä»¥é€šè¿‡ brew å®‰è£… GNU ç‰ˆæœ¬ï¼ˆå¦‚ tarï¼‰ï¼Œä½†æ˜¯ OS X çš„ netstat ä¸èƒ½æŸ¥çœ‹ä½¿ç”¨ç«¯å£çš„ç¨‹åºåè®©æˆ‘ä¸€ç›´å¾ˆä¸çˆ½ï¼Œè€Œä¸”ä¹Ÿæ²¡æ‰¾åˆ° GNU ç‰ˆæœ¬ï¼Œäºæ˜¯å»æœäº†ä¸€ä¸‹è§£å†³åŠæ³•ï¼Œstackoverflow ä¸Šçš„ç»“è®ºåŸºæœ¬éƒ½æ˜¯å»ºè®®ä½¿ç”¨ lsof ä»£æ›¿ netstat è¿›è¡ŒæŸ¥çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo lsof -nP -iTCP:ç«¯å£å· -sTCP:LISTEN</span><br></pre></td></tr></table></figure>
<ul>
<li>-n è¡¨ç¤ºä¸æ˜¾ç¤ºä¸»æœºå</li>
<li>-P è¡¨ç¤ºä¸æ˜¾ç¤ºç«¯å£ä¿—ç§°</li>
<li>ä¸åŠ  sudo åªèƒ½æŸ¥çœ‹ä»¥å½“å‰ç”¨æˆ·è¿è¡Œçš„ç¨‹åº</li>
</ul>
<p>å¦å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ç®¡é“æ¥è¿‡æ»¤æƒ³è¦çš„ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo lsof -nP -iTCP -sTCP:LISTEN | grep python</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬æ•ˆæœå¦‚ä¸‹ï¼š<br>æŸ¥çœ‹å½“å‰æ‰€æœ‰ç›‘å¬çš„ç«¯å£ä»¥åŠå¯¹åº”çš„Commandå’ŒPID</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ lsof -nP -iTCP -sTCP:LISTEN</span><br><span class="line">COMMAND    PID     USER   FD   TYPE             DEVICE SIZE&#x2F;OFF NODE NAME</span><br><span class="line">SSH\x20Pr 1553 tonydeng    8u  IPv4 0xee7327e39355d175      0t0  TCP 127.0.0.1:8087 (LISTEN)</span><br><span class="line">SSH\x20Pr 1553 tonydeng    9u  IPv6 0xee7327e38aad6e15      0t0  TCP [::1]:8087 (LISTEN)</span><br><span class="line">java      2978 tonydeng  166u  IPv6 0xee7327e38aad7e35      0t0  TCP *:62622 (LISTEN)</span><br><span class="line">node      3319 tonydeng   31u  IPv4 0xee7327e39f0f8745      0t0  TCP *:4000 (LISTEN)</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æŒ‡å®šç«¯å£å¯¹åº”çš„Commandå’ŒPID</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âœ  ~ lsof -nP -iTCP:4000 -sTCP:LISTEN</span><br><span class="line">COMMAND  PID     USER   FD   TYPE             DEVICE SIZE&#x2F;OFF NODE NAME</span><br><span class="line">node    3319 tonydeng   31u  IPv4 0xee7327e39f0f8745      0t0  TCP *:4000 (LISTEN)</span><br></pre></td></tr></table></figure>
<p>PS: è¾“å‡ºå ç”¨è¯¥ç«¯å£çš„ PID</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsof -nP -iTCP:4000 |grep LISTEN|awk &#39;&#123;print $2;&#125;&#39;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxçš„ç»å…¸shellå‘½ä»¤æ•´ç†</title>
    <url>/2020/04/20/Linux%E7%9A%84%E7%BB%8F%E5%85%B8shell%E5%91%BD%E4%BB%A4%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<h3 id="Linuxçš„ç»å…¸shellå‘½ä»¤æ•´ç†"><a href="#Linuxçš„ç»å…¸shellå‘½ä»¤æ•´ç†" class="headerlink" title="Linuxçš„ç»å…¸shellå‘½ä»¤æ•´ç†"></a>Linuxçš„ç»å…¸shellå‘½ä»¤æ•´ç†</h3><ol>
<li>åˆ é™¤0å­—èŠ‚æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find -type f -size 0 -exec rm -rf &#123;&#125; \\;</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="2">
<li>æŸ¥çœ‹è¿›ç¨‹</li>
</ol>
<p>æŒ‰å†…å­˜ä»å¤§åˆ°å°æ’åˆ—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -e -o â€œ%C : %p : %z : %aâ€|sort -k5 -nr</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>æŒ‰cpuåˆ©ç”¨ç‡ä»å¤§åˆ°å°æ’åˆ—<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -e -o â€œ%C : %p : %z : %aâ€|sort -nr</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="4">
<li>æ‰“å°è¯´cacheé‡Œçš„URL<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep -r -a jpg &#x2F;data&#x2F;cache&#x2F;* | strings | grep â€œhttp:â€ | awk -Fâ€™http:â€™ â€˜&#123;print â€œhttp:â€$2;&#125;â€™</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="5">
<li>æŸ¥çœ‹httpçš„å¹¶å‘è¯·æ±‚æ•°åŠå…¶TCPè¿æ¥çŠ¶æ€ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -n | awk â€˜&#x2F;^tcp&#x2F; &#123;++S\[$NF\]&#125; END &#123;for(a in S) print a, S\[a\]&#125;â€™</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="6">
<li>ä¿®æ”¹sshd<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i â€˜&#x2F;Root&#x2F;s&#x2F;no&#x2F;yes&#x2F;â€™ &#x2F;etc&#x2F;ssh&#x2F;sshd_config sedåœ¨è¿™ä¸ªæ–‡é‡ŒRootçš„ä¸€è¡Œï¼ŒåŒ¹é…Rootä¸€è¡Œï¼Œå°†noæ›¿æ¢æˆyes.</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="7">
<li>å¦‚ä½•æ€æ‰mysqlè¿›ç¨‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps aux|grep mysql|grep -v grep|awk â€˜&#123;print $2&#125;â€™|xargs kill -9</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>(ä»ä¸­äº†è§£åˆ°awkçš„ç”¨é€”)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pgrep mysql |xargs kill -9</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">killall -TERM mysqld</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kill -9 \&#96;cat &#x2F;usr&#x2F;local&#x2F;apache2&#x2F;logs&#x2F;httpd.pid\&#96;</span><br></pre></td></tr></table></figure>

<p>è¯•è¯•æŸ¥æ€è¿›ç¨‹PID</p>
<ol start="8">
<li>æ˜¾ç¤ºè¿è¡Œ3çº§åˆ«å¼€å¯çš„æœåŠ¡:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls &#x2F;etc&#x2F;rc3.d&#x2F;S* |cut -c 15-</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>(ä»ä¸­äº†è§£åˆ°cutçš„ç”¨é€”ï¼Œæˆªå–æ•°æ®)</p>
<ol start="9">
<li><p>å¦‚ä½•åœ¨ç¼–å†™SHELLæ˜¾ç¤ºå¤šä¸ªä¿¡æ¯ï¼Œç”¨EOF</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF +--------------------------------------------------------------+ | &#x3D;&#x3D;&#x3D; Welcome to Tunoff services &#x3D;&#x3D;&#x3D; | +--------------------------------------------------------------+ EOF</span><br></pre></td></tr></table></figure>
</li>
<li><p>for çš„å·§ç”¨(å¦‚ç»™mysqlå»ºè½¯é“¾æ¥)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin for i in * do ln &#x2F;usr&#x2F;local&#x2F;mysql&#x2F;bin&#x2F;$i &#x2F;usr&#x2F;bin&#x2F;$i done</span><br></pre></td></tr></table></figure>
</li>
<li><p>å–IPåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifconfig eth0|sed -n &#39;2p&#39;|awk &#39;&#123;print $2&#125;&#39;|cut -c 6-30 æˆ–è€…: ifconfig eth0 |grep &quot;inet addr:&quot; |awk &#39;&#123;print $2&#125;&#39;|cut -c 6- æˆ–è€… ifconfig | grep &#39;inet addr:&#39;| grep -v &#39;127.0.0.1&#39; | cut -d: -f2 | awk &#39;&#123; print $1&#125;&#39; æˆ–è€…ï¼š ifconfig eth0 | sed -n &#39;&#x2F;inet &#x2F;&#123;s&#x2F;.\*addr:&#x2F;&#x2F;;s&#x2F; .\*&#x2F;&#x2F;;p&#125;&#39;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Perlå®ç°è·å–IPçš„æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ifconfig -a | perl -ne &#39;if ( m&#x2F;^\\s\*inet (?:addr:)?(\[\\d.\]+).\*?cast&#x2F; ) &#123; print qq($1\\n); exit 0; &#125;&#39;</span><br></pre></td></tr></table></figure>

<ol start="12">
<li><p>å†…å­˜çš„å¤§å°: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">free -m |grep &quot;Mem&quot; | awk &#39;&#123;print $2&#125;&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>è·å–nginxçš„è¿æ¥IP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -an -t | grep &quot;:80&quot; | grep ESTABLISHED | awk &#39;&#123;printf &quot;%s %s\\n&quot;,$5,$6&#125;&#39; | sort</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹Apacheçš„å¹¶å‘è¯·æ±‚æ•°åŠå…¶TCPè¿æ¥çŠ¶æ€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -n | awk &#39;&#x2F;^tcp&#x2F; &#123;++S\[$NF\]&#125; END &#123;for(a in S) print a, S\[a\]&#125;&#39;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å› ä¸ºåŒäº‹è¦ç»Ÿè®¡ä¸€ä¸‹æœåŠ¡å™¨ä¸‹é¢æ‰€æœ‰çš„jpgçš„æ–‡ä»¶çš„å¤§å°,å†™äº†ä¸ªshellç»™ä»–æ¥ç»Ÿè®¡.åŸæ¥ç”¨xargså®ç°,ä½†ä»–ä¸€æ¬¡å¤„ç†ä¸€éƒ¨åˆ†,æçš„æœ‰å¤šä¸ªæ€»å’Œâ€¦.,ä¸‹é¢çš„å‘½ä»¤å°±èƒ½è§£å†³å•¦.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F; -name *.jpg -exec wc -c &#123;&#125; \\;|awk &#39;&#123;print $1&#125;&#39;|awk &#39;&#123;a+&#x3D;$1&#125;END&#123;print a&#125;&#39;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>CPUçš„æ•°é‡ï¼ˆå¤šæ ¸ç®—å¤šä¸ªCPUï¼Œ cat /proc/cpuinfo |grep -c processor ï¼‰è¶Šå¤šï¼Œç³»ç»Ÿè´Ÿè½½è¶Šä½ï¼Œæ¯ç§’èƒ½å¤„ç†çš„è¯·æ±‚æ•°ä¹Ÿè¶Šå¤šã€‚</p>
<p>--------------------------------------------------------------------------------------------------------------------</p>
<ol start="16">
<li><p>CPUè´Ÿè½½ # cat /proc/loadavg æ£€æŸ¥å‰ä¸‰ä¸ªè¾“å‡ºå€¼æ˜¯å¦è¶…è¿‡äº†ç³»ç»Ÿé€»è¾‘CPUçš„4å€ã€‚</p>
</li>
<li><p>CPUè´Ÿè½½ # mpstat 1 1 æ£€æŸ¥%idleæ˜¯å¦è¿‡ä½(æ¯”å¦‚å°äº5%)</p>
</li>
<li><p>å†…å­˜ç©ºé—´ # free æ£€æŸ¥freeå€¼æ˜¯å¦è¿‡ä½ ä¹Ÿå¯ä»¥ç”¨ # cat /proc/meminfo</p>
</li>
<li><p>swapç©ºé—´ # free æ£€æŸ¥swap usedå€¼æ˜¯å¦è¿‡é«˜ å¦‚æœswap usedå€¼è¿‡é«˜ï¼Œè¿›ä¸€æ­¥æ£€æŸ¥swapåŠ¨ä½œæ˜¯å¦é¢‘ç¹ï¼š # vmstat 1 5 è§‚å¯Ÿsiå’Œsoå€¼æ˜¯å¦è¾ƒå¤§</p>
</li>
<li><p>ç£ç›˜ç©ºé—´ # df -h æ£€æŸ¥æ˜¯å¦æœ‰åˆ†åŒºä½¿ç”¨ç‡(Use%)è¿‡é«˜(æ¯”å¦‚è¶…è¿‡90%) å¦‚å‘ç°æŸä¸ªåˆ†åŒºç©ºé—´æ¥è¿‘ç”¨å°½ï¼Œå¯ä»¥è¿›å…¥è¯¥åˆ†åŒºçš„æŒ‚è½½ç‚¹ï¼Œç”¨ä»¥ä¸‹å‘½ä»¤æ‰¾å‡ºå ç”¨ç©ºé—´æœ€å¤šçš„æ–‡ä»¶æˆ–ç›®å½•ï¼š # du -cks * | sort -rn | head -n 10</p>
</li>
<li><p>ç£ç›˜I/Oè´Ÿè½½ # iostat -x 1 2 æ£€æŸ¥I/Oä½¿ç”¨ç‡(%util)æ˜¯å¦è¶…è¿‡100%</p>
</li>
<li><p>ç½‘ç»œè´Ÿè½½ # sar -n DEV æ£€æŸ¥ç½‘ç»œæµé‡(rxbyt/s, txbyt/s)æ˜¯å¦è¿‡é«˜</p>
</li>
<li><p>ç½‘ç»œé”™è¯¯ # netstat -i æ£€æŸ¥æ˜¯å¦æœ‰ç½‘ç»œé”™è¯¯(drop fifo colls carrier) ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤ï¼š# cat /proc/net/dev</p>
</li>
<li><p>ç½‘ç»œè¿æ¥æ•°ç›® # netstat -an | grep -E â€œ^(tcp)â€ | cut -c 68- | sort | uniq -c | sort -n</p>
</li>
<li><p>è¿›ç¨‹æ€»æ•° # ps aux | wc -l æ£€æŸ¥è¿›ç¨‹ä¸ªæ•°æ˜¯å¦æ­£å¸¸ (æ¯”å¦‚è¶…è¿‡250)</p>
</li>
<li><p>å¯è¿è¡Œè¿›ç¨‹æ•°ç›® # vmwtat 1 5 åˆ—ç»™å‡ºçš„æ˜¯å¯è¿è¡Œè¿›ç¨‹çš„æ•°ç›®ï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¶…è¿‡ç³»ç»Ÿé€»è¾‘CPUçš„4å€</p>
</li>
<li><p>è¿›ç¨‹ # top -id 1 è§‚å¯Ÿæ˜¯å¦æœ‰å¼‚å¸¸è¿›ç¨‹å‡ºç°</p>
</li>
<li><p>ç½‘ç»œçŠ¶æ€ æ£€æŸ¥DNS, ç½‘å…³ç­‰æ˜¯å¦å¯ä»¥æ­£å¸¸è¿é€š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping traceroute nslookup dig</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç”¨æˆ· # who | wc -l æ£€æŸ¥ç™»å½•ç”¨æˆ·æ˜¯å¦è¿‡å¤š (æ¯”å¦‚è¶…è¿‡50ä¸ª) ä¹Ÿå¯ä»¥ç”¨å‘½ä»¤ï¼š# uptime</p>
</li>
<li><p>ç³»ç»Ÿæ—¥å¿— # cat /var/log/rflogview/*errors</p>
</li>
</ol>
<p>æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é”™è¯¯è®°å½• ä¹Ÿå¯ä»¥æœå¯»ä¸€äº›å¼‚å¸¸å…³é”®å­—ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># grep -i error &#x2F;var&#x2F;log&#x2F;messages</span><br><span class="line"># grep -i fail &#x2F;var&#x2F;log&#x2F;messages</span><br><span class="line"># egrep -i &#39;error|warn&#39; &#x2F;var&#x2F;log&#x2F;messages æŸ¥çœ‹ç³»ç»Ÿå¼‚å¸¸ 32 æ ¸å¿ƒæ—¥å¿—</span><br></pre></td></tr></table></figure>
<h1 id="dmesg-æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é”™è¯¯è®°å½•"><a href="#dmesg-æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é”™è¯¯è®°å½•" class="headerlink" title="dmesg æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é”™è¯¯è®°å½•"></a>dmesg æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸é”™è¯¯è®°å½•</h1><ol start="33">
<li>ç³»ç»Ÿæ—¶é—´ # date æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®</li>
</ol>
<p>å½“å‰æ—¶é—´:  <code>date +&quot;%Y-%m-%d %H:%M:%S&quot;</code></p>
<ol start="34">
<li><p>æ‰“å¼€æ–‡ä»¶æ•°ç›® # lsof | wc -l æ£€æŸ¥æ‰“å¼€æ–‡ä»¶æ€»æ•°æ˜¯å¦è¿‡å¤š</p>
</li>
<li><p>æ—¥å¿— # logwatch ?print é…ç½®/etc/log.d/logwatch.confï¼Œå°† Mailto è®¾ç½®ä¸ºè‡ªå·±çš„email åœ°å€ï¼Œå¯åŠ¨mailæœåŠ¡ (sendmailæˆ–è€…postfix)ï¼Œè¿™æ ·å°±å¯ä»¥æ¯å¤©æ”¶åˆ°æ—¥å¿—æŠ¥å‘Šäº†ã€‚</p>
</li>
</ol>
<p>ç¼ºçœlogwatchåªæŠ¥å‘Šæ˜¨å¤©çš„æ—¥å¿—ï¼Œå¯ä»¥ç”¨# logwatch ?print ?range all è·å¾—æ‰€æœ‰çš„æ—¥å¿—åˆ†æç»“æœã€‚</p>
<p>å¯ä»¥ç”¨# logwatch ?print ?detail high è·å¾—æ›´å…·ä½“çš„æ—¥å¿—åˆ†æç»“æœ(è€Œä¸ä»…ä»…æ˜¯å‡ºé”™æ—¥å¿—)ã€‚</p>
<ol start="36">
<li><p>æ€æ‰80ç«¯å£ç›¸å…³çš„è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">lsof -i :80|grep -v &quot;PID&quot;|awk &#39;&#123;print &quot;kill -9&quot;,$2&#125;&#39;|sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¸…é™¤åƒµæ­»è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -eal | awk &#39;&#123; if ($2 &#x3D;&#x3D; &quot;Z&quot;) &#123;print $4&#125;&#125;&#39; | kill -9</span><br></pre></td></tr></table></figure>
</li>
<li><p>tcpdump æŠ“åŒ… ï¼Œç”¨æ¥é˜²æ­¢80ç«¯å£è¢«äººæ”»å‡»æ—¶å¯ä»¥åˆ†ææ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># tcpdump -c 10000 -i eth0 -n dst port 80 &gt; &#x2F;root&#x2F;pkts</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç„¶åæ£€æŸ¥IPçš„é‡å¤æ•° å¹¶ä»å°åˆ°å¤§æ’åº æ³¨æ„ â€œ-t\ +0â€³ ä¸­é—´æ˜¯ä¸¤ä¸ªç©ºæ ¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># less pkts | awk &#123;&#39;printf $3&quot;\\n&quot;&#39;&#125; | cut -d. -f 1-4 | sort | uniq -c | awk &#123;&#39;printf $1&quot; &quot;$2&quot;\\n&quot;&#39;&#125; | sort -n -t\ +0</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æœ‰å¤šå°‘ä¸ªæ´»åŠ¨çš„php-cgiè¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -anp | grep php-cgi | grep ^tcp | wc -l</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ©ç”¨iptableså¯¹åº”ç®€å•æ”»å‡»</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -an | grep -v LISTEN | awk â€˜&#123;print $5&#125;â€™ |grep -v 127.0.0.1|grep -v æœ¬æœºip|sed â€œs&#x2F;::ffff:&#x2F;&#x2F;gâ€|awk â€˜BEGIN &#123; FS&#x3D;â€:â€ &#125; &#123; Num\[$1\]++ &#125; END &#123; for(i in Num) if(Num&gt;8) &#123; print i&#125; &#125;â€™ |grep â€˜\[0-9\]\\&#123;1,3\\&#125;\\.\[0-9\]\\&#123;1,3\\&#125;\\.\[0-9\]\\&#123;1,3\\&#125;\\.\[0-9\]\\&#123;1,3\\&#125;â€™| xargs -i\[\] iptables -I INPUT -s \[\] -j DROP</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>Num&gt;8éƒ¨åˆ†è®¾å®šå€¼ä¸ºé˜€å€¼ï¼Œè¿™æ¡å¥å­ä¼šè‡ªåŠ¨å°†netstat -an ä¸­æŸ¥åˆ°çš„æ¥è‡ªåŒä¸€ï¼©ï¼°çš„è¶…è¿‡ä¸€å®šé‡çš„è¿æ¥çš„åˆ—å…¥ç¦æ­¢èŒƒå›´ã€‚ åŸºä¸­æœ¬æœºipæ”¹æˆä½ çš„æœåŠ¡å™¨çš„ipåœ°å€</p>
<ol start="42">
<li><p>æ€æ ·çŸ¥é“æŸä¸ªè¿›ç¨‹åœ¨å“ªä¸ªCPUä¸Šè¿è¡Œï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ps -eo pid,args,psr</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç¡¬ä»¶åˆ¶é€ å•†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dmidecode -s system-product-name</span><br></pre></td></tr></table></figure>
</li>
<li><p>perlå¦‚ä½•ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œè¿™æ ·åœ¨å¤„ç†å¤æ‚é¡¹ç›®çš„æ—¶å€™ä¼šæ›´å¿«ä¸€ç‚¹ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">perlcc -B -o webseek webseek.pl</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»Ÿè®¡varç›®å½•ä¸‹æ–‡ä»¶ä»¥Mä¸ºå¤§å°,ä»¥åˆ—è¡¨å½¢å¼åˆ—å‡ºæ¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F;var -type f | xargs ls -s | sort -rn | awk â€˜&#123;size&#x3D;$1&#x2F;1024; printf(â€œ%dMb %s\\nâ€, size,$2);&#125;â€™ | head</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾varç›®å½•ä¸‹æ–‡ä»¶å¤§äº100Mçš„æ–‡ä»¶ï¼Œå¹¶ç»Ÿè®¡æ–‡ä»¶çš„ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find &#x2F;var -size +100M -type f | tee file_list | wc -l</span><br></pre></td></tr></table></figure>
</li>
<li><p>sed æŸ¥æ‰¾å¹¶æ›¿æ¢å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i â€œs&#x2F;varnish&#x2F;LTCache&#x2F;gâ€ \&#96;grep â€œViaâ€ -rl &#x2F;usr&#x2F;local&#x2F;src&#x2F;varnish-2.0.4\&#96;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -i â€œs&#x2F;X-Varnish&#x2F;X-LTCache&#x2F;gâ€ \&#96;grep â€œX-Varnishâ€ -rl &#x2F;usr&#x2F;local&#x2F;src&#x2F;varnish-2.0.4\&#96;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æœåŠ¡å™¨åˆ¶é€ å•†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dmidecode -s system-product-name</span><br></pre></td></tr></table></figure>
</li>
<li><p>wget æ¨¡æ‹Ÿuser-agentæŠ“å–ç½‘é¡µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -m -e robots&#x3D;off -U â€œMozilla&#x2F;5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9.1.6) Gecko&#x2F;20091201 Firefox&#x2F;3.5.6â€ http:&#x2F;&#x2F;www.example.com&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»Ÿè®¡ç›®å½•ä¸‹æ–‡ä»¶çš„å¤§å°ï¼ˆæŒ‰Mæ‰“å°æ˜¾ç¤ºï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">du $1 â€“max-depth&#x3D;1 | sort -n|awk â€˜&#123;printf â€œ%7.2fM â€”-&gt; %s\\nâ€,$1&#x2F;1024,$2&#125;â€™|sed â€˜s:&#x2F;.*&#x2F;\\(\[^&#x2F;\]\\&#123;1,\\&#125;\\)$:\\1:gâ€™</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…³äºCNDå®æ–½å‡ ä¸ªç›¸å…³çš„ç»Ÿè®¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç»Ÿè®¡ä¸€ä¸ªç›®å½•ä¸­çš„ç›®å½•ä¸ªæ•°</span><br><span class="line">ls -l | awk â€˜&#x2F;^d&#x2F;â€™ | wc -l</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>ç»Ÿè®¡ä¸€ä¸ªç›®å½•ä¸­çš„æ–‡ä»¶ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls -l | awk â€˜&#x2F;^-&#x2F;â€™ | wc -l</span><br></pre></td></tr></table></figure>

<p>ç»Ÿè®¡ä¸€ä¸ªç›®å½•ä¸­çš„å…¨éƒ¨æ–‡ä»¶æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find .&#x2F; -type f -print | wc -l</span><br></pre></td></tr></table></figure>

<p>ç»Ÿè®¡ä¸€ä¸ªç›®å½•ä¸­çš„å…¨éƒ¨å­ç›®å½•æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find .&#x2F; -type d -print | wc -l</span><br></pre></td></tr></table></figure>

<p>ç»Ÿè®¡æŸç±»æ–‡ä»¶çš„å¤§å°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">find .&#x2F; -name â€œ*.jpgâ€ -exec wc -c &#123;&#125; \\;|awk â€˜&#123;print $1&#125;â€™|awk â€˜&#123;a+&#x3D;$1&#125;END&#123;print a&#125;â€™</span><br></pre></td></tr></table></figure>

<ol start="51">
<li><p>æŸ¥æ‰¾å ç”¨ç£ç›˜IOæœ€å¤šçš„è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget -c http:&#x2F;&#x2F;linux.web.psi.ch&#x2F;dist&#x2F;scientific&#x2F;5&#x2F;gfa&#x2F;all&#x2F;dstat-0.6.7-1.rf.noarch.rpm</span><br><span class="line"></span><br><span class="line">dstat -M topio -d -M topbio</span><br></pre></td></tr></table></figure>
</li>
<li><p>å»æ‰ç¬¬ä¸€åˆ—ï¼ˆå¦‚è¡Œå·ä»£ç ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">awk â€˜&#123;for(i&#x3D;2;i&lt;&#x3D;NF;i++) if(i!&#x3D;NF)&#123;printf $i&quot; &quot;&#125;else&#123;print $i&#125; &#125;&#39; list</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¾“å‡º256ä¸­è‰²å½©</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i in &#123;0..255&#125;; do echo -e &quot;\\e\[38;05;$&#123;i&#125;m$&#123;i&#125;&quot;; done | column -c 80 -s &#39; &#39;; echo -e &quot;\\e\[m&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æœºå™¨æ”¯æŒå†…å­˜ æœºå™¨æ’å†…å­˜æƒ…å†µï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dmidecode |grep -P &quot;Maximum\\s+Capacity&quot;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>æœºå™¨æœ€å¤§æ”¯æŒå†…å­˜ï¼š </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">dmidecode |grep -P &quot;Maximum\\s+Capacity&quot;</span><br></pre></td></tr></table></figure>

<ol start="55">
<li><p>æŸ¥çœ‹PHP-CGIå ç”¨çš„å†…å­˜æ€»æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">total&#x3D;0; for i in \&#96;ps -C php-cgi -o rss&#x3D;\&#96;; do total&#x3D;$(($total+$i)); done; echo &quot;PHP-CGI Memory usage: $total kb&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ä¸»æ¿å‹å·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># dmidecode |grep -A 8 &quot;System Information&quot;System Information</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹cpuå‹å·ï¼Œä¸»é¢‘</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;proc&#x2F;cpuinfo | grep name | cut -f2 -d: | uniq -c</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹å†…å­˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># free -m</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹å†…å­˜æ¡æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~\]# dmidecode -t memory|grep Size</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç¡¬ç›˜å¤§å°ï¼Œåˆ†åŒº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~\]# df -hFilesystem Size Used Avail Use% Mounted on&#x2F;dev&#x2F;sda3 119G 17G 96G 15% &#x2F;</span><br><span class="line">[root@localhost ~\]# dmesg |grep -i raid</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹ç½‘å¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~\]# lspci | grep -i &#39;eth&#39;05:00.0 Ethernet controller: Intel Corporation 82576 Gigabit Network Connection (rev 01)05:00.1 Ethernet controller: Intel Corporation 82576 Gigabit Network Connection (rev 01)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹2å·ç½‘ç»œæµé‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sar -n DEV -f &#x2F;var&#x2F;log&#x2F;sa&#x2F;sa2 |grep eth|less</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æ¿è½½æ˜¾ç¤ºä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@localhost ~\]# dmidecode |grep -A 5 &quot;On Board Device Information&quot;On Board Device</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>ä½œè€…ï¼šNetSeek æ¥æºï¼š<a href="http://bbs.linuxtone.org/thread-16-1-1.html" target="_blank" rel="noopener">http://bbs.linuxtone.org/thread-16-1-1.html</a></p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxè¿ç»´é«˜æ‰‹å¿…å¤‡çš„10ä¸ªç³»ç»Ÿå‘½ä»¤</title>
    <url>/2020/04/20/Linux%E8%BF%90%E7%BB%B4%E9%AB%98%E6%89%8B%E5%BF%85%E5%A4%87%E7%9A%8410%E4%B8%AA%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="Linuxè¿ç»´é«˜æ‰‹å¿…å¤‡çš„10ä¸ªç³»ç»Ÿå‘½ä»¤"><a href="#Linuxè¿ç»´é«˜æ‰‹å¿…å¤‡çš„10ä¸ªç³»ç»Ÿå‘½ä»¤" class="headerlink" title="Linuxè¿ç»´é«˜æ‰‹å¿…å¤‡çš„10ä¸ªç³»ç»Ÿå‘½ä»¤"></a>Linuxè¿ç»´é«˜æ‰‹å¿…å¤‡çš„10ä¸ªç³»ç»Ÿå‘½ä»¤</h2><h3 id="ä¸‹é¢å¯èƒ½æ˜¯ä½ ä¸æ›¾ç”¨è¿‡çš„åä¸ªLinuxçš„å‘½ä»¤ã€‚ç›¸å½“çš„æœ‰ç”¨"><a href="#ä¸‹é¢å¯èƒ½æ˜¯ä½ ä¸æ›¾ç”¨è¿‡çš„åä¸ªLinuxçš„å‘½ä»¤ã€‚ç›¸å½“çš„æœ‰ç”¨" class="headerlink" title="ä¸‹é¢å¯èƒ½æ˜¯ä½ ä¸æ›¾ç”¨è¿‡çš„åä¸ªLinuxçš„å‘½ä»¤ã€‚ç›¸å½“çš„æœ‰ç”¨"></a>ä¸‹é¢å¯èƒ½æ˜¯ä½ ä¸æ›¾ç”¨è¿‡çš„åä¸ªLinuxçš„å‘½ä»¤ã€‚ç›¸å½“çš„æœ‰ç”¨</h3><ol>
<li>pgrep<br>pgrepåå­—å‰æœ‰ä¸ªpï¼Œæˆ‘ä»¬å¯ä»¥çŒœåˆ°è¿™å’Œè¿›ç¨‹ç›¸å…³ï¼Œåˆæ˜¯grepï¼Œå½“ç„¶è¿™æ˜¯è¿›ç¨‹ç›¸å…³çš„grepå‘½ä»¤ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªå‘½ä»¤ä¸»è¦æ˜¯ç”¨æ¥åˆ—ä¸¾è¿›ç¨‹IDçš„ã€‚å¦‚ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ pgrep -u hchen</span><br><span class="line">22441</span><br><span class="line">22444</span><br></pre></td></tr></table></figure>
è¿™ä¸ªå‘½ä»¤ç›¸å½“äºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ps -ef | egrep &#39;^hchen&#39; | awk &#39;&#123;print $2&#125;&#39;</span><br></pre></td></tr></table></figure></li>
<li>pstree<br>è¿™ä¸ªå‘½ä»¤å¯ä»¥ä»¥æ ‘å½¢çš„æ–¹å¼åˆ—å‡ºè¿›ç¨‹ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]$ pstree</span><br><span class="line">init-+-acpid</span><br><span class="line">     |-auditd-+-python</span><br><span class="line">     |        &#96;-&#123;auditd&#125;</span><br><span class="line">     |-automount---4*[&#123;automount&#125;]</span><br><span class="line">     |-backup.sh---sleep</span><br><span class="line">     |-dbus-daemon</span><br><span class="line">     |-events&#x2F;0</span><br><span class="line">     |-events&#x2F;1</span><br><span class="line">     |-hald---hald-runner---hald-addon-acpi</span><br><span class="line">     |-httpd---10*[httpd]</span><br><span class="line">     |-irqbalance</span><br><span class="line">     |-khelper</span><br><span class="line">     |-klogd</span><br><span class="line">     |-ksoftirqd&#x2F;0</span><br><span class="line">     |-ksoftirqd&#x2F;1</span><br><span class="line">     |-kthread-+-aio&#x2F;0</span><br><span class="line">     |         |-aio&#x2F;1</span><br><span class="line">     |         |-ata&#x2F;0</span><br><span class="line">     |         |-ata&#x2F;1</span><br><span class="line">     |         |-ata_aux</span><br><span class="line">     |         |-cqueue&#x2F;0</span><br><span class="line">     |         |-cqueue&#x2F;1</span><br><span class="line">     |         |-kacpid</span><br><span class="line">     |         |-kauditd</span><br><span class="line">     |         |-kblockd&#x2F;0</span><br><span class="line">     |         |-kblockd&#x2F;1</span><br><span class="line">     |         |-kedac</span><br><span class="line">     |         |-khubd</span><br><span class="line">     |         |-6*[kjournald]</span><br><span class="line">     |         |-kmirrord</span><br><span class="line">     |         |-kpsmoused</span><br><span class="line">     |         |-kseriod</span><br><span class="line">     |         |-kswapd0</span><br><span class="line">     |         |-2*[pdflush]</span><br><span class="line">     |         |-scsi_eh_0</span><br><span class="line">     |         |-scsi_eh_1</span><br><span class="line">     |         |-xenbus</span><br><span class="line">     |         &#96;-xenwatch</span><br><span class="line">     |-migration&#x2F;0</span><br><span class="line">     |-migration&#x2F;1</span><br><span class="line">     |-6*[mingetty]</span><br><span class="line">     |-3*[multilog]</span><br><span class="line">     |-mysqld_safe---mysqld---9*[&#123;mysqld&#125;]</span><br><span class="line">     |-smartd</span><br><span class="line">     |-sshd---sshd---sshd---bash---pstree</span><br><span class="line">     |-svscanboot---svscan-+-3*[supervise---run]</span><br><span class="line">     |                     |-supervise---qmail-send-+-qmail-clean</span><br><span class="line">     |                     |                        |-qmail-lspawn</span><br><span class="line">     |                     |                        &#96;-qmail-rspawn</span><br><span class="line">     |                     &#96;-2*[supervise---tcpserver]</span><br><span class="line">     |-syslogd</span><br><span class="line">     |-udevd</span><br><span class="line">     |-watchdog&#x2F;0</span><br><span class="line">     |-watchdog&#x2F;1</span><br><span class="line">     &#96;-xinetd</span><br></pre></td></tr></table></figure></li>
<li>bc<br>è¿™ä¸ªå‘½ä»¤ä¸»è¦æ˜¯åšä¸€ä¸ªç²¾åº¦æ¯”è¾ƒé«˜çš„æ•°å­¦è¿ç®—çš„ã€‚æ¯”å¦‚å¼€å¹³æ–¹æ ¹ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæˆ‘ä»¬åˆ©ç”¨bcå‘½ä»¤å†™çš„ä¸€ä¸ªè„šæœ¬ï¼ˆæ–‡ä»¶åï¼šsqrtï¼‰<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">if [ $</span><br><span class="line">then</span><br><span class="line">    echo &#39;Usage: sqrt number&#39;</span><br><span class="line">    exit 1</span><br><span class="line">else</span><br><span class="line">    echo -e &quot;sqrt($1)\nquit\n&quot; | bc -q -i</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨è¿™ä¸ªè„šæœ¬è¿›è¡Œå¹³æ–¹æ ¹è¿ç®—ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5]$ .&#x2F;sqrt 36</span><br><span class="line">6</span><br><span class="line">[hchen@RHELSVR5]$ .&#x2F;sqrt 2.0000</span><br><span class="line">1.4142</span><br><span class="line">[hchen@RHELSVR5]$ .&#x2F;sqrt 10.0000</span><br><span class="line">3.1622</span><br></pre></td></tr></table></figure></li>
<li>split<br>å¦‚æœä½ æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œä½ æƒ³æŠŠå…¶åˆ†å‰²æˆä¸€äº›å°çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤å°±æ˜¯å¹²è¿™ä»¶äº‹çš„äº†ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hchen@RHELSVR5 applebak]# ls -l largefile.tar.gz</span><br><span class="line">-rw-r--r-- 1 hchen hchen 436774774 04-17 02:00 largefile.tar.gz</span><br><span class="line"></span><br><span class="line">[hchen@RHELSVR5 applebak]# split -b 50m largefile.tar.gz LF_</span><br><span class="line"></span><br><span class="line">[hchen@RHELSVR5]# ls -l LF_*</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:34 LF_aa</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:34 LF_ab</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:34 LF_ac</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:34 LF_ad</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:34 LF_ae</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:35 LF_af</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:35 LF_ag</span><br><span class="line">-rw-r--r-- 1 hchen hchen 52428800 05-10 18:35 LF_ah</span><br><span class="line">-rw-r--r-- 1 hchen hchen 17344374 05-10 18:35 LF_ai</span><br></pre></td></tr></table></figure>
æ–‡ä»¶åˆå¹¶åªéœ€è¦ä½¿ç”¨ç®€å•çš„åˆå¹¶å°±è¡Œäº†ï¼Œå¦‚:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5]#  cat LF_* &gt;largefile.tar.gz</span><br></pre></td></tr></table></figure></li>
<li>nl<br>nlå‘½ä»¤å…¶å®ƒå’Œcatå‘½ä»¤å¾ˆåƒï¼Œåªä¸è¿‡å®ƒä¼šæ‰“ä¸Šè¡Œå·ã€‚å¦‚ä¸‹æ‰€ç¤º:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 include]# nl stdio.h | head -n 10</span><br><span class="line">     1  &#x2F;* Define ISO C stdio on top of C++ iostreams.</span><br><span class="line">     2     Copyright (C) 1991,1994-2004,2005,2006 Free Software Foundation, Inc.</span><br><span class="line">     3     This file is part of the GNU C Library.</span><br><span class="line"></span><br><span class="line">     4     The GNU C Library is free software; you can redistribute it and&#x2F;or</span><br><span class="line">     5     modify it under the terms of the GNU Lesser General Public</span><br><span class="line">     6     License as published by the Free Software Foundation; either</span><br><span class="line">     7     version 2.1 of the License, or (at your option) any later version.</span><br><span class="line"></span><br><span class="line">     8     The GNU C Library is distributed in the hope that it will be useful,</span><br></pre></td></tr></table></figure></li>
<li>mkfifo<br>ç†Ÿæ‚‰Unixçš„äººéƒ½åº”è¯¥çŸ¥é“è¿™ä¸ªæ˜¯ä¸€ä¸ªåˆ›å»ºæœ‰åç®¡é“çš„ç³»ç»Ÿè°ƒç”¨æˆ–å‘½ä»¤ã€‚å¹³æ—¶ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨ç«–çº¿â€œ|â€æŠŠå‘½ä»¤ä¸²èµ·æ¥å¯ä½¿ç”¨æ— å‘½ç®¡é“ã€‚è€Œæˆ‘ä»¬ä½¿ç”¨mkfifoåˆ™ä½¿ç”¨çš„æ˜¯æœ‰åç®¡é“ã€‚ä¸‹é¢æ˜¯ç¤ºä¾‹:<br>ä¸‹é¢æ˜¯åˆ›å»ºä¸€ä¸ªæœ‰åç®¡é“:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]# mkfifo &#x2F;tmp&#x2F;hchenpipe</span><br><span class="line"></span><br><span class="line">[hchen@RHELSVR5 ~]# ls -l &#x2F;tmp</span><br><span class="line">prw-rw-r-- 1 hchen  hchen  0 05-10 18:58 hchenpipe</span><br></pre></td></tr></table></figure>
ç„¶åï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªshellä¸­è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¸ä¼šè¿”å›ï¼Œé™¤éæœ‰äººä»è¿™ä¸ªæœ‰åç®¡é“ä¸­æŠŠä¿¡æ¯è¯»èµ°<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]# ls -al &gt; &#x2F;tmp&#x2F;hchenpipe</span><br></pre></td></tr></table></figure>
æˆ‘ä»¬åœ¨å¦ä¸€ä¸ªå‘½ä»¤çª—å£ä¸­è¯»å–è¿™ä¸ªç®¡é“ä¸­çš„ä¿¡æ¯ï¼šï¼ˆå…¶ä¼šå¯¼è‡´ä¸Šä¸€ä¸ªå‘½ä»¤è¿”å›ï¼‰<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]# head &#x2F;tmp&#x2F;hchenpipe</span><br><span class="line">drwx------ 8 hchen hchen    4096 05-10 18:27 .</span><br><span class="line">drwxr-xr-x 7 root  root     4096 03-05 00:06 ..</span><br><span class="line">drwxr-xr-x 3 hchen hchen    4096 03-01 18:13 backup</span><br><span class="line">-rw------- 1 hchen hchen     721 05-05 22:12 .bash_history</span><br><span class="line">-rw-r--r-- 1 hchen hchen      24 02-28 22:20 .bash_logout</span><br><span class="line">-rw-r--r-- 1 hchen hchen     176 02-28 22:20 .bash_profile</span><br><span class="line">-rw-r--r-- 1 hchen hchen     124 02-28 22:20 .bashrc</span><br><span class="line">-rw-r--r-- 1 root  root    14002 03-07 00:29 index.htm</span><br><span class="line">-rw-r--r-- 1 hchen hchen   31465 03-01 23:48 index.php</span><br></pre></td></tr></table></figure></li>
<li>ldd<br>è¿™ä¸ªå‘½ä»¤å¯ä»¥çŸ¥é“ä½ çš„ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ‰€ä½¿ç”¨äº†åŠ¨æ€é“¾æ¥åº“ã€‚å¦‚:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]# ldd &#x2F;usr&#x2F;bin&#x2F;java</span><br><span class="line">        linux-gate.so.1 &#x3D;&gt;  (0x00cd9000)</span><br><span class="line">        libgij.so.7rh &#x3D;&gt; &#x2F;usr&#x2F;lib&#x2F;libgij.so.7rh (0x00ed3000)</span><br><span class="line">        libgcj.so.7rh &#x3D;&gt; &#x2F;usr&#x2F;lib&#x2F;libgcj.so.7rh (0x00ed6000)</span><br><span class="line">        libpthread.so.0 &#x3D;&gt; &#x2F;lib&#x2F;i686&#x2F;nosegneg&#x2F;libpthread.so.0 (0x00110000)</span><br><span class="line">        librt.so.1 &#x3D;&gt; &#x2F;lib&#x2F;i686&#x2F;nosegneg&#x2F;librt.so.1 (0x009c8000)</span><br><span class="line">        libdl.so.2 &#x3D;&gt; &#x2F;lib&#x2F;libdl.so.2 (0x008b5000)</span><br><span class="line">        libz.so.1 &#x3D;&gt; &#x2F;usr&#x2F;lib&#x2F;libz.so.1 (0x00bee000)</span><br><span class="line">        libgcc_s.so.1 &#x3D;&gt; &#x2F;lib&#x2F;libgcc_s.so.1 (0x00aa7000)</span><br><span class="line">        libc.so.6 &#x3D;&gt; &#x2F;lib&#x2F;i686&#x2F;nosegneg&#x2F;libc.so.6 (0x0022f000)</span><br><span class="line">        libm.so.6 &#x3D;&gt; &#x2F;lib&#x2F;i686&#x2F;nosegneg&#x2F;libm.so.6 (0x00127000)</span><br><span class="line">        &#x2F;lib&#x2F;ld-linux.so.2 (0x00214000)</span><br></pre></td></tr></table></figure></li>
<li>col<br>è¿™ä¸ªå‘½ä»¤å¯ä»¥è®©ä½ æŠŠmanæ–‡ä»¶è½¬æˆçº¯æ–‡æœ¬æ–‡ä»¶ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># # man less | col -b &gt; less.txt</span><br></pre></td></tr></table></figure></li>
<li>xmlwf<br>è¿™ä¸ªå‘½ä»¤å¯ä»¥è®©ä½ æ£€æŸ¥ä¸€ä¸‹ä¸€ä¸ªXMLæ–‡æ¡£æ˜¯å¦æ˜¯æ‰€æœ‰çš„tagéƒ½æ˜¯æ­£å¸¸çš„ã€‚å¦‚:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[hchen@RHELSVR5 ~]# curl &#39;https:&#x2F;&#x2F;coolshell.cn&#x2F;?feed&#x3D;rss2&#39; &gt; cocre.xml</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100 64882    0 64882    0     0  86455      0 --:--:-- --:--:-- --:--:-- 2073k</span><br><span class="line">[hchen@RHELSVR5 ~]# xmlwf cocre.xml</span><br><span class="line">[hchen@RHELSVR5 ~]# perl -i -pe &#39;s@&lt;link&gt;@&lt;br&gt;@g&#39; cocre.xml</span><br><span class="line">[hchen@RHELSVR5 ~]# xmlwf cocre.xml</span><br><span class="line">cocre.xml:13:23: mismatched tag</span><br></pre></td></tr></table></figure></li>
<li>lsof<br>å¯ä»¥åˆ—å‡ºæ‰“å¼€äº†çš„æ–‡ä»¶ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@RHELSVR5 ~]# lsof | grep TCP</span><br><span class="line">httpd       548    apache    4u     IPv6   14300967    TCP *:http (LISTEN)</span><br><span class="line">httpd       548    apache    6u     IPv6   14300972    TCP *:https (LISTEN)</span><br><span class="line">httpd       561    apache    4u     IPv6   14300967    TCP *:http (LISTEN)</span><br><span class="line">httpd       561    apache    6u     IPv6   14300972    TCP *:https (LISTEN)</span><br><span class="line">sshd       1764      root    3u     IPv6       4993    TCP *:ssh (LISTEN)</span><br><span class="line">tcpserver  8965      root    3u     IPv4  153795500    TCP *:pop3 (LISTEN)</span><br><span class="line">mysqld    10202     mysql   10u     IPv4   73819697    TCP *:mysql (LISTEN)</span><br><span class="line">sshd      10735      root    3u     IPv6  160731956    TCP 210.51.0.232:ssh-&gt;123.117.239.68:31810 (ESTABLISHED)</span><br><span class="line">sshd      10767     hchen    3u     IPv6  160731956    TCP 210.51.0.232:ssh-&gt;123.117.239.68:31810 (ESTABLISHED)</span><br><span class="line">vsftpd    11095      root    3u     IPv4  152157957    TCP *:ftp (LISTEN)</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Python RBAC</title>
    <url>/2020/04/20/Python-RBAC/</url>
    <content><![CDATA[<h2 id="casbin"><a href="#casbin" class="headerlink" title="casbin"></a>casbin</h2><p><a href="https://github.com/casbin/pycasbin" target="_blank" rel="noopener">https://github.com/casbin/pycasbin</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
        <category>RBAC</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
        <tag>RBAC</tag>
      </tags>
  </entry>
  <entry>
    <title>MySQLç›¸å…³é¢è¯•</title>
    <url>/2020/04/20/MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95/</url>
    <content><![CDATA[<h2 id="MySQLç›¸å…³é¢è¯•"><a href="#MySQLç›¸å…³é¢è¯•" class="headerlink" title="MySQLç›¸å…³é¢è¯•"></a>MySQLç›¸å…³é¢è¯•</h2><p>ä¸€ã€mysqléƒ¨åˆ†</p>
<p>äºŒã€djangoéƒ¨åˆ†</p>
<p>ä¸‰ã€Pythonéƒ¨åˆ†</p>
<p>å››ã€RESTful APIè®¾è®¡æŒ‡å—</p>
<p>äº”ã€git</p>
<p>å…­ã€é¡¹ç›®éƒ¨åˆ†</p>
<p>ä¸€ã€MySQL</p>
<pre><code>1ã€mysqlå¦‚ä½•åšåˆ†é¡µ

      mysqlæ•°æ®åº“åšåˆ†é¡µç”¨limitå…³é”®å­—ï¼Œå®ƒåé¢è·Ÿä¸¤ä¸ªå‚æ•°startIndexå’ŒpageSize


2ã€mysqlå¼•æ“æœ‰å“ªäº›ï¼Œå„è‡ªçš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ

     innodbå’Œmyisamä¸¤ä¸ªå¼•æ“ï¼Œä¸¤è€…åŒºåˆ«æ˜¯
 innodbæ”¯æŒäº‹ç‰©ï¼Œmyisamä¸æ”¯æŒ
 innodbæ”¯æŒå¤–é”®ï¼Œmyisamä¸æ”¯æŒ
 innodbä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œmyisamæ”¯æŒå…¨æ–‡ç´¢å¼• 
 innodbæä¾›æäº¤ã€å›æ»šã€å´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹ç‰©çš„å®‰å…¨èƒ½åŠ›ï¼Œå®ç°å¹¶å‘æ§åˆ¶
 myisamæä¾›è¾ƒé«˜çš„æ’å…¥å’ŒæŸ¥è¯¢è®°å½•çš„æ•ˆç‡ï¼Œä¸»è¦ç”¨äºæ’å…¥å’ŒæŸ¥è¯¢


3ã€æ•°æ®åº“æ€ä¹ˆå»ºç«‹ç´¢å¼•     </code></pre><p>1<br>create index account_index on <code>table name</code>(<code>å­—æ®µå</code>(length)<br>       4ã€ä¸€å¼ è¡¨å¤šä¸ªå­—æ®µï¼Œæ€ä¹ˆåˆ›å»ºç»„åˆç´¢å¼•</p>
<p>1<br>create index account_index on <code>table name</code>(<code>å­—æ®µå</code>ï¼Œâ€™å­—æ®µåâ€™)<br>       5ã€å¦‚ä½•åº”å¯¹æ•°æ®çš„é«˜å¹¶å‘ï¼Œå¤§é‡çš„æ•°æ®è®¡ç®—</p>
<pre><code>      1.åˆ›å»ºç´¢å¼•
      2.æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œä¸¤ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªä½œä¸ºå†™ï¼Œä¸€ä¸ªä½œä¸ºè¯»
      3. å¤–é”®å»æ‰
      4.djangoä¸­ormè¡¨æ€§èƒ½ç›¸å…³çš„
         select_relatedï¼šä¸€å¯¹å¤šä½¿ç”¨ï¼ŒæŸ¥è¯¢ä¸»åŠ¨åšè¿è¡¨
         prefetch_relatedï¼šå¤šå¯¹å¤šæˆ–è€…ä¸€å¯¹å¤šçš„æ—¶å€™ä½¿ç”¨ï¼Œä¸åšè¿è¡¨ï¼Œåšå¤šæ¬¡æŸ¥è¯¢

  6ã€æ•°æ®åº“å†…è¿è¡¨ã€å·¦è¿è¡¨ã€å³è¿è¡¨

        å†…è¿æ¥æ˜¯æ ¹æ®æŸä¸ªæ¡ä»¶è¿æ¥ä¸¤ä¸ªè¡¨å…±æœ‰çš„æ•°æ®
        å·¦è¿æ¥æ˜¯æ ¹æ®æŸä¸ªæ¡ä»¶ä»¥åŠå·¦è¾¹çš„è¡¨è¿æ¥æ•°æ®ï¼Œå³è¾¹çš„è¡¨æ²¡æœ‰æ•°æ®çš„è¯åˆ™ä¸ºnull
        å³è¿æ¥æ˜¯æ ¹æ®æŸä¸ªæ¡ä»¶ä»¥åŠå³è¾¹çš„è¡¨è¿æ¥æ•°æ®ï¼Œå·¦è¾¹çš„è¡¨æ²¡æœ‰æ•°æ®çš„è¯åˆ™ä¸ºnull

   7ã€è§†å›¾å’Œè¡¨çš„åŒºåˆ«

         è§†å›¾æ˜¯å·²ç»ç¼–è¯‘å¥½çš„sqlè¯­å¥ï¼Œæ˜¯åŸºäºsqlè¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–çš„è¡¨ï¼Œè€Œè¡¨ä¸æ˜¯
         è§†å›¾æ˜¯çª—å£ï¼Œè¡¨ç¤ºå†…å®¹
         è§†å›¾æ²¡æœ‰å®é™…çš„ç‰©ç†è®°å½•ï¼Œè€Œè¡¨æœ‰
         è§†å›¾çš„å»ºç«‹å’Œåˆ é™¤åªå½±å“è§†å›¾æœ¬èº«ï¼Œä¸å½±å“å¯¹åº”çš„è¡¨

   8ã€å…³ç³»å‹æ•°æ®åº“çš„ç‰¹ç‚¹

        æ•°æ®é›†ä¸­æ§åˆ¶
        æ•°æ®ç‹¬ç«‹æ€§é«˜
        æ•°æ®å…±äº«æ€§å¥½
        æ•°æ®å†—ä½™åº¦å°
        æ•°æ®ç»“æ„åŒ–
        ç»Ÿä¸€çš„æ•°æ®ä¿æŠ¤èƒ½åŠ›

   9ã€mysqlæ•°æ®åº“éƒ½æœ‰å“ªäº›ç´¢å¼•

        æ™®é€šç´¢å¼•ï¼šæ™®é€šç´¢å¼•ä»…æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼šåŠ é€ŸæŸ¥æ‰¾
        å”¯ä¸€ç´¢å¼•ï¼šå”¯ä¸€ç´¢å¼•ä¸¤ä¸ªåŠŸèƒ½ï¼šåŠ é€ŸæŸ¥æ‰¾å’Œå”¯ä¸€çº¦æŸï¼ˆå¯å«nullï¼‰
        å¤–é”®ç´¢å¼•ï¼šå¤–é”®ç´¢å¼•ä¸¤ä¸ªåŠŸèƒ½ï¼šåŠ é€ŸæŸ¥æ‰¾å’Œå”¯ä¸€çº¦æŸï¼ˆä¸å¯ä¸ºnullï¼‰
        è”åˆç´¢å¼•ï¼šè”åˆç´¢å¼•æ˜¯å°†nä¸ªåˆ—ç»„åˆæˆä¸€ä¸ªç´¢å¼•ï¼Œåº”ç”¨åœºæ™¯ï¼šåŒæ—¶ä½¿ç”¨nåˆ—æ¥è¿›è¡ŒæŸ¥è¯¢

 10ã€å­˜å‚¨è¿‡ç¨‹

         å­˜å‚¨è¿‡ç¨‹ä¸å…è®¸æ‰§è¡Œreturnè¯­å¥ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡outå‚æ•°è¿”å›å¤šä¸ªå€¼ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†æ¥æ‰§è¡Œï¼Œå­˜å‚¨è¿‡ç¨‹æ˜¯ä¸€ä¸ªé¢„ç¼–è¯‘çš„SQLè¯­å¥ã€‚

 11ã€sqlä¼˜åŒ–ï¼š

       selectå¥ä¸­é¿å…ä½¿ç”¨ &apos;*&apos;
       å‡å°‘è®¿é—®æ•°æ®åº“çš„æ¬¡æ•°
       åˆ é™¤é‡å¤è®°å½•
       ç”¨whereå­å¥æ›¿ä»£havingå­å¥
       å‡å°‘å¯¹è¡¨çš„æŸ¥è¯¢
       explain  

12ã€charå’ŒvacharåŒºåˆ«ï¼š

       charæ˜¯å›ºå®šé•¿åº¦ï¼Œå­˜å‚¨éœ€è¦ç©ºé—´12ä¸ªå­—èŠ‚ï¼Œå¤„ç†é€Ÿåº¦æ¯”vacharå¿«ï¼Œè´¹å†…å­˜ç©ºé—´
       vacharæ˜¯ä¸å›ºå®šé•¿åº¦ï¼Œéœ€è¦å­˜å‚¨ç©ºé—´13ä¸ªå­—èŠ‚ï¼ŒèŠ‚çº¦å­˜å‚¨ç©ºé—´

13ã€Mechachedä¸redis

       mechachedï¼šåªæ”¯æŒå­—ç¬¦ä¸²ï¼Œä¸èƒ½æŒä¹…åŒ–ï¼Œæ•°æ®ä»…å­˜åœ¨å†…å­˜ä¸­ï¼Œå®•æœºæˆ–é‡å¯æ•°æ®å°†å…¨éƒ¨å¤±æ•ˆ
                             ä¸èƒ½è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•ï¼Œæ–‡ä»¶æ— æ³•å¼‚æ­¥æ³•ã€‚
                             ä¼˜ç‚¹ï¼šmechachedè¿›ç¨‹è¿è¡Œä¹‹åï¼Œä¼šé¢„ç”³è¯·ä¸€å—è¾ƒå¤§çš„å†…å­˜ç©ºé—´ï¼Œè‡ªå·±è¿›è¡Œç®¡ç†ã€‚
        redisï¼šæ”¯æŒæœåŠ¡å™¨ç«¯çš„æ•°æ®ç±»å‹ï¼Œredisä¸memcachedç›¸æ¯”æ¥è¯´ï¼Œæ‹¥æœ‰æ›´å¤šçš„æ•°æ®ç»“æ„å’Œå¹¶å‘æ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®æ“ä½œï¼Œå¯æŒä¹…åŒ–ã€‚
                    äº”å¤§ç±»å‹æ•°æ®ï¼šstringã€hashã€listã€setå’Œæœ‰åºé›†åˆï¼Œredisæ˜¯å•è¿›ç¨‹å•çº¿ç¨‹çš„ã€‚
                    ç¼ºç‚¹ï¼šæ•°æ®åº“çš„å®¹é‡å—åˆ°ç‰©ç†å†…å­˜çš„é™åˆ¶ã€‚

 14ã€sqlæ³¨å…¥

          sqlæ³¨å…¥æ˜¯æ¯”è¾ƒå¸¸è§çš„æ”»å‡»æ–¹å¼ä¹‹ä¸€ï¼Œé’ˆå¯¹ç¼–ç¨‹å‘˜ç¼–ç¨‹çš„ç–å¿½ï¼Œé€šè¿‡sqlè¯­å¥ï¼Œå®ç°è´¦å·æ— æ³•ç™»é™†ï¼Œç”šè‡³ç¯¡æ”¹æ•°æ®åº“ã€‚
          é˜²æ­¢ï¼šå‡¡æ¶‰åŠåˆ°æ‰§è¡Œsqlä¸­æœ‰å˜é‡æ—¶ï¼Œåˆ‡è®°ä¸è¦ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•

15ã€ä»€ä¹ˆæ˜¯è§¦å‘å™¨ 

          è§¦å‘å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨è¿‡ç¨‹ï¼Œä¸»è¦æ˜¯é€šè¿‡äº‹ä»¶æ¥è§¦å‘è€Œè¢«æ‰§è¡Œçš„ï¼Œä»–å¯ä»¥å¼ºåŒ–çº¦æŸï¼Œæ¥ç»´æŠ¤æ•°æ®åº“çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼Œå¯ä»¥è·Ÿè¸ªæ•°æ®å†…çš„æ“ä½œä»è€Œä¸å…è®¸æœªç»è®¸å¯çš„                 æ›´æ–°å’Œå˜åŒ–ï¼Œå¯ä»¥è”çº§è¿ç®—ã€‚
          åªæœ‰è¡¨æ”¯æŒè§¦å‘å™¨ï¼Œè§†å›¾ä¸æ”¯æŒè§¦å‘å™¨

 16ã€æ¸¸æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ

          æ˜¯å¯¹æŸ¥è¯¢å‡ºæ¥çš„ç»“æœé›†ä½œä¸ºä¸€ä¸ªå•å…ƒæ¥æœ‰æ•ˆçš„å¤„ç†ï¼Œæ¸¸æ ‡å¯ä»¥å®šåœ¨è¯¥å•å…ƒä¸­çš„ç‰¹å®šè¡Œï¼Œä»ç»“æœé›†çš„å½“å‰è¡Œæ£€ç´¢ä¸€è¡Œæˆ–å¤šè¡Œï¼Œå¯ä»¥å¯¹ç»“æœé›†å½“å‰è¡Œåšä¿®æ”¹ï¼Œ
          ä¸€èˆ¬ä¸ä½¿ç”¨æ¸¸æ ‡ï¼Œä½†æ˜¯éœ€è¦é€æ¡å¤„ç†æ•°æ®çš„æ—¶å€™ï¼Œæ¸¸æ ‡æ˜¾å¾—ååˆ†é‡è¦

  17ã€ æ•°æ®åº“æ”¯æŒå¤šæœ‰æ ‡å‡†çš„SQLæ•°æ®ç±»å‹ï¼Œé‡è¦åˆ†ä¸ºä¸‰ç±»

             æ•°å€¼ç±»å‹ï¼ˆtinyintï¼Œintï¼Œbigintï¼Œæµ®ç‚¹æ•°ï¼Œbitï¼‰
             å­—ç¬¦ä¸²ç±»å‹ï¼ˆcharå’Œvacharï¼Œenumï¼Œtextï¼Œsetï¼‰
             æ—¥æœŸç±»å‹ï¼ˆdateï¼Œdatetimeï¼Œtimestampï¼‰

   18ã€mysqlæ…¢æŸ¥è¯¢

            æ…¢æŸ¥è¯¢å¯¹äºè·Ÿè¸ªæœ‰é—®é¢˜çš„æŸ¥è¯¢å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥åˆ†æå‡ºå½“å‰ç¨‹åºé‡Œå“ªäº›sqlè¯­å¥æ¯”è¾ƒè€—è´¹èµ„æº
            æ…¢æŸ¥è¯¢å®šä¹‰ï¼š
                æŒ‡mysqlè®°å½•æ‰€æœ‰æ‰§è¡Œè¶…è¿‡long_query_timeå‚æ•°è®¾å®šçš„æ—¶é—´å€¼çš„sqlè¯­å¥ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—å°±æ˜¯è®°å½•è¿™äº›sqlçš„æ—¥å¿—ã€‚
                mysqlåœ¨windowsç³»ç»Ÿä¸­çš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æ˜¯my.iniæ‰¾åˆ°mysqld
                log-slow-queries = F:\MySQL\log\mysqlslowquery.log  ä¸ºæ…¢æŸ¥è¯¢æ—¥å¿—å­˜æ”¾çš„ä½ç½®ï¼Œä¸€èˆ¬è¦æœ‰å¯å†™æƒé™
                long_query_time = 2  2è¡¨ç¤ºæŸ¥è¯¢è¶…è¿‡ä¸¤ç§’æ‰è®°å½•

    19ã€memcachedå‘½ä¸­ç‡

            å‘½ä¸­ï¼šå¯ä»¥ç›´æ¥é€šè¿‡ç¼“å­˜è·å–åˆ°éœ€è¦çš„æ•°æ®
            ä¸å‘½ä¸­ï¼šæ— æ³•ç›´æ¥é€šè¿‡ç¼“å­˜è·å–åˆ°æƒ³è¦çš„æ•°æ®ï¼Œéœ€è¦å†æ¬¡æŸ¥è¯¢æ•°æ®åº“æˆ–è€…æ‰§è¡Œå…¶ä»–çš„æ“ä½œï¼ŒåŸå› å¯èƒ½æ˜¯ç”±äºç¼“å­˜ä¸­æ ¹æœ¬ä¸å­˜åœ¨ï¼Œæˆ–è€…ç¼“å­˜å·²ç»è¿‡æœŸ
            ç¼“å­˜çš„å‘½ä¸­ç‡è¶Šé«˜åˆ™è¡¨ç¤ºä½¿ç”¨ç¼“å­˜çš„æ”¶ç›Šè¶Šé«˜ï¼Œåº”é¢ç”¨çš„æ€§èƒ½è¶Šå¥½ï¼ŒæŠ—ç—…å‘èƒ½åŠ›è¶Šå¼º
            è¿è¡Œstateå‘½ä»¤å¯ä»¥æŸ¥çœ‹memcachedæœåŠ¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œå…¶ä¸­cmdâ€”getè¡¨ç¤ºæ€»çš„getæ¬¡æ•°ï¼Œgetâ€”hitsè¡¨ç¤ºå‘½ä¸­æ¬¡æ•°ï¼Œå‘½ä¸­ç‡=getâ€”hits / cmdâ€”get

    20ã€Oracleå’ŒMySQLè¯¥å¦‚ä½•é€‰æ‹©ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

             ä»–ä»¬éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚è€ƒè™‘åˆ°æ—¶é—´å› ç´ ï¼Œæˆ‘å€¾å‘äºMySQL
             é€‰æ‹©MySQLè€Œä¸é€‰Oracleçš„åŸå› 
             MySQLå¼€æº
             MySQLè½»ä¾¿å¿«æ·
             MySQLå¯¹å‘½ä»¤è¡Œå’Œå›¾å½¢ç•Œé¢çš„æ”¯æŒéƒ½å¾ˆå¥½
             MySQLæ”¯æŒé€šè¿‡Query Browserè¿›è¡Œç®¡ç†

     21ã€ä»€ä¹ˆæƒ…å†µä¸‹é€‚åˆå»ºç«‹ç´¢å¼•ï¼Ÿ

            1.ä¸ºç»å¸¸å‡ºç°åœ¨å…³é”®å­—order byã€group byã€distinctåé¢çš„å­—æ®µï¼Œå»ºç«‹ç´¢å¼•
            2.åœ¨unionç­‰é›†åˆæ“ä½œçš„ç»“æœé›†å­—æ®µä¸Šï¼Œå»ºç«‹ç´¢å¼•ï¼Œå…¶å»ºç«‹ç´¢å¼•çš„ç›®çš„åŒä¸Š
            3.ä¸ºç»å¸¸ç”¨ä½œæŸ¥è¯¢é€‰æ‹©çš„å­—æ®µï¼Œå»ºç«‹ç´¢å¼•
            4.åœ¨ç»å¸¸ç”¨ä½œè¡¨è¿æ¥çš„å±æ€§ä¸Šï¼Œå»ºç«‹ç´¢å¼•

     22ã€æ•°æ®åº“åº•å±‚æ˜¯ç”¨ä»€ä¹ˆç»“æ„å®ç°çš„ï¼Œä½ å¤§è‡´ç”»ä¸€ä¸‹ï¼š

               åº•å±‚ç”¨B+æ•°å®ç°ï¼Œç»“æ„å›¾å‚è€ƒï¼š                                    
                http://blog.csdn.net/cjfeii/article/details/10858721
                http://blog.csdn.net/tonyxf121/article/details/8393545

      23ã€sqlè¯­å¥åº”è¯¥è€ƒè™‘å“ªäº›å®‰å…¨æ€§ï¼Ÿ

               1.é˜²æ­¢sqlæ³¨å…¥ï¼Œå¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œè¿‡æ»¤æˆ–è€…ä½¿ç”¨é¢„ç¼–è¯‘çš„sqlè¯­å¥ç»‘å®šå˜é‡
              2.æœ€å°æƒé™åŸåˆ™ï¼Œç‰¹åˆ«æ˜¯ä¸è¦ç”¨rootè´¦æˆ·ï¼Œä¸ºä¸åŒçš„ç±»å‹çš„åŠ¨ä½œæˆ–è€…ç»„å»ºä½¿ç”¨ä¸åŒçš„è´¦æˆ·
              3.å½“sqlè¿è¡Œå‡ºé”™æ—¶ï¼Œä¸è¦æŠŠæ•°æ®åº“è¿”å›çš„é”™è¯¯ä¿¡æ¯å…¨éƒ¨æ˜¾ç¤ºç»™ç”¨æˆ·ï¼Œä»¥é˜²æ­¢æ³„æ¼æœåŠ¡å™¨å’Œæ•°æ®åº“ç›¸å…³ä¿¡æ¯

      24ã€æ•°æ®åº“äº‹ç‰©æœ‰å“ªå‡ ç§ï¼Ÿ

               éš”ç¦»æ€§ã€æŒç»­æ€§ã€ä¸€è‡´æ€§ã€åŸå­æ€§

      25ã€MySQæ•°æ®è¡¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹å®¹æ˜“æŸåï¼Ÿ

                æœåŠ¡å™¨çªç„¶æ–­ç”µå¯¼è‡´æ•°æ®æ–‡ä»¶æŸå
                å¼ºåˆ¶å…³æœºï¼Œæ²¡æœ‰å…ˆå…³é—­mysqæœåŠ¡å™¨ç­‰

       26ã€dropï¼Œdeleteä¸truncateçš„åŒºåˆ«

                dropç›´æ¥åˆ é™¤è¡¨
                truncateåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå†æ’å…¥æ—¶è‡ªå¢é•¿idåˆä»1å¼€å§‹ 
                deleteåˆ é™¤è¡¨ä¸­æ•°æ®ï¼Œå¯ä»¥åŠ whereå­å¥

        27ã€æ•°æ®åº“èŒƒå¼

                  1.ç¬¬ä¸€èŒƒå¼ï¼šå°±æ˜¯æ— é‡å¤çš„åˆ—
                  2.ç¬¬äºŒèŒƒå¼ï¼šå°±æ˜¯éä¸»å±æ€§ééƒ¨åˆ†ä¾èµ–äºä¸»å…³é”®å­—
                  3.ç¬¬ä¸‰èŒƒå¼ï¼šå°±æ˜¯å±æ€§ä¸ä¾èµ–äºå…¶ä»–éä¸»å±æ€§ï¼ˆæ¶ˆé™¤å†—ä½™ï¼‰

         28ã€MySQLé”ç±»å‹

                   æ ¹æ®é”çš„ç±»å‹åˆ†ï¼šå¯ä»¥åˆ†ä¸ºå…±äº«é”ã€æ’ä»–é”ã€æ„å‘å…±äº«é”å’Œæ„å‘æ’ä»–é”
                   æ ¹æ®é”çš„ç²’åº¦åˆ†ï¼šå¯ä»¥åˆ†ä¸ºè¡Œé”ã€è¡¨é”
                   å¯¹äºmysqlè€Œè¨€ï¼Œäº‹åŠ¡æœºåˆ¶æ›´å¤šæ˜¯é åº•å±‚çš„å­˜å‚¨å¼•æ“æ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œmysqlå±‚é¢åªæœ‰è¡¨é”ï¼Œ
                   è€Œæ”¯æŒäº‹ç‰©çš„innodbå­˜å‚¨å¼•èµ·åˆ™å®ç°äº†è¡Œé”ï¼ˆåœ¨è¡Œç›¸åº”çš„ç´¢å¼•è®°å½•ä¸Šçš„é”ï¼‰
                   è¯´æ˜ï¼šå¯¹äºæ›´æ–°æ“ä½œï¼ˆè¯»ä¸ä¸Šé”ï¼‰ï¼Œåªæœ‰èµ°ç´¢å¼•æ‰å¯èƒ½ä¸Šè¡Œé”
                   MVCCï¼ˆå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼‰å¹¶å‘æ§åˆ¶æœºåˆ¶ä¸‹ï¼Œä»»ä½•æ“ä½œéƒ½ä¸ä¼šé˜»å¡è¯»å–æ“ä½œï¼Œ
                   è¯»å–æ“ä½œä¹Ÿä¸ä¼šé˜»å¡ä»»ä½•æ“ä½œï¼Œåªå› ä¸ºè¯»ä¸ä¸Šé”
                    å…±äº«é”ï¼šç”±è¯»è¡¨æ“ä½œåŠ ä¸Šçš„é”ï¼ŒåŠ é”åå…¶ä»–ç”¨æˆ·åªèƒ½è·å–è¯¥è¡¨æˆ–è¡Œçš„å…±äº«é”ï¼Œä¸èƒ½è·å–æ’ä»–é”ï¼Œ
                                  ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¯»ä¸èƒ½å†™
                    æ’ä»–é”ï¼šç”±å†™è¡¨æ“ä½œåŠ ä¸Šçš„é”ï¼ŒåŠ é”åå…¶ä»–ç”¨æˆ·ä¸èƒ½è·å–è¯¥è¡¨æˆ–è¯¥è¡Œçš„ä»»ä½•é”ï¼Œå…¸å‹mysqläº‹ç‰©ä¸­çš„æ›´æ–°æ“ä½œ
                    æ„å‘å…±äº«é”ï¼ˆISï¼‰ï¼šäº‹ç‰©æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œå…±äº«é”ï¼Œäº‹ç‰©åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡ŒåŠ å…±äº«é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„ISé”
                    æ„å‘æ’ä»–é”ï¼ˆIXï¼‰ï¼šäº‹ç‰©æ‰“ç®—ç»™æ•°æ®è¡ŒåŠ è¡Œæ’ä»–é”ï¼Œäº‹ç‰©åœ¨ç»™ä¸€ä¸ªæ•°æ®è¡Œå®¶æ’ä»–é”å‰å¿…é¡»å…ˆå–å¾—è¯¥è¡¨çš„IXé”


          29ã€å¦‚ä½•è§£å†³MYSQLæ•°æ®åº“ä¸­æ–‡ä¹±ç é—®é¢˜ï¼Ÿ

                   1.åœ¨æ•°æ®åº“å®‰è£…çš„æ—¶å€™æŒ‡å®šå­—ç¬¦é›†
                   2.å¦‚æœåœ¨æŒ‰å®Œäº†ä»¥åå¯ä»¥æ›´æ”¹é…ç½®æ–‡ä»¶
                   3.å»ºç«‹æ•°æ®åº“æ—¶å€™ï¼šæŒ‡å®šå­—ç¬¦é›†ç±»å‹
                   4.å»ºè¡¨çš„æ—¶å€™ä¹ŸæŒ‡å®šå­—ç¬¦é›†     

          30ã€æ•°æ®åº“åº”ç”¨ç³»ç»Ÿè®¾è®¡

                  1.è§„åˆ’  
                  2.éœ€æ±‚åˆ†æ
                  3.æ¦‚å¿µæ¨¡å‹è®¾è®¡
                  4.é€»è¾‘è®¾è®¡
                  5.ç‰©ç†è®¾è®¡
                  6. ç¨‹åºç¼–åˆ¶åŠè°ƒè¯•
                  7.è¿è¡ŒåŠç»´æŠ¤     
            psï¼šæ•°æ®åº“å¸¸è§é¢è¯•é—®é¢˜æ€»ç»“
                    https://yq.aliyun.com/wenji/     </code></pre>]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨(ä¸€)</title>
    <url>/2020/04/20/Python%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8-%E4%B8%80/</url>
    <content><![CDATA[<h3 id="Pythonå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨-ä¸€"><a href="#Pythonå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨-ä¸€" class="headerlink" title="Pythonå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨(ä¸€)"></a>Pythonå¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨(ä¸€)</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåºåˆ—å¯ä»¥è¿­ä»£ã€‚ä½†æ˜¯ï¼Œä½ çŸ¥é“ä¸ºä»€ä¹ˆå—ï¼Ÿ æœ¬æ–‡æ¥æ¢è®¨ä¸€ä¸‹è¿­ä»£èƒŒåçš„åŸç†ã€‚</p>
<p>åºåˆ—å¯ä»¥è¿­ä»£çš„åŸå› ï¼šiter å‡½æ•°ã€‚è§£é‡Šå™¨éœ€è¦è¿­ä»£å¯¹è±¡ x æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ iter(x)ã€‚å†…ç½®çš„ iter å‡½æ•°æœ‰ä»¥ä¸‹ä½œç”¨ï¼š</p>
<p>(1) æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®ç°äº† iter æ–¹æ³•ï¼Œå¦‚æœå®ç°äº†å°±è°ƒç”¨å®ƒï¼Œè·å–ä¸€ä¸ªè¿­ä»£å™¨ã€‚ </p>
<p>(2) å¦‚æœæ²¡æœ‰å®ç° iter æ–¹æ³•ï¼Œä½†æ˜¯å®ç°äº† getitem æ–¹æ³•ï¼Œè€Œä¸”å…¶å‚æ•°æ˜¯ä»é›¶å¼€å§‹çš„ç´¢å¼•ï¼ŒPython ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°è¯•æŒ‰é¡ºåºï¼ˆä»ç´¢å¼• 0 å¼€å§‹ï¼‰è·å–å…ƒç´ ã€‚ </p>
<p>(3) å¦‚æœå‰é¢ä¸¤æ­¥éƒ½å¤±è´¥ï¼ŒPython æŠ›å‡º TypeError å¼‚å¸¸ï¼Œé€šå¸¸ä¼šæç¤ºâ€œC objectis not iterableâ€ï¼ˆC å¯¹è±¡ä¸å¯è¿­ä»£ï¼‰ï¼Œå…¶ä¸­ C æ˜¯ç›®æ ‡å¯¹è±¡æ‰€å±çš„ç±»ã€‚</p>
<p>ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ˜ç¡®çŸ¥é“ä»€ä¹ˆæ˜¯ å¯è¿­ä»£çš„å¯¹è±¡ï¼š ä½¿ç”¨ iter å†…ç½®å‡½æ•°å¯ä»¥è·å–è¿­ä»£å™¨çš„å¯¹è±¡ã€‚å³è¦ä¹ˆå¯¹è±¡å®ç°äº†èƒ½è¿”å›è¿­ä»£å™¨çš„ iter æ–¹æ³•ï¼Œè¦ä¹ˆå¯¹è±¡å®ç°äº† getitem æ–¹æ³•ï¼Œè€Œä¸”å…¶å‚æ•°æ˜¯ä»é›¶å¼€å§‹çš„ç´¢å¼•ã€‚</p>
<p>ä¸‹é¢çœ‹ä¸€ä¸ªå®ç°äº†getitemæ–¹æ³•çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Example1:</span><br><span class="line">    def __init__(self, text):</span><br><span class="line">        self.text &#x3D; text</span><br><span class="line">        self.sub_text &#x3D; text.split(&#39; &#39;)</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, index):</span><br><span class="line">        return self.sub_text[index]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj1 &#x3D; Example1(&quot;Hello,have a beautiful day!&quot;)</span><br><span class="line">for i in obj1:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Hello,have</span><br><span class="line">a</span><br><span class="line">beautiful</span><br><span class="line">day!</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç±»Example1ï¼Œå¹¶ä¸”ä¸ºè¿™ä¸ªç±»å®ç°äº† getitem æ–¹æ³•ï¼Œå®ƒçš„å®ä¾‹åŒ–å¯¹è±¡obj1å°±æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸ªå®ç° iter æ–¹æ³•çš„ä¾‹å­ï¼Œå› ä¸ºç”¨åˆ°äº†è¿­ä»£å™¨ï¼Œæ‰€ä»¥åœ¨æ­¤æˆ‘ä»¬å¿…é¡»åœ¨æ˜ç¡®ä¸€ä¸‹è¿­ä»£å™¨çš„ç”¨æ³•ã€‚ æ ‡å‡†çš„è¿­ä»£å™¨æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<p><strong>next</strong></p>
<p>è¿”å›ä¸‹ä¸€ä¸ªå¯ç”¨çš„å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ äº†ï¼ŒæŠ›å‡º StopIterationå¼‚å¸¸ã€‚</p>
<p><strong>iter</strong></p>
<p>è¿”å› selfï¼Œä»¥ä¾¿åœ¨åº”è¯¥ä½¿ç”¨å¯è¿­ä»£å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨è¿­ä»£å™¨ï¼Œä¾‹å¦‚åœ¨ for å¾ªç¯ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Example2:</span><br><span class="line">    def __init__(self, text):</span><br><span class="line">        self.text &#x3D; text</span><br><span class="line">        self.sub_text &#x3D; text.split(&#39; &#39;)</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return Example2Iterator(self.sub_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Example2Iterator:</span><br><span class="line">    def __init__(self, sub_text):</span><br><span class="line">        self.sub_text &#x3D; sub_text</span><br><span class="line">        self.index &#x3D; 0</span><br><span class="line"></span><br><span class="line">    def __next__(self):</span><br><span class="line">        try:</span><br><span class="line">            subtext &#x3D; self.sub_text[self.index]</span><br><span class="line">        except IndexError:</span><br><span class="line">            raise StopIteration()</span><br><span class="line">        self.index +&#x3D; 1</span><br><span class="line">        return subtext</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return self</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åˆ›å»ºäº†Example2ç±»ï¼Œå¹¶ä¸ºå®ƒå®ç°äº† iter æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªè¿­ä»£å™¨Example2Iteratorã€‚ Example2Iteratorå®ç°äº†æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„nextå’Œiteræ–¹æ³•ã€‚ å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¹¶å¾ªç¯è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">obj2 &#x3D; Example2(&quot;Hello,have a beautiful day!&quot;)</span><br><span class="line">for i in obj2:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Hello,have</span><br><span class="line">a</span><br><span class="line">beautiful</span><br><span class="line">day!</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>å¯è§ï¼Œå’Œobj1æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡ä¸¤ç§æ–¹æ³•å®ç°äº†ä¸€ä¸ªè‡ªå·±çš„å¯è¿­ä»£å¯¹è±¡ï¼Œå†æ­¤è¿‡ç¨‹ä¸­æˆ‘ä»¬è¦æ˜ç¡®å¯è¿­ä»£çš„å¯¹è±¡å’Œè¿­ä»£å™¨ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p>Python ä»å¯è¿­ä»£çš„å¯¹è±¡ä¸­è·å–è¿­ä»£å™¨ã€‚</p>
<p>iteræ–¹æ³•ä»æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„è¿­ä»£å™¨ç±»ä¸­è·å–è¿­ä»£å™¨ï¼Œè€Œgetitemæ–¹æ³•æ˜¯pythonå†…éƒ¨è‡ªåŠ¨åˆ›å»ºè¿­ä»£å™¨ã€‚</p>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ˜ç™½äº†å¦‚ä½•æ­£ç¡®åœ°å®ç°å¯è¿­ä»£å¯¹è±¡ï¼Œå¹¶ä¸”å¼•å‡ºäº†æ€æ ·å®ç°è¿­ä»£å™¨ï¼Œä½†æ˜¯ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•ï¼ˆå³ä¸Šé¢çš„ä¾‹å­2ï¼‰çš„ä»£ç é‡æœ‰ç‚¹å¤§ï¼Œä¸‹é¢æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨æ›´ç¬¦åˆ Pythonä¹ æƒ¯çš„æ–¹å¼å®ç°Example2ç±»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Example3:</span><br><span class="line">    def __init__(self, text):</span><br><span class="line">        self.text &#x3D; text</span><br><span class="line">        self.sub_text &#x3D; text.split(&#39; &#39;)</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        for item in self.sub_text:</span><br><span class="line">            yield item</span><br></pre></td></tr></table></figure>

<p>å“¦äº†ï¼å°±è¿™ä¹ˆç®€å•ä¼˜é›…ï¼ä¸ç”¨å†å•ç‹¬å®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨ç±»ï¼ </p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†yield å…³é”®å­—ï¼Œ åªè¦ Python å‡½æ•°çš„å®šä¹‰ä½“ä¸­æœ‰ yield å…³é”®å­—ï¼Œè¯¥å‡½æ•°å°±æ˜¯ç”Ÿæˆå™¨å‡½æ•°ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ç”Ÿæˆå™¨å·¥å‚ã€‚ å½“ç„¶ï¼Œä¾‹å­3çš„ä»£ç è¿˜å¯ä»¥ä½¿ç”¨yield fromè¿›ä¸€æ­¥ç®€åŒ–ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Example4:</span><br><span class="line">    def __init__(self, text):</span><br><span class="line">        self.text &#x3D; text</span><br><span class="line">        self.sub_text &#x3D; text.split(&#39; &#39;)</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        yield from self.sub_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj4 &#x3D; Example4(&quot;Hello,have a beautiful day!&quot;)</span><br><span class="line">for i in obj4:</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Hello,have</span><br><span class="line">a</span><br><span class="line">beautiful</span><br><span class="line">day!</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åˆ°è¿™é‡Œæˆ‘ä»¬æ˜ç™½äº† å¯è¿­ä»£å¯¹è±¡ å’Œ è¿­ä»£å™¨ï¼Œè¿˜å¼•ç”³å‡ºäº†ç”Ÿæˆå™¨ï¼Œä½†è¿˜æœ‰ä¸€ç‚¹æ²¡æœ‰æï¼Œé‚£å°±æ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ã€‚<br>ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¾‹å­4çš„ä»£ç å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Example5:</span><br><span class="line">    def __init__(self, text):</span><br><span class="line">        self.text &#x3D; text</span><br><span class="line">        self.sub_text &#x3D; text.split(&#39; &#39;)</span><br><span class="line"></span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return (item for item in self.sub_text)</span><br></pre></td></tr></table></figure>
<p>åœ¨pythonä¸­ï¼Œæ‰€æœ‰ç”Ÿæˆå™¨éƒ½æ˜¯è¿­ä»£å™¨ã€‚<br>æœ€åï¼Œæ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä»€ä¹ˆæ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Ÿ å¯è¿­ä»£å¯¹è±¡è¦ä¹ˆå®ç°äº†èƒ½è¿”å›è¿­ä»£å™¨çš„ iter æ–¹æ³•ï¼Œè¦ä¹ˆå®ç°äº† getitem æ–¹æ³•è€Œä¸”å…¶å‚æ•°æ˜¯ä»é›¶å¼€å§‹çš„ç´¢å¼•ã€‚</li>
<li>ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ è¿­ä»£å™¨æ˜¯è¿™æ ·çš„å¯¹è±¡ï¼šå®ç°äº†æ— å‚æ•°çš„ next æ–¹æ³•ï¼Œè¿”å›ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰å…ƒç´ äº†ï¼Œé‚£ä¹ˆæŠ›å‡º StopIteration å¼‚å¸¸ï¼›å¹¶ä¸”å®ç°iter æ–¹æ³•ï¼Œè¿”å›è¿­ä»£å™¨æœ¬èº«ã€‚</li>
<li>ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ ç”Ÿæˆå™¨æ˜¯å¸¦æœ‰ yield å…³é”®å­—çš„å‡½æ•°ã€‚è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚</li>
<li>ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Ÿ ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åˆ›å»ºç”Ÿæˆå™¨çš„ç®€æ´å¥æ³•ï¼Œè¿™æ ·æ— éœ€å…ˆå®šä¹‰å‡½æ•°å†è°ƒç”¨ã€‚</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s/x1oxunw5buuPqujhZRYdjg" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginxé…ç½®é¡¹è¯´æ˜</title>
    <url>/2020/04/20/Nginx%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%B4%E6%98%8E/</url>
    <content><![CDATA[<h2 id="Nginxé…ç½®"><a href="#Nginxé…ç½®" class="headerlink" title="Nginxé…ç½®"></a>Nginxé…ç½®</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user  www www;</span><br><span class="line">worker_processes  8;</span><br><span class="line">worker_rlimit_nofile 100000; </span><br><span class="line"></span><br><span class="line">error_log  &#x2F;data&#x2F;nginx&#x2F;logs&#x2F;error.log  notice;</span><br><span class="line"></span><br><span class="line">pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    use epoll;    #epollæ˜¯å¤šè·¯å¤ç”¨IO(I&#x2F;O Multiplexing)ä¸­çš„ä¸€ç§æ–¹å¼,ä½†æ˜¯ä»…ç”¨äºlinux2.6ä»¥ä¸Šå†…æ ¸,å¯ä»¥å¤§å¤§æé«˜nginxçš„æ€§èƒ½</span><br><span class="line">    #multi_accept on;</span><br><span class="line">    worker_connections  52000;  #å•ä¸ªåå°worker processè¿›ç¨‹çš„æœ€å¤§å¹¶å‘é“¾æ¥æ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;  #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line">    #charset UTF-8; #è®¾ç½®æˆ‘ä»¬çš„å¤´æ–‡ä»¶ä¸­çš„é»˜è®¤çš„å­—ç¬¦é›†</span><br><span class="line"></span><br><span class="line">#è®¾ç½®æ—¥å¿—æ ¼å¼</span><br><span class="line">    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent $request_body  &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    access_log  off;</span><br><span class="line"></span><br><span class="line">#sendfile æŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨ sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œå¯¹äºæ™®é€šåº”ç”¨ï¼Œ</span><br><span class="line">    #å¿…é¡»è®¾ä¸º on,å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸º offï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œI&#x2F;Oå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿçš„uptime.</span><br><span class="line">    server_tokens off; #å¹¶ä¸ä¼šè®©nginxæ‰§è¡Œçš„é€Ÿåº¦æ›´å¿«ï¼Œä½†å®ƒå¯ä»¥å…³é—­åœ¨é”™è¯¯é¡µé¢ä¸­çš„nginxç‰ˆæœ¬æ•°å­—ï¼Œè¿™æ ·å¯¹äºå®‰å…¨æ€§æ˜¯æœ‰å¥½å¤„çš„ã€‚</span><br><span class="line">    sendfile       onï¼›#sendfileå¯ä»¥è®©sendfile()å‘æŒ¥ä½œç”¨ã€‚sendfile()å¯ä»¥åœ¨ç£ç›˜å’ŒTCP socketä¹‹é—´äº’ç›¸æ‹·è´æ•°æ®(æˆ–ä»»æ„ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦)ã€‚</span><br><span class="line">    tcp_nopush     on; #å‘Šè¯‰nginxåœ¨ä¸€ä¸ªæ•°æ®åŒ…é‡Œå‘é€æ‰€æœ‰å¤´æ–‡ä»¶ï¼Œè€Œä¸ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å‘é€</span><br><span class="line">    tcp_nodelay     on;#å‘Šè¯‰nginxä¸è¦ç¼“å­˜æ•°æ®ï¼Œè€Œæ˜¯ä¸€æ®µä¸€æ®µçš„å‘é€--å½“éœ€è¦åŠæ—¶å‘é€æ•°æ®æ—¶ï¼Œå°±åº”è¯¥ç»™åº”ç”¨è®¾ç½®è¿™ä¸ªå±æ€§ï¼Œè¿™æ ·å‘é€ä¸€å°å—æ•°æ®ä¿¡æ¯æ—¶å°±ä¸èƒ½ç«‹å³å¾—åˆ°è¿”å›å€¼ã€‚</span><br><span class="line">#è®¾ç½®è¶…æ—¶æ—¶é—´</span><br><span class="line">    keepalive_timeout  10; #ç»™å®¢æˆ·ç«¯åˆ†é…keep-aliveé“¾æ¥è¶…æ—¶æ—¶é—´ã€‚æœåŠ¡å™¨å°†åœ¨è¿™ä¸ªè¶…æ—¶æ—¶é—´è¿‡åå…³é—­é“¾æ¥</span><br><span class="line">    client_header_timeout 10; #client_header_timeout å’Œclient_body_timeout è®¾ç½®è¯·æ±‚å¤´å’Œè¯·æ±‚ä½“(å„è‡ª)çš„è¶…æ—¶æ—¶é—´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªè®¾ç½®ä½äº›ã€‚</span><br><span class="line">    client_body_timeout 10; </span><br><span class="line">    reset_timedout_connection on; #å‘Šè¯‰nginxå…³é—­ä¸å“åº”çš„å®¢æˆ·ç«¯è¿æ¥ã€‚è¿™å°†ä¼šé‡Šæ”¾é‚£ä¸ªå®¢æˆ·ç«¯æ‰€å æœ‰çš„å†…å­˜ç©ºé—´ã€‚</span><br><span class="line">    send_timeout 10; #æŒ‡å®šå®¢æˆ·ç«¯çš„å“åº”è¶…æ—¶æ—¶é—´ã€‚è¿™ä¸ªè®¾ç½®ä¸ä¼šç”¨äºæ•´ä¸ªè½¬å‘å™¨ï¼Œè€Œæ˜¯åœ¨ä¸¤æ¬¡å®¢æˆ·ç«¯è¯»å–æ“ä½œä¹‹é—´ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œå®¢æˆ·ç«¯æ²¡æœ‰è¯»å–ä»»ä½•æ•°æ®ï¼Œnginxå°±ä¼šå…³é—­è¿æ¥</span><br><span class="line"></span><br><span class="line">#å¼€å¯gzipå‹ç¼©</span><br><span class="line">gzip on;</span><br><span class="line">gzip_disable &quot;msie6&quot;;</span><br><span class="line"># gzip_static on;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_min_length 1000;</span><br><span class="line">gzip_comp_level 4;</span><br><span class="line">gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;x-javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line"></span><br><span class="line">#gzipæ˜¯å‘Šè¯‰nginxé‡‡ç”¨gzipå‹ç¼©çš„å½¢å¼å‘é€æ•°æ®ã€‚è¿™å°†ä¼šå‡å°‘æˆ‘ä»¬å‘é€çš„æ•°æ®é‡ã€‚</span><br><span class="line">#gzip_disableä¸ºæŒ‡å®šçš„å®¢æˆ·ç«¯ç¦ç”¨gzipåŠŸèƒ½ã€‚æˆ‘ä»¬è®¾ç½®æˆIE6æˆ–è€…æ›´ä½ç‰ˆæœ¬ä»¥ä½¿æˆ‘ä»¬çš„æ–¹æ¡ˆèƒ½å¤Ÿå¹¿æ³›å…¼å®¹ã€‚</span><br><span class="line">#gzip_staticå‘Šè¯‰nginxåœ¨å‹ç¼©èµ„æºä¹‹å‰ï¼Œå…ˆæŸ¥æ‰¾æ˜¯å¦æœ‰é¢„å…ˆgzipå¤„ç†è¿‡çš„èµ„æºã€‚è¿™è¦æ±‚ä½ é¢„å…ˆå‹ç¼©ä½ çš„æ–‡ä»¶ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­è¢«æ³¨é‡Šæ‰äº†ï¼‰ï¼Œä»è€Œå…è®¸ä½ ä½¿ç”¨æœ€é«˜å‹ç¼©æ¯”ï¼Œè¿™æ ·nginxå°±ä¸ç”¨å†å‹ç¼©è¿™äº›æ–‡ä»¶äº†ï¼ˆæƒ³è¦æ›´è¯¦å°½çš„gzip_staticçš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œï¼‰ã€‚</span><br><span class="line">#gzip_proxiedå…è®¸æˆ–è€…ç¦æ­¢å‹ç¼©åŸºäºè¯·æ±‚å’Œå“åº”çš„å“åº”æµã€‚æˆ‘ä»¬è®¾ç½®ä¸ºanyï¼Œæ„å‘³ç€å°†ä¼šå‹ç¼©æ‰€æœ‰çš„è¯·æ±‚ã€‚</span><br><span class="line">#gzip_min_lengthè®¾ç½®å¯¹æ•°æ®å¯ç”¨å‹ç¼©çš„æœ€å°‘å­—èŠ‚æ•°ã€‚å¦‚æœä¸€ä¸ªè¯·æ±‚å°äº1000å­—èŠ‚ï¼Œæˆ‘ä»¬æœ€å¥½ä¸è¦å‹ç¼©å®ƒï¼Œå› ä¸ºå‹ç¼©è¿™äº›å°çš„æ•°æ®ä¼šé™ä½å¤„ç†æ­¤è¯·æ±‚çš„æ‰€æœ‰è¿›ç¨‹çš„é€Ÿåº¦ã€‚</span><br><span class="line">#gzip_comp_levelè®¾ç½®æ•°æ®çš„å‹ç¼©ç­‰çº§ã€‚è¿™ä¸ªç­‰çº§å¯ä»¥æ˜¯1-9ä¹‹é—´çš„ä»»æ„æ•°å€¼ï¼Œ9æ˜¯æœ€æ…¢ä½†æ˜¯å‹ç¼©æ¯”æœ€å¤§çš„ã€‚æˆ‘ä»¬è®¾ç½®ä¸º4ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæŠ˜ä¸­çš„è®¾ç½®ã€‚</span><br><span class="line"></span><br><span class="line">open_file_cache max&#x3D;100000 inactive&#x3D;20s;</span><br><span class="line">open_file_cache_valid 30s;</span><br><span class="line">open_file_cache_min_uses 2;</span><br><span class="line">open_file_cache_errors on;</span><br><span class="line">#open_file_cacheæ‰“å¼€ç¼“å­˜çš„åŒæ—¶ä¹ŸæŒ‡å®šäº†ç¼“å­˜æœ€å¤§æ•°ç›®ï¼Œä»¥åŠç¼“å­˜çš„æ—¶é—´ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªç›¸å¯¹é«˜çš„æœ€å¤§æ—¶é—´ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨å®ƒä»¬ä¸æ´»åŠ¨è¶…è¿‡20ç§’åæ¸…é™¤æ‰ã€‚</span><br><span class="line">#open_file_cache_valid åœ¨open_file_cacheä¸­æŒ‡å®šæ£€æµ‹æ­£ç¡®ä¿¡æ¯çš„é—´éš”æ—¶é—´ã€‚</span><br><span class="line">#open_file_cache_min_uses å®šä¹‰äº†open_file_cacheä¸­æŒ‡ä»¤å‚æ•°ä¸æ´»åŠ¨æ—¶é—´æœŸé—´é‡Œæœ€å°çš„æ–‡ä»¶æ•°ã€‚</span><br><span class="line">#open_file_cache_errorsæŒ‡å®šäº†å½“æœç´¢ä¸€ä¸ªæ–‡ä»¶æ—¶æ˜¯å¦ç¼“å­˜é”™è¯¯ä¿¡æ¯ï¼Œä¹ŸåŒ…æ‹¬å†æ¬¡ç»™é…ç½®ä¸­æ·»åŠ æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹ŸåŒ…æ‹¬äº†æœåŠ¡å™¨æ¨¡å—ï¼Œè¿™äº›æ˜¯åœ¨ä¸åŒæ–‡ä»¶ä¸­å®šä¹‰çš„ã€‚å¦‚æœä½ çš„æœåŠ¡å™¨æ¨¡å—ä¸åœ¨è¿™äº›ä½ç½®ï¼Œä½ å°±å¾—ä¿®æ”¹è¿™ä¸€è¡Œæ¥æŒ‡å®šæ­£ç¡®çš„ä½ç½®ã€‚</span><br><span class="line"></span><br><span class="line">#è®¾å®šè¯·æ±‚ç¼“å†²</span><br><span class="line">    client_max_body_size    8m;</span><br><span class="line">    client_body_buffer_size    512k;</span><br><span class="line">    client_header_buffer_size    32k;</span><br><span class="line">    large_client_header_buffers  4 32k;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    proxy_connect_timeout 60;</span><br><span class="line">    proxy_read_timeout 60;</span><br><span class="line">    proxy_send_timeout 60;</span><br><span class="line">    proxy_buffer_size 16k;</span><br><span class="line">    proxy_buffers 6 512k;</span><br><span class="line">    proxy_busy_buffers_size 1024k;</span><br><span class="line">    proxy_temp_file_write_size 512k;</span><br><span class="line"></span><br><span class="line">#è®¾å®šè´Ÿè½½å‡è¡¡çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">#weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span><br><span class="line">    upstream tdx &#123;</span><br><span class="line">     #ip_hash;</span><br><span class="line">         server node1:80 max_fails&#x3D;3 fail_timeout&#x3D;30s weight&#x3D;6;</span><br><span class="line">         server  node2:80 max_fails&#x3D;3 fail_timeout&#x3D;30s weight&#x3D;6; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream test &#123;</span><br><span class="line">     #ip_hash;</span><br><span class="line">         server node1:81 max_fails&#x3D;3 fail_timeout&#x3D;30s weight&#x3D;1;</span><br><span class="line">         server  node2:81 max_fails&#x3D;3 fail_timeout&#x3D;30s weight&#x3D;6; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¤ºä¾‹1"><a href="#ç¤ºä¾‹1" class="headerlink" title="ç¤ºä¾‹1"></a>ç¤ºä¾‹1</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen  80;</span><br><span class="line">        #server_name  wwww.xxx.com;</span><br><span class="line">        access_log  &#x2F;data&#x2F;nginx&#x2F;logs&#x2F;tdx_access.log  combined;</span><br><span class="line"></span><br><span class="line">#é»˜è®¤è¯·æ±‚</span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;tdx;  #å®šä¹‰æœåŠ¡å™¨çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•ä½ç½®</span><br><span class="line">            index  index.php index.html index.htm; #å®šä¹‰é¦–é¡µç´¢å¼•æ–‡ä»¶çš„åç§°</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;tdx;  #è¯·æ±‚è½¬å‘tdxå®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨</span><br><span class="line">        proxy_redirect off;   #ç¦ç”¨ç¼“å­˜</span><br><span class="line">        #åç«¯çš„WebæœåŠ¡å™¨å¯ä»¥é€šè¿‡X-Forwarded-Forè·å–ç”¨æˆ·çœŸå®IP</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line"></span><br><span class="line">        client_max_body_size 10m;  #å…è®¸å®¢æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å•æ–‡ä»¶å­—èŠ‚æ•°</span><br><span class="line">        client_body_buffer_size 128k;  #ç¼“å†²åŒºä»£ç†ç¼“å†²ç”¨æˆ·ç«¯è¯·æ±‚çš„æœ€å¤§å­—èŠ‚æ•°</span><br><span class="line">        proxy_connect_timeout 90; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶)</span><br><span class="line">        proxy_send_timeout 90;</span><br><span class="line">        proxy_read_timeout 90; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶)</span><br><span class="line">        proxy_buffer_size 4k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å°</span><br><span class="line">        proxy_buffers 4 32k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½®</span><br><span class="line">        proxy_busy_buffers_size 64k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰</span><br><span class="line">        proxy_temp_file_write_size 64k; #è®¾å®šç¼“å­˜æ–‡ä»¶å¤¹å¤§å°ï¼Œå¤§äºè¿™ä¸ªå€¼ï¼Œå°†ä»upstreamæœåŠ¡å™¨ä¼ </span><br><span class="line">        &#125;</span><br><span class="line">#å®šä¹‰é”™è¯¯æç¤ºé¡µé¢</span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   &#x2F;usr&#x2F;local&#x2F;web_app&#x2F;nginx&#x2F;html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">        root &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;tdx;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;tdx;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">#PHP è„šæœ¬è¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° FastCGIå¤„ç†. ä½¿ç”¨FastCGIé»˜è®¤é…ç½®</span><br><span class="line">       # proxy_redirect off;</span><br><span class="line">           # fastcgi_pass   unix:&#x2F;tmp&#x2F;php-fcgi.sock;</span><br><span class="line">           # fastcgi_index  index.php;</span><br><span class="line">           # fastcgi_param  SCRIPT_FILENAME  &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;tdx&#x2F;$fastcgi_script_name;</span><br><span class="line">           # include        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line">#ç¦æ­¢è®¿é—®.htxxxæ–‡ä»¶</span><br><span class="line">        location ~ &#x2F;\.ht &#123;</span><br><span class="line">            deny  all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen  81;</span><br><span class="line">        server_name  ip;</span><br><span class="line"></span><br><span class="line">        access_log  &#x2F;data&#x2F;nginx&#x2F;logs&#x2F;test_access.log  combined;</span><br><span class="line"></span><br><span class="line">        location &#x2F; &#123;</span><br><span class="line">            root   &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;test;</span><br><span class="line">            index  index.php index.html index.htm;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;test;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        client_max_body_size 10m;</span><br><span class="line">        client_body_buffer_size 128k; </span><br><span class="line">        proxy_connect_timeout 90;</span><br><span class="line">        proxy_send_timeout 90;</span><br><span class="line">        proxy_read_timeout 90;</span><br><span class="line">        proxy_buffer_size 4k;</span><br><span class="line">        proxy_buffers 4 32k;</span><br><span class="line">        proxy_busy_buffers_size 64k;</span><br><span class="line">        proxy_temp_file_write_size 64k;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">        location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">            root   &#x2F;usr&#x2F;local&#x2F;web_app&#x2F;nginx&#x2F;html;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        location ~ \.php$ &#123;</span><br><span class="line">        root &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;test;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;test;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">           #fastcgi_pass   unix:&#x2F;tmp&#x2F;php-fcgi.sock;</span><br><span class="line">           #fastcgi_index  index.php;</span><br><span class="line">           #fastcgi_param  SCRIPT_FILENAME  &#x2F;data&#x2F;nginx&#x2F;htdocs&#x2F;test&#x2F;$fastcgi_script_name;</span><br><span class="line">           #include        fastcgi_params;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ &#x2F;\.ht &#123;</span><br><span class="line">            deny  all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.ttlsa.com/nginx/using-nginx-as-http-loadbalancer/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/using-nginx-as-http-loadbalancer/</a> è´Ÿè½½å‡è¡¡ä¸‰ç§æ¨¡å¼åŒºåˆ«<br><a href="http://www.ttlsa.com/nginx/nginx-load-balancing-from-theory-to-practice/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/nginx-load-balancing-from-theory-to-practice/</a> è´Ÿè½½å‡è¡¡å®è·µ<br><a href="http://www.ttlsa.com/nginx/nginx-configure-descriptions/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/nginx-configure-descriptions/</a>  ç¼–è¯‘å®‰è£…nginxå‚æ•°è¯¦ç»†<br><a href="http://www.ttlsa.com/nginx/nginx-battle-ready-optimization-guide/" target="_blank" rel="noopener">http://www.ttlsa.com/nginx/nginx-battle-ready-optimization-guide/</a> ä¼˜åŒ–æŒ‡å—</p>
<p>httpæ®µå®Œæ•´é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">pid &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class="line">worker_processes auto;</span><br><span class="line">worker_rlimit_nofile 100000;</span><br><span class="line">events &#123;</span><br><span class="line"> worker_connections 2048;</span><br><span class="line"> multi_accept on;</span><br><span class="line"> use epoll;</span><br><span class="line">&#125;</span><br><span class="line">http &#123;</span><br><span class="line">  server_tokens off;</span><br><span class="line"> sendfile on;</span><br><span class="line">tcp_nopush on;</span><br><span class="line"> tcp_nodelay on;</span><br><span class="line"> access_log off;</span><br><span class="line"> error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log crit;</span><br><span class="line"> keepalive_timeout 10;</span><br><span class="line"> client_header_timeout 10;</span><br><span class="line"> client_body_timeout 10;</span><br><span class="line">reset_timedout_connection on;</span><br><span class="line"> send_timeout 10;</span><br><span class="line"> limit_conn_zone $binary_remote_addr zone&#x3D;addr:5m;</span><br><span class="line"> limit_conn addr 100;</span><br><span class="line"> include &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line"> default_type text&#x2F;html;</span><br><span class="line">charset UTF-8;</span><br><span class="line">gzip on;</span><br><span class="line"> gzip_disable &quot;msie6&quot;;</span><br><span class="line">gzip_proxied any;</span><br><span class="line">gzip_min_length 1000;</span><br><span class="line">gzip_comp_level 6;</span><br><span class="line"> gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;x-javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line"> open_file_cache max&#x3D;100000 inactive&#x3D;20s;</span><br><span class="line">open_file_cache_valid 30s;</span><br><span class="line">open_file_cache_min_uses 2;</span><br><span class="line">open_file_cache_errors on;</span><br><span class="line"> include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line"> include &#x2F;etc&#x2F;nginx&#x2F;sites-enabled&#x2F;*;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx Rewrite</title>
    <url>/2020/04/20/Nginx-Rewrite/</url>
    <content><![CDATA[<h2 id="Nginx-Rewrite"><a href="#Nginx-Rewrite" class="headerlink" title="Nginx Rewrite"></a>Nginx Rewrite</h2><hr>


<p>ç½‘ç«™åœ¨ä½¿ç”¨ Nginx æ—¶éƒ½ä¼šè¿›è¡Œä¸ªæ€§åŒ–é…ç½®æ»¡è¶³è‡ªå·±çš„ä¸šåŠ¡éœ€è¦ï¼Œè€Œ URL é‡å†™å‡ ä¹æ˜¯æ¯ä¸ªç½‘ç«™éƒ½å¿…åšçš„äº‹æƒ…ï¼ŒNginx çš„ URL é‡å†™è§„åˆ™ä¸åƒ Apache é‚£æ ·ç®€å•ç›´æ¥ï¼Œé€»è¾‘ç›¸å¯¹è¦å¤æ‚ä¸€äº›ï¼Œæœ¬æ–‡å°†é€šè¿‡ä¾‹å­çš„æ–¹å¼å¸®åŠ©å¤§å®¶ç†è§£ Nginx rewrite åŸç†ï¼Œå¸Œæœ›èƒ½å¯¹æ‚¨æœ‰äº›å¯å‘ã€‚</p>
<h2 id="Nginx-ä¸­é‡å®šå‘çš„å¤šç§æ–¹å¼"><a href="#Nginx-ä¸­é‡å®šå‘çš„å¤šç§æ–¹å¼" class="headerlink" title="Nginx ä¸­é‡å®šå‘çš„å¤šç§æ–¹å¼"></a>Nginx ä¸­é‡å®šå‘çš„å¤šç§æ–¹å¼</h2><h3 id="å¤–éƒ¨é‡å®šå‘"><a href="#å¤–éƒ¨é‡å®šå‘" class="headerlink" title="å¤–éƒ¨é‡å®šå‘"></a>å¤–éƒ¨é‡å®šå‘</h3><p>return æŒ‡ä»¤è¿”å› 301 æˆ– 302ï¼ˆreturn ä¹Ÿå¯ä»¥è¿”å›å…¶ä»–çŠ¶æ€ç ï¼‰ï¼Œå¯ä»¥æ”¾åœ¨ server æˆ– location å—ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return 301 https:&#x2F;&#x2F;www.mi.com;</span><br><span class="line">or</span><br><span class="line">return 302 https:&#x2F;&#x2F;www.mi.com;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥ä½¿ç”¨ rewrite æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rewrite ^&#x2F;(.*)$   http:&#x2F;&#x2F;www.mi.com&#x2F;$1;</span><br><span class="line">or</span><br><span class="line">rewrite ^&#x2F;(.*)$   http:&#x2F;&#x2F;www.mi.com&#x2F; redirect;</span><br></pre></td></tr></table></figure>
<h3 id="å†…éƒ¨é‡å®šå‘"><a href="#å†…éƒ¨é‡å®šå‘" class="headerlink" title="å†…éƒ¨é‡å®šå‘"></a>å†…éƒ¨é‡å®šå‘</h3><p>return + error_page æŒ‡ä»¤çš„ç»„åˆï¼Œæˆ– try_files æŒ‡ä»¤å’Œ rewrite æŒ‡ä»¤ï¼Œéå¸¸çµæ´»ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦è®²è§£ rewrite çš„å·¥ä½œåŸç†ï¼Œå…¶ä»–æŒ‡ä»¤çš„ä½¿ç”¨æ–¹æ³•å¤§å®¶å¯ä»¥è‡ªè¡ŒæŸ¥é˜… Nginx å®˜ç½‘ã€‚åœ¨ä½¿ç”¨ Nginx çš„ rewrite æŒ‡ä»¤æ—¶ï¼Œflag å¯ä»¥è®¾ç½®ä¸º last å’Œ breakï¼Œè¿™ä¸¤ä¸ª flag å¾ˆå®¹æ˜“æ··æ·†ï¼Œåé¢æˆ‘ä»¬ä¼šæ¯”è¾ƒè¿™ä¸¤ä¸ª flag çš„åŒºåˆ«ï¼Œä¸‹é¢é€šè¿‡ç¤ºä¾‹æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹ rewrite æŒ‡ä»¤ã€‚</p>
<h2 id="rewrite-è¯­æ³•"><a href="#rewrite-è¯­æ³•" class="headerlink" title="rewrite è¯­æ³•"></a>rewrite è¯­æ³•</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Syntax:    rewrite regex replacement [flag];</span><br><span class="line">Context:   server, location, if</span><br></pre></td></tr></table></figure>
<ul>
<li><p>regexï¼š å¯¹è¯·æ±‚çš„ URI åšæ­£åˆ™åŒ¹é…</p>
</li>
<li><p>replacementï¼šç›®æ ‡ uri åŒ¹é…æˆåŠŸåæ›¿æ¢çš„ url</p>
</li>
<li><p>å¯ä»¥ä½¿ç”¨çš„ flag æœ‰ä»¥ä¸‹ 4 ä¸ªï¼ˆflag ä¹Ÿå¯ä»¥ä¸ºç©ºï¼‰:</p>
<ul>
<li><p>redirectï¼šè¿”å› 302 ä¸´æ—¶é‡å®šå‘ï¼Œå®¢æˆ·ç«¯åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼›</p>
</li>
<li><p>permanentï¼šè¿”å› 301 æ°¸ä¹…é‡å®šå‘ï¼Œå®¢æˆ·ç«¯åœ°å€æ ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ï¼›</p>
</li>
<li><p>lastï¼šå†…éƒ¨é‡å®šå‘ï¼Œåœæ­¢å¤„ç†åç»­ rewrite æ¨¡å—ä¸­çš„æŒ‡ä»¤ï¼ˆå®¢æˆ·ç«¯æ— æ„ŸçŸ¥ï¼‰ï¼›</p>
</li>
<li><p>breakï¼šå†…éƒ¨é‡å®šå‘ï¼Œåœæ­¢å¤„ç†åç»­ rewrite æ¨¡å—ä¸­çš„æŒ‡ä»¤ï¼ˆå®¢æˆ·ç«¯æ— æ„ŸçŸ¥)ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="NOTE"><a href="#NOTE" class="headerlink" title="NOTE:"></a>NOTE:</h3><ol>
<li>regex åŒ¹é…çš„æ˜¯ uriï¼Œä¸åŒ…å« hostname å’Œ query stringï¼Œé»˜è®¤ query string æ˜¯è¢«è¿½åŠ åˆ° replacement æœ«å°¾ï¼Œå¦‚æœä¸å¸Œæœ›åœ¨æœ«å°¾è¿½åŠ è¯·æ±‚çš„ query stringï¼Œå¯ä»¥åœ¨ replacement çš„æœ«å°¾åŠ ä¸€ä¸ª â€œ?â€ã€‚</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi&#x2F;$1;</span><br><span class="line">    rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;mi&#x2F;$1?x&#x3D;0&amp;y&#x3D;1?;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi&#x2F; &#123;        </span><br><span class="line">        echo $uri$is_args$args;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl &quot;http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello?a&#x3D;1&amp;b&#x3D;2&quot;</span><br><span class="line">output: &#x2F;mi&#x2F;hello?a&#x3D;1&amp;b&#x3D;2</span><br><span class="line"></span><br><span class="line">$ curl &quot;http:&#x2F;&#x2F;localhost&#x2F;mi_two&#x2F;hello?a&#x3D;1&amp;b&#x3D;2&quot;</span><br><span class="line">output: &#x2F;mi&#x2F;hello?x&#x3D;0&amp;y&#x3D;1</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>å¦‚æœ replacement æ˜¯ä»¥ â€œhttp://â€œï¼Œâ€https://â€œ æˆ– $schemeâ€ å¼€å§‹çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ rewrite æŒ‡ä»¤åœæ­¢åé¢çš„å¤„ç†ï¼Œç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ²¡æœ‰æŒ‡å®š flag æ—¶ï¼Œä¸ redirect æ•ˆæœç›¸åŒã€‚</p>
</li>
<li><p>æ²¡æœ‰ flag çš„ rewrite æŒ‡ä»¤æ ¹æ®å‡ºç°çš„é¡ºåºæ‰§è¡Œï¼Œflag å¯ä»¥æ§åˆ¶æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚</p>
</li>
<li><p>åœ¨é…ç½®ä¸­å¼€å¯ rewrite_log æŒ‡ä»¤ï¼Œæ—¥å¿—æ–‡ä»¶ä¸­ä¼šè®°å½• rewrite çš„åŒ¹é…è¿‡ç¨‹ï¼Œæœ‰åŠ©äºè°ƒè¯• rewrite é—®é¢˜ã€‚</p>
</li>
</ol>
<h2 id="Nginx-è¯·æ±‚å¤„ç†æµç¨‹"><a href="#Nginx-è¯·æ±‚å¤„ç†æµç¨‹" class="headerlink" title="Nginx è¯·æ±‚å¤„ç†æµç¨‹"></a>Nginx è¯·æ±‚å¤„ç†æµç¨‹</h2><p>åœ¨è®² rewrite å‰æˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£ä¸‹ Nginx è¯·æ±‚å¤„ç†æµç¨‹ï¼Œä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¯·æ±‚å¤„ç†æµç¨‹å‘¢ï¼Ÿå› ä¸º rewrite æ“ä½œä¸å…¶ä¸­å‡ ä¸ª phase å…³ç³»å¾ˆå¯†åˆ‡ï¼Œç†Ÿæ‚‰äº†è¯·æ±‚å¤„ç†æµç¨‹ï¼Œç†è§£ rewrite æ‰§è¡Œé€»è¾‘å°±ä¼šå¾ˆå®¹æ˜“ã€‚åœ¨ Nginx å†…éƒ¨å°†è¯·æ±‚å¤„ç†åˆ’åˆ†ä¸º 11 ä¸ª phaseï¼Œæ¯ä¸ª phase ä¼šæ‰§è¡Œå¯¹åº”çš„ handlerï¼Œè¿™é‡Œæˆ‘ä»¬ä¸æ‰“ç®—é€ä¸ªè¿›è¡Œè®²è§£ã€‚åœ¨ 11 ä¸ª phase ä¸­ä¸ rewrite æŒ‡ä»¤é€»è¾‘æœ‰å…³çš„åªæœ‰ 4 ä¸ªï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡æˆ‘ä»¬ä¸»è¦å…³æ³¨ SERVER_REWRITEã€FIND_CONFIGã€REWRITE å’Œ POST_REWRITE è¿™å››ä¸ª phaseã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æ¸…æ¥šçš„æ˜¯ï¼š</p>
<ul>
<li><p>server å—ä¸­çš„ rewrite æ¨¡å—æŒ‡ä»¤åœ¨ SERVER_REWRITE é˜¶æ®µè§£æï¼›</p>
</li>
<li><p>location å—ä¸­çš„ rewrite æ¨¡å—æŒ‡ä»¤åœ¨ REWRITE é˜¶æ®µè§£æï¼›</p>
</li>
<li><p>SERVER_REWRITE - è¯·æ±‚åˆ°è¾¾åé¦–å…ˆå¤„ç†è¿™ä¸ªé˜¶æ®µçš„ rewrite æŒ‡ä»¤æ“ä½œ</p>
</li>
<li><p>FIND_CONFIG - æ ¹æ® SERVER_REWRITE é˜¶æ®µå¾—åˆ°çš„ uri æŸ¥æ‰¾ location</p>
</li>
<li><p>REWRITE - ç¡®å®š location åæ‰§è¡Œ locaton ä¸­ rewrite æ“ä½œ</p>
</li>
<li><p>POST_REWRITE - æ ¹æ®ä¸Šä¸€é˜¶æ®µçš„ uri é‡å†™ç»“æœåšå†³ç­–ï¼Œå¯èƒ½è·³å› FIND_CONFIG é˜¶æ®µé‡æ–°æŸ¥æ‰¾ locationï¼Œä¹Ÿå¯èƒ½ç»§ç»­æ‰§è¡Œåè¾¹çš„ phaseã€‚ä¾‹å¦‚ï¼šåœ¨ location ä¸­é…ç½®äº† rewrite æŒ‡ä»¤å¹¶ä¸”æŒ‡å®š flag=breakï¼Œæ‰§è¡Œå®Œæœ¬æ¡ rewrite ç»ˆæ­¢åè¾¹çš„ rewrite åŒ¹é…ï¼Œç„¶åæ‰§è¡Œ PREACCESS é˜¶æ®µä¸­çš„ handlerã€‚åŒæ ·çš„åœºæ™¯ä¸‹ flag=lastï¼Œæ‰§è¡Œå®Œæœ¬æ¡ rewrite ç»ˆæ­¢åè¾¹çš„ rewrite åŒ¹é…ï¼Œç„¶åè·³åˆ° FIND_CONFIG é˜¶æ®µå†æ¬¡æŸ¥æ‰¾ locationã€‚æœªæŒ‡å®š flag çš„æƒ…å†µä¸ flag=last ç±»ä¼¼ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯åœ¨åŒä¸€å±‚çº§ä¸­æœªæŒ‡å®š flag çš„ rewrite è¯­å¥ä¸ä¼šç»ˆæ­¢åç»­çš„ rewrite åŒ¹é…ã€‚</p>
</li>
</ul>
<h3 id="é€šè¿‡ä¾‹å­ç†è§£-rewrite-æŒ‡ä»¤"><a href="#é€šè¿‡ä¾‹å­ç†è§£-rewrite-æŒ‡ä»¤" class="headerlink" title="é€šè¿‡ä¾‹å­ç†è§£ rewrite æŒ‡ä»¤"></a>é€šè¿‡ä¾‹å­ç†è§£ rewrite æŒ‡ä»¤</h3><h3 id="1-æœªæŒ‡å®š-flag"><a href="#1-æœªæŒ‡å®š-flag" class="headerlink" title="1.æœªæŒ‡å®š flag"></a>1.æœªæŒ‡å®š flag</h3><p>æœªæŒ‡å®š flag çš„ rewrite ä¼šæŒ‰ç…§å‡ºç°é¡ºåºè¿›è¡ŒåŒ¹é…ï¼Œserver å—ä¸­ rewrite åŒ¹é…å®Œä»¥åæ ¹æ®æ”¹å†™çš„ uri æŸ¥æ‰¾ locationï¼Œç„¶åå†åŒ¹é… location ä¸­çš„ rewriteï¼Œlocation ä¸­çš„ rewrite æŒ‡ä»¤åŒ¹é…æˆåŠŸåä¼šå†æ¬¡æŸ¥æ‰¾ locationã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$         &#x2F;mi_one&#x2F;$1;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;mi_zero&#x2F;hello</span><br><span class="line">This is mi_two location</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><p>åŒ¹é…ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_one/mi_zero/helloï¼Œæ²¡æœ‰æŒ‡å®š flag çš„ rewrite ç»§ç»­åŒ¹é…åé¢çš„ rewrite</p>
</li>
<li><p>åŒ¹é…ç¬¬äºŒæ¡ rewrite æˆåŠŸï¼Œæ­¤æ—¶ uri è¢«æ”¹å†™ä¸º / mi_two/mi_zero/hello</p>
</li>
<li><p>æŸ¥æ‰¾ locationï¼Œmi_two è¢«ç¡®å®šä¸ºæœ€ç»ˆçš„ location</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$         &#x2F;mi_one&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;hello</span><br><span class="line">This is mi_two location</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>åŒ¹é… server å—ä¸­çš„ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_one/hello</p>
</li>
<li><p>server å—ä¸­åªæœ‰ä¸€æ¡ rewrite æŒ‡ä»¤ï¼Œå¼€å§‹æŸ¥æ‰¾ location</p>
</li>
<li><p>location mi_one è¢«æ‰¾åˆ°ï¼Œå¼€å§‹åŒ¹é… location ä¸­ rewrite</p>
</li>
<li><p>location ä¸­çš„ rewrite åŒ¹é…æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_two/hello</p>
</li>
<li><p>å†æ¬¡æŸ¥æ‰¾ locationï¼Œmi_two è¢«ç¡®å®šä¸ºæœ€ç»ˆä½¿ç”¨çš„ location</p>
</li>
</ol>
<p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$         http:&#x2F;&#x2F;www.mi.com&#x2F;$1;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;www.mi.com&#x2F;mi_one&#x2F;hello</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š<br>åŒ¹é…ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œç”±äº replacement æ˜¯ä»¥ http:// å¼€å§‹çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ rewrite æŒ‡ä»¤ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ 302ï¼Œå¹¶ä¸”åœæ­¢åŒ¹é…åç»­çš„ rewriteã€‚</p>
<h3 id="2-flag-æŒ‡å®šä¸º-redirect"><a href="#2-flag-æŒ‡å®šä¸º-redirect" class="headerlink" title="2.flag æŒ‡å®šä¸º redirect"></a>2.flag æŒ‡å®šä¸º redirect</h3><p>æŒ‡å®š flag ä¸º redirect æ—¶ï¼Œrewrite åŒ¹é…æˆåŠŸåç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ 302ï¼Œä¸ä¼šç»§ç»­åŒ¹é…åç»­çš„ rewriteã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$         &#x2F;mi_one&#x2F;$1 redirect;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1;</span><br><span class="line">    rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;mi_three&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_zero&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;mi_zero&#x2F;hello</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;mi_one&#x2F;hello</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_two&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;mi_two&#x2F;hello</span><br></pre></td></tr></table></figure>


<p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1;</span><br><span class="line">    rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;mi_three&#x2F;$1 redirect;</span><br><span class="line">    rewrite ^&#x2F;(.*)$         &#x2F;mi_one&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;localhost&#x2F;mi_three&#x2F;hello</span><br><span class="line"></span><br><span class="line">$ curl -I http:&#x2F;&#x2F;localhost&#x2F;mi_two&#x2F;hello</span><br><span class="line">http code: 302</span><br><span class="line">Location: http:&#x2F;&#x2F;localhost&#x2F;mi_three&#x2F;hello</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;mi_zero&#x2F;hello</span><br><span class="line">This is mi_one location</span><br></pre></td></tr></table></figure>
<h3 id="3-flag-æŒ‡å®šä¸º-permanent"><a href="#3-flag-æŒ‡å®šä¸º-permanent" class="headerlink" title="3.flag æŒ‡å®šä¸º permanent"></a>3.flag æŒ‡å®šä¸º permanent</h3><p>æŒ‡å®š flag=permanent æ—¶ï¼Œä¸ redirect æ•ˆæœç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ« http code è¿”å› 301ã€‚</p>
<h3 id="4-flag-æŒ‡å®šä¸º-last"><a href="#4-flag-æŒ‡å®šä¸º-last" class="headerlink" title="4.flag æŒ‡å®šä¸º last"></a>4.flag æŒ‡å®šä¸º last</h3><p>rewrite çš„ last å’Œ break è¿™ä¸¤ä¸ª flag ä½¿ç”¨åœºæ™¯å¾ˆå¤šå¹¶ä¸”ä¹Ÿå¾ˆå®¹æ˜“æ··æ·†ï¼Œä»–ä»¬çš„å…±åŒç‚¹éƒ½ä¼šåœæ­¢å½“å‰å±‚çº§åç»­çš„ rewrite åŒ¹é…ï¼ŒåŒºåˆ«éœ€è¦åˆ†ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§ä½¿ç”¨åœ¨ server block ä¸­ï¼Œlast å’Œ break æ²¡æœ‰åŒºåˆ«ã€‚ç¬¬äºŒç§ä½¿ç”¨åœ¨ location block ä¸­ï¼Œlast ä¼šæ ¹æ®æ”¹å†™çš„ uri é‡æ–°æŸ¥æ‰¾ locationï¼Œbreak ä¸ä¼šé‡æ–°æŸ¥æ‰¾ locationï¼Œè€Œæ˜¯åœ¨å½“å‰ location ä¸­æ‰§è¡Œåç»­çš„æŒ‡ä»¤ã€‚ï¼ˆæ³¨ï¼šlast å’Œ break ä¸ä»…åœæ­¢ rewrite çš„åŒ¹é…ï¼ŒåŒæ—¶è¿˜ä¼šåœæ­¢ Nginx rewrite æ¨¡å—ä¸­å…¶ä»–æŒ‡ä»¤çš„æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šsetã€return æŒ‡ä»¤)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1 last;</span><br><span class="line">    rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;mi_three&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello</span><br><span class="line">This is mi_two location</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>åŒ¹é…ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_two/helloï¼Œç”±äº flag æŒ‡å®šä¸º last ä¼šåœæ­¢åç»­çš„ rewrite çš„åŒ¹é…ï¼ˆä»…åœæ­¢ server block ä¸­çš„ rewrite åŒ¹é…ï¼‰ï¼Œæ‰€ä»¥ä¼šæ ¹æ®æ”¹å†™çš„ uri æŸ¥æ‰¾ location</li>
</ol>
<p>å†æ¥çœ‹ä¸€ä¸ª last åœ¨ location block ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$  &#x2F;mi_one&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;(.*)$             &#x2F;mi_three&#x2F;$1 last;</span><br><span class="line">        rewrite ^&#x2F;mi_three&#x2F;(.*)$    &#x2F;;        </span><br><span class="line">        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;hello</span><br><span class="line">This is mi_three location</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>åŒ¹é… server block ä¸­ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_one/hello</p>
</li>
<li><p>æŸ¥æ‰¾ locationï¼Œmi_one è¢«ç¡®å®šä¸ºä½¿ç”¨çš„ location</p>
</li>
<li><p>åŒ¹é… location block ä¸­çš„ rewriteï¼Œlocation ä¸­çš„ç¬¬ä¸€æ¡ rewrite åŒ¹é…æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_three/mi_one/helloï¼Œç”±äº flag æŒ‡å®šä¸º lastï¼Œæ‰€ä»¥åœæ­¢ location ä¸­åç»­çš„ rewrite åŒ¹é…ï¼Œæ­¤æ—¶å†æ ¹æ® uri=/mi_three/mi_one/hello æŸ¥æ‰¾ locationï¼Œæœ€ç»ˆ mi_three è¢«ç¡®å®šä¸ºä½¿ç”¨çš„ location</p>
</li>
</ol>
<h3 id="5-flag-æŒ‡å®šä¸º-break"><a href="#5-flag-æŒ‡å®šä¸º-break" class="headerlink" title="5.flag æŒ‡å®šä¸º break"></a>5.flag æŒ‡å®šä¸º break</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;mi_one&#x2F;(.*)$  &#x2F;mi_two&#x2F;$1 break;</span><br><span class="line">    rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;mi_three&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;mi_one&#x2F;hello</span><br><span class="line">This is mi_two location</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ol>
<li><p>åŒ¹é… server block ä¸­ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_two/helloï¼Œç”±äº flag æŒ‡å®šä¸º break æ‰€ä»¥ä¼šåœæ­¢ server block ä¸­åç»­çš„ rewrite åŒ¹é…ï¼Œæ ¹æ® uri=/mi_two/hello æŸ¥æ‰¾ locationï¼Œæœ€ç»ˆ mi_two è¢«ç¡®å®šä¸ºä½¿ç”¨çš„ location</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    rewrite ^&#x2F;(.*)$  &#x2F;mi_one&#x2F;$1;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;        </span><br><span class="line">        echo &quot;This is default location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_one&#x2F; &#123;</span><br><span class="line">        rewrite ^&#x2F;(.*)$         &#x2F;mi_three&#x2F;$1 break;</span><br><span class="line">        rewrite ^&#x2F;mi_two&#x2F;(.*)$  &#x2F;;        </span><br><span class="line">        </span><br><span class="line">        echo &quot;This is mi_one location&quot;;        </span><br><span class="line">        echo &quot;uri: $&#123;uri&#125;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_two&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_two location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location &#x2F;mi_three&#x2F; &#123;        </span><br><span class="line">        echo &quot;This is mi_three location&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost&#x2F;hello</span><br><span class="line">This is mi_one location</span><br><span class="line">uri: &#x2F;mi_three&#x2F;mi_one&#x2F;hello</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
</li>
<li><p>åŒ¹é… server block ä¸­ç¬¬ä¸€æ¡ rewrite æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_one/hello</p>
</li>
<li><p>æ ¹æ® uri=/mi_one/hello æŸ¥æ‰¾ locationï¼Œmi_one è¢«ç¡®å®šä¸ºä½¿ç”¨çš„ location</p>
</li>
<li><p>åŒ¹é… location block ä¸­çš„ rewriteï¼Œlocation ä¸­çš„ç¬¬ä¸€æ¡ rewrite åŒ¹é…æˆåŠŸï¼Œuri è¢«æ”¹å†™ä¸º / mi_three/mi_one/helloï¼Œç”±äº flag æŒ‡å®šä¸º breakï¼Œæ‰€ä»¥åœæ­¢ location ä¸­åç»­çš„ rewrite åŒ¹é…ï¼Œå¹¶ä¸”æŠŠå½“å‰ location ä½œä¸ºæœ€ç»ˆä½¿ç”¨çš„ locationï¼Œä¸ä¼šé‡æ–°æŸ¥æ‰¾ locationï¼ˆlast ä¼šç»§ç»­æŸ¥æ‰¾ locationï¼‰</p>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨ Nginx çš„é…ç½®ä¸­å¯ä»¥å®ç°ç®€å•çš„ç¼–ç¨‹ï¼Œç†è§£èµ·æ¥ç›¸å¯¹æœ‰ç‚¹éš¾åº¦ï¼Œé€šè¿‡é˜…è¯»æ­¤æ–‡å¸Œæœ›èƒ½å¯¹ä½ æœ‰äº›å¯å‘ï¼Œèƒ½å¤Ÿæ ¹æ®é¡¹ç›®éœ€æ±‚å¯ä»¥é…ç½®æ›´å¤æ‚çš„ rewrite è§„åˆ™ã€‚æƒ³è¦æ›´æ·±å…¥çš„ç†è§£ rewriteï¼Œè¿˜éœ€è¦å¤§å®¶è‡ªå·±åŠ¨æ‰‹å®è·µã€‚</p>
<h2 id="FYI"><a href="#FYI" class="headerlink" title="FYI"></a>FYI</h2><p><a href="https://github.com/agile6v/awesome-nginx" target="_blank" rel="noopener">https://github.com/agile6v/awesome-nginx</a></p>
<p><a href="http://nginx.org/en/docs/http/ngx_http_rewrite_module.html" target="_blank" rel="noopener">http://nginx.org/en/docs/http/ngx_http_rewrite_module.html</a></p>
<p><a href="https://www.nginx.com/blog/creating-nginx-rewrite-rules/" target="_blank" rel="noopener">https://www.nginx.com/blog/creating-nginx-rewrite-rules/</a></p>
<p><a href="https://www.nginx.com/blog/converting-apache-to-nginx-rewrite-rules" target="_blank" rel="noopener">https://www.nginx.com/blog/converting-apache-to-nginx-rewrite-rules</a></p>
<p><a href="http://www.thegeekstuff.com/2017/08/nginx-rewrite-examples/" target="_blank" rel="noopener">http://www.thegeekstuff.com/2017/08/nginx-rewrite-examples/</a></p>
<p><a href="http://winginx.com/en/htaccess" target="_blank" rel="noopener">http://winginx.com/en/htaccess</a></p>
<p><a href="https://w3techs.com/technologies/overview/web_server/all" target="_blank" rel="noopener">https://w3techs.com/technologies/overview/web_server/all</a></p>
<p><a href="http://nginx.org/en/docs/dev/development_guide.html#httpphases" target="_blank" rel="noopener">http://nginx.org/en/docs/dev/development_guide.html#httpphases</a></p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåç«¯å¼€å‘é¢è¯•æ€»ç»“</title>
    <url>/2020/04/20/Python%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h2 id="Pythonåç«¯å¼€å‘é¢è¯•æ€»ç»“"><a href="#Pythonåç«¯å¼€å‘é¢è¯•æ€»ç»“" class="headerlink" title="Pythonåç«¯å¼€å‘é¢è¯•æ€»ç»“"></a>Pythonåç«¯å¼€å‘é¢è¯•æ€»ç»“</h2><h3 id="1-iså’Œ-çš„åŒºåˆ«ï¼Ÿ"><a href="#1-iså’Œ-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="1. iså’Œ==çš„åŒºåˆ«ï¼Ÿ"></a>1. iså’Œ==çš„åŒºåˆ«ï¼Ÿ</h3><p>isåˆ¤æ–­ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œå³å†…å­˜idæ˜¯å¦ç›¸ç­‰ï¼Œ==åˆ™æ˜¯è°ƒç”¨çš„<strong>eq</strong>æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯ç”¨äºåˆ¤æ–­å€¼æ˜¯å¦ç›¸ç­‰ï¼Œä¹Ÿå¯ä»¥é‡å†™<strong>eq</strong>æ–¹æ³•å®ç°æƒ³è¦çš„æ•ˆæœã€‚</p>
<h3 id="2-dictä¸listçš„æŸ¥æ‰¾å¤æ‚åº¦ï¼Ÿ"><a href="#2-dictä¸listçš„æŸ¥æ‰¾å¤æ‚åº¦ï¼Ÿ" class="headerlink" title="2. dictä¸listçš„æŸ¥æ‰¾å¤æ‚åº¦ï¼Ÿ"></a>2. dictä¸listçš„æŸ¥æ‰¾å¤æ‚åº¦ï¼Ÿ</h3><p>dictç”¨hashå®ç°ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œliståˆ™ä¸ºO(n)ã€‚</p>
<h3 id="3-a-b-cä¸‰ä¸ªè£…é¥°å™¨ä¾æ¬¡è£…é¥°å‡½æ•°fun-ï¼Œè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ"><a href="#3-a-b-cä¸‰ä¸ªè£…é¥°å™¨ä¾æ¬¡è£…é¥°å‡½æ•°fun-ï¼Œè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ" class="headerlink" title="3. a/b/cä¸‰ä¸ªè£…é¥°å™¨ä¾æ¬¡è£…é¥°å‡½æ•°fun()ï¼Œè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ"></a>3. a/b/cä¸‰ä¸ªè£…é¥°å™¨ä¾æ¬¡è£…é¥°å‡½æ•°fun()ï¼Œè£…é¥°å™¨çš„æ‰§è¡Œé¡ºåºï¼Ÿ</h3><p>æ³¨æ„è£…é¥°å™¨å‡½æ•°æœ¬èº«ä¸€èˆ¬æœ‰ä¸¤å±‚ï¼Œåœ¨è£…é¥°çš„æ—¶å€™å¤–å±‚å’Œå†…å±‚é¡ºåºæ˜¯ç›¸åçš„ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒè¿™è¾¹æ–‡ç« python å¤šä¸ªè£…é¥°å™¨çš„è°ƒç”¨é¡ºåºã€‚</p>
<h3 id="4-å¦‚ä½•è¿è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Ÿ"><a href="#4-å¦‚ä½•è¿è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Ÿ" class="headerlink" title="4. å¦‚ä½•è¿è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Ÿ"></a>4. å¦‚ä½•è¿è¡Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼Ÿ</h3><p>evalå’Œexecã€‚</p>
<h2 id="5-Pythonå¤šçº¿ç¨‹èƒ½å¦å……åˆ†åˆ©ç”¨CPUå¤šæ ¸å¿ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿ"><a href="#5-Pythonå¤šçº¿ç¨‹èƒ½å¦å……åˆ†åˆ©ç”¨CPUå¤šæ ¸å¿ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="5. Pythonå¤šçº¿ç¨‹èƒ½å¦å……åˆ†åˆ©ç”¨CPUå¤šæ ¸å¿ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿ"></a>5. Pythonå¤šçº¿ç¨‹èƒ½å¦å……åˆ†åˆ©ç”¨CPUå¤šæ ¸å¿ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿ</h2><p>è¿™é‡Œå›ç­”çš„æ˜¯GILç›¸å…³çš„ä¸œè¥¿ï¼Œå¯æ·±å¯æµ…ï¼Œè‡ªå·±æŠŠæ¡~</p>
<h3 id="6-ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ"><a href="#6-ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="6. ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ"></a>6. ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿå¦‚ä½•å®ç°ï¼Ÿ</h3><p>å¹¿æ³›æ„ä¹‰ä¸Šæ¥è¯´ï¼Œä¸Šä¸‹æ–‡æ˜¯æŒ‡ç¨‹åºè¿è¡Œçš„ç¯å¢ƒï¼ŒPythonä¸­å¸¸è§äºæ‰“å¼€æ–‡ä»¶æˆ–ç½‘ç»œè¿æ¥ï¼Œå…¶å®å°±æ˜¯withå…³é”®å­—ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&quot;test.txt&quot;) as file:  </span><br><span class="line">Â  Â  print(file.read())</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç¡®ä¿æ–‡ä»¶åœ¨æœ€åä¼šè¢«å…³é—­ï¼Œåªè¦å¯¹ä¸€ä¸ªå¯¹è±¡å®ç°äº†<strong>enter</strong>å’Œ<strong>exit</strong>å‡½æ•°ï¼Œå°±å¯ä»¥æ„é€ è‡ªå·±çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨äº†</p>
<h3 id="7-åŒæ­¥-å¼‚æ­¥-é˜»å¡-éé˜»å¡éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-åŒæ­¥-å¼‚æ­¥-é˜»å¡-éé˜»å¡éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7. åŒæ­¥/å¼‚æ­¥/é˜»å¡/éé˜»å¡éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7. åŒæ­¥/å¼‚æ­¥/é˜»å¡/éé˜»å¡éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>æ„Ÿè§‰ç›´æ¥è§£é‡Šæ¦‚å¿µä¸å¥½è§£é‡Šï¼Œè¿™é‡Œæˆ‘å›ç­”çš„æ€è·¯æ˜¯ä¸¾ä¾‹å­ï¼Œå¼‚æ­¥è¯´ç™½äº†å°±æ˜¯ä»»åŠ¡ä¸éœ€è¦åŒæ­¥è¿›è¡Œï¼Œæ¯”å¦‚ç”¨çˆ¬è™«çˆ¬å–ä¸€ä¸ªæ•°æ®ï¼Œç„¶åå†ä¿å­˜æ•°æ®ï¼Œæ¥ä¸‹æ¥å†å»çˆ¬å¦ä¸€ä¸ªæ•°æ®ï¼Œè¿™æ˜¯åŒæ­¥ï¼›å¼‚æ­¥å°±æ˜¯çˆ¬è™«ä¸ç”¨ç­‰ç€æ•°æ®ä¿å­˜å¥½ï¼Œçˆ¬å®Œä¸€ä¸ªç›´æ¥å»çˆ¬å¦ä¸€ä¸ªï¼Œæ•°æ®ä¿å­˜çš„äº‹æƒ…äº¤ç»™åˆ«çš„é€»è¾‘å»æ…¢æ…¢å¤„ç†ï¼›é˜»å¡å’Œéé˜»å¡ä¹Ÿæ˜¯åŸºäºæ­¤çš„ï¼ŒåŒæ­¥çš„æƒ…å†µä¸‹ä¼šé˜»å¡çˆ¬è™«ï¼Œçˆ¬è™«éœ€è¦ç­‰å¾…æ•°æ®çš„ä¿å­˜.(éä¸“ä¸šè§£é‡Š)</p>
<h3 id="8-å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼Ÿ"><a href="#8-å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼Ÿ" class="headerlink" title="8. å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼Ÿ"></a>8. å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦ç›¸ç­‰ï¼Ÿ</h3><p>ä¹‹å‰å®Œå…¨æ²¡æƒ³è¿‡è¿™ä¸ªçš„é—®é¢˜ï¼Œæˆ‘çš„å›ç­”å°±æ˜¯æŒ‰ä¸€ä¸ªå·®ä¸å¤šçš„ç²¾åº¦å»æ¯”è¾ƒï¼Œæ¯”å¦‚åˆ°å°æ•°ç‚¹ç¬¬å‡ ä½ä¹‹å‰éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œå°±è®¤ä¸ºä¸¤ä¸ªæ•°ç›¸ç­‰ï¼Œæˆ–è€…Mathæ¨¡å—é‡Œå¯èƒ½æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å»ç²¾ç¡®å¯¹æ¯”ï¼Œå½“æ—¶æ˜¯è¿™ä¹ˆå›ç­”çš„ï¼Œç°åœ¨æŸ¥äº†ä¸€ä¸‹åŸºæœ¬ä¹Ÿæ˜¯è¿™ä¸ªæ€è·¯ï¼ŒMathæ¨¡å—ä¸­æœ‰ä¸€ä¸ªiscloseå‡½æ•°ç”¨æ¥åˆ¤æ–­ä¸¤ä¸ªæµ®ç‚¹æ•°çš„å€¼æ˜¯å¦æ¥è¿‘æˆ–ç›¸ç­‰.</p>
<h3 id="9-MySQLçš„ç´¢å¼•ä¸€èˆ¬æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#9-MySQLçš„ç´¢å¼•ä¸€èˆ¬æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="9. MySQLçš„ç´¢å¼•ä¸€èˆ¬æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>9. MySQLçš„ç´¢å¼•ä¸€èˆ¬æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h3><p>B-Tree(ä¸€èˆ¬æ˜¯B+Tree)å’ŒHashï¼Œç„¶åå†ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h3 id="10-å¯¹äºFlaskçš„å®ç°æœ‰äº†è§£å—ï¼Ÿ"><a href="#10-å¯¹äºFlaskçš„å®ç°æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="10. å¯¹äºFlaskçš„å®ç°æœ‰äº†è§£å—ï¼Ÿ"></a>10. å¯¹äºFlaskçš„å®ç°æœ‰äº†è§£å—ï¼Ÿ</h3><p>åªçŸ¥é“WSGIï¼Œå…¶ä½™çš„ä¸æ¸…æ¥šï¼Œæš‚æ—¶è¿˜æ²¡å»æ·±å…¥çœ‹Flaskçš„æºç ã€‚</p>
<h2 id="Part-äºŒ"><a href="#Part-äºŒ" class="headerlink" title="Part äºŒ"></a>Part äºŒ</h2><h4 id="1-ä¸€ä¸ªæœ¨æ£ä»»æ„æˆªæˆä¸‰æ®µï¼Œå›´æˆä¸‰è§’å½¢çš„æ¦‚ç‡ï¼Ÿ"><a href="#1-ä¸€ä¸ªæœ¨æ£ä»»æ„æˆªæˆä¸‰æ®µï¼Œå›´æˆä¸‰è§’å½¢çš„æ¦‚ç‡ï¼Ÿ" class="headerlink" title="1. ä¸€ä¸ªæœ¨æ£ä»»æ„æˆªæˆä¸‰æ®µï¼Œå›´æˆä¸‰è§’å½¢çš„æ¦‚ç‡ï¼Ÿ"></a>1. ä¸€ä¸ªæœ¨æ£ä»»æ„æˆªæˆä¸‰æ®µï¼Œå›´æˆä¸‰è§’å½¢çš„æ¦‚ç‡ï¼Ÿ</h4><p>å’©å’©å’©ï¼Ÿä¸çŸ¥é“ã€‚ï¼ˆå›æ¥æŸ¥äº†æ˜¯25%ï¼Œå…·ä½“å¯ä»¥è‡ªè¡Œæœç´¢ï¼Œåæ­£è„±ç¦»æ•°å­¦Nå¹´æ˜¯æ— è®ºå¦‚ä½•éƒ½æƒ³ä¸å‡ºæ¥çš„ï¼‰ã€‚</p>
<h4 id="2-ä¸€ä¸ªå‡½æ•°RAND7-éšæœºè¿”å›1-7ï¼Œä½¿ç”¨å®ƒæ„é€ ä¸€ä¸ªRAND10-å‡½æ•°éšæœºè¿”å›10ã€‚"><a href="#2-ä¸€ä¸ªå‡½æ•°RAND7-éšæœºè¿”å›1-7ï¼Œä½¿ç”¨å®ƒæ„é€ ä¸€ä¸ªRAND10-å‡½æ•°éšæœºè¿”å›10ã€‚" class="headerlink" title="2. ä¸€ä¸ªå‡½æ•°RAND7()éšæœºè¿”å›1~7ï¼Œä½¿ç”¨å®ƒæ„é€ ä¸€ä¸ªRAND10()å‡½æ•°éšæœºè¿”å›10ã€‚"></a>2. ä¸€ä¸ªå‡½æ•°RAND7()éšæœºè¿”å›1~7ï¼Œä½¿ç”¨å®ƒæ„é€ ä¸€ä¸ªRAND10()å‡½æ•°éšæœºè¿”å›10ã€‚</h4><p>ä¸€å¼€å§‹å†™äº†ä¸ªå‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def rand10():  </span><br><span class="line">a &#x3D; rand7() + 3&#x2F;10  </span><br><span class="line">b &#x3D; rand7() - 4  </span><br><span class="line">if b &lt; 0:  </span><br><span class="line">b &#x3D; 0  </span><br><span class="line">return a + b</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿæ˜¯è„‘è¢‹æŠ½äº†ï¼Œæƒ³å¾—å¤ªç®€å•ï¼Œè¿™ä¸ªrand10è™½ç„¶èƒ½è¿”å›1~10çš„éšæœºæ•°ï¼Œä½†æ¯ä¸ªæ•°å‡ºç°çš„æ¦‚ç‡ä¸æ˜¯1/10ï¼Œåé¢æ—¶é—´å¿«åˆ°äº†æ£€æŸ¥çš„æ—¶å€™æ‰ååº”è¿‡æ¥ã€‚æ­£ç¡®çš„æ€è·¯æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def rand10():  </span><br><span class="line">while  1:  </span><br><span class="line">Â  Â  Â  Â res &#x3D; (rand7()-1)*7+rand7() Â  Â \# resç­‰æ¦‚ç‡éšæœº1~49  </span><br><span class="line">if res &lt; 40: \# åªå–å‡º0~39å…±40ä¸ªæ•°ï¼Œæ¯ä¸ªæ•°å‡ºç°çš„æ¦‚ç‡ä¹Ÿæ˜¯ç›¸ç­‰çš„  </span><br><span class="line">return res % 10 \+ 1 \# éšæœºè¾“å‡º1~10</span><br></pre></td></tr></table></figure>
<h4 id="3-æŠŠä¸€æ®µJAVAä»£ç æ”¹æˆPythonï¼Œå¹¶å¢åŠ å•å…ƒæµ‹è¯•ã€‚"><a href="#3-æŠŠä¸€æ®µJAVAä»£ç æ”¹æˆPythonï¼Œå¹¶å¢åŠ å•å…ƒæµ‹è¯•ã€‚" class="headerlink" title="3. æŠŠä¸€æ®µJAVAä»£ç æ”¹æˆPythonï¼Œå¹¶å¢åŠ å•å…ƒæµ‹è¯•ã€‚"></a>3. æŠŠä¸€æ®µJAVAä»£ç æ”¹æˆPythonï¼Œå¹¶å¢åŠ å•å…ƒæµ‹è¯•ã€‚</h4><p>JAVAä»£ç æœ¬èº«å¾ˆç®€å•ï¼Œå³ä½¿æ²¡å­¦è¿‡ä¹Ÿèƒ½çœ‹æ‡‚ï¼Œæ”¹åçš„Pythonä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class MyClass:  </span><br><span class="line">__current &#x3D; 0  </span><br><span class="line">def next(self):  </span><br><span class="line">MyClass.__current +&#x3D; 1  </span><br><span class="line">return MyClass.__current</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å¯¹äºå•å…ƒæµ‹è¯•åˆ™ä»…é™äºå¬è¿‡çš„åœ°æ­¥ï¼Œéœ€è¦ç”¨åˆ°unittestï¼Œå¥½åƒä¹Ÿæœ‰åˆ«çš„æ¨¡å—ã€‚</p>
<h4 id="4-ç»™å®šä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‰å¥‡æ•°åœ¨å‰å‡åºï¼Œå¶æ•°åœ¨åé™åºæ’åˆ—ï¼Œä¸€è¡Œä»£ç å®ç°ã€‚"><a href="#4-ç»™å®šä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‰å¥‡æ•°åœ¨å‰å‡åºï¼Œå¶æ•°åœ¨åé™åºæ’åˆ—ï¼Œä¸€è¡Œä»£ç å®ç°ã€‚" class="headerlink" title="4. ç»™å®šä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‰å¥‡æ•°åœ¨å‰å‡åºï¼Œå¶æ•°åœ¨åé™åºæ’åˆ—ï¼Œä¸€è¡Œä»£ç å®ç°ã€‚"></a>4. ç»™å®šä¸€ä¸ªæ•°ç»„ï¼ŒæŒ‰å¥‡æ•°åœ¨å‰å‡åºï¼Œå¶æ•°åœ¨åé™åºæ’åˆ—ï¼Œä¸€è¡Œä»£ç å®ç°ã€‚</h4><p>æ²¡å•¥å¥½è¯´çš„ï¼Œä¸€è¡Œä»£ç å¿…ç„¶æ˜¯åˆ—è¡¨ç”Ÿæˆå¼ï¼Œå‡è®¾æ•°ç»„æ˜¯numsï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sorted(\[n for n in nums if n % 2\]) \+ sorted(\[n for n in nums if  not n % 2\], reverse&#x3D;True)</span><br></pre></td></tr></table></figure>

<h3 id="5-å®ç°å•ä¾‹ã€‚"><a href="#5-å®ç°å•ä¾‹ã€‚" class="headerlink" title="5. å®ç°å•ä¾‹ã€‚"></a>5. å®ç°å•ä¾‹ã€‚</h3><p>å•ä¾‹å°±æ˜¯è¯´ä¸€ä¸ªclassåªèƒ½æœ‰ä¸€ä¸ªinstanceï¼Œå®ç°çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚æ”¹å†™<strong>new</strong>æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singleton(object):  </span><br><span class="line">_instance &#x3D; None  </span><br><span class="line">def \_\_new\_\_(cls, \*args, \*\*kw):  </span><br><span class="line">if  not cls._instance:  </span><br><span class="line">Â  Â  Â  Â  Â  Â cls.\_instance &#x3D; super(Singleton, cls).\_\_new__(cls, \*args, \*\*kw) Â   </span><br><span class="line">return cls._instance</span><br></pre></td></tr></table></figure>
<h4 id="6-æœ‰ä¸€ä¸ªé—®ç­”å¹³å°ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å›ç­”ä¸€æ¬¡ï¼ŒåŒä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å¯¹ä¸€ä¸ªç­”æ¡ˆç‚¹èµï¼›1-è®¾è®¡åˆé€‚çš„æ•°æ®åº“ç»“æ„ï¼›2-å†™å‡ºSQLè·å–ç‚¹èµæ•°æœ€å¤šçš„10ä¸ªé—®é¢˜ï¼›"><a href="#6-æœ‰ä¸€ä¸ªé—®ç­”å¹³å°ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å›ç­”ä¸€æ¬¡ï¼ŒåŒä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å¯¹ä¸€ä¸ªç­”æ¡ˆç‚¹èµï¼›1-è®¾è®¡åˆé€‚çš„æ•°æ®åº“ç»“æ„ï¼›2-å†™å‡ºSQLè·å–ç‚¹èµæ•°æœ€å¤šçš„10ä¸ªé—®é¢˜ï¼›" class="headerlink" title="6. æœ‰ä¸€ä¸ªé—®ç­”å¹³å°ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å›ç­”ä¸€æ¬¡ï¼ŒåŒä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å¯¹ä¸€ä¸ªç­”æ¡ˆç‚¹èµï¼›1)è®¾è®¡åˆé€‚çš„æ•°æ®åº“ç»“æ„ï¼›2)å†™å‡ºSQLè·å–ç‚¹èµæ•°æœ€å¤šçš„10ä¸ªé—®é¢˜ï¼›"></a>6. æœ‰ä¸€ä¸ªé—®ç­”å¹³å°ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹ä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å›ç­”ä¸€æ¬¡ï¼ŒåŒä¸€ä¸ªé—®é¢˜æœ€å¤šåªèƒ½å¯¹ä¸€ä¸ªç­”æ¡ˆç‚¹èµï¼›1)è®¾è®¡åˆé€‚çš„æ•°æ®åº“ç»“æ„ï¼›2)å†™å‡ºSQLè·å–ç‚¹èµæ•°æœ€å¤šçš„10ä¸ªé—®é¢˜ï¼›</h4><p>æˆ‘å¹³æ—¶ä¹Ÿå°±ç”¨æ•°æ®åº“æŸ¥æ•°æ®ï¼Œåœ¨è®¾è®¡æ•°æ®åº“ä¸Šæ²¡æœ‰æ·±å…¥ç ”ç©¶ï¼Œå› æ­¤çš„æˆ‘ç­”æ¡ˆå°±ç®€å•å†™äº†æœ‰å“ªäº›è¡¨ï¼Œå­—æ®µåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œè‡³äºé¢˜ä¸­çš„æ¡ä»¶é™åˆ¶ï¼Œå°±äº¤ç”±åå°çš„ç¨‹åºé€»è¾‘å»å¤„ç†ï¼Œè€Œä¸æ˜¯åœ¨æ•°æ®åº“è®¾è®¡å±‚é¢å»é™åˆ¶ã€‚å› ä¸ºæ˜¯è‡ªå·±è®¾è®¡çš„è¡¨ç»“æ„ï¼ŒSQLæœ¬èº«ä¹Ÿå°±ä¸éš¾ã€‚</p>
<h4 id="7-è®¾è®¡ä¸€ä¸ªæ ˆï¼Œå®ç°pop-pushåŠmaxæ–¹æ³•ï¼Œè¦æ±‚èƒ½åœ¨O-1-æ—¶é—´å†…å–å¾—æœ€å¤§å€¼ã€‚"><a href="#7-è®¾è®¡ä¸€ä¸ªæ ˆï¼Œå®ç°pop-pushåŠmaxæ–¹æ³•ï¼Œè¦æ±‚èƒ½åœ¨O-1-æ—¶é—´å†…å–å¾—æœ€å¤§å€¼ã€‚" class="headerlink" title="7. è®¾è®¡ä¸€ä¸ªæ ˆï¼Œå®ç°pop/pushåŠmaxæ–¹æ³•ï¼Œè¦æ±‚èƒ½åœ¨O(1)æ—¶é—´å†…å–å¾—æœ€å¤§å€¼ã€‚"></a>7. è®¾è®¡ä¸€ä¸ªæ ˆï¼Œå®ç°pop/pushåŠmaxæ–¹æ³•ï¼Œè¦æ±‚èƒ½åœ¨O(1)æ—¶é—´å†…å–å¾—æœ€å¤§å€¼ã€‚</h4><p>LeetCodeåŸé¢˜å•Šï¼listæ€ä¹ˆèƒ½O(1)å–å¾—æœ€å¤§å€¼å‘¢ï¼Œæ— éæ˜¯ç©ºé—´æ¢æ—¶é—´ï¼Œæ¯pushä¸€ä¸ªæ•°å°±åŒæ—¶è®°å½•å½“å‰çš„æœ€å¤§å€¼ã€‚</p>
<h4 id="8-æ‰‹å†™å¿«æ’ã€‚"><a href="#8-æ‰‹å†™å¿«æ’ã€‚" class="headerlink" title="8. æ‰‹å†™å¿«æ’ã€‚"></a>8. æ‰‹å†™å¿«æ’ã€‚</h4><p>å‘µå‘µã€‚</p>
<h2 id="å…¶ä»–é’ˆå¯¹ç®€å†çš„æé—®"><a href="#å…¶ä»–é’ˆå¯¹ç®€å†çš„æé—®" class="headerlink" title="å…¶ä»–é’ˆå¯¹ç®€å†çš„æé—®"></a>å…¶ä»–é’ˆå¯¹ç®€å†çš„æé—®</h2><h4 id="1-ä½ çš„ç½‘ç«™ï¼Œä½ è§‰å¾—å¦‚æœè®¿é—®é‡ä¸Šå»äº†ï¼Œæœ€å…ˆå‡ºç°ç“¶é¢ˆé—®é¢˜çš„ç‚¹æ˜¯å“ªï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ"><a href="#1-ä½ çš„ç½‘ç«™ï¼Œä½ è§‰å¾—å¦‚æœè®¿é—®é‡ä¸Šå»äº†ï¼Œæœ€å…ˆå‡ºç°ç“¶é¢ˆé—®é¢˜çš„ç‚¹æ˜¯å“ªï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ" class="headerlink" title="1. ä½ çš„ç½‘ç«™ï¼Œä½ è§‰å¾—å¦‚æœè®¿é—®é‡ä¸Šå»äº†ï¼Œæœ€å…ˆå‡ºç°ç“¶é¢ˆé—®é¢˜çš„ç‚¹æ˜¯å“ªï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ"></a>1. ä½ çš„ç½‘ç«™ï¼Œä½ è§‰å¾—å¦‚æœè®¿é—®é‡ä¸Šå»äº†ï¼Œæœ€å…ˆå‡ºç°ç“¶é¢ˆé—®é¢˜çš„ç‚¹æ˜¯å“ªï¼Ÿæ€ä¹ˆä¼˜åŒ–ï¼Ÿ</h4><p>æˆ‘ç­”çš„æ˜¯æ•°æ®åº“ï¼Œå› ä¸ºå¥½å¤šä¸å¿…è¦æˆ–è€…å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„åœ°æ–¹ä¹Ÿé¢‘ç¹æ“ä½œæ•°æ®åº“ï¼Œè€Œä¸”æ˜¯ä½¿ç”¨çš„ORMï¼Œä½†ä¹‹å‰ä»å“ªçœ‹åˆ°ORMä¸èƒ½ç¡®ä¿å¯¹åº”çš„SQLè¯­å¥æ˜¯æœ€ä¼˜çš„ï¼Œå› æ­¤å¯ä»¥å°è¯•ä½¿ç”¨åŸç”ŸSQLæˆ–è€…å¢åŠ Redisç¼“å­˜ã€‚</p>
<h3 id="2-å¦‚æœè¦æ‰©å±•åå°æœåŠ¡å™¨ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ"><a href="#2-å¦‚æœè¦æ‰©å±•åå°æœåŠ¡å™¨ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ" class="headerlink" title="2. å¦‚æœè¦æ‰©å±•åå°æœåŠ¡å™¨ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ"></a>2. å¦‚æœè¦æ‰©å±•åå°æœåŠ¡å™¨ï¼Œéœ€è¦æ€ä¹ˆåšï¼Ÿ</h3><p>(è¯è¯´è¿™ä¸æ˜¯è¿ç»´çš„å·¥ä½œä¹ˆã€‚ã€‚ã€‚)å‘ƒï¼Œå°±æ˜¯å¢åŠ æœåŠ¡å™¨å•Šï¼Œç„¶åå‰é¢åŠ ä¸€å±‚è´Ÿè½½å‡è¡¡ï¼ŒæŠŠè¯·æ±‚åˆ†é…ç»™ä¸åŒçš„æœåŠ¡å™¨.(é‚£ä¸åŒçš„æœåŠ¡å™¨æ€ä¹ˆä½¿ç”¨ä½ çš„Sessionï¼Ÿ)å†åŠ ä¸ªSessionæœåŠ¡å™¨ã€‚</p>
<h3 id="3-æˆ‘çœ‹ä½ å¹³æ—¶åˆ·ç¼–ç¨‹é¢˜ï¼Œæœ‰é‡åˆ°ä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ç›®å—ï¼Ÿ"><a href="#3-æˆ‘çœ‹ä½ å¹³æ—¶åˆ·ç¼–ç¨‹é¢˜ï¼Œæœ‰é‡åˆ°ä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ç›®å—ï¼Ÿ" class="headerlink" title="3. æˆ‘çœ‹ä½ å¹³æ—¶åˆ·ç¼–ç¨‹é¢˜ï¼Œæœ‰é‡åˆ°ä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ç›®å—ï¼Ÿ"></a>3. æˆ‘çœ‹ä½ å¹³æ—¶åˆ·ç¼–ç¨‹é¢˜ï¼Œæœ‰é‡åˆ°ä»€ä¹ˆæœ‰æ„æ€çš„é¢˜ç›®å—ï¼Ÿ</h3><p>LeetCodeæ‰å¼€å§‹åˆ·ï¼Œå°±ä¸¾äº†ä¸¤é“Codewarsä¸Šçš„é¢˜ç›®ï¼Œæˆ‘ä¹ŸçœŸæ˜¯å‚»äº†ï¼ŒçœŸçš„ä¸¾äº†ä¸¤é“æœ‰æ„æ€(ä½†è‡ªå·±æ²¡åšå¥½)çš„é¢˜ã€‚</p>
<p>å…¶ä»–å°±æ— éæ˜¯ä¸€äº›ä¸ºä»€ä¹ˆæƒ³åšåç«¯å¼€å‘ä¹‹ç±»çš„é—®é¢˜äº†ï¼Œä¸ªäººæ„Ÿè§‰é¢˜ç›®å¤§éƒ¨åˆ†ä¹ŸæŒºç®€å•çš„ï¼Œæˆ‘çš„è¡¨ç°ä¹Ÿç®—ä¸­è§„ä¸­çŸ©å§ï¼Œä½†é¢è¯•å®˜è¯´æˆ‘è¦è¿›ä¸€æ­¥åŠ å¼ºåŸºç¡€çŸ¥è¯†ï¼Œå…·ä½“å“ªæ–¹é¢(æ•°æ®åº“ã€ç½‘ç»œåè®®ã€è¿˜æ˜¯Pythonæœ¬èº«)åˆè¯­ç„‰ä¸è¯¦ã€‚</p>
<p><a href="https://mp.weixin.qq.com/s/ULeyIN825L59LF9-CHocKg" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>PythonåŸºäºåˆ—è¡¨å®ç°æ•°æ®ç»“æ„æ ˆstackå’Œé˜Ÿåˆ—queue</title>
    <url>/2020/04/20/Python%E5%9F%BA%E4%BA%8E%E5%88%97%E8%A1%A8%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%A0%88stack%E5%92%8C%E9%98%9F%E5%88%97queue/</url>
    <content><![CDATA[<h2 id="PythonåŸºäºåˆ—è¡¨å®ç°æ•°æ®ç»“æ„æ ˆstackå’Œé˜Ÿåˆ—queue"><a href="#PythonåŸºäºåˆ—è¡¨å®ç°æ•°æ®ç»“æ„æ ˆstackå’Œé˜Ÿåˆ—queue" class="headerlink" title="PythonåŸºäºåˆ—è¡¨å®ç°æ•°æ®ç»“æ„æ ˆstackå’Œé˜Ÿåˆ—queue"></a>PythonåŸºäºåˆ—è¡¨å®ç°æ•°æ®ç»“æ„æ ˆstackå’Œé˜Ÿåˆ—queue</h2><h3 id="pythonä¸­æ ˆçš„å®ç°"><a href="#pythonä¸­æ ˆçš„å®ç°" class="headerlink" title="pythonä¸­æ ˆçš„å®ç°"></a>pythonä¸­æ ˆçš„å®ç°</h3><p>æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œåªèƒ½åœ¨ä¸€ç«¯ï¼ˆæ ˆé¡¶ï¼‰æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œè€Œpythonä¸­çš„åˆ—è¡¨çš„append()æ–¹æ³•å¯¹åº”çš„å°±æ˜¯å‘æ ˆé¡¶æ·»åŠ å…ƒç´ ï¼Œåˆ—è¡¨çš„pop()æ–¹æ³•å¯¹åº”çš„å°±æ˜¯å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå› æ­¤ï¼Œpythonä¸­çš„åˆ—è¡¨å¯ä»¥ä½œä¸ºæ ˆè¿™ç§æ•°æ®ç»“æ„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; stack &#x3D; [3, 4, 5]</span><br><span class="line">&gt;&gt;&gt; stack.append(6)</span><br><span class="line">&gt;&gt;&gt; stack.append(7)</span><br><span class="line">&gt;&gt;&gt; stack</span><br><span class="line">[3, 4, 5, 6, 7]</span><br><span class="line">&gt;&gt;&gt; stack.pop()</span><br><span class="line">7</span><br><span class="line">&gt;&gt;&gt; stack.pop()</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; stack.pop()</span><br><span class="line">5</span><br><span class="line">&gt;&gt;&gt; stack.pop()</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; stack</span><br><span class="line">[3]</span><br></pre></td></tr></table></figure>

<h3 id="pythonä¸­é˜Ÿåˆ—çš„å®ç°"><a href="#pythonä¸­é˜Ÿåˆ—çš„å®ç°" class="headerlink" title="pythonä¸­é˜Ÿåˆ—çš„å®ç°"></a>pythonä¸­é˜Ÿåˆ—çš„å®ç°</h3><p>é˜Ÿåˆ—æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„æ•°æ®ç»“æ„ï¼Œåœ¨ä¸€ç«¯ï¼ˆé˜Ÿå°¾ï¼‰æ’å…¥å…ƒç´ ï¼Œåœ¨å¦ä¸€ç«¯ï¼ˆé˜Ÿé¦–ï¼‰åˆ é™¤å…ƒç´ ã€‚è€Œå¦‚æœç”¨åˆ—è¡¨å®ç°è¿™ç§æ•°æ®ç»“æ„ä¸æ˜¯å¾ˆé«˜æ•ˆï¼ŒåŸå› åœ¨äºåœ¨åˆ—è¡¨å°¾æ’å…¥å’Œåˆ é™¤å…ƒç´ æ˜¯å¾ˆå¿«çš„ï¼ˆæ—¶é—´å¤æ‚åº¦O(1)ï¼‰ï¼Œè€Œåœ¨åˆ—è¡¨å¤´æ’å…¥å…ƒç´ æ˜¯å¾ˆæ…¢çš„ï¼ˆæ—¶é—´å¤æ‚åº¦O(n)ï¼‰ï¼Œå› ä¸ºåœ¨åˆ—è¡¨å¤´éƒ¨æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œåˆ—è¡¨ä¸­å…¶ä½™æ‰€æœ‰å…ƒç´ éƒ½è¦ç§»åŠ¨ã€‚<br>ä¸ºäº†å®ç°é˜Ÿåˆ—ï¼Œç”¨collections.dequeåŒç«¯é˜Ÿåˆ—ï¼Œå¯ä»¥åœ¨ä¸¤ç«¯å¿«é€Ÿçš„æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼ˆæ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; from collections import deque</span><br><span class="line">&gt;&gt;&gt; queue &#x3D; deque([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;])</span><br><span class="line">&gt;&gt;&gt; queue.append(&#39;D&#39;)</span><br><span class="line">&gt;&gt;&gt; queue.append(&#39;E&#39;)</span><br><span class="line">&gt;&gt;&gt; queue</span><br><span class="line">deque([&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;])</span><br><span class="line">&gt;&gt;&gt; queue.popleft()</span><br><span class="line">&#39;A&#39;</span><br><span class="line">&gt;&gt;&gt; queue.popleft()</span><br><span class="line">&#39;B&#39;</span><br><span class="line">&gt;&gt;&gt; queue.popleft()</span><br><span class="line">&#39;C&#39;</span><br><span class="line">&gt;&gt;&gt; queue.popleft()</span><br><span class="line">&#39;D&#39;</span><br><span class="line">&gt;&gt;&gt; queue</span><br><span class="line">deque([&#39;E&#39;])</span><br></pre></td></tr></table></figure>
<p>åŒç«¯é˜Ÿåˆ—collections.dequeä¹Ÿæ˜¯åŸºäºåˆ—è¡¨å®ç°çš„ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºåŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œåœ¨Pythonä¸­é€šå¸¸æ— éœ€æˆ‘ä»¬è‡ªå·±å®ç°ï¼ŒåŸºäºpythonç°æœ‰çš„å¼ºå¤§çš„æ•°æ®ç±»å‹ï¼Œå¾ˆå®¹æ˜“æ„é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ç»“æ„ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Python ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ</title>
    <url>/2020/04/20/Python-%E4%B8%AD%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<blockquote class="blockquote-center">ä¼˜ç§€çš„äººï¼Œä¸æ˜¯ä¸åˆç¾¤ï¼Œè€Œæ˜¯ä»–ä»¬åˆç¾¤çš„äººé‡Œé¢æ²¡æœ‰ä½ </blockquote>


<h2 id="Python-ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ"><a href="#Python-ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ" class="headerlink" title="Python ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ"></a>Python ä¸­æ›´ä¼˜é›…çš„æ—¥å¿—è®°å½•æ–¹æ¡ˆ</h2><p>åœ¨ Python ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬å¯èƒ½ç›´æ¥ç”¨è‡ªå¸¦çš„ logging æ¨¡å—æ¥è®°å½•æ—¥å¿—ï¼ŒåŒ…æ‹¬æˆ‘ä¹‹å‰çš„æ—¶å€™ä¹Ÿæ˜¯ä¸€æ ·ã€‚åœ¨ä½¿ç”¨æ—¶æˆ‘ä»¬éœ€è¦é…ç½®ä¸€äº› Handlerã€Formatter æ¥è¿›è¡Œä¸€äº›å¤„ç†ï¼Œæ¯”å¦‚æŠŠæ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ä½ç½®ï¼Œæˆ–è€…è®¾ç½®ä¸€ä¸ªä¸åŒçš„è¾“å‡ºæ ¼å¼ï¼Œæˆ–è€…è®¾ç½®æ—¥å¿—åˆ†å—å’Œå¤‡ä»½ã€‚ä½†å…¶å®ä¸ªäººæ„Ÿè§‰ logging ç”¨èµ·æ¥å…¶å®å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½ç”¨ï¼Œå…¶å®ä¸»è¦è¿˜æ˜¯é…ç½®è¾ƒä¸ºç¹ç.</p>
<h2 id="å¸¸è§ä½¿ç”¨"><a href="#å¸¸è§ä½¿ç”¨" class="headerlink" title="å¸¸è§ä½¿ç”¨"></a>å¸¸è§ä½¿ç”¨</h2><p>é¦–å…ˆçœ‹çœ‹ logging å¸¸è§çš„è§£å†³æ–¹æ¡ˆå§ï¼Œæˆ‘ä¸€èˆ¬ä¼šé…ç½®è¾“å‡ºåˆ°æ–‡ä»¶ã€æ§åˆ¶å°å’Œ Elasticsearchã€‚è¾“å‡ºåˆ°æ§åˆ¶å°å°±ä»…ä»…æ˜¯æ–¹ä¾¿ç›´æ¥æŸ¥çœ‹çš„ï¼›è¾“å‡ºåˆ°æ–‡ä»¶æ˜¯æ–¹ä¾¿ç›´æ¥å­˜å‚¨ï¼Œä¿ç•™æ‰€æœ‰å†å²è®°å½•çš„å¤‡ä»½ï¼›è¾“å‡ºåˆ° Elasticsearchï¼Œç›´æ¥å°† Elasticsearch ä½œä¸ºå­˜å‚¨å’Œåˆ†æçš„ä¸­å¿ƒï¼Œä½¿ç”¨ Kibana å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åˆ†æå’ŒæŸ¥çœ‹è¿è¡Œæƒ…å†µã€‚<br>æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘åŸºæœ¬ä¼šå¯¹ logging åšå¦‚ä¸‹çš„å°è£…å†™æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mport logging</span><br><span class="line">import sys</span><br><span class="line">from os import makedirs</span><br><span class="line">from os.path import dirname, exists</span><br><span class="line"></span><br><span class="line">from cmreslogging.handlers import CMRESHandler</span><br><span class="line"></span><br><span class="line">loggers &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">LOG_ENABLED &#x3D; True  # æ˜¯å¦å¼€å¯æ—¥å¿—</span><br><span class="line">LOG_TO_CONSOLE &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">LOG_TO_FILE &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ°æ–‡ä»¶</span><br><span class="line">LOG_TO_ES &#x3D; True  # æ˜¯å¦è¾“å‡ºåˆ° Elasticsearch</span><br><span class="line"></span><br><span class="line">LOG_PATH &#x3D; &#39;.&#x2F;runtime.log&#39;  # æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line">LOG_LEVEL &#x3D; &#39;DEBUG&#39;  # æ—¥å¿—çº§åˆ«</span><br><span class="line">LOG_FORMAT &#x3D; &#39;%(levelname)s - %(asctime)s - process: %(process)d - %(filename)s - %(name)s - %(lineno)d - %(module)s - %(message)s&#39;  # æ¯æ¡æ—¥å¿—è¾“å‡ºæ ¼å¼</span><br><span class="line">ELASTIC_SEARCH_HOST &#x3D; &#39;eshost&#39;  # Elasticsearch Host</span><br><span class="line">ELASTIC_SEARCH_PORT &#x3D; 9200  # Elasticsearch Port</span><br><span class="line">ELASTIC_SEARCH_INDEX &#x3D; &#39;runtime&#39;  # Elasticsearch Index Name</span><br><span class="line">APP_ENVIRONMENT &#x3D; &#39;dev&#39;  # è¿è¡Œç¯å¢ƒï¼Œå¦‚æµ‹è¯•ç¯å¢ƒè¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">def get_logger(name&#x3D;None):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    get logger by name</span><br><span class="line">    :param name: name of logger</span><br><span class="line">    :return: logger</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    global loggers</span><br><span class="line"></span><br><span class="line">    if not name: name &#x3D; __name__</span><br><span class="line"></span><br><span class="line">    if loggers.get(name):</span><br><span class="line">        return loggers.get(name)</span><br><span class="line"></span><br><span class="line">    logger &#x3D; logging.getLogger(name)</span><br><span class="line">    logger.setLevel(LOG_LEVEL)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">    if LOG_ENABLED and LOG_TO_CONSOLE:</span><br><span class="line">        stream_handler &#x3D; logging.StreamHandler(sys.stdout)</span><br><span class="line">        stream_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        stream_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ°æ–‡ä»¶</span><br><span class="line">    if LOG_ENABLED and LOG_TO_FILE:</span><br><span class="line">        # å¦‚æœè·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ—¥å¿—æ–‡ä»¶æ–‡ä»¶å¤¹</span><br><span class="line">        log_dir &#x3D; dirname(log_path)</span><br><span class="line">        if not exists(log_dir): makedirs(log_dir)</span><br><span class="line">        # æ·»åŠ  FileHandler</span><br><span class="line">        file_handler &#x3D; logging.FileHandler(log_path, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line">        file_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        file_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">    # è¾“å‡ºåˆ° Elasticsearch</span><br><span class="line">    if LOG_ENABLED and LOG_TO_ES:</span><br><span class="line">        # æ·»åŠ  CMRESHandler</span><br><span class="line">        es_handler &#x3D; CMRESHandler(hosts&#x3D;[&#123;&#39;host&#39;: ELASTIC_SEARCH_HOST, &#39;port&#39;: ELASTIC_SEARCH_PORT&#125;],</span><br><span class="line">                                  # å¯ä»¥é…ç½®å¯¹åº”çš„è®¤è¯æƒé™</span><br><span class="line">                                  auth_type&#x3D;CMRESHandler.AuthType.NO_AUTH,  </span><br><span class="line">                                  es_index_name&#x3D;ELASTIC_SEARCH_INDEX,</span><br><span class="line">                                  # ä¸€ä¸ªæœˆåˆ†ä¸€ä¸ª Index</span><br><span class="line">                                  index_name_frequency&#x3D;CMRESHandler.IndexNameFrequency.MONTHLY,</span><br><span class="line">                                  # é¢å¤–å¢åŠ ç¯å¢ƒæ ‡è¯†</span><br><span class="line">                                  es_additional_fields&#x3D;&#123;&#39;environment&#39;: APP_ENVIRONMENT&#125;  </span><br><span class="line">                                  )</span><br><span class="line">        es_handler.setLevel(level&#x3D;LOG_LEVEL)</span><br><span class="line">        formatter &#x3D; logging.Formatter(LOG_FORMAT)</span><br><span class="line">        es_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(es_handler)</span><br><span class="line"></span><br><span class="line">    # ä¿å­˜åˆ°å…¨å±€ loggers</span><br><span class="line">    loggers[name] &#x3D; logger</span><br><span class="line">    return logger</span><br></pre></td></tr></table></figure>
<p>å®šä¹‰å®Œäº†æ€ä¹ˆä½¿ç”¨å‘¢ï¼Ÿåªéœ€è¦ä½¿ç”¨å®šä¹‰çš„æ–¹æ³•è·å–ä¸€ä¸ª loggerï¼Œç„¶å log å¯¹åº”çš„å†…å®¹å³å¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger &#x3D; get_logger()</span><br><span class="line">logger.debug(&#39;this is a message&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DEBUG - 2019-10-11 22:27:35,923 - process: 99490 - logger.py - __main__ - 81 - logger - this is a message</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå®šä¹‰çš„åŸºæœ¬å®ç°å§ã€‚é¦–å…ˆè¿™é‡Œä¸€äº›å¸¸é‡æ˜¯ç”¨æ¥å®šä¹‰ <code>logging</code> æ¨¡å—çš„ä¸€äº›åŸºæœ¬å±æ€§çš„ï¼Œæ¯”å¦‚ LOG_ENABLED ä»£è¡¨æ˜¯å¦å¼€å¯æ—¥å¿—åŠŸèƒ½ï¼Œ<code>LOG_TO_E</code>S ä»£è¡¨æ˜¯å¦å°†æ—¥å¿—è¾“å‡ºåˆ° Elasticsearchï¼Œå¦å¤–è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ—¥å¿—åŸºæœ¬é…ç½®ï¼Œå¦‚ <code>LOG_FORMAT</code> é…ç½®äº†æ—¥å¿—æ¯ä¸ªæ¡ç›®è¾“å‡ºçš„åŸºæœ¬æ ¼å¼ï¼Œå¦å¤–è¿˜æœ‰ä¸€äº›è¿æ¥çš„å¿…è¦ä¿¡æ¯ã€‚è¿™äº›å˜é‡å¯ä»¥å’Œè¿è¡Œæ—¶çš„å‘½ä»¤è¡Œæˆ–ç¯å¢ƒå˜é‡å¯¹æ¥èµ·æ¥ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°ä¸€äº›å¼€å…³å’Œé…ç½®çš„æ›´æ¢ã€‚</p>
<p>ç„¶åå®šä¹‰äº†è¿™ä¹ˆä¸€ä¸ª <code>get_logger</code> æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•° nameã€‚é¦–å…ˆè¯¥æ–¹æ³•æ‹¿åˆ° name ä¹‹åï¼Œä¼šåˆ°å…¨å±€çš„ loggers å˜é‡é‡Œé¢æŸ¥æ‰¾ï¼Œloggers å˜é‡æ˜¯ä¸€ä¸ªå…¨å±€å­—å…¸ï¼Œå¦‚æœæœ‰å·²ç»å£°æ˜è¿‡çš„ loggerï¼Œç›´æ¥å°†å…¶è·å–è¿”å›å³å¯ï¼Œä¸ç”¨å†å°†å…¶äºŒæ¬¡åˆå§‹åŒ–ã€‚å¦‚æœ loggers é‡Œé¢æ²¡æœ‰æ‰¾åˆ° name å¯¹åº”çš„ loggerï¼Œé‚£å°±è¿›è¡Œåˆ›å»ºå³å¯ã€‚åˆ›å»º logger ä¹‹åï¼Œå¯ä»¥ä¸ºå…¶æ·»åŠ å„ç§å¯¹åº”çš„ Handlerï¼Œå¦‚è¾“å‡ºåˆ°æ§åˆ¶å°å°±ç”¨ StreamHandlerï¼Œè¾“å‡ºåˆ°æ–‡ä»¶å°±ç”¨ FileHandler æˆ– RotatingFileHandlerï¼Œè¾“å‡ºåˆ° Elasticsearch å°±ç”¨ CMRESHandlerï¼Œåˆ†åˆ«é…ç½®å¥½å¯¹åº”çš„ä¿¡æ¯å³å¯ã€‚</p>
<p>æœ€åå‘¢ï¼Œå°†æ–°å»ºçš„ logger ä¿å­˜åˆ°å…¨å±€çš„ loggers é‡Œé¢å¹¶è¿”å›å³å¯ï¼Œè¿™æ ·å¦‚æœæœ‰åŒåçš„ logger ä¾¿å¯ä»¥ç›´æ¥æŸ¥æ‰¾ loggers ç›´æ¥è¿”å›äº†ã€‚<br>åœ¨è¿™é‡Œä¾èµ–äº†é¢å¤–çš„è¾“å‡ºåˆ° Elasticsearch çš„åŒ…ï¼Œå«åš CMRESHandlerï¼Œå®ƒå¯ä»¥æ”¯æŒå°†æ—¥å¿—è¾“å‡ºåˆ° Elasticsearch é‡Œé¢ï¼Œå¦‚æœè¦ä½¿ç”¨çš„è¯å¯ä»¥å®‰è£…ä¸€ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install CMRESHandler</span><br></pre></td></tr></table></figure>
<p>å…¶ GitHub åœ°å€æ˜¯ï¼š<code>https://github.com/cmanaha/python-elasticsearch-logger</code>ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼å¯ä»¥çœ‹çœ‹å®ƒçš„å®˜æ–¹è¯´æ˜ï¼Œå¦‚é…ç½®è®¤è¯ä¿¡æ¯ï¼Œé…ç½® Index åˆ†éš”ä¿¡æ¯ç­‰ç­‰ã€‚<br>å¥½ï¼Œä¸Šé¢å°±æ˜¯æˆ‘ä¹‹å‰å¸¸ç”¨çš„ logging é…ç½®ï¼Œé€šè¿‡å¦‚ä¸Šçš„é…ç½®ï¼Œæˆ‘å°±å¯ä»¥å®ç°å°† logging è¾“å‡ºåˆ°ä¸‰ä¸ªä½ç½®ï¼Œå¹¶å¯ä»¥å®ç°å¯¹åº”çš„æ•ˆæœã€‚æ¯”å¦‚è¾“å‡ºåˆ° Elasticsearch ä¹‹åï¼Œæˆ‘å°±å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ Kibana æ¥æŸ¥çœ‹å½“å‰è¿è¡Œæƒ…å†µï¼ŒERROR Log çš„æ¯”ä¾‹ç­‰ç­‰.<br>ä¹Ÿå¯ä»¥åœ¨å®ƒçš„åŸºç¡€ä¸Šåšæ›´è¿›ä¸€æ­¥çš„ç»Ÿè®¡åˆ†æ.</p>
<h2 id="loguru"><a href="#loguru" class="headerlink" title="loguru"></a>loguru</h2><p>ä¸Šé¢çš„å®ç°æ–¹å¼å·²ç»æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¯è¡Œçš„é…ç½®æ–¹æ¡ˆäº†ã€‚ç„¶è€Œï¼Œæˆ‘è¿˜æ˜¯ä¼šæ„Ÿè§‰åˆ°æœ‰äº› Handler é…èµ·æ¥éº»çƒ¦ï¼Œå°¤å…¶æ˜¯æ–°å»ºä¸€ä¸ªé¡¹ç›®çš„å¾ˆå¤šæ—¶å€™æ‡’å¾—å»å†™ä¸€äº›é…ç½®ã€‚å³ä½¿æ˜¯ä¸ç”¨ä¸Šæ–‡çš„é…ç½®ï¼Œç”¨æœ€åŸºæœ¬çš„å‡ è¡Œ logging é…ç½®ï¼Œåƒå¦‚ä¸‹çš„é€šç”¨é…ç½®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import logging</span><br><span class="line">logging.basicConfig(level &#x3D; logging.INFO,format &#x3D; &#39;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#39;)</span><br><span class="line">logger &#x3D; logging.getLogger(__name__)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä¹Ÿæ‡’å¾—å»å†™ï¼Œæ„Ÿè§‰å¹¶ä¸æ˜¯ä¸€ä¸ªä¼˜é›…çš„å®ç°æ–¹å¼ã€‚<br>æœ‰éœ€æ±‚å°±æœ‰åŠ¨åŠ›å•Šï¼Œè¿™ä¸ï¼Œå°±æœ‰äººå®ç°äº†è¿™ä¹ˆä¸€ä¸ªåº“ï¼Œå«åš loguruï¼Œå¯ä»¥å°† log çš„é…ç½®å’Œä½¿ç”¨æ›´åŠ ç®€å•å’Œæ–¹ä¾¿ã€‚<br>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒåˆ°åº•æ˜¯æ€ä¹ˆç”¨çš„å§.</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆï¼Œè¿™ä¸ªåº“çš„å®‰è£…æ–¹å¼å¾ˆç®€å•ï¼Œå°±ç”¨åŸºæœ¬çš„ pip å®‰è£…å³å¯ï¼ŒPython 3 ç‰ˆæœ¬çš„å®‰è£…å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install loguru</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®é‡Œä½¿ç”¨è¿™ä¸ª loguru åº“äº†.</p>
<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>é‚£ä¹ˆè¿™ä¸ªåº“æ€ä¹ˆæ¥ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ªå®ä¾‹æ„Ÿå—ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">logger.debug(&#39;this is a debug message&#39;)</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å§ï¼Œä¸éœ€è¦é…ç½®ä»€ä¹ˆä¸œè¥¿ï¼Œç›´æ¥å¼•å…¥ä¸€ä¸ª loggerï¼Œç„¶åè°ƒç”¨å…¶ debug æ–¹æ³•å³å¯ã€‚</p>
<p>åœ¨ loguru é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä¸»è¦å¯¹è±¡ï¼Œé‚£å°±æ˜¯ loggerï¼Œloguru é‡Œé¢æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª loggerï¼Œè€Œä¸”å®ƒå·²ç»è¢«æå‰é…ç½®äº†ä¸€äº›åŸºç¡€ä¿¡æ¯ï¼Œæ¯”å¦‚æ¯”è¾ƒå‹å¥½çš„æ ¼å¼åŒ–ã€æ–‡æœ¬é¢œè‰²ä¿¡æ¯ç­‰ç­‰ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-10-13 22:46:12.367 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å…¶é»˜è®¤çš„è¾“å‡ºæ ¼å¼æ˜¯ä¸Šé¢çš„å†…å®¹ï¼Œæœ‰æ—¶é—´ã€çº§åˆ«ã€æ¨¡å—åã€è¡Œå·ä»¥åŠæ—¥å¿—ä¿¡æ¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º loggerï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼Œå¦å¤–å…¶è¾“å‡ºè¿˜æ˜¯å½©è‰²çš„ï¼Œçœ‹èµ·æ¥ä¼šæ›´åŠ å‹å¥½ã€‚</p>
<p>ä»¥ä¸Šçš„æ—¥å¿—ä¿¡æ¯æ˜¯ç›´æ¥è¾“å‡ºåˆ°æ§åˆ¶å°çš„ï¼Œå¹¶æ²¡æœ‰è¾“å‡ºåˆ°å…¶ä»–çš„åœ°æ–¹ï¼Œå¦‚æœæƒ³è¦è¾“å‡ºåˆ°å…¶ä»–çš„ä½ç½®ï¼Œæ¯”å¦‚å­˜ä¸ºæ–‡ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä¸€è¡Œä»£ç å£°æ˜å³å¯ã€‚</p>
<p>ä¾‹å¦‚å°†ç»“æœåŒæ—¶è¾“å‡ºåˆ°ä¸€ä¸ª runtime.log æ–‡ä»¶é‡Œé¢ï¼Œå¯ä»¥è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">logger.add(&#39;runtime.log&#39;)</span><br><span class="line">logger.debug(&#39;this is a debug&#39;)</span><br></pre></td></tr></table></figure>
<p>å¾ˆç®€å•å§ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å†å£°æ˜ä¸€ä¸ª FileHandler äº†ï¼Œå°±ä¸€è¡Œ add è¯­å¥æå®šï¼Œè¿è¡Œä¹‹åä¼šå‘ç°ç›®å½•ä¸‹ runtime.log é‡Œé¢åŒæ ·å‡ºç°äº†åˆšåˆšæ§åˆ¶å°è¾“å‡ºçš„ DEBUG ä¿¡æ¯ã€‚</p>
<p>ä¸Šé¢å°±æ˜¯ä¸€äº›åŸºæœ¬çš„ä½¿ç”¨ï¼Œä½†è¿™è¿˜è¿œè¿œä¸å¤Ÿï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†äº†è§£ä¸‹å®ƒçš„ä¸€äº›åŠŸèƒ½æ¨¡å—.</p>
<h2 id="è¯¦ç»†ä½¿ç”¨"><a href="#è¯¦ç»†ä½¿ç”¨" class="headerlink" title="è¯¦ç»†ä½¿ç”¨"></a>è¯¦ç»†ä½¿ç”¨</h2><p>æ—¢ç„¶æ˜¯æ—¥å¿—ï¼Œé‚£ä¹ˆæœ€å¸¸è§çš„å°±æ˜¯è¾“å‡ºåˆ°æ–‡ä»¶äº†ã€‚loguru å¯¹è¾“å‡ºåˆ°æ–‡ä»¶çš„é…ç½®æœ‰éå¸¸å¼ºå¤§çš„æ”¯æŒï¼Œæ¯”å¦‚æ”¯æŒè¾“å‡ºåˆ°å¤šä¸ªæ–‡ä»¶ï¼Œåˆ†çº§åˆ«åˆ†åˆ«è¾“å‡ºï¼Œè¿‡å¤§åˆ›å»ºæ–°æ–‡ä»¶ï¼Œè¿‡ä¹…è‡ªåŠ¨åˆ é™¤ç­‰ç­‰ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«çœ‹çœ‹è¿™äº›æ€æ ·æ¥å®ç°ï¼Œè¿™é‡ŒåŸºæœ¬ä¸Šå°±æ˜¯ add æ–¹æ³•çš„ä½¿ç”¨ä»‹ç»ã€‚å› ä¸ºè¿™ä¸ª add æ–¹æ³•å°±ç›¸å½“äºç»™ logger æ·»åŠ äº†ä¸€ä¸ª Handlerï¼Œå®ƒç»™æˆ‘ä»¬æš´éœ²äº†è®¸å¤šå‚æ•°æ¥å®ç° Handler çš„é…ç½®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»ä¸‹ã€‚<br>é¦–å…ˆçœ‹çœ‹å®ƒçš„æ–¹æ³•å®šä¹‰å§:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def add(</span><br><span class="line">        self,</span><br><span class="line">        sink,</span><br><span class="line">        *,</span><br><span class="line">        level&#x3D;_defaults.LOGURU_LEVEL,</span><br><span class="line">        format&#x3D;_defaults.LOGURU_FORMAT,</span><br><span class="line">        filter&#x3D;_defaults.LOGURU_FILTER,</span><br><span class="line">        colorize&#x3D;_defaults.LOGURU_COLORIZE,</span><br><span class="line">        serialize&#x3D;_defaults.LOGURU_SERIALIZE,</span><br><span class="line">        backtrace&#x3D;_defaults.LOGURU_BACKTRACE,</span><br><span class="line">        diagnose&#x3D;_defaults.LOGURU_DIAGNOSE,</span><br><span class="line">        enqueue&#x3D;_defaults.LOGURU_ENQUEUE,</span><br><span class="line">        catch&#x3D;_defaults.LOGURU_CATCH,</span><br><span class="line">        **kwargs</span><br><span class="line">    ):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
<p>çœ‹çœ‹å®ƒçš„æºä»£ç ï¼Œå®ƒæ”¯æŒè¿™ä¹ˆå¤šçš„å‚æ•°ï¼Œå¦‚ levelã€formatã€filterã€color ç­‰ç­‰ã€‚</p>
<blockquote>
<p>sink<br>å¦å¤–æˆ‘ä»¬è¿˜æ³¨æ„åˆ°å®ƒæœ‰ä¸ªéå¸¸é‡è¦çš„å‚æ•° sinkï¼Œæˆ‘ä»¬çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼š<code>https://loguru.readthedocs.io/en/stable/api/logger.html#sink</code>ï¼Œå¯ä»¥äº†è§£åˆ°é€šè¿‡ sink æˆ‘ä»¬å¯ä»¥ä¼ å…¥å¤šç§ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œæ±‡æ€»å¦‚ä¸‹:</p>
</blockquote>
<ul>
<li>sink å¯ä»¥ä¼ å…¥ä¸€ä¸ª file å¯¹è±¡ï¼Œä¾‹å¦‚ sys.stderr æˆ–è€… open(â€˜file.logâ€™, â€˜wâ€™) éƒ½å¯ä»¥ã€‚</li>
<li>sink å¯ä»¥ç›´æ¥ä¼ å…¥ä¸€ä¸ª str å­—ç¬¦ä¸²æˆ–è€… pathlib.Path å¯¹è±¡ï¼Œå…¶å®å°±æ˜¯ä»£è¡¨æ–‡ä»¶è·¯å¾„çš„ï¼Œå¦‚æœè¯†åˆ«åˆ°æ˜¯è¿™ç§ç±»å‹ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºå¯¹åº”è·¯å¾„çš„æ—¥å¿—æ–‡ä»¶å¹¶å°†æ—¥å¿—è¾“å‡ºè¿›å»ã€‚</li>
<li>sink å¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œå®šä¹‰è¾“å‡ºå®ç°ã€‚</li>
<li>sink å¯ä»¥æ˜¯ä¸€ä¸ª logging æ¨¡å—çš„ Handlerï¼Œæ¯”å¦‚ FileHandlerã€StreamHandler ç­‰ç­‰ï¼Œæˆ–è€…ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°çš„ CMRESHandler ç…§æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°è‡ªå®šä¹‰ Handler çš„é…ç½®ã€‚</li>
<li>sink è¿˜å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»ï¼Œå…·ä½“çš„å®ç°è§„èŒƒå¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£.<br>æ‰€ä»¥è¯´ï¼Œåˆšæ‰æˆ‘ä»¬æ‰€æ¼”ç¤ºçš„è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œä»…ä»…ç»™å®ƒä¼ äº†ä¸€ä¸ª str å­—ç¬¦ä¸²è·¯å¾„ï¼Œä»–å°±ç»™æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå°±æ˜¯è¿™ä¸ªåŸç†ã€‚</li>
</ul>
<blockquote>
<blockquote>
<p>format, filter, level<br>ä¸‹é¢æˆ‘ä»¬å†äº†è§£ä¸‹å®ƒçš„å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚ formatã€filterã€level ç­‰ç­‰ã€‚<br>å…¶å®å®ƒä»¬çš„æ¦‚å¿µå’Œæ ¼å¼å’Œ logging æ¨¡å—éƒ½æ˜¯åŸºæœ¬ä¸€æ ·çš„äº†ï¼Œä¾‹å¦‚è¿™é‡Œä½¿ç”¨ formatã€filterã€level æ¥è§„å®šè¾“å‡ºçš„æ ¼å¼:</p>
</blockquote>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, format&#x3D;&quot;&#123;time&#125; &#123;level&#125; &#123;message&#125;&quot;, filter&#x3D;&quot;my_module&quot;, level&#x3D;&quot;INFO&quot;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆ é™¤sink<br>å¦å¤–æ·»åŠ  sink ä¹‹åæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œåˆ é™¤ï¼Œç›¸å½“äºé‡æ–°åˆ·æ–°å¹¶å†™å…¥æ–°çš„å†…å®¹ã€‚<br>åˆ é™¤çš„æ—¶å€™æ ¹æ®åˆšåˆš add æ–¹æ³•è¿”å›çš„ id è¿›è¡Œåˆ é™¤å³å¯ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from loguru import logger</span><br><span class="line"></span><br><span class="line">trace &#x3D; logger.add(&#39;runtime.log&#39;)</span><br><span class="line">logger.debug(&#39;this is a debug message&#39;)</span><br><span class="line">logger.remove(trace)</span><br><span class="line">logger.debug(&#39;this is another debug message&#39;)</span><br></pre></td></tr></table></figure>
<p>çœ‹è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆ add äº†ä¸€ä¸ª sinkï¼Œç„¶åè·å–å®ƒçš„è¿”å›å€¼ï¼Œèµ‹å€¼ä¸º traceã€‚éšåè¾“å‡ºäº†ä¸€æ¡æ—¥å¿—ï¼Œç„¶åå°† trace å˜é‡ä¼ ç»™ remove æ–¹æ³•ï¼Œå†æ¬¡è¾“å‡ºä¸€æ¡æ—¥å¿—ï¼Œçœ‹çœ‹ç»“æœæ˜¯æ€æ ·çš„ã€‚<br>æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br><span class="line">2019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:6 - this is another debug message</span><br></pre></td></tr></table></figure>
<p>æ—¥å¿—æ–‡ä»¶ runtime.log å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2019-10-13 23:18:26.469 | DEBUG    | __main__:&lt;module&gt;:4 - this is a debug message</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨ remove æ–¹æ³•ä¹‹åï¼Œç¡®å®å°†å†å² log åˆ é™¤äº†ã€‚<br>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°æ—¥å¿—çš„åˆ·æ–°é‡æ–°å†™å…¥æ“ä½œã€‚</p>
<blockquote>
<p>rotation é…ç½®<br>ç”¨äº† loguru æˆ‘ä»¬è¿˜å¯ä»¥éå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ rotation é…ç½®ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³ä¸€å¤©è¾“å‡ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œæˆ–è€…æ–‡ä»¶å¤ªå¤§äº†è‡ªåŠ¨åˆ†éš”æ—¥å¿—æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ add æ–¹æ³•çš„ rotation å‚æ•°è¿›è¡Œé…ç½®ã€‚<br>æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&quot;500 MB&quot;)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„é…ç½®æˆ‘ä»¬å°±å¯ä»¥å®ç°æ¯ 500MB å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ª log æ–‡ä»¶è¿‡å¤§å°±ä¼šæ–°åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨é…ç½® log åå­—æ—¶åŠ ä¸Šäº†ä¸€ä¸ª time å ä½ç¬¦ï¼Œè¿™æ ·åœ¨ç”Ÿæˆæ—¶å¯ä»¥è‡ªåŠ¨å°†æ—¶é—´æ›¿æ¢è¿›å»ï¼Œç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ååŒ…å«æ—¶é—´çš„ log æ–‡ä»¶ã€‚<br>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ rotation å‚æ•°å®ç°å®šæ—¶åˆ›å»º log æ–‡ä»¶ï¼Œä¾‹å¦‚:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&#39;00:00&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥å®ç°æ¯å¤© 0 ç‚¹æ–°åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶è¾“å‡ºäº†ã€‚<br>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½® log æ–‡ä»¶çš„å¾ªç¯æ—¶é—´ï¼Œæ¯”å¦‚æ¯éš”ä¸€å‘¨åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶ï¼Œå†™æ³•å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime_&#123;time&#125;.log&#39;, rotation&#x3D;&#39;1 week&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°ä¸€å‘¨åˆ›å»ºä¸€ä¸ª log æ–‡ä»¶äº†ã€‚</p>
<blockquote>
<p>retention é…ç½®<br>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€äº›éå¸¸ä¹…è¿œçš„ log å¯¹æˆ‘ä»¬æ¥è¯´å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨å¤„äº†ï¼Œå®ƒç™½ç™½å æ®äº†ä¸€äº›å­˜å‚¨ç©ºé—´ï¼Œä¸æ¸…é™¤æ‰å°±ä¼šéå¸¸æµªè´¹ã€‚retention è¿™ä¸ªå‚æ•°å¯ä»¥é…ç½®æ—¥å¿—çš„æœ€é•¿ä¿ç•™æ—¶é—´ã€‚<br>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®¾ç½®æ—¥å¿—æ–‡ä»¶æœ€é•¿ä¿ç•™ 10 å¤©ï¼Œå¯ä»¥è¿™ä¹ˆæ¥é…ç½®:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, retention&#x3D;&#39;10 days&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ · log æ–‡ä»¶é‡Œé¢å°±ä¼šä¿ç•™æœ€æ–° 10 å¤©çš„ logï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒ log æ²‰ç§¯çš„é—®é¢˜å•¦ã€‚</p>
<blockquote>
<p>compression é…ç½®<br>loguru è¿˜å¯ä»¥é…ç½®æ–‡ä»¶çš„å‹ç¼©æ ¼å¼ï¼Œæ¯”å¦‚ä½¿ç”¨ zip æ–‡ä»¶æ ¼å¼ä¿å­˜ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.add(&#39;runtime.log&#39;, compression&#x3D;&#39;zip&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥æ›´åŠ èŠ‚çœå­˜å‚¨ç©ºé—´ã€‚</p>
<blockquote>
<p>å­—ç¬¦ä¸²æ ¼å¼åŒ–<br>loguru åœ¨è¾“å‡º log çš„æ—¶å€™è¿˜æä¾›äº†éå¸¸å‹å¥½çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–åŠŸèƒ½ï¼Œåƒè¿™æ ·:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">logger.info(&#39;If you are using Python &#123;&#125;, prefer &#123;feature&#125; of course!&#39;, 3.6, feature&#x3D;&#39;f-strings&#39;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨æ·»åŠ å‚æ•°å°±éå¸¸æ–¹ä¾¿äº†ã€‚</p>
<blockquote>
<p>Traceback è®°å½•<br>åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¦‚æœé‡åˆ°è¿è¡Œé”™è¯¯ï¼Œè€Œæˆ‘ä»¬åœ¨æ‰“å°è¾“å‡º log çš„æ—¶å€™ä¸‡ä¸€ä¸å°å¿ƒæ²¡æœ‰é…ç½®å¥½ Traceback çš„è¾“å‡ºï¼Œå¾ˆæœ‰å¯èƒ½æˆ‘ä»¬å°±æ²¡æ³•è¿½è¸ªé”™è¯¯æ‰€åœ¨äº†ã€‚<br>ä½†ç”¨äº† loguru ä¹‹åï¼Œæˆ‘ä»¬ç”¨å®ƒæä¾›çš„è£…é¥°å™¨å°±å¯ä»¥ç›´æ¥è¿›è¡Œ Traceback çš„è®°å½•ï¼Œç±»ä¼¼è¿™æ ·çš„é…ç½®å³å¯:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@logger.catch</span><br><span class="line">def my_function(x, y, z):</span><br><span class="line">    # An error? It&#39;s caught anyway!</span><br><span class="line">    return 1 &#x2F; (x + y + z)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åšä¸ªæµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ—¶ä¸‰ä¸ªå‚æ•°éƒ½ä¼ å…¥ 0ï¼Œç›´æ¥å¼•å‘é™¤ä»¥ 0 çš„é”™è¯¯ï¼Œçœ‹çœ‹ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">my_function(0, 0, 0)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œå®Œæ¯•ä¹‹åï¼Œå¯ä»¥å‘ç° log é‡Œé¢å°±å‡ºç°äº† Traceback ä¿¡æ¯ï¼Œè€Œä¸”ç»™æˆ‘ä»¬è¾“å‡ºäº†å½“æ—¶çš„å˜é‡å€¼ï¼ŒçœŸçš„æ˜¯ä¸èƒ½å†èµäº†ï¼ç»“æœå¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; File &quot;run.py&quot;, line 15, in &lt;module&gt;</span><br><span class="line">    my_function(0, 0, 0)</span><br><span class="line">    â”” &lt;function my_function at 0x1171dd510&gt;</span><br><span class="line"></span><br><span class="line">  File &quot;&#x2F;private&#x2F;var&#x2F;py&#x2F;logurutest&#x2F;demo5.py&quot;, line 13, in my_function</span><br><span class="line">    return 1 &#x2F; (x + y + z)</span><br><span class="line">                â”‚   â”‚   â”” 0</span><br><span class="line">                â”‚   â”” 0</span><br><span class="line">                â”” 0</span><br><span class="line"></span><br><span class="line">ZeroDivisionError: division by zero</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œç”¨ loguru å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°æ—¥å¿—è¿½è¸ªï¼Œdebug æ•ˆç‡å¯èƒ½è¦é«˜ä¸Šåå€äº†ï¼Ÿ<br>å¦å¤– loguru è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šå¼ºå¤§çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€å±•å¼€è®²è§£äº†ï¼Œæ›´å¤šçš„å†…å®¹å¤§å®¶å¯ä»¥çœ‹çœ‹ loguru çš„å®˜æ–¹æ–‡æ¡£è¯¦ç»†äº†è§£ä¸€ä¸‹ï¼š<code>https://loguru.readthedocs.io/en/stable/index.html</code><br>çœ‹å®Œä¹‹åï¼Œæ˜¯æ—¶å€™æŠŠè‡ªå·±çš„ logging æ¨¡å—æ›¿æ¢æˆ loguru å•¦ï¼</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title> Mysql è¡¨è®¾è®¡è§„èŒƒåŠå¼€å‘</title>
    <url>/2020/04/20/Mysql-%E8%A1%A8%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83%E5%8F%8A%E5%BC%80%E5%8F%91/</url>
    <content><![CDATA[<h2 id="Mysql-è§„èŒƒ"><a href="#Mysql-è§„èŒƒ" class="headerlink" title="Mysql è§„èŒƒ"></a>Mysql è§„èŒƒ</h2><p>1.å‘½åè§„èŒƒ<br>(1)åº“åã€è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯,å¹¶é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚</p>
<p>(2)åº“åã€è¡¨åã€å­—æ®µåç¦æ­¢è¶…è¿‡32ä¸ªå­—ç¬¦ã€‚</p>
<p>(3)åº“åã€è¡¨åã€å­—æ®µåå¿…é¡»è§åçŸ¥æ„ã€‚å‘½åä¸ä¸šåŠ¡ã€äº§å“çº¿ç­‰ç›¸å…³è”ã€‚</p>
<p>(4)åº“åã€è¡¨åã€å­—æ®µåç¦æ­¢ä½¿ç”¨MySQLä¿ç•™å­—ã€‚</p>
<p>(5)è¡¨è¾¾æ˜¯ä¸å¦æ¦‚å¿µçš„å­—æ®µï¼Œå¿…é¡»ä½¿ç”¨ is_xxx çš„æ–¹å¼å‘½åï¼Œæ•°æ®ç±»å‹æ˜¯ unsigned tinyintï¼ˆ1 è¡¨ç¤ºæ˜¯ï¼Œ 0 è¡¨ç¤ºå¦ï¼‰</p>
<p>(6)è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯</p>
<p>(7)ä¸´æ—¶åº“ã€è¡¨åå¿…é¡»ä»¥tmpä¸ºå‰ç¼€,å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ã€‚ä¾‹å¦‚ tmp_test01_20130704ã€‚</p>
<p>(8)å¤‡ä»½åº“ã€è¡¨å¿…é¡»ä»¥bakä¸ºå‰ç¼€,å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ã€‚ä¾‹å¦‚ bak_test01_20130704ã€‚</p>
<p>2.åŸºç¡€è§„èŒƒ<br>(1)ä½¿ç”¨INNODBå­˜å‚¨å¼•æ“ã€‚</p>
<p>(2)è¡¨å­—ç¬¦é›†ä½¿ç”¨utf8å­—ç¬¦é›†ã€‚å¦‚æœè¦ä½¿ç”¨è¡¨æƒ…ï¼Œé‚£ä¹ˆä½¿ç”¨ utf8mb4 æ¥è¿›è¡Œå­˜å‚¨.</p>
<p>(3)æ‰€æœ‰è¡¨éƒ½éœ€è¦æ·»åŠ æ³¨é‡Š;æ‰€æœ‰å­—æ®µéƒ½éœ€è¦å¢åŠ æ³¨é‡Šã€‚æ¨èé‡‡ç”¨è‹±æ–‡æ ‡ç‚¹,é¿å…å‡ºç°ä¹±ç ã€‚</p>
<p>(4)ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ã€æ–‡ä»¶ç­‰å¤§æ•°æ®ã€‚</p>
<p>(5)æ¯å¼ è¡¨æ•°æ®é‡å»ºè®®æ§åˆ¶åœ¨5000Wä»¥å†…ã€‚</p>
<p>(6)ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•ã€‚</p>
<p>(7)ç¦æ­¢ä»æµ‹è¯•ã€å¼€å‘ç¯å¢ƒç›´è¿ç”Ÿäº§æ•°æ®åº“ã€‚</p>
<p>3.åº“è¡¨è®¾è®¡<br>(1)ç¦æ­¢ä½¿ç”¨åˆ†åŒºè¡¨ã€‚</p>
<p>(2)å°†å¤§å­—æ®µã€è®¿é—®é¢‘ç‡ä½çš„å­—æ®µæ‹†åˆ†åˆ°å•ç‹¬çš„è¡¨ä¸­å­˜å‚¨,åˆ†ç¦»å†·çƒ­æ•°æ®ã€‚</p>
<p>(3)æŒ‰æ—¥æœŸæ—¶é—´åˆ†è¡¨éœ€ç¬¦åˆYYYY[MM][DD][HH]æ ¼å¼,ä¾‹å¦‚2013071601ã€‚å¹´ä»½å¿…é¡»ç”¨4ä½æ•°å­—è¡¨ç¤ºã€‚ä¾‹å¦‚æŒ‰æ—¥æ•£è¡¨user_20110209ã€ æŒ‰æœˆæ•£è¡¨user_201102ã€‚</p>
<p>(4)é‡‡ç”¨åˆé€‚çš„åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€‚ä¾‹å¦‚åƒåº“åè¡¨ã€ååº“ç™¾è¡¨ç­‰ã€‚</p>
<p>4.å­—æ®µè®¾è®¡<br>(1)å»ºè®®ä½¿ç”¨UNSIGNEDå­˜å‚¨éè´Ÿæ•°å€¼ã€‚</p>
<p>(2)å»ºè®®ä½¿ç”¨INT UNSIGNEDå­˜å‚¨IPV4ã€‚</p>
<p>(3)ç”¨DECIMALä»£æ›¿FLOATå’ŒDOUBLEå­˜å‚¨ç²¾ç¡®æµ®ç‚¹æ•°ã€‚ä¾‹å¦‚ä¸è´§å¸ã€é‡‘èç›¸å…³çš„æ•°æ®ã€‚</p>
<p>(4)INTç±»å‹å›ºå®šå ç”¨4å­—èŠ‚å­˜å‚¨,ä¾‹å¦‚INT(4)ä»…ä»£è¡¨æ˜¾ç¤ºå­—ç¬¦å®½åº¦ä¸º4ä½,ä¸ä»£è¡¨å­˜å‚¨é•¿åº¦ã€‚</p>
<p>(5)åŒºåˆ†ä½¿ç”¨TINYINTã€SMALLINTã€MEDIUMINTã€INTã€BIGINTæ•°æ®ç±»å‹ã€‚ä¾‹å¦‚å–å€¼èŒƒå›´ä¸º0-80æ—¶,ä½¿ç”¨TINYINT UNSIGNEDã€‚</p>
<p>(6)å¼ºçƒˆå»ºè®®ä½¿ç”¨TINYINTæ¥ä»£æ›¿ENUMç±»å‹ã€‚</p>
<p>(7)å°½å¯èƒ½ä¸ä½¿ç”¨TEXTã€BLOBç±»å‹ã€‚</p>
<p>(8)ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ˜æ–‡å¯†ç ã€‚</p>
<p>(9)ä½¿ç”¨VARBINARYå­˜å‚¨å¤§å°å†™æ•æ„Ÿçš„å˜é•¿å­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶å†…å®¹ã€‚</p>
<p>(10)ä½¿ç”¨å°½å¯èƒ½å°çš„VARCHARå­—æ®µã€‚VARCHAR(N)ä¸­çš„Nè¡¨ç¤ºå­—ç¬¦æ•°è€Œéå­—èŠ‚æ•°ã€‚</p>
<p>(11)åŒºåˆ†ä½¿ç”¨DATETIMEå’ŒTIMESTAMPã€‚å­˜å‚¨å¹´ä½¿ç”¨YEARç±»å‹ã€‚å­˜å‚¨æ—¥æœŸä½¿ç”¨DATEç±»å‹ã€‚ å­˜å‚¨æ—¶é—´(ç²¾ç¡®åˆ°ç§’)å»ºè®®ä½¿ç”¨TIMESTAMPç±»å‹ã€‚</p>
<p>(12)æ‰€æœ‰å­—æ®µå‡å®šä¹‰ä¸ºNOT NULLã€‚</p>
<p>(13)å­—æ®µå…è®¸é€‚å½“å†—ä½™ï¼Œä»¥æé«˜æ€§èƒ½</p>
<p> 5.ç´¢å¼•è§„èŒƒ<br>(1)å•å¼ è¡¨ä¸­ç´¢å¼•æ•°é‡ä¸è¶…è¿‡5ä¸ªã€‚</p>
<p>(2)å•ä¸ªç´¢å¼•ä¸­çš„å­—æ®µæ•°ä¸è¶…è¿‡5ä¸ªã€‚</p>
<p>(3)ç´¢å¼•åå¿…é¡»å…¨éƒ¨ä½¿ç”¨å°å†™ã€‚</p>
<p>(4)éå”¯ä¸€ç´¢å¼•æŒ‰ç…§â€œidx_å­—æ®µåç§°[_å­—æ®µåç§°]â€è¿›ç”¨è¡Œå‘½åã€‚ä¾‹å¦‚idx_age_nameã€‚</p>
<p>(5)å”¯ä¸€ç´¢å¼•æŒ‰ç…§â€œuniq_å­—æ®µåç§°[_å­—æ®µåç§°]â€è¿›ç”¨è¡Œå‘½åã€‚ä¾‹å¦‚uniq_age_nameã€‚</p>
<p>(6)ç»„åˆç´¢å¼•å»ºè®®åŒ…å«æ‰€æœ‰å­—æ®µå,è¿‡é•¿çš„å­—æ®µåå¯ä»¥é‡‡ç”¨ç¼©å†™å½¢å¼ã€‚ä¾‹å¦‚idx_age_name_addã€‚</p>
<p>(7)è¡¨å¿…é¡»æœ‰ä¸»é”®,æ¨èä½¿ç”¨UNSIGNEDè‡ªå¢åˆ—ä½œä¸ºä¸»é”®ã€‚</p>
<p>(8)å”¯ä¸€é”®ç”±3ä¸ªä»¥ä¸‹å­—æ®µç»„æˆ,å¹¶ä¸”å­—æ®µéƒ½æ˜¯æ•´å½¢æ—¶,å¯ä½¿ç”¨å”¯ä¸€é”®ä½œä¸ºä¸»é”®ã€‚å…¶ä»–æƒ…å†µä¸‹,å»ºè®®ä½¿ç”¨è‡ªå¢åˆ—æˆ–å‘å·å™¨ä½œä¸»é”®ã€‚</p>
<p>(9)ç¦æ­¢å†—ä½™ç´¢å¼•ã€‚</p>
<p>(10)ç¦æ­¢é‡å¤ç´¢å¼•ã€‚</p>
<p>(11)ç¦æ­¢ä½¿ç”¨å¤–é”®ã€‚</p>
<p>(12)è”è¡¨æŸ¥è¯¢æ—¶,JOINåˆ—çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒ,å¹¶ä¸”è¦å»ºç«‹ç´¢å¼•ã€‚</p>
<p>(13)ä¸åœ¨ä½åŸºæ•°åˆ—ä¸Šå»ºç«‹ç´¢å¼•,ä¾‹å¦‚â€œæ€§åˆ«â€ã€‚</p>
<p>(14)é€‰æ‹©åŒºåˆ†åº¦å¤§çš„åˆ—å»ºç«‹ç´¢å¼•ã€‚ç»„åˆç´¢å¼•ä¸­,åŒºåˆ†åº¦å¤§çš„å­—æ®µæ”¾åœ¨æœ€å‰ã€‚</p>
<p>(15)å¯¹å­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€ç´¢å¼•,å‰ç¼€ç´¢å¼•é•¿åº¦ä¸è¶…è¿‡8ä¸ªå­—ç¬¦ã€‚</p>
<p>(16)ä¸å¯¹è¿‡é•¿çš„VARCHARå­—æ®µå»ºç«‹ç´¢å¼•ã€‚å»ºè®®ä¼˜å…ˆè€ƒè™‘å‰ç¼€ç´¢å¼•,æˆ–æ·»åŠ CRC32æˆ–MD5ä¼ªåˆ—å¹¶å»ºç«‹ç´¢å¼•ã€‚</p>
<p>(17)åˆç†åˆ›å»ºè”åˆç´¢å¼•,(a,b,c) ç›¸å½“äº (a) ã€(a,b) ã€(a,b,c)ã€‚</p>
<p>(18)åˆç†ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘IO,é¿å…æ’åºã€‚</p>
<p>6.SQLè®¾è®¡<br>(1)ä½¿ç”¨prepared statement,å¯ä»¥æå‡æ€§èƒ½å¹¶é¿å…SQLæ³¨å…¥ã€‚</p>
<p>(2)ä½¿ç”¨INä»£æ›¿ORã€‚SQLè¯­å¥ä¸­INåŒ…å«çš„å€¼ä¸åº”è¿‡å¤š,åº”å°‘äº1000ä¸ªã€‚</p>
<p>(3)ç¦æ­¢éšå¼è½¬æ¢ã€‚æ•°å€¼ç±»å‹ç¦æ­¢åŠ å¼•å·;å­—ç¬¦ä¸²ç±»å‹å¿…é¡»åŠ å¼•å·ã€‚</p>
<p>(4)é¿å…ä½¿ç”¨JOINå’Œå­æŸ¥è¯¢ã€‚å¿…è¦æ—¶æ¨èç”¨JOINä»£æ›¿å­æŸ¥è¯¢ã€‚è¶…è¿‡3ä¸ªè¡¨ä¸¥ç¦join</p>
<p>(5)ç¦æ­¢åœ¨MySQLä¸­è¿›è¡Œæ•°å­¦è¿ç®—å’Œå‡½æ•°è¿ç®—ã€‚</p>
<p>(6)å‡å°‘ä¸æ•°æ®åº“äº¤äº’æ¬¡æ•°,å°½é‡é‡‡ç”¨æ‰¹é‡SQLè¯­å¥ã€‚</p>
<p>(7)æ‹†åˆ†å¤æ‚SQLä¸ºå¤šä¸ªå°SQL,é¿å…å¤§äº‹åŠ¡ã€‚</p>
<p>(8)è·å–å¤§é‡æ•°æ®æ—¶,å»ºè®®åˆ†æ‰¹æ¬¡è·å–æ•°æ®,æ¯æ¬¡è·å–æ•°æ®å°‘äº2000æ¡,ç»“æœé›†åº”å°äº1Mã€‚</p>
<p>(9)ä½¿ç”¨UNION ALLä»£æ›¿UNIONã€‚</p>
<p>(10)ç»Ÿè®¡è¡Œæ•°ä½¿ç”¨COUNT(*)ã€‚</p>
<p>(11)SELECTåªè·å–å¿…è¦çš„å­—æ®µ,ç¦æ­¢ä½¿ç”¨SELECT *ã€‚</p>
<p>(12)SQLä¸­é¿å…å‡ºç°now()ã€rand()ã€sysdate()ã€current_user()ç­‰ä¸ç¡®å®šç»“æœçš„å‡½æ•°ã€‚</p>
<p>13)INSERTè¯­å¥å¿…é¡»æŒ‡å®šå­—æ®µåˆ—è¡¨,ç¦æ­¢ä½¿ç”¨ INSERT INTO TABLE()ã€‚</p>
<p>(14)ç¦æ­¢å•æ¡SQLè¯­å¥åŒæ—¶æ›´æ–°å¤šä¸ªè¡¨ã€‚</p>
<p>(15)ç¦æ­¢ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ã€è‡ªå®šä¹‰å‡½æ•°ç­‰ã€‚</p>
<p>(16)å»ºè®®ä½¿ç”¨åˆç†çš„åˆ†é¡µæ–¹å¼ä»¥æé«˜åˆ†é¡µæ•ˆç‡ã€‚</p>
<p>(17)ç¦æ­¢åœ¨ä»åº“ä¸Šæ‰§è¡Œåå°ç®¡ç†å’Œç»Ÿè®¡ç±»åŠŸèƒ½çš„QUERY,å¿…è¦æ—¶ç”³è¯·ç»Ÿè®¡ç±»ä»åº“ã€‚</p>
<p>(18)ç¨‹åºåº”æœ‰æ•è·SQLå¼‚å¸¸çš„å¤„ç†æœºåˆ¶,å¿…è¦æ—¶é€šè¿‡rollbackæ˜¾å¼å›æ»šã€‚</p>
<p>(19)é‡è¦SQLå¿…é¡»è¢«ç´¢å¼•:updateã€deleteçš„whereæ¡ä»¶åˆ—ã€order byã€group byã€distinctå­—æ®µã€å¤šè¡¨joinå­—æ®µã€‚</p>
<p>(20)ç¦æ­¢ä½¿ç”¨%å‰å¯¼æŸ¥è¯¢,ä¾‹å¦‚:like â€œ%abcâ€,æ— æ³•åˆ©ç”¨åˆ°ç´¢å¼•ã€‚</p>
<p>(21)ç¦æ­¢ä½¿ç”¨è´Ÿå‘æŸ¥è¯¢,ä¾‹å¦‚ not inã€!=ã€not likeã€‚</p>
<p>(22)ä½¿ç”¨EXPLAINåˆ¤æ–­SQLè¯­å¥æ˜¯å¦åˆç†ä½¿ç”¨ç´¢å¼•,å°½é‡é¿å…extraåˆ—å‡ºç°:Using File Sortã€Using Temporaryã€‚</p>
<p>(23)ç¦æ­¢ä½¿ç”¨order by rand()ã€‚</p>
<p>7.è¡Œä¸ºè§„èŒƒ<br>(1)è¡¨ç»“æ„å˜æ›´å¿…é¡»é€šçŸ¥DBAè¿›è¡Œå®¡æ ¸ã€‚</p>
<p>(2)ç¦æ­¢æœ‰superæƒé™çš„åº”ç”¨ç¨‹åºè´¦å·å­˜åœ¨ã€‚</p>
<p>(3)ç¦æ­¢æœ‰DDLã€DCLæƒé™çš„åº”ç”¨ç¨‹åºè´¦å·å­˜åœ¨ã€‚</p>
<p>(4)é‡è¦é¡¹ç›®çš„æ•°æ®åº“æ–¹æ¡ˆé€‰å‹å’Œè®¾è®¡å¿…é¡»æå‰é€šçŸ¥DBAå‚ä¸ã€‚</p>
<p>(5)æ‰¹é‡å¯¼å…¥ã€å¯¼å‡ºæ•°æ®å¿…é¡»é€šè¿‡DBAå®¡æ ¸,å¹¶åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è§‚å¯ŸæœåŠ¡ã€‚</p>
<p>(6)æ‰¹é‡æ›´æ–°æ•°æ®,å¦‚UPDATEã€DELETEæ“ä½œ,å¿…é¡»DBAè¿›è¡Œå®¡æ ¸,å¹¶åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è§‚å¯ŸæœåŠ¡ã€‚</p>
<p>(7)äº§å“å‡ºç°éæ•°æ®åº“å¯¼è‡´çš„æ•…éšœæ—¶,å¦‚è¢«æ”»å‡»,å¿…é¡»åŠæ—¶é€šDBA,ä¾¿äºç»´æŠ¤æœåŠ¡ç¨³å®šã€‚</p>
<p>(8)ä¸šåŠ¡éƒ¨é—¨ç¨‹åºå‡ºç°BUGç­‰å½±å“æ•°æ®åº“æœåŠ¡çš„é—®é¢˜,å¿…é¡»åŠæ—¶é€šçŸ¥DBA,ä¾¿äºç»´æŠ¤æœåŠ¡ç¨³å®šã€‚</p>
<p>(9)ä¸šåŠ¡éƒ¨é—¨æ¨å¹¿æ´»åŠ¨æˆ–ä¸Šçº¿æ–°åŠŸèƒ½,å¿…é¡»æå‰é€šçŸ¥DBAè¿›è¡ŒæœåŠ¡å’Œè®¿é—®é‡è¯„ä¼°,å¹¶ç•™å‡ºå¿…è¦æ—¶é—´ä»¥ä¾¿DBAå®Œæˆæ‰©å®¹ã€‚</p>
<p>(10)å‡ºç°ä¸šåŠ¡éƒ¨é—¨äººä¸ºè¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤±,éœ€è¦æ¢å¤æ•°æ®çš„,å¿…é¡»ç¬¬ä¸€æ—¶é—´é€šçŸ¥DBA,å¹¶æä¾›å‡†ç¡®æ—¶é—´ç‚¹ã€ è¯¯æ“ä½œè¯­å¥ç­‰é‡è¦çº¿ç´¢ã€‚</p>
<p>(11)æäº¤çº¿ä¸Šå»ºè¡¨æ”¹è¡¨éœ€æ±‚,å¿…é¡»è¯¦ç»†æ³¨æ˜æ¶‰åŠåˆ°çš„æ‰€æœ‰SQLè¯­å¥(åŒ…æ‹¬INSERTã€DELETEã€UPDATE),ä¾¿äºDBAè¿›â¾è¡Œå®¡æ ¸å’Œä¼˜åŒ–ã€‚</p>
<p>(12)å¯¹åŒä¸€ä¸ªè¡¨çš„å¤šæ¬¡alteræ“ä½œå¿…é¡»åˆå¹¶ä¸ºä¸€æ¬¡æ“ä½œã€‚</p>
<p>(13)ä¸è¦åœ¨MySQLæ•°æ®åº“ä¸­å­˜æ”¾ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>8.FAQ<br>1.åº“åã€è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯,å¹¶é‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚<br>a)MySQLæœ‰é…ç½®å‚æ•°lower_case_table_names,ä¸å¯åŠ¨æ€æ›´æ”¹,linuxç³»ç»Ÿé»˜è®¤ä¸º 0,å³åº“è¡¨åä»¥å®é™…æƒ…å†µå­˜å‚¨,å¤§å°å†™æ•æ„Ÿã€‚å¦‚æœæ˜¯1,ä»¥å°å†™å­˜å‚¨,å¤§å°å†™ä¸æ•æ„Ÿã€‚å¦‚æœæ˜¯2,ä»¥å®é™…æƒ…å†µå­˜å‚¨,ä½†ä»¥å°å†™æ¯”è¾ƒã€‚</p>
<p>b)å¦‚æœå¤§å°å†™æ··åˆä½¿ç”¨,å¯èƒ½å­˜åœ¨abc,Abc,ABCç­‰å¤šä¸ªè¡¨å…±å­˜,å®¹æ˜“å¯¼è‡´æ··ä¹±ã€‚</p>
<p>c)å­—æ®µåæ˜¾å¼åŒºåˆ†å¤§å°å†™,ä½†å®é™…ä½¿ç”¨ä¸åŒºåˆ†,å³ä¸å¯ä»¥å»ºç«‹ä¸¤ä¸ªåå­—ä¸€æ ·ä½†å¤§å°å†™ä¸ä¸€æ ·çš„å­—æ®µã€‚</p>
<p>d)ä¸ºäº†ç»Ÿä¸€è§„èŒƒ, åº“åã€è¡¨åã€å­—æ®µåä½¿ç”¨å°å†™å­—æ¯ã€‚</p>
<p>2.åº“åã€è¡¨åã€å­—æ®µåç¦æ­¢è¶…è¿‡32ä¸ªå­—ç¬¦ã€‚<br>åº“åã€è¡¨åã€å­—æ®µåæ”¯æŒæœ€å¤š64ä¸ªå­—ç¬¦,ä½†ä¸ºäº†ç»Ÿä¸€è§„èŒƒã€æ˜“äºè¾¨è¯†ä»¥åŠå‡å°‘ä¼ è¾“é‡,ç¦æ­¢è¶…è¿‡32ä¸ªå­—ç¬¦ã€‚ </p>
<p>3.ä½¿ç”¨INNODBå­˜å‚¨å¼•æ“ã€‚<br>INNODBå¼•æ“æ˜¯MySQL5.5ç‰ˆæœ¬ä»¥åçš„é»˜è®¤å¼•æ“˜,æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”,æœ‰æ›´å¥½çš„æ•°æ®æ¢å¤èƒ½åŠ›ã€æ›´å¥½çš„å¹¶å‘æ€§èƒ½,åŒæ—¶å¯¹å¤šæ ¸ã€å¤§å†…å­˜ã€SSDç­‰ç¡¬ä»¶æ”¯æŒæ›´å¥½,æ”¯æŒæ•°æ®çƒ­å¤‡ä»½ç­‰,å› æ­¤INNODBç›¸æ¯”MyISAMæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚</p>
<p>4.åº“åã€è¡¨åã€å­—æ®µåç¦æ­¢ä½¿ç”¨MySQLä¿ç•™å­—ã€‚<br>å½“åº“åã€è¡¨åã€å­—æ®µåç­‰å±æ€§å«æœ‰ä¿ç•™å­—æ—¶,SQLè¯­å¥å¿…é¡»ç”¨åå¼•å·å¼•ç”¨å±æ€§åç§°,è¿™å°†ä½¿å¾—SQLè¯­å¥ä¹¦å†™ã€SHELLè„šæœ¬ä¸­å˜é‡çš„è½¬ä¹‰ç­‰å˜å¾—éå¸¸å¤æ‚ã€‚</p>
<p>5.ç¦æ­¢ä½¿ç”¨åˆ†åŒºè¡¨ã€‚<br>åˆ†åŒºè¡¨å¯¹åˆ†åŒºé”®æœ‰ä¸¥æ ¼è¦æ±‚;åˆ†åŒºè¡¨åœ¨è¡¨å˜å¤§å,æ‰§è¡ŒDDLã€SHARDINGã€å•è¡¨æ¢å¤ç­‰éƒ½å˜å¾—æ›´åŠ å›°éš¾ã€‚å› æ­¤ç¦æ­¢ä½¿ç”¨åˆ†åŒºè¡¨,å¹¶å»ºè®®ä¸šåŠ¡ç«¯æ‰‹åŠ¨SHARDINGã€‚</p>
<p>6.å»ºè®®ä½¿ç”¨UNSIGNEDå­˜å‚¨éè´Ÿæ•°å€¼ã€‚<br>åŒæ ·çš„å­—èŠ‚æ•°,éè´Ÿå­˜å‚¨çš„æ•°å€¼èŒƒå›´æ›´å¤§ã€‚å¦‚TINYINTæœ‰ç¬¦å·ä¸º -128-127,æ— ç¬¦å·ä¸º0-255ã€‚</p>
<p>7.å»ºè®®ä½¿ç”¨INT UNSIGNEDå­˜å‚¨IPV4ã€‚<br>UNSINGED INTå­˜å‚¨IPåœ°å€å ç”¨4å­—èŠ‚,CHAR(15)åˆ™å ç”¨15å­—èŠ‚ã€‚å¦å¤–,è®¡ç®—æœºå¤„ç†æ•´æ•°ç±»å‹æ¯”å­—ç¬¦ä¸²ç±»å‹å¿«ã€‚ä½¿ç”¨INT UNSIGNEDè€Œä¸æ˜¯CHAR(15)æ¥å­˜å‚¨IPV4åœ°å€,é€šè¿‡MySQLå‡½æ•°inet_ntoaå’Œinet_atonæ¥è¿›è¡Œè½¬åŒ–ã€‚IPv6åœ°å€ç›®å‰æ²¡æœ‰è½¬åŒ–å‡½æ•°,éœ€è¦ä½¿ç”¨DECIMALæˆ–ä¸¤ä¸ªBIGINTæ¥å­˜å‚¨ã€‚</p>
<p>ä¾‹å¦‚:</p>
<p>SELECT INET_ATON(â€˜209.207.224.40â€™); 3520061480</p>
<p>SELECT INET_NTOA(3520061480); 209.207.224.40</p>
<p>8.å¼ºçƒˆå»ºè®®ä½¿ç”¨TINYINTæ¥ä»£æ›¿ENUMç±»å‹ã€‚<br>ENUMç±»å‹åœ¨éœ€è¦ä¿®æ”¹æˆ–å¢åŠ æšä¸¾å€¼æ—¶,éœ€è¦åœ¨çº¿DDL,æˆæœ¬è¾ƒå¤§;ENUMåˆ—å€¼å¦‚æœå«æœ‰æ•°å­—ç±»å‹,å¯èƒ½ä¼šå¼•èµ·é»˜è®¤å€¼æ··æ·†ã€‚</p>
<p>9.ä½¿ç”¨VARBINARYå­˜å‚¨å¤§å°å†™æ•æ„Ÿçš„å˜é•¿å­—ç¬¦ä¸²æˆ–äºŒè¿›åˆ¶å†…å®¹ã€‚<br>VARBINARYé»˜è®¤åŒºåˆ†å¤§å°å†™,æ²¡æœ‰å­—ç¬¦é›†æ¦‚å¿µ,é€Ÿåº¦å¿«ã€‚</p>
<p>10.INTç±»å‹å›ºå®šå ç”¨4å­—èŠ‚å­˜å‚¨,ä¾‹å¦‚INT(4)ä»…ä»£è¡¨æ˜¾ç¤ºå­—ç¬¦å®½åº¦ä¸º4ä½,ä¸ä»£è¡¨å­˜å‚¨é•¿åº¦ã€‚<br>æ•°å€¼ç±»å‹æ‹¬å·åé¢çš„æ•°å­—åªæ˜¯è¡¨ç¤ºå®½åº¦è€Œè·Ÿå­˜å‚¨èŒƒå›´æ²¡æœ‰å…³ç³»,æ¯”å¦‚INT(3)é»˜è®¤æ˜¾ç¤º3ä½,ç©ºæ ¼è¡¥é½,è¶…å‡ºæ—¶æ­£å¸¸æ˜¾ç¤º,pythonã€javaå®¢æˆ·ç«¯ç­‰ä¸å…·å¤‡è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>11.åŒºåˆ†ä½¿ç”¨DATETIMEå’ŒTIMESTAMPã€‚å­˜å‚¨å¹´ä½¿ç”¨YEARç±»å‹ã€‚å­˜å‚¨æ—¥æœŸä½¿ç”¨DATEç±»å‹ã€‚ å­˜å‚¨æ—¶é—´(ç²¾ç¡®åˆ°ç§’)å»ºè®®ä½¿ç”¨TIMESTAMPç±»å‹ã€‚<br>DATETIMEå’ŒTIMESTAMPéƒ½æ˜¯ç²¾ç¡®åˆ°ç§’,ä¼˜å…ˆé€‰æ‹©TIMESTAMP,å› ä¸ºTIMESTAMPåªæœ‰4ä¸ªå­—èŠ‚,è€ŒDATETIME8ä¸ªå­—èŠ‚ã€‚åŒæ—¶TIMESTAMPå…·æœ‰è‡ªåŠ¨èµ‹å€¼ä»¥åŠè‡ªåŠ¨æ›´æ–°çš„ç‰¹æ€§ã€‚æ³¨æ„:åœ¨5.5å’Œä¹‹å‰çš„ç‰ˆæœ¬ä¸­,å¦‚æœä¸€ä¸ªè¡¨ä¸­æœ‰å¤šä¸ªtimestampåˆ—,é‚£ä¹ˆæœ€å¤šåªèƒ½æœ‰ä¸€åˆ—èƒ½å…·æœ‰è‡ªåŠ¨æ›´æ–°åŠŸèƒ½ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨TIMESTAMPçš„è‡ªåŠ¨èµ‹å€¼å±æ€§?<br>a)è‡ªåŠ¨åˆå§‹åŒ–,å¹¶è‡ªåŠ¨æ›´æ–°: column1 TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</p>
<p>b)åªæ˜¯è‡ªåŠ¨åˆå§‹åŒ–: column1 TIMESTAMP DEFAULT CURRENT_TIMESTAMP</p>
<p>c)è‡ªåŠ¨æ›´æ–°,åˆå§‹åŒ–çš„å€¼ä¸º0: column1 TIMESTAMP DEFAULT 0 ON UPDATE CURRENT_TIMESTAMP</p>
<p>d)åˆå§‹åŒ–çš„å€¼ä¸º0: column1 TIMESTAMP DEFAULT 0</p>
<p>12.æ‰€æœ‰å­—æ®µå‡å®šä¹‰ä¸ºNOT NULLã€‚<br>a)å¯¹è¡¨çš„æ¯ä¸€è¡Œ,æ¯ä¸ªä¸ºNULLçš„åˆ—éƒ½éœ€è¦é¢å¤–çš„ç©ºé—´æ¥æ ‡è¯†ã€‚</p>
<p>b)Bæ ‘ç´¢å¼•æ—¶ä¸ä¼šå­˜å‚¨NULLå€¼,æ‰€ä»¥å¦‚æœç´¢å¼•å­—æ®µå¯ä»¥ä¸ºNULL,ç´¢å¼•æ•ˆç‡ä¼šä¸‹é™ã€‚</p>
<p>c)å»ºè®®ç”¨0ã€ç‰¹æ®Šå€¼æˆ–ç©ºä¸²ä»£æ›¿NULLå€¼ã€‚</p>
<p>13.å°†å¤§å­—æ®µã€è®¿é—®é¢‘ç‡ä½çš„å­—æ®µæ‹†åˆ†åˆ°å•ç‹¬çš„è¡¨ä¸­å­˜å‚¨,åˆ†ç¦»å†·çƒ­æ•°æ®ã€‚<br>æœ‰åˆ©äºæœ‰æ•ˆåˆ©ç”¨ç¼“å­˜,é˜²æ­¢è¯»å…¥æ— ç”¨çš„å†·æ•°æ®,è¾ƒå°‘ç£ç›˜IO,åŒæ—¶ä¿è¯çƒ­æ•°æ®å¸¸é©»å†…å­˜æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚ </p>
<p>14.ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ˜æ–‡å¯†ç ã€‚<br>é‡‡ç”¨åŠ å¯†å­—ç¬¦ä¸²å­˜å‚¨å¯†ç ï¼Œå¹¶ä¿è¯å¯†ç ä¸å¯è§£å¯†ï¼ŒåŒæ—¶é‡‡ç”¨éšæœºå­—ç¬¦ä¸²åŠ ç›ä¿è¯å¯†ç å®‰å…¨ã€‚é˜²æ­¢æ•°æ®åº“æ•°æ®è¢«å…¬å¸å†…éƒ¨äººå‘˜æˆ–é»‘å®¢è·å–åï¼Œé‡‡ç”¨å­—å…¸æ”»å‡»ç­‰æ–¹å¼æš´åŠ›ç ´è§£ç”¨æˆ·å¯†ç ã€‚</p>
<p>15.è¡¨å¿…é¡»æœ‰ä¸»é”®,æ¨èä½¿ç”¨UNSIGNEDè‡ªå¢åˆ—ä½œä¸ºä¸»é”®ã€‚<br>è¡¨æ²¡æœ‰ä¸»é”®,INNODBä¼šé»˜è®¤è®¾ç½®éšè—çš„ä¸»é”®åˆ—;æ²¡æœ‰ä¸»é”®çš„è¡¨åœ¨å®šä½æ•°æ®è¡Œçš„æ—¶å€™éå¸¸å›°éš¾,ä¹Ÿä¼šé™ä½åŸºäºè¡Œå¤åˆ¶çš„æ•ˆç‡ã€‚</p>
<p>16.ç¦æ­¢å†—ä½™ç´¢å¼•ã€‚<br>ç´¢å¼•æ˜¯åŒåˆƒå‰‘,ä¼šå¢åŠ ç»´æŠ¤è´Ÿæ‹…,å¢å¤§IOå‹åŠ›ã€‚(a,b,c)ã€(a,b),åè€…ä¸ºå†—ä½™ç´¢å¼•ã€‚å¯ä»¥åˆ©ç”¨å‰ç¼€ç´¢å¼•æ¥è¾¾åˆ°åŠ é€Ÿç›®çš„,å‡è½»ç»´æŠ¤è´Ÿæ‹…ã€‚</p>
<p>17.ç¦æ­¢é‡å¤ç´¢å¼•ã€‚<br>primary key a;uniq index a;é‡å¤ç´¢å¼•å¢åŠ ç»´æŠ¤è´Ÿæ‹…ã€å ç”¨ç£ç›˜ç©ºé—´,åŒæ—¶æ²¡æœ‰ä»»ä½•ç›Šå¤„ã€‚</p>
<p>18.ä¸åœ¨ä½åŸºæ•°åˆ—ä¸Šå»ºç«‹ç´¢å¼•,ä¾‹å¦‚â€œæ€§åˆ«â€ã€‚<br>å¤§éƒ¨åˆ†åœºæ™¯ä¸‹,ä½åŸºæ•°åˆ—ä¸Šå»ºç«‹ç´¢å¼•çš„ç²¾ç¡®æŸ¥æ‰¾,ç›¸å¯¹äºä¸å»ºç«‹ç´¢å¼•çš„å…¨è¡¨æ‰«ææ²¡æœ‰ä»»ä½•ä¼˜åŠ¿,è€Œä¸”å¢å¤§äº†IOè´Ÿæ‹…ã€‚</p>
<p>19.åˆç†ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘IO,é¿å…æ’åºã€‚<br>è¦†ç›–ç´¢å¼•èƒ½ä»ç´¢å¼•ä¸­è·å–éœ€è¦çš„æ‰€æœ‰å­—æ®µ,ä»è€Œé¿å…å›è¡¨è¿›è¡ŒäºŒæ¬¡æŸ¥æ‰¾,èŠ‚çœIOã€‚INNODBå­˜å‚¨å¼•æ“ä¸­, secondary index(éä¸»é”®ç´¢å¼•,åˆç§°ä¸ºè¾…åŠ©ç´¢å¼•ã€äºŒçº§ç´¢å¼•)æ²¡æœ‰ç›´æ¥å­˜å‚¨è¡Œåœ°å€,è€Œæ˜¯å­˜å‚¨ä¸»é”®å€¼ã€‚å¦‚æœç”¨æˆ·éœ€è¦æŸ¥è¯¢secondary indexä¸­æ‰€ä¸åŒ…å«çš„æ•°æ®åˆ—,åˆ™éœ€è¦å…ˆé€šè¿‡secondary indexæŸ¥æ‰¾åˆ°ä¸»é”®å€¼,ç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°å…¶ä»–æ•°æ®åˆ—,å› æ­¤éœ€è¦æŸ¥è¯¢ä¸¤æ¬¡ã€‚è¦†ç›–ç´¢å¼•åˆ™å¯ä»¥åœ¨ä¸€ä¸ªç´¢å¼•ä¸­è·å–æ‰€æœ‰éœ€è¦çš„æ•°æ®,å› æ­¤æ•ˆç‡è¾ƒé«˜ã€‚ä¸»é”®æŸ¥è¯¢æ˜¯å¤©ç„¶çš„è¦†ç›–ç´¢å¼•ã€‚ä¾‹å¦‚SELECT email,uid FROM user_email WHERE uid=xx,å¦‚æœuid ä¸æ˜¯ä¸»é”®,é€‚å½“æ—¶å€™å¯ä»¥å°†ç´¢å¼•æ·»åŠ ä¸ºindex(uid,email),ä»¥è·å¾—æ€§èƒ½æå‡ã€‚</p>
<p>20.ç”¨INä»£æ›¿ORã€‚SQLè¯­å¥ä¸­INåŒ…å«çš„å€¼ä¸åº”è¿‡å¤š,åº”å°‘äº1000ä¸ªã€‚<br>INæ˜¯èŒƒå›´æŸ¥æ‰¾,MySQLå†…éƒ¨ä¼šå¯¹INçš„åˆ—è¡¨å€¼è¿›è¡Œæ’åºåæŸ¥æ‰¾,æ¯”ORæ•ˆç‡æ›´é«˜ã€‚</p>
<p>21.è¡¨å­—ç¬¦é›†ä½¿ç”¨UTF8,å¿…è¦æ—¶å¯ç”³è¯·ä½¿ç”¨UTF8MB4å­—ç¬¦é›†ã€‚<br>a)UTF8å­—ç¬¦é›†å­˜å‚¨æ±‰å­—å ç”¨3ä¸ªå­—èŠ‚,å­˜å‚¨è‹±æ–‡å­—ç¬¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚</p>
<p>b)UTF8ç»Ÿä¸€è€Œä¸”é€šç”¨,ä¸ä¼šå‡ºç°è½¬ç å‡ºç°ä¹±ç é£é™©ã€‚</p>
<p>c)å¦‚æœé‡åˆ°EMOJç­‰è¡¨æƒ…ç¬¦å·çš„å­˜å‚¨éœ€æ±‚,å¯ç”³è¯·ä½¿ç”¨UTF8MB4å­—ç¬¦é›†ã€‚</p>
<p>22.ç”¨UNION ALLä»£æ›¿UNIONã€‚<br>UNION ALLä¸éœ€è¦å¯¹ç»“æœé›†å†è¿›è¡Œæ’åºã€‚</p>
<p>23.ç¦æ­¢ä½¿ç”¨order by rand()ã€‚<br>order by rand()ä¼šä¸ºè¡¨å¢åŠ ä¸€ä¸ªä¼ªåˆ—,ç„¶åç”¨rand()å‡½æ•°ä¸ºæ¯ä¸€è¡Œæ•°æ®è®¡ç®—å‡ºrand()å€¼,ç„¶ååŸºäºè¯¥è¡Œæ’åº, è¿™é€šå¸¸éƒ½ä¼šç”Ÿæˆç£ç›˜ä¸Šçš„ä¸´æ—¶è¡¨,å› æ­¤æ•ˆç‡éå¸¸ä½ã€‚å»ºè®®å…ˆä½¿ç”¨rand()å‡½æ•°è·å¾—éšæœºçš„ä¸»é”®å€¼,ç„¶åé€šè¿‡ä¸»é”®è·å–æ•°æ®ã€‚</p>
<p>24.å»ºè®®ä½¿ç”¨åˆç†çš„åˆ†é¡µæ–¹å¼ä»¥æé«˜åˆ†é¡µæ•ˆç‡ã€‚<br>ç¬¬ä¸€ç§åˆ†é¡µå†™æ³•ï¼š</p>
<p>select *<br>  from t<br> where thread_id = 771025<br>   and deleted = 0<br> order by gmt_create asc limit 0, 15;</p>
<p> åŸç†ï¼šä¸€æ¬¡æ€§æ ¹æ®è¿‡æ»¤æ¡ä»¶å–å‡ºæ‰€æœ‰å­—æ®µè¿›è¡Œæ’åºè¿”å›ã€‚</p>
<p> æ•°æ®è®¿é—®å¼€é”€=ç´¢å¼•IO+ç´¢å¼•å…¨éƒ¨è®°å½•ç»“æœå¯¹åº”çš„è¡¨æ•°æ®IO</p>
<p> ç¼ºç‚¹ï¼šè¯¥ç§å†™æ³•è¶Šç¿»åˆ°åé¢æ‰§è¡Œæ•ˆç‡è¶Šå·®ï¼Œæ—¶é—´è¶Šé•¿ï¼Œå°¤å…¶è¡¨æ•°æ®é‡å¾ˆå¤§çš„æ—¶å€™ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šå½“ä¸­é—´ç»“æœé›†å¾ˆå°ï¼ˆ10000è¡Œä»¥ä¸‹ï¼‰æˆ–è€…æŸ¥è¯¢æ¡ä»¶å¤æ‚ï¼ˆæŒ‡æ¶‰åŠå¤šä¸ªä¸åŒæŸ¥è¯¢å­—æ®µæˆ–è€…å¤šè¡¨è¿æ¥ï¼‰æ—¶é€‚ç”¨ã€‚</p>
<p>ç¬¬äºŒç§åˆ†é¡µå†™æ³•ï¼š</p>
<p>select t.* from (</p>
<pre><code>select id from t

 where thread_id = 771025 and deleted = 0 order by gmt_create asc limit 0, 15) a, t </code></pre><p> where a.id = t.id;</p>
<p>å‰æï¼šå‡è®¾tè¡¨ä¸»é”®æ˜¯idåˆ—ï¼Œä¸”æœ‰è¦†ç›–ç´¢å¼•secondary key:(thread_id, deleted, gmt_create)</p>
<p>åŸç†ï¼šå…ˆæ ¹æ®è¿‡æ»¤æ¡ä»¶åˆ©ç”¨è¦†ç›–ç´¢å¼•å–å‡ºä¸»é”®idè¿›è¡Œæ’åºï¼Œå†è¿›è¡Œjoinæ“ä½œå–å‡ºå…¶ä»–å­—æ®µã€‚</p>
<p>æ•°æ®è®¿é—®å¼€é”€=ç´¢å¼•IO+ç´¢å¼•åˆ†é¡µåç»“æœï¼ˆä¾‹å­ä¸­æ˜¯15è¡Œï¼‰å¯¹åº”çš„è¡¨æ•°æ®IOã€‚</p>
<p>ä¼˜ç‚¹ï¼šæ¯æ¬¡ç¿»é¡µæ¶ˆè€—çš„èµ„æºå’Œæ—¶é—´éƒ½åŸºæœ¬ç›¸åŒï¼Œå°±åƒç¿»ç¬¬ä¸€é¡µä¸€æ ·ã€‚</p>
<p>é€‚ç”¨åœºæ™¯ï¼šå½“æŸ¥è¯¢å’Œæ’åºå­—æ®µï¼ˆå³whereå­å¥å’Œorder byå­å¥æ¶‰åŠçš„å­—æ®µï¼‰æœ‰å¯¹åº”è¦†ç›–ç´¢å¼•æ—¶ï¼Œä¸”ä¸­é—´ç»“æœé›†å¾ˆå¤§çš„æƒ…å†µæ—¶é€‚ç”¨ã€‚</p>
<p>25.SELECTåªè·å–å¿…è¦çš„å­—æ®µ,ç¦æ­¢ä½¿ç”¨SELECT *ã€‚<br>å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—;</p>
<p>èƒ½æœ‰æ•ˆåˆ©ç”¨è¦†ç›–ç´¢å¼•;</p>
<p>è¡¨ç»“æ„å˜æ›´å¯¹ç¨‹åºåŸºæœ¬æ— å½±å“ã€‚</p>
<p>26.SQLä¸­é¿å…å‡ºç°now()ã€rand()ã€sysdate()ã€current_user()ç­‰ä¸ç¡®å®šç»“æœçš„å‡½æ•°ã€‚<br>è¯­å¥çº§å¤åˆ¶åœºæ™¯ä¸‹,å¼•èµ·ä¸»ä»æ•°æ®ä¸ä¸€è‡´;ä¸ç¡®å®šå€¼çš„å‡½æ•°,äº§ç”Ÿçš„SQLè¯­å¥æ— æ³•åˆ©ç”¨QUERY CACHEã€‚ </p>
<p>27.é‡‡ç”¨åˆé€‚çš„åˆ†åº“åˆ†è¡¨ç­–ç•¥ã€‚ä¾‹å¦‚åƒåº“åè¡¨ã€ååº“ç™¾è¡¨ç­‰ã€‚<br>é‡‡ç”¨åˆé€‚çš„åˆ†åº“åˆ†è¡¨ç­–ç•¥,æœ‰åˆ©äºä¸šåŠ¡å‘å±•åæœŸå¿«é€Ÿå¯¹æ•°æ®åº“è¿›è¡Œæ°´å¹³æ‹†åˆ†,åŒæ—¶åˆ†åº“å¯ä»¥æœ‰æ•ˆåˆ©ç”¨MySQLçš„å¤šçº¿ç¨‹å¤åˆ¶ç‰¹æ€§ã€‚</p>
<p>28.å‡å°‘ä¸æ•°æ®åº“äº¤äº’æ¬¡æ•°,å°½é‡é‡‡ç”¨æ‰¹é‡SQLè¯­å¥ã€‚<br>ä½¿ç”¨ä¸‹é¢çš„è¯­å¥æ¥å‡å°‘å’Œdbçš„äº¤äº’æ¬¡æ•°:</p>
<p>a)INSERT â€¦ ON DUPLICATE KEY UPDATE</p>
<p>b)REPLACE INTO</p>
<p>c)INSERT IGNORE</p>
<p>d)INSERT INTO VALUES()</p>
<p>29.æ‹†åˆ†å¤æ‚SQLä¸ºå¤šä¸ªå°SQL,é¿å…å¤§äº‹åŠ¡ã€‚<br>ç®€å•çš„SQLå®¹æ˜“ä½¿ç”¨åˆ°MySQLçš„QUERY CACHE;å‡å°‘é”è¡¨æ—¶é—´ç‰¹åˆ«æ˜¯MyISAM;å¯ä»¥ä½¿ç”¨å¤šæ ¸CPUã€‚</p>
<p>30.å¯¹åŒä¸€ä¸ªè¡¨çš„å¤šæ¬¡alteræ“ä½œå¿…é¡»åˆå¹¶ä¸ºä¸€æ¬¡æ“ä½œã€‚<br>mysqlå¯¹è¡¨çš„ä¿®æ”¹ç»å¤§éƒ¨åˆ†æ“ä½œéƒ½éœ€è¦é”è¡¨å¹¶é‡å»ºè¡¨,è€Œé”è¡¨åˆ™ä¼šå¯¹çº¿ä¸Šä¸šåŠ¡é€ æˆå½±å“ã€‚ä¸ºå‡å°‘è¿™ç§å½±å“,å¿…é¡»æŠŠå¯¹è¡¨çš„å¤šæ¬¡alteræ“ä½œåˆå¹¶ä¸ºä¸€æ¬¡æ“ä½œã€‚ä¾‹å¦‚,è¦ç»™è¡¨tå¢åŠ ä¸€ä¸ªå­—æ®µb,åŒæ—¶ç»™å·²æœ‰çš„å­—æ®µaaå»ºç«‹ç´¢å¼•, é€šå¸¸çš„åšæ³•åˆ†ä¸ºä¸¤æ­¥:</p>
<p>alter table t add column b varchar(10);</p>
<p>ç„¶åå¢åŠ ç´¢å¼•:</p>
<p>alter table t add index idx_aa(aa);</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯:</p>
<p>alter table t add column b varchar(10),add index idx_aa(aa);</p>
<p>31.é¿å…ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ã€è‡ªå®šä¹‰å‡½æ•°ç­‰ã€‚<br>è¿™äº›é«˜çº§ç‰¹æ€§æœ‰æ€§èƒ½é—®é¢˜,ä»¥åŠæœªçŸ¥BUGè¾ƒå¤šã€‚ä¸šåŠ¡é€»è¾‘æ”¾åˆ°æ•°æ®åº“ä¼šé€ æˆæ•°æ®åº“çš„DDLã€SCALE OUTã€ SHARDINGç­‰å˜å¾—æ›´åŠ å›°éš¾ã€‚</p>
<p>32.ç¦æ­¢æœ‰superæƒé™çš„åº”ç”¨ç¨‹åºè´¦å·å­˜åœ¨ã€‚<br>å®‰å…¨ç¬¬ä¸€ã€‚superæƒé™ä¼šå¯¼è‡´read onlyå¤±æ•ˆ,å¯¼è‡´è¾ƒå¤šè¯¡å¼‚é—®é¢˜è€Œä¸”å¾ˆéš¾è¿½è¸ªã€‚</p>
<p>33.æäº¤çº¿ä¸Šå»ºè¡¨æ”¹è¡¨éœ€æ±‚,å¿…é¡»è¯¦ç»†æ³¨æ˜æ¶‰åŠåˆ°çš„æ‰€æœ‰SQLè¯­å¥(åŒ…æ‹¬INSERTã€DELETEã€UPDATE),ä¾¿äºDBAè¿›è¡Œå®¡æ ¸å’Œä¼˜åŒ–ã€‚<br>å¹¶ä¸åªæ˜¯SELECTè¯­å¥éœ€è¦ç”¨åˆ°ç´¢å¼•ã€‚UPDATEã€DELETEéƒ½éœ€è¦å…ˆå®šä½åˆ°æ•°æ®æ‰èƒ½æ‰§è¡Œå˜æ›´ã€‚å› æ­¤éœ€è¦ä¸šåŠ¡æä¾›æ‰€æœ‰çš„SQLè¯­å¥ä¾¿äºDBAå®¡æ ¸ã€‚</p>
<p>34.ä¸è¦åœ¨MySQLæ•°æ®åº“ä¸­å­˜æ”¾ä¸šåŠ¡é€»è¾‘ã€‚<br>æ•°æ®åº“æ˜¯æœ‰çŠ¶æ€çš„æœåŠ¡,å˜æ›´å¤æ‚è€Œä¸”é€Ÿåº¦æ…¢,å¦‚æœæŠŠä¸šåŠ¡é€»è¾‘æ”¾åˆ°æ•°æ®åº“ä¸­,å°†ä¼šé™åˆ¶ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ã€‚å»ºè®®æŠŠä¸šåŠ¡é€»è¾‘æå‰,æ”¾åˆ°å‰ç«¯æˆ–ä¸­é—´é€»è¾‘å±‚,è€ŒæŠŠæ•°æ®åº“ä½œä¸ºå­˜å‚¨å±‚,å®ç°é€»è¾‘ä¸å­˜å‚¨çš„åˆ†ç¦»ã€‚</p>
<h2 id="æ•°æ®åº“å¼€å‘è§„èŒƒ"><a href="#æ•°æ®åº“å¼€å‘è§„èŒƒ" class="headerlink" title="æ•°æ®åº“å¼€å‘è§„èŒƒ"></a>æ•°æ®åº“å¼€å‘è§„èŒƒ</h2><hr>
<p>å»ºè¡¨æ —å­ï¼š</p>
<p>CREATE TABLE user (<br><code>id</code> bigint(11) NOT NULL AUTO_INCREMENT,<br><code>user_id</code> bigint(11) NOT NULL COMMENT â€˜ç”¨æˆ·id<br>PRIMARY KEY (<code>id</code>),<br>UNIQUE KEY <code>ind_user_id</code> (<code>user_id</code>),<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=â€™ç½‘ç«™ç”¨æˆ·åŸºæœ¬ä¿¡æ¯â€™;</p>
<hr>
<p>inceptionå¼ºåˆ¶é™åˆ¶</p>
<p>å»ºè¡¨&amp;ç´¢å¼•</p>
<p>1ï¼è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼Œä¸»é”®ä¸ºID,ç±»å‹int æˆ–è€… bigintã€‚<br>è§£è¯»ï¼š<br>a,æ— ä¸»é”®çš„è¡¨ï¼Œåœ¨rowæ¨¡å¼ä¸‹ä¸»ä»å»¶è¿Ÿæ›´é«˜ã€‚<br>b,ä¸»é”®è¦é€‰æ‹©è¾ƒçŸ­çš„æ•°æ®ç±»å‹ï¼ŒInnodbå¼•æ“æ™®é€šç´¢å¼•éƒ½ä¼šä¿å­˜ä¸»é”®çš„å€¼ï¼Œä¸»é”®å°åˆ™ç´¢å¼•å°ã€‚</p>
<p>2, å»ºè¡¨æ—¶ï¼Œåˆ—æ²¡æœ‰æ³¨é‡Šæ—¶æŠ¥é”™ã€‚è¡¨æ²¡æœ‰æ³¨é‡Šæ—¶æŠ¥é”™ã€‚</p>
<p>3, ç¦æ­¢ä½¿ç”¨ä¸­æ–‡æˆ–è€…ç‰¹æ®Šå­—ç¬¦æˆ–è€…SQLä¿ç•™å­—ã€‚</p>
<p>4ï¼Œä¸æ”¯æŒï¼šåˆ†åŒºè¡¨ã€‚ä»…æ”¯æŒå­—ç¬¦é›†ï¼šutf8mb4,utf8ã€‚</p>
<p>5ï¼Œå•è¡¨ç´¢å¼•ä¸ªæ•°ä¸è¶…è¿‡15ä¸ªï¼Œå¤åˆç´¢å¼•åˆ—å€¼ä¸è¶…è¿‡5ä¸ªã€‚</p>
<p>6ï¼Œæ”¯æŒåˆ—è®¾ç½®å­—ç¬¦é›†ï¼Œæ”¯æŒåˆ—å€¼ä¸ºç©ºã€‚æ”¯æŒBLOBå­—æ®µï¼Œä¸æ”¯æŒenum set bitã€‚æ”¯æŒå¤–é”®ã€‚ï¼ˆä¸å»ºè®®ä½¿ç”¨BLOB, ä¸å»ºè®®ä½¿ç”¨å¤–é”®ï¼‰</p>
<p>7ï¼Œå½“charç±»å‹çš„é•¿åº¦å¤§äº36ï¼Œå°±å¿…é¡»å°†å…¶è½¬æ¢ä¸ºVARCHARã€‚</p>
<p>8ï¼Œtimestampè®¾ç½®ä¸ºnot nullä¹‹åï¼Œé»˜è®¤å€¼ä¸èƒ½ä¸ºâ€™0000-00-00 00:00:00â€™ã€‚</p>
<p>9ï¼Œid ä¸ºä¸»é”®æ—¶ï¼Œä¸èƒ½è®¾ç½®é»˜è®¤å€¼</p>
<p>æ•°æ®ä¿®æ”¹</p>
<p>1ï¼Œæ•°æ®ä¿®æ”¹ç¦æ­¢ä½¿ç”¨LIMITï¼ŒOrder Byï¼Œåœ¨DMLè¯­å¥ä¸­æ²¡æœ‰WHEREæ¡ä»¶æ—¶ï¼ŒæŠ¥é”™ã€‚</p>
<p>2ï¼Œç¦æ­¢å•æ¬¡ä¿®æ”¹è¶…è¿‡1äº¿è¡Œã€‚</p>
<p>3ï¼Œdrop truncateæ“ä½œä¸æ”¯æŒã€‚</p>
<p>4ï¼Œdeleteéœ€è¦å†™whereæ¡ä»¶ã€‚</p>
<hr>
<p>éå¼ºåˆ¶ï¼Œå¼ºçƒˆå»ºè®®ã€‚</p>
<ol>
<li>åº“ï¼Œè¡¨ï¼Œå­—æ®µåç§°ä¸€å¾‹å°å†™ã€‚ä¸‹åˆ’çº¿åˆ†éš”ã€‚</li>
</ol>
<p>2ï¼ç¦æ­¢ä½¿ç”¨procedureã€viewã€triggerã€Eventã€‚<br>è§£è¯»ï¼šä¸šåŠ¡é€»è¾‘æ”¾åˆ°æœåŠ¡å±‚ç›¸æ¯”procedureå…·å¤‡æ›´å¥½çš„æ‰©å±•æ€§ï¼Œä¹Ÿé™ä½DBçš„å¤æ‚åº¦ã€‚Eventæ˜¾è‘—å¢åŠ æ•°æ®åº“åˆ‡æ¢éš¾åº¦ã€‚</p>
<p>3ï¼ç¦æ­¢ä½¿ç”¨BLOBã€‚<br>è§£è¯»ï¼šå¤§æ–‡ä»¶ï¼Œå¤§ç…§ç‰‡ï¼ŒDBçš„è¯»ç­–ç•¥ä¸€èˆ¬ä¸ç¼“å­˜ã€‚</p>
<p>4ï¼Œç¦æ­¢ä½¿ç”¨å¤–é”®ã€‚<br>è§£è¯»ï¼šé€šè¿‡ä¸šåŠ¡é€»è¾‘æ¥è§£å†³ä¸»å¤–é”®å…³ç³»å·²ç»æ˜¯ä¸»æµäº†ã€‚</p>
<p>5ï¼å‘½åä½¿ç”¨è‹±æ–‡å•è¯ï¼Œé¿å…æ‹¼éŸ³ã€‚è¡¨åç§°ä¸èƒ½ç”¨åŒå¼•å·åŒ…å«ã€‚<br>æ —å­ï¼št_shiwu, t_foodsã€‚ä½ çœ‹ç€é€‰å§ã€‚</p>
<p>6.ç”¨DECIMALä»£æ›¿FLOATå’ŒDOUBLEå­˜å‚¨ç²¾ç¡®æµ®ç‚¹æ•°ã€‚</p>
<ol start="7">
<li><p>é‡‘é¢ç›¸å…³çš„æ•°æ®ç±»å‹å»ºè®®è®¾ç½®ä¸ºbigintï¼Œä»¥åˆ†è®¡ç®—ã€‚<br>è§£è¯»ï¼š ä¸åŒçš„æ ‡å‡†è®¡ç®—å‡ºæ¥çš„æ€»é‡‘é¢å¯èƒ½ä¸ä¸€è‡´ã€‚è¿™å¯æ˜¯é“¶å­ã€‚</p>
</li>
<li><p>çº¿ä¸Šæ•°æ®åªä¿ç•™å›ºå®šå‘¨æœŸçš„æ•°æ®ï¼ˆä¾‹å¦‚ï¼šåŠå¹´ï¼‰ï¼Œè¶…è¿‡10Gçš„è¡¨å¼ºåˆ¶å½’æ¡£ã€‚<br>è§£è¯»ï¼šçº¿ä¸Šæ•°æ®è¶Šå°‘ï¼Œçªç„¶å¯¼è‡´çš„æ€§èƒ½é—®é¢˜è¶Šå°‘ã€‚</p>
</li>
</ol>
<p>9ï¼æ¯ä¸ªè¡¨å¢åŠ æœ€åæ›´æ–°æ—¶é—´ã€‚<br>update_time timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT â€˜æœ€åæ›´æ–°æ—¶é—´â€™<br>è§£è¯»ï¼šæ•°æ®ç»„è¦æ±‚åšå¢é‡æ›´æ–°ç”¨ï¼Œæ­¤å­—æ®µä¹Ÿæ— éœ€ç»´æŠ¤ã€‚</p>
<ol start="10">
<li>æ–°çš„åº”ç”¨è®¿é—®DBè¯·å‘Šä¹‹åº”ç”¨çš„åŠŸèƒ½ï¼Œè¿æ¥æ•°ï¼Œé‡è¦æ€§ç­‰ï¼Œé™ä½å› ä¸ºç¼ºä¹æ²Ÿé€šé€ æˆçš„æ½œåœ¨é£é™©ã€‚<br>è§£è¯»ï¼šæ–°çš„mysqlç‰ˆæœ¬DBAä¼šæ§åˆ¶å•ç”¨æˆ·é»˜è®¤è¿æ¥æ•°300ï¼Œé¿å…å› ç¨‹åºbugå¯¼è‡´çš„è¿æ¥é£æš´ã€‚</li>
</ol>
<hr>
<p>æ€§èƒ½è§„èŒƒ</p>
<ol>
<li><p>åªä½¿ç”¨btreeç´¢å¼•ã€‚<br>è§£è¯»ï¼šç®€å•ï¼Œé«˜æ•ˆã€‚</p>
</li>
<li><p>æŸ¥è¯¢çš„å­—æ®µå»ºè®®åˆ›å»ºç´¢å¼•ã€‚ç‰¹åˆ«æ˜¯åœ¨é€‰æ‹©æ€§é«˜çš„åˆ—ã€‚<br>è§£è¯»ï¼šSELECTã€UPDATEã€DELETEè¯­å¥çš„WHEREæ¡ä»¶åˆ—ï¼›2ã€å¤šè¡¨JOINçš„å­—æ®µã€‚</p>
</li>
<li><p>ä¸åœ¨ä½åŸºæ•°åˆ—ä¸Šå»ºç«‹ç´¢å¼•ï¼Œä¾‹å¦‚â€˜æ€§åˆ«â€™ã€‚<br>è§£è¯»ï¼šä¸¾ä¸ªæ —å­ï¼š<br>0åˆ°100ï¼Œç´¢å¼•æŸ¥è¯¢1ï¼Œé€‰æ‹©åº¦é«˜ï¼Œèµ°ç´¢å¼•ã€‚<br>100ä¸ªäººï¼Œ50ç”·ï¼Œ50å¥³ï¼Œé€‰æ‹©åº¦ä½ï¼Œèµ°ç´¢å¼•æ€§èƒ½æ¯”å…¨è¡¨æ‰«ææ›´å·®ï¼Œæ‰€ä»¥é€‰æ‹©å…¨è¡¨æ‰«æã€‚<br>å…¨è¡¨æ‰«æï¼š åŠ è½½å¤šä¸ªæ•°æ®å—åˆ°å†…å­˜ã€‚<br>ç´¢å¼•ï¼š åŠ è½½å•ä¸ªç´¢å¼•å—ï¼ŒæŒ‡é’ˆåˆ°æ•°æ®å—ï¼ŒåŠ è½½æ•°æ®å—ã€‚</p>
</li>
</ol>
<p>4.é¿å…å†—ä½™æˆ–é‡å¤ç´¢å¼•ã€‚<br>è§£è¯»ï¼šè”åˆç´¢å¼•IX_a_b_c(a,b,c) ç›¸å½“äº (a) ã€(a,b) ã€(a,b,c)ï¼Œé‚£ä¹ˆç´¢å¼• (a) ã€(a,b) å°±æ˜¯å¤šä½™çš„ã€‚<br>ä½†æ˜¯ä¸ç›¸å½“äº(b)ã€ï¼ˆb,cï¼‰ã€‚</p>
<p>5.ä¸ä½¿ç”¨SELECT *ï¼Œåªè·å–å¿…è¦çš„å­—æ®µã€‚<br>è§£è¯»ï¼š<br>æ¶ˆè€—CPUå’ŒIOã€æ¶ˆè€—ç½‘ç»œå¸¦å®½ï¼›<br>æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚</p>
<p>6.é¿å…æ•°æ®ç±»å‹ä¸ä¸€è‡´ã€‚<br>SELECT * FROM t WHERE id = â€˜19â€™;<br>SELECT * FROM t WHERE id = 19;</p>
<p>8.ç¦æ­¢ä½¿ç”¨INSERT INTO t_xxx VALUES(xxx)ï¼Œå¿…é¡»æ˜¾ç¤ºæŒ‡å®šæ’å…¥çš„åˆ—å±æ€§ã€‚<br>è§£è¯»ï¼šå®¹æ˜“åœ¨å¢åŠ æˆ–è€…åˆ é™¤å­—æ®µåå‡ºç°ç¨‹åºBUG</p>
<p>9.ç¦æ­¢åœ¨WHEREæ¡ä»¶çš„å±æ€§ä¸Šä½¿ç”¨å‡½æ•°æˆ–è€…è¡¨è¾¾å¼ã€‚<br>è§£è¯»ï¼šSELECT uid FROM t_user WHERE from_unixtime(day)&gt;=â€™2017-02-15â€™ ä¼šå¯¼è‡´å…¨è¡¨æ‰«æ<br>æ­£ç¡®çš„å†™æ³•æ˜¯ï¼šSELECT uid FROM t_user WHERE day&gt;= unix_timestamp(â€˜2017-02-15 00:00:00â€™)</p>
<ol start="10">
<li><p>åˆ«ç”¨å‡½æ•°åœ¨å­—æ®µä¸Šï¼Œè¿™æ ·ä¸èµ°ç´¢å¼•ã€‚<br>æ•°å­—å­˜å‚¨ï¼š<br>æ€§èƒ½å·®ï¼šFROM_UNIXTIME(pay_time) &gt;= curdate()<br>æ€§èƒ½å¥½ï¼špay_time &gt;= UNIX_TIMESTAMP(CURDATE())</p>
</li>
<li><p>å…³é”®æ€§èƒ½ç‚¹å‡å°‘è¡¨å…³è”ï¼Œè§£è€¦ã€‚è¿™æ ·æ–¹ä¾¿æ‹†åˆ†ã€‚<br>æ —å­ï¼š<br>å¾ˆå¤šä¸šåŠ¡éƒ½æ˜¯å›´ç»•ç”¨æˆ·æ¥çš„ï¼Œæ‰€æœ‰å¾ˆå¤šçº¿ä¸Šä¸šåŠ¡éƒ½ç”¨ç”¨æˆ·è¡¨å…³è”ã€‚é•¿æ­¤ä»¥å¾€ï¼Œç³»ç»Ÿå°±å˜çš„ä¸å¯æ‹†åˆ†ï¼Œè€Œä¸”è‡ƒè‚¿ã€‚<br>æ­£ç¡®çš„å§¿åŠ¿å› ä¸ºæ˜¯ä»æ¥å£è·å–ç”¨æˆ·æ•°æ®ï¼Œè¿™æ ·å°±æ²¡æœ‰å¼ºåˆ¶çš„å…³è”å…³ç³»ï¼Œæ–¹ä¾¿ä¸šåŠ¡æ‹†åˆ†å’Œæ‰©å±•ã€‚</p>
</li>
</ol>
<hr>
]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ–‡ä»¶å†…å®¹æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­</title>
    <url>/2020/04/20/Python%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%8C%89%E8%A1%8C%E8%AF%BB%E5%8F%96%E5%88%B0%E5%88%97%E8%A1%A8%E4%B8%AD/</url>
    <content><![CDATA[<h2 id="Pythonæ–‡ä»¶å†…å®¹æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­"><a href="#Pythonæ–‡ä»¶å†…å®¹æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­" class="headerlink" title="Pythonæ–‡ä»¶å†…å®¹æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­"></a>Pythonæ–‡ä»¶å†…å®¹æŒ‰è¡Œè¯»å–åˆ°åˆ—è¡¨ä¸­</h2><h3 id="ç¤ºä¾‹æ–‡ä»¶å†…å®¹å¦‚ä¸‹"><a href="#ç¤ºä¾‹æ–‡ä»¶å†…å®¹å¦‚ä¸‹" class="headerlink" title="ç¤ºä¾‹æ–‡ä»¶å†…å®¹å¦‚ä¸‹:"></a>ç¤ºä¾‹æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hello</span><br><span class="line">World</span><br><span class="line">Python</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯è¿­ä»£æ–‡ä»¶å¯¹è±¡æ¯ä¸€è¡Œï¼Œå¹¶åšä¸€äº›å¤„ç†ï¼Œæ˜¯ä¸éœ€è¦å°†æ–‡ä»¶å¯¹è±¡è½¬æˆåˆ—è¡¨çš„ï¼Œå› ä¸ºæ–‡ä»¶å¯¹è±¡æœ¬èº«å¯è¿­ä»£ï¼Œè€Œä¸”æ˜¯æŒ‰è¡Œè¿­ä»£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;somefile&#39;, &#39;r&#39;) as f:</span><br><span class="line">    for line in f:</span><br><span class="line">        print(line, end&#x3D;&#39;&#39;)</span><br><span class="line">        </span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Hello</span><br><span class="line">World</span><br><span class="line">Python</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="è½¬æ¢ä¸ºåˆ—è¡¨è¿›è¡Œæ“ä½œ"><a href="#è½¬æ¢ä¸ºåˆ—è¡¨è¿›è¡Œæ“ä½œ" class="headerlink" title="è½¬æ¢ä¸ºåˆ—è¡¨è¿›è¡Œæ“ä½œ"></a>è½¬æ¢ä¸ºåˆ—è¡¨è¿›è¡Œæ“ä½œ</h3><ol>
<li>åŒ…å«æ¢è¡Œç¬¦</li>
</ol>
<ul>
<li>æ–¹å¼ä¸€<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;somefile&#39;,&#39;r&#39;) as f:</span><br><span class="line">    content &#x3D; list(f)</span><br><span class="line">    print(content)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">[&#39;Hello\n&#39;, &#39;World\n&#39;, &#39;Python&#39;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure></li>
<li>æ–¹å¼äºŒ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;somefile&#39;,&#39;r&#39;) as f:</span><br><span class="line">    content &#x3D; f.readlines()</span><br><span class="line">    print(content)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">[&#39;Hello\n&#39;, &#39;World\n&#39;, &#39;Python&#39;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
å…¶ä¸­ï¼Œcontentç»“æœéƒ½æ˜¯æ²¡æœ‰å»æ‰æ¯ä¸€è¡Œè¡Œå°¾çš„æ¢è¡Œç¬¦çš„(somefile.txtæ–‡ä»¶ä¸­æœ€åä¸€è¡Œæœ¬æ¥å°±æ²¡æœ‰æ¢è¡Œç¬¦)</li>
</ul>
<ol start="2">
<li>å»æ‰æ¢è¡Œç¬¦</li>
</ol>
<ul>
<li>æ–¹å¼ä¸€<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;somefile&#39;,&#39;r&#39;) as f:</span><br><span class="line">    content &#x3D; f.read().splitlines()</span><br><span class="line">    print(content)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">[&#39;Hello&#39;, &#39;World&#39;, &#39;Python&#39;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure></li>
<li>æ–¹å¼äºŒ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;somefile&#39;,&#39;r&#39;) as f:</span><br><span class="line">    content &#x3D; [line.rstrip(&#39;\n&#39;) for line in f]</span><br><span class="line">    print(content)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">[&#39;Hello&#39;, &#39;World&#39;, &#39;Python&#39;]</span><br><span class="line">&quot;&quot;&quot;    </span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">å…¶ä¸­ï¼Œcontentç»“æœéƒ½æ˜¯å»æ‰æ¯ä¸€è¡Œè¡Œå°¾çš„æ¢è¡Œç¬¦</span><br><span class="line"></span><br><span class="line">3. å»æ‰è¡Œé¦–è¡Œå°¾çš„ç©ºç™½å­—ç¬¦</span><br></pre></td></tr></table></figure>
with open(â€˜somefileâ€™,â€™râ€™) as f:<br>  content = [line.strip() for line in f]<br>  print(content)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### æŒ‰è¡Œè¯»å–æ–‡ä»¶å†…å®¹å¹¶å¾—åˆ°å½“å‰è¡Œå·</span><br><span class="line">æ–‡ä»¶å¯¹è±¡æ˜¯å¯è¿­ä»£çš„ï¼ˆæŒ‰è¡Œè¿­ä»£ï¼‰ï¼Œä½¿ç”¨enumerate()å³å¯åœ¨è¿­ä»£çš„åŒæ—¶ï¼Œå¾—åˆ°æ•°å­—ç´¢å¼•(è¡Œå·),enumerate()çš„é»˜è®¤æ•°å­—åˆå§‹å€¼æ˜¯0ï¼Œå¦‚éœ€æŒ‡å®š1ä¸ºèµ·å§‹ï¼Œå¯ä»¥è®¾ç½®å…¶ç¬¬äºŒä¸ªå‚æ•°ï¼š</span><br></pre></td></tr></table></figure>
with open(â€˜somefileâ€™, â€˜râ€™) as f:<br>  for number, line in enumerate(f,start=1):<pre><code>print(number, line, end=&apos;&apos;)</code></pre>â€œâ€â€<br>1 Hello<br>2 World<br>3 Python<br>â€œâ€â€<pre><code>
</code></pre></li>
</ul>
<p><a href="http://www.revotu.com/read-file-to-list-by-line.html#more" target="_blank" rel="noopener">å‚è€ƒåšå®¢</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåœ¨å­—å…¸ä¸­å°†é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š</title>
    <url>/2020/04/20/Python%E5%9C%A8%E5%AD%97%E5%85%B8%E4%B8%AD%E5%B0%86%E9%94%AE%E6%98%A0%E5%B0%84%E5%88%B0%E5%A4%9A%E4%B8%AA%E5%80%BC%E4%B8%8A/</url>
    <content><![CDATA[<h2 id="Pythonåœ¨å­—å…¸ä¸­å°†é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š"><a href="#Pythonåœ¨å­—å…¸ä¸­å°†é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š" class="headerlink" title="Pythonåœ¨å­—å…¸ä¸­å°†é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š"></a>Pythonåœ¨å­—å…¸ä¸­å°†é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ä¸Š</h2><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªèƒ½å°†é”®ï¼ˆkeyï¼‰èƒ½æ˜ å°„åˆ°å¤šä¸ªå€¼çš„å­—å…¸ï¼ˆå³æ‰€è°“çš„ä¸€é”®å¤šå€¼å­—å…¸multidictï¼‰ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å­—å…¸æ˜¯ä¸€ç§å…³è”å®¹å™¨ã€‚æ¯ä¸ªé”®éƒ½æ˜ å°„åˆ°å•ç‹¬çš„å€¼ä¸Šã€‚å¦‚æœæƒ³è®©é”®æ˜ å°„åˆ°å¤šä¸ªå€¼ï¼Œéœ€è¦å°†è¿™å¤šä¸ªå€¼ä¿å­˜åˆ°å¦ä¸€ä¸ªå®¹å™¨å¦‚åˆ—è¡¨æˆ–é›†åˆä¸­ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šåƒè¿™æ ·åˆ›å»ºå­—å…¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">d &#x3D; &#123;</span><br><span class="line">    &#39;a&#39; : [1, 2, 3],</span><br><span class="line">    &#39;b&#39; : [4, 5]</span><br><span class="line">&#125;</span><br><span class="line">e &#x3D; &#123;</span><br><span class="line">    &#39;a&#39; : &#123;1, 2, 3&#125;,</span><br><span class="line">    &#39;b&#39; : &#123;4, 5&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¦ä½¿ç”¨åˆ—è¡¨è¿˜æ˜¯é›†åˆå®Œå…¨å–å†³äºåº”ç”¨çš„æ„å›¾ã€‚å¦‚æœå¸Œæœ›ä¿ç•™å…ƒç´ æ’å…¥çš„é¡ºåºï¼Œå°±ç”¨åˆ—è¡¨ã€‚å¦‚æœå¸Œæœ›æ¶ˆé™¤é‡å¤å…ƒç´ ï¼ˆä¸”ä¸åœ¨æ„å®ƒä»¬çš„é¡ºåºï¼‰ï¼Œå°±ç”¨é›†åˆã€‚<br>ä¸ºäº†èƒ½æ–¹ä¾¿çš„åˆ›å»ºè¿™æ ·çš„å­—å…¸ï¼Œå¯ä»¥åˆ©ç”¨collectionsæ¨¡å—ä¸­çš„defaultdictç±»ã€‚defaultdictçš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å®ƒä¼šè‡ªåŠ¨åˆå§‹åŒ–ç¬¬ä¸€ä¸ªå€¼ï¼Œè¿™æ ·åªéœ€å…³æ³¨æ·»åŠ å…ƒç´ å³å¯ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from collections import defaultdict</span><br><span class="line">d &#x3D; defaultdict(list)</span><br><span class="line">d[&#39;a&#39;].append(1)</span><br><span class="line">d[&#39;a&#39;].append(2)</span><br><span class="line">d[&#39;a&#39;].append(3)</span><br><span class="line">d[&#39;b&#39;].append(4)</span><br><span class="line">d[&#39;b&#39;].append(5)</span><br><span class="line">print(d) # outputs : defaultdict(&lt;class &#39;list&#39;&gt;, &#123;&#39;a&#39;: [1, 2, 3], &#39;b&#39;: [4, 5]&#125;)</span><br><span class="line">d &#x3D; defaultdict(set)</span><br><span class="line">d[&#39;a&#39;].add(1)</span><br><span class="line">d[&#39;a&#39;].add(2)</span><br><span class="line">d[&#39;a&#39;].add(3)</span><br><span class="line">d[&#39;b&#39;].add(4)</span><br><span class="line">d[&#39;b&#39;].add(5)</span><br><span class="line">print(d) # outputs : defaultdict(&lt;class &#39;set&#39;&gt;, &#123;&#39;a&#39;: &#123;1, 2, 3&#125;, &#39;b&#39;: &#123;4, 5&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>å…³äºdefaultdictï¼Œéœ€è¦æ³¨æ„çš„ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œå®ƒä¼šè‡ªåŠ¨åˆ›å»ºå­—å…¸è¡¨é¡¹ä»¥å¾…ç¨åçš„è®¿é—®(å³ä½¿è¿™äº›è¡¨é¡¹å½“å‰åœ¨å­—å…¸ä¸­è¿˜æ²¡æœ‰æ‰¾åˆ°),ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from collections import defaultdict</span><br><span class="line">d &#x3D; defaultdict(list)</span><br><span class="line">if d[&#39;a&#39;]:</span><br><span class="line">    pass</span><br><span class="line">print(d) # outputs : defaultdict(&lt;class &#39;list&#39;&gt;, &#123;&#39;a&#39;: []&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸æƒ³è¦è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥åœ¨æ™®é€šçš„å­—å…¸ä¸Šè°ƒç”¨setdefault()æ–¹æ³•æ¥å–ä»£ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from collections import defaultdict</span><br><span class="line">d &#x3D; &#123;&#125;</span><br><span class="line">d.setdefault(&#39;a&#39;, []).append(1)</span><br><span class="line">d.setdefault(&#39;a&#39;, []).append(2)</span><br><span class="line">d.setdefault(&#39;a&#39;, []).append(3)</span><br><span class="line">d.setdefault(&#39;b&#39;, []).append(4)</span><br><span class="line">d.setdefault(&#39;b&#39;, []).append(5)</span><br><span class="line">print(d) # outputs : &#123;&#39;a&#39;: [1, 2, 3], &#39;b&#39;: [4, 5]&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæ€»æ„Ÿè§‰ä½¿ç”¨setdefault()æœ‰ç‚¹ä¸è‡ªç„¶ï¼Œæ›´åˆ«ææ¯æ¬¡è°ƒç”¨å®ƒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªåˆå§‹å€¼çš„æ–°å®ä¾‹äº†ï¼ˆä¾‹å­ä¸­çš„ç©ºåˆ—è¡¨[]ï¼‰ã€‚</p>
<h3 id="è®¨è®º"><a href="#è®¨è®º" class="headerlink" title="è®¨è®º"></a>è®¨è®º</h3><p>åŸåˆ™ä¸Šï¼Œæ„å»ºä¸€ä¸ªä¸€é”®å¤šå€¼å­—å…¸æ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä½†æ˜¯è¯•ç€è‡ªå·±å¯¹ç¬¬ä¸€ä¸ªå€¼åšåˆå§‹åŒ–æ“ä½œï¼Œè¿™å°±ä¼šå˜å¾—å¾ˆæ‚ä¹±ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½ä¼šå†™ä¸‹è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">d &#x3D; &#123;&#125;</span><br><span class="line">for key, value in pairs:</span><br><span class="line">    if key not in d:</span><br><span class="line">        d[key] &#x3D; value</span><br><span class="line">    d[key].append(value)</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">ä½¿ç”¨defaultdictåä»£ç ä¼šæ¸…æ™°å¾ˆå¤šï¼š</span><br></pre></td></tr></table></figure>
<p>d = defaultdict(list)<br>for key, value in pairs:<br>    d[key].append(value)</p>
<pre><code>
[åŸæ–‡åœ°å€](http://www.revotu.com/mapping-keys-to-multiple-values-in-a-dictionary.html)</code></pre>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°</title>
    <url>/2020/04/20/Python%E5%B0%8F%E6%8A%80%E5%B7%A7%E5%92%8C%E6%9C%89%E8%B6%A3%E7%9A%84%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/</url>
    <content><![CDATA[<h2 id="Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°"><a href="#Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°" class="headerlink" title="Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°"></a>Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°</h2><blockquote>
<p>ä¸€ä¸ªpythonå°æŠ€å·§çš„é›†åˆå’Œä¸€äº›å¾ˆæœ‰ç”¨çš„Pythonå†…ç½®å‡½æ•°,è¿™äº›å‡½æ•°ç®€ç›´æ˜¯å±Œçˆ†äº†ï¼Œæˆ‘è®¤ä¸ºæ¯ä¸ª Pythoner éƒ½åº”è¯¥çŸ¥é“è¿™äº›å‡½æ•°ã€‚</p>
</blockquote>
<h3 id="1-1-æ‹†ç®±"><a href="#1-1-æ‹†ç®±" class="headerlink" title="1.1 æ‹†ç®±"></a>1.1 æ‹†ç®±</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, b, c &#x3D; 1, 2, 3  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 2, 3)  </span><br><span class="line">&gt;&gt;&gt; a, b, c &#x3D; [1, 2, 3]  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 2, 3)  </span><br><span class="line">&gt;&gt;&gt; a, b, c &#x3D; (2 * i + 1  for i in range(3))  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 3, 5)  </span><br><span class="line">&gt;&gt;&gt; a, (b, c), d &#x3D; [1, (2, 3), 4]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; b  </span><br><span class="line">2  </span><br><span class="line">&gt;&gt;&gt; c  </span><br><span class="line">3  </span><br><span class="line">&gt;&gt;&gt; d  </span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="1-2-æ‹†ç®±å˜é‡äº¤æ¢"><a href="#1-2-æ‹†ç®±å˜é‡äº¤æ¢" class="headerlink" title="1.2 æ‹†ç®±å˜é‡äº¤æ¢"></a>1.2 æ‹†ç®±å˜é‡äº¤æ¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, b &#x3D; 1, 2  </span><br><span class="line">&gt;&gt;&gt; a, b &#x3D; b, a  </span><br><span class="line">&gt;&gt;&gt; a, b  </span><br><span class="line">(2, 1)</span><br></pre></td></tr></table></figure>
<h3 id="1-3-æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3"><a href="#1-3-æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3" class="headerlink" title="1.3 æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)"></a>1.3 æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, *b, c &#x3D; [1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; b  </span><br><span class="line">[2, 3, 4]  </span><br><span class="line">&gt;&gt;&gt; c  </span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<h3 id="1-4-è´Ÿæ•°ç´¢å¼•"><a href="#1-4-è´Ÿæ•°ç´¢å¼•" class="headerlink" title="1.4 è´Ÿæ•°ç´¢å¼•"></a>1.4 è´Ÿæ•°ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[-1]  </span><br><span class="line">10  </span><br><span class="line">&gt;&gt;&gt; a[-3]  </span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<h3 id="1-5-åˆ‡å‰²åˆ—è¡¨"><a href="#1-5-åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.5 åˆ‡å‰²åˆ—è¡¨"></a>1.5 åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[2:8]  </span><br><span class="line">[2, 3, 4, 5, 6, 7]</span><br></pre></td></tr></table></figure>
<h3 id="1-6-è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨"><a href="#1-6-è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.6 è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨"></a>1.6 è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[-4:-2]  </span><br><span class="line">[7, 8]</span><br></pre></td></tr></table></figure>
<h3 id="1-7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨"><a href="#1-7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨"></a>1.7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::2]  </span><br><span class="line">[0, 2, 4, 6, 8, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::3]  </span><br><span class="line">[0, 3, 6, 9]  </span><br><span class="line">&gt;&gt;&gt; a[2:8:2]  </span><br><span class="line">[2, 4, 6]</span><br></pre></td></tr></table></figure>
<h3 id="1-8-è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨"><a href="#1-8-è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.8 è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨"></a>1.8 è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::-1]  </span><br><span class="line">[10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]  </span><br><span class="line">&gt;&gt;&gt; a[::-2]  </span><br><span class="line">[10, 8, 6, 4, 2, 0]</span><br></pre></td></tr></table></figure>
<h3 id="1-9-åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"><a href="#1-9-åˆ—è¡¨åˆ‡å‰²èµ‹å€¼" class="headerlink" title="1.9 åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"></a>1.9 åˆ—è¡¨åˆ‡å‰²èµ‹å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[2:3] &#x3D; [0, 0]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 2, 0, 0, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[1:1] &#x3D; [8, 9]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 8, 9, 2, 0, 0, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[1:-1] &#x3D; []  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 5]</span><br></pre></td></tr></table></figure>
<h3 id="1-10-å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"><a href="#1-10-å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼" class="headerlink" title="1.10 å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"></a>1.10 å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; LASTTHREE &#x3D; slice(-3, None)  </span><br><span class="line">&gt;&gt;&gt; LASTTHREE  </span><br><span class="line">slice(-3, None, None)  </span><br><span class="line">&gt;&gt;&gt; a[LASTTHREE]  </span><br><span class="line">[3, 4, 5]</span><br></pre></td></tr></table></figure>
<h3 id="1-11-åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"><a href="#1-11-åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©" class="headerlink" title="1.11 åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"></a>1.11 åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3]  </span><br><span class="line">&gt;&gt;&gt; b &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]  </span><br><span class="line">&gt;&gt;&gt; z &#x3D; zip(a, b)  </span><br><span class="line">&gt;&gt;&gt; z  </span><br><span class="line">[(1, &#39;a&#39;), (2, &#39;b&#39;), (3, &#39;c&#39;)]  </span><br><span class="line">&gt;&gt;&gt; zip(*z)  </span><br><span class="line">[(1, 2, 3), (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)]</span><br></pre></td></tr></table></figure>
<h3 id="1-12-åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨"><a href="#1-12-åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨" class="headerlink" title="1.12 åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨"></a>1.12 åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5, 6]  </span><br><span class="line">&gt;&gt;&gt; zip(*([iter(a)] * 2))  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent &#x3D; lambda a, k: zip(*([iter(a)] * k))  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 3)  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 2)  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 1)  </span><br><span class="line">[(1,), (2,), (3,), (4,), (5,), (6,)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; zip(a[::2], a[1::2])  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; zip(a[::3], a[1::3], a[2::3])  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; group_adjacent &#x3D; lambda a, k: zip(*(a[i::k] for i in range(k)))  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 3)  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 2)  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 1)  </span><br><span class="line">[(1,), (2,), (3,), (4,), (5,), (6,)]</span><br></pre></td></tr></table></figure>
<h3 id="1-13-åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£"><a href="#1-13-åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£" class="headerlink" title="1.13 åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£"></a>1.13 åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def n_grams(a, n):  </span><br><span class="line">... z &#x3D; [iter(a[i:]) for i in range(n)]  </span><br><span class="line">... return zip(*z)  </span><br><span class="line">...  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5, 6]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 3)  </span><br><span class="line">[(1, 2, 3), (2, 3, 4), (3, 4, 5), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 2)  </span><br><span class="line">[(1, 2), (2, 3), (3, 4), (4, 5), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 4)  </span><br><span class="line">[(1, 2, 3, 4), (2, 3, 4, 5), (3, 4, 5, 6)]</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨å‹ç¼©å™¨åè½¬å­—å…¸"><a href="#ç”¨å‹ç¼©å™¨åè½¬å­—å…¸" class="headerlink" title="ç”¨å‹ç¼©å™¨åè½¬å­—å…¸"></a>ç”¨å‹ç¼©å™¨åè½¬å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;  </span><br><span class="line">&gt;&gt;&gt; m.items()  </span><br><span class="line">[(&#39;a&#39;, 1), (&#39;c&#39;, 3), (&#39;b&#39;, 2), (&#39;d&#39;, 4)]  </span><br><span class="line">&gt;&gt;&gt; zip(m.values(), m.keys())  </span><br><span class="line">[(1, &#39;a&#39;), (3, &#39;c&#39;), (2, &#39;b&#39;), (4, &#39;d&#39;)]  </span><br><span class="line">&gt;&gt;&gt; mi &#x3D; dict(zip(m.values(), m.keys()))  </span><br><span class="line">&gt;&gt;&gt; mi  </span><br><span class="line">&#123;1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;, 4: &#39;d&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-15-åˆ—è¡¨å±•å¼€"><a href="#1-15-åˆ—è¡¨å±•å¼€" class="headerlink" title="1.15 åˆ—è¡¨å±•å¼€"></a>1.15 åˆ—è¡¨å±•å¼€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [[1, 2], [3, 4], [5, 6]]  </span><br><span class="line">&gt;&gt;&gt; list(itertools.chain.from_iterable(a))  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; sum(a, [])  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; [x for l in a for x in l]  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]  </span><br><span class="line">&gt;&gt;&gt; [x for l1 in a for l2 in l1 for x in l2]  </span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, [3, 4], [[5, 6], [7, 8]]]  </span><br><span class="line">&gt;&gt;&gt; flatten &#x3D; lambda x: [y for l in x for y in flatten(l)] if type(x) is list else [x]  </span><br><span class="line">&gt;&gt;&gt; flatten(a)  </span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]</span><br></pre></td></tr></table></figure>
<h3 id="1-16-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#1-16-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="1.16 ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>1.16 ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; g &#x3D; (x ** 2  for x in xrange(10))  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">0  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">4  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">9  </span><br><span class="line">&gt;&gt;&gt; sum(x ** 3  for x in xrange(10))  </span><br><span class="line">2025  </span><br><span class="line">&gt;&gt;&gt; sum(x ** 3  for x in xrange(10) if x % 3 &#x3D;&#x3D; 1)  </span><br><span class="line">408</span><br></pre></td></tr></table></figure>
<h3 id="1-17-å­—å…¸æ¨å¯¼"><a href="#1-17-å­—å…¸æ¨å¯¼" class="headerlink" title="1.17 å­—å…¸æ¨å¯¼"></a>1.17 å­—å…¸æ¨å¯¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: x ** 2  for x in range(5)&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;0: 0, 1: 1, 2: 4, 3: 9, 4: 16&#125;  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: &#39;A&#39; + str(x) for x in range(10)&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;0: &#39;A0&#39;, 1: &#39;A1&#39;, 2: &#39;A2&#39;, 3: &#39;A3&#39;, 4: &#39;A4&#39;, 5: &#39;A5&#39;, 6: &#39;A6&#39;, 7: &#39;A7&#39;, 8: &#39;A8&#39;, 9: &#39;A9&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-18-ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸"><a href="#1-18-ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸" class="headerlink" title="1.18 ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸"></a>1.18 ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;&#39;d&#39;: 4, &#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3&#125;  </span><br><span class="line">&gt;&gt;&gt; &#123;v: k for k, v in m.items()&#125;  </span><br><span class="line">&#123;1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;, 4: &#39;d&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-19-å‘½åå…ƒç»„"><a href="#1-19-å‘½åå…ƒç»„" class="headerlink" title="1.19 å‘½åå…ƒç»„"></a>1.19 å‘½åå…ƒç»„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Point &#x3D; collections.namedtuple(&#39;Point&#39;, [&#39;x&#39;, &#39;y&#39;])  </span><br><span class="line">&gt;&gt;&gt; p &#x3D; Point(x&#x3D;1.0, y&#x3D;2.0)  </span><br><span class="line">&gt;&gt;&gt; p  </span><br><span class="line">Point(x&#x3D;1.0, y&#x3D;2.0)  </span><br><span class="line">&gt;&gt;&gt; p.x  </span><br><span class="line">1.0  </span><br><span class="line">&gt;&gt;&gt; p.y  </span><br><span class="line">2.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://python.jobbole.com/63320/" target="_blank" rel="noopener">æ›´å¤šè¯·æŸ¥çœ‹åŸæ–‡</a>  </p>
</blockquote>
<h3 id="å‡½æ•°éƒ¨åˆ†"><a href="#å‡½æ•°éƒ¨åˆ†" class="headerlink" title="å‡½æ•°éƒ¨åˆ†"></a>å‡½æ•°éƒ¨åˆ†</h3><h3 id="all-iterable"><a href="#all-iterable" class="headerlink" title="all(iterable)"></a>all(iterable)</h3><p>å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡(æ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ç­‰ï¼Œä¸‹åŒ)ä¸­çš„å…ƒç´ éƒ½æ˜¯true(æˆ–è€…ä¸ºç©º)çš„è¯è¿”å›True</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_all &#x3D; True  </span><br><span class="line">for item in iterable:  </span><br><span class="line">if  not item:  </span><br><span class="line">_all &#x3D; False  </span><br><span class="line">break  </span><br><span class="line">if _all:  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<p>æ›´ç®€ä¾¿çš„å†™æ³•æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if all(iterable):  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>

<h3 id="any-iterable"><a href="#any-iterable" class="headerlink" title="any(iterable)"></a>any(iterable)</h3><p>å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ ä¸ºtrueçš„è¯è¿”å›True,å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸ºç©ºåˆ™è¿”å›False</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_any &#x3D; False  </span><br><span class="line">for item in iterable:  </span><br><span class="line">if item:  </span><br><span class="line">_any &#x3D; True  </span><br><span class="line">break  </span><br><span class="line">if _any:  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<p>æ›´ç®€ä¾¿çš„å†™æ³•æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if any(iterable):  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<h3 id="cmp-x-y"><a href="#cmp-x-y" class="headerlink" title="cmp(x, y)"></a>cmp(x, y)</h3><p>æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ x å’Œ y , x &lt; y çš„æ—¶å€™è¿”å›è´Ÿæ•°ï¼Œ x ==y çš„æ—¶å€™è¿”å› 0ï¼Œ x &gt; y çš„æ—¶å€™è¿”å›æ­£æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def compare(x,y):  </span><br><span class="line">if x &lt; y:  </span><br><span class="line">return -1  </span><br><span class="line">elif x &#x3D;&#x3D; y:  </span><br><span class="line">return  0  </span><br><span class="line">else:  </span><br><span class="line">return  1</span><br></pre></td></tr></table></figure>
<p>ä½ å®Œå…¨å¯ä»¥ä½¿ç”¨ä¸€å¥ cmp(x, y) æ¥æ›¿ä»£ã€‚</p>
<h3 id="dict-arg"><a href="#dict-arg" class="headerlink" title="dict([arg])"></a>dict([arg])</h3><p>ä½¿ç”¨ arg æä¾›çš„æ¡ç›®ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—å…¸ã€‚<br>arg é€šå¸¸æ˜¯æœªçŸ¥çš„ï¼Œä½†æ˜¯å®ƒå¾ˆæ–¹ä¾¿ï¼æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªå«ä¸¤ä¸ªå…ƒç»„çš„åˆ—è¡¨è½¬æ¢æˆä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l &#x3D; [(&#39;Knights&#39;, &#39;Ni&#39;), (&#39;Monty&#39;, &#39;Python&#39;), (&#39;SPAM&#39;, &#39;SPAAAM&#39;)]  </span><br><span class="line">d &#x3D; dict()  </span><br><span class="line">for tuple in l:  </span><br><span class="line">Â  Â d[tuple[0]] &#x3D; tuple[1]  </span><br><span class="line"># &#123;&#39;Knights&#39;: &#39;Ni&#39;, &#39;Monty&#39;: &#39;Python&#39;, &#39;SPAM&#39;: &#39;SPAAAM&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿™æ ·:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l &#x3D; [(&#39;Knights&#39;, &#39;Ni&#39;), (&#39;Monty&#39;, &#39;Python&#39;), (&#39;SPAM&#39;, &#39;SPAAAM&#39;)]  </span><br><span class="line">d &#x3D; dict(l) # &#123;&#39;Knights&#39;: &#39;Ni&#39;, &#39;Monty&#39;: &#39;Python&#39;, &#39;SPAM&#39;: &#39;SPAAAM&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="enumerate-iterable-start-0"><a href="#enumerate-iterable-start-0" class="headerlink" title="enumerate(iterable [,start=0])"></a>enumerate(iterable [,start=0])</h3><p>æˆ‘çœŸçš„æ˜¯è¶…çº§å–œæ¬¢è¿™ä¸ª!å¦‚æœä½ ä»¥å‰å†™è¿‡Cè¯­è¨€ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šè¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i in range(len(list)):  </span><br><span class="line"># do stuff with list[i], for example, print it  </span><br><span class="line">print i, list[i]</span><br></pre></td></tr></table></figure>
<p>å™¢,ä¸ç”¨é‚£ä¹ˆéº»çƒ¦!ä½ å¯ä»¥ä½¿ç”¨enumerate()æ¥æé«˜å¯è¯»æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i, item in enumerate(list):  </span><br><span class="line"># so stuff with item, for example print it  </span><br><span class="line">print i, item</span><br></pre></td></tr></table></figure>
<h3 id="isinstance-object-classinfo"><a href="#isinstance-object-classinfo" class="headerlink" title="isinstance(object, classinfo)"></a>isinstance(object, classinfo)</h3><p>å¦‚æœ object å‚æ•°æ˜¯ classinfo å‚æ•°çš„ä¸€ä¸ªå®ä¾‹æˆ–è€…å­ç±»(ç›´æ¥æˆ–è€…é—´æ¥)çš„è¯è¿”å› True<br>å½“ä½ æƒ³æ£€éªŒä¸€ä¸ªå¯¹è±¡çš„ç±»å‹çš„æ—¶å€™,ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„åº”è¯¥æ˜¯ä½¿ç”¨type()å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if type(obj) &#x3D;&#x3D; type(dict):  </span><br><span class="line"># do stuff  </span><br><span class="line">elif type(obj) &#x3D;&#x3D; type(list):  </span><br><span class="line"># do other stuff  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½ å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if isinstance(obj, dict):  </span><br><span class="line"># do stuff  </span><br><span class="line">elif isinstance(obj, list):  </span><br><span class="line"># do other stuff  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="pow-x-y-z"><a href="#pow-x-y-z" class="headerlink" title="pow(x, y [,z])"></a>pow(x, y [,z])</h3><p>è¿”å› x çš„ y æ¬¡å¹‚(å¦‚æœ z å­˜åœ¨çš„è¯åˆ™ä»¥ z ä¸ºæ¨¡)ã€‚<br>å¦‚æœä½ æƒ³è®¡ç®— x çš„ y æ¬¡æ–¹ï¼Œä»¥ z ä¸ºæ¨¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mod &#x3D; (x ** y) % z</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å½“ x=1234567ï¼Œ y=4567676ï¼Œ z=56 çš„æ—¶å€™æˆ‘çš„ç”µè„‘è¶³è¶³è·‘äº† 64 ç§’ï¼<br>ä¸è¦ç”¨ ** å’Œ % äº†ï¼Œä½¿ç”¨ pow(x, y, z) å§ï¼è¿™ä¸ªä¾‹å­å¯ä»¥å†™æˆ pow(1234567, 4567676, 56) ï¼Œåªç”¨äº† 0.034 ç§’å°±å‡ºäº†ç»“æœï¼</p>
<h3 id="zip-iterable"><a href="#zip-iterable" class="headerlink" title="zip([iterable, ])"></a>zip([iterable, ])</h3><p>è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå«å…ƒç»„çš„åˆ—è¡¨ï¼Œå…·ä½“è¯·çœ‹ä¾‹å­:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l1 &#x3D; (&#39;You gotta&#39;, &#39;the&#39;)  </span><br><span class="line">l2 &#x3D; (&#39;love&#39;, &#39;built-in&#39;)  </span><br><span class="line">out &#x3D; []  </span><br><span class="line">if len(l1) &#x3D;&#x3D; len(l2):  </span><br><span class="line">for i in range(len(l1)):  </span><br><span class="line">Â  Â  Â  Â out.append((l1[i], l2[i]))  </span><br><span class="line"># out &#x3D; [(&#39;You gotta&#39;, &#39;love&#39;), (&#39;the&#39;, &#39;built-in)]</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l1 &#x3D; [&#39;You gotta&#39;, &#39;the&#39;]  </span><br><span class="line">l2 &#x3D; [&#39;love&#39;, &#39;built-in&#39;]  </span><br><span class="line">out &#x3D; zip(l1, l2) # [(&#39;You gotta&#39;, &#39;love&#39;), (&#39;the&#39;, &#39;built-in)]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æƒ³å¾—åˆ°å€’åºçš„è¯åŠ ä¸Š * æ“ä½œç¬¦å°±å¯ä»¥äº†:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print zip(*out)  </span><br><span class="line"># [(&#39;You gotta&#39;, &#39;the&#39;), (&#39;love&#39;, &#39;built-in&#39;)]</span><br></pre></td></tr></table></figure>

<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>Python å†…ç½®å‡½æ•°å¾ˆæ–¹ä¾¿ï¼Œå®ƒä»¬å¾ˆå¿«å¹¶ä¸”ç»è¿‡äº†ä¼˜åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½æ•ˆç‡æ›´é«˜ã€‚<br>æˆ‘çœŸå¿ƒè®¤ä¸ºæ¯ä¸ª Python å¼€å‘è€…éƒ½åº”è¯¥å¥½å¥½çœ‹çœ‹å†…ç½®å‡½æ•°çš„æ–‡æ¡£(å¼•è¨€éƒ¨åˆ†)ã€‚<br>å¿˜äº†è¯´äº†ï¼Œåœ¨ itertools æ¨¡å—ä¸­æœ‰å¾ˆå¤šå¾ˆä¸é”™çš„å‡½æ•°ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonæ“ä½œMySQL</title>
    <url>/2020/04/20/Python%E6%93%8D%E4%BD%9CMySQL/</url>
    <content><![CDATA[<h2 id="Pythonæ“ä½œMySQL"><a href="#Pythonæ“ä½œMySQL" class="headerlink" title="Pythonæ“ä½œMySQL"></a>Pythonæ“ä½œMySQL</h2><h3 id="ä¸€-pythonæ“ä½œæ•°æ®åº“ä»‹ç»"><a href="#ä¸€-pythonæ“ä½œæ•°æ®åº“ä»‹ç»" class="headerlink" title="ä¸€. pythonæ“ä½œæ•°æ®åº“ä»‹ç»"></a>ä¸€. pythonæ“ä½œæ•°æ®åº“ä»‹ç»</h3><p>Python æ ‡å‡†æ•°æ®åº“æ¥å£ä¸º Python DB-APIï¼ŒPython DB-APIä¸ºå¼€å‘äººå‘˜æä¾›äº†æ•°æ®åº“åº”ç”¨ç¼–ç¨‹æ¥å£ã€‚<br>Python æ•°æ®åº“æ¥å£æ”¯æŒéå¸¸å¤šçš„æ•°æ®åº“ï¼Œä½ å¯ä»¥é€‰æ‹©é€‚åˆä½ é¡¹ç›®çš„æ•°æ®åº“ï¼š</p>
<ul>
<li>GadFly</li>
<li>mSQL</li>
<li>MySQL</li>
<li>PostgreSQL</li>
<li>Microsoft SQL Server 2000</li>
<li>Informix</li>
<li>Interbase</li>
<li>Oracle</li>
<li>Sybase</li>
<li>â€¦<br>ä½ å¯ä»¥è®¿é—®<a href="https://wiki.python.org/moin/DatabaseInterfaces" target="_blank" rel="noopener">Pythonæ•°æ®åº“æ¥å£åŠAPI</a>æŸ¥çœ‹è¯¦ç»†çš„æ”¯æŒæ•°æ®åº“åˆ—è¡¨ã€‚<br>ä¸åŒçš„æ•°æ®åº“ä½ éœ€è¦ä¸‹è½½ä¸åŒçš„DB APIæ¨¡å—ï¼Œä¾‹å¦‚ä½ éœ€è¦è®¿é—®Oracleæ•°æ®åº“å’ŒMysqlæ•°æ®ï¼Œä½ éœ€è¦ä¸‹è½½Oracleå’ŒMySQLæ•°æ®åº“æ¨¡å—ã€‚<br>DB-API æ˜¯ä¸€ä¸ªè§„èŒƒ. å®ƒå®šä¹‰äº†ä¸€ç³»åˆ—å¿…é¡»çš„å¯¹è±¡å’Œæ•°æ®åº“å­˜å–æ–¹å¼, ä»¥ä¾¿ä¸ºå„ç§å„æ ·çš„åº•å±‚æ•°æ®åº“ç³»ç»Ÿå’Œå¤šç§å¤šæ ·çš„æ•°æ®åº“æ¥å£ç¨‹åºæä¾›ä¸€è‡´çš„è®¿é—®æ¥å£ ã€‚<br>Pythonçš„DB-APIï¼Œä¸ºå¤§å¤šæ•°çš„æ•°æ®åº“å®ç°äº†æ¥å£ï¼Œä½¿ç”¨å®ƒè¿æ¥å„æ•°æ®åº“åï¼Œå°±å¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼æ“ä½œå„æ•°æ®åº“ã€‚</li>
</ul>
<p>Python DB-APIä½¿ç”¨æµç¨‹ï¼š<br>å¼•å…¥ API æ¨¡å—ã€‚<br>è·å–ä¸æ•°æ®åº“çš„è¿æ¥ã€‚<br>æ‰§è¡ŒSQLè¯­å¥å’Œå­˜å‚¨è¿‡ç¨‹ã€‚<br>å…³é—­æ•°æ®åº“è¿æ¥ã€‚</p>
<h2 id="äºŒ-pythonæ“ä½œMySQLæ¨¡å—"><a href="#äºŒ-pythonæ“ä½œMySQLæ¨¡å—" class="headerlink" title="äºŒ. pythonæ“ä½œMySQLæ¨¡å—"></a>äºŒ. pythonæ“ä½œMySQLæ¨¡å—</h2><p>Pythonæ“ä½œMySQLä¸»è¦ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>DBæ¨¡å—(åŸç”ŸSQL) <ul>
<li>PyMySQL(æ”¯æŒpython2.x/3.x)</li>
<li>MySQLdb(ç›®å‰ä»…æ”¯æŒpython2.x)</li>
</ul>
</li>
<li>ORMæ¡†æ¶<ul>
<li>SQLAchemy<h3 id="2-1-PyMySQLæ¨¡å—"><a href="#2-1-PyMySQLæ¨¡å—" class="headerlink" title="2.1 PyMySQLæ¨¡å—"></a>2.1 PyMySQLæ¨¡å—</h3>æœ¬æ–‡ä¸»è¦ä»‹ç»PyMySQLæ¨¡å—,MySQLdbä½¿ç”¨æ–¹å¼ç±»ä¼¼</li>
</ul>
</li>
</ol>
<h4 id="2-1-1-å®‰è£…PyMySQL"><a href="#2-1-1-å®‰è£…PyMySQL" class="headerlink" title="2.1.1 å®‰è£…PyMySQL"></a>2.1.1 å®‰è£…PyMySQL</h4><p>PyMySQLæ˜¯ä¸€ä¸ªPythonç¼–å†™çš„MySQLé©±åŠ¨ç¨‹åºï¼Œè®©æˆ‘ä»¬å¯ä»¥ç”¨Pythonè¯­è¨€æ“ä½œMySQLæ•°æ®åº“ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install PyMySQL</span><br></pre></td></tr></table></figure>

<h3 id="2-2-åŸºæœ¬ä½¿ç”¨"><a href="#2-2-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.2 åŸºæœ¬ä½¿ç”¨"></a>2.2 åŸºæœ¬ä½¿ç”¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¿æ¥</span><br><span class="line">conn &#x3D; pymysql.connect(host&#x3D;&quot;127.0.0.1&quot;, port&#x3D;3306, user&#x3D;&#39;zff&#39;, passwd&#x3D;&#39;zff123&#39;, db&#x3D;&#39;zff&#39;, charset&#x3D;&#39;utf8mb4&#39;)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¸¸æ ‡(æŸ¥è¯¢æ•°æ®è¿”å›ä¸ºå…ƒç»„æ ¼å¼)</span><br><span class="line"># cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¸¸æ ‡(æŸ¥è¯¢æ•°æ®è¿”å›ä¸ºå­—å…¸æ ¼å¼)</span><br><span class="line">cursor &#x3D; conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"># 1. æ‰§è¡ŒSQL,è¿”å›å—å½±å“çš„è¡Œæ•°</span><br><span class="line">effect_row1 &#x3D; cursor.execute(&quot;select * from USER&quot;)</span><br><span class="line"></span><br><span class="line"># 2. æ‰§è¡ŒSQL,è¿”å›å—å½±å“çš„è¡Œæ•°,ä¸€æ¬¡æ’å…¥å¤šè¡Œæ•°æ®</span><br><span class="line">effect_row2 &#x3D; cursor.executemany(&quot;insert into USER (NAME) values(%s)&quot;, [(&quot;jack&quot;), (&quot;boom&quot;), (&quot;lucy&quot;)])  # 3</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢æ‰€æœ‰æ•°æ®,è¿”å›æ•°æ®ä¸ºå…ƒç»„æ ¼å¼</span><br><span class="line">result &#x3D; cursor.fetchall()</span><br><span class="line"></span><br><span class="line"># å¢&#x2F;åˆ &#x2F;æ”¹å‡éœ€è¦è¿›è¡Œcommitæäº¤,è¿›è¡Œä¿å­˜</span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"># å…³é—­æ¸¸æ ‡</span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line"># å…³é—­è¿æ¥</span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line">print(result)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">[&#123;&#39;id&#39;: 6, &#39;name&#39;: &#39;boom&#39;&#125;, &#123;&#39;id&#39;: 5, &#39;name&#39;: &#39;jack&#39;&#125;, &#123;&#39;id&#39;: 7, &#39;name&#39;: &#39;lucy&#39;&#125;, &#123;&#39;id&#39;: 4, &#39;name&#39;: &#39;tome&#39;&#125;, &#123;&#39;id&#39;: 3, &#39;name&#39;: &#39;zff&#39;&#125;, &#123;&#39;id&#39;: 1, &#39;name&#39;: &#39;zhaofengfeng&#39;&#125;, &#123;&#39;id&#39;: 2, &#39;name&#39;: &#39;zhaofengfeng02&#39;&#125;]</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-è·å–æœ€æ–°åˆ›å»ºçš„æ•°æ®è‡ªå¢ID"><a href="#2-3-è·å–æœ€æ–°åˆ›å»ºçš„æ•°æ®è‡ªå¢ID" class="headerlink" title="2.3 è·å–æœ€æ–°åˆ›å»ºçš„æ•°æ®è‡ªå¢ID"></a>2.3 è·å–æœ€æ–°åˆ›å»ºçš„æ•°æ®è‡ªå¢ID</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¿æ¥</span><br><span class="line">conn &#x3D; pymysql.connect(host&#x3D;&quot;127.0.0.1&quot;, port&#x3D;3306, user&#x3D;&#39;zff&#39;, passwd&#x3D;&#39;zff123&#39;, db&#x3D;&#39;zff&#39;, charset&#x3D;&#39;utf8mb4&#39;)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¸¸æ ‡(æŸ¥è¯¢æ•°æ®è¿”å›ä¸ºå…ƒç»„æ ¼å¼)</span><br><span class="line">cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line"># è·å–æ–°åˆ›å»ºæ•°æ®è‡ªå¢ID</span><br><span class="line">effect_row &#x3D; cursor.executemany(&quot;insert into USER (NAME)values(%s)&quot;, [(&quot;eric&quot;)])</span><br><span class="line"></span><br><span class="line"># å¢åˆ æ”¹å‡éœ€è¦è¿›è¡Œcommitæäº¤</span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line"># å…³é—­æ¸¸æ ‡</span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line"># å…³é—­è¿æ¥</span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line">new_id &#x3D; cursor.lastrowid</span><br><span class="line">print(new_id)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">8</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-æŸ¥è¯¢æ“ä½œ"><a href="#2-4-æŸ¥è¯¢æ“ä½œ" class="headerlink" title="2.4 æŸ¥è¯¢æ“ä½œ"></a>2.4 æŸ¥è¯¢æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¿æ¥</span><br><span class="line">conn &#x3D; pymysql.connect(host&#x3D;&quot;127.0.0.1&quot;, port&#x3D;3306, user&#x3D;&#39;zff&#39;, passwd&#x3D;&#39;zff123&#39;, db&#x3D;&#39;zff&#39;, charset&#x3D;&#39;utf8mb4&#39;)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¸¸æ ‡</span><br><span class="line">cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(&quot;select * from USER&quot;)</span><br><span class="line"></span><br><span class="line"># è·å–ç¬¬ä¸€è¡Œæ•°æ®</span><br><span class="line">row_1 &#x3D; cursor.fetchone()</span><br><span class="line"></span><br><span class="line"># è·å–å‰nè¡Œæ•°æ®</span><br><span class="line">row_2 &#x3D; cursor.fetchmany(3)</span><br><span class="line">#</span><br><span class="line"># # è·å–æ‰€æœ‰æ•°æ®</span><br><span class="line">row_3 &#x3D; cursor.fetchall()</span><br><span class="line"></span><br><span class="line"># å…³é—­æ¸¸æ ‡</span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line"># å…³é—­è¿æ¥</span><br><span class="line">conn.close()</span><br><span class="line">print(row_1)</span><br><span class="line">print(row_2)</span><br><span class="line">print(row_3)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ åœ¨fetchæ•°æ®æ—¶æŒ‰ç…§é¡ºåºè¿›è¡Œï¼Œå¯ä»¥ä½¿ç”¨cursor.scroll(num,mode)æ¥ç§»åŠ¨æ¸¸æ ‡ä½ç½®ï¼Œå¦‚ï¼š</p>
<ul>
<li>cursor.scroll(1,mode=â€™relativeâ€™)  # ç›¸å¯¹å½“å‰ä½ç½®ç§»åŠ¨</li>
<li>cursor.scroll(2,mode=â€™absoluteâ€™)  # ç›¸å¯¹ç»å¯¹ä½ç½®ç§»åŠ¨</li>
</ul>
<h3 id="2-5-é˜²æ­¢SQLæ³¨å…¥"><a href="#2-5-é˜²æ­¢SQLæ³¨å…¥" class="headerlink" title="2.5 é˜²æ­¢SQLæ³¨å…¥"></a>2.5 é˜²æ­¢SQLæ³¨å…¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºè¿æ¥</span><br><span class="line">conn &#x3D; pymysql.connect(host&#x3D;&quot;127.0.0.1&quot;, port&#x3D;3306, user&#x3D;&#39;zff&#39;, passwd&#x3D;&#39;zff123&#39;, db&#x3D;&#39;zff&#39;, charset&#x3D;&#39;utf8mb4&#39;)</span><br><span class="line"></span><br><span class="line"># åˆ›å»ºæ¸¸æ ‡</span><br><span class="line">cursor &#x3D; conn.cursor()</span><br><span class="line"></span><br><span class="line"># å­˜åœ¨sqlæ³¨å…¥æƒ…å†µ(ä¸è¦ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹å¼æ‹¼æ¥SQL)</span><br><span class="line">sql &#x3D; &quot;insert into USER (NAME) values(&#39;%s&#39;)&quot; % (&#39;zhangsan&#39;,)</span><br><span class="line">effect_row &#x3D; cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"># æ­£ç¡®æ–¹å¼ä¸€</span><br><span class="line"># executeå‡½æ•°æ¥å—ä¸€ä¸ªå…ƒç»„&#x2F;åˆ—è¡¨ä½œä¸ºSQLå‚æ•°,å…ƒç´ ä¸ªæ•°åªèƒ½æœ‰1ä¸ª</span><br><span class="line">sql &#x3D; &quot;insert into USER (NAME) values(%s)&quot;</span><br><span class="line">effect_row1 &#x3D; cursor.execute(sql, [&#39;wang6&#39;])</span><br><span class="line">effect_row2 &#x3D; cursor.execute(sql, (&#39;wang7&#39;,))</span><br><span class="line"></span><br><span class="line"># æ­£ç¡®æ–¹å¼äºŒ</span><br><span class="line">sql &#x3D; &quot;insert into USER (NAME) values(%(name)s)&quot;</span><br><span class="line">effect_row1 &#x3D; cursor.execute(sql, &#123;&#39;name&#39;: &#39;wudalang&#39;&#125;)</span><br><span class="line"></span><br><span class="line"># å†™å…¥æ’å…¥å¤šè¡Œæ•°æ®</span><br><span class="line">effect_row2 &#x3D; cursor.executemany(&quot;insert into USER (NAME) values(%s)&quot;, [(&#39;ermazi&#39;), (&#39;dianxiaoer&#39;)])</span><br><span class="line"></span><br><span class="line"># æäº¤</span><br><span class="line">conn.commit()</span><br><span class="line"># å…³é—­æ¸¸æ ‡</span><br><span class="line">cursor.close()</span><br><span class="line"># å…³é—­è¿æ¥</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼ŒSQLæ“ä½œå°±æ›´å®‰å…¨äº†ã€‚å¦‚æœéœ€è¦æ›´è¯¦ç»†çš„æ–‡æ¡£å‚è€ƒPyMySQLæ–‡æ¡£å§ã€‚ä¸è¿‡å¥½åƒè¿™äº›SQLæ•°æ®åº“çš„å®ç°è¿˜ä¸å¤ªä¸€æ ·ï¼ŒPyMySQLçš„å‚æ•°å ä½ç¬¦ä½¿ç”¨%sè¿™æ ·çš„Cæ ¼å¼åŒ–ç¬¦ï¼Œè€ŒPythonè‡ªå¸¦çš„sqlite3æ¨¡å—çš„å ä½ç¬¦å¥½åƒæ˜¯é—®å·(?)ã€‚å› æ­¤åœ¨ä½¿ç”¨å…¶ä»–æ•°æ®åº“çš„æ—¶å€™è¿˜æ˜¯ä»”ç»†é˜…è¯»æ–‡æ¡£å§ã€‚<br><a href="https://pymysql.readthedocs.io/en/latest/" target="_blank" rel="noopener">Welcome to PyMySQLâ€™s documentation</a></p>
<h2 id="ä¸‰-æ•°æ®åº“è¿æ¥æ± "><a href="#ä¸‰-æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="ä¸‰. æ•°æ®åº“è¿æ¥æ± "></a>ä¸‰. æ•°æ®åº“è¿æ¥æ± </h2><p>ä¸Šæ–‡ä¸­çš„æ–¹å¼å­˜åœ¨ä¸€ä¸ªé—®é¢˜,å•çº¿ç¨‹æƒ…å†µä¸‹å¯ä»¥æ»¡è¶³,ç¨‹åºéœ€è¦é¢‘ç¹çš„åˆ›å»ºé‡Šæ”¾è¿æ¥æ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œ,é‚£ä¹ˆ,æˆ‘ä»¬çš„ç¨‹åº/è„šæœ¬åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¼šå¼•å‘ä»€ä¹ˆé—®é¢˜å‘¢?æ­¤æ—¶,æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± æ¥è§£å†³è¿™ä¸ªé—®é¢˜!</p>
<h3 id="3-1-DBUtilsæ¨¡å—"><a href="#3-1-DBUtilsæ¨¡å—" class="headerlink" title="3.1 DBUtilsæ¨¡å—"></a>3.1 DBUtilsæ¨¡å—</h3><p>DBUtilsæ˜¯Pythonçš„ä¸€ä¸ªç”¨äºå®ç°æ•°æ®åº“è¿æ¥æ± çš„æ¨¡å—ã€‚</p>
<p>æ­¤è¿æ¥æ± æœ‰ä¸¤ç§è¿æ¥æ¨¡å¼ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œçº¿ç¨‹å³ä½¿è°ƒç”¨äº†closeæ–¹æ³•ï¼Œä¹Ÿä¸ä¼šå…³é—­ï¼Œåªæ˜¯æŠŠè¿æ¥é‡æ–°æ”¾åˆ°è¿æ¥æ± ï¼Œä¾›è‡ªå·±çº¿ç¨‹å†æ¬¡ä½¿ç”¨ã€‚å½“çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œè¿æ¥æ‰ä¼šè‡ªåŠ¨å…³é—­</li>
<li>åˆ›å»ºä¸€æ‰¹è¿æ¥åˆ°è¿æ¥æ± ï¼Œä¾›æ‰€æœ‰çº¿ç¨‹å…±äº«ä½¿ç”¨(æ¨èä½¿ç”¨)</li>
</ul>
<h3 id="3-2-æ¨¡å¼ä¸€"><a href="#3-2-æ¨¡å¼ä¸€" class="headerlink" title="3.2 æ¨¡å¼ä¸€"></a>3.2 æ¨¡å¼ä¸€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">from DBUtils.PersistentDB import PersistentDB</span><br><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">POOL &#x3D; PersistentDB(</span><br><span class="line">    creator&#x3D;pymysql,  # ä½¿ç”¨é“¾æ¥æ•°æ®åº“çš„æ¨¡å—</span><br><span class="line">    maxusage&#x3D;None,  # ä¸€ä¸ªé“¾æ¥æœ€å¤šè¢«é‡å¤ä½¿ç”¨çš„æ¬¡æ•°ï¼ŒNoneè¡¨ç¤ºæ— é™åˆ¶</span><br><span class="line">    setsession&#x3D;[],  # å¼€å§‹ä¼šè¯å‰æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚å¦‚ï¼š[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span><br><span class="line">    ping&#x3D;0,</span><br><span class="line">    # ping MySQLæœåŠ¡ç«¯ï¼Œæ£€æŸ¥æ˜¯å¦æœåŠ¡å¯ç”¨ã€‚# å¦‚ï¼š0 &#x3D; None &#x3D; never, 1 &#x3D; default &#x3D; whenever it is requested, 2 &#x3D; when a cursor is created, 4 &#x3D; when a query is executed, 7 &#x3D; always</span><br><span class="line">    closeable&#x3D;False,</span><br><span class="line">    # å¦‚æœä¸ºFalseæ—¶ï¼Œ conn.close() å®é™…ä¸Šè¢«å¿½ç•¥ï¼Œä¾›ä¸‹æ¬¡ä½¿ç”¨ï¼Œå†çº¿ç¨‹å…³é—­æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨å…³é—­é“¾æ¥ã€‚å¦‚æœä¸ºTrueæ—¶ï¼Œ conn.close()åˆ™å…³é—­é“¾æ¥ï¼Œé‚£ä¹ˆå†æ¬¡è°ƒç”¨pool.connectionæ—¶å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå·²ç»çœŸçš„å…³é—­äº†è¿æ¥ï¼ˆpool.steady_connection()å¯ä»¥è·å–ä¸€ä¸ªæ–°çš„é“¾æ¥ï¼‰</span><br><span class="line">    threadlocal&#x3D;None,  # æœ¬çº¿ç¨‹ç‹¬äº«å€¼å¾—å¯¹è±¡ï¼Œç”¨äºä¿å­˜é“¾æ¥å¯¹è±¡ï¼Œå¦‚æœé“¾æ¥å¯¹è±¡è¢«é‡ç½®</span><br><span class="line">    host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">    port&#x3D;3306,</span><br><span class="line">    user&#x3D;&#39;zff&#39;,</span><br><span class="line">    password&#x3D;&#39;zff123&#39;,</span><br><span class="line">    database&#x3D;&#39;zff&#39;,</span><br><span class="line">    charset&#x3D;&#39;utf8&#39;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func():</span><br><span class="line">    conn &#x3D; POOL.connection(shareable&#x3D;False)</span><br><span class="line">    cursor &#x3D; conn.cursor()</span><br><span class="line">    cursor.execute(&#39;select * from USER&#39;)</span><br><span class="line">    result &#x3D; cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result &#x3D; func()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<h3 id="3-2-æ¨¡å¼äºŒ"><a href="#3-2-æ¨¡å¼äºŒ" class="headerlink" title="3.2 æ¨¡å¼äºŒ"></a>3.2 æ¨¡å¼äºŒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import time</span><br><span class="line">import pymysql</span><br><span class="line">import threading</span><br><span class="line">from DBUtils.PooledDB import PooledDB, SharedDBConnection</span><br><span class="line"></span><br><span class="line">POOL &#x3D; PooledDB(</span><br><span class="line">    creator&#x3D;pymysql,  # ä½¿ç”¨é“¾æ¥æ•°æ®åº“çš„æ¨¡å—</span><br><span class="line">    maxconnections&#x3D;6,  # è¿æ¥æ± å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0å’ŒNoneè¡¨ç¤ºä¸é™åˆ¶è¿æ¥æ•°</span><br><span class="line">    mincached&#x3D;2,  # åˆå§‹åŒ–æ—¶ï¼Œé“¾æ¥æ± ä¸­è‡³å°‘åˆ›å»ºçš„ç©ºé—²çš„é“¾æ¥ï¼Œ0è¡¨ç¤ºä¸åˆ›å»º</span><br><span class="line">    maxcached&#x3D;5,  # é“¾æ¥æ± ä¸­æœ€å¤šé—²ç½®çš„é“¾æ¥ï¼Œ0å’ŒNoneä¸é™åˆ¶</span><br><span class="line">    maxshared&#x3D;3,</span><br><span class="line">    # é“¾æ¥æ± ä¸­æœ€å¤šå…±äº«çš„é“¾æ¥æ•°é‡ï¼Œ0å’ŒNoneè¡¨ç¤ºå…¨éƒ¨å…±äº«ã€‚PS: æ— ç”¨ï¼Œå› ä¸ºpymysqlå’ŒMySQLdbç­‰æ¨¡å—çš„ threadsafetyéƒ½ä¸º1ï¼Œæ‰€æœ‰å€¼æ— è®ºè®¾ç½®ä¸ºå¤šå°‘ï¼Œ_maxcachedæ°¸è¿œä¸º0ï¼Œæ‰€ä»¥æ°¸è¿œæ˜¯æ‰€æœ‰é“¾æ¥éƒ½å…±äº«ã€‚</span><br><span class="line">    blocking&#x3D;True,  # è¿æ¥æ± ä¸­å¦‚æœæ²¡æœ‰å¯ç”¨è¿æ¥åï¼Œæ˜¯å¦é˜»å¡ç­‰å¾…ã€‚Trueï¼Œç­‰å¾…ï¼›Falseï¼Œä¸ç­‰å¾…ç„¶åæŠ¥é”™</span><br><span class="line">    maxusage&#x3D;None,  # ä¸€ä¸ªé“¾æ¥æœ€å¤šè¢«é‡å¤ä½¿ç”¨çš„æ¬¡æ•°ï¼ŒNoneè¡¨ç¤ºæ— é™åˆ¶</span><br><span class="line">    setsession&#x3D;[],  # å¼€å§‹ä¼šè¯å‰æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚å¦‚ï¼š[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span><br><span class="line">    ping&#x3D;0,</span><br><span class="line">    # ping MySQLæœåŠ¡ç«¯ï¼Œæ£€æŸ¥æ˜¯å¦æœåŠ¡å¯ç”¨ã€‚# å¦‚ï¼š0 &#x3D; None &#x3D; never, 1 &#x3D; default &#x3D; whenever it is requested, 2 &#x3D; when a cursor is created, 4 &#x3D; when a query is executed, 7 &#x3D; always</span><br><span class="line">    host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">    port&#x3D;3306,</span><br><span class="line">    user&#x3D;&#39;zff&#39;,</span><br><span class="line">    password&#x3D;&#39;zff123&#39;,</span><br><span class="line">    database&#x3D;&#39;zff&#39;,</span><br><span class="line">    charset&#x3D;&#39;utf8&#39;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def func():</span><br><span class="line">    # æ£€æµ‹å½“å‰æ­£åœ¨è¿è¡Œè¿æ¥æ•°çš„æ˜¯å¦å°äºæœ€å¤§é“¾æ¥æ•°ï¼Œå¦‚æœä¸å°äºåˆ™ï¼šç­‰å¾…æˆ–æŠ¥raise TooManyConnectionså¼‚å¸¸</span><br><span class="line">    # å¦åˆ™</span><br><span class="line">    # åˆ™ä¼˜å…ˆå»åˆå§‹åŒ–æ—¶åˆ›å»ºçš„é“¾æ¥ä¸­è·å–é“¾æ¥ SteadyDBConnectionã€‚</span><br><span class="line">    # ç„¶åå°†SteadyDBConnectionå¯¹è±¡å°è£…åˆ°PooledDedicatedDBConnectionä¸­å¹¶è¿”å›ã€‚</span><br><span class="line">    # å¦‚æœæœ€å¼€å§‹åˆ›å»ºçš„é“¾æ¥æ²¡æœ‰é“¾æ¥ï¼Œåˆ™å»åˆ›å»ºä¸€ä¸ªSteadyDBConnectionå¯¹è±¡ï¼Œå†å°è£…åˆ°PooledDedicatedDBConnectionä¸­å¹¶è¿”å›ã€‚</span><br><span class="line">    # ä¸€æ—¦å…³é—­é“¾æ¥åï¼Œè¿æ¥å°±è¿”å›åˆ°è¿æ¥æ± è®©åç»­çº¿ç¨‹ç»§ç»­ä½¿ç”¨ã€‚</span><br><span class="line">    conn &#x3D; POOL.connection()</span><br><span class="line"></span><br><span class="line">    # print(&#39;è¿æ¥è¢«æ‹¿èµ°äº†&#39;, conn._con)</span><br><span class="line">    # print(&#39;æ± å­é‡Œç›®å‰æœ‰&#39;, POOL._idle_cache, &#39;\r\n&#39;)</span><br><span class="line"></span><br><span class="line">    cursor &#x3D; conn.cursor()</span><br><span class="line">    cursor.execute(&#39;select * from USER&#39;)</span><br><span class="line">    result &#x3D; cursor.fetchall()</span><br><span class="line">    conn.close()</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result &#x3D; func()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ ç”±äºpymysqlã€MySQLdbç­‰threadsafetyå€¼ä¸º1ï¼Œæ‰€ä»¥è¯¥æ¨¡å¼è¿æ¥æ± ä¸­çš„çº¿ç¨‹ä¼šè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«,å› æ­¤æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>å¦‚æœæ²¡æœ‰è¿æ¥æ± ï¼Œä½¿ç”¨pymysqlæ¥è¿æ¥æ•°æ®åº“æ—¶ï¼Œå•çº¿ç¨‹åº”ç”¨å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæ¶‰åŠåˆ°å¤šçº¿ç¨‹åº”ç”¨é‚£ä¹ˆå°±éœ€è¦åŠ é”ï¼Œä¸€æ—¦åŠ é”é‚£ä¹ˆè¿æ¥åŠ¿å¿…å°±ä¼šæ’é˜Ÿç­‰å¾…ï¼Œå½“è¯·æ±‚æ¯”è¾ƒå¤šæ—¶ï¼Œæ€§èƒ½å°±ä¼šé™ä½äº†ã€‚</p>
<h3 id="3-3-åŠ é”"><a href="#3-3-åŠ é”" class="headerlink" title="3.3 åŠ é”"></a>3.3 åŠ é”</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">import threading</span><br><span class="line">from threading import RLock</span><br><span class="line"></span><br><span class="line">LOCK &#x3D; RLock()</span><br><span class="line">CONN &#x3D; pymysql.connect(host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">                       port&#x3D;3306,</span><br><span class="line">                       user&#x3D;&#39;zff&#39;,</span><br><span class="line">                       password&#x3D;&#39;zff123&#39;,</span><br><span class="line">                       database&#x3D;&#39;zff&#39;,</span><br><span class="line">                       charset&#x3D;&#39;utf8&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def task(arg):</span><br><span class="line">    with LOCK:</span><br><span class="line">        cursor &#x3D; CONN.cursor()</span><br><span class="line">        cursor.execute(&#39;select * from USER &#39;)</span><br><span class="line">        result &#x3D; cursor.fetchall()</span><br><span class="line">        cursor.close()</span><br><span class="line"></span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(10):</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;task, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>

<h3 id="3-4-æ— é”-æŠ¥é”™"><a href="#3-4-æ— é”-æŠ¥é”™" class="headerlink" title="3.4 æ— é”(æŠ¥é”™)"></a>3.4 æ— é”(æŠ¥é”™)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;13</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">CONN &#x3D; pymysql.connect(host&#x3D;&#39;127.0.0.1&#39;,</span><br><span class="line">                       port&#x3D;3306,</span><br><span class="line">                       user&#x3D;&#39;zff&#39;,</span><br><span class="line">                       password&#x3D;&#39;zff123&#39;,</span><br><span class="line">                       database&#x3D;&#39;zff&#39;,</span><br><span class="line">                       charset&#x3D;&#39;utf8&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def task(arg):</span><br><span class="line">    cursor &#x3D; CONN.cursor()</span><br><span class="line">    cursor.execute(&#39;select * from USER &#39;)</span><br><span class="line">    # cursor.execute(&#39;select sleep(10)&#39;)</span><br><span class="line">    result &#x3D; cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(10):</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;task, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å¯ä»¥åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹è¿æ¥æƒ…å†µ: show status like â€˜Threads%â€™;</p>
<h2 id="å››-æ•°æ®åº“è¿æ¥æ± ç»“åˆpymsqlä½¿ç”¨"><a href="#å››-æ•°æ®åº“è¿æ¥æ± ç»“åˆpymsqlä½¿ç”¨" class="headerlink" title="å››. æ•°æ®åº“è¿æ¥æ± ç»“åˆpymsqlä½¿ç”¨"></a>å››. æ•°æ®åº“è¿æ¥æ± ç»“åˆpymsqlä½¿ç”¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat sql_helper.py</span><br><span class="line"></span><br><span class="line">import pymysql</span><br><span class="line">import threading</span><br><span class="line">from DBUtils.PooledDB import PooledDB, SharedDBConnection</span><br><span class="line">POOL &#x3D; PooledDB(</span><br><span class="line">    creator&#x3D;pymysql,  # ä½¿ç”¨é“¾æ¥æ•°æ®åº“çš„æ¨¡å—</span><br><span class="line">    maxconnections&#x3D;20,  # è¿æ¥æ± å…è®¸çš„æœ€å¤§è¿æ¥æ•°ï¼Œ0å’ŒNoneè¡¨ç¤ºä¸é™åˆ¶è¿æ¥æ•°</span><br><span class="line">    mincached&#x3D;2,  # åˆå§‹åŒ–æ—¶ï¼Œé“¾æ¥æ± ä¸­è‡³å°‘åˆ›å»ºçš„ç©ºé—²çš„é“¾æ¥ï¼Œ0è¡¨ç¤ºä¸åˆ›å»º</span><br><span class="line">    maxcached&#x3D;5,  # é“¾æ¥æ± ä¸­æœ€å¤šé—²ç½®çš„é“¾æ¥ï¼Œ0å’ŒNoneä¸é™åˆ¶</span><br><span class="line">    #maxshared&#x3D;3,  # é“¾æ¥æ± ä¸­æœ€å¤šå…±äº«çš„é“¾æ¥æ•°é‡ï¼Œ0å’ŒNoneè¡¨ç¤ºå…¨éƒ¨å…±äº«ã€‚PS: æ— ç”¨ï¼Œå› ä¸ºpymysqlå’ŒMySQLdbç­‰æ¨¡å—çš„ threadsafetyéƒ½ä¸º1ï¼Œæ‰€æœ‰å€¼æ— è®ºè®¾ç½®ä¸ºå¤šå°‘ï¼Œ_maxcachedæ°¸è¿œä¸º0ï¼Œæ‰€ä»¥æ°¸è¿œæ˜¯æ‰€æœ‰é“¾æ¥éƒ½å…±äº«ã€‚</span><br><span class="line">    blocking&#x3D;True,  # è¿æ¥æ± ä¸­å¦‚æœæ²¡æœ‰å¯ç”¨è¿æ¥åï¼Œæ˜¯å¦é˜»å¡ç­‰å¾…ã€‚Trueï¼Œç­‰å¾…ï¼›Falseï¼Œä¸ç­‰å¾…ç„¶åæŠ¥é”™</span><br><span class="line">    maxusage&#x3D;None,  # ä¸€ä¸ªé“¾æ¥æœ€å¤šè¢«é‡å¤ä½¿ç”¨çš„æ¬¡æ•°ï¼ŒNoneè¡¨ç¤ºæ— é™åˆ¶</span><br><span class="line">    setsession&#x3D;[],  # å¼€å§‹ä¼šè¯å‰æ‰§è¡Œçš„å‘½ä»¤åˆ—è¡¨ã€‚å¦‚ï¼š[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span><br><span class="line">    ping&#x3D;0,</span><br><span class="line">    # ping MySQLæœåŠ¡ç«¯ï¼Œæ£€æŸ¥æ˜¯å¦æœåŠ¡å¯ç”¨ã€‚# å¦‚ï¼š0 &#x3D; None &#x3D; never, 1 &#x3D; default &#x3D; whenever it is requested, 2 &#x3D; when a cursor is created, 4 &#x3D; when a query is executed, 7 &#x3D; always</span><br><span class="line">    host&#x3D;&#39;192.168.11.38&#39;,</span><br><span class="line">    port&#x3D;3306,</span><br><span class="line">    user&#x3D;&#39;root&#39;,</span><br><span class="line">    passwd&#x3D;&#39;apNXgF6RDitFtDQx&#39;,</span><br><span class="line">    db&#x3D;&#39;m2day03db&#39;,</span><br><span class="line">    charset&#x3D;&#39;utf8&#39;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def connect():</span><br><span class="line">    # åˆ›å»ºè¿æ¥</span><br><span class="line">    # conn &#x3D; pymysql.connect(host&#x3D;&#39;192.168.11.38&#39;, port&#x3D;3306, user&#x3D;&#39;root&#39;, passwd&#x3D;&#39;apNXgF6RDitFtDQx&#39;, db&#x3D;&#39;m2day03db&#39;)</span><br><span class="line">    conn &#x3D; POOL.connection()</span><br><span class="line">    # åˆ›å»ºæ¸¸æ ‡</span><br><span class="line">    cursor &#x3D; conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line">    return conn,cursor</span><br><span class="line"></span><br><span class="line">def close(conn,cursor):</span><br><span class="line">    # å…³é—­æ¸¸æ ‡</span><br><span class="line">    cursor.close()</span><br><span class="line">    # å…³é—­è¿æ¥</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line">def fetch_one(sql,args):</span><br><span class="line">    conn,cursor &#x3D; connect()</span><br><span class="line">    # æ‰§è¡ŒSQLï¼Œå¹¶è¿”å›æ”¶å½±å“è¡Œæ•°</span><br><span class="line">    effect_row &#x3D; cursor.execute(sql,args)</span><br><span class="line">    result &#x3D; cursor.fetchone()</span><br><span class="line">    close(conn,cursor)</span><br><span class="line"></span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">def fetch_all(sql,args):</span><br><span class="line">    conn, cursor &#x3D; connect()</span><br><span class="line"></span><br><span class="line">    # æ‰§è¡ŒSQLï¼Œå¹¶è¿”å›æ”¶å½±å“è¡Œæ•°</span><br><span class="line">    cursor.execute(sql,args)</span><br><span class="line">    result &#x3D; cursor.fetchall()</span><br><span class="line"></span><br><span class="line">    close(conn, cursor)</span><br><span class="line">    return result</span><br><span class="line"></span><br><span class="line">def insert(sql,args):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åˆ›å»ºæ•°æ®</span><br><span class="line">    :param sql: å«æœ‰å ä½ç¬¦çš„SQL</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    conn, cursor &#x3D; connect()</span><br><span class="line"></span><br><span class="line">    # æ‰§è¡ŒSQLï¼Œå¹¶è¿”å›æ”¶å½±å“è¡Œæ•°</span><br><span class="line">    effect_row &#x3D; cursor.execute(sql,args)</span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    close(conn, cursor)</span><br><span class="line"></span><br><span class="line">def delete(sql,args):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åˆ›å»ºæ•°æ®</span><br><span class="line">    :param sql: å«æœ‰å ä½ç¬¦çš„SQL</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    conn, cursor &#x3D; connect()</span><br><span class="line"></span><br><span class="line">    # æ‰§è¡ŒSQLï¼Œå¹¶è¿”å›æ”¶å½±å“è¡Œæ•°</span><br><span class="line">    effect_row &#x3D; cursor.execute(sql,args)</span><br><span class="line"></span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    close(conn, cursor)</span><br><span class="line"></span><br><span class="line">    return effect_row</span><br><span class="line"></span><br><span class="line">def update(sql,args):</span><br><span class="line">    conn, cursor &#x3D; connect()</span><br><span class="line"></span><br><span class="line">    # æ‰§è¡ŒSQLï¼Œå¹¶è¿”å›æ”¶å½±å“è¡Œæ•°</span><br><span class="line">    effect_row &#x3D; cursor.execute(sql, args)</span><br><span class="line"></span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    close(conn, cursor)</span><br><span class="line"></span><br><span class="line">    return effect_row</span><br></pre></td></tr></table></figure>
<p>PS: å¯ä»¥åˆ©ç”¨é™æ€æ–¹æ³•å°è£…åˆ°ä¸€ä¸ªç±»ä¸­,æ–¹ä¾¿ä½¿ç”¨</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜</title>
    <url>/2020/04/20/Python%E7%B1%BB%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E6%88%90%E5%91%98/</url>
    <content><![CDATA[<h2 id="Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜"><a href="#Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜" class="headerlink" title="Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜"></a>Pythonç±»ä¸­çš„ç‰¹æ®Šæˆå‘˜</h2><blockquote>
<p>Python Version: 3.5+</p>
</blockquote>
<p><strong>init</strong><br>æ„é€ æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡è¢«å®ä¾‹åŒ–å‡ºæ¥çš„æ—¶å€™éƒ½å°†é¦–å…ˆå»æ‰§è¡Œ<strong>init</strong>æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">	def __init__(self):</span><br><span class="line">		print(&quot;åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¼šé¦–å…ˆè‡ªåŠ¨æ‰§è¡Œ__init__&quot;)</span><br><span class="line">&#96;&#96;&#96;        </span><br><span class="line">__del__</span><br><span class="line">ææ„æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ä¹‹å‰æ‰§è¡Œçš„æ–¹æ³•</span><br></pre></td></tr></table></figure>
<p>class A:<br>    def <strong>del</strong>(self):<br>        print(â€œåœ¨å¯¹è±¡é”€æ¯ä¹‹å‰ä¼šæ‰§è¡Œ<strong>del</strong>â€œ)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__doc__</span><br><span class="line">ç±»çš„æè¿°ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>class A:<br>    â€œâ€â€æˆ‘æ˜¯Aç±»çš„æè¿°ä¿¡æ¯â€â€â€<br>    pass</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">__module__</span><br><span class="line">è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡åœ¨å“ªä¸ªæ¨¡å—</span><br></pre></td></tr></table></figure>
<p>class A:<br>    â€œâ€â€æˆ‘æ˜¯Aç±»çš„æè¿°ä¿¡æ¯â€â€â€<br>    pass</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">from lib import A</span><br><span class="line">a &#x3D; A()</span><br><span class="line">print(a.__module__)</span><br></pre></td></tr></table></figure>
<p><strong>class</strong><br>è¡¨ç¤ºå½“å‰æ“ä½œçš„å¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">print(a.__class__)</span><br></pre></td></tr></table></figure>
<p><strong>call</strong><br>ç±»ååé¢åŠ æ‹¬å·è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœåœ¨å¯¹è±¡åé¢åŠ æ‹¬å·ï¼Œå°±éœ€è¦ä½¿ç”¨<strong>call</strong>æ–¹æ³•äº†ï¼Œå¦‚æœä¸å®šä¹‰è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œå¯¹è±¡()çš„æ—¶å€™å°±ä¼šæŠ¥é”™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line"></span><br><span class="line">    def __call__(self, *args, **kwargs):</span><br><span class="line">        print(&quot;call&quot;)</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">a()</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">call</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºå¯¹è±¡çš„æ—¶å€™é¦–å…ˆæ‰§è¡Œ<strong>init</strong>,åœ¨å¯¹è±¡è¢«è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œ<strong>call</strong></p>
<p>ä¹Ÿå¯ä»¥åœ¨ä¸€è¡Œæ‰§è¡Œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a &#x3D; A()()</span><br></pre></td></tr></table></figure>
<p><strong>str</strong><br>printå¯¹è±¡çš„æ—¶å€™æ˜¾ç¤ºçš„å†…å®¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">	pass</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;__main__.A object at 0x101b77128&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ²¡æœ‰å®šä¹‰<strong>str</strong>çš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºçš„æ˜¯aå¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    def __str__(self):</span><br><span class="line">        return &quot;A~&quot;</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">A~</span><br></pre></td></tr></table></figure>
<p>strçš„åº”ç”¨å®ä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;)</span><br><span class="line">print(b)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>
<p>strç±»å‹è½¬æ¢</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;)</span><br><span class="line">ret &#x3D; str(b)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>
<p>str(b)å’Œprint()éƒ½ä¼šè‡ªåŠ¨å»è°ƒç”¨bå¯¹è±¡ä¸­çš„<strong>str</strong>æ–¹æ³•</p>
<p><strong>dict</strong><br>å¯¹è±¡çš„dict<br>åœ¨å¯¹è±¡ä¸­é»˜è®¤å·²ç»æœ‰dictï¼Œä¸éœ€è¦è‡ªå®šä¹‰ã€‚è¯¥æ–¹æ³•ç”¨æ¥è·å–å¯¹è±¡ä¸­æ‰€æœ‰å°è£…çš„å¯¹è±¡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">print(b.__dict__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;&#39;age&#39;: 26, &#39;name&#39;: &#39;ps&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>ç±»çš„dict<br>åˆ—å‡ºç±»ä¸­æ‰€æœ‰å¯ä»¥è°ƒç”¨çš„æ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">print(B.__dict__)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&#123;&#39;__weakref__&#39;: &lt;attribute &#39;__weakref__&#39; of &#39;B&#39; objects&gt;, &#39;__module__&#39;: &#39;__main__&#39;, &#39;__str__&#39;: &lt;function B.__str__ at 0x10137b730&gt;, &#39;__init__&#39;: &lt;function B.__init__ at 0x10137b6a8&gt;, &#39;__doc__&#39;: None, &#39;__dict__&#39;: &lt;attribute &#39;__dict__&#39; of &#39;B&#39; objects&gt;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>add</strong><br>å½“æ‰§è¡Œä¸€ä¸ªå¯¹è±¡ + ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨å»æ‰§è¡Œè¿™ä¸ªæ–¹æ³•</p>
<p>æ³¨æ„ï¼Œæ‰§è¡Œçš„æ˜¯ç¬¬ä¸€ä¸ªå¯¹è±¡çš„addæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    def __init__(self, num):</span><br><span class="line">        self.num &#x3D; num</span><br><span class="line"></span><br><span class="line">    def __add__(self, other):</span><br><span class="line">        return self.num + other.num</span><br><span class="line"></span><br><span class="line">class B:</span><br><span class="line">    def __init__(self, num):</span><br><span class="line">        self.num &#x3D; num        </span><br><span class="line">a &#x3D; A(5)</span><br><span class="line">b &#x3D; B(9)</span><br><span class="line">c &#x3D; a + b</span><br><span class="line">print(c)</span><br></pre></td></tr></table></figure>
<p><strong>getitem</strong> <strong>setitem</strong> <strong>delitem</strong><br>ç”¨äºç´¢å¼•æ“ä½œï¼Œå¦‚å­—å…¸ã€‚ä»¥ä¸Šåˆ†åˆ«è¡¨ç¤ºè·å–ã€è®¾ç½®ã€åˆ é™¤æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">d &#x3D; &#123;&quot;k&quot;: &quot;v&quot;&#125;</span><br><span class="line">print(d[&quot;k&quot;])</span><br><span class="line">d[&quot;k&quot;] &#x3D; &quot;vv&quot;</span><br><span class="line">del d[&quot;k&quot;]</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†ä¸€ä¸ªå­—å…¸å¯¹è±¡çš„å–å€¼ã€èµ‹å€¼å’Œåˆ é™¤çš„æ“ä½œã€‚åœ¨è‡ªå®šä¹‰çš„ç±»ä¸­ï¼Œä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼äºå­—å…¸è¿™æ ·çš„æ“ä½œ<br>å¯¹è±¡åé¢åŠ å°æ‹¬å·æ˜¯æ‰§è¡Œ<strong>call</strong>æ–¹æ³•ï¼Œé‚£ä¹ˆå¯¹è±¡åé¢åŠ ä¸­æ‹¬å·åˆæ˜¯æ€æ ·å¤„ç†çš„å‘¢ï¼Ÿ</p>
<p>ä½¿ç”¨keyè¿›è¡Œçš„æ“ä½œ<br>å–å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        print(&quot;æ‰§è¡Œäº†getitemæ–¹æ³•&quot;, item)</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">b[&quot;name&quot;]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">æ‰§è¡Œäº†getitemæ–¹æ³• name</span><br></pre></td></tr></table></figure>
<p>èµ‹å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        print(&quot;æ‰§è¡Œäº†getitemæ–¹æ³•&quot;, item)</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&quot;ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s&quot; % (key, value))</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">print(b.name)</span><br><span class="line">b[&quot;name&quot;] &#x3D; &quot;lr&quot;</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ps</span><br></pre></td></tr></table></figure>
<p>ä½ è¦ä¸ºnameé‡æ–°èµ‹å€¼ä¸ºlr<br>åˆ é™¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        print(&quot;æ‰§è¡Œäº†getitemæ–¹æ³•&quot;, item)</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&quot;ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s&quot; % (key, value))</span><br><span class="line"></span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        print(&quot;ä½ è¦åˆ é™¤%s&quot; % key)</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">del b[&quot;age&quot;]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">ä½ è¦åˆ é™¤age</span><br></pre></td></tr></table></figure>
<p>åœ¨webå¼€å‘ä¸­ï¼Œè‡ªå®šä¹‰sessionæ¡†æ¶çš„æ—¶å€™ä¼šç”¨åˆ°</p>
<p>ä½¿ç”¨ä¸‹æ ‡è¿›è¡Œçš„æ“ä½œ<br>ä½¿ç”¨ä¸‹æ ‡å’Œä½¿ç”¨keyçš„å½¢å¼ç±»ä¼¼ï¼Œä½¿ç”¨keyï¼Œ itemæ¥æ”¶çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸‹æ ‡ï¼Œ itemæ¥æ”¶çš„æ˜¯ä¸€ä¸ªintç±»å‹çš„æ•°å­—ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä½“å†…é€šè¿‡åˆ¤æ–­ä¼ é€’è¿‡æ¥æ•°æ®çš„æ•°æ®ç±»å‹æ¥è¿›è¡Œå¯¹åº”çš„æ“ä½œ</p>
<p>ä½¿ç”¨åˆ‡ç‰‡çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l &#x3D; [1,2,3,4,5,6,7,8,9]</span><br><span class="line">l[1:5:2]</span><br></pre></td></tr></table></figure>
<p>åœ¨Python2.xä¸­ä½¿ç”¨<strong>getslice</strong> <strong>setslice</strong> <strong>delslice</strong>æ¥å®ç°åˆ‡ç‰‡çš„æ“ä½œï¼Œä½†æ˜¯Python3.xä¸­è¢«é—å¼ƒï¼Œæ‰€æœ‰åˆ‡ç‰‡çš„åŠŸèƒ½éƒ½é›†ä¸­åœ¨äº†<strong>getitem</strong> <strong>setitem</strong> <strong>delitem</strong>ä¸­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        # print(&quot;æ‰§è¡Œäº†getitemæ–¹æ³•&quot;, item)</span><br><span class="line">        print(type(item))</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&quot;ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s&quot; % (key, value))</span><br><span class="line"></span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        print(&quot;ä½ è¦åˆ é™¤%s&quot; % key)</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">b[&quot;name&quot;]</span><br><span class="line">b[1]</span><br><span class="line">b[1:5:2]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">&lt;class &#39;str&#39;&gt;</span><br><span class="line">&lt;class &#39;int&#39;&gt;</span><br><span class="line">&lt;class &#39;slice&#39;&gt;</span><br></pre></td></tr></table></figure>
<p>itemä¸ºsliceæ—¶è¡¨ç¤ºè°ƒç”¨äº†åˆ‡ç‰‡çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        print(&quot;èµ·ç‚¹ç´¢å¼•&quot;, item.start)</span><br><span class="line">        print(&quot;ç»ˆç‚¹ç´¢å¼•&quot;, item.stop)</span><br><span class="line">        print(&quot;æ­¥é•¿&quot;, item.step)</span><br><span class="line">        return &quot;haha&quot;</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&quot;ä½ è¦ä¸º%sé‡æ–°èµ‹å€¼ä¸º%s&quot; % (key, value))</span><br><span class="line"></span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        print(&quot;ä½ è¦åˆ é™¤%s&quot; % key)</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">ret &#x3D; b[1:5:2]</span><br><span class="line">print(ret)</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">èµ·ç‚¹ç´¢å¼• 1</span><br><span class="line">ç»ˆç‚¹ç´¢å¼• 5</span><br><span class="line">æ­¥é•¿ 2</span><br><span class="line">haha</span><br></pre></td></tr></table></figure>
<p>ç›¸å¯¹åº”çš„ï¼Œå–å€¼å¯ä»¥é€šè¿‡åˆ¤æ–­itemçš„ç±»å‹åšç›¸åº”çš„æ“ä½œï¼Œèµ‹å€¼å’Œåˆ é™¤ä¹Ÿå¯ä»¥é€šè¿‡åˆ¤æ–­keyçš„ç±»å‹æ¥è¿›è¡Œæƒ³å¯¹åº”çš„åˆ‡ç‰‡æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class B:</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.name</span><br><span class="line"></span><br><span class="line">    def __getitem__(self, item):</span><br><span class="line">        print(&quot;èµ·ç‚¹ç´¢å¼•&quot;, item.start)</span><br><span class="line">        print(&quot;ç»ˆç‚¹ç´¢å¼•&quot;, item.stop)</span><br><span class="line">        print(&quot;æ­¥é•¿&quot;, item.step)</span><br><span class="line">        return &quot;haha&quot;</span><br><span class="line"></span><br><span class="line">    def __setitem__(self, key, value):</span><br><span class="line">        print(&quot;èµ·ç‚¹ç´¢å¼•&quot;, key.start)</span><br><span class="line">        print(&quot;ç»ˆç‚¹ç´¢å¼•&quot;, key.stop)</span><br><span class="line">        print(&quot;æ­¥é•¿&quot;, key.step)</span><br><span class="line">        print(&quot;æ–°å€¼ä¸º&quot;, value)</span><br><span class="line"></span><br><span class="line">    def __delitem__(self, key):</span><br><span class="line">        print(&quot;èµ·ç‚¹ç´¢å¼•&quot;, key.start)</span><br><span class="line">        print(&quot;ç»ˆç‚¹ç´¢å¼•&quot;, key.stop)</span><br><span class="line">        print(&quot;æ­¥é•¿&quot;, key.step)</span><br><span class="line"></span><br><span class="line">b &#x3D; B(&quot;ps&quot;, 26)</span><br><span class="line">print(&quot;åˆ‡ç‰‡å–å€¼&quot;)</span><br><span class="line">ret &#x3D; b[1:5:2]</span><br><span class="line"></span><br><span class="line">print(&quot;åˆ‡ç‰‡èµ‹å€¼&quot;)</span><br><span class="line">b[1:5:2] &#x3D; &quot;hehe&quot;</span><br><span class="line"></span><br><span class="line">print(&quot;åˆ‡ç‰‡åˆ é™¤&quot;)</span><br><span class="line">print(ret)</span><br><span class="line">del b[1:5:2]</span><br><span class="line"></span><br><span class="line">------------</span><br><span class="line">åˆ‡ç‰‡å–å€¼</span><br><span class="line">èµ·ç‚¹ç´¢å¼• 1</span><br><span class="line">ç»ˆç‚¹ç´¢å¼• 5</span><br><span class="line">æ­¥é•¿ 2</span><br><span class="line">åˆ‡ç‰‡èµ‹å€¼</span><br><span class="line">èµ·ç‚¹ç´¢å¼• 1</span><br><span class="line">ç»ˆç‚¹ç´¢å¼• 5</span><br><span class="line">æ­¥é•¿ 2</span><br><span class="line">æ–°å€¼ä¸º hehe</span><br><span class="line">åˆ‡ç‰‡åˆ é™¤</span><br><span class="line">haha</span><br><span class="line">èµ·ç‚¹ç´¢å¼• 1</span><br><span class="line">ç»ˆç‚¹ç´¢å¼• 5</span><br><span class="line">æ­¥é•¿ 2</span><br></pre></td></tr></table></figure>
<p><strong>iter</strong><br>ä¸€ä¸ªè‡ªå®šä¹‰ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œé»˜è®¤æ˜¯ä¸å¯è¿­ä»£çš„ï¼Œåœ¨ç±»ä¸­ä½¿ç”¨<strong>iter</strong>æ–¹æ³•åï¼Œå¯¹è±¡å°±å˜æˆäº†å¯è¿­ä»£å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«è¿­ä»£æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨iteræ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">for i in a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&#x2F;Users&#x2F;lvrui&#x2F;PycharmProjects&#x2F;untitled&#x2F;8&#x2F;c8.py&quot;, line 5, in &lt;module&gt;</span><br><span class="line">    for i in a:</span><br><span class="line">TypeError: &#39;A&#39; object is not iterable</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    def __iter__(self):</span><br><span class="line">        return iter([1, 2])  # returnäº†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">for i in a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A:</span><br><span class="line">    def __iter__(self):  # è¿”å›äº†ä¸€ä¸ªç”Ÿæˆå™¨</span><br><span class="line">        yield 1</span><br><span class="line">        yield 2</span><br><span class="line"></span><br><span class="line">a &#x3D; A()</span><br><span class="line">for i in a:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">------------</span><br><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>å…ˆå»aå¯¹è±¡ä¸­æ‰¾åˆ°iteræ–¹æ³•æ‰§è¡Œï¼Œå¹¶æ‹¿åˆ°è¿”å›å€¼è¿›è¡Œè¿­ä»£</p>
<p><strong>new</strong> <strong>metaclass</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A(object):</span><br><span class="line"> </span><br><span class="line">    def __init__(self):</span><br><span class="line">        pass     </span><br><span class="line"></span><br><span class="line">a &#x3D; A()   # aæ˜¯é€šè¿‡Aç±»å®ä¾‹åŒ–çš„å¯¹è±¡</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œa æ˜¯é€šè¿‡ A ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå…¶å®ï¼Œä¸ä»… a æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒAç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºåœ¨Pythonä¸­ä¸€åˆ‡äº‹ç‰©éƒ½æ˜¯å¯¹è±¡ã€‚</p>
<p>å¦‚æœæŒ‰ç…§ä¸€åˆ‡äº‹ç‰©éƒ½æ˜¯å¯¹è±¡çš„ç†è®ºï¼šaå¯¹è±¡æ˜¯é€šè¿‡æ‰§è¡ŒAç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºï¼Œé‚£ä¹ˆAç±»å¯¹è±¡åº”è¯¥ä¹Ÿæ˜¯é€šè¿‡æ‰§è¡ŒæŸä¸ªç±»çš„æ„é€ æ–¹æ³•åˆ›å»ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print type(a) # è¾“å‡ºï¼š&lt;class &#39;__main__.A&#39;&gt;     è¡¨ç¤ºï¼Œaå¯¹è±¡ç”±Aç±»åˆ›å»º</span><br><span class="line">print type(A) # è¾“å‡ºï¼š&lt;type &#39;type&#39;&gt;              è¡¨ç¤ºï¼ŒAç±»å¯¹è±¡ç”±typeç±»åˆ›å»º</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼Œaå¯¹è±¡æ˜¯Aç±»çš„ä¸€ä¸ªå®ä¾‹ï¼ŒAç±»å¯¹è±¡æ˜¯typeç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå³ï¼šAç±»å¯¹è±¡æ˜¯é€šè¿‡typeç±»çš„æ„é€ æ–¹æ³•åˆ›å»º</p>
<p>é‚£ä¹ˆï¼Œåˆ›å»ºç±»å°±å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ™®é€šæ–¹å¼<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A(object):</span><br><span class="line"> </span><br><span class="line">    def func(self):</span><br><span class="line">        print(&quot;ps&quot;)</span><br><span class="line">&#96;&#96;&#96;        </span><br><span class="line">- ç‰¹æ®Šæ–¹å¼ï¼ˆtypeç±»çš„æ„é€ å‡½æ•°ï¼‰</span><br></pre></td></tr></table></figure>
def func(self):<br>  print(â€œpsâ€)</li>
</ul>
<p>A = type(â€˜Aâ€™,(object,), {â€˜funcâ€™: func})<br>#typeç¬¬ä¸€ä¸ªå‚æ•°ï¼šç±»å<br>#typeç¬¬äºŒä¸ªå‚æ•°ï¼šå½“å‰ç±»çš„åŸºç±»<br>#typeç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç±»çš„æˆå‘˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">â€“&gt; ç±»æ˜¯ç”±typeç±»å®ä¾‹åŒ–äº§ç”Ÿ</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç±»é»˜è®¤æ˜¯ç”± type ç±»å®ä¾‹åŒ–äº§ç”Ÿï¼Œtypeç±»ä¸­å¦‚ä½•å®ç°çš„åˆ›å»ºç±»ï¼Ÿç±»åˆæ˜¯å¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç­”ï¼šç±»ä¸­æœ‰ä¸€ä¸ªå±æ€§__metaclass__ å…¶ç”¨æ¥è¡¨ç¤ºè¯¥ç±»ç”±è°æ¥å®ä¾‹åŒ–åˆ›å»ºï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º__metaclass__è®¾ç½®ä¸€ä¸ªtypeç±»çš„æ´¾ç”Ÿç±»ï¼Œä»è€ŒæŸ¥çœ‹ç±»åˆ›å»ºçš„è¿‡ç¨‹:</span><br><span class="line">![ç±»åˆ›å»ºçš„è¿‡ç¨‹](https:&#x2F;&#x2F;note.youdao.com&#x2F;yws&#x2F;api&#x2F;personal&#x2F;file&#x2F;WEB469fc5ed373325db33598c76c5c2e865?method&#x3D;download&amp;shareKey&#x3D;387854780b812acd0ae47ca87a1d2b69)</span><br></pre></td></tr></table></figure>
<p>class MyType(type):</p>
<pre><code>def __init__(self, what, bases=None, dict=None):
    super(MyType, self).__init__(what, bases, dict)

def __call__(self, *args, **kwargs):
    obj = self.__new__(self, *args, **kwargs)

    self.__init__(obj)</code></pre><p>class A(object):</p>
<pre><code>__metaclass__ = MyType

def __init__(self, name):
    self.name = name

def __new__(cls, *args, **kwargs):
    return object.__new__(cls, *args, **kwargs)</code></pre><h1 id="ç¬¬ä¸€é˜¶æ®µï¼šè§£é‡Šå™¨ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œä»£ç åˆ›å»ºAç±»"><a href="#ç¬¬ä¸€é˜¶æ®µï¼šè§£é‡Šå™¨ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œä»£ç åˆ›å»ºAç±»" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µï¼šè§£é‡Šå™¨ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œä»£ç åˆ›å»ºAç±»"></a>ç¬¬ä¸€é˜¶æ®µï¼šè§£é‡Šå™¨ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œä»£ç åˆ›å»ºAç±»</h1><h1 id="ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡Aç±»åˆ›å»ºaå¯¹è±¡"><a href="#ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡Aç±»åˆ›å»ºaå¯¹è±¡" class="headerlink" title="ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡Aç±»åˆ›å»ºaå¯¹è±¡"></a>ç¬¬äºŒé˜¶æ®µï¼šé€šè¿‡Aç±»åˆ›å»ºaå¯¹è±¡</h1><p>a = A()</p>
<pre><code>
[åŸæ–‡åœ°å€](https://docs.lvrui.io/2016/07/03/Python%E7%B1%BB%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E6%88%90%E5%91%98/)  


</code></pre>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythoné¢è¯•é¢˜ä¸€</title>
    <url>/2020/04/20/Python%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/</url>
    <content><![CDATA[<h2 id="Pythoné¢è¯•é¢˜ä¸€"><a href="#Pythoné¢è¯•é¢˜ä¸€" class="headerlink" title="Pythoné¢è¯•é¢˜ä¸€"></a>Pythoné¢è¯•é¢˜ä¸€</h2><h3 id="äºŒ-django"><a href="#äºŒ-django" class="headerlink" title="äºŒ. django"></a>äºŒ. django</h3><pre><code>  1ã€ä¸­é—´ä»¶

       ä¸­é—´ä»¶ä¸€èˆ¬åšè®¤è¯æˆ–æ‰¹é‡è¯·æ±‚å¤„ç†ï¼Œdjangoä¸­çš„ä¸­é—´ä»¶ï¼Œå…¶å®æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨è¯·æ±‚å’Œç»“æŸåï¼Œdjangoä¼šæ ¹æ®è‡ªå·±çš„è§„åˆ™åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œä¸­é—´ä»¶ä¸­ç›¸åº”çš„æ–¹æ³•ï¼Œ
             å¦‚è¯·æ±‚è¿‡æ¥ æ‰§è¡Œprocess_request, viewï¼Œprocess_responseæ–¹æ³•

 2ã€Djangoã€Tornadoã€Flaskå„è‡ªçš„ä¼˜åŠ¿

      Djangoï¼šDjangoæ— socketï¼Œdjangoçš„ç›®çš„æ˜¯ç®€ä¾¿ï¼Œå¿«é€Ÿå¼€å‘ï¼Œå¹¶éµå¾ªMVCè®¾è®¡ï¼Œå¤šä¸ªç»„ä»¶å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä»¥â€œæ’ä»¶â€å½¢å¼æœåŠ¡äºæ•´ä¸ªæ¡†æ¶ï¼Œ
                      djangoæœ‰è®¸å¤šåŠŸèƒ½å¼ºå¤§çš„ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚djangoå…·æœ‰å¾ˆå¼ºçš„å¯æ‰©å±•æ€§ã€‚
      Tornadoï¼šå®ƒæ˜¯éé˜»å¡å¼æœåŠ¡å™¨ï¼Œè€Œä¸”é€Ÿåº¦ç›¸å½“å¿«ï¼Œå¾—åŠ›äºå…¶ éé˜»å¡çš„æ–¹å¼å’Œå¯¹epollçš„è¿ç”¨ï¼ŒFutureå¯¹è±¡ï¼Œç¼ºç‚¹ï¼šæ²¡æœ‰sessionï¼Œéœ€è¦è‡ªå®šåˆ¶
      Flaskï¼šæ˜¯ä¸€ä¸ªå¾®å‹çš„webæ¡†æ¶ï¼Œé…åˆSQLALchemyæ¥ä½¿ç”¨ï¼Œjinja2æ¨¡æ¿ï¼Œ werkzeugæ¥å£                  

  3ã€ djangoç‰ˆæœ¬ï¼ŒPythonç‰ˆæœ¬ï¼Œlinuxç‰ˆæœ¬

                  djangoï¼š1.11
           Pythonï¼š3.5
           linuxï¼š6.8
  4ã€djangoçš„templateçš„æ³¨é‡Šæ˜¯ä»€ä¹ˆæ ·å­çš„

        å•è¡Œï¼š
        å¤šè¡Œæ³¨é‡Šï¼š{%comment%}

  5ã€djangoæ€ä¹ˆå¼„å¹¶å‘çš„

        nginx+uwsigä¸ºdjangoæä¾›é«˜å¹¶å‘ï¼Œnginxçš„å¹¶å‘èƒ½åŠ›è¶…è¿‡ï¼Œå•å°å¹¶å‘èƒ½åŠ›è¿‡å®Œï¼Œåœ¨çº¯é™æ€çš„webæœåŠ¡ä¸­æ›´æ˜¯çªå‡ºå…¶ä¼˜è¶Šçš„åœ°æ–¹ï¼Œç”±äºåº•å±‚ä½¿ç”¨epollå¼‚æ­¥IOæ¨¡å‹è¿›è¡Œå¤„ç†ã€‚

 6ã€tornodoçš„ioloopçŸ¥é“æ˜¯ä»€ä¹ˆå—ï¼Ÿ

      äº‹ä»¶å¾ªç¯

 7ã€select_relatedå’Œprefetch_relatedï¼ŒQå’ŒF

        select_relatedï¼šä¸€å¯¹å¤šä½¿ç”¨ï¼ŒæŸ¥è¯¢ä¸»åŠ¨åšè¿è¡¨
        prefetch_relatedï¼šå¤šå¯¹å¤šæˆ–è€…ä¸€å¯¹å¤šçš„æ—¶å€™ä½¿ç”¨ï¼Œä¸åšè¿è¡¨ï¼Œåšå¤šæ¬¡æŸ¥è¯¢
        Qï¼šç”¨äºæ„é€ å¤æ‚æŸ¥è¯¢æ¡ä»¶
        Fï¼šæ›´æ–°æ—¶ç”¨äºè·å–åŸæ¥çš„å€¼ï¼Œä¸“é—¨å–å¯¹è±¡ä¸­æŸä¸€åˆ—è¿›è¡Œæ“ä½œ

 8ã€ä»€ä¹ˆæ˜¯ORMï¼Ÿ

       ORMï¼Œå³Object-Relational Mappingï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨å…³ç³»å‹æ•°æ®åº“å’Œä¸šåŠ¡å®ä½“å¯¹è±¡ä¹‹é—´åšä¸€ä¸ªæ˜ å°„
       ORMä¼˜ç¼ºç‚¹ï¼š
           ä¼˜ç‚¹ï¼šæ‘†è„±å¤æ‚çš„SQLæ“ä½œï¼Œé€‚åº”å¿«é€Ÿå¼€å‘ï¼Œè®©æ•°æ®ç»“æœå˜å¾—ç®€å•ï¼Œæ•°æ®åº“è¿ç§»æˆæœ¬æ›´ä½
           ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚ç”¨äºå¤§å‹åº”ç”¨ï¼Œå¤æ‚çš„SQLæ“ä½œè¿˜éœ€è¦é€šè¿‡SQLè¯­å¥å®ç°

 9ã€CORSè·¨åŸŸèµ„æºå…±äº«

        é¦–å…ˆä¼šå‘é€&quot;é¢„æ£€&quot;opption&quot;ï¼Œè¯·æ±‚ï¼Œå¦‚æœ&quot;é¢„æ£€&quot;æˆåŠŸï¼Œåˆ™å‘é€çœŸå®æ•°æ®ã€‚

10ã€Djangoçš„Formä¸»è¦å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼Ÿ

        ç”ŸæˆHTMlæ ‡ç­¾ï¼ŒéªŒè¯ç”¨æˆ·æ•°æ® is_vaildï¼ŒHTML Formæäº¤ä¿ç•™ä¸Šæ¬¡æäº¤æ•°æ®ï¼Œåˆå§‹åŒ–é¡µé¢æ˜¾ç¤ºå†…å®¹

11ã€CBVå’ŒFBV

        CBVåœ¨æŒ‡å®šçš„ç±»ä¸Šé¢åŠ ä¸Šè£…é¥°å™¨æˆ–åœ¨æ­¤æ–¹æ³•ä¸Šé¢æ·»åŠ è£…é¥°å™¨ @method_decorator,å¹¶ç»§æ‰¿view

12ã€cookieåŠsession

         cookieï¼šæ˜¯ä¿ç•™åœ¨å®¢æˆ·ç«¯ä¸Šé¢çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œcookieä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookie
         sessionï¼šæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šé¢çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä¾èµ–ä¸cookieï¼Œå®‰å…¨æŒ‡æ•°æ¯”cookieé«˜

 13ã€djangoçš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ

           è¯·æ±‚æ¥äº†å…ˆåˆ°uwsgiï¼ŒæŠŠè¯·æ±‚åšä¸€éƒ¨åˆ†åˆ†è£…ç»™djangoæ¡†æ¶ï¼Œç„¶åç»è¿‡æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼Œè·¯ç”±ï¼Œè§†å›¾ï¼Œè§†å›¾å¤„ç†å†è¿”å›ç»™ä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶åœ¨è¿”å›ç»™uwsgiï¼Œåœ¨è¿”å›ç»™ç”¨æˆ·ã€‚

 14ã€uwsgiå’Œwsgi

    wsgiï¼šæ˜¯webæœåŠ¡å™¨ç½‘å…³æ¥å£ï¼Œæ˜¯pyhtonåº”ç”¨ç¨‹åºæˆ–æ¡†æ¶å’ŒwebæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ç§æ¥å£ï¼Œå…¶å¹¿æ³›ä½¿ç”¨çš„æ˜¯djangoæ¡†æ¶ã€‚
    uwsgiï¼šæ˜¯ä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œå®ƒå®ç°äº†wsgiåè®®ï¼ŒNginxä¸­HttpUwsgiModuleçš„ä½œç”¨æ˜¯ä¸UwsgiæœåŠ¡å™¨è¿›è¡Œäº¤æ¢</code></pre><p>  15ã€è§£é‡Šä¸‹django - debug -toolbarçš„ä½¿ç”¨</p>
<pre><code>ä½¿ç”¨djangoå¼€å‘ç«™ç‚¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨django-debug-toolbaræ¥è¿›è¡Œè°ƒè¯•ï¼Œåœ¨settings.pyä¸­æ·»åŠ  &apos;debugâ€”toolbar.midleware.Debug ToolbarMiddleware&apos;åˆ°é¡¹ç›®çš„MIDDLEWARE_CLASSESå†…ã€‚</code></pre><p>ä¸‰ã€Pythonéƒ¨åˆ†<br>        1ã€ <strong>new</strong>.<strong>init</strong>åŒºåˆ«ï¼Œå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Œæœ‰ä»€ä¹ˆä¼˜ç‚¹</p>
<pre><code>    __new__æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œ__init__æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•
    __new__è¿”å›ä¸€ä¸ªåˆ›å»ºçš„å®ä¾‹ï¼Œ__init__ä»€ä¹ˆéƒ½ä¸è¿”å›
    __new__è¿”å›ä¸€ä¸ªclsçš„å®ä¾‹æ—¶åé¢çš„__init__æ‰èƒ½è¢«è°ƒç”¨
    å½“åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹æ—¶è°ƒç”¨__new__ï¼Œåˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹æ—¶è°ƒç”¨__init__

2ã€æ·±æµ…æ‹·è´

    æµ…æ‹·è´åªæ˜¯å¢åŠ äº†ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå­˜åœ¨çš„åœ°å€ï¼Œè€Œæ·±æ‹·è´æ˜¯å¢åŠ ä¸€ä¸ªæŒ‡é’ˆå¹¶ä¸”å¼€è¾Ÿäº†æ–°çš„å†…å­˜ï¼Œè¿™ä¸ªå¢åŠ çš„æŒ‡é’ˆæŒ‡å‘è¿™ä¸ªæ–°çš„å†…å­˜ï¼Œ
    é‡‡ç”¨æµ…æ‹·è´çš„æƒ…å†µï¼Œé‡Šæ”¾å†…å­˜ï¼Œä¼šé‡Šæ”¾åŒä¸€å†…å­˜ï¼Œæ·±æ‹·è´å°±ä¸ä¼šå‡ºç°é‡Šæ”¾åŒä¸€å†…å­˜çš„é”™è¯¯

3ã€HTTP/IPç›¸å…³åè®®ï¼Œåˆ†åˆ«ä½äºå“ªå±‚

      httpåè®®æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œhttpåè®®æ˜¯åŸºäºTCP/IPé€šä¿¡åè®®æ¥ä¼ é€’æ•°æ®
      httpåè®®å·¥ä½œä¸c/sæ¶æ„ä¸Šï¼Œæµè§ˆå™¨ä½œä¸ºhttpçš„å®¢æˆ·ç«¯é€šè¿‡URLå‘httpæœåŠ¡ç«¯å³webæœåŠ¡å™¨å‘é€æ‰€ç”¨è¯·æ±‚ã€‚webæœåŠ¡å™¨æ”¶åˆ°æ‰€æœ‰è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯å‘é€å“åº”ä¿¡æ¯ï¼Œ
      httpç‰¹ç‚¹æ˜¯çŸ­è¿æ¥ï¼Œæ— çŠ¶æ€

        åœ°å€æ é”®è¾“å…¥URLï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åç»å†äº†ä»€ä¹ˆï¼Ÿ
        1.æµè§ˆå™¨å‘DNSæœåŠ¡å™¨è¯·æ±‚è§£æè¯¥URLä¸­çš„åŸŸåæ‰€å¯¹åº”çš„IPåœ°å€
        2.è§£æå‡ºIPåœ°å€åï¼Œæ ¹æ®IPåœ°å€å’Œé»˜è®¤ç«¯å£80ï¼Œå’ŒæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥
        3.æµè§ˆå™¨å‘å‡ºè¯»å–æ–‡ä»¶çš„httpè¯·æ±‚ï¼Œè¯¥è¯·æ±‚æŠ¥æ–‡ä½œä¸ºTCPä¸‰æ¬¡æ¡æ‰‹çš„ç¬¬ä¸‰ä¸ªæŠ¥æ–‡çš„æ•°æ®å‘é€ç»™æœåŠ¡å™¨
        4.æœåŠ¡å™¨å¯¹æµè§ˆå™¨è¯·æ±‚åšå‡ºå“åº”ï¼Œå¹¶æŠŠå¯¹åº”çš„htmlæ–‡ä»¶å‘é€ç»™æµè§ˆå™¨
        5.é‡Šæ”¾TCPè¿æ¥
        6.æµè§ˆå™¨å°†è¯¥HMTLæ¸²æŸ“å¹¶æ˜¾ç¤ºå†…å®¹

4ã€TCP/UDPåŒºåˆ«

       TCPåè®®æ˜¯é¢å‘è¿æ¥ï¼Œä¿è¯é«˜å¯é æ€§ï¼ˆæ•°æ®æ— ä¸¢å¤±ï¼Œæ•°æ®æ— å¤±åºï¼Œæ•°æ®æ— é”™è¯¯ï¼Œæ•°æ®æ— é‡å¤è¾¾åˆ°ï¼‰ä¼ è¾“å±‚åè®®
       UDPï¼šæ•°æ®ä¸¢å¤±ï¼Œæ— ç§©åºçš„ä¼ è¾“å±‚åè®®ï¼ˆqqåŸºäºudpåè®®ï¼‰

5ã€webscoket

      websocketæ˜¯åŸºäºhttpåè®®çš„ï¼Œå¯æŒç»­åŒ–è¿æ¥
       è½®è¯¢ï¼šæµè§ˆå™¨æ¯éš”å‡ ç§’å°±å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°æ¶ˆæ¯
       é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘èµ·è¿æ¥åï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œå°±ä¸€ç›´ä¸è¿”å›responseç»™å®¢æˆ·ç«¯ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯è¿”å›ï¼Œè¿”å›å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å‘èµ·è¿æ¥

6ã€RabbitMQ:

      æœåŠ¡å™¨ç«¯æœ‰Erlangè¯­è¨€æ¥ç¼–å†™ï¼Œæ”¯æŒå¤šç§å®¢æˆ·ç«¯ï¼Œåªä¼šajaxï¼Œç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§çš„æ–¹é¢ä¸ä¿—ã€‚
      connectionæ˜¯RabbitMQçš„socketè¿æ¥ï¼Œå®ƒå°è£…äº†socketéƒ¨åˆ†ç›¸å…³åè®®é€»è¾‘
      connectionFactroyä¸ºconnectionçš„åˆ¶é€ å·¥å‚
      channelæ˜¯æˆ‘ä»¬ä¸RabbitMQæ‰“äº¤é“çš„æœ€é‡è¦çš„ä¸€ä¸ªæ¥å£ï¼Œå¤§éƒ¨åˆ†çš„ä¸šåŠ¡æ“ä½œæ˜¯åœ¨chaanelè¿™ä¸ªæ¥å£ä¸­å®Œæˆï¼ŒåŒ…æ‹¬å®šä¹‰Queueã€å®šä¹‰Exchangeã€
       ç»‘å®šQueueä¸Exchange,å‘å¸ƒæ¶ˆæ¯ç­‰

7ã€è£…é¥°å™¨

     è°ƒç”¨è£…é¥°å™¨å…¶å®æ˜¯ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œä¸ºå…¶ä»–å‡½æ•°æ·»åŠ é™„åŠ åŠŸèƒ½ï¼Œä¸ä¿®æ”¹è¢«ä¿®æ”¹çš„æºä»£ç å’Œä¸ä¿®æ”¹è¢«ä¿®é¥°çš„æ–¹å¼ï¼Œè£…é¥°å™¨çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚
     æ¯”å¦‚ï¼šæ’å…¥æ—¥å¿—ã€æ€§èƒ½æµ‹è¯•ã€äº‹ç‰©å¤„ç†ã€ç¼“å­˜ã€æƒé™éªŒè¯ç­‰ï¼Œæœ‰äº†è£…é¥°å™¨ï¼Œå°±å¯ä»¥æŠ½ç¦»å‡ºå¤§é‡ä¸å‡½æ•°åŠŸèƒ½æœ¬èº«æ— å…³çš„é›·åŒä»£ç å¹¶ç»§ç»­é‡ç”¨ã€‚

8ã€é—­åŒ…

   1.å¿…é¡»æœ‰ä¸€ä¸ªå†…åµŒå‡½æ•°
   2.å†…åµŒå‡½æ•°å¿…é¡»å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å˜é‡ï¼ˆè¯¥å‡½æ•°åŒ…å«å¯¹å¤–ä½œç”¨åŸŸè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸåå­—çš„å¼•ç”¨ï¼‰
   3.å¤–éƒ¨å‡½æ•°çš„è¿”å›å€¼å¿…é¡»æ˜¯å†…åµŒå‡½æ•°

9ã€è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨

     è¿­ä»£å¯è¿­ä»£å¯¹è±¡å¯¹åº”_iter_ï¼ˆæ–¹æ³•ï¼‰å’Œè¿­ä»£å™¨å¯¹åº”_next_ï¼ˆæ–¹æ³•ï¼‰çš„ä¸€ä¸ªè¿‡ç¨‹
     ç”Ÿæˆå™¨ï¼šåŒ…æ‹¬å«æœ‰yieldè¿™ä¸ªå…³é”®å­—ï¼Œç”Ÿæˆå™¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œè°ƒåŠ¨nextæŠŠå‡½æ•°å˜æˆè¿­ä»£å™¨ã€‚

10ã€classmethodï¼Œstaticmethodï¼Œproperty

         ç±»æ–¹æ³•ï¼šå°†ç±»çš„å‡½æ•°è½¬æ¢æˆç±»æ–¹æ³•ï¼Œå‡½æ•°ä¸Šè£…é¥°@classmethodä¼šå°†å‡½æ•°çš„è‡ªåŠ¨ä¼ å€¼å‚æ•°æ”¹æˆcls
         é™æ€æ–¹æ³•ï¼šæ­¤æ–¹æ³•ç›¸å½“äºç»™ç±»æ‰©å±•ä¸€ä¸ªåŠŸèƒ½ï¼Œå°†ç±»å†…çš„å‡½æ•°å®ä¾‹åŒ–ï¼Œç»™ç±»æˆ–å¯¹è±¡ä½¿ç”¨ï¼Œæ­¤æ—¶ç±»å†…çš„å‡½æ•°å°±æ˜¯æ™®é€šå‡½æ•°ï¼Œä¸ç®¡æ˜¯ç±»è¿˜æ˜¯å®ä¾‹åŒ–çš„å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨
         å®ä¾‹åŒ–ï¼šç±»çš„å®ä¾‹åŒ–å°±ä¼šäº§ç”Ÿä¸€ä¸ªå®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºç±»ï¼ˆï¼‰æŠŠè™šæ‹Ÿçš„ä¸œè¥¿å®ä¾‹åŒ–ï¼Œå¾—åˆ°å…·ä½“å­˜åœ¨çš„å€¼

11ã€å¸¸ç”¨çš„çŠ¶æ€ç            

        200--æœåŠ¡å™¨æˆåŠŸè¿”å›ç½‘é¡µ
        204--è¯·æ±‚æ”¶åˆ°,ä½†è¿”å›ä¿¡æ¯ä¸ºç©º
        304--å®¢æˆ·ç«¯å·²ç»æ‰§è¡Œäº†GET,ä½†æ–‡ä»¶æœªå˜åŒ–
        400--é”™è¯¯è¯·æ±‚ï¼Œå¦‚è¯­æ³•é”™è¯¯
        403--æ— æƒé™è®¿é—®
        404--è¯·æ±‚çš„é¡µé¢ä¸å­˜åœ¨
        500--æœåŠ¡å™¨äº§ç”Ÿå†…éƒ¨é”™è¯¯
12ã€å¤šè¿›ç¨‹ï¼Œå¤šçº¿ç¨‹ï¼Œåç¨‹ï¼ŒGIL

        GIL:å…¨å±€è§£é‡Šå™¨é”ï¼Œæ˜¯é”åœ¨cpythonè§£é‡Šå™¨ä¸Šï¼Œå¯¼è‡´åŒä¸€æ—¶åˆ»ï¼ŒåŒä¸€è¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¢«æ‰§è¡Œ
        å¤šè¿›ç¨‹ï¼šå¤šè¿›ç¨‹æ¨¡å—multiprocessingæ¥å®ç°ï¼Œcpuå¯†é›†å‹ï¼ŒIOè®¡ç®—å‹å¯ä»¥ç”¨å¤šè¿›ç¨‹
        å¤šçº¿ç¨‹ï¼šå¤šçº¿ç¨‹æ¨¡å—threadingæ¥å®ç°ï¼ŒIOå¯†é›†å‹ï¼Œå¤šçº¿ç¨‹å¯ä»¥æé«˜æ•ˆç‡
        åç¨‹ï¼šä¾èµ–äºgeenletï¼Œå¯¹äºå¤šçº¿ç¨‹åº”ç”¨ã€‚cpué€šè¿‡åˆ‡ç‰‡çš„æ–¹å¼æ¥åˆ‡æ¢çº¿ç¨‹é—´çš„æ‰§è¡Œï¼Œé‡åˆ°IOæ“ä½œè‡ªåŠ¨åˆ‡æ¢ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶éœ€è¦è€—æ—¶ï¼Œ
                                 è€Œåæˆå¥½å¤„æ²¡æœ‰åˆ‡æ¢çš„æ¶ˆè€—ï¼Œæ²¡æœ‰é”å®šæ¦‚å¿µã€‚
        è¿›ç¨‹ï¼šæ˜¯èµ„æºç®¡ç†å•ä½ï¼Œè¿›è¡Œæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ç°å¹¶å‘å’Œå¹¶å‘
        çº¿ç¨‹ï¼šæ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œçº¿ç¨‹çš„å‡ºç°ä¸ºäº†é™ä½ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¶ˆè€—ï¼Œæä¾›ç³»ç»Ÿçš„å¹¶å‘æ€§

13ã€IOå¤šè·¯å¤ç”¨/å¼‚æ­¥éé˜»å¡

         IOå¤šè·¯å¤ç”¨ï¼šé€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªæè¿°ç¬¦ select/poll/epoll
         selectï¼šè¿æ¥æ•°å—é™ï¼ŒæŸ¥æ‰¾é…å¯¹é€Ÿåº¦æ…¢ï¼Œæ•°æ®ç”±å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·æ€
         pollï¼šæ”¹å–„äº†è¿æ¥æ•°ï¼Œä½†æ˜¯è¿˜æ˜¯æŸ¥æ‰¾é…å¯¹é€Ÿåº¦æ…¢ï¼Œæ•°æ®ç”±å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·æ€
         epollï¼šepollæ˜¯linuxä¸‹å¤šè·¯å¤ç”¨IOæ¥å£ï¼Œæ˜¯select/pollçš„å¢å¼ºç‰ˆï¼Œå®ƒèƒ½æ˜¾è‘—æé«˜ç¨‹åºåœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸­åªæœ‰å°‘é‡æ´»è·ƒçš„æƒ…å†µä¸‹çš„ç³»ç»ŸCPUåˆ©ç”¨ç‡
        å¼‚æ­¥éé˜»å¡ï¼šå¼‚æ­¥ä½“ç°åœ¨å›è°ƒä¸Šï¼Œå›è°ƒå°±æ˜¯æœ‰æ¶ˆæ¯è¿”å›æ—¶å‘ŠçŸ¥ä¸€å£°å„¿è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚éé˜»å¡å°±æ˜¯ä¸ç­‰å¾…ï¼Œä¸éœ€è¦è¿›ç¨‹ç­‰å¾…ä¸‹å»ï¼Œ
                              ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œä¸ç®¡å…¶ä»–è¿›ç¨‹çš„çŠ¶æ€ã€‚

14ã€PEP8è§„èŒƒï¼Œè§„èŒƒçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ

        1.ç¼©è¿›ï¼š4ä¸ªç©ºå®ç°ç¼©è¿›ï¼Œå°½é‡ä¸ä½¿ç”¨Tab
        2.è¡Œï¼šæ²¡è¡Œæœ€å¤§é•¿åº¦ä¸è¶…è¿‡79ï¼Œæ¢è¡Œå¯ä»¥ä½¿ç”¨åæ–œæ 
        3.å‘½åè§„èŒƒï¼š
        4.æ³¨é‡Šè§„èŒƒï¼š

15ã€range-and-xrange

       éƒ½åœ¨å¾ªç¯æ—¶ä½¿ç”¨ï¼Œxrangeå†…å­˜æ€§èƒ½æ›´å¥½ï¼Œxrangeç”¨æ³•ä¸rangeå®Œå…¨ç›¸åŒï¼Œrangeä¸€ä¸ªç”Ÿæˆlistå¯¹è±¡ï¼Œxrangeæ˜¯ç”Ÿæˆå™¨

16ã€withä¸Šä¸‹æ–‡æœºåˆ¶åŸç†

         _enter_å’Œ_exit_ï¼Œä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œå³withè¯­å¥ï¼Œä¸ºäº†è®©ä¸€ä¸ªå¯¹è±¡å…¼å®¹withè¯­å¥ï¼Œå¿…é¡»åœ¨è¿™ä¸ªå¯¹è±¡ç±»ä¸­å£°æ˜_enter_å’Œ_exit_æ–¹æ³•ï¼Œ
         ä½¿ç”¨withè¯­å¥çš„ç›®çš„å°±æ˜¯æŠŠä»£ç å—æ”¾å…¥withä¸­æ‰§è¡Œï¼Œwithç»“æŸåï¼Œè‡ªåŠ¨å®Œæˆæ¸…ç†å·¥ä½œï¼Œæ— é¡»æ”¶åˆ°å¹²é¢„

17ã€ç»å…¸ç±»ã€æ–°å¼ç±»

        ç»å…¸ç±»éµå¾ªï¼šæ·±åº¦ä¼˜å…ˆï¼Œpython2ä¸­
        æ–°å¼ç±»éµå¾ªï¼šå¹¿åº¦ä¼˜å…ˆï¼ŒPython3ä¸­

 18ã€æœ‰æ²¡æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æŸ¥æ‰¾Pythonçš„bugå’Œè¿›è¡Œé™æ€çš„ä»£ç åˆ†æï¼Ÿ

         PyCheckeræ˜¯ä¸€ä¸ªPythonä»£ç çš„é™æ€åˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æŸ¥æ‰¾Pythonä»£ç çš„bugï¼Œä¼šå¯¹ä»£ç çš„å¤æ‚åº¦å’Œæ ¼å¼æå‡ºè­¦å‘Šï¼Œ
                Pylintæ˜¯å¦å¤–ä¸€ä¸ªå·¥å…·å¯ä»¥è¿›è¡Œcodingstandardæ£€æŸ¥  

  19ã€ Pythonæ˜¯å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„

           1.å¯¹è±¡å¼•ç”¨è®¡æ•°ï¼š
                å¼•ç”¨è®¡æ•°å¢åŠ çš„æƒ…å†µï¼š
                     æ¥ä¿æŒè¿½è¸ªå†…å­˜ä¸­çš„å¯¹è±¡ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½ç”¨å¼•ç”¨è®¡æ•°ï¼Œä¸€ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªæ–°åç§°
                     å°†å…¶æ”¾å…¥ä¸€ä¸ªå®¹å™¨ä¸­ï¼ˆåˆ—è¡¨ï¼Œå­—å…¸ï¼Œå…ƒç¥–ï¼‰
                 å¼•ç”¨è®¡æ•°å‡å°‘çš„æƒ…å†µï¼š
                      ä½¿ç”¨delè¯­å¥å¯¹å¯¹è±¡åˆ«åæ˜¾ç¤ºçš„é”€æ¯
                      å¼•ç”¨è¶…å‡ºä½œç”¨åŸŸæˆ–è¢«é‡æ–°èµ‹å€¼
                      sys.getrefcount()å‡½æ•°å¯ä»¥è·å¾—å¯¹è±¡çš„å½“å‰å¼•ç”¨è®¡æ•°
             2.æ ‡è®°-æ¸…é™¤æœºåˆ¶


             3.åˆ†ä»£æŠ€æœ¯

  20ã€ä»€ä¹ˆæ˜¯pythonï¼Ÿä½¿ç”¨pythonæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ

          pythonæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæœ‰å¯¹è±¡ã€æ¨¡å—ã€çº¿ç¨‹ã€å¼‚å¸¸å¤„ç†å’Œè‡ªåŠ¨å†…å­˜ç®¡ç†ã€‚å®ƒç®€æ´ï¼Œç®€å•ã€æ–¹ä¾¿ã€å®¹æ˜“æ‰©å±•ã€æœ‰è®¸å¤šè‡ªå¸¦çš„æ•°æ®ç»“æœï¼Œè€Œä¸”å®ƒå¼€æº

  21ã€ä»€ä¹ˆæ˜¯picklingå’Œunpicklingï¼Ÿ

         Pickleæ¨¡å—è¯»å…¥ä»»ä½•pythonå¯¹è±¡ï¼Œå°†å®ƒä»¬è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨dumpå‡½æ•°å°†å…¶è½¬å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­â€”â€”è¿™ä¸ªè¿‡ç¨‹å«åšpickling
         åä¹‹ä»å­˜å‚¨çš„å­—ç¬¦ä¸²æ–‡ä»¶ä¸­æå–åŸå§‹pythonå¯¹è±¡çš„è¿‡ç¨‹ï¼Œå«åšunpickling

  22ã€pythonæ˜¯å¦‚ä½•è¢«è§£é‡Šçš„ï¼Ÿ

         Pythonæ˜¯ä¸€ç§è§£é‡Šæ€§è¯­è¨€ï¼Œå®ƒçš„æºä»£ç å¯ä»¥ç›´æ¥è¿è¡Œï¼ŒPythonè§£é‡Šå™¨ä¼šå°†æºä»£ç è½¬æ¢æˆä¸­é—´è¯­è¨€ï¼Œä¹‹åå†ç¿»è¯‘æˆæœºå™¨ç å†æ‰§è¡Œ

  23ã€æ•°ç»„å’Œå…ƒç¥–ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

         æ•°ç»„å’Œå…ƒç¥–ä¹‹é—´çš„åŒºåˆ«ï¼šæ•°ç»„å†…å®¹å¯ä»¥è¢«ä¿®æ”¹ï¼Œè€Œå…ƒç¥–å†…å®¹æ˜¯åªè¯»çš„ï¼Œä¸å¯è¢«ä¿®æ”¹çš„ï¼Œå¦å¤–å…ƒç¥–å¯ä»¥è¢«å“ˆå¸Œï¼Œæ¯”å¦‚ä½œä¸ºå­—å…¸çš„key

  24ã€å‚æ•°æŒ‰å€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

         pythonä¸­çš„ä¸€åˆ‡éƒ½æ˜¯ç±»ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å¼•ç”¨çš„å€¼æ˜¯ç”±å‡½æ•°ç¡®å®šçš„ï¼Œå› æ­¤æ— æ³•è¢«æ”¹å˜ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œä½ å¯ä»¥æ”¹åŠ¨å¯¹è±¡

  25ã€Pythonéƒ½æœ‰å“ªäº›è‡ªå¸¦çš„æ•°æ®ç»“æ„ï¼Ÿ

         Pythonè‡ªå¸¦çš„æ•°æ®ç»“æ„åˆ†ä¸ºå¯å˜å’Œä¸å¯å˜çš„ï¼šå¯å˜çš„æœ‰ï¼šæ•°ç»„ã€é›†åˆã€å­—å…¸ï¼Œä¸å¯å˜çš„æ˜¯ï¼šå­—ç¬¦ä¸²ã€å…ƒç¥–ã€æ•´æ•°

  26ã€ä»€ä¹ˆæ˜¯pythonçš„å‘½åç©ºé—´ï¼Ÿ

         åœ¨pythonä¸­ï¼Œæ‰€æœ‰çš„åå­—éƒ½å­˜åœ¨äºä¸€ä¸ªç©ºé—´ä¸­ï¼Œå®ƒä»¬åœ¨æ”¹ç©ºé—´ä¸­å­˜åœ¨å’Œè¢«æ“ä½œâ€”â€”è¿™å°±æ˜¯å‘½åç©ºé—´ï¼Œå®ƒå°±å¥½åƒä¸€ä¸ªç›’å­ï¼Œåœ¨æ¯ä¸ªå˜é‡åå­—éƒ½å¯¹åº”è£…ç€ä¸€ä¸ªå¯¹è±¡ï¼Œ
                  å½“æŸ¥è¯¢å˜é‡çš„æ—¶å€™ï¼Œä¼šä»è¯¥ç›’å­é‡Œé¢å¯»æ‰¾ç›¸åº”çš„å¯¹è±¡

  27ã€pythonä¸­çš„unittestæ˜¯ä»€ä¹ˆï¼Ÿ

         åœ¨pythonä¸­ï¼Œunittestæ˜¯pythonä¸­çš„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼Œå®ƒæ‹¥æœ‰æ”¯æŒå…±äº«æ­å»ºã€è‡ªåŠ¨æµ‹è¯•ã€åœ¨æµ‹è¯•ä¸­æš‚åœä»£ç ã€å°†ä¸åŒæµ‹è¯•è¿­ä»£æˆä¸€ç»„

  28ã€*argsä¸**kwargs

         *argsä»£è¡¨ä½ç½®å‚æ•°ï¼Œå®ƒä¼šæ¥æ”¶ä»»æ„å¤šä¸ªå‚æ•°å¹¶æŠŠè¿™äº›å‚æ•°ä½œä¸ºå…ƒç¥–ä¼ é€’ç»™å‡½æ•°ã€‚**kwargsä»£è¡¨çš„å…³é”®å­—å‚æ•°ï¼Œè¿”å›çš„æ˜¯å­—å…¸ï¼Œä½ç½®å‚æ•°ä¸€å®šè¦æ”¾åœ¨å…³é”®å­—å‰é¢

  29ã€åœ¨Pythonä¸­ä»€ä¹ˆæ˜¯slicingï¼Ÿ

         slicingæ˜¯ä¸€ç§åœ¨æœ‰åºçš„å¯¹è±¡ç±»å‹ä¸­ï¼ˆæ•°ç»„ã€å…ƒç¥–ã€å­—ç¬¦ä¸²ï¼‰èŠ‚é€‰æŸä¸€æ®µçš„è¯­æ³•

  30ã€ä¸­çš„docstringæ˜¯ä»€ä¹ˆï¼Ÿ

        Pythonä¸­æ–‡æ¡£å­—ç¬¦ä¸²è¢«ç§°ä¸ºdocstringï¼Œå®ƒåœ¨Pythonä¸­çš„ä½œç”¨æ˜¯ä¸ºå‡½æ•°ã€æ¨¡å—å’Œç±»æ³¨é‡Šç”Ÿæˆæ–‡æ¡£

  31ã€osä¸sysåŒºåˆ«ï¼š

          osæ˜¯æ¨¡å—è´Ÿè´£ç¨‹åºä¸æ“ä½œç³»ç»Ÿçš„äº¤äº’ï¼Œæä¾›äº†è®¿é—®æ“ä½œç³»ç»Ÿåº•å±‚çš„æ¥å£
          sysæ¨¡å—æ˜¯è´Ÿè´£ç¨‹åºä¸pythonè§£é‡Šå™¨çš„äº¤äº’ï¼Œæä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°å’Œå˜é‡ï¼Œç”¨äºæ“æ§Pythonæ—¶è¿è¡Œçš„ç¯å¢ƒ
  32ã€å®ç°ä¸€ä¸ªå•ä¾‹æ¨¡å¼

                    _new_ï¼ˆï¼‰åœ¨ _init_ï¼ˆï¼‰ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚åˆ©ç”¨è¿™ä¸ªæ–¹æ³•å’Œç±»çš„å±æ€§çš„ç‰¹ç‚¹å¯ä»¥å®ç°è®¾è®¡æ¨¡å¼çš„å•ä¾‹æ¨¡å¼ã€‚
           å•ä¾‹æ¨¡å¼æ˜¯æŒ‡åˆ›å»ºå”¯ä¸€å¯¹è±¡ï¼Œå•ä¾‹æ¨¡å¼è®¾è®¡çš„ç±»åªèƒ½å®ä¾‹ï¼Œå®ä¾‹åŒ–1ä¸ªå¯¹è±¡
           class Singleton(object):
                __instance=None
                def __init__(self):
                    pass
                def __new__(cls, *args, **kwargs):
                    if Singleton.__instance is None:
                        Singleton.__instance=object.__new__(cls,*args,**kwargs)
                    return Singleton.__instance</code></pre>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ</title>
    <url>/2020/04/20/Python%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E5%AD%97%E5%85%B8%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E5%AD%97%E5%85%B8%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95%E5%88%86%E6%9E%90%E6%AF%94%E8%BE%83/</url>
    <content><![CDATA[<h2 id="Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ"><a href="#Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ" class="headerlink" title="Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ"></a>Pythonåˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„å‡ ç§æ–¹æ³•åˆ†ææ¯”è¾ƒ</h2><p>ä¸¤ä¸ªå­—å…¸å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d1 &#x3D; &#123;&#39;name&#39; : &#39;revotu&#39;, &#39;age&#39; : 99&#125;</span><br><span class="line">&gt;&gt;&gt; d2 &#x3D; &#123;&#39;age&#39; : 24, &#39;sex&#39; : &#39;male&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå¹¶åçš„ç»“æœå¦‚ä¸‹ï¼ˆå³ï¼Œkeyç›¸åŒæ—¶åé¢å­—å…¸å€¼è¦†ç›–å‰é¢å­—å…¸ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d</span><br><span class="line">&#123;&#39;sex&#39;: &#39;male&#39;, &#39;name&#39;: &#39;revotu&#39;, &#39;age&#39;: 24&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œè¯´æ˜å­—å…¸å¹¶ä¸æ”¯æŒ+åŠ æ³•è¿ç®—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d1 + d2</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">TypeError: unsupported operand type(s) for +: &#39;dict&#39; and &#39;dict&#39;</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>ç°æ€»ç»“å¦‚ä¸‹å‡ ç§æ–¹æ³•ä»¥åŠç®€è¦åˆ†ææ¯”è¾ƒã€‚</p>
<ol>
<li><p>å¤šæ¬¡æ›´æ–°<br>ä¸‹é¢æ˜¯æœ€ç®€å•çš„åˆå¹¶å­—å…¸çš„æ–¹å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; d.update(d1)</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ï¼Œå¹¶ä½¿ç”¨updateæ–¹æ³•å‘å­—å…¸ä¸­æ·»åŠ å…ƒç´ ã€‚æ³¨æ„ï¼Œå…ˆæ·»åŠ çš„æ˜¯d1ï¼Œä»¥ä¿è¯åé¢æ·»åŠ çš„d2é‡å¤é”®ä¼šè¦†ç›–d1ã€‚<br>æ­¤æ–¹æ³•æ»¡è¶³äº†æˆ‘ä»¬çš„è¦æ±‚ï¼Œè€Œä¸”æ¸…æ™°æ˜ç¡®ï¼Œå¯æ˜¯ä¸‰è¡Œä»£ç æ€»æ„Ÿè§‰ä¸å¤ŸPythonicã€‚</p>
</blockquote>
</li>
<li><p>å…ˆå¤åˆ¶ï¼Œåæ›´æ–°<br>å…ˆå¤åˆ¶d1å­—å…¸åˆ›å»ºä¸€ä¸ªæ–°å­—å…¸ï¼Œç„¶åä½¿ç”¨d2æ¥æ›´æ–°å‰é¢åˆ›å»ºçš„æ–°å­—å…¸ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; d1.copy()</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¯¹æ¯”æ–¹æ³•ä¸€ï¼Œè¿™ç§å¤åˆ¶d1çš„æ–¹æ³•ï¼Œæ›´æ˜æ˜¾çš„è¡¨ç°å‡ºd1ä½œä¸ºé»˜è®¤å€¼ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ„é€ å™¨<br>è¿˜å¯ä»¥ä½¿ç”¨å­—å…¸çš„æ„é€ å™¨dict()å¤åˆ¶å­—å…¸ï¼Œç„¶åå†æ›´æ–°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(d1)</span><br><span class="line">&gt;&gt;&gt; d.update(d2)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸æ–¹æ³•äºŒå¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯æ²¡æœ‰æ–¹æ³•äºŒç›´æ¥æ˜äº†ã€‚</p>
</blockquote>
</li>
<li><p>å…³é”®å­—å‚æ•°hack<br>ä½ å¯èƒ½è§è¿‡ä¸‹é¢è¿™ä¸ªå·§å¦™çš„è§£å†³åŠæ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(d1 , **d2)</span><br></pre></td></tr></table></figure>
<p>åªæœ‰ä¸€è¡Œä»£ç ï¼Œçœ‹ä¸Šå»å¾ˆé…·ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ç§hackæŠ€å·§åªæœ‰åœ¨å­—å…¸çš„é”®æ˜¯å­—ç¬¦ä¸²æ—¶æ‰æœ‰æ•ˆã€‚</p>
<blockquote>
<p>çœ‹ä¸Šå»å¾ˆcoolï¼Œä½†æ˜¯ä¸é€šç”¨ï¼Œå­—å…¸çš„é”®å¿…é¡»æ˜¯å­—ç¬¦ä¸²æ‰å¯ä»¥ç”¨è¿™ç§å…³é”®å­—å‚æ•°æ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ¨å¯¼å¼<br>å¯ä»¥ç”¨å­—å…¸æ¨å¯¼å¼è§£å†³æ­¤é—®é¢˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; &#123;k:v for d in [d1, d2] for k,v in d.items()&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å­—å…¸æ¨å¯¼å¼æ–¹æ³•æ»¡è¶³è¦æ±‚ï¼Œåªæ˜¯åµŒå¥—çš„å­—å…¸æ¨å¯¼å¼ï¼Œä¸é‚£ä¹ˆæ¸…æ™°ï¼Œä¸æ˜“äºç†è§£ã€‚</p>
</blockquote>
</li>
<li><p>å…ƒç´ æ‹¼æ¥<br>æˆ‘ä»¬ä»æ¯ä¸ªå­—å…¸ä¸­è·å–ä¸€ä¸ªå…ƒç´ åˆ—è¡¨ï¼Œå°†åˆ—è¡¨æ‹¼æ¥èµ·æ¥ï¼Œç„¶åå†ç”¨æ‹¼æ¥çš„åˆ—è¡¨æ„é€ å­—å…¸ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(list(d1.items()) + list(d2.items()))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è€Œä¸”ï¼Œd2çš„å…ƒç´ åœ¨åˆ—è¡¨åé¢ï¼Œæ‰€ä»¥åœ¨é”®é‡å¤æ—¶å¯ä»¥è¦†ç›–d1ã€‚å¦‚æœåœ¨Python2ä¸­ï¼Œitems()æ–¹æ³•æœ¬èº«è¿”å›çš„å°±æ˜¯åˆ—è¡¨ï¼Œæ— éœ€ç”¨list()è½¬æˆåˆ—è¡¨ã€‚</p>
</blockquote>
</li>
</ol>
<p>å…ƒç´ æ‹¼æ¥åœ¨æ„é€ å­—å…¸å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œåªæ˜¯çœ‹ä¸Šå»ä»£ç æœ‰äº›é‡å¤ã€‚</p>
<ol start="7">
<li><p>å…ƒç´ å¹¶é›†<br>åœ¨Python3ä¸­ï¼Œå­—å…¸è¿”å›çš„æ˜¯è§†å›¾å¯¹è±¡ï¼Œé”®çš„è§†å›¾å¯¹è±¡æ˜¯ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ï¼Œå¦‚æœå­—å…¸ä¸­çš„å€¼å¯ä»¥ä¿è¯æ˜¯å”¯ä¸€çš„å¯å“ˆå¸Œçš„ï¼Œæ­¤æ—¶itemsè¿”å›çš„è§†å›¾å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ï¼š</p>
<figure class="highlight plain"><figcaption><span>d </span></figcaption><table><tr><td class="code"><pre><span class="line">&gt; è¿™ç§æ–¹æ³•æŒºæœ‰æ„æ€ï¼Œå¯æ˜¯å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºé›†åˆæ˜¯æ— åºçš„ï¼Œé”®é‡å¤æ—¶ä¸èƒ½ä¿è¯è°è¦†ç›–è°ï¼Œè€Œä¸”å­—å…¸ä¸­çš„å€¼é€šå¸¸ä¹Ÿæ˜¯ä¸å¯å“ˆå¸Œçš„ï¼Œå½“ç„¶ä¹Ÿå°±ä¸èƒ½è¿”å›ä¸€ä¸ªç±»ä¼¼é›†åˆçš„å¯¹è±¡ã€‚</span><br><span class="line"></span><br><span class="line">8. chain items</span><br><span class="line">ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºçš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œæœ€ç¬¦åˆPythonè¯­è¨€ä¹ æƒ¯è€Œä¸”åªæœ‰ä¸€è¡Œä»£ç å®ç°çš„ï¼Œæ˜¯åˆ›å»ºä¸¤ä¸ªitemsçš„åˆ—è¡¨ï¼Œç„¶åæ‹¼æ¥æˆå­—å…¸ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥ç”¨itertools.chainæ¥ç®€åŒ–itemsæ‹¼æ¥è¿‡ç¨‹ï¼š</span><br><span class="line">&#96;&#96;&#96;&gt;&gt;&gt; d &#x3D; dict(chain(d1.items(), d2.items()))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§æ–¹æ¡ˆå¾ˆä¸é”™ï¼Œå¯èƒ½æ¯”å¦å¤–åˆ›å»ºä¸¤ä¸ªä¸å¿…è¦çš„åˆ—è¡¨æ›´é«˜æ•ˆã€‚</p>
</blockquote>
</li>
<li><p>ChainMap<br>collections.ChainMapå¯ä»¥å°†å¤šä¸ªå­—å…¸æˆ–æ˜ å°„ï¼Œåœ¨é€»è¾‘ä¸Šå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå•ç‹¬çš„æ˜ å°„ç»“æ„ï¼š</p>
<figure class="highlight plain"><figcaption><span>from collections import ChainMap</span></figcaption><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; d &#x3D; dict(ChainMap(d1, d2))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ç§æ–¹æ³•ä¹Ÿå¾ˆpythonicï¼Œè€Œä¸”ä¹Ÿæ˜¯é€šç”¨æ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li><p>å­—å…¸æ‹†åˆ†<br>åœ¨Python3.5+ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ç§å…¨æ–°çš„å­—å…¸åˆå¹¶æ–¹å¼ï¼š</p>
<figure class="highlight plain"><figcaption><span>d </span></figcaption><table><tr><td class="code"><pre><span class="line">&gt; è¿™è¡Œä»£ç å¾ˆpythonicï¼Œå¦‚æœæ˜¯ä½ çš„pythonç‰ˆæœ¬æ˜¯3.5+ï¼Œç”¨è¿™ç§æ–¹æ³•æ˜¯å¾ˆä¸é”™çš„é€‰æ‹©ã€‚</span><br><span class="line"></span><br><span class="line">### æ€»ç»“</span><br><span class="line">ä¸Šé¢è¯´äº†åç§å¯ä»¥åˆå¹¶ä¸¤ä¸ªå­—å…¸æˆä¸€ä¸ªæ–°å­—å…¸çš„æ–¹å¼ï¼Œå…·ä½“ç”¨å“ªä¸ªå–å†³äºä½ ã€‚</span><br><span class="line">å¦‚æœä½¿ç”¨çš„æ˜¯Python3.5+çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå­—å…¸æ‹†åˆ†è¿™ç§æ–°è¯­æ³•åº”è¯¥å¾ˆé€‚åˆä½ ï¼š</span><br></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<blockquote>
<p>d = {*<em>d1, *</em>d2}</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code></code></pre></li>
</ol>
<p><a href="http://www.revotu.com/python-merge-two-dicts-into-one-dict.html#more" target="_blank" rel="noopener">åŸæ–‡åšå®¢</a>  </p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹</title>
    <url>/2020/04/20/Python%E5%A6%82%E4%BD%95%E9%80%92%E5%BD%92%E5%88%A0%E9%99%A4%E7%A9%BA%E6%96%87%E4%BB%B6%E5%A4%B9/</url>
    <content><![CDATA[<h2 id="Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹"><a href="#Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹" class="headerlink" title="Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹"></a>Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹</h2><p>Pythonå¦‚ä½•é€’å½’åˆ é™¤ç©ºæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªé—®é¢˜å¾ˆå¸¸è§ã€‚ä½†å¤§å¤šæ•°äººçš„è§£å†³åŠæ³•éƒ½æ˜¯è‡ªå·±å®ç°é€’å½’å‡½æ•°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…¶å®æ ¹æœ¬ä¸ç”¨é‚£ä¹ˆéº»çƒ¦ã€‚Pythonä¸­çš„os.walkæä¾›äº†ä¸€ç§ä»å†…åˆ°å¤–çš„éå†ç›®å½•æ ‘çš„æ–¹æ³•ï¼ˆè®¾ç½®topdown=Falseï¼‰ï¼Œè¿™æ ·ç”±å†…åˆ°å¤–åˆ¤æ–­å½“å‰ç›®å½•æ ‘ä¸‹æ˜¯å¦æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œå¦‚æœéƒ½æ²¡æœ‰åˆ™æ„å‘³ç€å½“å‰ç›®å½•æ ‘ä¸ºç©ºæ–‡ä»¶å¤¹ï¼Œos.rmdiråˆ é™¤å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#Recursively Remove Empty Directories</span><br><span class="line">import os</span><br><span class="line">for root, dirs, files in os.walk(path, topdown&#x3D;False):</span><br><span class="line">    if not files and not dirs:</span><br><span class="line">        os.rmdir(root)</span><br><span class="line">&#96;&#96;&#96;        </span><br><span class="line">å¦‚æœåœ¨éå†æ–‡ä»¶å¤¹åŒæ—¶ï¼Œå…ˆåšäº†ä¸€äº›æ“ä½œï¼Œæ¯”å¦‚åˆ é™¤æ–‡ä»¶æ“ä½œos.removeï¼Œç„¶åå†åˆ¤æ–­æ­¤æ—¶æ–‡ä»¶å¤¹æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™åˆ é™¤ã€‚éœ€è¦ç”¨os.listdiråˆ¤æ–­å½“å‰æ–‡ä»¶å¤¹æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºdirså’Œfilesè¿˜æ˜¯åˆšè¿›å…¥å½“å‰æ–‡ä»¶å¤¹rootæ—¶å¾—åˆ°çš„ã€‚</span><br></pre></td></tr></table></figure>
<p>#Recursively Remove Empty Directories, During do something like os.remove(file)<br>import os<br>for root, dirs, files in os.walk(path, topdown=False):<br>    # do something like os.remove(file)<br>    if not os.listdir(root):<br>        os.rmdir(root)<br>```        </p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ-1ä½¿ç”¨</title>
    <url>/2020/04/20/RabbitMQ-1%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h2 id="ä¸€-RabbitMQ-1"><a href="#ä¸€-RabbitMQ-1" class="headerlink" title="ä¸€. RabbitMQ-1"></a>ä¸€. RabbitMQ-1</h2><h3 id="ä»€ä¹ˆå«æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä»€ä¹ˆå«æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä»€ä¹ˆå«æ¶ˆæ¯é˜Ÿåˆ—"></a>ä»€ä¹ˆå«æ¶ˆæ¯é˜Ÿåˆ—</h3><p>æ¶ˆæ¯ï¼ˆMessageï¼‰æ˜¯æŒ‡åœ¨åº”ç”¨é—´ä¼ é€çš„æ•°æ®ã€‚æ¶ˆæ¯å¯ä»¥éå¸¸ç®€å•ï¼Œæ¯”å¦‚åªåŒ…å«æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ›´å¤æ‚ï¼Œå¯èƒ½åŒ…å«åµŒå…¥å¯¹è±¡ã€‚<br>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰æ˜¯ä¸€ç§åº”ç”¨é—´çš„é€šä¿¡æ–¹å¼ï¼Œæ¶ˆæ¯å‘é€åå¯ä»¥ç«‹å³è¿”å›ï¼Œç”±æ¶ˆæ¯ç³»ç»Ÿæ¥ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ã€‚æ¶ˆæ¯å‘å¸ƒè€…åªç®¡æŠŠæ¶ˆæ¯å‘å¸ƒåˆ° MQ ä¸­è€Œä¸ç”¨ç®¡è°æ¥å–ï¼Œæ¶ˆæ¯ä½¿ç”¨è€…åªç®¡ä» MQ ä¸­å–æ¶ˆæ¯è€Œä¸ç®¡æ˜¯è°å‘å¸ƒçš„ã€‚è¿™æ ·å‘å¸ƒè€…å’Œä½¿ç”¨è€…éƒ½ä¸ç”¨çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ã€‚</p>
<h3 id="ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>ä¸ºä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä»ä¸Šé¢çš„æè¿°ä¸­å¯ä»¥çœ‹å‡ºæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ç§åº”ç”¨é—´çš„å¼‚æ­¥åä½œæœºåˆ¶ï¼Œé‚£ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ MQ å‘¢?<br>ä»¥å¸¸è§çš„è®¢å•ç³»ç»Ÿä¸ºä¾‹ï¼Œç”¨æˆ·ç‚¹å‡»ã€ä¸‹å•ã€‘æŒ‰é’®ä¹‹åçš„ä¸šåŠ¡é€»è¾‘å¯èƒ½åŒ…æ‹¬ï¼šæ‰£å‡åº“å­˜ã€ç”Ÿæˆç›¸åº”å•æ®ã€å‘çº¢åŒ…ã€å‘çŸ­ä¿¡é€šçŸ¥ã€‚åœ¨ä¸šåŠ¡å‘å±•åˆæœŸè¿™äº›é€»è¾‘å¯èƒ½æ”¾åœ¨ä¸€èµ·åŒæ­¥æ‰§è¡Œï¼Œéšç€ä¸šåŠ¡çš„å‘å±•è®¢å•é‡å¢é•¿ï¼Œéœ€è¦æå‡ç³»ç»ŸæœåŠ¡çš„æ€§èƒ½ï¼Œè¿™æ—¶å¯ä»¥å°†ä¸€äº›ä¸éœ€è¦ç«‹å³ç”Ÿæ•ˆçš„æ“ä½œæ‹†åˆ†å‡ºæ¥å¼‚æ­¥æ‰§è¡Œï¼Œæ¯”å¦‚å‘æ”¾çº¢åŒ…ã€å‘çŸ­ä¿¡é€šçŸ¥ç­‰ã€‚è¿™ç§åœºæ™¯ä¸‹å°±å¯ä»¥ç”¨ MQ ï¼Œåœ¨ä¸‹å•çš„ä¸»æµç¨‹ï¼ˆæ¯”å¦‚æ‰£å‡åº“å­˜ã€ç”Ÿæˆç›¸åº”å•æ®ï¼‰å®Œæˆä¹‹åå‘é€ä¸€æ¡æ¶ˆæ¯åˆ° MQ è®©ä¸»æµç¨‹å¿«é€Ÿå®Œç»“ï¼Œè€Œç”±å¦å¤–çš„å•ç‹¬çº¿ç¨‹æ‹‰å–MQçš„æ¶ˆæ¯ï¼ˆæˆ–è€…ç”± MQ æ¨é€æ¶ˆæ¯ï¼‰ï¼Œå½“å‘ç° MQ ä¸­æœ‰å‘çº¢åŒ…æˆ–å‘çŸ­ä¿¡ä¹‹ç±»çš„æ¶ˆæ¯æ—¶ï¼Œæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ã€‚<br><a href="https://blog.csdn.net/whoamiyang/article/details/54954780" target="_blank" rel="noopener">è¯¦ç»†</a></p>
<h3 id="RabbitMQä»‹ç»"><a href="#RabbitMQä»‹ç»" class="headerlink" title="RabbitMQä»‹ç»"></a>RabbitMQä»‹ç»</h3><p>RabbitMQ æ˜¯ä¸€ä¸ªç”± Erlang è¯­è¨€å¼€å‘çš„ AMQP çš„å¼€æºå®ç°ã€‚<br>rabbitMQæ˜¯ä¸€æ¬¾åŸºäºAMQPåè®®çš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒèƒ½å¤Ÿåœ¨åº”ç”¨ä¹‹é—´æä¾›å¯é çš„æ¶ˆæ¯ä¼ è¾“ã€‚åœ¨æ˜“ç”¨æ€§ï¼Œæ‰©å±•æ€§ï¼Œé«˜å¯ç”¨æ€§ä¸Šè¡¨ç°ä¼˜ç§€ã€‚ä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶åˆ©äºåº”ç”¨ä¹‹é—´çš„è§£è€¦ï¼Œç”Ÿäº§è€…ï¼ˆå®¢æˆ·ç«¯ï¼‰æ— éœ€çŸ¥é“æ¶ˆè´¹è€…ï¼ˆæœåŠ¡ç«¯ï¼‰çš„å­˜åœ¨ã€‚è€Œä¸”ä¸¤ç«¯å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™ï¼Œå¤§å¤§æä¾›äº†çµæ´»æ€§ã€‚<br><a href="https://www.rabbitmq.com/tutorials/tutorial-one-python.html" target="_blank" rel="noopener">ä¸­æ–‡æ–‡æ¡£</a></p>
<h2 id="äºŒ-rabbitMQå®‰è£…"><a href="#äºŒ-rabbitMQå®‰è£…" class="headerlink" title="äºŒ. rabbitMQå®‰è£…"></a>äºŒ. rabbitMQå®‰è£…</h2><h3 id="2-1-Linux"><a href="#2-1-Linux" class="headerlink" title="2.1 Linux"></a>2.1 Linux</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å®‰è£…é…ç½®epelæº</span><br><span class="line">   $ rpm -ivh http:&#x2F;&#x2F;dl.fedoraproject.org&#x2F;pub&#x2F;epel&#x2F;6&#x2F;i386&#x2F;epel-release-6-8.noarch.rpm</span><br><span class="line"> </span><br><span class="line">å®‰è£…erlang</span><br><span class="line">   $ yum -y install erlang</span><br><span class="line"> </span><br><span class="line">å®‰è£…RabbitMQ</span><br><span class="line">   $ yum -y install rabbitmq-server</span><br><span class="line">æ³¨æ„ï¼šservice rabbitmq-server start&#x2F;stop</span><br></pre></td></tr></table></figure>
<h3 id="2-2-Mac"><a href="#2-2-Mac" class="headerlink" title="2.2 Mac"></a>2.2 Mac</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># brew install rabbitmq</span><br><span class="line"># export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;sbin</span><br><span class="line"># rabbitmq-server</span><br></pre></td></tr></table></figure>
<h3 id="2-2-rabbitMQå·¥ä½œæ¨¡å‹"><a href="#2-2-rabbitMQå·¥ä½œæ¨¡å‹" class="headerlink" title="2.2 rabbitMQå·¥ä½œæ¨¡å‹"></a>2.2 rabbitMQå·¥ä½œæ¨¡å‹</h3><h4 id="2-2-1-ç®€å•æ¨¡å¼"><a href="#2-2-1-ç®€å•æ¨¡å¼" class="headerlink" title="2.2.1 ç®€å•æ¨¡å¼"></a>2.2.1 ç®€å•æ¨¡å¼</h4><p>ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ######################### ç”Ÿäº§è€… #########################</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters( host&#x3D;&#39;localhost&#39;))</span><br><span class="line"></span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)</span><br><span class="line"></span><br><span class="line">channel.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                      routing_key&#x3D;&#39;hello&#39;,</span><br><span class="line">                      body&#x3D;&#39;Hello World!&#39;)</span><br><span class="line"></span><br><span class="line">print(&quot; [x] Sent &#39;Hello World!&#39;&quot;)</span><br><span class="line">connection.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ########################## æ¶ˆè´¹è€… ##########################</span><br><span class="line"> </span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(host&#x3D;&#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"> </span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)</span><br><span class="line"> </span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] Received %r&quot; % body)</span><br><span class="line"> </span><br><span class="line"># éœ€è¦producerç¡®è®¤ä¹‹ååœ¨åˆ é™¤æ¶ˆæ¯å†…å®¹çš„æ—¶å€™éœ€è¦å°†no_ackç½®ä¸ºFalse </span><br><span class="line">channel.basic_consume( callback,</span><br><span class="line">                       queue&#x3D;&#39;hello&#39;,</span><br><span class="line">                       no_ack&#x3D;True)</span><br><span class="line"> </span><br><span class="line">print(&#39; [*] Waiting for messages. To exit press CTRL+C&#39;)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h3 id="ç›¸å…³å‚æ•°è¯´æ˜"><a href="#ç›¸å…³å‚æ•°è¯´æ˜" class="headerlink" title="ç›¸å…³å‚æ•°è¯´æ˜"></a>ç›¸å…³å‚æ•°è¯´æ˜</h3><blockquote>
<p>no-ack ï¼ Falseï¼Œå¦‚æœæ¶ˆè´¹è€…é‡åˆ°æƒ…å†µ(its channel is closed, connection is closed, or TCP connection is lost)æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆï¼ŒRabbitMQä¼šé‡æ–°å°†è¯¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
</blockquote>
<ul>
<li>å›è°ƒå‡½æ•°ä¸­çš„<code>ch.basic_ack(delivery_tag=method.delivery_tag)</code></li>
<li>basic_comsumeä¸­çš„<code>no_ack=False</code></li>
</ul>
<ol>
<li>æ¶ˆæ¯æ¥æ”¶ç«¯åº”è¯¥è¿™ä¹ˆå†™<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import pika</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;10.211.55.4&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)</span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] Received %r&quot; % body)</span><br><span class="line">    import time</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    print &#39;ok&#39;</span><br><span class="line">    ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;&#39;hello&#39;,</span><br><span class="line">                      no_ack&#x3D;False)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for messages. To exit press CTRL+C&#39;)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure></li>
<li>durable:æ¶ˆæ¯ä¸ä¸¢å¤±<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç”Ÿäº§è€…</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(host&#x3D;&#39;10.211.55.4&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line"># make message persistent</span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;, durable&#x3D;True)</span><br><span class="line"></span><br><span class="line">channel.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                      routing_key&#x3D;&#39;hello&#39;,</span><br><span class="line">                      body&#x3D;&#39;Hello World!&#39;,</span><br><span class="line">                      properties&#x3D;pika.BasicProperties(</span><br><span class="line">                          delivery_mode&#x3D;2, # make message persistent</span><br><span class="line">                      ))</span><br><span class="line">print(&quot; [x] Sent &#39;Hello World!&#39;&quot;)</span><br><span class="line">connection.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ¶ˆè´¹è€…</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(host&#x3D;&#39;10.211.55.4&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line"># make message persistent</span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;, durable&#x3D;True)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] Received %r&quot; % body)</span><br><span class="line">    import time</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    print &#39;ok&#39;</span><br><span class="line">    ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;&#39;hello&#39;,</span><br><span class="line">                      no_ack&#x3D;False)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for messages. To exit press CTRL+C&#39;)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure></li>
<li>æ¶ˆæ¯è·å–é¡ºåº<br>é»˜è®¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„æ•°æ®æ˜¯æŒ‰ç…§é¡ºåºè¢«æ¶ˆè´¹è€…æ‹¿èµ°ï¼Œä¾‹å¦‚ï¼šæ¶ˆè´¹è€…1 å»é˜Ÿåˆ—ä¸­è·å– å¥‡æ•° åºåˆ—çš„ä»»åŠ¡ï¼Œæ¶ˆè´¹è€…1å»é˜Ÿåˆ—ä¸­è·å– å¶æ•° åºåˆ—çš„ä»»åŠ¡ã€‚<br>channel.basic_qos(prefetch_count=1) è¡¨ç¤ºè°æ¥è°è·å–æ¶ˆè´¹å°±åˆ†å‘ç»™æ¶ˆè´¹è€…ï¼Œä¸å†æŒ‰ç…§å¥‡å¶æ•°æ’åˆ—<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(host&#x3D;&#39;10.211.55.4&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line"># make message persistent</span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] Received %r&quot; % body)</span><br><span class="line">    import time</span><br><span class="line">    time.sleep(10)</span><br><span class="line">    print &#39;ok&#39;</span><br><span class="line">    ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)</span><br><span class="line"></span><br><span class="line">channel.basic_qos(prefetch_count&#x3D;1)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;&#39;hello&#39;,</span><br><span class="line">                      no_ack&#x3D;False)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for messages. To exit press CTRL+C&#39;)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰-exchangeäº¤æ¢æœºæ¨¡å‹"><a href="#ä¸‰-exchangeäº¤æ¢æœºæ¨¡å‹" class="headerlink" title="ä¸‰. exchangeäº¤æ¢æœºæ¨¡å‹"></a>ä¸‰. exchangeäº¤æ¢æœºæ¨¡å‹</h2><h3 id="3-1-å‘å¸ƒè®¢é˜…"><a href="#3-1-å‘å¸ƒè®¢é˜…" class="headerlink" title="3.1 å‘å¸ƒè®¢é˜…"></a>3.1 å‘å¸ƒè®¢é˜…</h3><img src="https://images2015.cnblogs.com/blog/425762/201607/425762-20160717140730998-2143093474.png" alt="æ¨¡å‹å›¾"><br>å‘å¸ƒè®¢é˜…å’Œç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—åŒºåˆ«åœ¨äºï¼Œå‘å¸ƒè®¢é˜…ä¼šå°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰çš„è®¢é˜…è€…ï¼Œè€Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ•°æ®è¢«æ¶ˆè´¹ä¸€æ¬¡ä¾¿æ¶ˆå¤±ã€‚æ‰€ä»¥ï¼ŒRabbitMQå®ç°å‘å¸ƒå’Œè®¢é˜…æ—¶ï¼Œä¼šä¸ºæ¯ä¸€ä¸ªè®¢é˜…è€…åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œè€Œå‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯æ”¾ç½®åœ¨æ‰€æœ‰ç›¸å…³é˜Ÿåˆ—ä¸­ã€‚<br>exchange_type = fanout<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ç”Ÿäº§è€…</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">                         exchange_type&#x3D;&#39;fanout&#39;)</span><br><span class="line"></span><br><span class="line">message &#x3D; &#39; &#39;.join(sys.argv[1:]) or &quot;info: Hello World!&quot;</span><br><span class="line">channel.basic_publish(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">                      routing_key&#x3D;&#39;&#39;,</span><br><span class="line">                      body&#x3D;message)</span><br><span class="line">print(&quot; [x] Sent %r&quot; % message)</span><br><span class="line">connection.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ¶ˆè´¹è€…</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">                         exchange_type&#x3D;&#39;fanout&#39;)</span><br><span class="line"></span><br><span class="line">result &#x3D; channel.queue_declare(exclusive&#x3D;True)</span><br><span class="line">queue_name &#x3D; result.method.queue</span><br><span class="line"></span><br><span class="line">channel.queue_bind(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">                   queue&#x3D;queue_name)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for logs. To exit press CTRL+C&#39;)</span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] %r&quot; % body)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;queue_name,</span><br><span class="line">                      no_ack&#x3D;True)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h3 id="3-2-å…³é”®å­—å‘é€"><a href="#3-2-å…³é”®å­—å‘é€" class="headerlink" title="3.2 å…³é”®å­—å‘é€"></a>3.2 å…³é”®å­—å‘é€</h3><img src="https://images2015.cnblogs.com/blog/425762/201607/425762-20160717140748795-1181706200.png" alt="æ¨¡å‹å›¾"><br>exchange_type = direct<br>ä¹‹å‰ç¤ºä¾‹ï¼Œå‘é€æ¶ˆæ¯æ—¶æ˜ç¡®æŒ‡å®šæŸä¸ªé˜Ÿåˆ—å¹¶å‘å…¶ä¸­å‘é€æ¶ˆæ¯ï¼ŒRabbitMQè¿˜æ”¯æŒæ ¹æ®å…³é”®å­—å‘é€ï¼Œå³ï¼šé˜Ÿåˆ—ç»‘å®šå…³é”®å­—ï¼Œå‘é€è€…å°†æ•°æ®æ ¹æ®å…³é”®å­—å‘é€åˆ°æ¶ˆæ¯exchangeï¼Œexchangeæ ¹æ® å…³é”®å­— åˆ¤å®šåº”è¯¥å°†æ•°æ®å‘é€è‡³æŒ‡å®šé˜Ÿåˆ—ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange&#x3D;&#39;direct_logs&#39;,</span><br><span class="line">                         exchange_type&#x3D;&#39;direct&#39;)</span><br><span class="line"></span><br><span class="line">result &#x3D; channel.queue_declare(exclusive&#x3D;True)</span><br><span class="line">queue_name &#x3D; result.method.queue</span><br><span class="line"></span><br><span class="line">severities &#x3D; sys.argv[1:]</span><br><span class="line">if not severities:</span><br><span class="line">    sys.stderr.write(&quot;Usage: %s [info] [warning] [error]\n&quot; % sys.argv[0])</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line">for severity in severities:</span><br><span class="line">    channel.queue_bind(exchange&#x3D;&#39;direct_logs&#39;,</span><br><span class="line">                       queue&#x3D;queue_name,</span><br><span class="line">                       routing_key&#x3D;severity)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for logs. To exit press CTRL+C&#39;)</span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] %r:%r&quot; % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;queue_name,</span><br><span class="line">                      no_ack&#x3D;True)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h3 id="3-3-æ¨¡ç³ŠåŒ¹é…"><a href="#3-3-æ¨¡ç³ŠåŒ¹é…" class="headerlink" title="3.3 æ¨¡ç³ŠåŒ¹é…"></a>3.3 æ¨¡ç³ŠåŒ¹é…</h3><img src="https://images2015.cnblogs.com/blog/425762/201607/425762-20160717140807232-1395723247.png" alt="æ¨¡å‹å›¾"><br>exchange_type = topic</li>
</ol>
<p>å‘é€è€…è·¯ç”±å€¼              é˜Ÿåˆ—ä¸­<br><a href="http://www.weshuke.python" target="_blank" rel="noopener">www.weshuke.python</a>          old.*  â€“ ä¸åŒ¹é…<br>age.weshuke.python          old.#  â€“ åŒ¹é…<br>åœ¨topicç±»å‹ä¸‹ï¼Œå¯ä»¥è®©é˜Ÿåˆ—ç»‘å®šå‡ ä¸ªæ¨¡ç³Šçš„å…³é”®å­—ï¼Œä¹‹åå‘é€è€…å°†æ•°æ®å‘é€åˆ°exchangeï¼Œexchangeå°†ä¼ å…¥â€è·¯ç”±å€¼â€œå’Œ â€å…³é”®å­—â€œè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸï¼Œåˆ™å°†æ•°æ®å‘é€åˆ°æŒ‡å®šé˜Ÿåˆ—ã€‚</p>
<ul>
<li># è¡¨ç¤ºå¯ä»¥åŒ¹é… 0 ä¸ª æˆ– å¤šä¸ª å•è¯</li>
<li>*  è¡¨ç¤ºåªèƒ½åŒ¹é… ä¸€ä¸ª å•è¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line">channel.exchange_declare(exchange&#x3D;&#39;topic_logs&#39;,</span><br><span class="line">                         exchange_type&#x3D;&#39;topic&#39;)</span><br><span class="line"></span><br><span class="line">result &#x3D; channel.queue_declare(exclusive&#x3D;True)</span><br><span class="line">queue_name &#x3D; result.method.queue</span><br><span class="line"></span><br><span class="line">binding_keys &#x3D; sys.argv[1:]</span><br><span class="line">if not binding_keys:</span><br><span class="line">    sys.stderr.write(&quot;Usage: %s [binding_key]...\n&quot; % sys.argv[0])</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line">for binding_key in binding_keys:</span><br><span class="line">    channel.queue_bind(exchange&#x3D;&#39;topic_logs&#39;,</span><br><span class="line">                       queue&#x3D;queue_name,</span><br><span class="line">                       routing_key&#x3D;binding_key)</span><br><span class="line"></span><br><span class="line">print(&#39; [*] Waiting for logs. To exit press CTRL+C&#39;)</span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):</span><br><span class="line">    print(&quot; [x] %r:%r&quot; % (method.routing_key, body))</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;queue_name,</span><br><span class="line">                      no_ack&#x3D;True)</span><br><span class="line"></span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h2 id="åŸºäºRabbitMQçš„RPC"><a href="#åŸºäºRabbitMQçš„RPC" class="headerlink" title="åŸºäºRabbitMQçš„RPC"></a>åŸºäºRabbitMQçš„RPC</h2><h3 id="Callback-queue-å›è°ƒé˜Ÿåˆ—"><a href="#Callback-queue-å›è°ƒé˜Ÿåˆ—" class="headerlink" title="Callback queue å›è°ƒé˜Ÿåˆ—"></a>Callback queue å›è°ƒé˜Ÿåˆ—</h3>ä¸€ä¸ªå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚åï¼Œå°†å…¶å¤„ç†ç»“æœä¿å­˜åœ¨ä¸€ä¸ªå­˜å‚¨ä½“ä¸­ã€‚è€Œå®¢æˆ·ç«¯ä¸ºäº†è·å¾—å¤„ç†ç»“æœï¼Œé‚£ä¹ˆå®¢æˆ·åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼ŒåŒæ—¶å‘é€ä¸€ä¸ªå›è°ƒé˜Ÿåˆ—åœ°å€<code>reply_to</code>ã€‚<h3 id="Correlation-id-å…³è”æ ‡è¯†"><a href="#Correlation-id-å…³è”æ ‡è¯†" class="headerlink" title="Correlation id å…³è”æ ‡è¯†"></a>Correlation id å…³è”æ ‡è¯†</h3>ä¸€ä¸ªå®¢æˆ·ç«¯å¯èƒ½ä¼šå‘é€å¤šä¸ªè¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œå½“æœåŠ¡å™¨å¤„ç†å®Œåï¼Œå®¢æˆ·ç«¯æ— æ³•è¾¨åˆ«åœ¨å›è°ƒé˜Ÿåˆ—ä¸­çš„å“åº”å…·ä½“å’Œé‚£ä¸ªè¯·æ±‚æ—¶å¯¹åº”çš„ã€‚ä¸ºäº†å¤„ç†è¿™ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯åœ¨å‘é€æ¯ä¸ªè¯·æ±‚æ—¶ï¼ŒåŒæ—¶ä¼šé™„å¸¦ä¸€ä¸ªç‹¬æœ‰<code>correlation_id</code>å±æ€§ï¼Œè¿™æ ·å®¢æˆ·ç«¯åœ¨å›è°ƒé˜Ÿåˆ—ä¸­æ ¹æ®<code>correlation_id</code>å­—æ®µçš„å€¼å°±å¯ä»¥åˆ†è¾¨æ­¤å“åº”å±äºå“ªä¸ªè¯·æ±‚ã€‚</li>
</ul>
<ol>
<li>å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼šæŸä¸ªåº”ç”¨å°†è¯·æ±‚ä¿¡æ¯äº¤ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å‘é€RPCè¯·æ±‚ï¼Œåœ¨å‘é€RPCè¯·æ±‚åˆ°RPCè¯·æ±‚é˜Ÿåˆ—æ—¶ï¼Œå®¢æˆ·ç«¯è‡³å°‘å‘é€å¸¦æœ‰reply_toä»¥åŠcorrelation_idä¸¤ä¸ªå±æ€§çš„ä¿¡æ¯</li>
<li>æœåŠ¡å™¨ç«¯å·¥ä½œæµï¼š ç­‰å¾…æ¥å—å®¢æˆ·ç«¯å‘æ¥RPCè¯·æ±‚ï¼Œå½“è¯·æ±‚å‡ºç°çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ä»RPCè¯·æ±‚é˜Ÿåˆ—ä¸­å–å‡ºè¯·æ±‚ï¼Œç„¶åå¤„ç†åï¼Œå°†å“åº”å‘é€åˆ°reply_toæŒ‡å®šçš„å›è°ƒé˜Ÿåˆ—ä¸­.</li>
<li>å®¢æˆ·ç«¯æ¥å—å¤„ç†ç»“æœï¼š å®¢æˆ·ç«¯ç­‰å¾…å›è°ƒé˜Ÿåˆ—ä¸­å‡ºç°å“åº”ï¼Œå½“å“åº”å‡ºç°æ—¶ï¼Œå®ƒä¼šæ ¹æ®å“åº”ä¸­correlation_idå­—æ®µçš„å€¼ï¼Œå°†å…¶è¿”å›ç»™å¯¹åº”çš„åº”ç”¨.</li>
</ol>
<h3 id="æœåŠ¡å™¨ç«¯"><a href="#æœåŠ¡å™¨ç«¯" class="headerlink" title="æœåŠ¡å™¨ç«¯"></a>æœåŠ¡å™¨ç«¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line"></span><br><span class="line"># å»ºç«‹è¿æ¥ï¼ŒæœåŠ¡å™¨åœ°å€ä¸ºlocalhostï¼Œå¯æŒ‡å®šipåœ°å€</span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">        host&#x3D;&#39;localhost&#39;))</span><br><span class="line"></span><br><span class="line"># å»ºç«‹ä¼šè¯</span><br><span class="line">channel &#x3D; connection.channel()</span><br><span class="line"></span><br><span class="line"># å£°æ˜RPCè¯·æ±‚é˜Ÿåˆ—</span><br><span class="line">channel.queue_declare(queue&#x3D;&#39;rpc_queue&#39;)</span><br><span class="line"></span><br><span class="line"># æ•°æ®å¤„ç†æ–¹æ³•</span><br><span class="line">def fib(n):</span><br><span class="line">    if n &#x3D;&#x3D; 0:</span><br><span class="line">        return 0</span><br><span class="line">    elif n &#x3D;&#x3D; 1:</span><br><span class="line">        return 1</span><br><span class="line">    else:</span><br><span class="line">        return fib(n-1) + fib(n-2)</span><br><span class="line"></span><br><span class="line"># å¯¹RPCè¯·æ±‚é˜Ÿåˆ—ä¸­çš„è¯·æ±‚è¿›è¡Œå¤„ç†</span><br><span class="line">def on_request(ch, method, props, body):</span><br><span class="line">    n &#x3D; int(body)</span><br><span class="line"></span><br><span class="line">    print(&quot; [.] fib(%s)&quot; % n)</span><br><span class="line"></span><br><span class="line">    # è°ƒç”¨æ•°æ®å¤„ç†æ–¹æ³•</span><br><span class="line">    response &#x3D; fib(n)</span><br><span class="line"></span><br><span class="line">    # å°†å¤„ç†ç»“æœ(å“åº”)å‘é€åˆ°å›è°ƒé˜Ÿåˆ—</span><br><span class="line">    ch.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                     routing_key&#x3D;props.reply_to,</span><br><span class="line">                     properties&#x3D;pika.BasicProperties(correlation_id &#x3D; \</span><br><span class="line">                                                         props.correlation_id),</span><br><span class="line">                     body&#x3D;str(response))</span><br><span class="line">    ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)</span><br><span class="line"></span><br><span class="line"># è´Ÿè½½å‡è¡¡ï¼ŒåŒä¸€æ—¶åˆ»å‘é€ç»™è¯¥æœåŠ¡å™¨çš„è¯·æ±‚ä¸è¶…è¿‡ä¸€ä¸ª</span><br><span class="line">channel.basic_qos(prefetch_count&#x3D;1)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(on_request, queue&#x3D;&#39;rpc_queue&#39;)</span><br><span class="line"></span><br><span class="line">print(&quot; [x] Awaiting RPC requests&quot;)</span><br><span class="line">channel.start_consuming()</span><br></pre></td></tr></table></figure>
<h3 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">import pika</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line">class FibonacciRpcClient(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        â€â€œâ€</span><br><span class="line">        å®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œåˆ›å»ºå›è°ƒé˜Ÿåˆ—ï¼Œä¼šå¼€å¯ä¼šè¯ç”¨äºå‘é€RPCè¯·æ±‚ä»¥åŠæ¥å—å“åº”</span><br><span class="line">        </span><br><span class="line">        â€œâ€â€œ</span><br><span class="line">        </span><br><span class="line">        # å»ºç«‹è¿æ¥ï¼ŒæŒ‡å®šæœåŠ¡å™¨çš„ipåœ°å€</span><br><span class="line">        self.connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">                host&#x3D;&#39;localhost&#39;))</span><br><span class="line">                </span><br><span class="line">        # å»ºç«‹ä¸€ä¸ªä¼šè¯ï¼Œæ¯ä¸ªchannelä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span><br><span class="line">        self.channel &#x3D; self.connection.channel()</span><br><span class="line">        </span><br><span class="line">        # å£°æ˜å›è°ƒé˜Ÿåˆ—ï¼Œå†æ¬¡å£°æ˜çš„åŸå› æ˜¯ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯èƒ½å…ˆåå¼€å¯ï¼Œè¯¥å£°æ˜æ˜¯å¹‚ç­‰çš„ï¼Œå¤šæ¬¡å£°æ˜ï¼Œä½†åªç”Ÿæ•ˆä¸€æ¬¡</span><br><span class="line">        result &#x3D; self.channel.queue_declare(exclusive&#x3D;True)</span><br><span class="line">        # å°†æ¬¡é˜Ÿåˆ—æŒ‡å®šä¸ºå½“å‰å®¢æˆ·ç«¯çš„å›è°ƒé˜Ÿåˆ—</span><br><span class="line">        self.callback_queue &#x3D; result.method.queue</span><br><span class="line">        </span><br><span class="line">        # å®¢æˆ·ç«¯è®¢é˜…å›è°ƒé˜Ÿåˆ—ï¼Œå½“å›è°ƒé˜Ÿåˆ—ä¸­æœ‰å“åº”æ—¶ï¼Œè°ƒç”¨&#96;on_response&#96;æ–¹æ³•å¯¹å“åº”è¿›è¡Œå¤„ç†; </span><br><span class="line">        self.channel.basic_consume(self.on_response, no_ack&#x3D;True,</span><br><span class="line">                                   queue&#x3D;self.callback_queue)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # å¯¹å›è°ƒé˜Ÿåˆ—ä¸­çš„å“åº”è¿›è¡Œå¤„ç†çš„å‡½æ•°</span><br><span class="line">    def on_response(self, ch, method, props, body):</span><br><span class="line">        if self.corr_id &#x3D;&#x3D; props.correlation_id:</span><br><span class="line">            self.response &#x3D; body</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # å‘å‡ºRPCè¯·æ±‚</span><br><span class="line">    def call(self, n):</span><br><span class="line">    </span><br><span class="line">        # åˆå§‹åŒ– response</span><br><span class="line">        self.response &#x3D; None</span><br><span class="line">        </span><br><span class="line">        #ç”Ÿæˆcorrelation_id </span><br><span class="line">        self.corr_id &#x3D; str(uuid.uuid4())</span><br><span class="line">        </span><br><span class="line">        # å‘é€RPCè¯·æ±‚å†…å®¹åˆ°RPCè¯·æ±‚é˜Ÿåˆ—&#96;rpc_queue&#96;ï¼ŒåŒæ—¶å‘é€çš„è¿˜æœ‰&#96;reply_to&#96;å’Œ&#96;correlation_id&#96;</span><br><span class="line">        self.channel.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                                   routing_key&#x3D;&#39;rpc_queue&#39;,</span><br><span class="line">                                   properties&#x3D;pika.BasicProperties(</span><br><span class="line">                                         reply_to &#x3D; self.callback_queue,</span><br><span class="line">                                         correlation_id &#x3D; self.corr_id,</span><br><span class="line">                                         ),</span><br><span class="line">                                   body&#x3D;str(n))</span><br><span class="line">                                   </span><br><span class="line">        </span><br><span class="line">        while self.response is None:</span><br><span class="line">            self.connection.process_data_events()</span><br><span class="line">        return int(self.response)</span><br><span class="line"></span><br><span class="line"># å»ºç«‹å®¢æˆ·ç«¯</span><br><span class="line">fibonacci_rpc &#x3D; FibonacciRpcClient()</span><br><span class="line"></span><br><span class="line"># å‘é€RPCè¯·æ±‚</span><br><span class="line">print(&quot; [x] Requesting fib(30)&quot;)</span><br><span class="line">response &#x3D; fibonacci_rpc.call(30)</span><br><span class="line">print(&quot; [.] Got %r&quot; % response)</span><br></pre></td></tr></table></figure>


<p><a href="http://www.cnblogs.com/yuanchenqi/articles/8507109.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a></p>
]]></content>
      <categories>
        <category>RabbitMQ</category>
      </categories>
      <tags>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>SHELL è·å–ç½‘å¡æµé‡</title>
    <url>/2020/04/20/SHELL-%E8%8E%B7%E5%8F%96%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/</url>
    <content><![CDATA[<h2 id="SHELL-è·å–ç½‘å¡æµé‡"><a href="#SHELL-è·å–ç½‘å¡æµé‡" class="headerlink" title="SHELL è·å–ç½‘å¡æµé‡"></a>SHELL è·å–ç½‘å¡æµé‡</h2><h3 id="1-ç‰ˆæœ¬ä¸€"><a href="#1-ç‰ˆæœ¬ä¸€" class="headerlink" title="1. ç‰ˆæœ¬ä¸€"></a>1. ç‰ˆæœ¬ä¸€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">#ä½¿ç”¨æ–¹æ³•</span><br><span class="line">usage()</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;useage: $0 ethname intervel&quot;</span><br><span class="line">  exit 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#ç½‘å£é…ç½®</span><br><span class="line">if [ $# -gt 1 ];then</span><br><span class="line">  ethname&#x3D;$1</span><br><span class="line">  num&#x3D;&#96;ifconfig|grep $&#123;ethname&#125;|wc -l&#96;</span><br><span class="line">  if [ $num -gt 0 ];then</span><br><span class="line">   ethname&#x3D;$1</span><br><span class="line">  else</span><br><span class="line">    echo &quot;Can&#39;t find $ethname,Please Check&quot;</span><br><span class="line">    exit 1</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#æ—¶é—´é…ç½®</span><br><span class="line">intervel&#x3D;1</span><br><span class="line">if [ $# -gt 0 ]; then</span><br><span class="line">  interval&#x3D;$2</span><br><span class="line">  test&#x3D;&#96;expr &quot;$interval&quot; \* 0&#96;</span><br><span class="line">  if [ &quot;$test&quot; !&#x3D; &quot;0&quot; ]; then </span><br><span class="line">        echo &quot;Invalid &lt;interval&gt; param &#39;$interval&#39; . It should be a integer number. Usage: $0 ethname intervel&quot;</span><br><span class="line">        exit -1  </span><br><span class="line">  fi</span><br><span class="line">  if [ $interval -lt 1 ]; then</span><br><span class="line">        echo &quot;Invalid &lt;interval&gt; param &#39;$interval&#39; . It should be &gt; 0 (seconds). Usage: $0 ethname intervel&quot;</span><br><span class="line">        exit -1</span><br><span class="line">  fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#å‡½æ•°åˆ¤æ–­</span><br><span class="line">if [ $# -ne 2 ]</span><br><span class="line">then</span><br><span class="line"> usage</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;$0 is starting,Device is $1,Intervel is $2&quot;</span><br><span class="line">echo -e &quot;\n&quot;</span><br><span class="line"></span><br><span class="line">typeset Rev old_Rev</span><br><span class="line"></span><br><span class="line">eth&#x3D;$1</span><br><span class="line">intervel&#x3D;$2</span><br><span class="line"></span><br><span class="line">old_Rev&#x3D;&#96;cat &#x2F;proc&#x2F;net&#x2F;dev|grep $eth| awk &#39;&#123;print $1&#125;&#39;| awk -F : &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">old_Send&#x3D;&#96;cat &#x2F;proc&#x2F;net&#x2F;dev|grep $eth|awk &#39;&#123;print $9&#125;&#39;&#96;</span><br><span class="line">#echo &quot;old_Rev is $old_Rev&quot;</span><br><span class="line">#echo &quot;Old_send is $old_Send&quot;</span><br><span class="line"></span><br><span class="line">while true</span><br><span class="line"> do</span><br><span class="line"> sleep $intervel</span><br><span class="line"></span><br><span class="line"> Rev&#x3D;&#96;cat &#x2F;proc&#x2F;net&#x2F;dev|grep $eth|awk &#39;&#123;print $1&#125;&#39;|awk -F : &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line"> Send&#x3D;&#96;cat &#x2F;proc&#x2F;net&#x2F;dev|grep $eth|awk &#39;&#123;print $9&#125;&#39;&#96;</span><br><span class="line">#echo &quot;Rev is $Rev&quot;</span><br><span class="line">#echo &quot;Send is $Send&quot;</span><br><span class="line"></span><br><span class="line"> diff_1&#x3D;&#96;awk -v Rev&#x3D;$Rev -v old_Rev&#x3D;$old_Rev -v intervel&#x3D;$intervel &#39;BEGIN&#123;printf &quot;Receive is %6.2f&quot;, ( Rev - old_Rev ) &#x2F; 1024 &#x2F; 1024 &#x2F; intervel * 8&#125;&#39;&#96;</span><br><span class="line"></span><br><span class="line"> diff_2&#x3D;&#96;awk -v Send&#x3D;$Send -v old_Send&#x3D;$old_Send -v intervel&#x3D;$intervel &#39;BEGIN&#123;printf &quot;Send is %6.2f&quot;, ( Send - old_Send ) &#x2F; 1024 &#x2F; 1024 &#x2F; intervel * 8&#125;&#39;&#96; </span><br><span class="line"></span><br><span class="line"> echo &quot;&#96;date +&#39;%Y-%m-%d %H:%M:%S&#39;&#96; Speed: IN $&#123;diff_1&#125; mbps OUT $&#123;diff_2&#125; mbps&quot;</span><br><span class="line"></span><br><span class="line"> old_Rev&#x3D;$Rev</span><br><span class="line"> old_Send&#x3D;$Send</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h3 id="2-ç‰ˆæœ¬äºŒ"><a href="#2-ç‰ˆæœ¬äºŒ" class="headerlink" title="2. ç‰ˆæœ¬äºŒ"></a>2. ç‰ˆæœ¬äºŒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">#network</span><br><span class="line">#by rocdk890</span><br><span class="line">while : ; do</span><br><span class="line">      time&#x3D;&#96;date +%m&quot;-&quot;%d&quot; &quot;%k&quot;:&quot;%M&#96;</span><br><span class="line">      day&#x3D;&#96;date +%m&quot;-&quot;%d&#96;</span><br><span class="line">      port&#x3D;&#96;ifconfig |grep em|awk &#39;&#123;print $1&#125;&#39;&#96;</span><br><span class="line">      rx_before&#x3D;&#96;ifconfig $port|sed -n &quot;8&quot;p|awk &#39;&#123;print $2&#125;&#39;|cut -c7-&#96;</span><br><span class="line">      tx_before&#x3D;&#96;ifconfig $port|sed -n &quot;8&quot;p|awk &#39;&#123;print $6&#125;&#39;|cut -c7-&#96;</span><br><span class="line">      sleep 2</span><br><span class="line">      rx_after&#x3D;&#96;ifconfig $port|sed -n &quot;8&quot;p|awk &#39;&#123;print $2&#125;&#39;|cut -c7-&#96;</span><br><span class="line">      tx_after&#x3D;&#96;ifconfig $port|sed -n &quot;8&quot;p|awk &#39;&#123;print $6&#125;&#39;|cut -c7-&#96;</span><br><span class="line">      rx_result&#x3D;$[(rx_after-rx_before)&#x2F;256]</span><br><span class="line">      tx_result&#x3D;$[(tx_after-tx_before)&#x2F;256]</span><br><span class="line">      echo &quot;$time Now_In_Speed: &quot;$rx_result&quot;kbps Now_OUt_Speed: &quot;$tx_result&quot;kbps&quot;</span><br><span class="line">      sleep 2</span><br><span class="line">done</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>RabbitMQ-2ä½¿ç”¨</title>
    <url>/2020/04/20/RabbitMQ-2%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="RabbitMQ-2"><a href="#RabbitMQ-2" class="headerlink" title="RabbitMQ-2"></a>RabbitMQ-2</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>RabbitMQï¼šæ¥å—æ¶ˆæ¯å†ä¼ é€’æ¶ˆæ¯ï¼Œå¯ä»¥è§†ä¸ºä¸€ä¸ªâ€é‚®å±€â€ã€‚å‘é€è€…å’Œæ¥å—è€…é€šè¿‡é˜Ÿåˆ—æ¥è¿›è¡Œäº¤äº’ï¼Œé˜Ÿåˆ—çš„å¤§å°å¯ä»¥è§†ä¸ºæ— é™çš„ï¼Œå¤šä¸ªå‘é€è€…å¯ä»¥å‘ç”Ÿç»™ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¤šä¸ªæ¥æ”¶è€…ä¹Ÿå¯ä»¥ä»ä¸€ä¸ªé˜Ÿåˆ—ä¸­æ¥å—æ¶ˆæ¯ã€‚</p>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><p>rabbitmqä½¿ç”¨çš„åè®®æ˜¯amqpï¼Œç”¨äºpythonçš„æ¨èå®¢æˆ·ç«¯æ˜¯pika</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pika -i https:&#x2F;&#x2F;pypi.douban.com&#x2F;simple&#x2F;</span><br></pre></td></tr></table></figure>
<p>ç”Ÿäº§è€…ï¼šsend.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import pika     # å»ºç«‹ä¸€ä¸ªè¿æ¥</span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters( &#39;localhost&#39;))  # è¿æ¥æœ¬åœ°çš„RabbitMQæœåŠ¡å™¨</span><br><span class="line">channel &#x3D; connection.channel()      # è·å¾—channel</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé“¾æ¥çš„æ˜¯æœ¬æœºçš„ï¼Œå¦‚æœæƒ³è¦è¿æ¥å…¶ä»–æœºå™¨ä¸Šçš„æœåŠ¡å™¨ï¼Œåªè¦å¡«å…¥åœ°å€æˆ–ä¸»æœºåå³å¯ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å‘é€æ¶ˆæ¯äº†ï¼Œæ³¨æ„è¦ç¡®ä¿æ¥å—æ¶ˆæ¯çš„é˜Ÿåˆ—æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™rabbitmqå°±ä¸¢å¼ƒæ‰è¯¥æ¶ˆæ¯.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)    # åœ¨RabbitMQä¸­åˆ›å»ºhelloè¿™ä¸ªé˜Ÿåˆ—</span><br><span class="line">channel.basic_publish(exchange&#x3D;&#39;&#39;,      # ä½¿ç”¨é»˜è®¤çš„exchangeæ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—</span><br><span class="line">                  routing_key&#x3D;&#39;hello&#39;,  # å‘é€åˆ°è¯¥é˜Ÿåˆ— hello ä¸­</span><br><span class="line">                  body&#x3D;&#39;Hello World!&#39;)  # æ¶ˆæ¯å†…å®¹</span><br><span class="line"> connection.close() # å…³é—­ åŒæ—¶flush</span><br></pre></td></tr></table></figure>
<p>RabbitMQé»˜è®¤éœ€è¦1GBçš„ç©ºé—²ç£ç›˜ç©ºé—´ï¼Œå¦åˆ™å‘é€ä¼šå¤±è´¥ã€‚<br>è¿™æ—¶å·²åœ¨æœ¬åœ°é˜Ÿåˆ—helloä¸­å­˜æ”¾äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¦‚æœä½¿ç”¨ rabbitmqctl list_queues å¯çœ‹åˆ°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hello 1</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜æœ‰ä¸€ä¸ªhelloé˜Ÿåˆ— é‡Œé¢å­˜æ”¾äº†ä¸€ä¸ªæ¶ˆæ¯<br>æ¶ˆè´¹è€…ï¼šreceive.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import pika</span><br><span class="line">connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters( &#39;localhost&#39;))</span><br><span class="line">channel &#x3D; connection.channel()</span><br></pre></td></tr></table></figure>
<p>è¿˜æ˜¯å…ˆé“¾æ¥åˆ°æœåŠ¡å™¨ï¼Œå’Œä¹‹å‰å‘é€æ—¶ç›¸åŒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.queue_declare(queue&#x3D;&#39;hello&#39;)  # æ­¤å¤„å°±æ˜¯å£°æ˜äº† æ¥ç¡®ä¿è¯¥é˜Ÿåˆ— hello å­˜åœ¨ å¯ä»¥å¤šæ¬¡å£°æ˜ è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢æ¥å—ç¨‹åºå…ˆè¿è¡Œæ—¶å‡ºé”™</span><br><span class="line"></span><br><span class="line">def callback(ch, method, properties, body):  # ç”¨äºæ¥æ”¶åˆ°æ¶ˆæ¯åçš„å›è°ƒ</span><br><span class="line">    print(&quot; [x] Received %r&quot; % body)</span><br><span class="line"></span><br><span class="line">channel.basic_consume(callback,</span><br><span class="line">                      queue&#x3D;&#39;hello&#39;,  # æ”¶æŒ‡å®šé˜Ÿåˆ—helloçš„æ¶ˆæ¯</span><br><span class="line">                      no_ack&#x3D;True)  #åœ¨å¤„ç†å®Œæ¶ˆæ¯åä¸å‘é€ackç»™æœåŠ¡å™¨</span><br><span class="line">channel.start_consuming()  # å¯åŠ¨æ¶ˆæ¯æ¥å— è¿™ä¼šè¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯</span><br></pre></td></tr></table></figure>
<h2 id="å·¥ä½œé˜Ÿåˆ—-ä»»åŠ¡é˜Ÿåˆ—"><a href="#å·¥ä½œé˜Ÿåˆ—-ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="å·¥ä½œé˜Ÿåˆ—(ä»»åŠ¡é˜Ÿåˆ—)"></a>å·¥ä½œé˜Ÿåˆ—(ä»»åŠ¡é˜Ÿåˆ—)</h2><p>å·¥ä½œé˜Ÿåˆ—æ˜¯ç”¨äºåˆ†å‘è€—æ—¶ä»»åŠ¡ç»™å¤šä¸ªå·¥ä½œè¿›ç¨‹çš„ã€‚ä¸ç«‹å³åšé‚£äº›è€—è´¹èµ„æºçš„ä»»åŠ¡ï¼ˆéœ€è¦ç­‰å¾…è¿™äº›ä»»åŠ¡å®Œæˆï¼‰ï¼Œè€Œæ˜¯å®‰æ’è¿™äº›ä»»åŠ¡ä¹‹åæ‰§è¡Œã€‚ä¾‹å¦‚æˆ‘ä»¬æŠŠtaskä½œä¸ºmessageå‘é€åˆ°é˜Ÿåˆ—é‡Œï¼Œå¯åŠ¨å·¥ä½œè¿›ç¨‹æ¥æ¥å—å¹¶æœ€ç»ˆæ‰§è¡Œï¼Œä¸”å¯å¯åŠ¨å¤šä¸ªå·¥ä½œè¿›ç¨‹æ¥å·¥ä½œã€‚è¿™é€‚ç”¨äºwebåº”ç”¨ï¼Œå³ä¸åº”åœ¨ä¸€ä¸ªhttpè¯·æ±‚çš„å¤„ç†çª—å£å†…å®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">routing_key&#x3D;&#39;task_queue&#39;,</span><br><span class="line">                 body&#x3D;message,</span><br><span class="line">                 properties&#x3D;pika.BasicProperties(</span><br><span class="line">                    delivery_mode &#x3D; 2, # ä½¿å¾—æ¶ˆæ¯æŒä¹…åŒ–</span><br><span class="line">                 ))</span><br></pre></td></tr></table></figure>
<p>åˆ†é…æ¶ˆæ¯çš„æ–¹å¼ä¸º è½®è¯¢ å³æ¯ä¸ªå·¥ä½œè¿›ç¨‹è·å¾—ç›¸åŒçš„æ¶ˆæ¯æ•°ã€‚</p>
<h2 id="æ¶ˆæ¯ack"><a href="#æ¶ˆæ¯ack" class="headerlink" title="æ¶ˆæ¯ack"></a>æ¶ˆæ¯ack</h2><p>å¦‚æœæ¶ˆæ¯åˆ†é…ç»™æŸä¸ªå·¥ä½œè¿›ç¨‹ï¼Œä½†æ˜¯è¯¥å·¥ä½œè¿›ç¨‹æœªå¤„ç†å®Œæˆå°±å´©æºƒäº†ï¼Œå¯èƒ½è¯¥æ¶ˆæ¯å°±ä¸¢å¤±äº†ï¼Œå› ä¸ºrabbitmqä¸€æ—¦æŠŠä¸€ä¸ªæ¶ˆæ¯åˆ†å‘ç»™å·¥ä½œè¿›ç¨‹ï¼Œå®ƒå°±æŠŠè¯¥æ¶ˆæ¯åˆ æ‰äº†ã€‚<br>ä¸ºäº†é¢„é˜²æ¶ˆæ¯ä¸¢å¤±ï¼Œrabbitmqæä¾›äº†ackï¼Œå³å·¥ä½œè¿›ç¨‹åœ¨æ”¶åˆ°æ¶ˆæ¯å¹¶å¤„ç†åï¼Œå‘é€ackç»™rabbitmqï¼Œå‘ŠçŸ¥rabbitmqè¿™æ—¶å€™å¯ä»¥æŠŠè¯¥æ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤äº†ã€‚å¦‚æœå·¥ä½œè¿›ç¨‹æŒ‚æ‰äº†ï¼Œrabbitmqæ²¡æœ‰æ”¶åˆ°ackï¼Œé‚£ä¹ˆä¼šæŠŠè¯¥æ¶ˆæ¯ é‡æ–°åˆ†å‘ç»™å…¶ä»–å·¥ä½œè¿›ç¨‹ã€‚ä¸éœ€è¦è®¾ç½®timeoutï¼Œå³ä½¿è¯¥ä»»åŠ¡éœ€è¦å¾ˆé•¿æ—¶é—´ä¹Ÿå¯ä»¥å¤„ç†ã€‚<br>acké»˜è®¤æ˜¯å¼€å¯çš„ï¼Œä¹‹å‰æˆ‘ä»¬çš„å·¥ä½œè¿›ç¨‹æ˜¾ç¤ºæŒ‡å®šäº†<code>no_ack=True</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_consume(callback, queue&#x3D;&#39;hello&#39;)  # ä¼šå¯ç”¨ack</span><br></pre></td></tr></table></figure>
<p>å¸¦ackçš„callback:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def callback(ch, method, properties, body): </span><br><span class="line">    print &quot; [x] Received %r&quot; % (body,)</span><br><span class="line">    time.sleep( body.count(&#39;.&#39;) )</span><br><span class="line">    print &quot; [x] Done&quot;</span><br><span class="line">    ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)  # å‘é€ack</span><br></pre></td></tr></table></figure>
<h2 id="æ¶ˆæ¯æŒä¹…åŒ–"><a href="#æ¶ˆæ¯æŒä¹…åŒ–" class="headerlink" title="æ¶ˆæ¯æŒä¹…åŒ–"></a>æ¶ˆæ¯æŒä¹…åŒ–</h2><p>ä½†æ˜¯ï¼Œæœ‰æ—¶RabbitMQé‡å¯äº†ï¼Œæ¶ˆæ¯ä¹Ÿä¼šä¸¢å¤±ã€‚å¯åœ¨åˆ›å»ºé˜Ÿåˆ—æ—¶è®¾ç½®æŒä¹…åŒ–ï¼š<br>(é˜Ÿåˆ—çš„æ€§è´¨ä¸€æ—¦ç¡®å®šæ— æ³•æ”¹å˜ï¼‰</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.queue_declare(queue&#x3D;&#39;task_queue&#39;, durable&#x3D;True)</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶åœ¨å‘é€æ¶ˆæ¯æ—¶ä¹Ÿå¾—è®¾ç½®è¯¥æ¶ˆæ¯çš„æŒä¹…åŒ–å±æ€§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">routing_key&#x3D;&quot;task_queue&quot;,</span><br><span class="line">body&#x3D;message,</span><br><span class="line">properties&#x3D;pika.BasicProperties(</span><br><span class="line">delivery_mode &#x3D; 2, # make message persistent</span><br><span class="line">))</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œå¦‚æœåœ¨RabbitMQåˆšæ¥æ”¶åˆ°æ¶ˆæ¯è¿˜æ²¡æ¥å¾—åŠå­˜å‚¨ï¼Œæ¶ˆæ¯è¿˜æ˜¯ä¼šä¸¢å¤±ã€‚åŒæ—¶ï¼ŒRabbitMQä¹Ÿä¸æ˜¯åœ¨æ¥å—åˆ°æ¯ä¸ªæ¶ˆæ¯éƒ½è¿›è¡Œå­˜ç›˜æ“ä½œã€‚å¦‚æœè¿˜éœ€è¦æ›´å®Œå–„çš„ä¿è¯ï¼Œéœ€è¦ä½¿ç”¨publisher confirmã€‚</p>
<h2 id="å…¬å¹³çš„æ¶ˆæ¯åˆ†å‘"><a href="#å…¬å¹³çš„æ¶ˆæ¯åˆ†å‘" class="headerlink" title="å…¬å¹³çš„æ¶ˆæ¯åˆ†å‘"></a>å…¬å¹³çš„æ¶ˆæ¯åˆ†å‘</h2><p>è½®è¯¢æ¨¡å¼çš„æ¶ˆæ¯åˆ†å‘å¯èƒ½å¹¶ä¸å…¬å¹³ï¼Œä¾‹å¦‚å¥‡æ•°çš„æ¶ˆæ¯éƒ½æ˜¯ç¹é‡ä»»åŠ¡çš„è¯ï¼ŒæŸäº›è¿›ç¨‹åˆ™ä¼šä¸€ç›´è¿è¡Œç¹ é‡ä»»åŠ¡ã€‚å³ä½¿æŸå·¥ä½œè¿›ç¨‹ä¸Šæœ‰ç§¯å‹çš„æ¶ˆæ¯æœªå¤„ç†ï¼Œå¦‚å¾ˆå¤šéƒ½æ²¡å‘ackï¼Œä½†æ˜¯RabbitMQè¿˜æ˜¯ä¼šæŒ‰ç…§é¡ºåºå‘æ¶ˆæ¯ç»™å®ƒã€‚å¯ä»¥åœ¨æ¥å—è¿›ç¨‹ä¸­åŠ è®¾ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_qos(prefetch_count&#x3D;1)</span><br></pre></td></tr></table></figure>
<p>å‘ŠçŸ¥RabbitMQï¼Œè¿™æ ·åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹æ²¡å›å‘ackæƒ…å†µä¸‹æ˜¯ä¸ä¼šå†åˆ†é…æ¶ˆæ¯ç»™å®ƒã€‚</p>
<h2 id="ç¾¤å‘"><a href="#ç¾¤å‘" class="headerlink" title="ç¾¤å‘"></a>ç¾¤å‘</h2><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€æ¡æ¶ˆæ¯æ˜¯å‘é€ç»™ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œç„¶åå®Œæˆï¼Œæœ‰æ—¶æƒ³æŠŠä¸€æ¡æ¶ˆæ¯åŒæ—¶å‘é€ç»™å¤šä¸ªè¿›ç¨‹ï¼š</p>
<h3 id="exchange"><a href="#exchange" class="headerlink" title="exchange"></a>exchange</h3><p>å‘é€è€…æ˜¯ä¸æ˜¯ç›´æ¥å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­çš„ï¼Œäº‹å®ä¸Šå‘ç”Ÿè€…æ ¹æœ¬ä¸çŸ¥é“æ¶ˆæ¯ä¼šå‘é€åˆ°é‚£ä¸ªé˜Ÿåˆ—ï¼Œå‘é€è€…åªèƒ½æŠŠæ¶ˆæ¯å‘é€åˆ°exchangeé‡Œã€‚exchangeä¸€æ–¹é¢æ”¶ç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢æŠŠä»–ä»¬æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚æ‰€ä»¥ä½œä¸ºexchangeï¼Œå®ƒéœ€è¦çŸ¥é“å½“æ”¶åˆ°æ¶ˆæ¯æ—¶å®ƒéœ€è¦åšä»€ä¹ˆï¼Œæ˜¯åº”è¯¥æŠŠå®ƒåŠ åˆ°ä¸€ä¸ªç‰¹æ®Šçš„é˜Ÿåˆ—ä¸­è¿˜æ˜¯æ”¾åˆ°å¾ˆå¤šçš„é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…ä¸¢å¼ƒã€‚exchangeæœ‰directã€topicã€headersã€fanoutç­‰ç§ç±»ï¼Œè€Œç¾¤å‘ä½¿ç”¨çš„å³fanoutã€‚ä¹‹å‰åœ¨å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œexchangeçš„å€¼ä¸º â€˜â€™ å³ä½¿ç”¨default exchangeã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.exchange_declare(exchange&#x3D;&#39;logs&#39;, type&#x3D;&#39;fanout&#39;)  # è¯¥exchangeä¼šæŠŠæ¶ˆæ¯å‘é€ç»™æ‰€æœ‰å®ƒçŸ¥é“çš„é˜Ÿåˆ—ä¸­</span><br></pre></td></tr></table></figure>
<h3 id="ä¸´æ—¶é˜Ÿåˆ—"><a href="#ä¸´æ—¶é˜Ÿåˆ—" class="headerlink" title="ä¸´æ—¶é˜Ÿåˆ—"></a>ä¸´æ—¶é˜Ÿåˆ—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">result &#x3D; channel.queue_declare()  # åˆ›å»ºä¸€ä¸ªéšæœºé˜Ÿåˆ—</span><br><span class="line">result &#x3D; channel.queue_declare(exclusive&#x3D;True)  # åˆ›å»ºä¸€ä¸ªéšæœºé˜Ÿåˆ—ï¼ŒåŒæ—¶åœ¨æ²¡æœ‰æ¥æ”¶è€…è¿æ¥è¯¥é˜Ÿåˆ—ååˆ™é”€æ¯å®ƒ</span><br><span class="line">queue_name &#x3D; result.method.queue</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·result.method.queueå³æ˜¯é˜Ÿåˆ—åç§°ï¼Œåœ¨å‘é€æˆ–æ¥å—æ—¶å³å¯ä½¿ç”¨ã€‚</p>
<h3 id="ç»‘å®šexchangeå’Œé˜Ÿåˆ—"><a href="#ç»‘å®šexchangeå’Œé˜Ÿåˆ—" class="headerlink" title="ç»‘å®šexchangeå’Œé˜Ÿåˆ—"></a>ç»‘å®šexchangeå’Œé˜Ÿåˆ—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.queue_bind(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">               queue&#x3D;&#39;hello&#39;)</span><br></pre></td></tr></table></figure>
<p>logsåœ¨å‘é€æ¶ˆæ¯æ—¶ç»™helloä¹Ÿå‘ä¸€ä»½ã€‚<br>åœ¨å‘é€æ¶ˆæ¯æ—¶ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„logs exchange</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_publish(exchange&#x3D;&#39;logs&#39;,</span><br><span class="line">                  routing_key&#x3D;&#39;&#39;,</span><br><span class="line">                  body&#x3D;message)</span><br></pre></td></tr></table></figure>
<h2 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h2><p>ä¹‹å‰å·²ç»ä½¿ç”¨è¿‡bindï¼Œå³å»ºç«‹exchangeå’Œqueueçš„å…³ç³»(è¯¥é˜Ÿåˆ—å¯¹æ¥è‡ªè¯¥exchangeçš„æ¶ˆæ¯æœ‰å…´è¶£)bindæ—¶å¯å¦å¤–æŒ‡å®šrouting_keyé€‰é¡¹ã€‚</p>
<h2 id="ä½¿ç”¨direct-exchange"><a href="#ä½¿ç”¨direct-exchange" class="headerlink" title="ä½¿ç”¨direct exchange"></a>ä½¿ç”¨direct exchange</h2><p>å°†å¯¹åº”routing keyçš„æ¶ˆæ¯å‘é€åˆ°ç»‘å®šç›¸åŒrouting keyçš„é˜Ÿåˆ—ä¸­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.exchange_declare(exchange&#x3D;&#39;direct_logs&#39;,</span><br><span class="line">                     type&#x3D;&#39;direct&#39;)</span><br></pre></td></tr></table></figure>
<p>å‘é€å‡½æ•°ï¼Œå‘å¸ƒä¸åŒseverityçš„æ¶ˆæ¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_publish(exchange&#x3D;&#39;direct_logs&#39;,</span><br><span class="line">                  routing_key&#x3D;severity,</span><br><span class="line">                  body&#x3D;message)</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨topic-exchange"><a href="#ä½¿ç”¨topic-exchange" class="headerlink" title="ä½¿ç”¨topic exchange"></a>ä½¿ç”¨topic exchange</h2><p>ä¹‹å‰ä½¿ç”¨çš„direct exchange åªèƒ½ç»‘å®šä¸€ä¸ªrouting keyï¼Œå¯ä»¥ä½¿ç”¨è¿™ç§å¯ä»¥æ‹¿.éš”å¼€routing keyçš„topic exchangeï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;stock.usd.nyse&quot; &quot;nyse.vmw&quot;</span><br></pre></td></tr></table></figure>
<p>å’Œdirect exchangeä¸€æ ·ï¼Œåœ¨æ¥å—è€…é‚£è¾¹ç»‘å®šçš„keyä¸å‘é€æ—¶æŒ‡å®šçš„routing keyç›¸åŒå³å¯ï¼Œå¦å¤–æœ‰äº›ç‰¹æ®Šçš„å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* ä»£è¡¨1ä¸ªå•è¯</span><br><span class="line">* # ä»£è¡¨0ä¸ªæˆ–å¤šä¸ªå•è¯</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‘é€è€…å‘å‡ºçš„routing keyéƒ½æ˜¯3ä¸ªéƒ¨åˆ†çš„ï¼Œå¦‚ï¼šcelerity.colour.speciesã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Q1: *.orange.* å¯¹åº”çš„æ˜¯ä¸­é—´çš„colouréƒ½ä¸ºorangeçš„</span><br><span class="line">Q2: *.*.rabbit  å¯¹åº”çš„æ˜¯æœ€åéƒ¨åˆ†çš„speciesä¸ºrabbitçš„</span><br><span class="line">lazy.# å¯¹åº”çš„æ˜¯ç¬¬ä¸€éƒ¨åˆ†æ˜¯lazyçš„</span><br></pre></td></tr></table></figure>
<p>qucik.orange.rabbit Q1 Q2éƒ½å¯æ¥æ”¶åˆ°ï¼Œquick.orange.fox åªæœ‰Q1èƒ½æ¥å—åˆ°ï¼Œå¯¹äºlazy.pink.rabbitè™½ç„¶åŒ¹é…åˆ°äº†Q2ä¸¤æ¬¡ï¼Œä½†æ˜¯åªä¼šå‘é€ä¸€æ¬¡ã€‚å¦‚æœç»‘å®šæ—¶ç›´æ¥ç»‘å®š#ï¼Œåˆ™ä¼šæ”¶åˆ°æ‰€æœ‰çš„ã€‚</p>
<h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><p>åœ¨è¿œç¨‹æœºå™¨ä¸Šè¿è¡Œä¸€ä¸ªå‡½æ•°ç„¶åè·å¾—ç»“æœã€‚</p>
<h3 id="ï¼‘-å®¢æˆ·ç«¯å¯åŠ¨-åŒæ—¶è®¾ç½®ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ç”¨äºæ¥å—å›è°ƒï¼Œç»‘å®šè¯¥é˜Ÿåˆ—"><a href="#ï¼‘-å®¢æˆ·ç«¯å¯åŠ¨-åŒæ—¶è®¾ç½®ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ç”¨äºæ¥å—å›è°ƒï¼Œç»‘å®šè¯¥é˜Ÿåˆ—" class="headerlink" title="ï¼‘.å®¢æˆ·ç«¯å¯åŠ¨ã€€åŒæ—¶è®¾ç½®ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ç”¨äºæ¥å—å›è°ƒï¼Œç»‘å®šè¯¥é˜Ÿåˆ—"></a>ï¼‘.å®¢æˆ·ç«¯å¯åŠ¨ã€€åŒæ—¶è®¾ç½®ä¸€ä¸ªä¸´æ—¶é˜Ÿåˆ—ç”¨äºæ¥å—å›è°ƒï¼Œç»‘å®šè¯¥é˜Ÿåˆ—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">self.connection &#x3D; pika.BlockingConnection(pika.ConnectionParameters(</span><br><span class="line">            host&#x3D;&#39;localhost&#39;))</span><br><span class="line">    self.channel &#x3D; self.connection.channel()</span><br><span class="line">    result &#x3D; self.channel.queue_declare(exclusive&#x3D;True)</span><br><span class="line">    self.callback_queue &#x3D; result.method.queue</span><br><span class="line">    self.channel.basic_consume(self.on_response, no_ack&#x3D;True,</span><br><span class="line">                               queue&#x3D;self.callback_queue)</span><br></pre></td></tr></table></figure>
<h3 id="ï¼’-å®¢æˆ·ç«¯å‘é€rpcè¯·æ±‚ï¼ŒåŒæ—¶é™„å¸¦reply-toå¯¹åº”å›è°ƒé˜Ÿåˆ—ï¼Œcorrelation-idè®¾ç½®ä¸ºæ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€idï¼ˆè™½ç„¶è¯´å¯ä»¥ä¸ºæ¯ä¸€æ¬¡RPCè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯åªä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™éœ€è¦ä½¿ç”¨correlation-idæ¥åŒ¹é…æ˜¯å“ªä¸ªè¯·æ±‚ï¼‰ï¼Œä¹‹åé˜»å¡åœ¨å›è°ƒé˜Ÿåˆ—ç›´åˆ°æ”¶åˆ°å›å¤"><a href="#ï¼’-å®¢æˆ·ç«¯å‘é€rpcè¯·æ±‚ï¼ŒåŒæ—¶é™„å¸¦reply-toå¯¹åº”å›è°ƒé˜Ÿåˆ—ï¼Œcorrelation-idè®¾ç½®ä¸ºæ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€idï¼ˆè™½ç„¶è¯´å¯ä»¥ä¸ºæ¯ä¸€æ¬¡RPCè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯åªä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™éœ€è¦ä½¿ç”¨correlation-idæ¥åŒ¹é…æ˜¯å“ªä¸ªè¯·æ±‚ï¼‰ï¼Œä¹‹åé˜»å¡åœ¨å›è°ƒé˜Ÿåˆ—ç›´åˆ°æ”¶åˆ°å›å¤" class="headerlink" title="ï¼’.å®¢æˆ·ç«¯å‘é€rpcè¯·æ±‚ï¼ŒåŒæ—¶é™„å¸¦reply_toå¯¹åº”å›è°ƒé˜Ÿåˆ—ï¼Œcorrelation_idè®¾ç½®ä¸ºæ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€idï¼ˆè™½ç„¶è¯´å¯ä»¥ä¸ºæ¯ä¸€æ¬¡RPCè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯åªä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™éœ€è¦ä½¿ç”¨correlation_idæ¥åŒ¹é…æ˜¯å“ªä¸ªè¯·æ±‚ï¼‰ï¼Œä¹‹åé˜»å¡åœ¨å›è°ƒé˜Ÿåˆ—ç›´åˆ°æ”¶åˆ°å›å¤"></a>ï¼’.å®¢æˆ·ç«¯å‘é€rpcè¯·æ±‚ï¼ŒåŒæ—¶é™„å¸¦reply_toå¯¹åº”å›è°ƒé˜Ÿåˆ—ï¼Œcorrelation_idè®¾ç½®ä¸ºæ¯ä¸ªè¯·æ±‚çš„å”¯ä¸€idï¼ˆè™½ç„¶è¯´å¯ä»¥ä¸ºæ¯ä¸€æ¬¡RPCè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªå›è°ƒé˜Ÿåˆ—ï¼Œä½†æ˜¯è¿™æ ·æ•ˆç‡ä¸é«˜ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯åªä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆ™éœ€è¦ä½¿ç”¨correlation_idæ¥åŒ¹é…æ˜¯å“ªä¸ªè¯·æ±‚ï¼‰ï¼Œä¹‹åé˜»å¡åœ¨å›è°ƒé˜Ÿåˆ—ç›´åˆ°æ”¶åˆ°å›å¤</h3><p>æ³¨æ„: å¦‚æœæ”¶åˆ°äº†éæ³•çš„correlation_idç›´æ¥ä¸¢å¼ƒå³å¯ï¼Œå› ä¸ºæœ‰è¿™ç§æƒ…å†µâ€“æœåŠ¡å™¨å·²ç»å‘äº†å“åº”ä½†æ˜¯è¿˜æ²¡å‘ackå°±æŒ‚äº†ï¼Œç­‰ä¸€ä¼šæœåŠ¡å™¨é‡å¯äº†åˆä¼šé‡æ–°å¤„ç†è¯¥ä»»åŠ¡ï¼Œåˆå‘äº†ä¸€éç›¸åº”ï¼Œä½†æ˜¯è¿™æ—¶é‚£ä¸ªè¯·æ±‚å·²ç»è¢«å¤„ç†æ‰äº†.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                       routing_key&#x3D;&#39;rpc_queue&#39;,</span><br><span class="line">                       properties&#x3D;pika.BasicProperties(</span><br><span class="line">                             reply_to &#x3D; self.callback_queue,</span><br><span class="line">                             correlation_id &#x3D; self.corr_id,</span><br><span class="line">                             ),</span><br><span class="line">                       body&#x3D;str(n))  # å‘å‡ºè°ƒç”¨</span><br><span class="line"></span><br><span class="line">while self.response is None:  # è¿™è¾¹å°±ç›¸å½“äºé˜»å¡äº†</span><br><span class="line">    self.connection.process_data_events()  # æŸ¥çœ‹å›è°ƒé˜Ÿåˆ—</span><br><span class="line">return int(self.response)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>è¯·æ±‚ä¼šå‘é€åˆ°rpc_queueé˜Ÿåˆ—  </li>
<li>RPCæœåŠ¡å™¨ä»rpc_queueä¸­å–å‡ºï¼Œæ‰§è¡Œï¼Œå‘é€å›å¤<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">channel.basic_consume(on_request, queue&#x3D;&#39;rpc_queue&#39;)  # ç»‘å®š ç­‰å¾…è¯·æ±‚</span><br><span class="line"></span><br><span class="line"># å¤„ç†ä¹‹åï¼š</span><br><span class="line">ch.basic_publish(exchange&#x3D;&#39;&#39;,</span><br><span class="line">                 routing_key&#x3D;props.reply_to,</span><br><span class="line">                 properties&#x3D;pika.BasicProperties(correlation_id &#x3D; \</span><br><span class="line">                                                     props.correlation_id),</span><br><span class="line">                 body&#x3D;str(response))  # å‘é€å›å¤åˆ°å›è°ƒé˜Ÿåˆ—</span><br><span class="line">ch.basic_ack(delivery_tag &#x3D; method.delivery_tag)  # å‘é€ack</span><br></pre></td></tr></table></figure></li>
<li>å®¢æˆ·ç«¯ä»å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®ï¼Œæ£€æŸ¥correlation_idï¼Œæ‰§è¡Œç›¸åº”æ“ä½œ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if self.corr_id &#x3D;&#x3D; props.correlation_id:</span><br><span class="line">        self.response &#x3D; body</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><a href="https://www.cnblogs.com/yuanchenqi/articles/8510585.html" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>RabbitMQ</category>
      </categories>
      <tags>
        <tag>RabbitMQ</tag>
      </tags>
  </entry>
  <entry>
    <title>SqlAlchemyç©è½¬MySQL</title>
    <url>/2020/04/20/SqlAlchemy%E7%8E%A9%E8%BD%ACMySQL/</url>
    <content><![CDATA[<h2 id="SqlAlchemyç©è½¬MySQL"><a href="#SqlAlchemyç©è½¬MySQL" class="headerlink" title="SqlAlchemyç©è½¬MySQL"></a>SqlAlchemyç©è½¬MySQL</h2><h3 id="ä¸€-ORMæ¡†æ¶"><a href="#ä¸€-ORMæ¡†æ¶" class="headerlink" title="ä¸€. ORMæ¡†æ¶"></a>ä¸€. ORMæ¡†æ¶</h3><ol>
<li>Web å¼€å‘ä¸­ï¼Œä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ä¾¿æ˜¯æ•°æ®åº“äº†ã€‚Web ç¨‹åºä¸­æœ€å¸¸ç”¨çš„è«è¿‡äºå…³ç³»å‹æ•°æ®åº“äº†ï¼Œä¹Ÿç§° SQL æ•°æ®åº“ã€‚å¦å¤–ï¼Œæ–‡æ¡£æ•°æ®åº“ï¼ˆå¦‚ mongodbï¼‰ã€é”®å€¼å¯¹æ•°æ®åº“ï¼ˆå¦‚ redisï¼‰è¿‘å‡ å¹´ä¹Ÿé€æ¸åœ¨ web å¼€å‘ä¸­æµè¡Œèµ·æ¥ï¼Œæˆ‘ä»¬ä¹ æƒ¯æŠŠè¿™ä¸¤ç§æ•°æ®åº“ç§°ä¸º NoSQL æ•°æ®åº“ã€‚</li>
<li>å¤§å¤šæ•°çš„å…³ç³»å‹æ•°æ®åº“å¼•æ“ï¼ˆæ¯”å¦‚ MySQLã€Postgres å’Œ SQLiteï¼‰éƒ½æœ‰å¯¹åº”çš„ Python åŒ…ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨è¿™äº›æ•°æ®åº“å¼•æ“æä¾›çš„ Python åŒ…ï¼Œè€Œæ˜¯ä½¿ç”¨å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆObject-Relational Mapper, ORMï¼‰æ¡†æ¶ï¼Œå®ƒå°†ä½å±‚çš„æ•°æ®åº“æ“ä½œæŒ‡ä»¤æŠ½è±¡æˆé«˜å±‚çš„é¢å‘å¯¹è±¡æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨æ•°æ®åº“å¼•æ“ï¼Œæˆ‘ä»¬å°±è¦å†™ SQL æ“ä½œè¯­å¥ï¼Œä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº† ORM æ¡†æ¶ï¼Œæˆ‘ä»¬å¯¹è¯¸å¦‚è¡¨ã€æ–‡æ¡£æ­¤ç±»çš„æ•°æ®åº“å®ä½“å°±å¯ä»¥ç®€åŒ–æˆå¯¹ Python å¯¹è±¡çš„æ“ä½œã€‚</li>
<li>Python ä¸­æœ€å¹¿æ³›ä½¿ç”¨çš„ ORM æ¡†æ¶æ˜¯ SQLAlchemyï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å…³ç³»å‹æ•°æ®åº“æ¡†æ¶ï¼Œä¸ä»…æ”¯æŒé«˜å±‚çš„ ORMï¼Œä¹Ÿæ”¯æŒä½¿ç”¨ä½å±‚çš„ SQL æ“ä½œï¼Œå¦å¤–ï¼Œå®ƒä¹Ÿæ”¯æŒå¤šç§æ•°æ®åº“å¼•æ“ï¼Œå¦‚ MySQLã€Postgres å’Œ SQLite ç­‰ã€‚</li>
</ol>
<h3 id="äºŒ-ä»‹ç»"><a href="#äºŒ-ä»‹ç»" class="headerlink" title="äºŒ. ä»‹ç»"></a>äºŒ. ä»‹ç»</h3><p>SQLAlchemyæ˜¯ä¸€ä¸ªåŸºäºPythonå®ç°çš„ORMæ¡†æ¶ã€‚è¯¥æ¡†æ¶å»ºç«‹åœ¨ DB APIä¹‹ä¸Šï¼Œä½¿ç”¨å…³ç³»å¯¹è±¡æ˜ å°„è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œç®€è¨€ä¹‹ï¼šå°†ç±»å’Œå¯¹è±¡è½¬æ¢æˆSQLï¼Œç„¶åä½¿ç”¨æ•°æ®åº“æ¨¡å—è°ƒç”¨DB-APIæ‰§è¡ŒSQLå¹¶è·å–æ‰§è¡Œç»“æœã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install sqlalchemy</span><br></pre></td></tr></table></figure>
<p>ç”±äºsqlalchemyæ¨¡å—ä¾èµ–äºç¬¬ä¸‰æ–¹DB-APIæ¨¡å—,å› æ­¤,æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…æ•°æ®åº“æ¨¡å—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰-æ¡†æ¶åŸºæœ¬ç»“æ„"><a href="#ä¸‰-æ¡†æ¶åŸºæœ¬ç»“æ„" class="headerlink" title="ä¸‰. æ¡†æ¶åŸºæœ¬ç»“æ„"></a>ä¸‰. æ¡†æ¶åŸºæœ¬ç»“æ„</h3><p>ç»„æˆéƒ¨åˆ†ï¼š<br>Engineï¼Œæ¡†æ¶çš„å¼•æ“<br>Connection Pooling ï¼Œæ•°æ®åº“è¿æ¥æ± <br>Dialectï¼Œé€‰æ‹©è¿æ¥æ•°æ®åº“çš„DB APIç§ç±»<br>Schema/Typesï¼Œæ¶æ„å’Œç±»å‹<br>SQL Exprression Languageï¼ŒSQLè¡¨è¾¾å¼è¯­è¨€  </p>
<h3 id="å››-è¿æ¥ä¸²"><a href="#å››-è¿æ¥ä¸²" class="headerlink" title="å››. è¿æ¥ä¸²"></a>å››. è¿æ¥ä¸²</h3><p>SQLAlchemyæœ¬èº«æ— æ³•æ“ä½œæ•°æ®åº“ï¼Œå…¶å¿…é¡»ä»¥æ¥pymsqlç­‰ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ŒDialectç”¨äºå’Œæ•°æ®APIè¿›è¡Œäº¤æµï¼Œæ ¹æ®é…ç½®æ–‡ä»¶çš„ä¸åŒè°ƒç”¨ä¸åŒçš„æ•°æ®åº“APIï¼Œä»è€Œå®ç°å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œå¦‚ï¼š<br>|æ•°æ®åº“å¼•æ“|URL|<br>|â€”-|â€”-|<br>|MySQL-Pytho|mysql+mysqldb://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;|<br>|pymysql| mysql+pymysql://&lt;username&gt;:&lt;password&gt;@&lt;host&gt;/&lt;dbname&gt;[?&lt;options&gt;]|<br>|MySQL-Connector|mysql+mysqlconnector://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;[:&lt;port&gt;]/&lt;dbname&gt;|<br>|Postgres|postgresql://username:password@hostname/database|<br>|SQLite (Unix)|sqlite:////absolute/path/to/database|<br>|SQLite (Windows)|sqlite:///c:/absolute/path/to/database|<br>|cx_Oracle|oracle+cx_oracle://user:pass@host:port/dbname[?key=value&amp;key=valueâ€¦]|<br>ä¸Šé¢çš„è¡¨æ ¼ä¸­ï¼Œusername å’Œ password è¡¨ç¤ºç™»å½•æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œhostname è¡¨ç¤º SQL æœåŠ¡æ‰€åœ¨çš„ä¸»æœºï¼Œå¯ä»¥æ˜¯æœ¬åœ°ä¸»æœºï¼ˆlocalhostï¼‰ä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œdatabase è¡¨ç¤ºè¦ä½¿ç”¨çš„æ•°æ®åº“ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSQLite æ•°æ®åº“ä¸éœ€è¦ä½¿ç”¨æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶åä½œä¸º databaseã€‚<br><a href="http://docs.sqlalchemy.org/en/latest/dialects/index.html" target="_blank" rel="noopener">æ›´å¤š</a></p>
<h3 id="äº”-ä½¿ç”¨"><a href="#äº”-ä½¿ç”¨" class="headerlink" title="äº”. ä½¿ç”¨"></a>äº”. ä½¿ç”¨</h3><h4 id="5-1-æ‰§è¡ŒåŸç”ŸSQL"><a href="#5-1-æ‰§è¡ŒåŸç”ŸSQL" class="headerlink" title="5.1 æ‰§è¡ŒåŸç”ŸSQL"></a>5.1 æ‰§è¡ŒåŸç”ŸSQL</h4><ul>
<li>æ–¹å¼ä¸€<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import time</span><br><span class="line">import threading</span><br><span class="line">import sqlalchemy</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.engine.base import Engine</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(</span><br><span class="line">    &quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;,</span><br><span class="line">    max_overflow&#x3D;0,  # è¶…è¿‡è¿æ¥æ± å¤§å°å¤–æœ€å¤šåˆ›å»ºçš„è¿æ¥</span><br><span class="line">    pool_size&#x3D;5,  # è¿æ¥æ± å¤§å°</span><br><span class="line">    pool_timeout&#x3D;30,  # æ± ä¸­æ²¡æœ‰çº¿ç¨‹æœ€å¤šç­‰å¾…çš„æ—¶é—´ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">    pool_recycle&#x3D;-1  # å¤šä¹…ä¹‹åå¯¹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œä¸€æ¬¡è¿æ¥çš„å›æ”¶(é‡ç½®)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">def task(arg):</span><br><span class="line">    conn &#x3D; engine.raw_connection()</span><br><span class="line">    cursor &#x3D; conn.cursor()</span><br><span class="line">    cursor.execute(</span><br><span class="line">        &quot;select * from USER &quot;</span><br><span class="line">    )</span><br><span class="line">    result &#x3D; cursor.fetchall()</span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(20):</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;task, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
<li>æ–¹å¼äºŒ<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import threading</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(&quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff&quot;, max_overflow&#x3D;0, pool_size&#x3D;5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def task(arg):</span><br><span class="line">    conn &#x3D; engine.contextual_connect()</span><br><span class="line">    with conn:</span><br><span class="line">        cur &#x3D; conn.execute(</span><br><span class="line">            &quot;select * from USER &quot;</span><br><span class="line">        )</span><br><span class="line">        result &#x3D; cur.fetchall()</span><br><span class="line">        print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(20):</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;task, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
<li>æ–¹å¼ä¸‰<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import threading</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(&quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff&quot;, max_overflow&#x3D;0, pool_size&#x3D;5)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def task(arg):</span><br><span class="line">    cur &#x3D; engine.execute(&quot;select * from USER &quot;)</span><br><span class="line">    # cur &#x3D; engine.execute(&quot;select sleep(10)&quot;)</span><br><span class="line">    result &#x3D; cur.fetchall()</span><br><span class="line">    cur.close()</span><br><span class="line">    print(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(20):</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;task, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>
âš ï¸ æŸ¥çœ‹è¿æ¥ show status like â€˜Threads%â€™;</li>
</ul>
<h3 id="å…­-ORMä½¿ç”¨"><a href="#å…­-ORMä½¿ç”¨" class="headerlink" title="å…­. ORMä½¿ç”¨"></a>å…­. ORMä½¿ç”¨</h3><h4 id="6-1-åˆ›å»ºæ•°æ®åº“è¡¨"><a href="#6-1-åˆ›å»ºæ•°æ®åº“è¡¨" class="headerlink" title="6.1 åˆ›å»ºæ•°æ®åº“è¡¨"></a>6.1 åˆ›å»ºæ•°æ®åº“è¡¨</h4><ul>
<li><p>å•è¡¨ç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import datetime</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import Column, Integer, String, Text, ForeignKey, DateTime, UniqueConstraint, Index</span><br><span class="line"></span><br><span class="line"># åŸºç±»</span><br><span class="line">Base &#x3D; declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Users(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;users&#39;</span><br><span class="line"></span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True, nullable&#x3D;False)</span><br><span class="line">    email &#x3D; Column(String(32), unique&#x3D;True)</span><br><span class="line">    ctime &#x3D; Column(DateTime, default&#x3D;datetime.datetime.now)</span><br><span class="line">    # extra &#x3D; Column(Text, nullable&#x3D;True)</span><br><span class="line"></span><br><span class="line">    __table_args__ &#x3D; (</span><br><span class="line">        # UniqueConstraint(&#39;id&#39;, &#39;name&#39;, name&#x3D;&#39;uix_id_name&#39;),   # è”åˆå”¯ä¸€ç´¢å¼•</span><br><span class="line">        # Index(&#39;ix_id_name&#39;, &#39;name&#39;, &#39;email&#39;),                 # è”åˆç´¢å¼•</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def init_db():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ ¹æ®ç±»åˆ›å»ºæ•°æ®åº“è¡¨</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    engine &#x3D; create_engine(</span><br><span class="line">        &quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;,</span><br><span class="line">        max_overflow&#x3D;0,   # è¶…è¿‡è¿æ¥æ± å¤§å°å¤–æœ€å¤šåˆ›å»ºçš„è¿æ¥</span><br><span class="line">        pool_size&#x3D;5,      # è¿æ¥æ± å¤§å°</span><br><span class="line">        pool_timeout&#x3D;30,  # æ± ä¸­æ²¡æœ‰çº¿ç¨‹æœ€å¤šç­‰å¾…çš„æ—¶é—´ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">        pool_recycle&#x3D;-1   # å¤šä¹…ä¹‹åå¯¹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œä¸€æ¬¡è¿æ¥çš„å›æ”¶ï¼ˆé‡ç½®ï¼‰</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def drop_db():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ ¹æ®ç±»åˆ é™¤æ•°æ®åº“è¡¨</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    engine &#x3D; create_engine(</span><br><span class="line">        &quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;,</span><br><span class="line">        max_overflow&#x3D;0,   # è¶…è¿‡è¿æ¥æ± å¤§å°å¤–æœ€å¤šåˆ›å»ºçš„è¿æ¥</span><br><span class="line">        pool_size&#x3D;5,      # è¿æ¥æ± å¤§å°</span><br><span class="line">        pool_timeout&#x3D;30,  # æ± ä¸­æ²¡æœ‰çº¿ç¨‹æœ€å¤šç­‰å¾…çš„æ—¶é—´ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">        pool_recycle&#x3D;-1   # å¤šä¹…ä¹‹åå¯¹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œä¸€æ¬¡è¿æ¥çš„å›æ”¶ï¼ˆé‡ç½®ï¼‰</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Base.metadata.drop_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    drop_db()</span><br><span class="line">    init_db()</span><br></pre></td></tr></table></figure></li>
<li><p>FK/M2Mç¤ºä¾‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import datetime</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.ext.declarative import declarative_base</span><br><span class="line">from sqlalchemy import Column, Integer, String, Text, ForeignKey, DateTime, UniqueConstraint, Index</span><br><span class="line">from sqlalchemy.orm import relationship</span><br><span class="line"></span><br><span class="line">Base &#x3D; declarative_base()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ##################### å•è¡¨ç¤ºä¾‹ #########################</span><br><span class="line">class Users(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;users&#39;</span><br><span class="line"></span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True)</span><br><span class="line">    age &#x3D; Column(Integer, default&#x3D;18)</span><br><span class="line">    email &#x3D; Column(String(32), unique&#x3D;True)</span><br><span class="line">    ctime &#x3D; Column(DateTime, default&#x3D;datetime.datetime.now)</span><br><span class="line">    extra &#x3D; Column(Text, nullable&#x3D;True)</span><br><span class="line"></span><br><span class="line">    __table_args__ &#x3D; (</span><br><span class="line">        # UniqueConstraint(&#39;id&#39;, &#39;name&#39;, name&#x3D;&#39;uix_id_name&#39;),</span><br><span class="line">        # Index(&#39;ix_id_name&#39;, &#39;name&#39;, &#39;extra&#39;),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Hosts(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;hosts&#39;</span><br><span class="line"></span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True)</span><br><span class="line">    ctime &#x3D; Column(DateTime, default&#x3D;datetime.datetime.now)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ##################### ä¸€å¯¹å¤šç¤ºä¾‹ #########################</span><br><span class="line">class Hobby(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;hobby&#39;</span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    caption &#x3D; Column(String(50), default&#x3D;&#39;ç¯®çƒ&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Person(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;person&#39;</span><br><span class="line">    nid &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True, nullable&#x3D;True)</span><br><span class="line">    hobby_id &#x3D; Column(Integer, ForeignKey(&quot;hobby.id&quot;))</span><br><span class="line"></span><br><span class="line">    # ä¸ç”Ÿæˆè¡¨ç»“æ„æ— å…³ï¼Œä»…ç”¨äºæŸ¥è¯¢æ–¹ä¾¿</span><br><span class="line">    hobby &#x3D; relationship(&quot;Hobby&quot;, backref&#x3D;&#39;pers&#39;)  # backref åå‘æŸ¥è¯¢</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ##################### å¤šå¯¹å¤šç¤ºä¾‹ #########################</span><br><span class="line"></span><br><span class="line">class Server2Group(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;server2group&#39;</span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True, autoincrement&#x3D;True)  # è‡ªå¢ä¸»é”®</span><br><span class="line">    server_id &#x3D; Column(Integer, ForeignKey(&#39;server.id&#39;))</span><br><span class="line">    group_id &#x3D; Column(Integer, ForeignKey(&#39;group.id&#39;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Group(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;group&#39;</span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(64), unique&#x3D;True, nullable&#x3D;False)</span><br><span class="line"></span><br><span class="line">    # ä¸ç”Ÿæˆè¡¨ç»“æ„æ— å…³ï¼Œä»…ç”¨äºæŸ¥è¯¢æ–¹ä¾¿</span><br><span class="line">    servers &#x3D; relationship(&#39;Server&#39;, secondary&#x3D;&#39;server2group&#39;, backref&#x3D;&#39;groups&#39;)  # secondary: æŒ‡å®šå…³ç³»è¡¨</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Server(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;server&#39;</span><br><span class="line"></span><br><span class="line">    id &#x3D; Column(Integer, primary_key&#x3D;True, autoincrement&#x3D;True)</span><br><span class="line">    hostname &#x3D; Column(String(64), unique&#x3D;True, nullable&#x3D;False)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def init_db():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ ¹æ®ç±»åˆ›å»ºæ•°æ®åº“è¡¨</span><br><span class="line">    :return: </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    engine &#x3D; create_engine(</span><br><span class="line">        &quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;,</span><br><span class="line">        max_overflow&#x3D;0,  # è¶…è¿‡è¿æ¥æ± å¤§å°å¤–æœ€å¤šåˆ›å»ºçš„è¿æ¥</span><br><span class="line">        pool_size&#x3D;5,  # è¿æ¥æ± å¤§å°</span><br><span class="line">        pool_timeout&#x3D;30,  # æ± ä¸­æ²¡æœ‰çº¿ç¨‹æœ€å¤šç­‰å¾…çš„æ—¶é—´ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">        pool_recycle&#x3D;-1  # å¤šä¹…ä¹‹åå¯¹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œä¸€æ¬¡è¿æ¥çš„å›æ”¶ï¼ˆé‡ç½®ï¼‰</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Base.metadata.create_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def drop_db():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ ¹æ®ç±»åˆ é™¤æ•°æ®åº“è¡¨</span><br><span class="line">    :return: </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    engine &#x3D; create_engine(</span><br><span class="line">        &quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;,</span><br><span class="line">        max_overflow&#x3D;0,  # è¶…è¿‡è¿æ¥æ± å¤§å°å¤–æœ€å¤šåˆ›å»ºçš„è¿æ¥</span><br><span class="line">        pool_size&#x3D;5,  # è¿æ¥æ± å¤§å°</span><br><span class="line">        pool_timeout&#x3D;30,  # æ± ä¸­æ²¡æœ‰çº¿ç¨‹æœ€å¤šç­‰å¾…çš„æ—¶é—´ï¼Œå¦åˆ™æŠ¥é”™</span><br><span class="line">        pool_recycle&#x3D;-1  # å¤šä¹…ä¹‹åå¯¹çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è¿›è¡Œä¸€æ¬¡è¿æ¥çš„å›æ”¶ï¼ˆé‡ç½®ï¼‰</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    Base.metadata.drop_all(engine)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    drop_db()</span><br><span class="line">    init_db()</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šå…³è”åˆ—: hobby = relationship(â€œHobbyâ€, backref=â€™persâ€™,foreign_keys=â€Person.hobby_idâ€)</p>
<h4 id="6-1-ORMåŸºæœ¬ä½¿ç”¨"><a href="#6-1-ORMåŸºæœ¬ä½¿ç”¨" class="headerlink" title="6.1 ORMåŸºæœ¬ä½¿ç”¨"></a>6.1 ORMåŸºæœ¬ä½¿ç”¨</h4></li>
<li><p>åˆæ­¥ä½¿ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;14</span><br><span class="line"></span><br><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from models import *</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(&quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;, max_overflow&#x3D;0, pool_size&#x3D;5)</span><br><span class="line">Session &#x3D; sessionmaker(bind&#x3D;engine)</span><br><span class="line"></span><br><span class="line"># æ¯æ¬¡æ‰§è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªsession</span><br><span class="line">session &#x3D; Session()</span><br><span class="line"></span><br><span class="line"># ############# æ‰§è¡ŒORMæ“ä½œ #############</span><br><span class="line">obj1 &#x3D; Users(name&#x3D;&quot;tome&quot;, age&#x3D;19, email&#x3D;&quot;tome163@163.com&quot;)</span><br><span class="line">session.add(obj1)</span><br><span class="line"></span><br><span class="line"># æäº¤äº‹åŠ¡</span><br><span class="line">session.commit()</span><br><span class="line"># å…³é—­session</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></li>
<li><p>åŸç”ŸSQL</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.sql import text</span><br><span class="line">from models import *</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(&quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;, max_overflow&#x3D;0, pool_size&#x3D;5)</span><br><span class="line">Session &#x3D; sessionmaker(bind&#x3D;engine)</span><br><span class="line"></span><br><span class="line">session &#x3D; Session()</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢</span><br><span class="line"># cursor &#x3D; session.execute(&#39;select * from users&#39;)</span><br><span class="line"># result &#x3D; cursor.fetchall()</span><br><span class="line"></span><br><span class="line"># æ·»åŠ </span><br><span class="line">with engine.connect() as con:</span><br><span class="line">    data &#x3D; (&#123;&#39;name&#39;: &#39;zhangsan&#39;, &#39;age&#39;: 20, &#39;value&#39;: &#39;zhangsan163@163.com&#39;&#125;,</span><br><span class="line">            &#123;&#39;name&#39;: &#39;lisi&#39;, &#39;age&#39;: 20, &#39;value&#39;: &#39;li163@163.com&#39;&#125;)</span><br><span class="line">    statement &#x3D; text(&quot;&quot;&quot;insert into users(name,age,email) values(:name,:age,:value)&quot;&quot;&quot;)</span><br><span class="line">    for line in data:</span><br><span class="line">        cursor &#x3D; con.execute(statement, **line)</span><br><span class="line"></span><br><span class="line">print(cursor.lastrowid)</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></li>
<li><p>åŸºæœ¬å¢åˆ æ”¹æŸ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from sqlalchemy.orm import sessionmaker</span><br><span class="line">from sqlalchemy import create_engine</span><br><span class="line">from sqlalchemy.sql import text</span><br><span class="line">from models import *</span><br><span class="line"></span><br><span class="line">engine &#x3D; create_engine(&quot;mysql+pymysql:&#x2F;&#x2F;zff:zff123@127.0.0.1:3306&#x2F;zff?charset&#x3D;utf8&quot;, max_overflow&#x3D;0, pool_size&#x3D;5)</span><br><span class="line">Session &#x3D; sessionmaker(bind&#x3D;engine)</span><br><span class="line"></span><br><span class="line">session &#x3D; Session()</span><br><span class="line"></span><br><span class="line"># 1. ################ æ·»åŠ  ################</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">obj1 &#x3D; Users(name&#x3D;&quot;jack&quot;, age&#x3D;19, email&#x3D;&quot;jak163@163.com&quot;)</span><br><span class="line">session.add(obj1)</span><br><span class="line"></span><br><span class="line">session.add_all([</span><br><span class="line">    Users(name&#x3D;&quot;wang&quot;, age&#x3D;19, email&#x3D;&quot;wang163@163.com&quot;),</span><br><span class="line">    Users(name&#x3D;&quot;lucy&quot;, age&#x3D;19, email&#x3D;&quot;lucy@163.com&quot;),</span><br><span class="line">    Hosts(name&#x3D;&quot;jav-pingtai03br-p002.gru1.blue.net&quot;),</span><br><span class="line">])</span><br><span class="line">session.commit()</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 2. ################ åˆ é™¤ ################</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">session.query(Users).filter(Users.id &gt; 2).delete()</span><br><span class="line">session.commit()</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># 3. ################ ä¿®æ”¹ ################</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">session.query(Users).filter(Users.id &gt; 0).update(&#123;&quot;name&quot; : &quot;shuke&quot;&#125;)</span><br><span class="line">session.query(Users).filter(Users.id &gt; 0).update(&#123;Users.name: Users.name + &quot;163&quot;&#125;, synchronize_session&#x3D;False)</span><br><span class="line">session.query(Users).filter(Users.id &gt; 0).update(&#123;&quot;age&quot;: Users.age + 1&#125;, synchronize_session&#x3D;&quot;evaluate&quot;)</span><br><span class="line">session.commit()</span><br><span class="line"></span><br><span class="line"># sqlalchemy åˆ©ç”¨ session æ‰§è¡Œ delete æ—¶æœ‰ä¸€ä¸ª synchronize_session å‚æ•°ç”¨æ¥è¯´æ˜ session åˆ é™¤å¯¹è±¡æ—¶éœ€è¦æ‰§è¡Œçš„ç­–ç•¥ï¼Œå…±ä¸‰ä¸ªé€‰é¡¹ï¼š</span><br><span class="line">1. False</span><br><span class="line">ä¸åŒæ­¥ sessionï¼Œå¦‚æœè¢«åˆ é™¤çš„ objects å·²ç»åœ¨ session ä¸­å­˜åœ¨ï¼Œåœ¨ session commit æˆ–è€… expire_all ä¹‹å‰ï¼Œè¿™äº›è¢«åˆ é™¤çš„å¯¹è±¡éƒ½å­˜åœ¨ session ä¸­ã€‚</span><br><span class="line">ä¸åŒæ­¥å¯èƒ½ä¼šå¯¼è‡´è·å–è¢«åˆ é™¤ objects æ—¶å‡ºé”™ã€‚</span><br><span class="line"></span><br><span class="line"># 2. fetch</span><br><span class="line">åˆ é™¤ä¹‹å‰ä» db ä¸­åŒ¹é…è¢«åˆ é™¤çš„å¯¹è±¡å¹¶ä¿å­˜åœ¨ session ä¸­ï¼Œç„¶åå†ä» session ä¸­åˆ é™¤ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†è®© session çš„å¯¹è±¡ç®¡ç† identity_map å¾—çŸ¥è¢«åˆ é™¤çš„å¯¹è±¡ç©¶ç«Ÿæ˜¯å“ªäº›ä»¥ä¾¿æ›´æ–°å¼•ç”¨å…³ç³»ã€‚</span><br><span class="line"></span><br><span class="line"># 3. evaluate</span><br><span class="line"># é»˜è®¤å€¼ã€‚æ ¹æ®å½“å‰çš„ query criteria æ‰«æ session ä¸­çš„ objectsï¼Œå¦‚æœä¸èƒ½æ­£ç¡®æ‰§è¡Œåˆ™æŠ›å‡ºé”™è¯¯ï¼Œè¿™å¥è¯ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼Œå¦‚æœ session ä¸­åŸæœ¬å°±æ²¡æœ‰è¿™äº›è¢«åˆ é™¤çš„ objectsï¼Œæ‰«æå½“ç„¶ä¸ä¼šå‘ç”ŸåŒ¹é…ï¼Œç›¸å½“äºåŒ¹é…æœªæ­£ç¡®æ‰§è¡Œã€‚</span><br><span class="line">æ³¨æ„è¿™é‡ŒæŠ¥é”™åªä¼šåœ¨ç‰¹å®š query criteria æ—¶æŠ¥é”™ï¼Œæ¯”å¦‚ in æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">session.query(Users).filter(Users.id.in_([1,2,3])).delete()</span><br><span class="line">sqlalchemy.exc.InvalidRequestError: Could not evaluate current criteria in Python. Specify &#39;fetch&#39; or False for the synchronize_session parameter.</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># 3. ################ æŸ¥è¯¢ ################</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">r1 &#x3D; session.query(Users).all()</span><br><span class="line">r2 &#x3D; session.query(Users.name.label(&#39;username&#39;), Users.age).all()   # åˆ«å</span><br><span class="line">r3 &#x3D; session.query(Users).filter(Users.name &#x3D;&#x3D; &quot;shuke&quot;).all()</span><br><span class="line">r4 &#x3D; session.query(Users).filter_by(name&#x3D;&#39;shuke&#39;).all()</span><br><span class="line">r5 &#x3D; session.query(Users).filter_by(name&#x3D;&#39;shuke&#39;).first()</span><br><span class="line">r6 &#x3D; session.query(Users).filter(text(&quot;id&lt;:value and name&#x3D;:name&quot;)).params(value&#x3D;2, name&#x3D;&#39;shuke&#39;).order_by(Users.id).all()</span><br><span class="line">r7 &#x3D; session.query(Users).from_statement(text(&quot;SELECT * FROM users where name&#x3D;:name&quot;)).params(name&#x3D;&#39;shuke&#39;).all()</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># filterå’Œfilter_byçš„åŒºåˆ«</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">filter_byç”¨äºç®€å•çš„åˆ—åæŸ¥è¯¢ï¼Œå¦‚ï¼š</span><br><span class="line">db.users.filter_by(name&#x3D;&#39;Joe&#39;)</span><br><span class="line"></span><br><span class="line">filterå¯¹äºä¸Šé¢çš„ä»£ç å¯ä»¥è¿™æ ·å†™ï¼š</span><br><span class="line">db.users.filter(db.users.name &#x3D;&#x3D; &#39;Joe&#39;)</span><br><span class="line"></span><br><span class="line">å¯¹äºå¤æ‚çš„æŸ¥è¯¢ä½¿ç”¨filterï¼Œå¦‚ï¼š</span><br><span class="line">db.users.filter(or_(db.users.name &#x3D;&#x3D; &#39;Ryan&#39;, db.users.country &#x3D;&#x3D; &#39;England&#39;))</span><br><span class="line"></span><br><span class="line">æ³¨æ„: filter_byä½¿ç”¨çš„æ˜¯èµ‹å€¼ &#x3D;, è€Œfilterä½¿ç”¨çš„æ˜¯åˆ¤æ–­ &#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">å¦å¤–ï¼šæŸ¥è¯¢æ—¶ä½¿ç”¨likeè¿™æ ·å†™ï¼š items &#x3D; session.query.filter(Users.name &#x3D;&#x3D; current_user, Users.title.like(&#39;%&#39; + keyword + &#39;%&#39;)).all()</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure></li>
<li><p>å¸¸ç”¨æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ¡ä»¶</span><br><span class="line">ret &#x3D; session.query(Users).filter_by(name&#x3D;&#39;shuke&#39;).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(Users.id &gt; 1, Users.name &#x3D;&#x3D; &#39;eric&#39;).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(Users.id.between(1, 3), Users.name &#x3D;&#x3D; &#39;eric&#39;).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(Users.id.in_([1, 3, 4])).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(~Users.id.in_([1, 3, 4])).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(Users.id.in_(session.query(Users.id).filter_by(name&#x3D;&#39;eric&#39;))).all()</span><br><span class="line"></span><br><span class="line"># æ¡ä»¶ AND &#x2F; OR</span><br><span class="line">from sqlalchemy import and_, or_</span><br><span class="line"></span><br><span class="line">ret &#x3D; session.query(Users).filter(and_(Users.id &gt; 3, Users.name &#x3D;&#x3D; &#39;eric&#39;)).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(or_(Users.id &lt; 3, Users.name &#x3D;&#x3D; &#39;shuke&#39;)).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(</span><br><span class="line">    or_(</span><br><span class="line">        Users.id &lt; 2,</span><br><span class="line">        and_(Users.name &#x3D;&#x3D; &#39;eric&#39;, Users.id &gt; 3),</span><br><span class="line">        Users.extra !&#x3D; &quot;&quot;</span><br><span class="line">    )).all()</span><br><span class="line"></span><br><span class="line"># é€šé…ç¬¦</span><br><span class="line">ret &#x3D; session.query(Users).filter(Users.name.like(&#39;e%&#39;)).all()</span><br><span class="line">ret &#x3D; session.query(Users).filter(~Users.name.like(&#39;e%&#39;)).all()  # å–å</span><br><span class="line"></span><br><span class="line"># é™åˆ¶</span><br><span class="line">ret &#x3D; session.query(Users)[1:2]  # limit</span><br><span class="line"></span><br><span class="line"># æ’åº</span><br><span class="line">ret &#x3D; session.query(Users).order_by(Users.name.desc()).all()  # æŒ‰é™åºæ’åˆ—</span><br><span class="line">ret &#x3D; session.query(Users).order_by(Users.name.desc(), Users.id.asc()).all()  # æ ¹æ®nameæŒ‰é™åºæ’åˆ—ï¼Œå†æ ¹æ®idå‡åºæ’åˆ—</span><br><span class="line"></span><br><span class="line"># åˆ†ç»„</span><br><span class="line">from sqlalchemy.sql import func</span><br><span class="line"></span><br><span class="line">ret &#x3D; session.query(Users).group_by(Users.extra).all()</span><br><span class="line">ret &#x3D; session.query(</span><br><span class="line">    func.max(Users.id),</span><br><span class="line">    func.sum(Users.id),</span><br><span class="line">    func.min(Users.id)).group_by(Users.name).all()</span><br><span class="line"></span><br><span class="line">ret &#x3D; session.query(</span><br><span class="line">    func.max(Users.id),</span><br><span class="line">    func.sum(Users.id),</span><br><span class="line">    func.min(Users.id)).group_by(Users.name).having(func.min(Users.id) &gt; 2).all()</span><br><span class="line"></span><br><span class="line"># è¿è¡¨æŸ¥è¯¢</span><br><span class="line">é»˜è®¤æ˜¯innerjoin</span><br><span class="line"># ç›´æ¥è®©ä¸¤ä¸ªè¡¨è”åˆã€‚è¿™é‡Œjoiné»˜è®¤æ˜¯innerjoinï¼Œè¿™é‡Œæ²¡æœ‰å†™ä»–ä»¬çš„å¯¹åº”å…³ç³»ï¼Œå®ƒä»¬åœ¨å†…éƒ¨è‡ªå·±æ‰¾ã€‚</span><br><span class="line"># å®ƒæ˜¯æ€ä¹ˆæ‰¾çš„å‘¢ï¼Œåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™ï¼Œæœ‰ç±»å‹æ˜¯foreignkeyï¼Œæ˜¯æ ¹æ®å®ƒæ¥æ‰¾çš„ã€‚</span><br><span class="line">ret &#x3D; session.query(Person).join(Favor).all()</span><br><span class="line">ç›¸å½“äºsqlè¯­å¥,ä¸¤ä¸ªè¡¨é€šè¿‡onï¼Œæ¥å…³è”</span><br><span class="line"></span><br><span class="line">a.  æŸ¥çœ‹sql</span><br><span class="line">sql &#x3D; session.query(Person).join(Favor)</span><br><span class="line">print(sql)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">inner joinæ‰“å°sqlï¼Œåªæ‰“å°personè¡¨æ‰€æœ‰å­—æ®µä¿¡æ¯ï¼Œä¸æ‰“å°favorè¡¨</span><br><span class="line">SELECT person.nid AS person_nid, person.name AS person_name, person.favor_id AS person_favor_id</span><br><span class="line">FROM person JOIN favor ON favor.nid &#x3D; person.favor_id</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">b. isouter&#x3D;Trueå³left join</span><br><span class="line">ret1 &#x3D; session.query(Person).join(Favor,isouter&#x3D;True).all()</span><br><span class="line">sql1 &#x3D; session.query(Person).join(Favor,isouter&#x3D;True)</span><br><span class="line">print(sql1)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">æ‰“å°sqlï¼Œåªæ‰“å°personè¡¨æ‰€æœ‰å­—æ®µçš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰æ‰“å°favorè¡¨</span><br><span class="line">SELECT person.nid AS person_nid, person.name AS person_name, person.favor_id AS person_favor_id</span><br><span class="line">FROM person LEFT OUTER JOIN favor ON favor.nid &#x3D; person.favor_id</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">c. ä¸¤å¼ è¡¨çš„ä¿¡æ¯éƒ½æ‰“å°å‡ºæ¥</span><br><span class="line">ret2 &#x3D; session.query(Person, Favor).join(Favor, isouter&#x3D;True).all()</span><br><span class="line">print(ret2)</span><br><span class="line">sql2 &#x3D; session.query(Person, Favor).join(Favor, isouter&#x3D;True)</span><br><span class="line">print(sql2)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">left join,æ‰“å°ç»“æœï¼šæ‰“å°personå’Œfavorä¸¤å¼ è¡¨çš„æ‰€æœ‰å­—æ®µã€‚</span><br><span class="line">[(&lt;__main__.Person object at 0x0000000003B34FD0&gt;, 1-white), (&lt;__main__.Person object at 0x0000000003B69BE0&gt;, 2-blue),</span><br><span class="line">(&lt;__main__.Person object at 0x0000000003B69C50&gt;, 2-blue)]</span><br><span class="line"></span><br><span class="line">left join,æ‰“å°sqlï¼šæ‰“å°personå’Œfavorä¸¤å¼ è¡¨çš„æ‰€æœ‰å­—æ®µã€‚</span><br><span class="line">SELECT person.nid AS person_nid, person.name AS person_name, person.favor_id AS person_favor_id,</span><br><span class="line">favor.nid AS favor_nid, favor.caption AS favor_caption</span><br><span class="line">FROM person LEFT OUTER JOIN favor ON favor.nid &#x3D; person.favor_id</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">d. è”è¡¨ï¼Œåªæ‰“å°æŸäº›å­—æ®µ</span><br><span class="line">ret3 &#x3D; session.query(Person.name,Favor.caption).join(Favor,isouter&#x3D;True).all()</span><br><span class="line">print(ret3)</span><br><span class="line">sql3 &#x3D; session.query(Person.name,Favor.caption).join(Favor,isouter&#x3D;True)</span><br><span class="line">print(sql3)</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">left join,æ‰“å°ç»“æœï¼šæŸäº›æŒ‡å®šå­—æ®µå€¼</span><br><span class="line">[(&#39;qiaomei0&#39;, &#39;white&#39;), (&#39;qiaomei1&#39;, &#39;blue&#39;), (&#39;qiaomei2&#39;, &#39;blue&#39;)]</span><br><span class="line">left join,æ‰“å°sqlï¼šæŸäº›æŒ‡å®šå­—æ®µå€¼</span><br><span class="line">SELECT person.name AS person_name, favor.caption AS favor_caption</span><br><span class="line">FROM person LEFT OUTER JOIN favor ON favor.nid &#x3D; person.favor_id</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line"># å…³è”å­æŸ¥è¯¢</span><br><span class="line">subqry &#x3D; session.query(func.count(Server.id).label(&quot;sid&quot;)).filter(Server.id &#x3D;&#x3D; Group.id).correlate(Group).as_scalar()</span><br><span class="line">result &#x3D; session.query(Group.name, subqry)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">SELECT &#96;group&#96;.name AS group_name, (SELECT count(server.id) AS sid </span><br><span class="line">FROM server </span><br><span class="line">WHERE server.id &#x3D; &#96;group&#96;.id) AS anon_1 </span><br><span class="line">FROM &#96;group&#96;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line"># ç»„åˆ</span><br><span class="line">q1 &#x3D; session.query(Users.name).filter(Users.id &gt; 2)</span><br><span class="line">q2 &#x3D; session.query(Favor.caption).filter(Favor.nid &lt; 2)</span><br><span class="line">ret &#x3D; q1.union(q2).all()</span><br><span class="line"></span><br><span class="line">q1 &#x3D; session.query(Users.name).filter(Users.id &gt; 2)</span><br><span class="line">q2 &#x3D; session.query(Favor.caption).filter(Favor.nid &lt; 2)</span><br><span class="line">ret &#x3D; q1.union_all(q2).all()</span><br></pre></td></tr></table></figure>
</li>
<li><p>è”è¡¨æŸ¥è¯¢(ä¸€å¯¹å¤š,åŸºäºrelationshipæ“ä½œForeignKey)</p>
</li>
</ul>
<ol>
<li>æ­£å‘æŸ¥è¯¢<br>å¤šå¯¹ä¸€ï¼Œå¤šçš„é‚£ç«¯å¼€å§‹æŸ¥ï¼Œä¹Ÿå°±æ˜¯foreignkeyå†™åœ¨å“ªé‡Œï¼Œä»å“ªé‡ŒæŸ¥ã€‚<br>ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•éå¸¸éº»çƒ¦ï¼Œæˆ‘ä»¬ç”¨æ›´é«˜æ•ˆçš„æ–¹æ³•ã€‚<br>åªè¦åœ¨è¡¨é‡ŒåŠ ä¸Šè¿™ä¸€å¥è¯ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">favor &#x3D; relationship(&quot;Favor&quot;, backref&#x3D;&#39;pers&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;person&#39;</span><br><span class="line">    nid &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True, nullable&#x3D;True)</span><br><span class="line">    favor_id &#x3D; Column(Integer, ForeignKey(&quot;favor.nid&quot;))</span><br><span class="line">    # ä¸ç”Ÿæˆè¡¨ç»“æ„æ— å…³ï¼Œä»…ç”¨äºæŸ¥è¯¢æ–¹ä¾¿</span><br><span class="line">    favor &#x3D; relationship(&quot;Favor&quot;, backref&#x3D;&#39;pers&#39;)</span><br><span class="line"> </span><br><span class="line">    # objä»£æŒ‡çš„æ˜¯Personè¡¨çš„æ¯ä¸€è¡Œæ•°æ®</span><br><span class="line">    # obj.favorä»£æŒ‡favorå¯¹è±¡ï¼Œobj.favor.nidå°±æ‹¿åˆ°äº†Personå…³è”çš„favorå¯¹è±¡çš„idã€‚</span><br><span class="line">    # æ‰€ä»¥ä½ ä¸ç”¨åšè”è¡¨ï¼Œå®ƒå†…éƒ¨å¸®ä½ åšè”è¡¨ã€‚</span><br><span class="line">ret &#x3D; session.query(Person).all()</span><br><span class="line">for obj in ret:     # æ¯ä¸ªobjå°±æ˜¯ä¸€è¡Œæ•°æ®ã€‚</span><br><span class="line"> </span><br><span class="line">    print(obj.nid,obj.name,obj.favor_id,obj.favor,obj.favor.nid,obj.favor.caption)</span><br></pre></td></tr></table></figure></li>
<li>åå‘æŸ¥è¯¢<br>å¤šå¯¹ä¸€ï¼Œä»ä¸€çš„é‚£ç«¯å¼€å§‹æŸ¥ï¼Œä¹Ÿå°±æ˜¯ä»æ²¡å†™foreignkeyçš„è¡¨é‡ŒåæŸ¥ã€‚<br>å¤šå¯¹ä¸€ï¼Œä»ä¸€çš„é‚£ç«¯åæŸ¥ã€‚<br>Personå’ŒFavoræ˜¯å¤šå¯¹ä¸€ï¼Œå‡å¦‚æŸ¥è¯¢å–œæ¬¢è“è‰²çš„æ‰€æœ‰äººã€‚Favorçš„captionä¸ºblueçš„æ‰€æœ‰å¯¹åº”çš„Person</li>
</ol>
<p>ä¼ ç»Ÿæ–¹å¼ï¼Œåå‘æŸ¥è¯¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ret3 &#x3D; session.query(Person.name,Favor.caption).join(Favor,isouter&#x3D;True).filter(Favor.caption &#x3D;&#x3D; &#39;blue&#39;).all()</span><br></pre></td></tr></table></figure>
<p>Personè¡¨é‡Œï¼Œå†™äº†backref=â€™persâ€™,å°±ç›¸å½“äºåœ¨favorè¡¨é‡ŒåŠ äº†ä¸ªå­—æ®µpers,å®é™…æ˜¯ä¸å­˜åœ¨çš„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">favor &#x3D; relationship(&quot;Favor&quot;, backref&#x3D;&#39;pers&#39;)</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;person&#39;</span><br><span class="line">    nid &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True, nullable&#x3D;True)</span><br><span class="line">    favor_id &#x3D; Column(Integer, ForeignKey(&quot;favor.nid&quot;))</span><br><span class="line">    # ä¸ç”Ÿæˆè¡¨ç»“æ„æ— å…³ï¼Œä»…ç”¨äºæŸ¥è¯¢æ–¹ä¾¿</span><br><span class="line">    favor &#x3D; relationship(&quot;Favor&quot;, backref&#x3D;&#39;pers&#39;)</span><br><span class="line"> </span><br><span class="line">class Favor(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;favor&#39;</span><br><span class="line">    nid &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    caption &#x3D; Column(String(50), default&#x3D;&#39;red&#39;, unique&#x3D;True)</span><br><span class="line">    # Personè¡¨é‡Œå†™çš„ï¼šbackref&#x3D;&#39;pers&#39;,ç›¸å½“äºåœ¨è¿™é‡ŒåŠ ä¸Šå­—æ®µpersã€‚åªæ˜¯ç”¨äºæŸ¥è¯¢ï¼Œä¸ä¼šä¿®æ”¹è¡¨ç»“æ„ã€‚</span><br><span class="line">    # pers &#x3D; ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</span><br><span class="line">    def __repr__(self):</span><br><span class="line">        return &quot;%s-%s&quot; %(self.nid, self.caption)</span><br></pre></td></tr></table></figure>
<p>ä½ å¯ä»¥ç›´æ¥é€šè¿‡Favorå¯¹è±¡çš„perså­—æ®µæ‰¾åˆ°è·Ÿè¿™ä¸ªé¢œè‰²å…³è”çš„æ‰€æœ‰person,åœ¨æ•°æ®åº“é‡Œæ²¡æœ‰çœŸå®çš„å­—æ®µå¯¹åº”çš„ï¼Œåªæ˜¯å¸®ä½ ç”Ÿæˆsqlè¯­å¥è€Œå·²ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ–°æ–¹å¼ï¼Œåå‘æŸ¥è¯¢</span><br><span class="line">obj &#x3D; session.query(Favor).filter(Favor.caption&#x3D;&#x3D;&#39;blue&#39;).first()    # å…ˆæ‰¾åˆ°captionä¸ºblueçš„Favorå¯¹è±¡</span><br><span class="line">print(obj.nid)</span><br><span class="line">print(obj.caption)</span><br><span class="line">print(obj.pers)</span><br><span class="line"> </span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">æ‰“å°ç»“æœï¼š</span><br><span class="line">2</span><br><span class="line">blue</span><br><span class="line">[&lt;__main__.Person object at 0x0000000003B5BBE0&gt;, &lt;__main__.Person object at 0x0000000003B5BC50&gt;]</span><br><span class="line">&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>Foreignkey(ä¸€å¯¹å¤šæ€»ç»“)<br>Foreignkeyå’Œrelationshipè¦æˆå¯¹å†™åœ¨ä¸€ä¸ªè¡¨é‡Œã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(Base):</span><br><span class="line">    __tablename__ &#x3D; &#39;person&#39;</span><br><span class="line">    nid &#x3D; Column(Integer, primary_key&#x3D;True)</span><br><span class="line">    name &#x3D; Column(String(32), index&#x3D;True, nullable&#x3D;True)</span><br><span class="line">    favor_id &#x3D; Column(Integer, ForeignKey(&quot;favor.nid&quot;))</span><br><span class="line">    # ä¸ç”Ÿæˆè¡¨ç»“æ„æ— å…³ï¼Œä»…ç”¨äºæŸ¥è¯¢æ–¹ä¾¿</span><br><span class="line">    favor &#x3D; relationship(&quot;Favor&quot;, backref&#x3D;&#39;pers&#39;)</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">Personå¯¹Favor æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼ŒforeignkeyåŠ åœ¨äº†å¤šçš„é‚£ç«¯(Personè¡¨)</span><br><span class="line">Personå¯¹è±¡.favor.favorçš„å­—æ®µï¼šå«åšæ­£å‘æŸ¥æ‰¾</span><br><span class="line">Favorå¯¹è±¡.pers.personçš„å­—æ®µï¼šåå‘æŸ¥æ‰¾</span><br><span class="line"></span><br><span class="line">- M2M(åŸºäºrelationshipçš„m2må…³ç³»)</span><br></pre></td></tr></table></figure>
<p>import time<br>import threading</p>
<p>from sqlalchemy.ext.declarative import declarative_base<br>from sqlalchemy import Column, Integer, String, ForeignKey, UniqueConstraint, Index<br>from sqlalchemy.orm import sessionmaker, relationship<br>from sqlalchemy import create_engine<br>from sqlalchemy.sql import text<br>from sqlalchemy.engine.result import ResultProxy<br>from db import Users, Hosts, Hobby, Person, Group, Server, Server2Group</p>
<p>engine = create_engine(â€œmysql+pymysql://root:<a href="mailto:123@127.0.0.1">123@127.0.0.1</a>:3306/s6?charset=utf8â€, max_overflow=0, pool_size=5)<br>Session = sessionmaker(bind=engine)<br>session = Session()</p>
<h1 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h1><p>â€œâ€â€<br>session.add_all([<br>    Server(hostname=â€™c1.comâ€™),<br>    Server(hostname=â€™c2.comâ€™),<br>    Group(name=â€™Aç»„â€™),<br>    Group(name=â€™Bç»„â€™),<br>])<br>session.commit()</p>
<p>s2g = Server2Group(server_id=1, group_id=1)<br>session.add(s2g)<br>session.commit()</p>
<p>gp = Group(name=â€™Cç»„â€™)<br>gp.servers = [Server(hostname=â€™c3.comâ€™),Server(hostname=â€™c4.comâ€™)]<br>session.add(gp)<br>session.commit()</p>
<p>ser = Server(hostname=â€™c6.comâ€™)<br>ser.groups = [Group(name=â€™Fç»„â€™),Group(name=â€™Gç»„â€™)]<br>session.add(ser)<br>session.commit()<br>â€œâ€â€</p>
<h1 id="ä½¿ç”¨relationshipæ­£å‘æŸ¥è¯¢"><a href="#ä½¿ç”¨relationshipæ­£å‘æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨relationshipæ­£å‘æŸ¥è¯¢"></a>ä½¿ç”¨relationshipæ­£å‘æŸ¥è¯¢</h1><p>â€œâ€â€<br>v = session.query(Group).first()<br>print(v.name)<br>print(v.servers)<br>â€œâ€â€</p>
<h1 id="ä½¿ç”¨relationshipåå‘æŸ¥è¯¢"><a href="#ä½¿ç”¨relationshipåå‘æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨relationshipåå‘æŸ¥è¯¢"></a>ä½¿ç”¨relationshipåå‘æŸ¥è¯¢</h1><p>â€œâ€â€<br>v = session.query(Server).first()<br>print(v.hostname)<br>print(v.groups)<br>â€œâ€â€<br>session.close()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- å¤šçº¿ç¨‹æ‰§è¡Œç¤ºä¾‹</span><br></pre></td></tr></table></figure>
<p>import time<br>import threading<br>from sqlalchemy.ext.declarative import declarative_base<br>from sqlalchemy import Column, Integer, String, ForeignKey, UniqueConstraint, Index<br>from sqlalchemy.orm import sessionmaker, relationship<br>from sqlalchemy import create_engine<br>from db import Users</p>
<p>engine = create_engine(â€œmysql+pymysql://root:<a href="mailto:123@127.0.0.1">123@127.0.0.1</a>:3306/s6â€, max_overflow=0, pool_size=5)<br>Session = sessionmaker(bind=engine)</p>
<p>def task(arg):<br>    session = Session()<br>    obj1 = Users(name=â€shukeâ€)<br>    session.add(obj1)<br>    session.commit()</p>
<p>for i in range(10):<br>    t = threading.Thread(target=task, args=(i,))<br>    t.start()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- åŸºäºscoped_sessionä½¿å¾—çº¿ç¨‹å®‰å…¨</span><br><span class="line">åŸºäºThreadLocalå®ç°</span><br></pre></td></tr></table></figure>
<p>from sqlalchemy.orm import sessionmaker<br>from sqlalchemy import create_engine<br>from sqlalchemy.orm import scoped_session<br>from models import Users</p>
<p>engine = create_engine(â€œmysql+pymysql://root:<a href="mailto:123@127.0.0.1">123@127.0.0.1</a>:3306/s6â€, max_overflow=0, pool_size=5)<br>Session = sessionmaker(bind=engine)</p>
<p>â€œâ€â€</p>
<h1 id="çº¿ç¨‹å®‰å…¨ï¼ŒåŸºäºæœ¬åœ°çº¿ç¨‹å®ç°æ¯ä¸ªçº¿ç¨‹ç”¨åŒä¸€ä¸ªsession"><a href="#çº¿ç¨‹å®‰å…¨ï¼ŒåŸºäºæœ¬åœ°çº¿ç¨‹å®ç°æ¯ä¸ªçº¿ç¨‹ç”¨åŒä¸€ä¸ªsession" class="headerlink" title="çº¿ç¨‹å®‰å…¨ï¼ŒåŸºäºæœ¬åœ°çº¿ç¨‹å®ç°æ¯ä¸ªçº¿ç¨‹ç”¨åŒä¸€ä¸ªsession"></a>çº¿ç¨‹å®‰å…¨ï¼ŒåŸºäºæœ¬åœ°çº¿ç¨‹å®ç°æ¯ä¸ªçº¿ç¨‹ç”¨åŒä¸€ä¸ªsession</h1><h1 id="ç‰¹æ®Šçš„ï¼šscoped-sessionä¸­æœ‰åŸæ¥æ–¹æ³•çš„Sessionä¸­çš„ä¸€ä¸‹æ–¹æ³•ï¼š"><a href="#ç‰¹æ®Šçš„ï¼šscoped-sessionä¸­æœ‰åŸæ¥æ–¹æ³•çš„Sessionä¸­çš„ä¸€ä¸‹æ–¹æ³•ï¼š" class="headerlink" title="ç‰¹æ®Šçš„ï¼šscoped_sessionä¸­æœ‰åŸæ¥æ–¹æ³•çš„Sessionä¸­çš„ä¸€ä¸‹æ–¹æ³•ï¼š"></a>ç‰¹æ®Šçš„ï¼šscoped_sessionä¸­æœ‰åŸæ¥æ–¹æ³•çš„Sessionä¸­çš„ä¸€ä¸‹æ–¹æ³•ï¼š</h1><p>public_methods = (<br>    â€˜<strong>contains</strong>â€˜, â€˜<strong>iter</strong>â€˜, â€˜addâ€™, â€˜add_allâ€™, â€˜beginâ€™, â€˜begin_nestedâ€™,<br>    â€˜closeâ€™, â€˜commitâ€™, â€˜connectionâ€™, â€˜deleteâ€™, â€˜executeâ€™, â€˜expireâ€™,<br>    â€˜expire_allâ€™, â€˜expungeâ€™, â€˜expunge_allâ€™, â€˜flushâ€™, â€˜get_bindâ€™,<br>    â€˜is_modifiedâ€™, â€˜bulk_save_objectsâ€™, â€˜bulk_insert_mappingsâ€™,<br>    â€˜bulk_update_mappingsâ€™,<br>    â€˜mergeâ€™, â€˜queryâ€™, â€˜refreshâ€™, â€˜rollbackâ€™,<br>    â€˜scalarâ€™<br>)</p>
<p>â€œâ€â€<br>session = scoped_session(Session)</p>
<h1 id="æ‰§è¡ŒORMæ“ä½œ"><a href="#æ‰§è¡ŒORMæ“ä½œ" class="headerlink" title="############# æ‰§è¡ŒORMæ“ä½œ"></a>############# æ‰§è¡ŒORMæ“ä½œ</h1><p>obj1 = Users(name=â€shukeâ€)<br>session.add(obj1)</p>
<h1 id="æäº¤äº‹åŠ¡"><a href="#æäº¤äº‹åŠ¡" class="headerlink" title="æäº¤äº‹åŠ¡"></a>æäº¤äº‹åŠ¡</h1><p>session.commit()</p>
<h1 id="å…³é—­session"><a href="#å…³é—­session" class="headerlink" title="å…³é—­session"></a>å…³é—­session</h1><p>session.close()</p>
<pre><code>

å‚è€ƒèµ„æ–™:
[Flask-SQLAlchemy-æ­¦æ²›é½-åšå®¢å›­](http://www.cnblogs.com/wupeiqi/articles/8259356.html)  
[mysqlå’ŒSQLAlchemy-åšå®¢å›­](https://www.cnblogs.com/wangqiaomei/p/5721523.html)  
[ä½¿ç”¨flask-sqlalchemyç©è½¬MySQL | Wing&apos;s Tech Space](https://wing324.github.io/2017/02/25/%E4%BD%BF%E7%94%A8flask-sqlalchemy%E7%8E%A9%E8%BD%ACMySQL/)  
[Flask-Migrateçš„ä½¿ç”¨ | Wing&apos;s Tech Space](https://wing324.github.io/2017/02/26/Flask-Migrate%E7%9A%84%E4%BD%BF%E7%94%A8/)





























</code></pre>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Salt API</title>
    <url>/2020/04/20/Salt-API/</url>
    <content><![CDATA[<h2 id="Salt-API"><a href="#Salt-API" class="headerlink" title="Salt API"></a>Salt API</h2><blockquote>
<p>ä½¿ç”¨saltæ‰§è¡ŒåŸç”Ÿlinuxå‘½ä»¤</p>
</blockquote>
<ol>
<li><p>å®‰è£…salt-ssh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ pip install salt-ssh</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨åº•å±‚APIæ‰§è¡Œshellå‘½ä»¤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from salt.client.ssh.shell import Shell</span><br><span class="line"></span><br><span class="line">shell &#x3D; Shell(&#123;&quot;_ssh_version&quot;: (4,9)&#125;,&quot;192.168.1.100&quot;,&quot;root&quot;,22,&quot;root123&quot;,timeout&#x3D;60)</span><br><span class="line">result &#x3D; shell.exec_cmd(&quot;df -h&quot;)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>
<h3 id="salt-shell-api"><a href="#salt-shell-api" class="headerlink" title="salt shell api"></a>salt shell api</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from salt.client.ssh.client import SSHClient</span><br><span class="line"></span><br><span class="line">clinet &#x3D; SSHClient()</span><br><span class="line"></span><br><span class="line">ret &#x3D; client.cmd(&quot;*&quot;,&quot;cmd.run&quot;,(&quot;df -h&quot;,),30)</span><br><span class="line">print(ret)</span><br></pre></td></tr></table></figure>


</li>
</ol>
]]></content>
      <categories>
        <category>Salt</category>
      </categories>
      <tags>
        <tag>Salt</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼</title>
    <url>/2020/04/20/Python%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼"><a href="#Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼" class="headerlink" title="Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼"></a>Pythonè¯­è¨€å®ç°å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼</h2><blockquote>
<p>æ ¹æ®è½¯ä»¶è®¾è®¡åŸåˆ™ä¸­å¼€æ”¾å°é—­åŸåˆ™çš„æŒ‡å¯¼æ€æƒ³, ä¸€ä¸ªç±»å†™å¥½åï¼Œå°½é‡ä¸è¦ä¿®æ”¹é‡Œé¢çš„å†…å®¹, è€Œæ˜¯é€šè¿‡æ·»åŠ æ–°çš„ç»§æ‰¿åº”å¯¹å˜åŒ–, ç®€å•å·¥å‚ä¸ç¬¦åˆè¿™ä¸ªè®¾è®¡åŸåˆ™, æ‰€ä»¥æœ¬ç¯‡æ–‡ç« å°†ä½¿ç”¨ä¼ªä»£ç ä»‹ç»å·¥å‚æ–¹æ³•è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨</p>
</blockquote>
<p>èƒŒæ™¯: ç°å…¬å¸ç›‘æ§ç³»ç»ŸæŠ¥è­¦éœ€è¦å¯¹æ¥ä¼ä¸šå¾®ä¿¡å…¬ä¼—å·, ç”±äºæœªè®¤è¯ä¼ä¸šå¾®ä¿¡æ¨é€æ¶ˆæ¯çš„é™åˆ¶, é»˜è®¤æ¯å¤©æ¨é€æ¡æ•°ä¸Šé™ä¸º6000æ¡, è€ƒè™‘åˆ°æŠ¥è­¦ç³»ç»Ÿå¤š, è§„åˆ™æ²¡æœ‰æ”¶æ•›, æ¥æ”¶çš„äººå‘˜å¤š, æ¯å¤©6000æ¡å¯èƒ½ä¸å¤Ÿç”¨, æ‰€ä»¥éœ€è¦åˆ›å»ºå¤šä¸ªæœªè®¤è¯çš„ä¼ä¸šå¾®ä¿¡è´¦å·ç”¨äºå‘é€æŠ¥è­¦ä¿¡æ¯. æˆ‘ä»¬å°†ä»¥æ­¤éœ€æ±‚ä¸ºèƒŒæ™¯, æ¼”ç¤ºå·¥å‚æ–¹æ³•çš„è®¾è®¡æ¨¡å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class WeChat:</span><br><span class="line"></span><br><span class="line">    def send_message(self, content):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line">    def send_image(self, imageid):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AccountA(WeChat):</span><br><span class="line"></span><br><span class="line">    def send_message(self, content):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯: &quot;, content)</span><br><span class="line"></span><br><span class="line">    def send_image(self, imageid):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€å›¾ç‰‡: &quot;, imageid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AccountB(WeChat):</span><br><span class="line"></span><br><span class="line">    def send_message(self, content):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯: &quot;, content)</span><br><span class="line"></span><br><span class="line">    def send_image(self, imageid):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€å›¾ç‰‡: &quot;, imageid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class WeChatFactory:</span><br><span class="line"></span><br><span class="line">    def create_wechat(self):</span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AccountAFactory(WeChatFactory):</span><br><span class="line"></span><br><span class="line">    def create_wechat(self):</span><br><span class="line">        return AccountA()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AccountBFactory(WeChatFactory):</span><br><span class="line"></span><br><span class="line">    def create_wechat(self):</span><br><span class="line">        return AccountB()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">	# å®ä¾‹åŒ–è´¦å·A</span><br><span class="line">    wechat_factory_a &#x3D; AccountAFactory()</span><br><span class="line">	# åˆ›å»ºè´¦å·Açš„å¾®ä¿¡å¯¹è±¡</span><br><span class="line">    wechat1 &#x3D; wechat_factory_a.create_wechat()</span><br><span class="line">    wechat2 &#x3D; wechat_factory_a.create_wechat()</span><br><span class="line">    wechat3 &#x3D; wechat_factory_a.create_wechat()</span><br><span class="line">	# ä½¿ç”¨è´¦å·Aå¯¹è±¡å‘é€ä¿¡æ¯</span><br><span class="line">    wechat1.send_message(content&#x3D;&quot;haha&quot;)</span><br><span class="line">    wechat2.send_message(content&#x3D;&quot;hehe&quot;)</span><br><span class="line">    wechat3.send_message(content&#x3D;&quot;xixi&quot;)</span><br><span class="line"></span><br><span class="line">	# å®ä¾‹åŒ–è´¦å·B</span><br><span class="line">    wechat_factory_b &#x3D; AccountBFactory()</span><br><span class="line">	# åˆ›å»ºè´¦å·Bçš„å¾®ä¿¡å¯¹è±¡</span><br><span class="line">    wechat4 &#x3D; wechat_factory_b.create_wechat()</span><br><span class="line">    wechat5 &#x3D; wechat_factory_b.create_wechat()</span><br><span class="line">	# ä½¿ç”¨è´¦å·Bå¯¹è±¡å‘é€ä¿¡æ¯</span><br><span class="line">    wechat4.send_message(content&#x3D;&quot;heihei&quot;)</span><br><span class="line">    wechat5.send_message(content&#x3D;&quot;pupu&quot;)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  haha</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  hehe</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Aæ¨é€ä¿¡æ¯:  xixi</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯:  heihei</span><br><span class="line">ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Bæ¨é€ä¿¡æ¯:  pupu</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ­¤æ—¶, ä¸¤ä¸ªå¾®ä¿¡è´¦å·éƒ½ä¸å¤Ÿç”¨äº†, éœ€è¦å¢åŠ ç¬¬ä¸‰ä¸ªè´¦å·æ—¶, æ‰€æœ‰çš„ç±»éƒ½ä¸éœ€è¦ä¿®æ”¹, åªéœ€åˆ›å»ºæ–°çš„ç±»å³å¯, ç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class AccountC(WeChat):</span><br><span class="line"></span><br><span class="line">    def send_message(self, content):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Cæ¨é€ä¿¡æ¯: &quot;, content)</span><br><span class="line"></span><br><span class="line">    def send_image(self, imageid):</span><br><span class="line">        print(&quot;ä½¿ç”¨ä¼ä¸šå¾®ä¿¡è´¦å·Cæ¨é€å›¾ç‰‡: &quot;, imageid)</span><br><span class="line">      </span><br><span class="line">    </span><br><span class="line">class AccountCFactory(WeChatFactory):</span><br><span class="line"></span><br><span class="line">    def create_wechat(self):</span><br><span class="line">        return AccountC()</span><br></pre></td></tr></table></figure>









]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Swaggerä»‹ç»</title>
    <url>/2020/04/20/Swagger%E4%BB%8B%E7%BB%8D/</url>
    <content><![CDATA[<h2 id="Swaggerä»‹ç»"><a href="#Swaggerä»‹ç»" class="headerlink" title="Swaggerä»‹ç»"></a>Swaggerä»‹ç»</h2><blockquote>
<p>Swaggeræ˜¯ä¸€ç§REST APIsçš„ç®€å•ä½†å¼ºå¤§çš„è¡¨ç¤ºæ–¹å¼ï¼Œæ ‡å‡†çš„ï¼Œè¯­è¨€æ— å…³ï¼Œè¿™ç§è¡¨ç¤ºæ–¹å¼ä¸ä½†äººå¯è¯»ï¼Œè€Œä¸”æœºå™¨å¯è¯»ã€‚å¯ä»¥ä½œä¸ºREST APIsçš„äº¤äº’å¼æ–‡æ¡£ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºREST APIsçš„å½¢å¼åŒ–çš„æ¥å£æè¿°ï¼Œç”Ÿæˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ã€‚<br> <a href="https://swagger.io/" target="_blank" rel="noopener">å®˜ç½‘</a><br> <a href="https://github.com/swagger-api/swagger-ui" target="_blank" rel="noopener">GitHub - swagger-api/swagger-ui</a>)<br> <a href="https://github.com/swagger-api/swagger-editor" target="_blank" rel="noopener">GitHub - swagger-api/swagger-editor: Swagger Editor</a><br> <a href="https://github.com/Swagger2Markup/swagger2markup" target="_blank" rel="noopener">GitHub - Swagger2Markup/swagger2markup: Swagger2Markup</a>  </p>
</blockquote>
<h3 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h3><p>åœ¨æ²¡æœ‰äº§å“ç»ç†æˆ–è€…é¡¹ç›®ç»ç†çš„æƒ…å†µä¸‹ï¼Œå¯¹äºå‰ç«¯å’Œåç«¯æ‰“äº¤é“æ¥è¯´ï¼Œæ— éå°±æ˜¯å¯¹æ¥å£çš„äº‰äº‰åµåµï¼Œå­—æ®µå¤šå¤šå°‘å°‘çš„äº‹ã€‚å¤§å¤šæ—¶å€™å‰ç«¯éƒ½å–œæ¬¢ç›´æ¥ä½¿ç”¨åç«¯æä¾›çš„æ¥å£ï¼Œè€Œåç«¯æœ‰æ—¶å€™å´ä¸çŸ¥é“å‰ç«¯åˆ°åº•è¦ä»€ä¹ˆæ•°æ®ï¼Œå°±è¿™æ ·ï¼ŒSwaggerè¿™æ ·çš„ç¥å™¨è¢«æˆ‘æ‰¾åˆ°äº†ï¼Œå¯¹äºSwaggeré«˜çº§çš„åº”ç”¨ï¼Œæ¯”å¦‚é›†æˆåˆ°IDEä¸­è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£,æ”¯æŒGO/python/Javaç­‰å¤šç§è¯­è¨€çš„IDEé›†æˆç¯å¢ƒ!</p>
<h3 id="2-Swagger-UIå’ŒSwagger-Editor"><a href="#2-Swagger-UIå’ŒSwagger-Editor" class="headerlink" title="2. Swagger UIå’ŒSwagger Editor"></a>2. Swagger UIå’ŒSwagger Editor</h3><ol>
<li>swagger uiæ˜¯ä¸€ä¸ªAPIåœ¨çº¿æ–‡æ¡£ç”Ÿæˆå’Œæµ‹è¯•çš„åˆ©å™¨,ç›®å‰å‘ç°æœ€å¥½ç”¨çš„ã€‚</li>
</ol>
<ul>
<li>æ”¯æŒAPIè‡ªåŠ¨ç”ŸæˆåŒæ­¥çš„åœ¨çº¿æ–‡æ¡£</li>
<li>è¿™äº›æ–‡æ¡£å¯ç”¨äºé¡¹ç›®å†…éƒ¨APIå®¡æ ¸</li>
<li>æ–¹ä¾¿æµ‹è¯•äººå‘˜äº†è§£API</li>
<li>è¿™äº›æ–‡æ¡£å¯ä½œä¸ºå®¢æˆ·äº§å“æ–‡æ¡£çš„ä¸€éƒ¨åˆ†è¿›è¡Œå‘å¸ƒ</li>
<li>æ”¯æŒAPIè§„èŒƒç”Ÿæˆä»£ç ï¼Œç”Ÿæˆçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éª¨æ¶ä»£ç å¯ä»¥åŠ é€Ÿå¼€å‘å’Œæµ‹è¯•é€Ÿåº¦</li>
</ul>
<ol start="2">
<li>ä½¿ç”¨Swagger Editorç¼–å†™APIæ–‡æ¡£</li>
</ol>
<ul>
<li>Swagger Editorä¸Šçš„æ˜¯åŸºäºyaml/JSONçš„è¯­æ³•</li>
</ul>
<h3 id="3-ä¸ºä»€ä¹ˆé€‰æ‹©Swagger"><a href="#3-ä¸ºä»€ä¹ˆé€‰æ‹©Swagger" class="headerlink" title="3. ä¸ºä»€ä¹ˆé€‰æ‹©Swagger"></a>3. ä¸ºä»€ä¹ˆé€‰æ‹©Swagger</h3><ol>
<li>ä½¿ç”¨Swagger UIç”Ÿæˆçš„ç•Œé¢æ¯”Javadocç”Ÿæˆçš„ç•Œé¢ç¾è§‚</li>
<li>swaggerå¯ä»¥å®æ—¶åŒæ­¥APIæ–‡æ¡£(ä»£ç ä¿®æ”¹åï¼Œæ–‡æ¡£åŒæ­¥ä¿®æ”¹)</li>
<li>swaggerè§£æé€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜(ä½¿ç”¨è½»é‡çº§æ•°æ®äº¤æ¢æ ¼å¼JSON)</li>
<li>å¯¹ç°æœ‰SpringMVCå·¥ç¨‹æ”¯æŒå‹å¥½</li>
<li>Swaggerå¯ä»¥å……å½“å‰åç«¯äº¤æµçš„é‡è¦æ¡¥æ¢ï¼Œæ–¹ä¾¿å¿«æ·ã€‚å¾ˆå®ç”¨ã€‚</li>
<li>Swaggeré¡¹ç›®å…è®¸ä½ ç”Ÿäº§ï¼Œæ˜¾ç¤ºå’Œæ¶ˆè´¹ä½ è‡ªå·±çš„RESTfulæœåŠ¡ã€‚ä¸éœ€è¦ä»£ç†å’Œç¬¬ä¸‰æ–¹æœåŠ¡ã€‚æ˜¯ä¸€ä¸ªä¾èµ–è‡ªç”±çš„èµ„æºé›†åˆï¼Œå®ƒèƒ½é€šè¿‡Swagger-APIåŠ¨æ€çš„ç”Ÿæˆæ¼‚äº®çš„æ–‡æ¡£å’Œæ²™ç›’,å› ä¸ºSwagger-UIæ²¡æœ‰ä¾èµ–ï¼Œä½ å¯ä»¥æŠŠä»–éƒ¨ç½²åˆ°ä»»ä½•æœåŠ¡å™¨ç¯å¢ƒæˆ–è€…æ˜¯ä½ è‡ªå·±çš„æœºå™¨</li>
</ol>
<h3 id="4-Swaggerç»„ä»¶ä»‹ç»"><a href="#4-Swaggerç»„ä»¶ä»‹ç»" class="headerlink" title="4. Swaggerç»„ä»¶ä»‹ç»"></a>4. Swaggerç»„ä»¶ä»‹ç»</h3><ol>
<li>éƒ¨ç½²å®‰è£…ç•¥,å¯è‡ªè¡Œåœ¨githubä¸­æŸ¥æ‰¾,å»ºè®®ä½¿ç”¨Dockeræ–¹å¼å®‰è£…éƒ¨ç½²,ç®€å•æ–¹ä¾¿;</li>
<li>Swaggerç”Ÿæ€å·¥å…·ç»„ä»¶è¾ƒå¤š,æœ¬æ–‡ä¸»è¦ä»‹ç»Swagger-Editorä»¥åŠSwagger-UIçš„ä½¿ç”¨,Editorç”¨äºç”Ÿæˆå„è¯­è¨€å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„ä¾èµ–æ–‡ä»¶,UIéƒ¨åˆ†ä¸»è¦é’ˆå¯¹å®¢æˆ·ç«¯å·¥å…·ç”Ÿæˆçš„swagger.jsonæˆ–swagger.ymlæ–‡ä»¶è¿›è¡Œæ¥å£çš„æŸ¥çœ‹å’Œæ¥å£æµ‹è¯•;</li>
<li>Swaggerä¹Ÿæœ‰æ”¯æŒç”ŸæˆMarkDownæ–‡æ¡£æ ¼å¼çš„ç»„ä»¶(Swagger2Markup);<br>PS: Swgger UIçš„ç«™ç‚¹åŸŸåè¦å’Œå‘é€è¯·æ±‚çš„åŸŸåä¸€æ ·,ä¸ç„¶æµè§ˆå™¨ä¼šæŠ¥è·¨åŸŸé”™è¯¯ã€‚</li>
<li>ç¤ºä¾‹Demo<br><a href="http://10.21.26.240:81/" target="_blank" rel="noopener">Swagger Editor</a><br><a href="http://10.21.26.240" target="_blank" rel="noopener">Swagger UI</a>  </li>
</ol>
<h3 id="5-Swagger-Editorä½¿ç”¨è¯´æ˜"><a href="#5-Swagger-Editorä½¿ç”¨è¯´æ˜" class="headerlink" title="5. Swagger Editorä½¿ç”¨è¯´æ˜"></a>5. Swagger Editorä½¿ç”¨è¯´æ˜</h3><h4 id="5-1-æˆ‘ä»¬å¯ä»¥åœ¨Swagger-Editorä¸­ç¼–è¾‘swagger-json-swagger-yamlæ–‡ä»¶-ç¼–å†™é¡¹ç›®çš„API-ç¼–å†™å®Œæˆåä¸‹è½½æ–‡ä»¶-é€šè¿‡Swagger-UIè¿›è¡Œå±•ç¤ºå’Œè°ƒè¯•ç›¸å…³æ“ä½œ"><a href="#5-1-æˆ‘ä»¬å¯ä»¥åœ¨Swagger-Editorä¸­ç¼–è¾‘swagger-json-swagger-yamlæ–‡ä»¶-ç¼–å†™é¡¹ç›®çš„API-ç¼–å†™å®Œæˆåä¸‹è½½æ–‡ä»¶-é€šè¿‡Swagger-UIè¿›è¡Œå±•ç¤ºå’Œè°ƒè¯•ç›¸å…³æ“ä½œ" class="headerlink" title="5.1 æˆ‘ä»¬å¯ä»¥åœ¨Swagger Editorä¸­ç¼–è¾‘swagger.json/swagger.yamlæ–‡ä»¶,ç¼–å†™é¡¹ç›®çš„API,ç¼–å†™å®Œæˆåä¸‹è½½æ–‡ä»¶,é€šè¿‡Swagger UIè¿›è¡Œå±•ç¤ºå’Œè°ƒè¯•ç›¸å…³æ“ä½œ;"></a>5.1 æˆ‘ä»¬å¯ä»¥åœ¨Swagger Editorä¸­ç¼–è¾‘swagger.json/swagger.yamlæ–‡ä»¶,ç¼–å†™é¡¹ç›®çš„API,ç¼–å†™å®Œæˆåä¸‹è½½æ–‡ä»¶,é€šè¿‡Swagger UIè¿›è¡Œå±•ç¤ºå’Œè°ƒè¯•ç›¸å…³æ“ä½œ;</h4><p>Swagger APIè¯­æ³•è¯´æ˜:   <a href="https://huangwenchao.gitbooks.io/swagger/content/" target="_blank" rel="noopener">å‚è€ƒ-Swaggerä»å…¥é—¨åˆ°ç²¾é€š</a>  </p>
<h4 id="5-2-å¦‚ä½•ä¸‹è½½æ–‡ä»¶"><a href="#5-2-å¦‚ä½•ä¸‹è½½æ–‡ä»¶" class="headerlink" title="5.2 å¦‚ä½•ä¸‹è½½æ–‡ä»¶?"></a>5.2 å¦‚ä½•ä¸‹è½½æ–‡ä»¶?</h4><p><img src="https://note.youdao.com/yws/api/personal/file/WEB1525428cb3824945193555edd9a8dc3b?method=download&shareKey=84d50c122964b88eda3ec345c896515d" alt="Swagger-json/Swagger-yaml">  </p>
<h4 id="5-3-ä¸‹è½½CLientåŒ…"><a href="#5-3-ä¸‹è½½CLientåŒ…" class="headerlink" title="5.3 ä¸‹è½½CLientåŒ…?"></a>5.3 ä¸‹è½½CLientåŒ…?</h4><p><img src="https://note.youdao.com/yws/api/personal/file/WEBbb49e77b2635fcf8fd33179488526763?method=download&shareKey=a5191b45239cdf1c76c23727074e0c4c" alt="Swagger-cleint">  </p>
<h3 id="6-Swagger-UI"><a href="#6-Swagger-UI" class="headerlink" title="6. Swagger UI"></a>6. Swagger UI</h3><p>ä¸»è¦ç”¨äºå±•ç¤ºSwagger-json/Swagger-yamlæ–‡ä»¶å†…å®¹<br><img src="https://note.youdao.com/yws/api/personal/file/WEBabf5c04995f32e14e0092062760de81a?method=download&shareKey=f725621241eb4e9bb7ab95d5b5f73318" alt="Webæ¥å£å±•ç¤º"><br><img src="https://note.youdao.com/yws/api/personal/file/WEB5cdc68f7e2d3f84f766a18c34adf2e94?method=download&shareKey=41b341528ab6e9d0bbf981adcbb79c6a" alt="Webæ¥å£æµ‹è¯•">  </p>
]]></content>
      <categories>
        <category>swagger</category>
      </categories>
      <tags>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>WebSocketå°è¯•ç‰›åˆ€</title>
    <url>/2020/04/20/WebSocket%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/</url>
    <content><![CDATA[<h2 id="WebSocketå°è¯•ç‰›åˆ€"><a href="#WebSocketå°è¯•ç‰›åˆ€" class="headerlink" title="WebSocketå°è¯•ç‰›åˆ€"></a>WebSocketå°è¯•ç‰›åˆ€</h2><h2 id="ä¸€-ä¸ºä»€ä¹ˆéœ€è¦WebSocket"><a href="#ä¸€-ä¸ºä»€ä¹ˆéœ€è¦WebSocket" class="headerlink" title="ä¸€. ä¸ºä»€ä¹ˆéœ€è¦WebSocket?"></a>ä¸€. ä¸ºä»€ä¹ˆéœ€è¦WebSocket?</h2><h3 id="1-1-åˆæ¬¡æ¥è§¦-WebSocket-çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº†-HTTP-åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿ"><a href="#1-1-åˆæ¬¡æ¥è§¦-WebSocket-çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº†-HTTP-åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿ" class="headerlink" title="1.1 åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿ"></a>1.1 åˆæ¬¡æ¥è§¦ WebSocket çš„äººï¼Œéƒ½ä¼šé—®åŒæ ·çš„é—®é¢˜ï¼šæˆ‘ä»¬å·²ç»æœ‰äº† HTTP åè®®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¦ä¸€ä¸ªåè®®ï¼Ÿ</h3><p>WebSocketæ˜¯HTML5å‡ºçš„ä¸œè¥¿ï¼ˆåè®®ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´HTTPåè®®æ²¡æœ‰å˜åŒ–ï¼Œæˆ–è€…è¯´æ²¡å…³ç³»ï¼Œä½†HTTPæ˜¯ä¸æ”¯æŒæŒä¹…è¿æ¥çš„ï¼ˆé•¿è¿æ¥ï¼Œå¾ªç¯è¿æ¥çš„ä¸ç®—ï¼‰é¦–å…ˆHTTPæœ‰1.1å’Œ1.0ä¹‹è¯´ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„keep-aliveï¼ŒæŠŠå¤šä¸ªHTTPè¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä½†æ˜¯Websocketå…¶å®æ˜¯ä¸€ä¸ªæ–°åè®®ï¼Œè·ŸHTTPåè®®åŸºæœ¬æ²¡æœ‰å…³ç³»ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹ç°æœ‰æµè§ˆå™¨çš„æ¡æ‰‹è§„èŒƒè€Œå·²ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯HTTPåè®®ä¸Šçš„ä¸€ç§è¡¥å…….<br>ç­”æ¡ˆå…¶å®å¾ˆç®€å•ï¼Œå› ä¸º HTTP åè®®æœ‰ä¸€ä¸ªç¼ºé™·ï¼šé€šä¿¡åªèƒ½ç”±å®¢æˆ·ç«¯å‘èµ·,ç‰¹åˆ«æ˜¯çŸ­é“¾æ¥,æ— çŠ¶æ€,è¯·æ±‚åœ¨è·å–ç›¸åº”ä¿¡æ¯ä¹‹åç«‹åˆ»æ–­å¼€è¿æ¥.</p>
<h3 id="1-2-é‚£ä¹ˆ-WebSocetåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢-å®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ"><a href="#1-2-é‚£ä¹ˆ-WebSocetåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢-å®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ" class="headerlink" title="1.2 é‚£ä¹ˆ,WebSocetåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢?å®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ"></a>1.2 é‚£ä¹ˆ,WebSocetåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢?å®ƒèƒ½å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h3><p>Websocketæ˜¯ä»€ä¹ˆæ ·çš„åè®®ï¼Œå…·ä½“æœ‰ä»€ä¹ˆä¼˜ç‚¹é¦–å…ˆï¼ŒWebsocketæ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„åè®®ï¼Œç›¸å¯¹äºHTTPè¿™ç§éæŒä¹…çš„åè®®æ¥è¯´ã€‚<br>ç®€å•çš„ä¸¾ä¸ªä¾‹å­å§ï¼Œç”¨ç›®å‰åº”ç”¨æ¯”è¾ƒå¹¿æ³›çš„PHPç”Ÿå‘½å‘¨æœŸæ¥è§£é‡Šã€‚</p>
<ul>
<li>HTTPçš„ç”Ÿå‘½å‘¨æœŸé€šè¿‡Requestæ¥ç•Œå®šï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªRequest ä¸€ä¸ªResponseï¼Œé‚£ä¹ˆåœ¨HTTP1.0ä¸­ï¼Œè¿™æ¬¡HTTPè¯·æ±‚å°±ç»“æŸäº†ã€‚</li>
<li>åœ¨HTTP1.1ä¸­è¿›è¡Œäº†æ”¹è¿›ï¼Œä½¿å¾—æœ‰ä¸€ä¸ªkeep-aliveï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªHTTPè¿æ¥ä¸­ï¼Œå¯ä»¥å‘é€å¤šä¸ªRequestï¼Œæ¥æ”¶å¤šä¸ªResponseã€‚ä½†æ˜¯è¯·è®°ä½ Request = Response,åœ¨HTTPä¸­æ°¸è¿œæ˜¯è¿™æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªrequeståªèƒ½æœ‰ä¸€ä¸ªresponseã€‚è€Œä¸”è¿™ä¸ªresponseä¹Ÿæ˜¯è¢«åŠ¨çš„ï¼Œä¸èƒ½ä¸»åŠ¨å‘èµ·ã€‚</li>
</ul>
<h4 id="1-3-æ•™ç»ƒï¼Œä½ BBäº†è¿™ä¹ˆå¤šï¼Œè·ŸWebsocketæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ"><a href="#1-3-æ•™ç»ƒï¼Œä½ BBäº†è¿™ä¹ˆå¤šï¼Œè·ŸWebsocketæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ" class="headerlink" title="1.3 æ•™ç»ƒï¼Œä½ BBäº†è¿™ä¹ˆå¤šï¼Œè·ŸWebsocketæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ"></a>1.3 æ•™ç»ƒï¼Œä½ BBäº†è¿™ä¹ˆå¤šï¼Œè·ŸWebsocketæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</h4><p>å¥½å§ï¼Œæˆ‘æ­£å‡†å¤‡è¯´Websocketå‘¢ã€‚ã€‚é¦–å…ˆWebsocketæ˜¯åŸºäºHTTPåè®®çš„ï¼Œæˆ–è€…è¯´å€Ÿç”¨äº†HTTPçš„åè®®æ¥å®Œæˆä¸€éƒ¨åˆ†æ¡æ‰‹ã€‚åœ¨æ¡æ‰‹é˜¶æ®µæ˜¯ä¸€æ ·çš„,ä»¥ä¸‹æ¶‰åŠä¸“ä¸šæŠ€æœ¯å†…å®¹ï¼Œä¸æƒ³çœ‹çš„å¯ä»¥è·³è¿‡.<br>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸ªå…¸å‹çš„Websocketæ¡æ‰‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;chat HTTP&#x2F;1.1</span><br><span class="line">Host: server.example.com</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw&#x3D;&#x3D;</span><br><span class="line">Sec-WebSocket-Protocol: chat, superchat</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Origin: http:&#x2F;&#x2F;example.com</span><br></pre></td></tr></table></figure>
<p>ç†Ÿæ‚‰HTTPçš„ç«¥é‹å¯èƒ½å‘ç°äº†ï¼Œè¿™æ®µç±»ä¼¼HTTPåè®®çš„æ¡æ‰‹è¯·æ±‚ä¸­ï¼Œå¤šäº†å‡ ä¸ªä¸œè¥¿ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå°±æ˜¯Websocketçš„æ ¸å¿ƒäº†ï¼Œå‘Šè¯‰Apacheã€Nginxç­‰æœåŠ¡å™¨ï¼šæ³¨æ„å•¦ï¼Œçªå‘èµ·çš„æ˜¯Websocketåè®®ï¼Œå¿«ç‚¹å¸®æˆ‘æ‰¾åˆ°å¯¹åº”çš„åŠ©ç†å¤„ç†~ä¸æ˜¯é‚£ä¸ªè€åœŸçš„HTTP:)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw&#x3D;&#x3D;</span><br><span class="line">Sec-WebSocket-Protocol: chat, superchat</span><br><span class="line">Sec-WebSocket-Version: 13</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼ŒSec-WebSocket-Key æ˜¯ä¸€ä¸ªBase64 encodeçš„å€¼ï¼Œè¿™ä¸ªæ˜¯æµè§ˆå™¨éšæœºç”Ÿæˆçš„ï¼Œå‘Šè¯‰æœåŠ¡å™¨ï¼šæ³¥ç…¤ï¼Œä¸è¦å¿½æ‚ çªï¼Œæˆ‘è¦éªŒè¯å°¼æ˜¯ä¸æ˜¯çœŸçš„æ˜¯WebsocketåŠ©ç†ã€‚ç„¶åï¼ŒSec_WebSocket-Protocol æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å­—ç¬¦ä¸²ï¼Œç”¨æ¥åŒºåˆ†åŒURLä¸‹ï¼Œä¸åŒçš„æœåŠ¡æ‰€éœ€è¦çš„åè®®ã€‚ç®€å•ç†è§£ï¼šä»Šæ™šæˆ‘è¦æœåŠ¡Aï¼Œåˆ«æé”™å•¦<del>æœ€åï¼ŒSec-WebSocket-Version æ˜¯å‘Šè¯‰æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„Websocket Draftï¼ˆåè®®ç‰ˆæœ¬ï¼‰ï¼Œåœ¨æœ€åˆçš„æ—¶å€™ï¼ŒWebsocketåè®®è¿˜åœ¨ Draft é˜¶æ®µï¼Œå„ç§å¥‡å¥‡æ€ªæ€ªçš„åè®®éƒ½æœ‰ï¼Œè€Œä¸”è¿˜æœ‰å¾ˆå¤šæœŸå¥‡å¥‡æ€ªæ€ªä¸åŒçš„ä¸œè¥¿ï¼Œä»€ä¹ˆFirefoxå’ŒChromeç”¨çš„ä¸æ˜¯ä¸€ä¸ªç‰ˆæœ¬ä¹‹ç±»çš„ï¼Œå½“åˆWebsocketåè®®å¤ªå¤šå¯æ˜¯ä¸€ä¸ªå¤§éš¾é¢˜ã€‚ã€‚ä¸è¿‡ç°åœ¨è¿˜å¥½ï¼Œå·²ç»å®šä¸‹æ¥å•¦</del>å¤§å®¶éƒ½ä½¿ç”¨çš„ä¸€ä¸ªä¸œè¥¿~ è„±æ°´ï¼šæœåŠ¡å‘˜ï¼Œæˆ‘è¦çš„æ˜¯13å²çš„å™¢â†’_â†’<br>ç„¶åæœåŠ¡å™¨ä¼šè¿”å›ä¸‹åˆ—ä¸œè¥¿ï¼Œè¡¨ç¤ºå·²ç»æ¥å—åˆ°è¯·æ±‚ï¼Œ æˆåŠŸå»ºç«‹Websocketå•¦ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk&#x3D;</span><br><span class="line">Sec-WebSocket-Protocol: chat</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¼€å§‹å°±æ˜¯HTTPæœ€åè´Ÿè´£çš„åŒºåŸŸäº†ï¼Œå‘Šè¯‰å®¢æˆ·ï¼Œæˆ‘å·²ç»æˆåŠŸåˆ‡æ¢åè®®å•¦~</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br></pre></td></tr></table></figure>
<p>ä¾ç„¶æ˜¯å›ºå®šçš„ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å³å°†å‡çº§çš„æ˜¯Websocketåè®®ï¼Œè€Œä¸æ˜¯mozillasocketï¼Œlurnarsocketæˆ–è€…shitsocketã€‚ç„¶åï¼ŒSec-WebSocket-Accept è¿™ä¸ªåˆ™æ˜¯ç»è¿‡æœåŠ¡å™¨ç¡®è®¤ï¼Œå¹¶ä¸”åŠ å¯†è¿‡åçš„ Sec-WebSocket-Keyã€‚æœåŠ¡å™¨ï¼šå¥½å•¦å¥½å•¦ï¼ŒçŸ¥é“å•¦ï¼Œç»™ä½ çœ‹æˆ‘çš„ID CARDæ¥è¯æ˜è¡Œäº†å§ã€‚ã€‚åé¢çš„ï¼ŒSec-WebSocket-Protocol åˆ™æ˜¯è¡¨ç¤ºæœ€ç»ˆä½¿ç”¨çš„åè®®ã€‚è‡³æ­¤ï¼ŒHTTPå·²ç»å®Œæˆå®ƒæ‰€æœ‰å·¥ä½œäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®Œå…¨æŒ‰ç…§Websocketåè®®è¿›è¡Œäº†ã€‚<br>âš ï¸ : WebSocketä¸¤ä¸ªé‡è¦çš„æµç¨‹: 1. æ¡æ‰‹; 2. åŠ å¯†;</p>
<h2 id="äºŒ-å‰–æWebSocketè¯·æ±‚æµç¨‹"><a href="#äºŒ-å‰–æWebSocketè¯·æ±‚æµç¨‹" class="headerlink" title="äºŒ. å‰–æWebSocketè¯·æ±‚æµç¨‹"></a>äºŒ. å‰–æWebSocketè¯·æ±‚æµç¨‹</h2><p>ä¸‹é¢è®²ä½¿ç”¨Pythonç¼–å†™SocketæœåŠ¡ç«¯ï¼Œä¸€æ­¥ä¸€æ­¥åˆ†æè¯·æ±‚è¿‡ç¨‹!!!</p>
<h3 id="2-1-æœåŠ¡ç«¯"><a href="#2-1-æœåŠ¡ç«¯" class="headerlink" title="2.1 æœåŠ¡ç«¯"></a>2.1 æœåŠ¡ç«¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)</span><br><span class="line">sock.bind((&#39;127.0.0.1&#39;, 8002))</span><br><span class="line">sock.listen(5)</span><br><span class="line"># ç­‰å¾…ç”¨æˆ·è¿æ¥</span><br><span class="line">conn, address &#x3D; sock.accept()</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨SocketæœåŠ¡å™¨åï¼Œç­‰å¾…ç”¨æˆ·ã€è¿æ¥ã€‘ï¼Œç„¶åè¿›è¡Œæ”¶å‘æ•°æ®ã€‚</p>
<h3 id="2-2-å®¢æˆ·ç«¯è¿æ¥"><a href="#2-2-å®¢æˆ·ç«¯è¿æ¥" class="headerlink" title="2.2 å®¢æˆ·ç«¯è¿æ¥"></a>2.2 å®¢æˆ·ç«¯è¿æ¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;WebSocketåè®®å­¦ä¹ &lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">        &#x2F;&#x2F; å‘ 127.0.0.1:8002 å‘é€ä¸€ä¸ªWebSocketè¯·æ±‚</span><br><span class="line">        var socket &#x3D; new WebSocket(&quot;ws:&#x2F;&#x2F;127.0.0.1:8002&quot;);</span><br><span class="line">        socket.onmessage &#x3D; function (event) &#123;</span><br><span class="line">        &#x2F;* æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ(å›æ‰å‡½æ•°) *&#x2F;</span><br><span class="line">        var response &#x3D; event.data;</span><br><span class="line">        console.log(response);</span><br><span class="line">    &#125;;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>å½“å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¿æ¥è¯·æ±‚æ—¶ï¼Œä¸ä»…è¿æ¥è¿˜ä¼šå‘é€[æ¡æ‰‹]ä¿¡æ¯ï¼Œå¹¶ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œè‡³æ­¤è¿æ¥æ‰åˆ›å»ºæˆåŠŸï¼</p>
<h3 id="2-3-å»ºç«‹è¿æ¥"><a href="#2-3-å»ºç«‹è¿æ¥" class="headerlink" title="2.3 å»ºç«‹è¿æ¥"></a>2.3 å»ºç«‹è¿æ¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line"> </span><br><span class="line">sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)</span><br><span class="line">sock.bind((&#39;127.0.0.1&#39;, 8002))</span><br><span class="line">sock.listen(5)</span><br><span class="line"># è·å–å®¢æˆ·ç«¯socketå¯¹è±¡</span><br><span class="line">conn, address &#x3D; sock.accept()</span><br><span class="line"># è·å–å®¢æˆ·ç«¯çš„ã€æ¡æ‰‹ã€‘ä¿¡æ¯</span><br><span class="line">data &#x3D; conn.recv(1024)</span><br><span class="line">...</span><br><span class="line">conn.send(&#39;å“åº”ã€æ¡æ‰‹ã€‘ä¿¡æ¯&#39;)</span><br></pre></td></tr></table></figure>
<p>è¯·æ±‚å’Œå“åº”çš„ã€æ¡æ‰‹ã€‘ä¿¡æ¯éœ€è¦éµå¾ªè§„åˆ™:</p>
<ol>
<li>ä»è¯·æ±‚ã€æ¡æ‰‹ã€‘ä¿¡æ¯ä¸­æå– Sec-WebSocket-Key</li>
<li>åˆ©ç”¨magic_string å’Œ Sec-WebSocket-Key è¿›è¡Œhmac1åŠ å¯†ï¼Œå†è¿›è¡Œbase64åŠ å¯†</li>
<li>å°†åŠ å¯†ç»“æœå“åº”ç»™å®¢æˆ·ç«¯<br>âš ï¸ ï¼šmagic stringä¸ºï¼š258EAFA5-E914-47DA-95CA-C5AB0DC85B11<br>è¯·æ±‚ã€æ¡æ‰‹ã€‘ä¿¡æ¯æ ¼å¼ä¸º:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;chatsocket HTTP&#x2F;1.1</span><br><span class="line">Host: 127.0.0.1:8002</span><br><span class="line">Connection: Upgrade</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Origin: http:&#x2F;&#x2F;localhost:63342</span><br><span class="line">Sec-WebSocket-Version: 13</span><br><span class="line">Sec-WebSocket-Key: mnwFxiOlctXFN&#x2F;DeMt1Amg&#x3D;&#x3D;</span><br><span class="line">Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits</span><br></pre></td></tr></table></figure>
<h3 id="2-4-æå–Sec-WebSocket-Keyå€¼å¹¶åŠ å¯†ï¼š"><a href="#2-4-æå–Sec-WebSocket-Keyå€¼å¹¶åŠ å¯†ï¼š" class="headerlink" title="2.4 æå–Sec-WebSocket-Keyå€¼å¹¶åŠ å¯†ï¼š"></a>2.4 æå–Sec-WebSocket-Keyå€¼å¹¶åŠ å¯†ï¼š</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import socket</span><br><span class="line">import base64</span><br><span class="line">import hashlib</span><br><span class="line"> </span><br><span class="line">def get_headers(data):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å°†è¯·æ±‚å¤´æ ¼å¼åŒ–æˆå­—å…¸</span><br><span class="line">    :param data:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    header_dict &#x3D; &#123;&#125;</span><br><span class="line">    data &#x3D; str(data, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line"> </span><br><span class="line">    for i in data.split(&#39;\r\n&#39;):</span><br><span class="line">        print(i)</span><br><span class="line">    header, body &#x3D; data.split(&#39;\r\n\r\n&#39;, 1)</span><br><span class="line">    header_list &#x3D; header.split(&#39;\r\n&#39;)</span><br><span class="line">    for i in range(0, len(header_list)):</span><br><span class="line">        if i &#x3D;&#x3D; 0:</span><br><span class="line">            if len(header_list[i].split(&#39; &#39;)) &#x3D;&#x3D; 3:</span><br><span class="line">                header_dict[&#39;method&#39;], header_dict[&#39;url&#39;], header_dict[&#39;protocol&#39;] &#x3D; header_list[i].split(&#39; &#39;)</span><br><span class="line">        else:</span><br><span class="line">            k, v &#x3D; header_list[i].split(&#39;:&#39;, 1)</span><br><span class="line">            header_dict[k] &#x3D; v.strip()</span><br><span class="line">    return header_dict</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)</span><br><span class="line">sock.bind((&#39;127.0.0.1&#39;, 8002))</span><br><span class="line">sock.listen(5)</span><br><span class="line"> </span><br><span class="line">conn, address &#x3D; sock.accept()</span><br><span class="line">data &#x3D; conn.recv(1024)</span><br><span class="line">headers &#x3D; get_headers(data) # æå–è¯·æ±‚å¤´ä¿¡æ¯</span><br><span class="line"># å¯¹è¯·æ±‚å¤´ä¸­çš„sec-websocket-keyè¿›è¡ŒåŠ å¯†</span><br><span class="line">response_tpl &#x3D; &quot;HTTP&#x2F;1.1 101 Switching Protocols\r\n&quot; \</span><br><span class="line">      &quot;Upgrade:websocket\r\n&quot; \</span><br><span class="line">      &quot;Connection: Upgrade\r\n&quot; \</span><br><span class="line">      &quot;Sec-WebSocket-Accept: %s\r\n&quot; \</span><br><span class="line">      &quot;WebSocket-Location: ws:&#x2F;&#x2F;%s%s\r\n\r\n&quot;</span><br><span class="line">magic_string &#x3D; &#39;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#39;</span><br><span class="line">value &#x3D; headers[&#39;Sec-WebSocket-Key&#39;] + magic_string</span><br><span class="line">ac &#x3D; base64.b64encode(hashlib.sha1(value.encode(&#39;utf-8&#39;)).digest())</span><br><span class="line">response_str &#x3D; response_tpl % (ac.decode(&#39;utf-8&#39;), headers[&#39;Host&#39;], headers[&#39;url&#39;])</span><br><span class="line"># å“åº”ã€æ¡æ‰‹ã€‘ä¿¡æ¯</span><br><span class="line">conn.send(bytes(response_str, encoding&#x3D;&#39;utf-8&#39;))</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="ä¸‰-å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ”¶å‘æ•°æ®"><a href="#ä¸‰-å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ”¶å‘æ•°æ®" class="headerlink" title="ä¸‰. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ”¶å‘æ•°æ®"></a>ä¸‰. å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ”¶å‘æ•°æ®</h2><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼ è¾“æ•°æ®æ—¶ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œã€å°åŒ…ã€‘å’Œã€è§£åŒ…ã€‘ã€‚å®¢æˆ·ç«¯çš„JavaScriptç±»åº“å·²ç»å°è£…ã€å°åŒ…ã€‘å’Œã€è§£åŒ…ã€‘è¿‡ç¨‹ï¼Œä½†SocketæœåŠ¡ç«¯éœ€è¦æ‰‹åŠ¨å®ç°ã€‚</p>
<h3 id="3-1-ç¬¬ä¸€æ­¥ï¼šè·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€è§£åŒ…ã€‘"><a href="#3-1-ç¬¬ä¸€æ­¥ï¼šè·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€è§£åŒ…ã€‘" class="headerlink" title="3.1 ç¬¬ä¸€æ­¥ï¼šè·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€è§£åŒ…ã€‘"></a>3.1 ç¬¬ä¸€æ­¥ï¼šè·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€è§£åŒ…ã€‘</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åŸºäºpythonå®ç°çš„è§£åŒ…</span><br><span class="line"></span><br><span class="line">info &#x3D; conn.recv(8096)</span><br><span class="line">payload_len &#x3D; info[1] &amp; 127</span><br><span class="line">if payload_len &#x3D;&#x3D; 126:</span><br><span class="line">    extend_payload_len &#x3D; info[2:4]</span><br><span class="line">    mask &#x3D; info[4:8]</span><br><span class="line">    decoded &#x3D; info[8:]</span><br><span class="line">elif payload_len &#x3D;&#x3D; 127:</span><br><span class="line">    extend_payload_len &#x3D; info[2:10]</span><br><span class="line">    mask &#x3D; info[10:14]</span><br><span class="line">    decoded &#x3D; info[14:]</span><br><span class="line">else:</span><br><span class="line">    extend_payload_len &#x3D; None</span><br><span class="line">    mask &#x3D; info[2:6]</span><br><span class="line">    decoded &#x3D; info[6:]</span><br><span class="line"></span><br><span class="line">bytes_list &#x3D; bytearray()</span><br><span class="line">for i in range(len(decoded)):</span><br><span class="line">    chunk &#x3D; decoded[i] ^ mask[i % 4]</span><br><span class="line">    bytes_list.append(chunk)</span><br><span class="line">body &#x3D; str(bytes_list, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line">print(body)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-è§£åŒ…è¯¦ç»†è¿‡ç¨‹"><a href="#3-2-è§£åŒ…è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="3.2 è§£åŒ…è¯¦ç»†è¿‡ç¨‹:"></a>3.2 è§£åŒ…è¯¦ç»†è¿‡ç¨‹:</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0                   1                   2                   3</span><br><span class="line"> 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1</span><br><span class="line">+-+-+-+-+-------+-+-------------+-------------------------------+</span><br><span class="line">|F|R|R|R| opcode|M| Payload len |    Extended payload length    |</span><br><span class="line">|I|S|S|S|  (4)  |A|     (7)     |             (16&#x2F;64)           |</span><br><span class="line">|N|V|V|V|       |S|             |   (if payload len&#x3D;&#x3D;126&#x2F;127)   |</span><br><span class="line">| |1|2|3|       |K|             |                               |</span><br><span class="line">+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +</span><br><span class="line">|     Extended payload length continued, if payload len &#x3D;&#x3D; 127  |</span><br><span class="line">+ - - - - - - - - - - - - - - - +-------------------------------+</span><br><span class="line">|                               |Masking-key, if MASK set to 1  |</span><br><span class="line">+-------------------------------+-------------------------------+</span><br><span class="line">| Masking-key (continued)       |          Payload Data         |</span><br><span class="line">+-------------------------------- - - - - - - - - - - - - - - - +</span><br><span class="line">:                     Payload Data continued ...                :</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">|                     Payload Data continued ...                |</span><br><span class="line">+---------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="3-2-1-å®˜æ–¹è§£é‡Š"><a href="#3-2-1-å®˜æ–¹è§£é‡Š" class="headerlink" title="3.2.1 å®˜æ–¹è§£é‡Š"></a>3.2.1 å®˜æ–¹è§£é‡Š</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The MASK bit simply tells whether the message is encoded. Messages from the client must be masked, so your server should expect this to be 1. (In fact, section 5.1 of the spec says that your server must disconnect from a client if that client sends an unmasked message.) When sending a frame back to the client, do not mask it and do not set the mask bit. We&#39;ll explain masking later. Note: You have to mask messages even when using a secure socket.RSV1-3 can be ignored, they are for extensions.</span><br><span class="line"></span><br><span class="line">The opcode field defines how to interpret the payload data: 0x0 for continuation, 0x1 for text (which is always encoded in UTF-8), 0x2 for binary, and other so-called &quot;control codes&quot; that will be discussed later. In this version of WebSockets, 0x3 to 0x7 and 0xB to 0xF have no meaning.</span><br><span class="line"></span><br><span class="line">The FIN bit tells whether this is the last message in a series. If it&#39;s 0, then the server will keep listening for more parts of the message; otherwise, the server should consider the message delivered. More on this later.</span><br><span class="line"></span><br><span class="line">Decoding Payload Length</span><br><span class="line"></span><br><span class="line">To read the payload data, you must know when to stop reading. That&#39;s why the payload length is important to know. Unfortunately, this is somewhat complicated. To read it, follow these steps:</span><br><span class="line"></span><br><span class="line">Read bits 9-15 (inclusive) and interpret that as an unsigned integer. If it&#39;s 125 or less, then that&#39;s the length; you&#39;re done. If it&#39;s 126, go to step 2. If it&#39;s 127, go to step 3.</span><br><span class="line">Read the next 16 bits and interpret those as an unsigned integer. You&#39;re done.</span><br><span class="line">Read the next 64 bits and interpret those as an unsigned integer (The most significant bit MUST be 0). You&#39;re done.</span><br><span class="line">Reading and Unmasking the Data</span><br><span class="line"></span><br><span class="line">If the MASK bit was set (and it should be, for client-to-server messages), read the next 4 octets (32 bits); this is the masking key. Once the payload length and masking key is decoded, you can go ahead and read that number of bytes from the socket. Let&#39;s call the data ENCODED, and the key MASK. To get DECODED, loop through the octets (bytes a.k.a. characters for text data) of ENCODED and XOR the octet with the (i modulo 4)th octet of MASK. In pseudo-code (that happens to be valid JavaScript):</span><br><span class="line"></span><br><span class="line">var DECODED &#x3D; &quot;&quot;;</span><br><span class="line">for (var i &#x3D; 0; i &lt; ENCODED.length; i++) &#123;</span><br><span class="line">    DECODED[i] &#x3D; ENCODED[i] ^ MASK[i % 4];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Now you can figure out what DECODED means depending on your application.</span><br></pre></td></tr></table></figure>
<h3 id="3-3-å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€å°åŒ…ã€‘"><a href="#3-3-å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€å°åŒ…ã€‘" class="headerlink" title="3.3 å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€å°åŒ…ã€‘"></a>3.3 å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€å°åŒ…ã€‘</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def send_msg(conn, msg_bytes):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    WebSocketæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span><br><span class="line">    :param conn: å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„socketå¯¹è±¡,å³ï¼š conn,address &#x3D; socket.accept()</span><br><span class="line">    :param msg_bytes: å‘å®¢æˆ·ç«¯å‘é€çš„å­—èŠ‚</span><br><span class="line">    :return: </span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    import struct</span><br><span class="line"></span><br><span class="line">    token &#x3D; b&quot;\x81&quot;</span><br><span class="line">    length &#x3D; len(msg_bytes)</span><br><span class="line">    if length &lt; 126:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;B&quot;, length)</span><br><span class="line">    elif length &lt;&#x3D; 0xFFFF:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;!BH&quot;, 126, length)</span><br><span class="line">    else:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;!BQ&quot;, 127, length)</span><br><span class="line"></span><br><span class="line">    msg &#x3D; token + msg_bytes</span><br><span class="line">    conn.send(msg)</span><br><span class="line">    return True</span><br></pre></td></tr></table></figure>

<h2 id="å››-åŸºäºpythonå®ç°ç®€å•ç¤ºä¾‹"><a href="#å››-åŸºäºpythonå®ç°ç®€å•ç¤ºä¾‹" class="headerlink" title="å››. åŸºäºpythonå®ç°ç®€å•ç¤ºä¾‹"></a>å››. åŸºäºpythonå®ç°ç®€å•ç¤ºä¾‹</h2><h3 id="4-1-åŸºäºPython-socketå®ç°çš„WebSocketæœåŠ¡ç«¯"><a href="#4-1-åŸºäºPython-socketå®ç°çš„WebSocketæœåŠ¡ç«¯" class="headerlink" title="4.1 åŸºäºPython socketå®ç°çš„WebSocketæœåŠ¡ç«¯"></a>4.1 åŸºäºPython socketå®ç°çš„WebSocketæœåŠ¡ç«¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;5&#x2F;12</span><br><span class="line"></span><br><span class="line">import socket</span><br><span class="line">import hashlib</span><br><span class="line">import base64</span><br><span class="line"></span><br><span class="line">def get_headers(data):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å°†è¯·æ±‚å¤´æ ¼å¼åŒ–æˆå­—å…¸</span><br><span class="line">    :param data:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    header_dict &#x3D; &#123;&#125;</span><br><span class="line">    data &#x3D; str(data, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">    header, body &#x3D; data.split(&#39;\r\n\r\n&#39;, 1)</span><br><span class="line">    header_list &#x3D; header.split(&#39;\r\n&#39;)</span><br><span class="line">    for i in range(0, len(header_list)):</span><br><span class="line">        if i &#x3D;&#x3D; 0:</span><br><span class="line">            if len(header_list[i].split(&#39; &#39;)) &#x3D;&#x3D; 3:</span><br><span class="line">                header_dict[&#39;method&#39;], header_dict[&#39;url&#39;], header_dict[&#39;protocol&#39;] &#x3D; header_list[i].split(&#39; &#39;)</span><br><span class="line">        else:</span><br><span class="line">            k, v &#x3D; header_list[i].split(&#39;:&#39;, 1)</span><br><span class="line">            header_dict[k] &#x3D; v.strip()</span><br><span class="line">    return header_dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_msg(conn, msg_bytes):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    WebSocketæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span><br><span class="line">    :param conn: å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ç«¯çš„socketå¯¹è±¡,å³ï¼š conn,address &#x3D; socket.accept()</span><br><span class="line">    :param msg_bytes: å‘å®¢æˆ·ç«¯å‘é€çš„å­—èŠ‚</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    import struct</span><br><span class="line"></span><br><span class="line">    token &#x3D; b&quot;\x81&quot;</span><br><span class="line">    length &#x3D; len(msg_bytes)</span><br><span class="line">    if length &lt; 126:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;B&quot;, length)</span><br><span class="line">    elif length &lt;&#x3D; 0xFFFF:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;!BH&quot;, 126, length)</span><br><span class="line">    else:</span><br><span class="line">        token +&#x3D; struct.pack(&quot;!BQ&quot;, 127, length)</span><br><span class="line"></span><br><span class="line">    msg &#x3D; token + msg_bytes</span><br><span class="line">    conn.send(msg)</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)</span><br><span class="line">sock.bind((&#39;127.0.0.1&#39;, 8002))</span><br><span class="line">sock.listen(5)</span><br><span class="line"></span><br><span class="line"># ç­‰å¾…ç”¨æˆ·è¿æ¥</span><br><span class="line">conn, address &#x3D; sock.accept()</span><br><span class="line"></span><br><span class="line"># WebSocketå‘æ¥çš„è¿æ¥</span><br><span class="line"># 1. è·å–æ¡æ‰‹æ•°æ®</span><br><span class="line">data &#x3D; conn.recv(1024)</span><br><span class="line">headers &#x3D; get_headers(data)</span><br><span class="line"></span><br><span class="line"># 2. å¯¹æ¡æ‰‹ä¿¡æ¯è¿›è¡ŒåŠ å¯†ï¼š</span><br><span class="line">magic_string &#x3D; &#39;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&#39;</span><br><span class="line">value &#x3D; headers[&#39;Sec-WebSocket-Key&#39;] + magic_string</span><br><span class="line">ac &#x3D; base64.b64encode(hashlib.sha1(value.encode(&#39;utf-8&#39;)).digest())</span><br><span class="line"></span><br><span class="line"># 3. è¿”å›æ¡æ‰‹ä¿¡æ¯</span><br><span class="line">response_tpl &#x3D; &quot;HTTP&#x2F;1.1 101 Switching Protocols\r\n&quot; \</span><br><span class="line">               &quot;Upgrade:websocket\r\n&quot; \</span><br><span class="line">               &quot;Connection: Upgrade\r\n&quot; \</span><br><span class="line">               &quot;Sec-WebSocket-Accept: %s\r\n&quot; \</span><br><span class="line">               &quot;WebSocket-Location: ws:&#x2F;&#x2F;127.0.0.1:8002\r\n\r\n&quot;</span><br><span class="line"></span><br><span class="line">response_str &#x3D; response_tpl % (ac.decode(&#39;utf-8&#39;),)</span><br><span class="line"></span><br><span class="line">conn.sendall(bytes(response_str, encoding&#x3D;&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"># ä¹‹åï¼Œæ‰èƒ½è¿›è¡Œæ”¶å‘æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    # å¯¹æ•°æ®è¿›è¡Œè§£å¯†</span><br><span class="line">    # send_msg(conn, bytes(&#39;alex&#39;, encoding&#x3D;&#39;utf-8&#39;))</span><br><span class="line">    # send_msg(conn, bytes(&#39;SB&#39;, encoding&#x3D;&#39;utf-8&#39;))</span><br><span class="line">    # info &#x3D; conn.recv(8096)</span><br><span class="line">    # print(info)</span><br><span class="line"></span><br><span class="line">    info &#x3D; conn.recv(8096)</span><br><span class="line">    payload_len &#x3D; info[1] &amp; 127</span><br><span class="line">    if payload_len &#x3D;&#x3D; 126:</span><br><span class="line">        extend_payload_len &#x3D; info[2:4]</span><br><span class="line">        mask &#x3D; info[4:8]</span><br><span class="line">        decoded &#x3D; info[8:]</span><br><span class="line">    elif payload_len &#x3D;&#x3D; 127:</span><br><span class="line">        extend_payload_len &#x3D; info[2:10]</span><br><span class="line">        mask &#x3D; info[10:14]</span><br><span class="line">        decoded &#x3D; info[14:]</span><br><span class="line">    else:</span><br><span class="line">        extend_payload_len &#x3D; None</span><br><span class="line">        mask &#x3D; info[2:6]</span><br><span class="line">        decoded &#x3D; info[6:]</span><br><span class="line"></span><br><span class="line">    bytes_list &#x3D; bytearray()</span><br><span class="line">    for i in range(len(decoded)):</span><br><span class="line">        chunk &#x3D; decoded[i] ^ mask[i % 4]</span><br><span class="line">        bytes_list.append(chunk)</span><br><span class="line">    msg &#x3D; str(bytes_list, encoding&#x3D;&#39;utf-8&#39;)</span><br><span class="line"></span><br><span class="line">    rep &#x3D; msg + &#39; hello&#39;</span><br><span class="line">    send_msg(conn, bytes(rep, encoding&#x3D;&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>

<h3 id="4-2-åˆ©ç”¨JavaScriptç±»åº“å®ç°å®¢æˆ·ç«¯"><a href="#4-2-åˆ©ç”¨JavaScriptç±»åº“å®ç°å®¢æˆ·ç«¯" class="headerlink" title="4.2 åˆ©ç”¨JavaScriptç±»åº“å®ç°å®¢æˆ·ç«¯"></a>4.2 åˆ©ç”¨JavaScriptç±»åº“å®ç°å®¢æˆ·ç«¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;txt&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;button&quot; id&#x3D;&quot;btn&quot; value&#x3D;&quot;æäº¤&quot; onclick&#x3D;&quot;sendMsg();&quot;&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;button&quot; id&#x3D;&quot;close&quot; value&#x3D;&quot;å…³é—­è¿æ¥&quot; onclick&#x3D;&quot;closeConn();&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;content&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line"> </span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    var socket &#x3D; new WebSocket(&quot;ws:&#x2F;&#x2F;127.0.0.1:8003&#x2F;chatsocket&quot;);</span><br><span class="line"> </span><br><span class="line">    socket.onopen &#x3D; function () &#123;</span><br><span class="line">        &#x2F;* ä¸æœåŠ¡å™¨ç«¯è¿æ¥æˆåŠŸåï¼Œè‡ªåŠ¨æ‰§è¡Œ *&#x2F;</span><br><span class="line"> </span><br><span class="line">        var newTag &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">        newTag.innerHTML &#x3D; &quot;ã€è¿æ¥æˆåŠŸã€‘&quot;;</span><br><span class="line">        document.getElementById(&#39;content&#39;).appendChild(newTag);</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    socket.onmessage &#x3D; function (event) &#123;</span><br><span class="line">        &#x2F;* æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ®æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ *&#x2F;</span><br><span class="line">        var response &#x3D; event.data;</span><br><span class="line">        var newTag &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">        newTag.innerHTML &#x3D; response;</span><br><span class="line">        document.getElementById(&#39;content&#39;).appendChild(newTag);</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    socket.onclose &#x3D; function (event) &#123;</span><br><span class="line">        &#x2F;* æœåŠ¡å™¨ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ *&#x2F;</span><br><span class="line">        var newTag &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">        newTag.innerHTML &#x3D; &quot;ã€å…³é—­è¿æ¥ã€‘&quot;;</span><br><span class="line">        document.getElementById(&#39;content&#39;).appendChild(newTag);</span><br><span class="line">    &#125;;</span><br><span class="line"> </span><br><span class="line">    function sendMsg() &#123;</span><br><span class="line">        var txt &#x3D; document.getElementById(&#39;txt&#39;);</span><br><span class="line">        socket.send(txt.value);</span><br><span class="line">        txt.value &#x3D; &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    function closeConn() &#123;</span><br><span class="line">        socket.close();</span><br><span class="line">        var newTag &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">        newTag.innerHTML &#x3D; &quot;ã€å…³é—­è¿æ¥ã€‘&quot;;</span><br><span class="line">        document.getElementById(&#39;content&#39;).appendChild(newTag);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶,æˆ‘ä»¬åœ¨æµè§ˆå™¨çš„Consoleæ§åˆ¶å°åˆ©ç”¨Socketå¯¹è±¡å‘é€æ¶ˆæ¯,å°†ä¼šæ”¶åˆ°è¿”å›ä¿¡æ¯</p>
<h2 id="äº”-åŸºäºTornadoæ¡†æ¶å®ç°WebèŠå¤©å®¤"><a href="#äº”-åŸºäºTornadoæ¡†æ¶å®ç°WebèŠå¤©å®¤" class="headerlink" title="äº”. åŸºäºTornadoæ¡†æ¶å®ç°WebèŠå¤©å®¤"></a>äº”. åŸºäºTornadoæ¡†æ¶å®ç°WebèŠå¤©å®¤</h2><p>Tornadoæ˜¯ä¸€ä¸ªæ”¯æŒWebSocketçš„ä¼˜ç§€æ¡†æ¶ï¼Œå…¶å†…éƒ¨åŸç†æ­£å¦‚1~5æ­¥éª¤æè¿°ï¼Œå½“ç„¶Tornadoå†…éƒ¨å°è£…åŠŸèƒ½æ›´åŠ å®Œæ•´ã€‚<br>ä»¥ä¸‹æ˜¯åŸºäºTornadoå®ç°çš„èŠå¤©å®¤ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat app.py</span><br><span class="line"></span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import uuid</span><br><span class="line">import json</span><br><span class="line">import tornado.ioloop</span><br><span class="line">import tornado.web</span><br><span class="line">import tornado.websocket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class IndexHandler(tornado.web.RequestHandler):</span><br><span class="line">    def get(self):</span><br><span class="line">        self.render(&#39;index.html&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ChatHandler(tornado.websocket.WebSocketHandler):</span><br><span class="line">    # ç”¨æˆ·å­˜å‚¨å½“å‰èŠå¤©å®¤ç”¨æˆ·</span><br><span class="line">    waiters &#x3D; set()</span><br><span class="line">    # ç”¨äºå­˜å‚¨å†æ—¶æ¶ˆæ¯</span><br><span class="line">    messages &#x3D; []</span><br><span class="line"></span><br><span class="line">    def open(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å®¢æˆ·ç«¯è¿æ¥æˆåŠŸæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ</span><br><span class="line">        :return: </span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ChatHandler.waiters.add(self)</span><br><span class="line">        uid &#x3D; str(uuid.uuid4())</span><br><span class="line">        self.write_message(uid)</span><br><span class="line"></span><br><span class="line">        for msg in ChatHandler.messages:</span><br><span class="line">            content &#x3D; self.render_string(&#39;message.html&#39;, **msg)</span><br><span class="line">            self.write_message(content)</span><br><span class="line"></span><br><span class="line">    def on_message(self, message):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å®¢æˆ·ç«¯è¿å‘é€æ¶ˆæ¯æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œ</span><br><span class="line">        :param message: </span><br><span class="line">        :return: </span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        msg &#x3D; json.loads(message)</span><br><span class="line">        ChatHandler.messages.append(message)</span><br><span class="line"></span><br><span class="line">        for client in ChatHandler.waiters:</span><br><span class="line">            content &#x3D; client.render_string(&#39;message.html&#39;, **msg)</span><br><span class="line">            client.write_message(content)</span><br><span class="line"></span><br><span class="line">    def on_close(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å®¢æˆ·ç«¯å…³é—­è¿æ¥æ—¶ï¼Œï¼Œè‡ªåŠ¨æ‰§è¡Œ</span><br><span class="line">        :return: </span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ChatHandler.waiters.remove(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def run():</span><br><span class="line">    settings &#x3D; &#123;</span><br><span class="line">        &#39;template_path&#39;: &#39;templates&#39;,</span><br><span class="line">        &#39;static_path&#39;: &#39;static&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">    application &#x3D; tornado.web.Application([</span><br><span class="line">        (r&quot;&#x2F;&quot;, IndexHandler),</span><br><span class="line">        (r&quot;&#x2F;chat&quot;, ChatHandler),</span><br><span class="line">    ], **settings)</span><br><span class="line">    application.listen(8888)</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    run()</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">å®¢æˆ·ç«¯</span><br></pre></td></tr></table></figure>
<h1 id="cat-index-html"><a href="#cat-index-html" class="headerlink" title="cat index.html"></a>cat index.html</h1><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PythonèŠå¤©å®¤</title>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="shuke's Blog" type="application/atom+xml">
</head>
<body>
    <div>
        <input type="text" id="txt">
        <input type="button" id="btn" value="æäº¤" onclick="sendMsg();">
        <input type="button" id="close" value="å…³é—­è¿æ¥" onclick="closeConn();">
    </div>
    <div id="container" style="border: 1px solid #dddddd;margin: 20px;min-height: 500px;">

<pre><code>&lt;/div&gt;

&lt;script src=&quot;/static/jquery-2.1.4.min.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    $(function () {
        wsUpdater.start();
    });

    var wsUpdater = {
        socket: null,
        uid: null,
        start: function() {
            var url = &quot;ws://127.0.0.1:8888/chat&quot;;
            wsUpdater.socket = new WebSocket(url);
            wsUpdater.socket.onmessage = function(event) {
                console.log(event);
                if(wsUpdater.uid){
                    wsUpdater.showMessage(event.data);
                }else{
                    wsUpdater.uid = event.data;
                }
            }
        },
        showMessage: function(content) {
            $(&apos;#container&apos;).append(content);
        }
    };

    function sendMsg() {
        var msg = {
            uid: wsUpdater.uid,
            message: $(&quot;#txt&quot;).val()
        };
        wsUpdater.socket.send(JSON.stringify(msg));
    }</code></pre><p></p>
</div></body>
</html>
```

<p><a href="https://files.cnblogs.com/files/aslongas/2.WebSocket%E7%A4%BA%E4%BE%8B%EF%BC%9AFlask.rar" target="_blank" rel="noopener">Flask-WebSocketæŠ•ç¥¨ç¤ºä¾‹</a></p>
<p><a href="http://www.cnblogs.com/wupeiqi/p/6558766.html" target="_blank" rel="noopener">åŸæ–‡å‚è€ƒ</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Webæ¡†æ¶æœ¬è´¨</title>
    <url>/2020/04/20/Web%E6%A1%86%E6%9E%B6%E6%9C%AC%E8%B4%A8/</url>
    <content><![CDATA[<h2 id="Webæ¡†æ¶æœ¬è´¨"><a href="#Webæ¡†æ¶æœ¬è´¨" class="headerlink" title="Webæ¡†æ¶æœ¬è´¨"></a>Webæ¡†æ¶æœ¬è´¨</h2><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯¹äºæ‰€æœ‰çš„Webåº”ç”¨ï¼Œæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ä¸ªsocketæœåŠ¡ç«¯ï¼Œç”¨æˆ·çš„æµè§ˆå™¨å…¶å®å°±æ˜¯ä¸€ä¸ªsocketå®¢æˆ·ç«¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;4&#x2F;22</span><br><span class="line"></span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def handle_request(client):</span><br><span class="line">    # è·å–å®¢æˆ·ç«¯å‘é€çš„æ•°æ®</span><br><span class="line">    buf &#x3D; client.recv(1024)</span><br><span class="line">    # å›å¤å®¢æˆ·ç«¯çš„è¯·æ±‚</span><br><span class="line">    client.send(b&quot;HTTP&#x2F;1.1 200 OK\r\n\r\n&quot;)</span><br><span class="line">    client.send(b&quot;Hello, shuke&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # åˆ›å»ºsocketå¯¹è±¡</span><br><span class="line">    sock &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.bind((&#39;localhost&#39;, 9000))</span><br><span class="line">    sock.listen(5)</span><br><span class="line"></span><br><span class="line">    while True:</span><br><span class="line">        # ç›‘å¬socketï¼Œç­‰å¾…è¯·æ±‚çš„åˆ°æ¥</span><br><span class="line">        connection, address &#x3D; sock.accept()</span><br><span class="line">        handle_request(connection)</span><br><span class="line">        # å…³é—­è¿æ¥</span><br><span class="line">        connection.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"># éªŒè¯</span><br><span class="line">$ curl http:&#x2F;&#x2F;localhost:9000</span><br><span class="line">Hello, shuke</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°é€šè¿‡socketæ¥å®ç°äº†å…¶æœ¬è´¨ï¼Œè€Œå¯¹äºçœŸå®å¼€å‘ä¸­çš„python webç¨‹åºæ¥è¯´ï¼Œä¸€èˆ¬ä¼šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæœåŠ¡å™¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºã€‚æœåŠ¡å™¨ç¨‹åºè´Ÿè´£å¯¹socketæœåŠ¡å™¨è¿›è¡Œå°è£…ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¯¹è¯·æ±‚çš„å„ç§æ•°æ®è¿›è¡Œæ•´ç†ã€‚åº”ç”¨ç¨‹åºåˆ™è´Ÿè´£å…·ä½“çš„é€»è¾‘å¤„ç†ã€‚ä¸ºäº†æ–¹ä¾¿åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œå°±å‡ºç°äº†ä¼—å¤šçš„Webæ¡†æ¶ï¼Œä¾‹å¦‚ï¼šDjangoã€Flaskã€web.py ç­‰ã€‚ä¸åŒçš„æ¡†æ¶æœ‰ä¸åŒçš„å¼€å‘æ–¹å¼ï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œå¼€å‘å‡ºçš„åº”ç”¨ç¨‹åºéƒ½è¦å’ŒæœåŠ¡å™¨ç¨‹åºé…åˆï¼Œæ‰èƒ½ä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨ç¨‹åºå°±éœ€è¦ä¸ºä¸åŒçš„æ¡†æ¶æä¾›ä¸åŒçš„æ”¯æŒã€‚è¿™æ ·æ··ä¹±çš„å±€é¢æ— è®ºå¯¹äºæœåŠ¡å™¨è¿˜æ˜¯æ¡†æ¶ï¼Œéƒ½æ˜¯ä¸å¥½çš„ã€‚å¯¹æœåŠ¡å™¨æ¥è¯´ï¼Œéœ€è¦æ”¯æŒå„ç§ä¸åŒæ¡†æ¶ï¼Œå¯¹æ¡†æ¶æ¥è¯´ï¼Œåªæœ‰æ”¯æŒå®ƒçš„æœåŠ¡å™¨æ‰èƒ½è¢«å¼€å‘å‡ºçš„åº”ç”¨ä½¿ç”¨ã€‚è¿™æ—¶å€™ï¼Œæ ‡å‡†åŒ–å°±å˜å¾—å°¤ä¸ºé‡è¦ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç«‹ä¸€ä¸ªæ ‡å‡†ï¼Œåªè¦æœåŠ¡å™¨ç¨‹åºæ”¯æŒè¿™ä¸ªæ ‡å‡†ï¼Œæ¡†æ¶ä¹Ÿæ”¯æŒè¿™ä¸ªæ ‡å‡†ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¯ä»¥é…åˆä½¿ç”¨ã€‚ä¸€æ—¦æ ‡å‡†ç¡®å®šï¼ŒåŒæ–¹å„è‡ªå®ç°ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨å¯ä»¥æ”¯æŒæ›´å¤šæ”¯æŒæ ‡å‡†çš„æ¡†æ¶ï¼Œæ¡†æ¶ä¹Ÿå¯ä»¥ä½¿ç”¨æ›´å¤šæ”¯æŒæ ‡å‡†çš„æœåŠ¡å™¨ã€‚</p>
<p>WSGIï¼ˆWeb Server Gateway Interfaceï¼‰æ˜¯ä¸€ç§è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä½¿ç”¨pythonç¼–å†™çš„web appä¸web serverä¹‹é—´æ¥å£æ ¼å¼ï¼Œå®ç°web appä¸web serveré—´çš„è§£è€¦ã€‚</p>
<p>pythonæ ‡å‡†åº“æä¾›çš„ç‹¬ç«‹WSGIæœåŠ¡å™¨ç§°ä¸ºwsgiref</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from wsgiref.simple_server import make_server</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def RunServer(environ, start_response):</span><br><span class="line">    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;)])</span><br><span class="line">    return [bytes(&#39;&lt;h1&gt;Hello, web!&lt;&#x2F;h1&gt;&#39;, encoding&#x3D;&#39;utf-8&#39;), ]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    httpd &#x3D; make_server(&#39;&#39;, 8000, RunServer)</span><br><span class="line">    print(&quot;Serving HTTP on port 8000...&quot;)</span><br><span class="line">    httpd.serve_forever()</span><br></pre></td></tr></table></figure>
<h2 id="è‡ªå®šä¹‰æ¡†æ¶"><a href="#è‡ªå®šä¹‰æ¡†æ¶" class="headerlink" title="è‡ªå®šä¹‰æ¡†æ¶"></a>è‡ªå®šä¹‰æ¡†æ¶</h2><p>ä¸€. æ¡†æ¶<br>é€šè¿‡pythonæ ‡å‡†åº“æä¾›çš„wsgirefæ¨¡å—å¼€å‘ä¸€ä¸ªè‡ªå·±çš„Webæ¡†æ¶</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">#coding:utf-8</span><br><span class="line">from wsgiref.simple_server import make_server</span><br><span class="line"> </span><br><span class="line">def index():</span><br><span class="line">    return &#39;index&#39;</span><br><span class="line"> </span><br><span class="line">def login():</span><br><span class="line">    return &#39;login&#39;</span><br><span class="line"> </span><br><span class="line">def routers():</span><br><span class="line">     </span><br><span class="line">    urlpatterns &#x3D; (</span><br><span class="line">        (&#39;&#x2F;index&#x2F;&#39;,index),</span><br><span class="line">        (&#39;&#x2F;login&#x2F;&#39;,login),</span><br><span class="line">    )</span><br><span class="line">     </span><br><span class="line">    return urlpatterns</span><br><span class="line"> </span><br><span class="line">def RunServer(environ, start_response):</span><br><span class="line">    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;)])</span><br><span class="line">    url &#x3D; environ[&#39;PATH_INFO&#39;]</span><br><span class="line">    urlpatterns &#x3D; routers()</span><br><span class="line">    func &#x3D; None</span><br><span class="line">    for item in urlpatterns:</span><br><span class="line">        if item[0] &#x3D;&#x3D; url:</span><br><span class="line">            func &#x3D; item[1]</span><br><span class="line">            break</span><br><span class="line">    if func:</span><br><span class="line">        return func()</span><br><span class="line">    else:</span><br><span class="line">        return &#39;404 not found&#39;</span><br><span class="line">     </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    httpd &#x3D; make_server(&#39;&#39;, 8000, RunServer)</span><br><span class="line">    print &quot;Serving HTTP on port 8000...&quot;</span><br><span class="line">    httpd.serve_forever()</span><br><span class="line">&#96;&#96;&#96;    </span><br><span class="line">2ã€æ¨¡æ¿å¼•æ“</span><br><span class="line"></span><br><span class="line">åœ¨ä¸Šä¸€æ­¥éª¤ä¸­ï¼Œå¯¹äºæ‰€æœ‰çš„loginã€indexå‡è¿”å›ç»™ç”¨æˆ·æµè§ˆå™¨ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œåœ¨ç°å®çš„Webè¯·æ±‚ä¸­ä¸€èˆ¬ä¼šè¿”å›ä¸€ä¸ªå¤æ‚çš„ç¬¦åˆHTMLè§„åˆ™çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å°†è¦è¿”å›ç»™ç”¨æˆ·çš„HTMLå†™åœ¨æŒ‡å®šæ–‡ä»¶ä¸­ï¼Œç„¶åå†è¿”å›,å¦‚ï¼š</span><br></pre></td></tr></table></figure>
<h1 id="cat-index-html"><a href="#cat-index-html" class="headerlink" title="cat index.html"></a>cat index.html</h1><!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
    <h1>Index</h1>

</body>
</html>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line"># cat login.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; &#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; &#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">from wsgiref.simple_server import make_server</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def index():</span><br><span class="line">    # return &#39;index&#39;</span><br><span class="line">    f &#x3D; open(&#39;index.html&#39;)</span><br><span class="line">    data &#x3D; f.read()</span><br><span class="line">    return data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def login():</span><br><span class="line">    # return &#39;login&#39;</span><br><span class="line">    f &#x3D; open(&#39;login.html&#39;)</span><br><span class="line">    data &#x3D; f.read()</span><br><span class="line">    return data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def routers():</span><br><span class="line"> </span><br><span class="line">    urlpatterns &#x3D; (</span><br><span class="line">        (&#39;&#x2F;index&#x2F;&#39;, index),</span><br><span class="line">        (&#39;&#x2F;login&#x2F;&#39;, login),</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    return urlpatterns</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def run_server(environ, start_response):</span><br><span class="line">    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;)])</span><br><span class="line">    url &#x3D; environ[&#39;PATH_INFO&#39;]</span><br><span class="line">    urlpatterns &#x3D; routers()</span><br><span class="line">    func &#x3D; None</span><br><span class="line">    for item in urlpatterns:</span><br><span class="line">        if item[0] &#x3D;&#x3D; url:</span><br><span class="line">            func &#x3D; item[1]</span><br><span class="line">            break</span><br><span class="line">    if func:</span><br><span class="line">        return func()</span><br><span class="line">    else:</span><br><span class="line">        return &#39;404 not found&#39;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    httpd &#x3D; make_server(&#39;&#39;, 8000, run_server)</span><br><span class="line">    print &quot;Serving HTTP on port 8000...&quot;</span><br><span class="line">    httpd.serve_forever()</span><br></pre></td></tr></table></figure>
å¯¹äºä¸Šè¿°ä»£ç ï¼Œè™½ç„¶å¯ä»¥è¿”å›ç»™ç”¨æˆ·HTMLçš„å†…å®¹ä»¥ç°å®å¤æ‚çš„é¡µé¢ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼šå¦‚ä½•ç»™ç”¨æˆ·è¿”å›åŠ¨æ€å†…å®¹ï¼Ÿ
- è‡ªå®šä¹‰ä¸€å¥—ç‰¹æ®Šçš„è¯­æ³•ï¼Œè¿›è¡Œæ›¿æ¢
- ä½¿ç”¨å¼€æºå·¥å…·jinja2ï¼Œéµå¾ªå…¶æŒ‡å®šè¯­æ³•
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat index.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;&#123;&#123;name&#125;&#125;&lt;&#x2F;h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &#123;% for item in user_list %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123;item&#125;&#125;&lt;&#x2F;li&gt;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &lt;&#x2F;ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">from wsgiref.simple_server import make_server</span><br><span class="line">from jinja2 import Template</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def index():</span><br><span class="line">    # return &#39;index&#39;</span><br><span class="line"> </span><br><span class="line">    # template &#x3D; Template(&#39;Hello &#123;&#123; name &#125;&#125;!&#39;)</span><br><span class="line">    # result &#x3D; template.render(name&#x3D;&#39;John Doe&#39;)</span><br><span class="line"> </span><br><span class="line">    f &#x3D; open(&#39;index.html&#39;)</span><br><span class="line">    result &#x3D; f.read()</span><br><span class="line">    template &#x3D; Template(result)</span><br><span class="line">    data &#x3D; template.render(name&#x3D;&#39;John Doe&#39;, user_list&#x3D;[&#39;alex&#39;, &#39;eric&#39;])</span><br><span class="line">    return data.encode(&#39;utf-8&#39;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def login():</span><br><span class="line">    # return &#39;login&#39;</span><br><span class="line">    f &#x3D; open(&#39;login.html&#39;)</span><br><span class="line">    data &#x3D; f.read()</span><br><span class="line">    return data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def routers():</span><br><span class="line"> </span><br><span class="line">    urlpatterns &#x3D; (</span><br><span class="line">        (&#39;&#x2F;index&#x2F;&#39;, index),</span><br><span class="line">        (&#39;&#x2F;login&#x2F;&#39;, login),</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    return urlpatterns</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def run_server(environ, start_response):</span><br><span class="line">    start_response(&#39;200 OK&#39;, [(&#39;Content-Type&#39;, &#39;text&#x2F;html&#39;)])</span><br><span class="line">    url &#x3D; environ[&#39;PATH_INFO&#39;]</span><br><span class="line">    urlpatterns &#x3D; routers()</span><br><span class="line">    func &#x3D; None</span><br><span class="line">    for item in urlpatterns:</span><br><span class="line">        if item[0] &#x3D;&#x3D; url:</span><br><span class="line">            func &#x3D; item[1]</span><br><span class="line">            break</span><br><span class="line">    if func:</span><br><span class="line">        return func()</span><br><span class="line">    else:</span><br><span class="line">        return &#39;404 not found&#39;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    httpd &#x3D; make_server(&#39;&#39;, 8000, run_server)</span><br><span class="line">    print &quot;Serving HTTP on port 8000...&quot;</span><br><span class="line">    httpd.serve_forever()</span><br></pre></td></tr></table></figure>
éµå¾ªjinja2çš„è¯­æ³•è§„åˆ™ï¼Œå…¶å†…éƒ¨ä¼šå¯¹æŒ‡å®šçš„è¯­æ³•è¿›è¡Œç›¸åº”çš„æ›¿æ¢ï¼Œä»è€Œè¾¾åˆ°åŠ¨æ€çš„è¿”å›å†…å®¹;
å¯¹äºæ¨¡æ¿å¼•æ“çš„æœ¬è´¨ï¼Œå‚è€ƒ: [ç™½è¯tornadoæºç ä¹‹è¤ªå»æ¨¡æ¿å¤–è¡£çš„å‰æˆ](http://www.cnblogs.com/wupeiqi/p/4592637.html)


<p><a href="http://www.cnblogs.com/wupeiqi/articles/5237672.html" target="_blank" rel="noopener">åŸæ–‡</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sçŸ¥è¯†å›¾è°±</title>
    <url>/2020/04/20/k8s%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/</url>
    <content><![CDATA[<p><img src="/2020/04/20/k8s%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/k8s%E5%9B%BE%E8%B0%B1.webp" alt="k8sçŸ¥è¯†å›¾è°±"></p>
<img src="/2020/04/20/k8s%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/k8s%E5%9B%BE%E8%B0%B1.webp" class title="k8sçŸ¥è¯†å›¾è°±">]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxåå‘ä»£ç†WebSocket</title>
    <url>/2020/04/20/nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86WebSocket/</url>
    <content><![CDATA[<h2 id="nginxåå‘ä»£ç†WebSocket"><a href="#nginxåå‘ä»£ç†WebSocket" class="headerlink" title="nginxåå‘ä»£ç†WebSocket"></a>nginxåå‘ä»£ç†WebSocket</h2><p>WebSocketåè®®ç›¸æ¯”è¾ƒäºHTTPåè®®æˆåŠŸæ¡æ‰‹åå¯ä»¥å¤šæ¬¡è¿›è¡Œé€šè®¯ï¼Œç›´åˆ°è¿æ¥è¢«å…³é—­ã€‚ä½†æ˜¯WebSocketä¸­çš„æ¡æ‰‹å’ŒHTTPä¸­çš„æ¡æ‰‹å…¼å®¹ï¼Œ å®ƒä½¿ç”¨HTTPä¸­çš„Upgradeåè®®å¤´å°†è¿æ¥ä»HTTPå‡çº§åˆ°WebSocketã€‚è¿™ä½¿å¾—WebSocketç¨‹åºå¯ä»¥æ›´å®¹æ˜“çš„ä½¿ç”¨ç°å·²å­˜åœ¨çš„åŸºç¡€è®¾æ–½ã€‚</p>
<p>WebSocketå·¥ä½œåœ¨HTTPçš„80å’Œ443ç«¯å£å¹¶ä½¿ç”¨å‰ç¼€ws://æˆ–è€…wss://è¿›è¡Œåè®®æ ‡æ³¨ï¼Œåœ¨å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨HTTP/1.1çš„101çŠ¶æ€ç è¿›è¡Œåè®®åˆ‡æ¢ï¼Œ å½“å‰æ ‡å‡†ä¸æ”¯æŒä¸¤ä¸ªå®¢æˆ·ç«¯ä¹‹é—´ä¸å€ŸåŠ©HTTPç›´æ¥å»ºç«‹Websocketè¿æ¥ã€‚</p>
<p>æ›´å¤šWebsocketçš„ä»‹ç»å¯å‚è€ƒæˆ‘å†™çš„ <a href="https://www.xncoding.com/2017/05/03/web/websocket.html" target="_blank" rel="noopener">èŠä¸€èŠWebSocket</a> ä¸€æ–‡ã€‚</p>
<p>å¼€å‘å°ç¨‹åºçš„æ—¶å€™éœ€è¦ç”¨åˆ°WebSocketé•¿è¿æ¥å’Œæ¨é€æŠ€æœ¯ï¼Œä½†æ˜¯å¿…é¡»ä½¿ç”¨wssï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡åŸŸåè®¿é—®ã€‚è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°nginxåå‘ä»£ç†äº†ã€‚</p>
<p>åŸç†<br>ä¸€èˆ¬æˆ‘ä»¬å¼€å‘çš„WebSocketæœåŠ¡ç¨‹åºä½¿ç”¨wsåè®®ï¼Œæ˜æ–‡çš„ã€‚ä½†æ˜¯æ€æ ·è®©å®ƒå®‰å…¨çš„é€šè¿‡äº’è”ç½‘ä¼ è¾“å‘¢ï¼Ÿè¿™æ—¶å€™å¯ä»¥é€šè¿‡nginxåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç›´æ¥åšä¸€ä¸ªè½¬å‘äº†ï¼Œ å®¢æˆ·ç«¯é€šè¿‡wssè®¿é—®ï¼Œç„¶ånginxå’ŒæœåŠ¡ç«¯é€šè¿‡wsåè®®é€šä¿¡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://note.youdao.com/yws/api/personal/file/WEB872589b7edcbe0044ec1631cab0703d6?method=download&shareKey=efc98eab8e0f8a600ed7c82f9f474976" alt="WS">  </p>
<p>é…ç½®<br>å‰ææ¡ä»¶æ˜¯ä½ æœ‰ä¸€ä¸ªåŸŸåï¼Œå¹¶ä¸”ç”³è¯·å¥½äº†è¯ä¹¦ã€‚</p>
<p>æ–°å»ºnginxé…ç½®æ–‡ä»¶/etc/nginx/conf.d/websocket.confï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &#39;&#39; close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream websocket &#123;</span><br><span class="line">    server localhost:8282; # appserver_ip:ws_port</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">     server_name test.enzhico.net;</span><br><span class="line">     listen 443 ssl;</span><br><span class="line">     location &#x2F; &#123;</span><br><span class="line">         proxy_pass http:&#x2F;&#x2F;websocket;</span><br><span class="line">         proxy_read_timeout 300s;</span><br><span class="line">         proxy_send_timeout 300s;</span><br><span class="line">         </span><br><span class="line">         proxy_set_header Host $host;</span><br><span class="line">         proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">         </span><br><span class="line">         proxy_http_version 1.1;</span><br><span class="line">         proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">         proxy_set_header Connection $connection_upgrade;</span><br><span class="line">     &#125;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;fullchain.pem;</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;privkey.pem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹ç±»è§£é‡Šä¸€ä¸‹å…³é”®é…ç½®éƒ¨åˆ†ï¼š</p>
<p>æœ€é‡è¦çš„å°±æ˜¯åœ¨åå‘ä»£ç†çš„é…ç½®ä¸­å¢åŠ äº†å¦‚ä¸‹ä¸¤è¡Œï¼Œå…¶å®ƒçš„éƒ¨åˆ†å’Œæ™®é€šçš„HTTPåå‘ä»£ç†æ²¡æœ‰ä»»ä½•å·®åˆ«ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection $connection_upgrade;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢çš„å…³é”®éƒ¨åˆ†åœ¨äºHTTPçš„è¯·æ±‚ä¸­å¤šäº†å¦‚ä¸‹å¤´éƒ¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Upgrade: websocket</span><br><span class="line">Connection: Upgrade</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºè¯·æ±‚æœåŠ¡å™¨å‡çº§åè®®ä¸ºWebSocketã€‚æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚åï¼Œå“åº”å¦‚ä¸‹æŠ¥æ–‡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># çŠ¶æ€ç ä¸º101</span><br><span class="line">HTTP&#x2F;1.1 101 Switching Protocols</span><br><span class="line">Upgrade: websocket</span><br><span class="line">Connection: upgrade</span><br></pre></td></tr></table></figure>
<p>å‘Šè¯‰å®¢æˆ·ç«¯å·²æˆåŠŸåˆ‡æ¢åè®®ï¼Œå‡çº§ä¸ºWebsocketåè®®ã€‚æ¡æ‰‹æˆåŠŸä¹‹åï¼ŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¾¿è§’è‰²å¯¹ç­‰ï¼Œå°±åƒæ™®é€šçš„Socketä¸€æ ·ï¼Œèƒ½å¤ŸåŒå‘é€šä¿¡ã€‚ ä¸å†è¿›è¡ŒHTTPçš„äº¤äº’ï¼Œè€Œæ˜¯å¼€å§‹WebSocketçš„æ•°æ®å¸§åè®®å®ç°æ•°æ®äº¤æ¢ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨mapæŒ‡ä»¤å¯ä»¥å°†å˜é‡ç»„åˆæˆä¸ºæ–°çš„å˜é‡ï¼Œä¼šæ ¹æ®å®¢æˆ·ç«¯ä¼ æ¥çš„è¿æ¥ä¸­æ˜¯å¦å¸¦æœ‰Upgradeå¤´æ¥å†³å®šæ˜¯å¦ç»™æºç«™ä¼ é€’Connectionå¤´ï¼Œ è¿™æ ·åšçš„æ–¹æ³•æ¯”ç›´æ¥å…¨éƒ¨ä¼ é€’upgradeæ›´åŠ ä¼˜é›…ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥å°†ä¼šåœ¨æ— æ•°æ®ä¼ è¾“60ç§’åå…³é—­ï¼Œproxy_read_timeoutå‚æ•°å¯ä»¥å»¶é•¿è¿™ä¸ªæ—¶é—´ã€‚æºç«™é€šè¿‡å®šæœŸå‘é€pingå¸§ä»¥ä¿æŒè¿æ¥å¹¶ç¡®è®¤è¿æ¥æ˜¯å¦è¿˜åœ¨ä½¿ç”¨ã€‚</p>
<p>ä¸¤ä¸ªè¶…æ—¶å‚æ•°<br>proxy_read_timeout</p>
<p>è¯­æ³• proxy_read_timeout time é»˜è®¤å€¼ 60s ä¸Šä¸‹æ–‡ http server location è¯´æ˜ è¯¥æŒ‡ä»¤è®¾ç½®ä¸ä»£ç†æœåŠ¡å™¨çš„è¯»è¶…æ—¶æ—¶é—´ã€‚å®ƒå†³å®šäº†nginxä¼šç­‰å¾…å¤šé•¿æ—¶é—´æ¥è·å¾—è¯·æ±‚çš„å“åº”ã€‚ è¿™ä¸ªæ—¶é—´ä¸æ˜¯è·å¾—æ•´ä¸ªresponseçš„æ—¶é—´ï¼Œè€Œæ˜¯ä¸¤æ¬¡readingæ“ä½œçš„æ—¶é—´ã€‚</p>
<p>proxy_send_timeout</p>
<p>è¯­æ³• proxy_send_timeout time é»˜è®¤å€¼ 60s ä¸Šä¸‹æ–‡ http server location è¯´æ˜ è¿™ä¸ªæŒ‡å®šè®¾ç½®äº†å‘é€è¯·æ±‚ç»™upstreamæœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´ã€‚è¶…æ—¶è®¾ç½®ä¸æ˜¯ä¸ºäº†æ•´ä¸ªå‘é€æœŸé—´ï¼Œè€Œæ˜¯åœ¨ä¸¤æ¬¡writeæ“ä½œæœŸé—´ã€‚ å¦‚æœè¶…æ—¶åï¼Œupstreamæ²¡æœ‰æ”¶åˆ°æ–°çš„æ•°æ®ï¼Œnginxä¼šå…³é—­è¿æ¥</p>
<p>å¤šæ¬¡ä»£ç†è½¬å‘<br>å·¥ä½œä¸­é‡è§è¿‡ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æŸä¸ªåŸŸååœ¨ç§»åŠ¨ç½‘ç»œä¸‹é¢è®¿é—®ä¸äº†ï¼Œè¿™æ ·çš„è¯æˆ‘éœ€è¦é€šè¿‡ä¸€ä¸ªå‰æ®µä»£ç†æœåŠ¡å™¨åšè½¬å‘ï¼Œè¿™æ ·å°±æ¶‰åŠåˆ°ä¸¤æ¬¡ä»£ç†ã€‚</p>
<p>æ¯”å¦‚è®¿é—®çš„websocketæœåŠ¡URLä¸ºï¼š</p>
<p>wss://test.enzhico.net<br>è¿™ä¸ªåœ¨è…¾è®¯äº‘å…¬ç½‘IPä¸Šé¢ï¼Œæ‰€æœ‰ç½‘ç»œéƒ½èƒ½è®¿é—®ã€‚å¦å¤–ä¸€ä¸ªåŸŸåboard.xncoding.comè§£æåˆ°ç”µä¿¡ç½‘ç»œï¼Œéƒ¨ç½²åœ¨ç½‘å…³ä¸­å¿ƒï¼Œè¿™ä¸ªåŸŸåè…¾è®¯äº‘å¯ä»¥è®¿é—®åˆ°ã€‚</p>
<p>åœ¨è…¾è®¯äº‘ä¸»æœºä¸Šé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &#39;&#39; close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">     server_name test.enzhico.net;</span><br><span class="line">     location &#x2F; &#123;</span><br><span class="line">         proxy_pass http:&#x2F;&#x2F;board.xncoding.com;</span><br><span class="line">         proxy_read_timeout 300s;</span><br><span class="line">         proxy_send_timeout 300s;</span><br><span class="line">         #proxy_set_header Host $host;</span><br><span class="line">         proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">         proxy_http_version 1.1;</span><br><span class="line">         proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">         proxy_set_header Connection $connection_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line">    listen 443 ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;privkey.pem; # managed by Certbot</span><br><span class="line">    include &#x2F;etc&#x2F;letsencrypt&#x2F;options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam &#x2F;etc&#x2F;letsencrypt&#x2F;ssl-dhparams.pem; # managed by Certbot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŠŠproxy_set_header Host $host;è¿™ä¸€è¡Œæ³¨é‡Šæ‰äº†ã€‚</p>
<p>è€Œåœ¨ç½‘å…³ä¸­å¿ƒä¸»æœºä¸Šé¢ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &#39;&#39; close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream websocket &#123;</span><br><span class="line">    server localhost:8282; # appserver_ip:ws_port</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name board.xncoding.com;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;websocket;</span><br><span class="line">        proxy_read_timeout 300s;</span><br><span class="line">        proxy_send_timeout 300s;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åªéœ€è¦æœ€å¤–å±‚ä½¿ç”¨wssåè®®ï¼Œé‡Œé¢çš„äº¤äº’éƒ½ä½¿ç”¨wsåè®®ï¼Œæ‰€ä»¥ç›‘å¬80ç«¯å£å³å¯ã€‚</p>
<p><a href="https://www.xncoding.com/2018/03/12/fullstack/nginx-websocket.html#more" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a>  </p>
<p>å‚è€ƒ<br><a href="http://pankajmalhotra.com/Websockets-SSL-TLS-Termination-Using-NGINX-Proxy" target="_blank" rel="noopener">Websockets SSL/TLS Termination Using NGINX Proxy</a><br><a href="https://www.hi-linux.com/posts/42176.html" target="_blank" rel="noopener">é…ç½®Nginxåå‘ä»£ç†WebSocket</a></p>
]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>ansible api of python</title>
    <url>/2020/04/20/ansible-api-of-python/</url>
    <content><![CDATA[<h2 id="ansible-api-for-python"><a href="#ansible-api-for-python" class="headerlink" title="ansible api for python"></a>ansible api for python</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: anisible-exec-api.py</span><br><span class="line">@time: 2019&#x2F;10&#x2F;28 14:56</span><br><span class="line">@contact: shu_ke163@163.com</span><br><span class="line">@software:  deploy-system</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">import shutil</span><br><span class="line">from collections import namedtuple</span><br><span class="line">from ansible.parsing.dataloader import DataLoader</span><br><span class="line">from ansible.vars.manager import VariableManager</span><br><span class="line">from ansible.inventory.manager import InventoryManager</span><br><span class="line">from ansible.playbook.play import Play</span><br><span class="line">from ansible.executor.task_queue_manager import TaskQueueManager</span><br><span class="line">from ansible.executor.playbook_executor import PlaybookExecutor</span><br><span class="line">from ansible.executor.task_executor import TaskExecutor</span><br><span class="line">from ansible.plugins.callback import CallbackBase</span><br><span class="line">import ansible.constants as C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ResultCallback(CallbackBase):</span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        # super(ResultsCollector, self).__init__(*args, **kwargs)</span><br><span class="line">        self.host_ok &#x3D; &#123;&#125;</span><br><span class="line">        self.host_unreachable &#x3D; &#123;&#125;</span><br><span class="line">        self.host_failed &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        self.host_unreachable[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, *args, **kwargs):</span><br><span class="line">        self.host_ok[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        self.host_failed[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AnsibleApi(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.Options &#x3D; namedtuple(&#39;Options&#39;,</span><br><span class="line">                                  [&#39;connection&#39;,</span><br><span class="line">                                   &#39;remote_user&#39;,</span><br><span class="line">                                   &#39;ask_sudo_pass&#39;,</span><br><span class="line">                                   &#39;verbosity&#39;,</span><br><span class="line">                                   &#39;ack_pass&#39;,</span><br><span class="line">                                   &#39;module_path&#39;,</span><br><span class="line">                                   &#39;forks&#39;,</span><br><span class="line">                                   &#39;become&#39;,</span><br><span class="line">                                   &#39;become_method&#39;,</span><br><span class="line">                                   &#39;become_user&#39;,</span><br><span class="line">                                   &#39;check&#39;,</span><br><span class="line">                                   &#39;listhosts&#39;,</span><br><span class="line">                                   &#39;listtasks&#39;,</span><br><span class="line">                                   &#39;listtags&#39;,</span><br><span class="line">                                   &#39;syntax&#39;,</span><br><span class="line">                                   &#39;sudo_user&#39;,</span><br><span class="line">                                   &#39;sudo&#39;,</span><br><span class="line">                                   &#39;diff&#39;])</span><br><span class="line"></span><br><span class="line">        self.ops &#x3D; self.Options(connection&#x3D;&#39;local&#39;,</span><br><span class="line">                                remote_user&#x3D;None,</span><br><span class="line">                                ack_pass&#x3D;None,</span><br><span class="line">                                sudo_user&#x3D;None,</span><br><span class="line">                                forks&#x3D;50,</span><br><span class="line">                                sudo&#x3D;None,</span><br><span class="line">                                ask_sudo_pass&#x3D;False,</span><br><span class="line">                                verbosity&#x3D;5,</span><br><span class="line">                                module_path&#x3D;None,</span><br><span class="line">                                become&#x3D;None,</span><br><span class="line">                                become_method&#x3D;None,</span><br><span class="line">                                become_user&#x3D;None,</span><br><span class="line">                                check&#x3D;False,</span><br><span class="line">                                diff&#x3D;False,</span><br><span class="line">                                listhosts&#x3D;None,</span><br><span class="line">                                listtasks&#x3D;None,</span><br><span class="line">                                listtags&#x3D;None,</span><br><span class="line">                                syntax&#x3D;None)</span><br><span class="line"></span><br><span class="line">        self.loader &#x3D; DataLoader()</span><br><span class="line">        self.passwords &#x3D; dict()</span><br><span class="line">        self.results_callback &#x3D; ResultCallback()</span><br><span class="line">        self.inventory &#x3D; InventoryManager(loader&#x3D;self.loader,</span><br><span class="line">                                          sources&#x3D;[&#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;rcx_rce.deploy&#x2F;playbook&#x2F;inventory&#x2F;rcx&#x2F;hosts.ini&#39;])</span><br><span class="line">        self.variable_manager &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;self.inventory)</span><br><span class="line"></span><br><span class="line">    def runansible(self, host_list, task_list):</span><br><span class="line"></span><br><span class="line">        play_source &#x3D; dict(</span><br><span class="line">            name&#x3D;&quot;Ansible Play&quot;,</span><br><span class="line">            hosts&#x3D;host_list,</span><br><span class="line">            gather_facts&#x3D;&#39;no&#39;,</span><br><span class="line">            tasks&#x3D;task_list</span><br><span class="line">        )</span><br><span class="line">        play &#x3D; Play().load(play_source, variable_manager&#x3D;self.variable_manager, loader&#x3D;self.loader)</span><br><span class="line"></span><br><span class="line">        tqm &#x3D; None</span><br><span class="line">        try:</span><br><span class="line">            tqm &#x3D; TaskQueueManager(</span><br><span class="line">                inventory&#x3D;self.inventory,</span><br><span class="line">                variable_manager&#x3D;self.variable_manager,</span><br><span class="line">                loader&#x3D;self.loader,</span><br><span class="line">                passwords&#x3D;self.passwords,</span><br><span class="line">                stdout_callback&#x3D;self.results_callback,</span><br><span class="line">                run_tree&#x3D;False,</span><br><span class="line">            )</span><br><span class="line">            result &#x3D; tqm.run(play)</span><br><span class="line">        finally:</span><br><span class="line">            if tqm is not None:</span><br><span class="line">                tqm.cleanup()</span><br><span class="line">            shutil.rmtree(C.DEFAULT_LOCAL_TMP, True)</span><br><span class="line"></span><br><span class="line">        results_raw &#x3D; &#123;&#125;</span><br><span class="line">        results_raw[&#39;success&#39;] &#x3D; &#123;&#125;</span><br><span class="line">        results_raw[&#39;failed&#39;] &#x3D; &#123;&#125;</span><br><span class="line">        results_raw[&#39;unreachable&#39;] &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        for host, result in self.results_callback.host_ok.items():</span><br><span class="line">            results_raw[&#39;success&#39;][host] &#x3D; json.dumps(result._result)</span><br><span class="line"></span><br><span class="line">        for host, result in self.results_callback.host_failed.items():</span><br><span class="line">            results_raw[&#39;failed&#39;][host] &#x3D; result._result[&#39;msg&#39;]</span><br><span class="line"></span><br><span class="line">        for host, result in self.results_callback.host_unreachable.items():</span><br><span class="line">            results_raw[&#39;unreachable&#39;][host] &#x3D; result._result[&#39;msg&#39;]</span><br><span class="line"></span><br><span class="line">        print(results_raw)</span><br><span class="line"></span><br><span class="line">    def playbookrun(self, playbook_path):</span><br><span class="line"></span><br><span class="line">        self.variable_manager.extra_vars &#x3D; &#123;&#39;customer&#39;: &#39;test&#39;, &#39;disabled&#39;: &#39;yes&#39;&#125;</span><br><span class="line">        playbook &#x3D; PlaybookExecutor(playbooks&#x3D;playbook_path,</span><br><span class="line">                                    inventory&#x3D;self.inventory,</span><br><span class="line">                                    variable_manager&#x3D;self.variable_manager,</span><br><span class="line">                                    loader&#x3D;self.loader, passwords&#x3D;self.passwords)</span><br><span class="line">        result &#x3D; playbook.run()</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    a &#x3D; AnsibleApi()</span><br><span class="line">    host_list &#x3D; [&#39;all&#39;]</span><br><span class="line">    tasks_list &#x3D; [</span><br><span class="line">        dict(action&#x3D;dict(module&#x3D;&#39;setup&#39;, )),</span><br><span class="line">    ]</span><br><span class="line">    a.runansible(host_list, tasks_list)</span><br><span class="line">    # a.playbookrun(playbook_path&#x3D;[&#39;&#x2F;home&#x2F;jenkins&#x2F;python_script&#x2F;collect_data.yml&#39;])</span><br></pre></td></tr></table></figure>


<h2 id="example2"><a href="#example2" class="headerlink" title="example2"></a>example2</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@aythor: shuke</span><br><span class="line">@file: ansible_api_v2.py </span><br><span class="line">@content: zhaofengfeng@rongcloud.cn</span><br><span class="line">@time: 2020&#x2F;03&#x2F;10 09:46</span><br><span class="line">@software:  Door</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import re</span><br><span class="line">import json</span><br><span class="line">import logging</span><br><span class="line">import datetime</span><br><span class="line">import shutil</span><br><span class="line">from ansible import constants as C</span><br><span class="line">from collections import namedtuple</span><br><span class="line">from ansible.parsing.dataloader import DataLoader</span><br><span class="line">from ansible.playbook.play import Play</span><br><span class="line">from ansible.executor.task_queue_manager import TaskQueueManager</span><br><span class="line">from ansible.executor.playbook_executor import PlaybookExecutor</span><br><span class="line">from ansible.plugins.callback import CallbackBase</span><br><span class="line">from ansible.inventory.manager import InventoryManager</span><br><span class="line">from ansible.vars.manager import VariableManager</span><br><span class="line">from ansible.inventory.host import Host</span><br><span class="line">from ansible.parsing.ajson import AnsibleJSONEncoder</span><br><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line">PATH &#x3D; os.path.dirname(os.path.dirname(os.path.realpath(__file__)))</span><br><span class="line">sys.path.insert(0, PATH)</span><br><span class="line">#</span><br><span class="line"># os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;Door.settings&quot;)</span><br><span class="line">#</span><br><span class="line"># import django</span><br><span class="line">#</span><br><span class="line"># django.setup()</span><br><span class="line"></span><br><span class="line"># from apps.host.models import Cmdb</span><br><span class="line"></span><br><span class="line">logger &#x3D; logging.getLogger(&quot;door&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def current_time():</span><br><span class="line">    return &#39;%sZ&#39; % datetime.datetime.utcnow().isoformat()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class CallbackModule(CallbackBase):</span><br><span class="line">    CALLBACK_VERSION &#x3D; 2.0</span><br><span class="line">    CALLBACK_TYPE &#x3D; &#39;stdout&#39;</span><br><span class="line">    CALLBACK_NAME &#x3D; &#39;tomysql&#39;</span><br><span class="line"></span><br><span class="line">    def __init__(self, display&#x3D;None):</span><br><span class="line">        super(CallbackModule, self).__init__(display)</span><br><span class="line">        self.results &#x3D; []</span><br><span class="line"></span><br><span class="line">    def _new_play(self, play):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;play&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: play.get_name(),</span><br><span class="line">                &#39;id&#39;: str(play._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;tasks&#39;: []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def _new_task(self, task):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;task&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: task.get_name(),</span><br><span class="line">                &#39;id&#39;: str(task._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;hosts&#39;: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, **kwargs):</span><br><span class="line">        hostname &#x3D; result._host.get_name()</span><br><span class="line">        logger.info(f&quot;ansible v2_runner_on_ok hostname: &#123;hostname&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            host &#x3D; result._result[&quot;ansible_facts&quot;]</span><br><span class="line"></span><br><span class="line">            host_info &#x3D; &#123;&#125;</span><br><span class="line">            host_info[&quot;hostname&quot;] &#x3D; hostname</span><br><span class="line">            host_info[&quot;fqdn&quot;] &#x3D; host.get(&quot;ansible_fqdn&quot;, None)</span><br><span class="line">            host_info[&quot;cpu&quot;] &#x3D; str(host.get(&quot;ansible_processor_vcpus&quot;, None)) + &quot;c&quot;</span><br><span class="line">            host_info[&quot;memory&quot;] &#x3D; str(round(host.get(&quot;ansible_memtotal_mb&quot;) &#x2F; 1024) + 1) + &quot; GB&quot;</span><br><span class="line">            host_info[&quot;disk&quot;] &#x3D; host.get(&quot;ansible_devices&quot;)[&quot;vda&quot;][&quot;size&quot;]</span><br><span class="line">            host_info[&quot;disk_format&quot;] &#x3D; host.get(&quot;ansible_mounts&quot;)[0][&quot;fstype&quot;]</span><br><span class="line">            host_info[&quot;mount_point&quot;] &#x3D; host.get(&quot;ansible_mounts&quot;)[0][&quot;mount&quot;]</span><br><span class="line">            host_info[&quot;ipv4&quot;] &#x3D; host.get(&quot;ansible_default_ipv4&quot;)[&quot;address&quot;]</span><br><span class="line">            host_info[&quot;arch&quot;] &#x3D; host.get(&quot;ansible_architecture&quot;, None)</span><br><span class="line">            host_info[&quot;os_type&quot;] &#x3D; host.get(&quot;ansible_distribution&quot;, None)</span><br><span class="line">            host_info[&quot;os_version&quot;] &#x3D; host.get(&quot;ansible_distribution_version&quot;, None)</span><br><span class="line">            host_info[&quot;machine_id&quot;] &#x3D; host.get(&quot;ansible_machine_id&quot;, None)</span><br><span class="line">            host_info[&quot;macaddress&quot;] &#x3D; host.get(&quot;ansible_default_ipv4&quot;)[&quot;macaddress&quot;]</span><br><span class="line">            host_info[&quot;kernel_info&quot;] &#x3D; host.get(&quot;ansible_kernel&quot;, None)</span><br><span class="line">            host_info[&quot;virtualization_type&quot;] &#x3D; host.get(&quot;ansible_virtualization_type&quot;, None)</span><br><span class="line"></span><br><span class="line">            import json</span><br><span class="line">            print(json.dumps(host_info, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line"></span><br><span class="line">            # models.Cmdb.objects.get_or_create(host_info)</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(f&quot;get ansible facts result faild: &#123;e.__class__.__name__&#125;: &#123;e&#125;&quot;)</span><br><span class="line">            raise Exception(&quot;&#123;hostname&#125; already exist&quot;.format(hostname&#x3D;hostname))</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        logger.info(&quot;unreachable host: %s&quot; % result._host.get_name())</span><br><span class="line">        self.host_unreachable[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        # print(result.__dict__)</span><br><span class="line">        logger.info(&quot;ä¸»æœºæ‰§è¡Œå¤±è´¥: &quot;.format(result._host.get_name()))</span><br><span class="line">        self.results.append(&#123;result._host.get_name(): result&#125;)</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_play_start(self, play):</span><br><span class="line">        self.results.append(self._new_play(play))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_handler_task_start(self, task):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def _convert_host_to_name(self, key):</span><br><span class="line">        if isinstance(key, (Host,)):</span><br><span class="line">            return key.get_name()</span><br><span class="line">        return key</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_stats(self, stats):</span><br><span class="line">        &quot;&quot;&quot;Display info about playbook statistics&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        hosts &#x3D; sorted(stats.processed.keys())</span><br><span class="line"></span><br><span class="line">        summary &#x3D; &#123;&#125;</span><br><span class="line">        for h in hosts:</span><br><span class="line">            s &#x3D; stats.summarize(h)</span><br><span class="line">            summary[h] &#x3D; s</span><br><span class="line"></span><br><span class="line">        custom_stats &#x3D; &#123;&#125;</span><br><span class="line">        global_custom_stats &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        if self.get_option(&#39;show_custom_stats&#39;) and stats.custom:</span><br><span class="line">            custom_stats.update(dict((self._convert_host_to_name(k), v) for k, v in stats.custom.items()))</span><br><span class="line">            global_custom_stats.update(custom_stats.pop(&#39;_run&#39;, &#123;&#125;))</span><br><span class="line"></span><br><span class="line">        output &#x3D; &#123;</span><br><span class="line">            &#39;plays&#39;: self.results,</span><br><span class="line">            &#39;stats&#39;: summary,</span><br><span class="line">            &#39;custom_stats&#39;: custom_stats,</span><br><span class="line">            &#39;global_custom_stats&#39;: global_custom_stats,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self._display.display(json.dumps(output, cls&#x3D;AnsibleJSONEncoder, indent&#x3D;4, sort_keys&#x3D;True))</span><br><span class="line"></span><br><span class="line">    def _record_task_result(self, on_info, result, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;This function is used as a partial to add failed&#x2F;skipped info in a single method&quot;&quot;&quot;</span><br><span class="line">        host &#x3D; result._host</span><br><span class="line">        task &#x3D; result._task</span><br><span class="line">        task_result &#x3D; result._result.copy()</span><br><span class="line">        task_result.update(on_info)</span><br><span class="line">        task_result[&#39;action&#39;] &#x3D; task.action</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;hosts&#39;][host.name] &#x3D; task_result</span><br><span class="line">        end_time &#x3D; current_time()</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;task&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line">        self.results[-1][&#39;play&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line"></span><br><span class="line">    # def __getattribute__(self, name):</span><br><span class="line">    #     &quot;&quot;&quot;Return &#96;&#96;_record_task_result&#96;&#96; partial with a dict containing skipped&#x2F;failed if necessary&quot;&quot;&quot;</span><br><span class="line">    #     if name not in (&#39;v2_runner_on_ok&#39;, &#39;v2_runner_on_failed&#39;, &#39;v2_runner_on_unreachable&#39;, &#39;v2_runner_on_skipped&#39;):</span><br><span class="line">    #         return object.__getattribute__(self, name)</span><br><span class="line">    #</span><br><span class="line">    #     on &#x3D; name.rsplit(&#39;_&#39;, 1)[1]</span><br><span class="line">    #</span><br><span class="line">    #     on_info &#x3D; &#123;&#125;</span><br><span class="line">    #     if on in (&#39;failed&#39;, &#39;skipped&#39;):</span><br><span class="line">    #         on_info[on] &#x3D; True</span><br><span class="line">    #</span><br><span class="line">    #     # logger.info(&quot;Event: &#123;name&#125;, Task status: &#123;status&#125;&quot;.format(name&#x3D;name, status&#x3D;on))</span><br><span class="line">    #     return partial(self._record_task_result, on_info)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DeployResultsCollector(CallbackBase):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç›´æ¥æ‰§è¡Œæ¨¡å—å‘½ä»¤çš„å›è°ƒç±»</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, sock, send_msg, *args, **kwargs):</span><br><span class="line">        super(DeployResultsCollector, self).__init__(*args, **kwargs)</span><br><span class="line">        self.sock &#x3D; sock</span><br><span class="line">        self.send_msg &#x3D; send_msg</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        if &#39;msg&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;ä¸»æœº&#123;host&#125;ä¸å¯è¾¾ï¼&#x3D;&#x3D;&gt; &#123;stdout&#125;\nå‰”é™¤è¯¥ä¸»æœº!\n&#39;.format(host&#x3D;result._host.name, stdout&#x3D;result._result.get(&#39;msg&#39;))</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;ä¸»æœº&#123;host&#125;ä¸å¯è¾¾ï¼&#x3D;&#x3D;&gt; &#123;stdout&#125;\nå‰”é™¤è¯¥ä¸»æœº!\n&#39;.format(host&#x3D;result._host.name,</span><br><span class="line">                                                               stdout&#x3D;json.dumps(result._result, indent&#x3D;4))</span><br><span class="line"></span><br><span class="line">        self.chk_host_list(data, result._host.name)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, *args, **kwargs):</span><br><span class="line">        data &#x3D; &#39;ä¸»æœº&#123;host&#125;æ‰§è¡Œä»»åŠ¡æˆåŠŸï¼\n&#39;.format(host&#x3D;result._host.name)</span><br><span class="line">        self.sock.send_save(data, send&#x3D;self.send_msg)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        if &#39;stderr&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;p style&#x3D;&quot;color: #FF0000&quot;&gt;\nä¸»æœº&#123;host&#125;æ‰§è¡Œä»»åŠ¡å¤±è´¥ &#x3D;&#x3D;&gt; &#123;stdout&#125;\nå‰”é™¤è¯¥ä¸»æœºï¼&lt;&#x2F;p&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, stdout&#x3D;result._result.get(&#39;stderr&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        elif &#39;msg&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;p style&#x3D;&quot;color: #FF0000&quot;&gt;\nä¸»æœº&#123;host&#125;æ‰§è¡Œä»»åŠ¡å¤±è´¥ &#x3D;&#x3D;&gt; &#123;stdout&#125;\nå‰”é™¤è¯¥ä¸»æœºï¼&lt;&#x2F;p&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, stdout&#x3D;result._result.get(&#39;msg&#39;))</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;&lt;p style&#x3D;&quot;color: #FF0000&quot;&gt;\nä¸»æœº&#123;host&#125;æ‰§è¡Œä»»åŠ¡å¤±è´¥ &#x3D;&#x3D;&gt; &#123;stdout&#125;\nå‰”é™¤è¯¥ä¸»æœºï¼&lt;&#x2F;p&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, stdout&#x3D;json.dumps(result._result, indent&#x3D;4))</span><br><span class="line">        self.chk_host_list(data, result._host.name)</span><br><span class="line"></span><br><span class="line">    def chk_host_list(self, data, host):</span><br><span class="line">        self.sock.send_save(data, send&#x3D;self.send_msg)</span><br><span class="line">        self.sock.host_list.remove(host)</span><br><span class="line">        self.sock.host_fail.append(host)</span><br><span class="line">        if len(self.sock.host_list) &#x3D;&#x3D; 0:</span><br><span class="line">            self.sock.send(&#39;&lt;p style&#x3D;&quot;color: #FF0000&quot;&gt;æ‰€æœ‰ä¸»æœºå‡éƒ¨ç½²å¤±è´¥ï¼é€€å‡ºéƒ¨ç½²æµç¨‹ï¼&lt;&#x2F;p&gt;&#39;, close&#x3D;True)</span><br><span class="line">            self.sock.deploy_results.append(&#39;&lt;p style&#x3D;&quot;color: #FF0000&quot;&gt;æ‰€æœ‰ä¸»æœºå‡éƒ¨ç½²å¤±è´¥ï¼é€€å‡ºéƒ¨ç½²æµç¨‹ï¼&lt;&#x2F;p&gt;&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ModuleResultsCollector(CallbackBase):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç›´æ¥æ‰§è¡Œæ¨¡å—å‘½ä»¤çš„å›è°ƒç±»</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, sock&#x3D;None, *args, **kwargs):</span><br><span class="line">        super(ModuleResultsCollector, self).__init__(*args, **kwargs)</span><br><span class="line">        self.module_results &#x3D; []</span><br><span class="line">        self.sock &#x3D; sock</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        if &#39;msg&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;\n&#123;host&#125; | unreachable | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;msg&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;\n&#123;host&#125; | unreachable &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name,</span><br><span class="line">                stdout&#x3D;json.dumps(result._result, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line">        if self.sock:</span><br><span class="line">            self.sock.send(data)</span><br><span class="line">        self.module_results.append(data)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, *args, **kwargs):</span><br><span class="line"></span><br><span class="line">        if &#39;rc&#39; in result._result and &#39;stdout&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #008000&quot;&gt;\n&#123;host&#125; | success | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;stdout&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        elif &#39;results&#39; in result._result and &#39;rc&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #008000&quot;&gt;\n&#123;host&#125; | success | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;results&#39;)[0].encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        elif &#39;module_stdout&#39; in result._result and &#39;rc&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #008000&quot;&gt;\n&#123;host&#125; | success | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name, rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;module_stdout&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #008000&quot;&gt;\n&#123;host&#125; | success &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name,</span><br><span class="line">                stdout&#x3D;json.dumps(result._result, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line">        if self.sock:</span><br><span class="line">            self.sock.send(data)</span><br><span class="line">        self.module_results.append(data)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        if &#39;stderr&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;\n&#123;host&#125; | failed | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name,</span><br><span class="line">                rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;stderr&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        elif &#39;module_stdout&#39; in result._result:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;\n&#123;host&#125; | failed | rc&#x3D;&#123;rc&#125; &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name,</span><br><span class="line">                rc&#x3D;result._result.get(&#39;rc&#39;),</span><br><span class="line">                stdout&#x3D;result._result.get(&#39;module_stdout&#39;).encode().decode(&#39;utf-8&#39;))</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;\n&#123;host&#125; | failed &gt;&gt; \n&#123;stdout&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                host&#x3D;result._host.name,</span><br><span class="line">                stdout&#x3D;json.dumps(result._result, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line">        if self.sock:</span><br><span class="line">            self.sock.send(data)</span><br><span class="line">        self.module_results.append(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PlayBookResultsCollector(CallbackBase):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ‰§è¡Œplaybookçš„å›è°ƒç±»</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, sock, *args, **kwargs):</span><br><span class="line">        super(PlayBookResultsCollector, self).__init__(*args, **kwargs)</span><br><span class="line">        self.playbook_results &#x3D; []</span><br><span class="line">        self.sock &#x3D; sock</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_play_start(self, play):</span><br><span class="line">        name &#x3D; play.get_name().strip()</span><br><span class="line">        if not name:</span><br><span class="line">            msg &#x3D; format(&#39;&lt;code style&#x3D;&quot;color: #FFFFFF&quot;&gt;\nPLAY&#39;, &#39;*&lt;150&#39;) + &#39; \n&lt;&#x2F;code&gt;&#39;</span><br><span class="line">        else:</span><br><span class="line">            msg &#x3D; format(f&#39;&lt;code style&#x3D;&quot;color: #FFFFFF&quot;&gt;\nPLAY [&#123;name&#125;]&#39;, &#39;*&lt;150&#39;) + &#39; \n&lt;&#x2F;code&gt;&#39;</span><br><span class="line">        self.send_save(msg)</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class="line">        msg &#x3D; format(f&#39;&lt;code style&#x3D;&quot;color: #FFFFFF&quot;&gt;\nTASK [&#123;task.get_name()&#125;]&#39;, &#39;*&lt;150&#39;) + &#39; \n&lt;&#x2F;code&gt;&#39;</span><br><span class="line">        self.send_save(msg)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, *args, **kwargs):</span><br><span class="line">        if result.is_changed():</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FFFF00&quot;&gt;[&#123;&#125;]&#x3D;&gt; changed\n&lt;&#x2F;code&gt;&#39;.format(result._host.name)</span><br><span class="line">        else:</span><br><span class="line">            data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #008000&quot;&gt;[&#123;&#125;]&#x3D;&gt; ok\n&lt;&#x2F;code&gt;&#39;.format(result._host.name)</span><br><span class="line">        self.send_save(data)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        if &#39;changed&#39; in result._result:</span><br><span class="line">            del result._result[&#39;changed&#39;]</span><br><span class="line">        data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;[&#123;&#125;]&#x3D;&gt; &#123;&#125;: &#123;&#125;\n&lt;&#x2F;code&gt;&#39;.format(result._host.name, &#39;failed&#39;,</span><br><span class="line">                                                                            self._dump_results(result._result))</span><br><span class="line">        self.send_save(data)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        if &#39;changed&#39; in result._result:</span><br><span class="line">            del result._result[&#39;changed&#39;]</span><br><span class="line">        data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FF0000&quot;&gt;[&#123;&#125;]&#x3D;&gt; &#123;&#125;: &#123;&#125;\n&lt;&#x2F;code&gt;&#39;.format(result._host.name, &#39;unreachable&#39;,</span><br><span class="line">                                                                            self._dump_results(result._result))</span><br><span class="line">        self.send_save(data)</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_skipped(self, result):</span><br><span class="line">        if &#39;changed&#39; in result._result:</span><br><span class="line">            del result._result[&#39;changed&#39;]</span><br><span class="line">        data &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FFFF00&quot;&gt;[&#123;&#125;]&#x3D;&gt; &#123;&#125;: &#123;&#125;\n&lt;&#x2F;code&gt;&#39;.format(result._host.name, &#39;skipped&#39;,</span><br><span class="line">                                                                            self._dump_results(result._result))</span><br><span class="line">        self.send_save(data)</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_stats(self, stats):</span><br><span class="line">        hosts &#x3D; sorted(stats.processed.keys())</span><br><span class="line">        data &#x3D; format(&#39;&lt;code style&#x3D;&quot;color: #FFFFFF&quot;&gt;\nPLAY RECAP &#39;, &#39;*&lt;150&#39;) + &#39;\n&#39;</span><br><span class="line">        self.send_save(data)</span><br><span class="line">        for h in hosts:</span><br><span class="line">            s &#x3D; stats.summarize(h)</span><br><span class="line">            msg &#x3D; &#39;&lt;code style&#x3D;&quot;color: #FFFFFF&quot;&gt;&#123;&#125; : ok&#x3D;&#123;&#125; changed&#x3D;&#123;&#125; unreachable&#x3D;&#123;&#125; failed&#x3D;&#123;&#125; skipped&#x3D;&#123;&#125;\n&lt;&#x2F;code&gt;&#39;.format(</span><br><span class="line">                h, s[&#39;ok&#39;], s[&#39;changed&#39;], s[&#39;unreachable&#39;], s[&#39;failures&#39;], s[&#39;skipped&#39;])</span><br><span class="line">            self.send_save(msg)</span><br><span class="line"></span><br><span class="line">    def send_save(self, data):</span><br><span class="line">        self.sock.send(data)</span><br><span class="line">        self.playbook_results.append(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyInventory(InventoryManager):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç”¨äºåŠ¨æ€ç”ŸæˆInventoryçš„ç±».</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, loader, resource&#x3D;None, sources&#x3D;None):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        resourceçš„æ•°æ®æ ¼å¼æ˜¯ä¸€ä¸ªåˆ—è¡¨å­—å…¸ï¼Œæ¯”å¦‚</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;group1&quot;: &#123;</span><br><span class="line">                    &quot;hosts&quot;: [&#123;&quot;ip&quot;: &quot;10.0.0.0&quot;, &quot;port&quot;: &quot;22&quot;, &quot;username&quot;: &quot;test&quot;, &quot;password&quot;: &quot;pass&quot;&#125;, ...],</span><br><span class="line">                    &quot;group_vars&quot;: &#123;&quot;var1&quot;: value1, &quot;var2&quot;: value2, ...&#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">             å¦‚æœä½ åªä¼ å…¥1ä¸ªåˆ—è¡¨ï¼Œè¿™é»˜è®¤è¯¥åˆ—è¡¨å†…çš„æ‰€æœ‰ä¸»æœºå±äºdefault ç»„,æ¯”å¦‚</span><br><span class="line">            [&#123;&quot;ip&quot;: &quot;10.0.0.0&quot;, &quot;port&quot;: &quot;22&quot;, &quot;username&quot;: &quot;test&quot;, &quot;password&quot;: &quot;pass&quot;&#125;, ...]</span><br><span class="line">        sourcesæ˜¯åŸç”Ÿçš„æ–¹æ³•ï¼Œå‚æ•°æ˜¯é…ç½®çš„inventoryæ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥ä»¥åˆ—è¡¨çš„å½¢å¼å¯ä»¥æŒ‡å®šå¤šä¸ª</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        super(MyInventory, self).__init__(loader&#x3D;loader, sources&#x3D;sources)</span><br><span class="line">        self.resource &#x3D; resource</span><br><span class="line">        self.dynamic_inventory()</span><br><span class="line"></span><br><span class="line">    def add_dynamic_group(self, hosts, group_name, group_vars&#x3D;None):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å°†ä»æ•°æ®åº“è¯»å–çš„ç»„ä¿¡æ¯ï¼Œä¸»æœºä¿¡æ¯ç­‰ç”Ÿæˆçš„resourceä¿¡æ¯è§£ææˆansibleå¯ä»¥è¯»å–çš„å†…å®¹</span><br><span class="line">        :param hosts: åŒ…å«ä¸»æœºæ‰€æœ‰ä¿¡æ¯çš„çš„åˆ—è¡¨</span><br><span class="line">        :type hosts: list</span><br><span class="line">        :param group_name:</span><br><span class="line">        :param group_vars:</span><br><span class="line">        :type group_vars: dict</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # æ·»åŠ ä¸»æœºç»„</span><br><span class="line">        self.add_group(group_name)</span><br><span class="line"></span><br><span class="line">        # æ·»åŠ ä¸»æœºç»„å˜é‡</span><br><span class="line">        if group_vars:</span><br><span class="line">            for key, value in group_vars.items():</span><br><span class="line">                self.groups[group_name].set_variable(key, value)</span><br><span class="line"></span><br><span class="line">        for host in hosts:</span><br><span class="line">            ip &#x3D; host.get(&#39;ip&#39;)</span><br><span class="line">            port &#x3D; host.get(&#39;port&#39;)</span><br><span class="line"></span><br><span class="line">            # æ·»åŠ ä¸»æœºåˆ°ä¸»æœºç»„</span><br><span class="line">            self.add_host(ip, group_name, port)</span><br><span class="line"></span><br><span class="line">            username &#x3D; host.get(&#39;username&#39;)</span><br><span class="line">            password &#x3D; host.get(&#39;password&#39;)</span><br><span class="line"></span><br><span class="line">            # ç”Ÿæˆansibleä¸»æœºå˜é‡</span><br><span class="line">            self.get_host(ip).set_variable(&#39;ansible_ssh_host&#39;, ip)</span><br><span class="line">            self.get_host(ip).set_variable(&#39;ansible_ssh_port&#39;, port)</span><br><span class="line">            self.get_host(ip).set_variable(&#39;ansible_ssh_user&#39;, username)</span><br><span class="line">            self.get_host(ip).set_variable(&#39;ansible_ssh_pass&#39;, password)</span><br><span class="line">            self.get_host(ip).set_variable(&#39;ansible_sudo_pass&#39;, password)</span><br><span class="line"></span><br><span class="line">            # å¦‚æœä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥ç®¡ç†æ‰€æœ‰æœºå™¨ï¼Œåªéœ€æŠŠä¸‹æ–¹çš„æ³¨é‡Šå»æ‰ï¼Œssh_keyæŒ‡å®šå¯†é’¥æ–‡ä»¶ï¼Œè‹¥æ˜¯ä¸åŒä¸»æœºä½¿ç”¨ä¸åŒå¯†é’¥ç®¡ç†ï¼Œåˆ™éœ€è¦å•ç‹¬è®¾ç½®ä¸»æœºå˜é‡æˆ–ç»„å˜é‡</span><br><span class="line">            # self.get_host(ip).set_variable(&#39;ansible_ssh_private_key_file&#39;, ssh_key)</span><br><span class="line"></span><br><span class="line">            # set other variables</span><br><span class="line">            for key, value in host.items():</span><br><span class="line">                if key not in [&quot;ip&quot;, &quot;port&quot;, &quot;username&quot;, &quot;password&quot;]:</span><br><span class="line">                    self.get_host(ip).set_variable(key, value)</span><br><span class="line"></span><br><span class="line">    def dynamic_inventory(self):</span><br><span class="line">        if isinstance(self.resource, list):</span><br><span class="line">            self.add_dynamic_group(self.resource, &#39;default&#39;)</span><br><span class="line">        elif isinstance(self.resource, dict):</span><br><span class="line">            for groupname, hosts_and_vars in self.resource.items():</span><br><span class="line">                self.add_dynamic_group(hosts_and_vars.get(&quot;hosts&quot;), groupname, hosts_and_vars.get(&quot;group_vars&quot;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ANSRunner(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ‰§è¡Œansibleæ¨¡å—æˆ–è€…playbookçš„ç±»ï¼Œè¿™é‡Œé»˜è®¤é‡‡ç”¨äº†ç”¨æˆ·å+å¯†ç +sudoçš„æ–¹å¼</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, resource&#x3D;None, sources&#x3D;None, sock&#x3D;None, **kwargs):</span><br><span class="line">        Options &#x3D; namedtuple(&#39;Options&#39;, [&#39;connection&#39;, &#39;module_path&#39;, &#39;forks&#39;, &#39;timeout&#39;, &#39;remote_user&#39;,</span><br><span class="line">                                         &#39;ask_pass&#39;, &#39;private_key_file&#39;, &#39;ssh_common_args&#39;, &#39;ssh_extra_args&#39;,</span><br><span class="line">                                         &#39;sftp_extra_args&#39;, &#39;strategy&#39;,</span><br><span class="line">                                         &#39;scp_extra_args&#39;, &#39;become&#39;, &#39;become_method&#39;, &#39;become_user&#39;, &#39;ask_value_pass&#39;,</span><br><span class="line">                                         &#39;verbosity&#39;, &#39;retry_files_enabled&#39;,</span><br><span class="line">                                         &#39;check&#39;, &#39;listhosts&#39;, &#39;listtasks&#39;, &#39;listtags&#39;, &#39;syntax&#39;, &#39;diff&#39;,</span><br><span class="line">                                         &#39;gathering&#39;, &#39;roles_path&#39;])</span><br><span class="line">        self.options &#x3D; Options(connection&#x3D;&#39;smart&#39;,</span><br><span class="line">                               module_path&#x3D;None,</span><br><span class="line">                               forks&#x3D;50, timeout&#x3D;10,</span><br><span class="line">                               remote_user&#x3D;kwargs.get(&#39;remote_user&#39;, None), ask_pass&#x3D;False, private_key_file&#x3D;None,</span><br><span class="line">                               ssh_common_args&#x3D;None,</span><br><span class="line">                               ssh_extra_args&#x3D;None,</span><br><span class="line">                               sftp_extra_args&#x3D;None, strategy&#x3D;&#39;free&#39;, scp_extra_args&#x3D;None,</span><br><span class="line">                               become&#x3D;kwargs.get(&#39;become&#39;, None),</span><br><span class="line">                               become_method&#x3D;kwargs.get(&#39;become_method&#39;, None),</span><br><span class="line">                               become_user&#x3D;kwargs.get(&#39;become_user&#39;, None), ask_value_pass&#x3D;False, verbosity&#x3D;None,</span><br><span class="line">                               retry_files_enabled&#x3D;False, check&#x3D;False, listhosts&#x3D;False,</span><br><span class="line">                               listtasks&#x3D;False, listtags&#x3D;False, syntax&#x3D;False, diff&#x3D;True, gathering&#x3D;&#39;smart&#39;,</span><br><span class="line">                               roles_path&#x3D;os.path.join(PATH, &quot;..&#x2F;roles&quot;))</span><br><span class="line">        self.loader &#x3D; DataLoader()</span><br><span class="line">        self.inventory &#x3D; MyInventory(resource&#x3D;resource, loader&#x3D;self.loader, sources&#x3D;sources)</span><br><span class="line">        self.variable_manager &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;self.inventory)</span><br><span class="line">        self.passwords &#x3D; dict(sshpass&#x3D;None, becomepass&#x3D;None)</span><br><span class="line">        self.callback &#x3D; None</span><br><span class="line">        self.sock &#x3D; sock</span><br><span class="line"></span><br><span class="line">    def run_module(self, host_list, module_name, module_args&#x3D;None, deploy&#x3D;False, send_msg&#x3D;True):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        run module from ansible ad-hoc.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.callback &#x3D; CallbackModule()</span><br><span class="line"></span><br><span class="line">        if module_args:</span><br><span class="line">            play_source &#x3D; dict(</span><br><span class="line">                name&#x3D;&quot;Ansible play&quot;,</span><br><span class="line">                hosts&#x3D;host_list,</span><br><span class="line">                gather_facts&#x3D;&#39;no&#39;,</span><br><span class="line">                tasks&#x3D;[dict(action&#x3D;dict(module&#x3D;module_name, args&#x3D;module_args))]</span><br><span class="line">            )</span><br><span class="line">        else:</span><br><span class="line">            play_source &#x3D; dict(</span><br><span class="line">                name&#x3D;&quot;Ansible play&quot;,</span><br><span class="line">                hosts&#x3D;host_list,</span><br><span class="line">                gather_facts&#x3D;&#39;no&#39;,</span><br><span class="line">                tasks&#x3D;[dict(action&#x3D;dict(module&#x3D;module_name, ))]</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        play &#x3D; Play().load(play_source, variable_manager&#x3D;self.variable_manager, loader&#x3D;self.loader)</span><br><span class="line"></span><br><span class="line">        # actually run it</span><br><span class="line">        tqm &#x3D; None</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            tqm &#x3D; TaskQueueManager(</span><br><span class="line">                inventory&#x3D;self.inventory,</span><br><span class="line">                variable_manager&#x3D;self.variable_manager,</span><br><span class="line">                loader&#x3D;self.loader,</span><br><span class="line">                # options&#x3D;self.options,</span><br><span class="line">                passwords&#x3D;self.passwords,</span><br><span class="line">                stdout_callback&#x3D;self.callback,</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            C.HOST_KEY_CHECKING &#x3D; False  # å…³é—­ç¬¬ä¸€æ¬¡ä½¿ç”¨ansibleè¿æ¥å®¢æˆ·ç«¯æ—¶è¾“å…¥å‘½ä»¤</span><br><span class="line">            tqm.run(play)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(&#39;æ‰§è¡Œ &#123;&#125; å¤±è´¥ï¼ŒåŸå› : &#123;&#125;&#39;.format(module_name, e))</span><br><span class="line">        finally:</span><br><span class="line">            if tqm is not None:</span><br><span class="line">                tqm.cleanup()</span><br><span class="line">            shutil.rmtree(C.DEFAULT_LOCAL_TMP, True)</span><br><span class="line"></span><br><span class="line">    def run_playbook(self, playbook_path, extra_vars&#x3D;None):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        run ansible playbook</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        try:</span><br><span class="line">            self.callback &#x3D; PlayBookResultsCollector(sock&#x3D;self.sock)</span><br><span class="line">            if extra_vars:</span><br><span class="line">                self.variable_manager.extra_vars &#x3D; extra_vars</span><br><span class="line">            executor &#x3D; PlaybookExecutor(</span><br><span class="line">                playbooks&#x3D;[playbook_path], inventory&#x3D;self.inventory, variable_manager&#x3D;self.variable_manager,</span><br><span class="line">                loader&#x3D;self.loader,</span><br><span class="line">                passwords&#x3D;self.passwords,</span><br><span class="line">            )</span><br><span class="line">            executor._tqm._stdout_callback &#x3D; self.callback</span><br><span class="line">            C.HOST_KEY_CHECKING &#x3D; False  # å…³é—­ç¬¬ä¸€æ¬¡ä½¿ç”¨ansibleè¿æ¥å®¢æˆ·ç«¯æ—¶è¾“å…¥å‘½ä»¤</span><br><span class="line">            executor.run()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(&#39;æ‰§è¡Œ&#123;&#125;å¤±è´¥ï¼ŒåŸå› : &#123;&#125;&#39;.format(playbook_path, e))</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def get_module_results(self):</span><br><span class="line">        return self.callback.results</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    def get_playbook_results(self):</span><br><span class="line">        return self.callback.playbook_results</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def handle_setup_data(data):</span><br><span class="line">        &quot;&quot;&quot;å¤„ç†setupæ¨¡å—æ•°æ®ï¼Œç”¨äºæ”¶é›†æœåŠ¡å™¨ä¿¡æ¯åŠŸèƒ½&quot;&quot;&quot;</span><br><span class="line">        server_facts &#x3D; &#123;&#125;</span><br><span class="line">        result &#x3D; json.loads(data[data.index(&#39;&#123;&#39;): data.rindex(&#39;&#125;&#39;) + 1])</span><br><span class="line">        facts &#x3D; result[&#39;ansible_facts&#39;]</span><br><span class="line">        server_facts[&#39;hostname&#39;] &#x3D; facts[&#39;ansible_hostname&#39;]</span><br><span class="line">        server_facts[&#39;cpu_model&#39;] &#x3D; facts[&#39;ansible_processor&#39;][-1]</span><br><span class="line">        server_facts[&#39;cpu_number&#39;] &#x3D; int(facts[&#39;ansible_processor_count&#39;])</span><br><span class="line">        server_facts[&#39;vcpu_number&#39;] &#x3D; int(facts[&#39;ansible_processor_vcpus&#39;])</span><br><span class="line">        server_facts[&#39;disk_total&#39;], disk_size &#x3D; 0, 0</span><br><span class="line">        for k, v in facts[&#39;ansible_devices&#39;].items():</span><br><span class="line">            if k[0:2] in [&#39;sd&#39;, &#39;hd&#39;, &#39;ss&#39;, &#39;vd&#39;]:</span><br><span class="line">                if &#39;G&#39; in v[&#39;size&#39;]:</span><br><span class="line">                    disk_size &#x3D; float(v[&#39;size&#39;][0: v[&#39;size&#39;].rindex(&#39;G&#39;) - 1])</span><br><span class="line">                elif &#39;T&#39; in v[&#39;size&#39;]:</span><br><span class="line">                    disk_size &#x3D; float(v[&#39;size&#39;][0: v[&#39;size&#39;].rindex(&#39;T&#39;) - 1]) * 1024</span><br><span class="line">                server_facts[&#39;disk_total&#39;] +&#x3D; round(disk_size, 2)</span><br><span class="line">        server_facts[&#39;ram_total&#39;] &#x3D; round(int(facts[&#39;ansible_memtotal_mb&#39;]) &#x2F; 1024)</span><br><span class="line">        server_facts[&#39;kernel&#39;] &#x3D; facts[&#39;ansible_kernel&#39;]</span><br><span class="line">        server_facts[&#39;system&#39;] &#x3D; &#39;&#123;&#125; &#123;&#125; &#123;&#125;&#39;.format(facts[&#39;ansible_distribution&#39;],</span><br><span class="line">                                                   facts[&#39;ansible_distribution_version&#39;],</span><br><span class="line">                                                   facts[&#39;ansible_userspace_bits&#39;])</span><br><span class="line">        server_model &#x3D; facts[&#39;ansible_product_name&#39;]</span><br><span class="line"></span><br><span class="line">        # è·å–ç½‘å¡ä¿¡æ¯</span><br><span class="line">        nks &#x3D; []</span><br><span class="line">        for nk in facts.keys():</span><br><span class="line">            networkcard_facts &#x3D; &#123;&#125;</span><br><span class="line">            if re.match(r&quot;^ansible_(eth|bind|eno|ens|em)\d+?&quot;, nk):</span><br><span class="line">                networkcard_facts[&#39;network_card_name&#39;] &#x3D; facts.get(nk).get(&#39;device&#39;)</span><br><span class="line">                networkcard_facts[&#39;network_card_mac&#39;] &#x3D; facts.get(nk).get(&#39;macaddress&#39;)</span><br><span class="line">                networkcard_facts[&#39;network_card_ip&#39;] &#x3D; facts.get(nk).get(&#39;ipv4&#39;).get(&#39;address&#39;) if &#39;ipv4&#39; in facts.get(</span><br><span class="line">                    nk) else &#39;unknown&#39;</span><br><span class="line">                networkcard_facts[&#39;network_card_model&#39;] &#x3D; facts.get(nk).get(&#39;type&#39;)</span><br><span class="line">                networkcard_facts[&#39;network_card_mtu&#39;] &#x3D; facts.get(nk).get(&#39;mtu&#39;)</span><br><span class="line">                networkcard_facts[&#39;network_card_status&#39;] &#x3D; 1 if facts.get(nk).get(&#39;active&#39;) else 0</span><br><span class="line">                nks.append(networkcard_facts)</span><br><span class="line">        return server_facts, server_model, nks</span><br><span class="line"></span><br><span class="line">    @staticmethod</span><br><span class="line">    def handle_mem_data(data):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å¤„ç†è·å–çš„å†…å­˜ä¿¡æ¯</span><br><span class="line">        :param data: é€šè¿‡ansibleè·å–çš„å†…å­˜ä¿¡æ¯</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        result &#x3D; json.loads(data[data.index(&#39;&#123;&#39;): data.rindex(&#39;&#125;&#39;) + 1])</span><br><span class="line">        facts &#x3D; result[&#39;ansible_facts&#39;]</span><br><span class="line">        return facts[&#39;mem_info&#39;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    inventory_path &#x3D; &#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;inventory&#x2F;rcx&#x2F;hosts.ini&#39;</span><br><span class="line">    ANSRunner(sources&#x3D;inventory_path).run_playbook(playbook_path&#x3D;[&#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;test.yml&#39;])</span><br></pre></td></tr></table></figure>

<h2 id="example3"><a href="#example3" class="headerlink" title="example3"></a>example3</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: ansible_playbook_api.py </span><br><span class="line">@time: 2020&#x2F;03&#x2F;18 09:55</span><br><span class="line">@contact: shu_ke163@163.com</span><br><span class="line">@software:  Door</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import json</span><br><span class="line">import logging</span><br><span class="line">import datetime</span><br><span class="line">from collections import namedtuple</span><br><span class="line"></span><br><span class="line">from ansible import constants as C</span><br><span class="line">from ansible import constants</span><br><span class="line">from ansible.parsing.ajson import AnsibleJSONEncoder</span><br><span class="line">from ansible.plugins.callback.default import CallbackModule</span><br><span class="line">from ansible.parsing.dataloader import DataLoader</span><br><span class="line">from ansible.vars.manager import VariableManager</span><br><span class="line">from ansible.inventory.manager import InventoryManager</span><br><span class="line">from ansible.executor.playbook_executor import PlaybookExecutor</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    from __main__ import display</span><br><span class="line">except ImportError:</span><br><span class="line">    from ansible.utils.display import Display</span><br><span class="line"></span><br><span class="line">    display &#x3D; Display()</span><br><span class="line"></span><br><span class="line">logger &#x3D; logging.getLogger(&quot;door&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def current_time():</span><br><span class="line">    return &#39;%sZ&#39; % datetime.datetime.utcnow().isoformat()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PlaybookCallback(CallbackModule):</span><br><span class="line">    &quot;&quot;&quot;é‡å†™consoleè¾“å‡ºæ—¥å¿—&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        super(CallbackModule, self).__init__(display)</span><br><span class="line">        self.results &#x3D; []</span><br><span class="line">        self.host_unreachable &#x3D; &#123;&#125;</span><br><span class="line">        self.host_failed &#x3D; &#123;&#125;</span><br><span class="line">        self.host_ok &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def _new_play(self, play):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;play&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: play.get_name(),</span><br><span class="line">                &#39;id&#39;: str(play._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;tasks&#39;: []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def _new_task(self, task):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;task&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: task.get_name(),</span><br><span class="line">                &#39;id&#39;: str(task._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;hosts&#39;: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    # é‡å†™2.0ç‰ˆæœ¬æ­£ç¡®stdout</span><br><span class="line">    def v2_runner_on_ok(self, result):</span><br><span class="line"></span><br><span class="line">        print(result._result)</span><br><span class="line"></span><br><span class="line">        # if self._play.strategy &#x3D;&#x3D; &#39;free&#39; and self._last_task_banner !&#x3D; result._task._uuid:</span><br><span class="line">        #     self._print_task_banner(result._task)</span><br><span class="line">        #</span><br><span class="line">        # self._clean_results(result._result, result._task.action)</span><br><span class="line">        # # delegated_vars &#x3D; result._result.get(&#39;_ansible_delegated_vars&#39;, None)</span><br><span class="line">        # delegated_vars &#x3D; self._dump_results(result._result)</span><br><span class="line">        # # delegated_vars &#x3D; result._result</span><br><span class="line">        # # n_delegated_vars &#x3D; self._dump_results(result)</span><br><span class="line">        # # print n_delegated_vars</span><br><span class="line">        # self._clean_results(result._result, result._task.action)</span><br><span class="line">        #</span><br><span class="line">        # if result._task.action in (&#39;include&#39;, &#39;include_role&#39;):</span><br><span class="line">        #     return</span><br><span class="line">        # elif result._result.get(&#39;changed&#39;, False):</span><br><span class="line">        #     if delegated_vars:</span><br><span class="line">        #         # è‡ªå®šä¹‰è¾“å‡º</span><br><span class="line">        #         zdy_msg &#x3D; self.zdy_stdout(json.loads(delegated_vars))</span><br><span class="line">        #         if zdy_msg:</span><br><span class="line">        #             msg &#x3D; &quot;changed: [%s]%s&quot; % (result._host.get_name(), zdy_msg)</span><br><span class="line">        #         else:</span><br><span class="line">        #             msg &#x3D; &quot;changed: [%s -&gt; %s]&quot; % (result._host.get_name(), delegated_vars)</span><br><span class="line">        #     else:</span><br><span class="line">        #         msg &#x3D; &quot;changed: [%s]&quot; % result._host.get_name()</span><br><span class="line">        #     color &#x3D; C.COLOR_CHANGED</span><br><span class="line">        # # åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ­¥ setup</span><br><span class="line">        #</span><br><span class="line">        # elif result._result.get(&#39;ansible_facts&#39;, False):</span><br><span class="line">        #     msg &#x3D; &quot;ok: [ %s | %s ]&quot; % (str(result._host), str(result._host.get_groups()))</span><br><span class="line">        #     color &#x3D; C.COLOR_OK</span><br><span class="line">        # else:</span><br><span class="line">        #     if delegated_vars:</span><br><span class="line">        #         # è‡ªå®šä¹‰è¾“å‡º</span><br><span class="line">        #         zdy_msg &#x3D; self.zdy_stdout(json.loads(delegated_vars))</span><br><span class="line">        #         if zdy_msg:</span><br><span class="line">        #             msg &#x3D; &quot;ok: [%s]%s&quot; % (result._host.get_name(), zdy_msg)</span><br><span class="line">        #         else:</span><br><span class="line">        #             msg &#x3D; &quot;ok: [%s -&gt; %s]&quot; % (result._host.get_name(), delegated_vars)</span><br><span class="line">        #     else:</span><br><span class="line">        #         msg &#x3D; &quot;ok: [%s]&quot; % result._host.get_name()</span><br><span class="line">        #     color &#x3D; C.COLOR_OK</span><br><span class="line">        #</span><br><span class="line">        # if result._task.loop and &#39;results&#39; in result._result:</span><br><span class="line">        #     self._process_items(result)</span><br><span class="line">        # else:</span><br><span class="line">        #     self._display.display(msg, color&#x3D;color)</span><br><span class="line">        #</span><br><span class="line">        # self._handle_warnings(result._result)</span><br><span class="line"></span><br><span class="line">    # è‡ªå®šä¹‰è¾“å‡º,æ ¼å¼æ¸…æ™°ä¸€äº›</span><br><span class="line">    def zdy_stdout(self, result):</span><br><span class="line">        msg &#x3D; &#39;&#39;</span><br><span class="line">        if result.get(&#39;delta&#39;, False):</span><br><span class="line">            msg +&#x3D; u&#39;\tæ‰§è¡Œæ—¶é—´:%s&#39; % result[&#39;delta&#39;]</span><br><span class="line">        if result.get(&#39;cmd&#39;, False):</span><br><span class="line">            msg +&#x3D; u&#39;\næ‰§è¡Œå‘½ä»¤:%s&#39; % result[&#39;cmd&#39;]</span><br><span class="line">        if result.get(&#39;stderr&#39;, False):</span><br><span class="line">            msg +&#x3D; u&#39;\né”™è¯¯è¾“å‡º:\n%s&#39; % result[&#39;stderr&#39;]</span><br><span class="line">        if result.get(&#39;stdout&#39;, False):</span><br><span class="line">            msg +&#x3D; u&#39;\næ­£ç¡®è¾“å‡º:\n%s&#39; % result[&#39;stdout&#39;]</span><br><span class="line">        if result.get(&#39;warnings&#39;, False):</span><br><span class="line">            msg +&#x3D; u&#39;\nè­¦å‘Š:%s&#39; % result[&#39;warnings&#39;]</span><br><span class="line">        return msg</span><br><span class="line"></span><br><span class="line">    def display_skipped_hosts(self, result):</span><br><span class="line">        print(result._result)</span><br><span class="line"></span><br><span class="line">    # def v2_runner_on_ok(self, result, **kwargs):</span><br><span class="line">    #</span><br><span class="line">    #     hostname &#x3D; result._host.get_name()</span><br><span class="line">    #     logger.info(f&quot;ansible v2_runner_on_ok hostname: &#123;hostname&#125;&quot;)</span><br><span class="line">    #     try:</span><br><span class="line">    #</span><br><span class="line">    #         self.host_ok[result._host.get_name()] &#x3D; result</span><br><span class="line">    #</span><br><span class="line">    #     except Exception as e:</span><br><span class="line">    #         logger.error(f&quot;get ansible facts result faild: &#123;e.__class__.__name__&#125;: &#123;e&#125;&quot;)</span><br><span class="line">    #         raise Exception(&quot;&#123;hostname&#125; already exist&quot;.format(hostname&#x3D;hostname))</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        logger.info(&quot;unreachable host: &#123;&#125;&quot;.format(result._host.get_name()))</span><br><span class="line">        self.results.append(&#123;result._host.get_name(): result._result&#125;)</span><br><span class="line">        self.host_unreachable[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        print(result.__dict__)</span><br><span class="line">        logger.info(&quot;host failed: &#123;&#125;&quot;.format(result._host.get_name()))</span><br><span class="line">        self.results.append(&#123;result._host.get_name(): result._result&#125;)</span><br><span class="line">        self.host_failed[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_play_start(self, play):</span><br><span class="line">        self.results.append(self._new_play(play))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_handler_task_start(self, task):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_stats(self, stats):</span><br><span class="line">        &quot;&quot;&quot;Display info about playbook statistics&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        hosts &#x3D; sorted(stats.processed.keys())</span><br><span class="line"></span><br><span class="line">        summary &#x3D; &#123;&#125;</span><br><span class="line">        for h in hosts:</span><br><span class="line">            s &#x3D; stats.summarize(h)</span><br><span class="line">            summary[h] &#x3D; s</span><br><span class="line"></span><br><span class="line">        custom_stats &#x3D; &#123;&#125;</span><br><span class="line">        global_custom_stats &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        if self.get_option(&#39;show_custom_stats&#39;) and stats.custom:</span><br><span class="line">            custom_stats.update(dict((self._convert_host_to_name(k), v) for k, v in stats.custom.items()))</span><br><span class="line">            global_custom_stats.update(custom_stats.pop(&#39;_run&#39;, &#123;&#125;))</span><br><span class="line"></span><br><span class="line">        output &#x3D; &#123;</span><br><span class="line">            &#39;plays&#39;: self.results,</span><br><span class="line">            &#39;stats&#39;: summary,</span><br><span class="line">            &#39;custom_stats&#39;: custom_stats,</span><br><span class="line">            &#39;global_custom_stats&#39;: global_custom_stats,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self._display.display(json.dumps(output, cls&#x3D;AnsibleJSONEncoder, indent&#x3D;4, sort_keys&#x3D;True))</span><br><span class="line"></span><br><span class="line">    def _record_task_result(self, on_info, result, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;This function is used as a partial to add failed&#x2F;skipped info in a single method&quot;&quot;&quot;</span><br><span class="line">        host &#x3D; result._host</span><br><span class="line">        task &#x3D; result._task</span><br><span class="line">        task_result &#x3D; result._result.copy()</span><br><span class="line">        task_result.update(on_info)</span><br><span class="line">        task_result[&#39;action&#39;] &#x3D; task.action</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;hosts&#39;][host.name] &#x3D; task_result</span><br><span class="line">        end_time &#x3D; current_time()</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;task&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line">        self.results[-1][&#39;play&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line"></span><br><span class="line">        return self.results</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class PlayBookJob:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å°è£…ä¸€ä¸ªplaybookæ¥å£,æä¾›ç»™å¤–éƒ¨ä½¿ç”¨</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, playbooks, host_list, ssh_user&#x3D;&#39;bbs&#39;, passwords&#x3D;&#39;null&#39;, project_name&#x3D;&#39;all&#39;, ack_pass&#x3D;False,</span><br><span class="line">                 forks&#x3D;5, ext_vars&#x3D;None):</span><br><span class="line">        self.playbooks &#x3D; playbooks</span><br><span class="line">        self.host_list &#x3D; host_list</span><br><span class="line">        self.ssh_user &#x3D; ssh_user</span><br><span class="line">        self.passwords &#x3D; dict(vault_pass&#x3D;passwords)</span><br><span class="line">        self.project_name &#x3D; project_name</span><br><span class="line">        self.ack_pass &#x3D; ack_pass</span><br><span class="line">        self.forks &#x3D; forks</span><br><span class="line">        self.connection &#x3D; &#39;smart&#39;</span><br><span class="line">        self.ext_vars &#x3D; ext_vars</span><br><span class="line"></span><br><span class="line">        ## ç”¨æ¥åŠ è½½è§£æyamlæ–‡ä»¶æˆ–JSONå†…å®¹,å¹¶ä¸”æ”¯æŒvaultçš„è§£å¯†</span><br><span class="line">        self.loader &#x3D; DataLoader()</span><br><span class="line"></span><br><span class="line">        # æ ¹æ®inventoryåŠ è½½å¯¹åº”å˜é‡</span><br><span class="line">        self.inventory &#x3D; InventoryManager(loader&#x3D;self.loader,</span><br><span class="line">                                          sources&#x3D;&#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;inventory&#x2F;rcx&#x2F;hosts.ini&#39;)</span><br><span class="line"></span><br><span class="line">        # ç®¡ç†å˜é‡çš„ç±»ï¼ŒåŒ…æ‹¬ä¸»æœºï¼Œç»„ï¼Œæ‰©å±•ç­‰å˜é‡ï¼Œä¹‹å‰ç‰ˆæœ¬æ˜¯åœ¨ inventoryä¸­çš„</span><br><span class="line">        self.variable_manager &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;self.inventory)</span><br><span class="line"></span><br><span class="line">        self.variable_manager.set_inventory(self.inventory)</span><br><span class="line"></span><br><span class="line">        # åˆå§‹åŒ–éœ€è¦çš„å¯¹è±¡1</span><br><span class="line">        self.Options &#x3D; namedtuple(&#39;Options&#39;,</span><br><span class="line">                                  [&#39;connection&#39;,</span><br><span class="line">                                   &#39;remote_user&#39;,</span><br><span class="line">                                   &#39;ask_sudo_pass&#39;,</span><br><span class="line">                                   &#39;verbosity&#39;,</span><br><span class="line">                                   &#39;ack_pass&#39;,</span><br><span class="line">                                   &#39;module_path&#39;,</span><br><span class="line">                                   &#39;forks&#39;,</span><br><span class="line">                                   &#39;become&#39;,</span><br><span class="line">                                   &#39;become_method&#39;,</span><br><span class="line">                                   &#39;become_user&#39;,</span><br><span class="line">                                   &#39;check&#39;,</span><br><span class="line">                                   &#39;listhosts&#39;,</span><br><span class="line">                                   &#39;listtasks&#39;,</span><br><span class="line">                                   &#39;listtags&#39;,</span><br><span class="line">                                   &#39;syntax&#39;,</span><br><span class="line">                                   &#39;sudo_user&#39;,</span><br><span class="line">                                   &#39;sudo&#39;</span><br><span class="line">                                   ])</span><br><span class="line"></span><br><span class="line">        # åˆå§‹åŒ–éœ€è¦çš„å¯¹è±¡2</span><br><span class="line">        self.options &#x3D; self.Options(connection&#x3D;self.connection,</span><br><span class="line">                                    remote_user&#x3D;self.ssh_user,</span><br><span class="line">                                    ack_pass&#x3D;self.ack_pass,</span><br><span class="line">                                    sudo_user&#x3D;self.ssh_user,</span><br><span class="line">                                    forks&#x3D;self.forks,</span><br><span class="line">                                    sudo&#x3D;&#39;yes&#39;,</span><br><span class="line">                                    ask_sudo_pass&#x3D;False,</span><br><span class="line">                                    verbosity&#x3D;5,</span><br><span class="line">                                    module_path&#x3D;None,</span><br><span class="line">                                    become&#x3D;True,</span><br><span class="line">                                    become_method&#x3D;&#39;sudo&#39;,</span><br><span class="line">                                    become_user&#x3D;&#39;root&#39;,</span><br><span class="line">                                    check&#x3D;None,</span><br><span class="line">                                    listhosts&#x3D;None,</span><br><span class="line">                                    listtasks&#x3D;None,</span><br><span class="line">                                    listtags&#x3D;None,</span><br><span class="line">                                    syntax&#x3D;None</span><br><span class="line">                                    )</span><br><span class="line"></span><br><span class="line">        # åˆå§‹åŒ–consoleè¾“å‡º</span><br><span class="line">        self.callback &#x3D; PlaybookCallback()</span><br><span class="line"></span><br><span class="line">        # ç›´æ¥å¼€å§‹</span><br><span class="line">        self.run_playbook()</span><br><span class="line"></span><br><span class="line">    def run_playbook(self, extra_vars&#x3D;dict()):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        run ansible palybook</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        self.callback &#x3D; PlaybookCallback()</span><br><span class="line">        extra_vars[&#39;host&#39;] &#x3D; &#39;,&#39;.join(self.host_list)</span><br><span class="line"></span><br><span class="line">        executor &#x3D; PlaybookExecutor(</span><br><span class="line">            playbooks&#x3D;self.playbooks, inventory&#x3D;self.inventory,</span><br><span class="line">            variable_manager&#x3D;self.variable_manager,</span><br><span class="line">            loader&#x3D;self.loader,</span><br><span class="line">            passwords&#x3D;self.passwords,</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        print(executor)</span><br><span class="line"></span><br><span class="line">        executor._tqm._stdout_callback &#x3D; self.callback</span><br><span class="line">        constants.HOST_KEY_CHECKING &#x3D; False</span><br><span class="line">        constants.DEPRECATION_WARNINGS &#x3D; False</span><br><span class="line">        constants.RETRY_FILES_ENABLED &#x3D; False</span><br><span class="line">        executor.run()</span><br><span class="line"></span><br><span class="line">        # try:</span><br><span class="line">        #</span><br><span class="line">        # except Exception as err:</span><br><span class="line">        #     logger.error(msg&#x3D;&quot;run playbook failed: &#123;err&#125;&quot;.format(err&#x3D;str(err)))</span><br><span class="line">        #     return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    PlayBookJob(playbooks&#x3D;[&#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;test.yml&#39;],</span><br><span class="line">                host_list&#x3D;[&#39;10.45.176.2&#39;],</span><br><span class="line">                ssh_user&#x3D;&#39;root&#39;,</span><br><span class="line">                project_name&#x3D;&quot;test&quot;,</span><br><span class="line">                forks&#x3D;20,</span><br><span class="line">                ext_vars&#x3D;None</span><br><span class="line">                )</span><br></pre></td></tr></table></figure>

<h3 id="example4"><a href="#example4" class="headerlink" title="example4"></a>example4</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@aythor: shuke</span><br><span class="line">@file: ansible_api.py </span><br><span class="line">@content: zhaofengfeng@rongcloud.cn</span><br><span class="line">@time: 2020&#x2F;03&#x2F;07 14:48</span><br><span class="line">@software:  Door</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import datetime</span><br><span class="line">import json</span><br><span class="line">import shutil</span><br><span class="line">import logging</span><br><span class="line">from ansible.module_utils.common.collections import ImmutableDict</span><br><span class="line">from ansible.parsing.dataloader import DataLoader</span><br><span class="line">from ansible.vars.manager import VariableManager</span><br><span class="line">from ansible.inventory.manager import InventoryManager</span><br><span class="line">from ansible.playbook.play import Play</span><br><span class="line">from ansible.executor.task_queue_manager import TaskQueueManager</span><br><span class="line">from ansible import context</span><br><span class="line">import ansible.constants as C</span><br><span class="line">from ansible.inventory.host import Host</span><br><span class="line">from ansible.parsing.ajson import AnsibleJSONEncoder</span><br><span class="line">from ansible.plugins.callback import CallbackBase</span><br><span class="line">from distutils.sysconfig import get_python_lib</span><br><span class="line">from functools import partial</span><br><span class="line"></span><br><span class="line">PATH &#x3D; os.path.dirname(os.path.dirname(os.path.realpath(__file__)))</span><br><span class="line">sys.path.insert(0, PATH)</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;Door.settings&quot;)</span><br><span class="line"></span><br><span class="line">import django</span><br><span class="line"></span><br><span class="line">django.setup()</span><br><span class="line"></span><br><span class="line">from apps.host import models</span><br><span class="line"></span><br><span class="line">logger &#x3D; logging.getLogger(&quot;door&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def current_time():</span><br><span class="line">    return &#39;%sZ&#39; % datetime.datetime.utcnow().isoformat()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class CallbackModule(CallbackBase):</span><br><span class="line">    CALLBACK_VERSION &#x3D; 2.0</span><br><span class="line">    CALLBACK_TYPE &#x3D; &#39;stdout&#39;</span><br><span class="line">    CALLBACK_NAME &#x3D; &#39;tomysql&#39;</span><br><span class="line"></span><br><span class="line">    def __init__(self, display&#x3D;None):</span><br><span class="line">        super(CallbackModule, self).__init__(display)</span><br><span class="line">        self.results &#x3D; []</span><br><span class="line">        self.host_unreachable &#x3D; &#123;&#125;</span><br><span class="line">        self.host_failed &#x3D; &#123;&#125;</span><br><span class="line">        self.host_ok &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def _new_play(self, play):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;play&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: play.get_name(),</span><br><span class="line">                &#39;id&#39;: str(play._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;tasks&#39;: []</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def _new_task(self, task):</span><br><span class="line">        return &#123;</span><br><span class="line">            &#39;task&#39;: &#123;</span><br><span class="line">                &#39;name&#39;: task.get_name(),</span><br><span class="line">                &#39;id&#39;: str(task._uuid),</span><br><span class="line">                &#39;duration&#39;: &#123;</span><br><span class="line">                    &#39;start&#39;: current_time()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#39;hosts&#39;: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_ok(self, result, **kwargs):</span><br><span class="line"></span><br><span class="line">        hostname &#x3D; result._host.get_name()</span><br><span class="line">        logger.info(f&quot;ansible v2_runner_on_ok hostname: &#123;hostname&#125;&quot;)</span><br><span class="line">        try:</span><br><span class="line">            host &#x3D; result._result[&quot;ansible_facts&quot;]</span><br><span class="line">            host_info &#x3D; &#123;&#125;</span><br><span class="line">            host_info[&quot;hostname&quot;] &#x3D; hostname</span><br><span class="line">            host_info[&quot;fqdn&quot;] &#x3D; host.get(&quot;ansible_fqdn&quot;, None)</span><br><span class="line">            host_info[&quot;cpu&quot;] &#x3D; str(host.get(&quot;ansible_processor_vcpus&quot;, None)) + &quot;c&quot;</span><br><span class="line">            host_info[&quot;memory&quot;] &#x3D; str(round(host.get(&quot;ansible_memtotal_mb&quot;) &#x2F; 1024) + 1) + &quot; GB&quot;</span><br><span class="line">            host_info[&quot;disk&quot;] &#x3D; host.get(&quot;ansible_devices&quot;)[&quot;vda&quot;][&quot;size&quot;]</span><br><span class="line">            host_info[&quot;disk_format&quot;] &#x3D; host.get(&quot;ansible_mounts&quot;)[0][&quot;fstype&quot;]</span><br><span class="line">            host_info[&quot;mount_point&quot;] &#x3D; host.get(&quot;ansible_mounts&quot;)[0][&quot;mount&quot;]</span><br><span class="line">            host_info[&quot;ipv4&quot;] &#x3D; host.get(&quot;ansible_default_ipv4&quot;)[&quot;address&quot;]</span><br><span class="line">            host_info[&quot;arch&quot;] &#x3D; host.get(&quot;ansible_architecture&quot;, None)</span><br><span class="line">            host_info[&quot;os_type&quot;] &#x3D; host.get(&quot;ansible_distribution&quot;, None)</span><br><span class="line">            host_info[&quot;os_version&quot;] &#x3D; host.get(&quot;ansible_distribution_version&quot;, None)</span><br><span class="line">            host_info[&quot;machine_id&quot;] &#x3D; host.get(&quot;ansible_machine_id&quot;, None)</span><br><span class="line">            host_info[&quot;macaddress&quot;] &#x3D; host.get(&quot;ansible_default_ipv4&quot;)[&quot;macaddress&quot;]</span><br><span class="line">            host_info[&quot;kernel_info&quot;] &#x3D; host.get(&quot;ansible_kernel&quot;, None)</span><br><span class="line">            host_info[&quot;virtualization_type&quot;] &#x3D; host.get(&quot;ansible_virtualization_type&quot;, None)</span><br><span class="line"></span><br><span class="line">            import json</span><br><span class="line">            print(json.dumps(host_info, indent&#x3D;4, ensure_ascii&#x3D;False))</span><br><span class="line"></span><br><span class="line">            self.results.append(host_info)</span><br><span class="line">            self.host_ok[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">            models.Cmdb.objects.update_or_create(hostname&#x3D;host_info[&quot;hostname&quot;], defaults&#x3D;host_info)</span><br><span class="line"></span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(f&quot;get ansible facts result faild: &#123;e.__class__.__name__&#125;: &#123;e&#125;&quot;)</span><br><span class="line">            raise Exception(&quot;&#123;hostname&#125; already exist&quot;.format(hostname&#x3D;hostname))</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_unreachable(self, result):</span><br><span class="line">        logger.info(&quot;unreachable host: &#123;&#125;&quot;.format(result._host.get_name()))</span><br><span class="line">        self.results.append(&#123;result._host.get_name(): result._result&#125;)</span><br><span class="line">        self.host_unreachable[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_runner_on_failed(self, result, *args, **kwargs):</span><br><span class="line">        # print(result.__dict__)</span><br><span class="line">        logger.info(&quot;host failed: &#123;&#125;&quot;.format(result._host.get_name()))</span><br><span class="line">        self.results.append(&#123;result._host.get_name(): result._result&#125;)</span><br><span class="line">        self.host_failed[result._host.get_name()] &#x3D; result</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_play_start(self, play):</span><br><span class="line">        self.results.append(self._new_play(play))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_task_start(self, task, is_conditional):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_handler_task_start(self, task):</span><br><span class="line">        self.results[-1][&#39;tasks&#39;].append(self._new_task(task))</span><br><span class="line"></span><br><span class="line">    def _convert_host_to_name(self, key):</span><br><span class="line">        if isinstance(key, (Host,)):</span><br><span class="line">            return key.get_name()</span><br><span class="line">        return key</span><br><span class="line"></span><br><span class="line">    def v2_playbook_on_stats(self, stats):</span><br><span class="line">        &quot;&quot;&quot;Display info about playbook statistics&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        hosts &#x3D; sorted(stats.processed.keys())</span><br><span class="line"></span><br><span class="line">        summary &#x3D; &#123;&#125;</span><br><span class="line">        for h in hosts:</span><br><span class="line">            s &#x3D; stats.summarize(h)</span><br><span class="line">            summary[h] &#x3D; s</span><br><span class="line"></span><br><span class="line">        custom_stats &#x3D; &#123;&#125;</span><br><span class="line">        global_custom_stats &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        if self.get_option(&#39;show_custom_stats&#39;) and stats.custom:</span><br><span class="line">            custom_stats.update(dict((self._convert_host_to_name(k), v) for k, v in stats.custom.items()))</span><br><span class="line">            global_custom_stats.update(custom_stats.pop(&#39;_run&#39;, &#123;&#125;))</span><br><span class="line"></span><br><span class="line">        output &#x3D; &#123;</span><br><span class="line">            &#39;plays&#39;: self.results,</span><br><span class="line">            &#39;stats&#39;: summary,</span><br><span class="line">            &#39;custom_stats&#39;: custom_stats,</span><br><span class="line">            &#39;global_custom_stats&#39;: global_custom_stats,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        self._display.display(json.dumps(output, cls&#x3D;AnsibleJSONEncoder, indent&#x3D;4, sort_keys&#x3D;True))</span><br><span class="line"></span><br><span class="line">    def _record_task_result(self, on_info, result, **kwargs):</span><br><span class="line">        &quot;&quot;&quot;This function is used as a partial to add failed&#x2F;skipped info in a single method&quot;&quot;&quot;</span><br><span class="line">        host &#x3D; result._host</span><br><span class="line">        task &#x3D; result._task</span><br><span class="line">        task_result &#x3D; result._result.copy()</span><br><span class="line">        task_result.update(on_info)</span><br><span class="line">        task_result[&#39;action&#39;] &#x3D; task.action</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;hosts&#39;][host.name] &#x3D; task_result</span><br><span class="line">        end_time &#x3D; current_time()</span><br><span class="line">        self.results[-1][&#39;tasks&#39;][-1][&#39;task&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line">        self.results[-1][&#39;play&#39;][&#39;duration&#39;][&#39;end&#39;] &#x3D; end_time</span><br><span class="line"></span><br><span class="line">        return self.results</span><br><span class="line"></span><br><span class="line">    # def __getattribute__(self, name):</span><br><span class="line">    #     &quot;&quot;&quot;Return &#96;&#96;_record_task_result&#96;&#96; partial with a dict containing skipped&#x2F;failed if necessary&quot;&quot;&quot;</span><br><span class="line">    #     if name not in (&#39;v2_runner_on_ok&#39;, &#39;v2_runner_on_failed&#39;, &#39;v2_runner_on_unreachable&#39;, &#39;v2_runner_on_skipped&#39;):</span><br><span class="line">    #         return object.__getattribute__(self, name)</span><br><span class="line">    #</span><br><span class="line">    #     on &#x3D; name.rsplit(&#39;_&#39;, 1)[1]</span><br><span class="line">    #</span><br><span class="line">    #     on_info &#x3D; &#123;&#125;</span><br><span class="line">    #     if on in (&#39;failed&#39;, &#39;skipped&#39;):</span><br><span class="line">    #         on_info[on] &#x3D; True</span><br><span class="line">    #</span><br><span class="line">    #     # logger.info(&quot;Event: &#123;name&#125;, Task status: &#123;status&#125;&quot;.format(name&#x3D;name, status&#x3D;on))</span><br><span class="line">    #     return partial(self._record_task_result, on_info)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AnsibleAPI(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ‰§è¡Œansibleæ¨¡å—æˆ–è€…playbookçš„ç±»</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, inventory_path):</span><br><span class="line">        self.inventory_path &#x3D; inventory_path</span><br><span class="line">        self.loader &#x3D; DataLoader()</span><br><span class="line">        self.callback &#x3D; None</span><br><span class="line"></span><br><span class="line">    def cmdb(self):</span><br><span class="line">        module_path &#x3D; os.path.join(get_python_lib(), &quot;ansible&quot;)</span><br><span class="line">        context.CLIARGS &#x3D; ImmutableDict(connection&#x3D;&#39;smart&#39;,</span><br><span class="line">                                        module_path&#x3D;[module_path, ],</span><br><span class="line">                                        forks&#x3D;50, become&#x3D;None,</span><br><span class="line">                                        become_method&#x3D;None, become_user&#x3D;None, check&#x3D;False, diff&#x3D;False)</span><br><span class="line"></span><br><span class="line">        passwords &#x3D; dict(vault_pass&#x3D;&#39;secret&#39;)</span><br><span class="line"></span><br><span class="line">        self.callback &#x3D; CallbackModule()</span><br><span class="line"></span><br><span class="line">        inventory &#x3D; InventoryManager(loader&#x3D;self.loader, sources&#x3D;self.inventory_path)</span><br><span class="line"></span><br><span class="line">        print(inventory.list_groups(), inventory.get_groups_dict(), inventory.add_group(&quot;cmdb&quot;))</span><br><span class="line">        # print(inventory.list_groups(), inventory.list_hosts())</span><br><span class="line"></span><br><span class="line">        variable_manager &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;inventory)</span><br><span class="line"></span><br><span class="line">        play_source &#x3D; dict(</span><br><span class="line">            name&#x3D;&quot;Ansible CMDB&quot;,</span><br><span class="line">            hosts&#x3D;str(inventory.groups[&quot;all&quot;]),</span><br><span class="line">            gather_facts&#x3D;&#39;no&#39;,</span><br><span class="line">            tasks&#x3D;[</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;shell&#39;, args&#x3D;&#39;ls&#39;), register&#x3D;&#39;shell_out&#39;),</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;debug&#39;, args&#x3D;dict(msg&#x3D;&#39;&#123;&#123;shell_out.stdout&#125;&#125;&#39;)))</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;shell&#39;, args&#x3D;&#39;whoami&#39;)),</span><br><span class="line">                dict(action&#x3D;dict(module&#x3D;&#39;setup&#39;, )),</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        # Create play object, playbook objects use .load instead of init or new methods,</span><br><span class="line">        play &#x3D; Play().load(play_source, variable_manager&#x3D;variable_manager, loader&#x3D;self.loader)</span><br><span class="line"></span><br><span class="line">        tqm &#x3D; None</span><br><span class="line">        try:</span><br><span class="line">            tqm &#x3D; TaskQueueManager(</span><br><span class="line">                inventory&#x3D;inventory,</span><br><span class="line">                variable_manager&#x3D;variable_manager,</span><br><span class="line">                loader&#x3D;self.loader,</span><br><span class="line">                passwords&#x3D;passwords,</span><br><span class="line">                stdout_callback&#x3D;self.callback,</span><br><span class="line">                # Use our custom callback instead of the &#96;&#96;default&#96;&#96; callback plugin, which prints to stdout</span><br><span class="line">            )</span><br><span class="line">            tqm._stdout_callback &#x3D; self.callback</span><br><span class="line">            tqm.run(play)  # most interesting data for a play is actually sent to the callback&#39;s methods</span><br><span class="line"></span><br><span class="line">            result_raw &#x3D; &#123;&#39;success&#39;: &#123;&#125;, &#39;failed&#39;: &#123;&#125;, &#39;unreachable&#39;: &#123;&#125;&#125;</span><br><span class="line">            for host, result in self.callback.host_ok.items():</span><br><span class="line">                result_raw[&#39;success&#39;][host] &#x3D; result._result[&quot;ansible_facts&quot;]</span><br><span class="line">            for host, result in self.callback.host_failed.items():</span><br><span class="line">                result_raw[&#39;failed&#39;][host] &#x3D; result._result</span><br><span class="line">            for host, result in self.callback.host_unreachable.items():</span><br><span class="line">                result_raw[&#39;failed&#39;][host] &#x3D; result._result</span><br><span class="line"></span><br><span class="line">            print(json.dumps(result_raw, indent&#x3D;4))</span><br><span class="line"></span><br><span class="line">            return result_raw</span><br><span class="line"></span><br><span class="line">        finally:</span><br><span class="line">            if tqm is not None:</span><br><span class="line">                tqm.cleanup()</span><br><span class="line"></span><br><span class="line">            shutil.rmtree(C.DEFAULT_LOCAL_TMP, True)</span><br><span class="line"></span><br><span class="line">    def runplaybook(self):</span><br><span class="line">        module_path &#x3D; os.path.join(get_python_lib(), &quot;ansible&quot;)</span><br><span class="line">        context.CLIARGS &#x3D; ImmutableDict(connection&#x3D;&#39;smart&#39;,</span><br><span class="line">                                        module_path&#x3D;[module_path, ],</span><br><span class="line">                                        forks&#x3D;50, become&#x3D;None,</span><br><span class="line">                                        become_method&#x3D;None, become_user&#x3D;None, check&#x3D;False, diff&#x3D;False)</span><br><span class="line"></span><br><span class="line">        passwords &#x3D; dict(vault_pass&#x3D;&#39;secret&#39;)</span><br><span class="line"></span><br><span class="line">        self.callback &#x3D; CallbackModule()</span><br><span class="line"></span><br><span class="line">        inventory &#x3D; InventoryManager(loader&#x3D;self.loader, sources&#x3D;self.inventory_path)</span><br><span class="line"></span><br><span class="line">        print(inventory.list_groups(), inventory.get_groups_dict(), inventory.add_group(&quot;cmdb&quot;))</span><br><span class="line">        # print(inventory.list_groups(), inventory.list_hosts())</span><br><span class="line"></span><br><span class="line">        variable_manager &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;inventory)</span><br><span class="line"></span><br><span class="line">        play_source &#x3D; dict(</span><br><span class="line">            name&#x3D;&quot;Ansible CMDB&quot;,</span><br><span class="line">            hosts&#x3D;str(inventory.groups[&quot;all&quot;]),</span><br><span class="line">            gather_facts&#x3D;&#39;no&#39;,</span><br><span class="line">            tasks&#x3D;[</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;shell&#39;, args&#x3D;&#39;ls&#39;), register&#x3D;&#39;shell_out&#39;),</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;debug&#39;, args&#x3D;dict(msg&#x3D;&#39;&#123;&#123;shell_out.stdout&#125;&#125;&#39;)))</span><br><span class="line">                # dict(action&#x3D;dict(module&#x3D;&#39;shell&#39;, args&#x3D;&#39;whoami&#39;)),</span><br><span class="line">                dict(action&#x3D;dict(module&#x3D;&#39;setup&#39;, )),</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        # Create play object, playbook objects use .load instead of init or new methods,</span><br><span class="line">        play &#x3D; Play().load(play_source, variable_manager&#x3D;variable_manager, loader&#x3D;self.loader)</span><br><span class="line"></span><br><span class="line">        tqm &#x3D; None</span><br><span class="line">        try:</span><br><span class="line">            tqm &#x3D; TaskQueueManager(</span><br><span class="line">                inventory&#x3D;inventory,</span><br><span class="line">                variable_manager&#x3D;variable_manager,</span><br><span class="line">                loader&#x3D;self.loader,</span><br><span class="line">                passwords&#x3D;passwords,</span><br><span class="line">                stdout_callback&#x3D;self.callback,</span><br><span class="line">                # Use our custom callback instead of the &#96;&#96;default&#96;&#96; callback plugin, which prints to stdout</span><br><span class="line">            )</span><br><span class="line">            tqm._stdout_callback &#x3D; self.callback</span><br><span class="line">            tqm.run(play)  # most interesting data for a play is actually sent to the callback&#39;s methods</span><br><span class="line"></span><br><span class="line">            result_raw &#x3D; &#123;&#39;success&#39;: &#123;&#125;, &#39;failed&#39;: &#123;&#125;, &#39;unreachable&#39;: &#123;&#125;&#125;</span><br><span class="line">            for host, result in self.callback.host_ok.items():</span><br><span class="line">                result_raw[&#39;success&#39;][host] &#x3D; result._result[&quot;ansible_facts&quot;]</span><br><span class="line">            for host, result in self.callback.host_failed.items():</span><br><span class="line">                result_raw[&#39;failed&#39;][host] &#x3D; result._result</span><br><span class="line">            for host, result in self.callback.host_unreachable.items():</span><br><span class="line">                result_raw[&#39;failed&#39;][host] &#x3D; result._result</span><br><span class="line"></span><br><span class="line">            print(json.dumps(result_raw, indent&#x3D;4))</span><br><span class="line"></span><br><span class="line">            return result_raw</span><br><span class="line"></span><br><span class="line">        finally:</span><br><span class="line">            if tqm is not None:</span><br><span class="line">                tqm.cleanup()</span><br><span class="line"></span><br><span class="line">            shutil.rmtree(C.DEFAULT_LOCAL_TMP, True)</span><br><span class="line"></span><br><span class="line">    def VariablManager(self, hostname&#x3D;None):</span><br><span class="line">        inventory &#x3D; InventoryManager(loader&#x3D;self.loader,</span><br><span class="line">                                     sources&#x3D;&#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;inventory&#x2F;rcx&#x2F;hosts.ini&#39;)</span><br><span class="line">        vm &#x3D; VariableManager(loader&#x3D;self.loader, inventory&#x3D;inventory)</span><br><span class="line"></span><br><span class="line">        host &#x3D; inventory.get_host(hostname)</span><br><span class="line"></span><br><span class="line">        vm.set_host_variable(host&#x3D;host, varname&#x3D;&quot;name&quot;, value&#x3D;&quot;test&quot;)</span><br><span class="line"></span><br><span class="line">        # è·å–æŒ‡å®šä¸»æœºçš„å˜é‡</span><br><span class="line">        # print(vm.get_vars(host&#x3D;host))</span><br><span class="line"></span><br><span class="line">        return vm.get_vars(host&#x3D;host)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    inventory_path &#x3D; &#39;&#x2F;Users&#x2F;shuke&#x2F;Work&#x2F;SCM&#x2F;Door&#x2F;apps&#x2F;playbook&#x2F;inventory&#x2F;rcx&#x2F;hosts.ini&#39;</span><br><span class="line">    AnsibleAPI(inventory_path).cmdb()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Ansible</category>
      </categories>
      <tags>
        <tag>Ansible</tag>
      </tags>
  </entry>
  <entry>
    <title>python 315é“é¢è¯•é¢˜</title>
    <url>/2020/04/20/python-315%E9%81%93%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<h2 id="pythoné¢è¯•é¢˜"><a href="#pythoné¢è¯•é¢˜" class="headerlink" title="pythoné¢è¯•é¢˜"></a>pythoné¢è¯•é¢˜</h2><h3 id="ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€ç¯‡-80é¢˜"><a href="#ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€ç¯‡-80é¢˜" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†(åŸºç¡€ç¯‡)(80é¢˜)"></a>ç¬¬ä¸€éƒ¨åˆ†(åŸºç¡€ç¯‡)(80é¢˜)</h3><p>ä¸ºä»€ä¹ˆå­¦ä¹ Pythonï¼Ÿ</p>
<p>é€šè¿‡ä»€ä¹ˆé€”å¾„å­¦ä¹ çš„Pythonï¼Ÿ</p>
<p>Pythonå’ŒJavaã€PHPã€Cã€C#ã€C++ç­‰å…¶ä»–è¯­è¨€çš„å¯¹æ¯”ï¼Ÿ</p>
<p>ç®€è¿°è§£é‡Šå‹å’Œç¼–è¯‘å‹ç¼–ç¨‹è¯­è¨€ï¼Ÿ</p>
<p>Pythonè§£é‡Šå™¨ç§ç±»ä»¥åŠç‰¹ç‚¹ï¼Ÿ</p>
<p>ä½å’Œå­—èŠ‚çš„å…³ç³»ï¼Ÿ</p>
<p>bã€Bã€KBã€MBã€GB çš„å…³ç³»ï¼Ÿ</p>
<p>è¯·è‡³å°‘åˆ—ä¸¾5ä¸ª PEP8 è§„èŒƒï¼ˆè¶Šå¤šè¶Šå¥½ï¼‰ã€‚</p>
<p>é€šè¿‡ä»£ç å®ç°å¦‚ä¸‹è½¬æ¢ï¼š<br>äºŒè¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ï¼šv = â€œ0b1111011â€â€¨<br>åè¿›åˆ¶è½¬æ¢æˆäºŒè¿›åˆ¶ï¼šv = 18â€¨<br>å…«è¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ï¼šv = â€œ011â€â€¨<br>åè¿›åˆ¶è½¬æ¢æˆå…«è¿›åˆ¶ï¼šv = 30â€¨<br>åå…­è¿›åˆ¶è½¬æ¢æˆåè¿›åˆ¶ï¼šv = â€œ0x12â€â€¨<br>åè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶ï¼šv = 87</p>
<p>è¯·ç¼–å†™ä¸€ä¸ªå‡½æ•°å®ç°å°†IPåœ°å€è½¬æ¢æˆä¸€ä¸ªæ•´æ•°ã€‚</p>
<p>å¦‚ 10.3.9.12 è½¬æ¢è§„åˆ™ä¸ºï¼š<br>        10            00001010<br>â€¨         3            00000011â€¨<br>         9            00001001<br>â€¨        12            00001100â€¨<br>å†å°†ä»¥ä¸ŠäºŒè¿›åˆ¶æ‹¼æ¥èµ·æ¥è®¡ç®—åè¿›åˆ¶ç»“æœï¼š00001010 00000011 00001001 00001100 = ï¼Ÿ<br>pythoné€’å½’çš„æœ€å¤§å±‚æ•°ï¼Ÿ</p>
<p>æ±‚ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">    v1 &#x3D; 1 or 3â€¨</span><br><span class="line">    v2 &#x3D; 1 and 3â€¨</span><br><span class="line">    v3 &#x3D; 0 and 2 and 1</span><br><span class="line">â€¨    v4 &#x3D; 0 and 2 or 1</span><br><span class="line">â€¨    v5 &#x3D; 0 and 2 or 1 or 4</span><br><span class="line">â€¨    v6 &#x3D; 0 or Flase and 1</span><br><span class="line">&#96;&#96;&#96;   </span><br><span class="line">asciiã€unicodeã€utf-8ã€gbk åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å­—èŠ‚ç å’Œæœºå™¨ç çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸‰å…ƒè¿ç®—è§„åˆ™ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾ Python2å’ŒPython3çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç”¨ä¸€è¡Œä»£ç å®ç°æ•°å€¼äº¤æ¢ï¼š</span><br><span class="line">     â€¨ a &#x3D; 1</span><br><span class="line"> â€¨     b &#x3D; 2</span><br><span class="line"></span><br><span class="line">Python3å’ŒPython2ä¸­ int å’Œ longçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">xrangeå’Œrangeçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ–‡ä»¶æ“ä½œæ—¶ï¼šxreadlineså’Œreadlinesçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾å¸ƒå°”å€¼ä¸ºFalseçš„å¸¸è§å€¼ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸æ¯ä¸ªå¸¸ç”¨çš„5ä¸ªæ–¹æ³•ï¼Ÿ</span><br><span class="line"></span><br><span class="line">lambdaè¡¨è¾¾å¼æ ¼å¼ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">passçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">*argå’Œ**kwargä½œç”¨</span><br><span class="line"></span><br><span class="line">iså’Œ&#x3D;&#x3D;çš„åŒºåˆ«</span><br><span class="line"></span><br><span class="line">ç®€è¿°Pythonçš„æ·±æµ…æ‹·è´ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Pythonåƒåœ¾å›æ”¶æœºåˆ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Pythonçš„å¯å˜ç±»å‹å’Œä¸å¯å˜ç±»å‹ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ±‚ç»“æœï¼š</span><br><span class="line">â€¨   v &#x3D; dict.fromkeys([&#39;k1&#39;,&#39;k2&#39;],[])â€¨ </span><br><span class="line">   v[â€˜k1â€™].append(666)</span><br><span class="line">â€¨   print(v)â€¨</span><br><span class="line">   v[â€˜k1â€™] &#x3D; 777</span><br><span class="line">â€¨   print(v)</span><br><span class="line">æ±‚ç»“æœï¼š</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾å¸¸è§çš„å†…ç½®å‡½æ•°ï¼Ÿ</span><br><span class="line"></span><br><span class="line">filterã€mapã€reduceçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸€è¡Œä»£ç å®ç°9*9ä¹˜æ³•è¡¨</span><br><span class="line"></span><br><span class="line">å¦‚ä½•å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Ÿä»¥åŠç”¨è¿‡å“ªäº›ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è‡³å°‘åˆ—ä¸¾8ä¸ªå¸¸ç”¨æ¨¡å—éƒ½æœ‰é‚£äº›ï¼Ÿ</span><br><span class="line"></span><br><span class="line">reçš„matchå’ŒsearchåŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯æ­£åˆ™çš„è´ªå©ªåŒ¹é…ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ±‚ç»“æœï¼šâ€¨ a. [ i % 2 for i in range(10) ]â€¨ b. ( i % 2 for i in range(10) )</span><br><span class="line"></span><br><span class="line">æ±‚ç»“æœï¼šâ€¨ a. 1 or 2â€¨ b. 1 and 2â€¨ c. 1 &lt; (2&#x3D;&#x3D;2)â€¨ d. 1 &lt; 2 &#x3D;&#x3D; 2</span><br><span class="line"></span><br><span class="line">def func(a,b&#x3D;[]) è¿™ç§å†™æ³•æœ‰ä»€ä¹ˆå‘ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•å®ç° â€œ1,2,3â€ å˜æˆ [â€˜1â€™,â€™2â€™,â€™3â€™] ?</span><br><span class="line"></span><br><span class="line">å¦‚ä½•å®ç°[â€˜1â€™,â€™2â€™,â€™3â€™]å˜æˆ[1,2,3] ?</span><br><span class="line">æ¯”è¾ƒï¼š a &#x3D; [1,2,3] å’Œ b &#x3D; [(1),(2),(3) ] ä»¥åŠ b &#x3D; [(1,),(2,),(3,) ] çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ç”¨ä¸€è¡Œä»£ç ç”Ÿæˆ[1,4,9,16,25,36,49,64,81,100] ?</span><br><span class="line"></span><br><span class="line">ä¸€è¡Œä»£ç å®ç°åˆ é™¤åˆ—è¡¨ä¸­é‡å¤çš„å€¼ ?</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åœ¨å‡½æ•°ä¸­è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ ?</span><br><span class="line"></span><br><span class="line">loggingæ¨¡å—çš„ä½œç”¨ï¼Ÿä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è¯·ç”¨ä»£ç ç®€ç­”å®ç°stack ã€‚</span><br><span class="line"></span><br><span class="line">å¸¸ç”¨å­—ç¬¦ä¸²æ ¼å¼åŒ–å“ªå‡ ç§ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿° ç”Ÿæˆå™¨ã€è¿­ä»£å™¨ã€å¯è¿­ä»£å¯¹è±¡ ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç”¨Pythonå®ç°ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾çš„å‡½æ•°ã€‚</span><br><span class="line"></span><br><span class="line">è°ˆè°ˆä½ å¯¹é—­åŒ…çš„ç†è§£ï¼Ÿ</span><br><span class="line"></span><br><span class="line">oså’Œsysæ¨¡å—çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ä½¿ç”¨pythonåˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è°ˆè°ˆä½ å¯¹é¢å‘å¯¹è±¡çš„ç†è§£ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Pythoné¢å‘å¯¹è±¡ä¸­çš„ç»§æ‰¿æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</span><br><span class="line"></span><br><span class="line">é¢å‘å¯¹è±¡æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆæ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">é¢å‘å¯¹è±¡ä¸­superçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ˜¯å¦ä½¿ç”¨è¿‡functoolsä¸­çš„å‡½æ•°ï¼Ÿå…¶ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾é¢å‘å¯¹è±¡ä¸­å¸¦çˆ½ä¸‹åˆ’çº¿çš„ç‰¹æ®Šæ–¹æ³•ï¼Œå¦‚ï¼š__new__ã€__init__</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åˆ¤æ–­æ˜¯å‡½æ•°è¿˜æ˜¯æ–¹æ³•ï¼Ÿ</span><br><span class="line"></span><br><span class="line">é™æ€æ–¹æ³•å’Œç±»æ–¹æ³•åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾é¢å‘å¯¹è±¡ä¸­çš„ç‰¹æ®Šæˆå‘˜ä»¥åŠåº”ç”¨åœºæ™¯</span><br><span class="line"></span><br><span class="line">1ã€2ã€3ã€4ã€5 èƒ½ç»„æˆå¤šå°‘ä¸ªäº’ä¸ç›¸åŒä¸”æ— é‡å¤çš„ä¸‰ä½æ•°</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯åå°„ï¼Ÿä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">metaclassä½œç”¨ï¼Ÿä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç”¨å°½é‡å¤šçš„æ–¹æ³•å®ç°å•ä¾‹æ¨¡å¼ã€‚</span><br><span class="line"></span><br><span class="line">è£…é¥°å™¨çš„å†™æ³•ä»¥åŠåº”ç”¨åœºæ™¯ã€‚</span><br><span class="line"></span><br><span class="line">å¼‚å¸¸å¤„ç†å†™æ³•ä»¥åŠå¦‚ä½•ä¸»åŠ¨è·‘å‡ºå¼‚å¸¸ï¼ˆåº”ç”¨åœºæ™¯ï¼‰</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯é¢å‘å¯¹è±¡çš„mro</span><br><span class="line"></span><br><span class="line">isinstanceä½œç”¨ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å†™ä»£ç å¹¶å®ç°ï¼š</span><br></pre></td></tr></table></figure>
<p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.You may assume that each input would<br>have exactly one solution, and you may not use the same element twice.<br>Example:â€¨<br>          Given nums = [2, 7, 11, 15], target = 9,<br>â€¨Because nums[0] + nums[1] = 2 + 7 = 9,â€¨<br>           return [0, 1]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jsonåºåˆ—åŒ–æ—¶ï¼Œå¯ä»¥å¤„ç†çš„æ•°æ®ç±»å‹æœ‰å“ªäº›ï¼Ÿå¦‚ä½•å®šåˆ¶æ”¯æŒdatetimeç±»å‹ï¼Ÿ</span><br><span class="line"></span><br><span class="line">jsonåºåˆ—åŒ–æ—¶ï¼Œé»˜è®¤é‡åˆ°ä¸­æ–‡ä¼šè½¬æ¢æˆunicodeï¼Œå¦‚æœæƒ³è¦ä¿ç•™ä¸­æ–‡æ€ä¹ˆåŠï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯æ–­è¨€ï¼Ÿåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æœ‰ç”¨è¿‡with statementå—ï¼Ÿå®ƒçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ä»£ç å®ç°æŸ¥çœ‹åˆ—ä¸¾ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">ç®€è¿° yieldå’Œyield fromå…³é”®å­—ã€‚</span><br><span class="line"></span><br><span class="line">### ç¬¬äºŒéƒ¨åˆ†(ç½‘ç»œç¼–ç¨‹å’Œå¹¶å‘)(34é¢˜)</span><br><span class="line">ç®€è¿° OSI ä¸ƒå±‚åè®®ã€‚</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯C&#x2F;Så’ŒB&#x2F;Sæ¶æ„ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿° ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹çš„æµç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯arpåè®®ï¼Ÿ</span><br><span class="line"></span><br><span class="line">TCPå’ŒUDPçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯å±€åŸŸç½‘å’Œå¹¿åŸŸç½‘ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸ºä½•åŸºäºtcpåè®®çš„é€šä¿¡æ¯”åŸºäºudpåè®®çš„é€šä¿¡æ›´å¯é ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯socketï¼Ÿç®€è¿°åŸºäºtcpåè®®çš„å¥—æ¥å­—é€šä¿¡æµç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯ç²˜åŒ…ï¼Ÿ socket ä¸­é€ æˆç²˜åŒ…çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ å“ªäº›æƒ…å†µä¼šå‘ç”Ÿç²˜åŒ…ç°è±¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">IOå¤šè·¯å¤ç”¨çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯é˜²ç«å¢™ä»¥åŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">selectã€pollã€epoll æ¨¡å‹çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿° è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„åŒºåˆ« ä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">GILé”æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Pythonä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± å’Œè¿›ç¨‹æ± ï¼Ÿ</span><br><span class="line"></span><br><span class="line">threading.localçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹ä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯å¹¶å‘å’Œå¹¶è¡Œï¼Ÿ</span><br><span class="line"></span><br><span class="line">è¿›ç¨‹é”å’Œçº¿ç¨‹é”çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è§£é‡Šä»€ä¹ˆæ˜¯å¼‚æ­¥éé˜»å¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è·¯ç”±å™¨å’Œäº¤æ¢æœºçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯åŸŸåè§£æï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ä¿®æ”¹æœ¬åœ°hostsæ–‡ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹åº”ç”¨åœºæ™¯åŠä¼˜åŠ¿ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯cdnï¼Ÿ</span><br><span class="line"></span><br><span class="line">LVSæ˜¯ä»€ä¹ˆåŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Nginxæ˜¯ä»€ä¹ˆåŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">keepalivedæ˜¯ä»€ä¹ˆåŠä½œç”¨?</span><br><span class="line"></span><br><span class="line">haproxyæ˜¯ä»€ä¹ˆä»¥åŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯rpcåŠåº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿° asynioæ¨¡å—çš„ä½œç”¨å’Œåº”ç”¨åœºæ™¯ã€‚</span><br><span class="line"></span><br><span class="line">ç®€è¿° geventæ¨¡å—çš„ä½œç”¨å’Œåº”ç”¨åœºæ™¯ã€‚</span><br><span class="line"></span><br><span class="line">twistedæ¡†æ¶çš„ä½¿ç”¨å’Œåº”ç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">### ç¬¬ä¸‰éƒ¨åˆ†(æ•°æ®åº“å’Œç¼“å­˜)(46é¢˜)</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾å¸¸è§çš„å…³ç³»å‹æ•°æ®åº“å’Œéå…³ç³»å‹éƒ½æœ‰é‚£äº›ï¼Ÿ</span><br><span class="line"></span><br><span class="line">MySQLå¸¸è§æ•°æ®åº“å¼•æ“åŠæ¯”è¾ƒï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°æ•°æ®ä¸‰å¤§èŒƒå¼ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯äº‹åŠ¡ï¼ŸMySQLå¦‚ä½•æ”¯æŒäº‹åŠ¡ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°æ•°æ®åº“è®¾è®¡ä¸­ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šçš„åº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åŸºäºæ•°æ®åº“å®ç°å•†åŸå•†å“è®¡æ•°å™¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¸¸è§SQLï¼ˆå¿…å¤‡ï¼‰</span><br><span class="line">è¯¦è§æ­¦æ²›é½åšå®¢ï¼šhttps:&#x2F;&#x2F;www.cnblogs.com&#x2F;wupeiqi&#x2F;articles&#x2F;5729934.html</span><br><span class="line"></span><br><span class="line">ç®€è¿°è§¦å‘å™¨ã€å‡½æ•°ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ï¼Ÿ</span><br><span class="line"></span><br><span class="line">MySQLç´¢å¼•ç§ç±»</span><br><span class="line"></span><br><span class="line">ç´¢å¼•åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éµå¾ªæœ€å·¦å‰ç¼€çš„è§„åˆ™ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸»é”®å’Œå¤–é”®çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">MySQLå¸¸è§çš„å‡½æ•°ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾ åˆ›å»ºç´¢å¼•ä½†æ˜¯æ— æ³•å‘½ä¸­ç´¢å¼•çš„8ç§æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä½•å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“å¯¼å…¥å¯¼å‡ºå‘½ä»¤ï¼ˆç»“æ„+æ•°æ®ï¼‰ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">charå’Œvarcharçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°MySQLçš„æ‰§è¡Œè®¡åˆ’ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åœ¨å¯¹nameåšäº†å”¯ä¸€ç´¢å¼•å‰æä¸‹ï¼Œç®€è¿°ä»¥ä¸‹åŒºåˆ«ï¼šâ€¨ </span><br><span class="line">        select * from tb where name &#x3D; â€˜Oldboy-Wupeiqiâ€™ â€¨ </span><br><span class="line">        select * from tb where name &#x3D; â€˜Oldboy-Wupeiqiâ€™ limit 1</span><br><span class="line"></span><br><span class="line">1000wæ¡æ•°æ®ï¼Œä½¿ç”¨limit offset åˆ†é¡µæ—¶ï¼Œä¸ºä»€ä¹ˆè¶Šå¾€åç¿»è¶Šæ…¢ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯ç´¢å¼•åˆå¹¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯è¦†ç›–ç´¢å¼•ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°æ•°æ®åº“åˆ†åº“åˆ†è¡¨ï¼Ÿï¼ˆæ°´å¹³ã€å‚ç›´ï¼‰</span><br><span class="line"></span><br><span class="line">rediså’Œmemcachedæ¯”è¾ƒï¼Ÿ</span><br><span class="line"></span><br><span class="line">redisä¸­æ•°æ®åº“é»˜è®¤æ˜¯å¤šå°‘ä¸ªdb åŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">pythonæ“ä½œredisçš„æ¨¡å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚æœredisä¸­çš„æŸä¸ªåˆ—è¡¨ä¸­çš„æ•°æ®é‡éå¸¸å¤§ï¼Œå¦‚æœå®ç°å¾ªç¯æ˜¾ç¤ºæ¯ä¸€ä¸ªå€¼ï¼Ÿ</span><br><span class="line"></span><br><span class="line">rediså¦‚ä½•å®ç°ä¸»ä»å¤åˆ¶ï¼Ÿä»¥åŠæ•°æ®åŒæ­¥æœºåˆ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">redisä¸­çš„sentinelçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•å®ç°redisé›†ç¾¤ï¼Ÿ</span><br><span class="line"></span><br><span class="line">redisä¸­é»˜è®¤æœ‰å¤šå°‘ä¸ªå“ˆå¸Œæ§½ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°redisçš„æœ‰å“ªå‡ ç§æŒä¹…åŒ–ç­–ç•¥åŠæ¯”è¾ƒï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾redisæ”¯æŒçš„è¿‡æœŸç­–ç•¥ã€‚</span><br><span class="line"></span><br><span class="line">MySQL é‡Œæœ‰ 2000w æ•°æ®ï¼Œredis ä¸­åªå­˜ 20w çš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯ redis ä¸­éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ï¼Ÿ </span><br><span class="line"></span><br><span class="line">å†™ä»£ç ï¼ŒåŸºäºredisçš„åˆ—è¡¨å®ç° å…ˆè¿›å…ˆå‡ºã€åè¿›å…ˆå‡ºé˜Ÿåˆ—ã€ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åŸºäºrediså®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åŸºäºrediså®ç°å‘å¸ƒå’Œè®¢é˜…ï¼Ÿä»¥åŠå‘å¸ƒè®¢é˜…å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯codisåŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯twemproxyåŠä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å†™ä»£ç å®ç°redisäº‹åŠ¡æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">redisä¸­çš„watchçš„å‘½ä»¤çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åŸºäºrediså¦‚ä½•å®ç°å•†åŸå•†å“æ•°é‡è®¡æ•°å™¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°redisåˆ†å¸ƒå¼é”å’Œredlockçš„å®ç°æœºåˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œï¼ŸPythonä¸­æ˜¯å¦æœ‰ç›¸åº”æ¨¡å—ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•é«˜æ•ˆçš„æ‰¾åˆ°redisä¸­æ‰€æœ‰ä»¥oldboyå¼€å¤´çš„keyï¼Ÿ</span><br><span class="line"></span><br><span class="line">### ç¬¬å››éƒ¨åˆ†(å‰ç«¯&#x2F;æ¡†æ¶&#x2F;å…¶ä»–)(155é¢˜)</span><br><span class="line"></span><br><span class="line">è°ˆè°ˆä½ å¯¹httpåè®®çš„è®¤è¯†ã€‚</span><br><span class="line"></span><br><span class="line">è°ˆè°ˆä½ å¯¹websocketåè®®çš„è®¤è¯†ã€‚</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯magic string ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åˆ›å»ºå“åº”å¼å¸ƒå±€ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä½ æ›¾ç»ä½¿ç”¨è¿‡å“ªäº›å‰ç«¯æ¡†æ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯ajaxè¯·æ±‚ï¼Ÿå¹¶ä½¿ç”¨jQueryå’ŒXMLHttpRequestå¯¹è±¡å®ç°ä¸€ä¸ªajaxè¯·æ±‚ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åœ¨å‰ç«¯å®ç°è½®è®­ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•åœ¨å‰ç«¯å®ç°é•¿è½®è®­ï¼Ÿ</span><br><span class="line"></span><br><span class="line">vuexçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">vueä¸­çš„è·¯ç”±çš„æ‹¦æˆªå™¨çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">axiosçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾vueçš„å¸¸è§æŒ‡ä»¤ã€‚</span><br><span class="line"></span><br><span class="line">ç®€è¿°jsonpåŠå®ç°åŸç†ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ˜¯ä»€ä¹ˆcors ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾Httpè¯·æ±‚ä¸­å¸¸è§çš„è¯·æ±‚æ–¹å¼ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾Httpè¯·æ±‚ä¸­çš„çŠ¶æ€ç ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾Httpè¯·æ±‚ä¸­å¸¸è§çš„è¯·æ±‚å¤´ï¼Ÿ</span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çœ‹å›¾å†™ç»“æœï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">djangoã€flaskã€tornadoæ¡†æ¶çš„æ¯”è¾ƒï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯wsgiï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoè¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾djangoçš„å†…ç½®ç»„ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾djangoä¸­é—´ä»¶çš„5ä¸ªæ–¹æ³•ï¼Ÿä»¥åŠdjangoä¸­é—´ä»¶çš„åº”ç”¨åœºæ™¯ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°ä»€ä¹ˆæ˜¯FBVå’ŒCBVï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoçš„requestå¯¹è±¡æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ç»™CBVçš„ç¨‹åºæ·»åŠ è£…é¥°å™¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾django orm ä¸­æ‰€æœ‰çš„æ–¹æ³•ï¼ˆQuerySetå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•ï¼‰</span><br><span class="line"></span><br><span class="line">onlyå’Œdeferçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">select_relatedå’Œprefetch_relatedçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">filterå’Œexcludeçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾django ormä¸­ä¸‰ç§èƒ½å†™sqlè¯­å¥çš„æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">django orm ä¸­å¦‚ä½•è®¾ç½®è¯»å†™åˆ†ç¦»ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Få’ŒQçš„ä½œç”¨?</span><br><span class="line"></span><br><span class="line">valueså’Œvalues_listçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">å¦‚ä½•ä½¿ç”¨django ormæ‰¹é‡åˆ›å»ºæ•°æ®ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoçš„Formå’ŒModeFormçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoçš„Formç»„ä»¶ä¸­ï¼Œå¦‚æœå­—æ®µä¸­åŒ…å«choiceså‚æ•°ï¼Œè¯·ä½¿ç”¨ä¸¤ç§æ–¹å¼å®ç°æ•°æ®æºå®æ—¶æ›´æ–°ã€‚</span><br><span class="line"></span><br><span class="line">djangoçš„Modelä¸­çš„ForeignKeyå­—æ®µä¸­çš„on_deleteå‚æ•°æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoä¸­csrfçš„å®ç°æœºåˆ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoå¦‚ä½•å®ç°websocketï¼Ÿ</span><br><span class="line"></span><br><span class="line">åŸºäºdjangoä½¿ç”¨ajaxå‘é€postè¯·æ±‚æ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å“ªç§æ–¹æ³•æºå¸¦csrf tokenï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoä¸­å¦‚ä½•å®ç°ormè¡¨ä¸­æ·»åŠ æ•°æ®æ—¶åˆ›å»ºä¸€æ¡æ—¥å¿—è®°å½•ã€‚</span><br><span class="line"></span><br><span class="line">djangoç¼“å­˜å¦‚ä½•è®¾ç½®ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoçš„ç¼“å­˜èƒ½ä½¿ç”¨rediså—ï¼Ÿå¦‚æœå¯ä»¥çš„è¯ï¼Œå¦‚ä½•é…ç½®ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoè·¯ç”±ç³»ç»Ÿä¸­nameçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoçš„æ¨¡æ¿ä¸­filterå’Œsimple_tagçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">django-debug-toolbarçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoä¸­å¦‚ä½•å®ç°å•å…ƒæµ‹è¯•ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è§£é‡Šormä¸­ db first å’Œ code firstçš„å«ä¹‰ï¼Ÿ</span><br><span class="line"></span><br><span class="line">djangoä¸­å¦‚ä½•æ ¹æ®æ•°æ®åº“è¡¨ç”Ÿæˆmodelä¸­çš„ç±»ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨ormå’ŒåŸç”Ÿsqlçš„ä¼˜ç¼ºç‚¹ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°MVCå’ŒMTV</span><br><span class="line"></span><br><span class="line">djangoçš„contenttypeç»„ä»¶çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è°ˆè°ˆä½ å¯¹restfull è§„èŒƒçš„è®¤è¯†ï¼Ÿ</span><br><span class="line"></span><br><span class="line">æ¥å£çš„å¹‚ç­‰æ€§æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»€ä¹ˆæ˜¯RPCï¼Ÿ</span><br><span class="line"></span><br><span class="line">Httpå’ŒHttpsçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨django rest frameworkæ¡†æ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">django rest frameworkæ¡†æ¶ä¸­éƒ½æœ‰é‚£äº›ç»„ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">django rest frameworkæ¡†æ¶ä¸­çš„è§†å›¾éƒ½å¯ä»¥ç»§æ‰¿å“ªäº›ç±»ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿° django rest frameworkæ¡†æ¶çš„è®¤è¯æµç¨‹ã€‚</span><br><span class="line"></span><br><span class="line">django rest frameworkå¦‚ä½•å®ç°çš„ç”¨æˆ·è®¿é—®é¢‘ç‡æ§åˆ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskæ¡†æ¶çš„ä¼˜åŠ¿ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskæ¡†æ¶ä¾èµ–ç»„ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskè“å›¾çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">åˆ—ä¸¾ä½¿ç”¨è¿‡çš„Flaskç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç®€è¿°Flaskä¸Šä¸‹æ–‡ç®¡ç†æµç¨‹?</span><br><span class="line"></span><br><span class="line">Flaskä¸­çš„gçš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskä¸­ä¸Šä¸‹æ–‡ç®¡ç†ä¸»è¦æ¶‰åŠåˆ°äº†é‚£äº›ç›¸å…³çš„ç±»ï¼Ÿå¹¶æè¿°ç±»ä¸»è¦ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä¸ºä»€ä¹ˆè¦FlaskæŠŠLocalå¯¹è±¡ä¸­çš„çš„å€¼stack ç»´æŠ¤æˆä¸€ä¸ªåˆ—è¡¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskä¸­å¤šappåº”ç”¨æ˜¯æ€ä¹ˆå®Œæˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">åœ¨Flaskä¸­å®ç°WebSocketéœ€è¦ä»€ä¹ˆç»„ä»¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">wtformsç»„ä»¶çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskæ¡†æ¶é»˜è®¤sessionå¤„ç†æœºåˆ¶ï¼Ÿ</span><br><span class="line"></span><br><span class="line">è§£é‡ŠFlaskæ¡†æ¶ä¸­çš„Localå¯¹è±¡å’Œthreading.localå¯¹è±¡çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">Flaskä¸­ blinker æ˜¯ä»€ä¹ˆï¼Ÿ</span><br><span class="line"></span><br><span class="line">SQLAlchemyä¸­çš„ sessionå’Œscoped_session çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line"></span><br><span class="line">SQLAlchemyå¦‚ä½•æ‰§è¡ŒåŸç”ŸSQLï¼Ÿ</span><br><span class="line"></span><br><span class="line">ORMçš„å®ç°åŸç†ï¼Ÿ</span><br><span class="line"></span><br><span class="line">DBUtilsæ¨¡å—çš„ä½œç”¨ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ä»¥ä¸‹SQLAlchemyçš„å­—æ®µæ˜¯å¦æ­£ç¡®ï¼Ÿå¦‚æœä¸æ­£ç¡®è¯·æ›´æ­£ï¼š</span><br></pre></td></tr></table></figure>
<p>from datetime import datetime<br>â€¨from sqlalchemy.ext.declarative<br>import declarative_base<br>â€¨from sqlalchemy import Column, Integer, String, DateTime<br>â€¨â€¨<br>Base = declarative_base()â€¨â€¨<br>class UserInfo(Base):â€¨<br>    <strong>tablename</strong> = â€˜userinfoâ€™â€¨<br>    id = Column(Integer, primary_key=True, autoincrement=True)â€¨<br>    name = Column(String(64), unique=True)â€¨<br>    ctime = Column(DateTime, default=datetime.now())</p>
<p>```<br>SQLAchemyä¸­å¦‚ä½•ä¸ºè¡¨è®¾ç½®å¼•æ“å’Œå­—ç¬¦ç¼–ç ï¼Ÿ</p>
<p>SQLAchemyä¸­å¦‚ä½•è®¾ç½®è”åˆå”¯ä¸€ç´¢å¼•ï¼Ÿ</p>
<p>ç®€è¿°Tornadoæ¡†æ¶çš„ç‰¹ç‚¹ã€‚</p>
<p>ç®€è¿°Tornadoæ¡†æ¶ä¸­Futureå¯¹è±¡çš„ä½œç”¨ï¼Ÿ</p>
<p>Tornadoæ¡†æ¶ä¸­å¦‚ä½•ç¼–å†™WebSocketç¨‹åºï¼Ÿ</p>
<p>Tornadoä¸­é™æ€æ–‡ä»¶æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿâ€¨å¦‚ï¼š</p>
<p>Tornadoæ“ä½œMySQLä½¿ç”¨çš„æ¨¡å—ï¼Ÿ</p>
<p>Tornadoæ“ä½œredisä½¿ç”¨çš„æ¨¡å—ï¼Ÿ</p>
<p>ç®€è¿°Tornadoæ¡†æ¶çš„é€‚ç”¨åœºæ™¯ï¼Ÿ</p>
<p>gitå¸¸è§å‘½ä»¤ä½œç”¨ï¼š</p>
<p>ç®€è¿°ä»¥ä¸‹gitä¸­stashå‘½ä»¤ä½œç”¨ä»¥åŠç›¸å…³å…¶ä»–å‘½ä»¤ã€‚</p>
<p>git ä¸­ merge å’Œ rebaseå‘½ä»¤ çš„åŒºåˆ«ã€‚</p>
<p>å…¬å¸å¦‚ä½•åŸºäºgitåšçš„ååŒå¼€å‘ï¼Ÿ</p>
<p>å¦‚ä½•åŸºäºgitå®ç°ä»£ç reviewï¼Ÿ</p>
<p>gitå¦‚ä½•å®ç°v1.0 ã€v2.0 ç­‰ç‰ˆæœ¬çš„ç®¡ç†ï¼Ÿ</p>
<p>ä»€ä¹ˆæ˜¯gitlabï¼Ÿ</p>
<p>githubå’Œgitlabçš„åŒºåˆ«ï¼Ÿ</p>
<p>å¦‚ä½•ä¸ºgithubä¸Šç‰›é€¼çš„å¼€æºé¡¹ç›®è´¡çŒ®ä»£ç ï¼Ÿ</p>
<p>gitä¸­ .gitignoreæ–‡ä»¶çš„ä½œç”¨?</p>
<p>ä»€ä¹ˆæ˜¯æ•æ·å¼€å‘ï¼Ÿ</p>
<p>ç®€è¿° jenkins å·¥å…·çš„ä½œç”¨?</p>
<p>å…¬å¸å¦‚ä½•å®ç°ä»£ç å‘å¸ƒï¼Ÿ</p>
<p>ç®€è¿° RabbitMQã€Kafkaã€ZeroMQçš„åŒºåˆ«ï¼Ÿ</p>
<p>RabbitMQå¦‚ä½•åœ¨æ¶ˆè´¹è€…è·å–ä»»åŠ¡åæœªå¤„ç†å®Œå‰å°±æŒ‚æ‰æ—¶ï¼Œä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Ÿ</p>
<p>RabbitMQå¦‚ä½•å¯¹æ¶ˆæ¯åšæŒä¹…åŒ–ï¼Ÿ</p>
<p>RabbitMQå¦‚ä½•æ§åˆ¶æ¶ˆæ¯è¢«æ¶ˆè´¹çš„é¡ºåºï¼Ÿ</p>
<p>ä»¥ä¸‹RabbitMQçš„exchange typeåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Ÿå¦‚ï¼šfanoutã€directã€topicã€‚</p>
<p>ç®€è¿° celery æ˜¯ä»€ä¹ˆä»¥åŠåº”ç”¨åœºæ™¯ï¼Ÿ</p>
<p>ç®€è¿°celeryè¿è¡Œæœºåˆ¶ã€‚</p>
<p>celeryå¦‚ä½•å®ç°å®šæ—¶ä»»åŠ¡ï¼Ÿ</p>
<p>ç®€è¿° celeryå¤šä»»åŠ¡ç»“æ„ç›®å½•ï¼Ÿ</p>
<p>celeryä¸­è£…é¥°å™¨ @app.task å’Œ @shared_taskçš„åŒºåˆ«ï¼Ÿ</p>
<p>ç®€è¿° requestsæ¨¡å—çš„ä½œç”¨åŠåŸºæœ¬ä½¿ç”¨ï¼Ÿ</p>
<p>ç®€è¿° beautifulsoupæ¨¡å—çš„ä½œç”¨åŠåŸºæœ¬ä½¿ç”¨ï¼Ÿ</p>
<p>ç®€è¿° seleninuæ¨¡å—çš„ä½œç”¨åŠåŸºæœ¬ä½¿ç”¨?</p>
<p>scrapyæ¡†æ¶ä¸­å„ç»„ä»¶çš„å·¥ä½œæµç¨‹ï¼Ÿ</p>
<p>åœ¨scrapyæ¡†æ¶ä¸­å¦‚ä½•è®¾ç½®ä»£ç†ï¼ˆä¸¤ç§æ–¹æ³•ï¼‰ï¼Ÿ</p>
<p>scrapyæ¡†æ¶ä¸­å¦‚ä½•å®ç°å¤§æ–‡ä»¶çš„ä¸‹è½½ï¼Ÿ</p>
<p>scrapyä¸­å¦‚ä½•å®ç°é™é€Ÿï¼Ÿ</p>
<p>scrapyä¸­å¦‚ä½•å®ç°æš‚å®šçˆ¬è™«ï¼Ÿ</p>
<p>scrapyä¸­å¦‚ä½•è¿›è¡Œè‡ªå®šåˆ¶å‘½ä»¤ï¼Ÿ</p>
<p>scrapyä¸­å¦‚ä½•å®ç°çš„è®°å½•çˆ¬è™«çš„æ·±åº¦ï¼Ÿ</p>
<p>scrapyä¸­çš„pipelineså·¥ä½œåŸç†ï¼Ÿ</p>
<p>scrapyçš„pipelineså¦‚ä½•ä¸¢å¼ƒä¸€ä¸ªitemå¯¹è±¡ï¼Ÿ</p>
<p>ç®€è¿°scrapyä¸­çˆ¬è™«ä¸­é—´ä»¶å’Œä¸‹è½½ä¸­é—´ä»¶çš„ä½œç”¨ï¼Ÿ</p>
<p>scrapy-redisç»„ä»¶çš„ä½œç”¨ï¼Ÿ</p>
<p>scrapy-redisç»„ä»¶ä¸­å¦‚ä½•å®ç°çš„ä»»åŠ¡çš„å»é‡ï¼Ÿ</p>
<p>scrapy-redisçš„è°ƒåº¦å™¨å¦‚ä½•å®ç°ä»»åŠ¡çš„æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆï¼Ÿ</p>
<p>ç®€è¿° vitualenv åŠåº”ç”¨åœºæ™¯?</p>
<p>ç®€è¿° pipreqs åŠåº”ç”¨åœºæ™¯ï¼Ÿ</p>
<p>åœ¨Pythonä¸­ä½¿ç”¨è¿‡ä»€ä¹ˆä»£ç æ£€æŸ¥å·¥å…·ï¼Ÿ</p>
<p>ç®€è¿° saltstackã€ansibleã€fabricã€puppetå·¥å…·çš„ä½œç”¨ï¼Ÿ</p>
<p>B Treeå’ŒB+ Treeçš„åŒºåˆ«ï¼Ÿ</p>
<p>è¯·åˆ—ä¸¾å¸¸è§æ’åºå¹¶é€šè¿‡ä»£ç å®ç°ä»»æ„ä¸‰ç§ã€‚</p>
<p>è¯·åˆ—ä¸¾å¸¸è§æŸ¥æ‰¾å¹¶é€šè¿‡ä»£ç å®ç°ä»»æ„ä¸‰ç§ã€‚</p>
<p>è¯·åˆ—ä¸¾ä½ ç†Ÿæ‚‰çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</p>
<p>æœ‰æ²¡æœ‰åˆ·è¿‡leetcodeï¼Ÿ</p>
<p>åˆ—ä¸¾ç†Ÿæ‚‰çš„çš„Linuxå‘½ä»¤ã€‚</p>
<p>å…¬å¸çº¿ä¸ŠæœåŠ¡å™¨æ˜¯ä»€ä¹ˆç³»ç»Ÿï¼Ÿ</p>
<p>è§£é‡Š PVã€UV çš„å«ä¹‰ï¼Ÿ</p>
<p>è§£é‡Š QPSçš„å«ä¹‰ï¼Ÿ</p>
<p>uwsgiå’Œwsgiçš„åŒºåˆ«ï¼Ÿ</p>
<p>supervisorçš„ä½œç”¨ï¼Ÿ</p>
<p>ä»€ä¹ˆæ˜¯åå‘ä»£ç†ï¼Ÿ</p>
<p>ç®€è¿°SSHçš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<p>æœ‰é—®é¢˜éƒ½å»é‚£äº›æ‰¾è§£å†³æ–¹æ¡ˆï¼Ÿ</p>
<p>æ˜¯å¦æœ‰å…³æ³¨ä»€ä¹ˆæŠ€æœ¯ç±»çš„å…¬ä¼—å·ï¼Ÿ</p>
<p>æœ€è¿‘åœ¨ç ”ç©¶ä»€ä¹ˆæ–°æŠ€æœ¯ï¼Ÿ</p>
<p>æ˜¯å¦äº†è§£è¿‡é¢†åŸŸé©±åŠ¨æ¨¡å‹ï¼Ÿ</p>
<p>ç»Ÿè®¡ï¼š80 + 34 + 46 + 155 = 315é¢˜</p>
<p>æš‚æ—¶å°±å…ˆè¿™æ ·å§ã€‚æˆ‘æƒ³èƒ½çœ‹åˆ°è¿™é‡Œçš„åŒå­¦ï¼Œæ— å¤–ä¹ä¸¤ç§äººï¼šæ¥æ‹·è´é¢˜çš„äºº å’Œ æ¥æ‹·è´é¢˜çš„äººã€‚</p>
<p>ä½†ï¼Œåœ¨æ‹·è´èµ°çš„æ—¶å€™ï¼Œä½ è¦æƒ³æ¸…æ¥šä¸€ä»¶äº‹ï¼ŒæŠŠé¢˜æ‹·èµ°ä¹‹åæœ‰ä¸ªè›‹ç”¨ï¼Œææ˜ç™½ç­”æ¡ˆå¯¹ä½ æ¥è¯´æ‰æ˜¯æœ€é‡è¦çš„ã€‚</p>
<p>å¥½äº†ï¼Œå°±é…±ç´«ã€‚</p>
<p>è€é“ï¼Œè¿™è¦æ˜¯éƒ½ä¸èµï¼Œè¯´ä¸è¿‡å»å§ï¼ï¼ï¼</p>
<p><a href="https://www.cnblogs.com/wupeiqi/p/9078770.html" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a>  </p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https</title>
    <url>/2020/04/20/nginx%E9%85%8D%E7%BD%AEhttp%E5%BC%BA%E5%88%B6%E8%B7%B3%E8%BD%AChttps/</url>
    <content><![CDATA[<h2 id="nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https"><a href="#nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https" class="headerlink" title="nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https"></a>nginxé…ç½®httpå¼ºåˆ¶è·³è½¬https</h2><blockquote>
<p>å¾ˆå¤šç½‘ç«™è™½ç„¶æ”¯æŒ https, ä½†æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ç½‘å€å, é»˜è®¤ä»æ˜¯ä»¥ http åè®®å»è®¿é—®çš„, http å¼ºåˆ¶è·³è½¬ https çš„éœ€æ±‚åº”è¿è€Œç”Ÿ, ä»¥ä¸‹ä»‹ç»ä¸‰ç§å®ç°çš„æ–¹å¼</p>
</blockquote>
<h3 id="rewrite-æ–¹æ³•"><a href="#rewrite-æ–¹æ³•" class="headerlink" title="rewrite æ–¹æ³•"></a>rewrite æ–¹æ³•</h3><p>è¿™æ˜¯æœ€å¸¸ç”¨çš„å®ç°æ–¹æ³•, å°†æ‰€æœ‰ http è¯·æ±‚é€šè¿‡ rewrite é‡å®šå‘åˆ° https å³å¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;  </span><br><span class="line">    listen  80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">      </span><br><span class="line">    rewrite ^(.*)$  https:&#x2F;&#x2F;$host$1 permanent; </span><br><span class="line">    # return 302 https:&#x2F;&#x2F;$host$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>497 çŠ¶æ€ç <br>error code 497: normal request was sent to HTTPS</p>
<p>åœ¨ä¸€ä¸ªç«™ç‚¹åªå…è®¸ https è®¿é—®æ—¶, å¦‚æœä½¿ç”¨ http è®¿é—®ä¼šæŠ¥å‡º497é”™è¯¯ç </p>
<p>åˆ©ç”¨497çŠ¶æ€ç é‡å®šå‘åˆ° https</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io</span><br><span class="line">    </span><br><span class="line">    error_page 497  https:&#x2F;&#x2F;$host$uri?$args;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="index-html-åˆ·æ–°ç½‘é¡µ"><a href="#index-html-åˆ·æ–°ç½‘é¡µ" class="headerlink" title="index.html åˆ·æ–°ç½‘é¡µ"></a>index.html åˆ·æ–°ç½‘é¡µ</h3><p>ä¸Šé¢ä¸¤ç§æ–¹æ³•å‡ä¼šè€—è´¹æœåŠ¡å™¨èµ„æº, æˆ‘ä»¬ä½¿ç”¨ curl æ¥çœ‹ä¸‹ç™¾åº¦æ˜¯å¦‚ä½•å®ç°çš„ baidu.com å‘ <a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a> çš„è·³è½¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl baidu.com -vv </span><br><span class="line">* Rebuilt URL to: baidu.com&#x2F;</span><br><span class="line">*   Trying 220.181.57.217...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to baidu.com (220.181.57.217) port 80 (#0)</span><br><span class="line">&gt; GET &#x2F; HTTP&#x2F;1.1</span><br><span class="line">&gt; Host: baidu.com</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.51.0</span><br><span class="line">&gt; Accept: *&#x2F;*</span><br><span class="line">&gt; </span><br><span class="line">&lt; HTTP&#x2F;1.1 200 OK</span><br><span class="line">&lt; Date: Sat, 01 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Server: Apache</span><br><span class="line">&lt; Last-Modified: Tue, 12 Jan 2010 13:48:00 GMT</span><br><span class="line">&lt; ETag: &quot;51-47cf7e6ee8400&quot;</span><br><span class="line">&lt; Accept-Ranges: bytes</span><br><span class="line">&lt; Content-Length: 81</span><br><span class="line">&lt; Cache-Control: max-age&#x3D;86400</span><br><span class="line">&lt; Expires: Sun, 02 Apr 2017 06:32:35 GMT</span><br><span class="line">&lt; Connection: Keep-Alive</span><br><span class="line">&lt; Content-Type: text&#x2F;html</span><br><span class="line">&lt; </span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0;url&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;&quot;&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">* Curl_http_done: called premature &#x3D;&#x3D; 0</span><br><span class="line">* Connection #0 to host baidu.com left intact</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ç™¾åº¦å¾ˆå·§å¦™çš„åˆ©ç”¨metaçš„åˆ·æ–°ä½œç”¨ï¼Œå°†baidu.comè·³è½¬åˆ°<a href="http://www.baidu.com" target="_blank" rel="noopener">www.baidu.com</a><br>åŒç†, æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§æ¥å®ç°httpå‘httpsçš„è·³è½¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># index.html</span><br><span class="line">&lt;html&gt;  </span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;refresh&quot; content&#x3D;&quot;0;url&#x3D;https:&#x2F;&#x2F;docs.lvrui.io&#x2F;&quot;&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    </span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        # å°† index.html æ–‡ä»¶æ”¾åˆ°ä¸‹é¢çš„ç›®å½•ä¸‹</span><br><span class="line">        root &#x2F;var&#x2F;www&#x2F;html&#x2F;refresh&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name docs.lvrui.io;</span><br><span class="line">    index index.html index.htm;</span><br><span class="line">    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;docs.log  main;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.crt;</span><br><span class="line">    ssl_certificate_key  &#x2F;etc&#x2F;ssl&#x2F;docs.20150509.cn.key;</span><br><span class="line">    error_page 404 &#x2F;404.html;</span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">	    root &#x2F;var&#x2F;www&#x2F;html&#x2F;docs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonä¸€äº›ä¸ä¸ºäººçŸ¥çš„å°æŠ€å·§</title>
    <url>/2020/04/20/python%E4%B8%80%E4%BA%9B%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="pythonä¸€äº›ä¸ä¸ºäººçŸ¥çš„å°æŠ€å·§"><a href="#pythonä¸€äº›ä¸ä¸ºäººçŸ¥çš„å°æŠ€å·§" class="headerlink" title="pythonä¸€äº›ä¸ä¸ºäººçŸ¥çš„å°æŠ€å·§"></a>pythonä¸€äº›ä¸ä¸ºäººçŸ¥çš„å°æŠ€å·§</h2><h3 id="startswith-å’Œendswith-å‚æ•°å¯ä»¥æ˜¯å…ƒç»„"><a href="#startswith-å’Œendswith-å‚æ•°å¯ä»¥æ˜¯å…ƒç»„" class="headerlink" title="startswith()å’Œendswith()å‚æ•°å¯ä»¥æ˜¯å…ƒç»„"></a>startswith()å’Œendswith()å‚æ•°å¯ä»¥æ˜¯å…ƒç»„</h3><p>å½“æ£€æµ‹å­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾æ—¶ï¼Œå¦‚æœæœ‰å¤šä¸ªæ£€æµ‹å€¼ï¼Œå¯ä»¥ç”¨å…ƒç»„ä½œä¸ºstartswith()å’Œendswith()å‚æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># bad</span><br><span class="line">if image.endswith(&#39;.jpg&#39;) or image.endswith(&#39;.png&#39;) or image.endswith(&#39;.gif&#39;):</span><br><span class="line">    pass</span><br><span class="line"># good</span><br><span class="line">if image.endswith((&#39;.jpg&#39;, &#39;.png&#39;, &#39;.gif&#39;)):</span><br><span class="line">    pass</span><br><span class="line"># bad</span><br><span class="line">if url.startswith(&#39;http:&#39;) or url.startswith(&#39;https:&#39;) or url.startswith(&#39;ftp:&#39;):</span><br><span class="line">    pass</span><br><span class="line"># good</span><br><span class="line">if url.startswith((&#39;http:&#39;, &#39;https:&#39;, &#39;ftp:&#39;)):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>

<h3 id="enumerate-è®¾ç½®startå‚æ•°åšä¸ºç´¢å¼•èµ·å§‹å€¼"><a href="#enumerate-è®¾ç½®startå‚æ•°åšä¸ºç´¢å¼•èµ·å§‹å€¼" class="headerlink" title="enumerate()è®¾ç½®startå‚æ•°åšä¸ºç´¢å¼•èµ·å§‹å€¼"></a>enumerate()è®¾ç½®startå‚æ•°åšä¸ºç´¢å¼•èµ·å§‹å€¼</h3><p>å½“ç”¨enumerate()è¿­ä»£åŒæ—¶è¦å¾—åˆ°ç´¢å¼•æ—¶ï¼Œå¯ä»¥è®¾ç½®startå‚æ•°ä½œä¸ºç´¢å¼•èµ·å§‹å€¼:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># bad</span><br><span class="line">for index, v in enumerate(data):</span><br><span class="line">    print(index+1, v)</span><br><span class="line"># good</span><br><span class="line">for index, v in enumerate(data, start&#x3D;1):</span><br><span class="line">    print(index, v)</span><br></pre></td></tr></table></figure>

<h3 id="å¯¹åˆ‡ç‰‡å‘½å"><a href="#å¯¹åˆ‡ç‰‡å‘½å" class="headerlink" title="å¯¹åˆ‡ç‰‡å‘½å"></a>å¯¹åˆ‡ç‰‡å‘½å</h3><p>å½“ä»£ç ä¸­åˆ°å¤„éƒ½æ˜¯ç¡¬ç¼–ç çš„åˆ‡ç‰‡ç´¢å¼•æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç å°†å˜å¾—æ— æ³•é˜…è¯»ã€‚å¯ä»¥å¯¹åˆ‡ç‰‡å‘½åè§£å†³æ­¤é—®é¢˜:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">record &#x3D; &#39;....................100.................513.25......&#39;</span><br><span class="line"># bad</span><br><span class="line">cost &#x3D; int(record[20:23]) * float(record[40:46])</span><br><span class="line"># good</span><br><span class="line">SHARES &#x3D; slice(20, 23)</span><br><span class="line">PRICE &#x3D; slice(40, 46)</span><br><span class="line">cost &#x3D; int(record[SHARES]) * float(record[PRICE])</span><br></pre></td></tr></table></figure>
<p>ä½œä¸ºä¸€æ¡åŸºæœ¬å‡†åˆ™ï¼Œä»£ç ä¸­å¦‚æœæœ‰å¾ˆå¤šç¡¬ç¼–ç çš„ç´¢å¼•å€¼ï¼Œå°†å¯¼è‡´å¯è¯»æ€§åˆå¯ç»´æŠ¤æ€§éƒ½ä¸ä½³ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå†…ç½®çš„slice()å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡å¯¹è±¡ï¼Œå¯ä»¥ç”¨åœ¨ä»»ä½•å…è®¸è¿›è¡Œåˆ‡ç‰‡æ“ä½œçš„åœ°æ–¹ã€‚ä¾‹å¦‚:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; items &#x3D; [0, 1, 2, 3, 4, 5, 6]</span><br><span class="line">&gt;&gt;&gt; a &#x3D; slice(2, 4)</span><br><span class="line">&gt;&gt;&gt; items[2:4]</span><br><span class="line">[2, 3]</span><br><span class="line">&gt;&gt;&gt; items[a]</span><br><span class="line">[2, 3]</span><br><span class="line">&gt;&gt;&gt; items[a] &#x3D; [-2, -3]</span><br><span class="line">&gt;&gt;&gt; items</span><br><span class="line">[0, 1, -2, -3, 4, 5, 6]</span><br><span class="line">&gt;&gt;&gt; del items[a]</span><br><span class="line">&gt;&gt;&gt; items</span><br><span class="line">[0, 1, 4, 5, 6]</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æº"><a href="#ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æº" class="headerlink" title="ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æº"></a>ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æº</h3><p>å‡è®¾ä½ è¦è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç»è¿‡å¤„ç†ä»¥åï¼Œå†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚ä½ èƒ½å†™å‡ºpythonicçš„ä»£ç ï¼Œæ‰€ä»¥ä½ ä½¿ç”¨äº†ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæ»¡æ„åœ°çš„å†™å‡ºäº†ä¸‹é¢è¿™æ ·çš„ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;input.txt&#39;, &#39;r&#39;) as source:</span><br><span class="line">    with open(&#39;output.txt&#39;, &#39;w&#39;) as target:</span><br><span class="line">        target.write(source.read())</span><br></pre></td></tr></table></figure>
<p>ä½ å·²ç»åšçš„å¾ˆå¥½äº†ï¼Œä½†æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œä¸Šé¢è¿™æ®µä»£ç è¿˜å¯ä»¥è¿™æ ·å†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">with open(&#39;input.txt&#39;, &#39;r&#39;) as source, open(&#39;output.txt&#39;, &#39;w&#39;) as target:</span><br><span class="line">    target.write(source.read())</span><br></pre></td></tr></table></figure>

<h3 id="elseå­å¥"><a href="#elseå­å¥" class="headerlink" title="elseå­å¥"></a>elseå­å¥</h3><p>Pythonä¸­çš„elseå­å¥ä¸ä»…èƒ½åœ¨ifè¯­å¥ä¸­ä½¿ç”¨ï¼Œè¿˜èƒ½åœ¨forã€whileã€å’Œtryè¯­å¥ä¸­ä½¿ç”¨ã€‚<br>åœ¨forå¾ªç¯æˆ–æ˜¯whileå¾ªç¯æ­£å¸¸è¿è¡Œå®Œæ¯•æ—¶ï¼ˆè€Œä¸æ˜¯é€šè¿‡breakè¯­å¥æˆ–æ˜¯returnè¯­å¥æˆ–æ˜¯å¼‚å¸¸é€€å‡ºå¾ªç¯ï¼‰ï¼Œæ‰ä¼šè¿è¡Œelseå—ã€‚<br>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for i in range(3):</span><br><span class="line">...     print(i)</span><br><span class="line">... else:</span><br><span class="line">...     print(&#39;Iterated over everything&#39;)</span><br><span class="line">... </span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">Iterated over everything</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šï¼Œforå¾ªç¯æ­£å¸¸ç»“æŸï¼Œæ‰€ä»¥è¿è¡Œäº†åé¢çš„elseå—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for i in range(3):</span><br><span class="line">...     if i &#x3D;&#x3D; 2:</span><br><span class="line">...         break</span><br><span class="line">...     print(i)</span><br><span class="line">... else:</span><br><span class="line">...     print(&#39;Iterated over everything&#39;)</span><br><span class="line">... </span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œforå¾ªç¯å¦‚æœæ²¡æœ‰æ­£å¸¸è¿è¡Œå®Œæ¯•ï¼ˆå¦‚ä¸Šé¢æ˜¯breakç»“æŸå¾ªç¯çš„ï¼‰ï¼Œæ˜¯ä¸ä¼šè¿è¡Œåé¢çš„elseå—ã€‚<br>ä»…å½“tryå—ä¸­æ²¡æœ‰å¼‚å¸¸æŠ›å‡ºæ—¶æ‰è¿è¡Œelseå—ã€‚ä¸€å¼€å§‹ï¼Œä½ å¯èƒ½è§‰å¾—æ²¡å¿…è¦åœ¨try/exceptå—ä¸­ä½¿ç”¨elseå­å¥ã€‚<br>æ¯•ç«Ÿï¼Œåœ¨ä¸‹è¿°ä»£ç ç‰‡æ®µä¸­ï¼Œåªæœ‰dangerous_call()ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œafter_call()æ‰ä¼šæ‰§è¡Œï¼Œå¯¹å§ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tryï¼š</span><br><span class="line">    dangerous_call()</span><br><span class="line">    after_call()</span><br><span class="line">except OSError:</span><br><span class="line">    log(&#39;OSError...&#39;)</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œï¼Œafter_call()ä¸åº”è¯¥æ”¾åœ¨tryå—ä¸­ã€‚ä¸ºäº†æ¸…æ™°æ˜ç¡®ï¼Œtryå—ä¸­åº”è¯¥åªåŒ…æ‹¬æŠ›å‡ºé¢„æœŸå¼‚å¸¸çš„è¯­å¥ã€‚å› æ­¤,ä¸‹é¢è¿™ç§å†™æ³•æ›´ä¼˜é›…:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">try:</span><br><span class="line">    dangerous_call()</span><br><span class="line">except OSError:</span><br><span class="line">    log(&#39;OSError...&#39;)</span><br><span class="line">else:</span><br><span class="line">    after_call()</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¾ˆæ˜ç¡®ï¼Œtryå—é˜²å®ˆçš„æ˜¯dangerous_call()å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯after_call()ã€‚è€Œä¸”å¾ˆæ˜æ˜¾ï¼Œåªæœ‰tryå—ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰ä¼šæ‰§è¡Œafter_call()ã€‚ä½†è¦æ³¨æ„ä¸€ç‚¹ï¼Œelseå­å¥æŠ›å‡ºçš„å¼‚å¸¸ä¸ä¼šç”±å‰é¢çš„exceptå­å¥å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶after_call()å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œå°†ä¸ä¼šè¢«æ•è·åˆ°ã€‚</p>
<h3 id="è„šæœ¬ä¸å‘½ä»¤è¡Œç»“åˆ"><a href="#è„šæœ¬ä¸å‘½ä»¤è¡Œç»“åˆ" class="headerlink" title="è„šæœ¬ä¸å‘½ä»¤è¡Œç»“åˆ"></a>è„šæœ¬ä¸å‘½ä»¤è¡Œç»“åˆ</h3><p>å¯ä»¥ä½¿ç”¨ä¸‹é¢æ–¹æ³•è¿è¡Œä¸€ä¸ªPythonè„šæœ¬ï¼Œåœ¨è„šæœ¬è¿è¡Œç»“æŸåï¼Œç›´æ¥è¿›å…¥Pythonå‘½ä»¤è¡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯è„šæœ¬çš„å¯¹è±¡ä¸ä¼šè¢«æ¸…ç©ºï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç›´æ¥è°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat hello.py</span><br><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;2&#x2F;7</span><br><span class="line"></span><br><span class="line">info &#x3D; &#123;&#39;name&#39;: &#39;shuke&#39;,&#39;age&#39;: 18&#125;</span><br><span class="line">li &#x3D; [1,2,3,4,&#39;A&#39;]</span><br><span class="line">const &#x3D; 1000</span><br><span class="line"># ç»“åˆå‘½ä»¤è¡Œ</span><br><span class="line">$ python -i hello.py</span><br><span class="line">&gt;&gt;&gt; info</span><br><span class="line">&#123;&#39;name&#39;: &#39;shuke&#39;, &#39;age&#39;: 18&#125;</span><br><span class="line">&gt;&gt;&gt; li</span><br><span class="line">[1, 2, 3, 4, &#39;A&#39;]</span><br><span class="line">&gt;&gt;&gt; const</span><br><span class="line">1000</span><br><span class="line">&gt;&gt;&gt; exit()</span><br></pre></td></tr></table></figure>

<h3 id="é»˜è®¤å­—å…¸çš„ç®€å•æ ‘çŠ¶è¡¨è¾¾"><a href="#é»˜è®¤å­—å…¸çš„ç®€å•æ ‘çŠ¶è¡¨è¾¾" class="headerlink" title="é»˜è®¤å­—å…¸çš„ç®€å•æ ‘çŠ¶è¡¨è¾¾"></a>é»˜è®¤å­—å…¸çš„ç®€å•æ ‘çŠ¶è¡¨è¾¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import json</span><br><span class="line">import collections</span><br><span class="line"></span><br><span class="line">tree &#x3D; lambda: collections.defaultdict(tree)</span><br><span class="line">root &#x3D; tree()</span><br><span class="line">root[&#39;menu&#39;][&#39;id&#39;] &#x3D; &#39;file&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;value&#39;] &#x3D; &#39;File&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;new&#39;][&#39;value&#39;] &#x3D; &#39;New&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;new&#39;][&#39;onclick&#39;] &#x3D; &#39;new();&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;open&#39;][&#39;value&#39;] &#x3D; &#39;Open&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;open&#39;][&#39;onclick&#39;] &#x3D; &#39;open();&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;close&#39;][&#39;value&#39;] &#x3D; &#39;Close&#39;</span><br><span class="line">root[&#39;menu&#39;][&#39;menuitems&#39;][&#39;close&#39;][&#39;onclick&#39;] &#x3D; &#39;close();&#39;</span><br><span class="line">print(json.dumps(root, sort_keys&#x3D;True, indent&#x3D;4, separators&#x3D;(&#39;,&#39;, &#39;: &#39;)))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">output: </span><br><span class="line">&#123;</span><br><span class="line">    &quot;menu&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: &quot;file&quot;,</span><br><span class="line">        &quot;menuitems&quot;: &#123;</span><br><span class="line">            &quot;close&quot;: &#123;</span><br><span class="line">                &quot;onclick&quot;: &quot;close();&quot;,</span><br><span class="line">                &quot;value&quot;: &quot;Close&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;new&quot;: &#123;</span><br><span class="line">                &quot;onclick&quot;: &quot;new();&quot;,</span><br><span class="line">                &quot;value&quot;: &quot;New&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;open&quot;: &#123;</span><br><span class="line">                &quot;onclick&quot;: &quot;open();&quot;,</span><br><span class="line">                &quot;value&quot;: &quot;Open&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;value&quot;: &quot;File&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3"><a href="#æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3" class="headerlink" title="æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)"></a>æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, *b, c &#x3D; [1, 2, 3, 4, 5]</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">[2, 3, 4]</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"><a href="#åˆ—è¡¨åˆ‡å‰²èµ‹å€¼" class="headerlink" title="åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"></a>åˆ—è¡¨åˆ‡å‰²èµ‹å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5]</span><br><span class="line">&gt;&gt;&gt; a[2:3] &#x3D; [0, 0]</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">[1, 2, 0, 0, 4, 5]</span><br><span class="line">&gt;&gt;&gt; a[1:1] &#x3D; [8, 9]</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">[1, 8, 9, 2, 0, 0, 4, 5]</span><br><span class="line">&gt;&gt;&gt; a[1:-1] &#x3D; []</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">[1, 5]</span><br></pre></td></tr></table></figure>

<h3 id="å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"><a href="#å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼" class="headerlink" title="å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"></a>å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5]</span><br><span class="line">&gt;&gt;&gt; LASTTHREE &#x3D; slice(-3, None)</span><br><span class="line">&gt;&gt;&gt; LASTTHREE</span><br><span class="line">slice(-3, None, None)</span><br><span class="line">&gt;&gt;&gt; a[LASTTHREE]</span><br><span class="line">[3, 4, 5]</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"><a href="#åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©" class="headerlink" title="åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"></a>åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">a &#x3D; [1, 2, 3]</span><br><span class="line">b &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span><br><span class="line"></span><br><span class="line">z &#x3D; zip(a, b)</span><br><span class="line"></span><br><span class="line">for i in zip(a, b):</span><br><span class="line">    print(i)</span><br><span class="line"></span><br><span class="line">for item in zip(*z):</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨å±•å¼€"><a href="#åˆ—è¡¨å±•å¼€" class="headerlink" title="åˆ—è¡¨å±•å¼€"></a>åˆ—è¡¨å±•å¼€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import itertools</span><br><span class="line">&gt;&gt;&gt; a &#x3D; [[1, 2], [3, 4], [5, 6]]</span><br><span class="line">&gt;&gt;&gt; list(itertools.chain.from_iterable(a))</span><br><span class="line">[1, 2, 3, 4, 5, 6]</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; sum(a, [])</span><br><span class="line">[1, 2, 3, 4, 5, 6]</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; [x for l in a for x in l]</span><br><span class="line">[1, 2, 3, 4, 5, 6]</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]</span><br><span class="line">&gt;&gt;&gt; [x for l1 in a for l2 in l1 for x in l2]</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]</span><br><span class="line"> </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, [3, 4], [[5, 6], [7, 8]]]</span><br><span class="line">&gt;&gt;&gt; flatten &#x3D; lambda x: [y for l in x for y in flatten(l)] if type(x) is list else [x]</span><br><span class="line">&gt;&gt;&gt; flatten(a)</span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; g &#x3D; (x ** 2 for x in range(5))</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">0</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">1</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">9</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">16</span><br><span class="line">&gt;&gt;&gt; next(g)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span><br><span class="line">StopIteration</span><br><span class="line">&gt;&gt;&gt; sum(x ** 3 for x in range(10))</span><br><span class="line">2025</span><br><span class="line">&gt;&gt;&gt; sum(x ** 3 for x in range(10) if x % 3 &#x3D;&#x3D; 1)</span><br><span class="line">408</span><br><span class="line"># è¿­ä»£å™¨ä¸­æ²¡æœ‰å¯è¿­ä»£å¯¹è±¡çš„æ—¶å€™ä¼šå¼•å‘StopIterationé”™è¯¯</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸setdefault"><a href="#å­—å…¸setdefault" class="headerlink" title="å­—å…¸setdefault"></a>å­—å…¸setdefault</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; request &#x3D; &#123;&#125;</span><br><span class="line">&gt;&gt;&gt; request.setdefault(None,[]).append(123)</span><br><span class="line">&gt;&gt;&gt; print(request)</span><br><span class="line">&#123;None: [123]&#125;</span><br><span class="line">&gt;&gt;&gt; request.setdefault(None,[]).append(456)</span><br><span class="line">&gt;&gt;&gt; print(request)</span><br><span class="line">&#123;None: [123, 456]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸æ¨å¯¼"><a href="#å­—å…¸æ¨å¯¼" class="headerlink" title="å­—å…¸æ¨å¯¼"></a>å­—å…¸æ¨å¯¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: x ** 2 for x in range(5)&#125;</span><br><span class="line">&gt;&gt;&gt; m</span><br><span class="line">&#123;0: 0, 1: 1, 2: 4, 3: 9, 4: 16&#125;</span><br><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: &#39;A&#39; + str(x) for x in range(10)&#125;</span><br><span class="line">&gt;&gt;&gt; m</span><br><span class="line">&#123;0: &#39;A0&#39;, 1: &#39;A1&#39;, 2: &#39;A2&#39;, 3: &#39;A3&#39;, 4: &#39;A4&#39;, 5: &#39;A5&#39;, 6: &#39;A6&#39;, 7: &#39;A7&#39;, 8: &#39;A8&#39;, 9: &#39;A9&#39;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸æ¨å¯¼åè½¬å­—å…¸"><a href="#å­—å…¸æ¨å¯¼åè½¬å­—å…¸" class="headerlink" title="å­—å…¸æ¨å¯¼åè½¬å­—å…¸"></a>å­—å…¸æ¨å¯¼åè½¬å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</span><br><span class="line">&gt;&gt;&gt; m</span><br><span class="line">&#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</span><br><span class="line">&gt;&gt;&gt; &#123;v: k for k, v in m.items()&#125;</span><br><span class="line">&#123;1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;, 4: &#39;d&#39;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‘½åå…ƒç»„"><a href="#å‘½åå…ƒç»„" class="headerlink" title="å‘½åå…ƒç»„"></a>å‘½åå…ƒç»„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Point &#x3D; collections.namedtuple(&#39;Point&#39;, [&#39;x&#39;, &#39;y&#39;])</span><br><span class="line">&gt;&gt;&gt; p &#x3D; Point(x&#x3D;1.0, y&#x3D;2.0)</span><br><span class="line">&gt;&gt;&gt; p</span><br><span class="line">Point(x&#x3D;1.0, y&#x3D;2.0)</span><br><span class="line">&gt;&gt;&gt; p.x</span><br><span class="line">1.0</span><br><span class="line">&gt;&gt;&gt; p.y</span><br><span class="line">2.0</span><br></pre></td></tr></table></figure>

<h3 id="ç»§æ‰¿å‘½åå…ƒç»„"><a href="#ç»§æ‰¿å‘½åå…ƒç»„" class="headerlink" title="ç»§æ‰¿å‘½åå…ƒç»„"></a>ç»§æ‰¿å‘½åå…ƒç»„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import collections</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Point(collections.namedtuple(&#39;PointBase&#39;, [&#39;x&#39;, &#39;y&#39;])):</span><br><span class="line">    __slots__ &#x3D; ()</span><br><span class="line"></span><br><span class="line">    def __add__(self, other):</span><br><span class="line">        return Point(x&#x3D;self.x + other.x, y&#x3D;self.y + other.y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p &#x3D; Point(x&#x3D;1.0, y&#x3D;2.0)</span><br><span class="line">q &#x3D; Point(x&#x3D;2.0, y&#x3D;3.0)</span><br><span class="line">print(p + q)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">Point(x&#x3D;3.0, y&#x3D;5.0)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="ç»Ÿè®¡åœ¨å¯è¿­ä»£å™¨ä¸­æœ€å¸¸å‡ºç°çš„å…ƒç´ "><a href="#ç»Ÿè®¡åœ¨å¯è¿­ä»£å™¨ä¸­æœ€å¸¸å‡ºç°çš„å…ƒç´ " class="headerlink" title="ç»Ÿè®¡åœ¨å¯è¿­ä»£å™¨ä¸­æœ€å¸¸å‡ºç°çš„å…ƒç´ "></a>ç»Ÿè®¡åœ¨å¯è¿­ä»£å™¨ä¸­æœ€å¸¸å‡ºç°çš„å…ƒç´ </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; A &#x3D; collections.Counter([1, 1, 2, 2, 3, 3, 3, 3, 4, 5, 6, 7])</span><br><span class="line">&gt;&gt;&gt; A</span><br><span class="line">Counter(&#123;3: 4, 1: 2, 2: 2, 4: 1, 5: 1, 6: 1, 7: 1&#125;)</span><br><span class="line">&gt;&gt;&gt; A.most_common(1)</span><br><span class="line">[(3, 4)]</span><br><span class="line">&gt;&gt;&gt; A.most_common(3)</span><br><span class="line">[(3, 4), (1, 2), (2, 2)]</span><br></pre></td></tr></table></figure>

<h3 id="ä¸¤ç«¯éƒ½å¯ä»¥æ“ä½œçš„é˜Ÿåˆ—"><a href="#ä¸¤ç«¯éƒ½å¯ä»¥æ“ä½œçš„é˜Ÿåˆ—" class="headerlink" title="ä¸¤ç«¯éƒ½å¯ä»¥æ“ä½œçš„é˜Ÿåˆ—"></a>ä¸¤ç«¯éƒ½å¯ä»¥æ“ä½œçš„é˜Ÿåˆ—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Q &#x3D; collections.deque()</span><br><span class="line">&gt;&gt;&gt; Q.append(1)</span><br><span class="line">&gt;&gt;&gt; Q.appendleft(2)</span><br><span class="line">&gt;&gt;&gt; Q.extend([3, 4])</span><br><span class="line">&gt;&gt;&gt; Q.extendleft([5, 6])</span><br><span class="line">&gt;&gt;&gt; Q</span><br><span class="line">deque([6, 5, 2, 1, 3, 4])</span><br><span class="line">&gt;&gt;&gt; Q.pop()</span><br><span class="line">4</span><br><span class="line">&gt;&gt;&gt; Q.popleft()</span><br><span class="line">6</span><br><span class="line">&gt;&gt;&gt; Q</span><br><span class="line">deque([5, 2, 1, 3])</span><br><span class="line">&gt;&gt;&gt; Q.rotate(3)</span><br><span class="line">&gt;&gt;&gt; Q</span><br><span class="line">deque([2, 1, 3, 5])</span><br><span class="line">&gt;&gt;&gt; Q.rotate(-3)</span><br><span class="line">&gt;&gt;&gt; Q</span><br><span class="line">deque([5, 2, 1, 3])</span><br></pre></td></tr></table></figure>

<h3 id="æœ‰æœ€å¤§é•¿åº¦çš„åŒç«¯é˜Ÿåˆ—"><a href="#æœ‰æœ€å¤§é•¿åº¦çš„åŒç«¯é˜Ÿåˆ—" class="headerlink" title="æœ‰æœ€å¤§é•¿åº¦çš„åŒç«¯é˜Ÿåˆ—"></a>æœ‰æœ€å¤§é•¿åº¦çš„åŒç«¯é˜Ÿåˆ—</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; last_three &#x3D; collections.deque(maxlen&#x3D;3)</span><br><span class="line">&gt;&gt;&gt; for i in range(10):</span><br><span class="line">...     last_three.append(i)</span><br><span class="line">...     print(&#39;,&#39;.join(str(x) for x in last_three))</span><br><span class="line">...</span><br><span class="line">0</span><br><span class="line">0,1</span><br><span class="line">0,1,2</span><br><span class="line">1,2,3</span><br><span class="line">2,3,4</span><br><span class="line">3,4,5</span><br><span class="line">4,5,6</span><br><span class="line">5,6,7</span><br><span class="line">6,7,8</span><br><span class="line">7,8,9</span><br></pre></td></tr></table></figure>

<h3 id="æœ€å¤§å’Œæœ€å°çš„å‡ ä¸ªåˆ—è¡¨å…ƒç´ "><a href="#æœ€å¤§å’Œæœ€å°çš„å‡ ä¸ªåˆ—è¡¨å…ƒç´ " class="headerlink" title="æœ€å¤§å’Œæœ€å°çš„å‡ ä¸ªåˆ—è¡¨å…ƒç´ "></a>æœ€å¤§å’Œæœ€å°çš„å‡ ä¸ªåˆ—è¡¨å…ƒç´ </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import random</span><br><span class="line">&gt;&gt;&gt; import heapq</span><br><span class="line">&gt;&gt;&gt; a &#x3D; [random.randint(0, 100) for __ in range(100)]</span><br><span class="line">&gt;&gt;&gt;  heapq.nsmallest(5, a)</span><br><span class="line">  File &quot;&lt;stdin&gt;&quot;, line 1</span><br><span class="line">    heapq.nsmallest(5, a)</span><br><span class="line">    ^</span><br><span class="line">IndentationError: unexpected indent</span><br><span class="line">&gt;&gt;&gt; heapq.nsmallest(5, a)</span><br><span class="line">[0, 1, 3, 4, 4]</span><br><span class="line">&gt;&gt;&gt; heapq.nlargest(5, a)</span><br><span class="line">[100, 99, 98, 97, 96]</span><br></pre></td></tr></table></figure>

<h3 id="ä¸¤ä¸ªåˆ—è¡¨çš„ç¬›å¡å°”ç§¯"><a href="#ä¸¤ä¸ªåˆ—è¡¨çš„ç¬›å¡å°”ç§¯" class="headerlink" title="ä¸¤ä¸ªåˆ—è¡¨çš„ç¬›å¡å°”ç§¯"></a>ä¸¤ä¸ªåˆ—è¡¨çš„ç¬›å¡å°”ç§¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import itertools</span><br><span class="line">&gt;&gt;&gt; for p in itertools.product([1, 2, 3], [4, 5]):</span><br><span class="line">...     print(p)</span><br><span class="line">...</span><br><span class="line">(1, 4)</span><br><span class="line">(1, 5)</span><br><span class="line">(2, 4)</span><br><span class="line">(2, 5)</span><br><span class="line">(3, 4)</span><br><span class="line">(3, 5)</span><br><span class="line">&gt;&gt;&gt; for p in itertools.product([0, 1], repeat&#x3D;4):</span><br><span class="line">...     print(&#39;&#39;.join(str(x) for x in p))</span><br><span class="line">...</span><br><span class="line">0000</span><br><span class="line">0001</span><br><span class="line">0010</span><br><span class="line">0011</span><br><span class="line">0100</span><br><span class="line">0101</span><br><span class="line">0110</span><br><span class="line">0111</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1110</span><br><span class="line">1111</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨ç»„åˆå’Œåˆ—è¡¨å…ƒç´ æ›¿ä»£ç»„åˆ"><a href="#åˆ—è¡¨ç»„åˆå’Œåˆ—è¡¨å…ƒç´ æ›¿ä»£ç»„åˆ" class="headerlink" title="åˆ—è¡¨ç»„åˆå’Œåˆ—è¡¨å…ƒç´ æ›¿ä»£ç»„åˆ"></a>åˆ—è¡¨ç»„åˆå’Œåˆ—è¡¨å…ƒç´ æ›¿ä»£ç»„åˆ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for c in itertools.combinations([1, 2, 3, 4, 5], 3):</span><br><span class="line">...     print(&#39;&#39;.join(str(x) for x in c))</span><br><span class="line">...</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">145</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">245</span><br><span class="line">345</span><br><span class="line">&gt;&gt;&gt; for c in itertools.combinations_with_replacement([1, 2, 3], 2):</span><br><span class="line">...     print(&#39;&#39;.join(str(x) for x in c))</span><br><span class="line">...</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">33</span><br></pre></td></tr></table></figure>

<h3 id="åˆ—è¡¨å…ƒç´ æ’åˆ—ç»„åˆ"><a href="#åˆ—è¡¨å…ƒç´ æ’åˆ—ç»„åˆ" class="headerlink" title="åˆ—è¡¨å…ƒç´ æ’åˆ—ç»„åˆ"></a>åˆ—è¡¨å…ƒç´ æ’åˆ—ç»„åˆ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; for p in itertools.permutations([1, 2, 3, 4]):</span><br><span class="line">...      print(&#39;&#39;.join(str(x) for x in p))</span><br><span class="line">...</span><br><span class="line">1234</span><br><span class="line">1243</span><br><span class="line">1324</span><br><span class="line">1342</span><br><span class="line">1423</span><br><span class="line">1432</span><br><span class="line">2134</span><br><span class="line">2143</span><br><span class="line">2314</span><br><span class="line">2341</span><br><span class="line">2413</span><br><span class="line">2431</span><br><span class="line">3124</span><br><span class="line">3142</span><br><span class="line">3214</span><br><span class="line">3241</span><br><span class="line">3412</span><br><span class="line">3421</span><br><span class="line">4123</span><br><span class="line">4132</span><br><span class="line">4213</span><br><span class="line">4231</span><br><span class="line">4312</span><br><span class="line">4321</span><br></pre></td></tr></table></figure>

<h3 id="å¯é“¾æ¥è¿­ä»£å™¨"><a href="#å¯é“¾æ¥è¿­ä»£å™¨" class="headerlink" title="å¯é“¾æ¥è¿­ä»£å™¨"></a>å¯é“¾æ¥è¿­ä»£å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4]</span><br><span class="line">&gt;&gt;&gt; for p in itertools.chain(itertools.combinations(a, 2), itertools.combinations(a, 3)):</span><br><span class="line">...     print(p)</span><br><span class="line">...</span><br><span class="line">(1, 2)</span><br><span class="line">(1, 3)</span><br><span class="line">(1, 4)</span><br><span class="line">(2, 3)</span><br><span class="line">(2, 4)</span><br><span class="line">(3, 4)</span><br><span class="line">(1, 2, 3)</span><br><span class="line">(1, 2, 4)</span><br><span class="line">(1, 3, 4)</span><br><span class="line">(2, 3, 4)</span><br><span class="line">&gt;&gt;&gt; for subset in itertools.chain.from_iterable(itertools.combinations(a, n) for n in range(len(a) + 1)):</span><br><span class="line">...      print(subset)</span><br><span class="line">...</span><br><span class="line">()</span><br><span class="line">(1,)</span><br><span class="line">(2,)</span><br><span class="line">(3,)</span><br><span class="line">(4,)</span><br><span class="line">(1, 2)</span><br><span class="line">(1, 3)</span><br><span class="line">(1, 4)</span><br><span class="line">(2, 3)</span><br><span class="line">(2, 4)</span><br><span class="line">(3, 4)</span><br><span class="line">(1, 2, 3)</span><br><span class="line">(1, 2, 4)</span><br><span class="line">(1, 3, 4)</span><br><span class="line">(2, 3, 4)</span><br><span class="line">(1, 2, 3, 4)</span><br></pre></td></tr></table></figure>

<h3 id="æ ¹æ®æ–‡ä»¶æŒ‡å®šåˆ—ç±»èš"><a href="#æ ¹æ®æ–‡ä»¶æŒ‡å®šåˆ—ç±»èš" class="headerlink" title="æ ¹æ®æ–‡ä»¶æŒ‡å®šåˆ—ç±»èš"></a>æ ¹æ®æ–‡ä»¶æŒ‡å®šåˆ—ç±»èš</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import itertools</span><br><span class="line">&gt;&gt;&gt; with open(&#39;contactlenses.csv&#39;, &#39;r&#39;) as infile:</span><br><span class="line">...     data &#x3D; [line.strip().split(&#39;,&#39;) for line in infile]</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt; data &#x3D; data[1:]</span><br><span class="line">&gt;&gt;&gt; def print_data(rows):</span><br><span class="line">...     print &#39;\n&#39;.join(&#39;\t&#39;.join(&#39;&#123;: &lt;16&#125;&#39;.format(s) for s in row) for row in rows)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; print_data(data)</span><br><span class="line">young               myope                   no                      reduced                 none</span><br><span class="line">young               myope                   no                      normal                  soft</span><br><span class="line">young               myope                   yes                     reduced                 none</span><br><span class="line">young               myope                   yes                     normal                  hard</span><br><span class="line">young               hypermetrope            no                      reduced                 none</span><br><span class="line">young               hypermetrope            no                      normal                  soft</span><br><span class="line">young               hypermetrope            yes                     reduced                 none</span><br><span class="line">young               hypermetrope            yes                     normal                  hard</span><br><span class="line">pre-presbyopic      myope                   no                      reduced                 none</span><br><span class="line">pre-presbyopic      myope                   no                      normal                  soft</span><br><span class="line">pre-presbyopic      myope                   yes                     reduced                 none</span><br><span class="line">pre-presbyopic      myope                   yes                     normal                  hard</span><br><span class="line">pre-presbyopic      hypermetrope            no                      reduced                 none</span><br><span class="line">pre-presbyopic      hypermetrope            no                      normal                  soft</span><br><span class="line">pre-presbyopic      hypermetrope            yes                     reduced                 none</span><br><span class="line">pre-presbyopic      hypermetrope            yes                     normal                  none</span><br><span class="line">presbyopic          myope                   no                      reduced                 none</span><br><span class="line">presbyopic          myope                   no                      normal                  none</span><br><span class="line">presbyopic          myope                   yes                     reduced                 none</span><br><span class="line">presbyopic          myope                   yes                     normal                  hard</span><br><span class="line">presbyopic          hypermetrope            no                      reduced                 none</span><br><span class="line">presbyopic          hypermetrope            no                      normal                  soft</span><br><span class="line">presbyopic          hypermetrope            yes                     reduced                 none</span><br><span class="line">presbyopic          hypermetrope            yes                     normal                  none</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; data.sort(key&#x3D;lambda r: r[-1])</span><br><span class="line">&gt;&gt;&gt; for value, group in itertools.groupby(data, lambda r: r[-1]):</span><br><span class="line">...     print &#39;-----------&#39;</span><br><span class="line">...     print &#39;Group: &#39; + value</span><br><span class="line">...     print_data(group)</span><br><span class="line">...</span><br><span class="line">-----------</span><br><span class="line">Group: hard</span><br><span class="line">young               myope                   yes                     normal                  hard</span><br><span class="line">young               hypermetrope            yes                     normal                  hard</span><br><span class="line">pre-presbyopic      myope                   yes                     normal                  hard</span><br><span class="line">presbyopic          myope                   yes                     normal                  hard</span><br><span class="line">-----------</span><br><span class="line">Group: none</span><br><span class="line">young               myope                   no                      reduced                 none</span><br><span class="line">young               myope                   yes                     reduced                 none</span><br><span class="line">young               hypermetrope            no                      reduced                 none</span><br><span class="line">young               hypermetrope            yes                     reduced                 none</span><br><span class="line">pre-presbyopic      myope                   no                      reduced                 none</span><br><span class="line">pre-presbyopic      myope                   yes                     reduced                 none</span><br><span class="line">pre-presbyopic      hypermetrope            no                      reduced                 none</span><br><span class="line">pre-presbyopic      hypermetrope            yes                     reduced                 none</span><br><span class="line">pre-presbyopic      hypermetrope            yes                     normal                  none</span><br><span class="line">presbyopic          myope                   no                      reduced                 none</span><br><span class="line">presbyopic          myope                   no                      normal                  none</span><br><span class="line">presbyopic          myope                   yes                     reduced                 none</span><br><span class="line">presbyopic          hypermetrope            no                      reduced                 none</span><br><span class="line">presbyopic          hypermetrope            yes                     reduced                 none</span><br><span class="line">presbyopic          hypermetrope            yes                     normal                  none</span><br><span class="line">-----------</span><br><span class="line">Group: soft</span><br><span class="line">young               myope                   no                      normal                  soft</span><br><span class="line">young               hypermetrope            no                      normal                  soft</span><br><span class="line">pre-presbyopic      myope                   no                      normal                  soft</span><br><span class="line">pre-presbyopic      hypermetrope            no                      normal                  soft</span><br><span class="line">presbyopic          hypermetrope            no                      normal                  soft</span><br></pre></td></tr></table></figure>

<h3 id="æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²"><a href="#æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²" class="headerlink" title="æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²"></a>æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²</h3><p>æŒ‰å•è¯åè½¬å­—ç¬¦ä¸²æ˜¯ä¸€é“å¾ˆå¸¸è§çš„é¢è¯•é¢˜ã€‚åœ¨Pythonä¸­å®ç°èµ·æ¥éå¸¸ç®€å•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def reverse_string_by_word(s):</span><br><span class="line">    lst &#x3D; s.split()  # split by blank space by default</span><br><span class="line">    return &#39; &#39;.join(lst[::-1])</span><br><span class="line"></span><br><span class="line">s &#x3D; &#39;Power of Love&#39;</span><br><span class="line">print reverse_string_by_word(s)</span><br><span class="line"># Love of Power</span><br><span class="line"></span><br><span class="line">s &#x3D; &#39;Hello    World!&#39;</span><br><span class="line">print reverse_string_by_word(s)</span><br><span class="line"># World! Hello</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å®ç°å…¶å®å·²ç»èƒ½æ»¡è¶³å¤§å¤šæ•°æƒ…å†µï¼Œä½†æ˜¯å¹¶ä¸å®Œç¾ã€‚æ¯”å¦‚ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ä¸­çš„æ„Ÿå¹å·å¹¶æ²¡æœ‰è¢«ç¿»è½¬ï¼Œè€Œä¸”åŸå­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼æ•°é‡ä¹Ÿæ²¡æœ‰ä¿ç•™ã€‚ï¼ˆåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œå…¶å®Helloå’ŒWorldä¹‹é—´ä¸æ­¢ä¸€ä¸ªç©ºæ ¼ï¼‰</p>
<p>æˆ‘ä»¬æœŸæœ›çš„ç»“æœåº”è¯¥æ˜¯è¿™æ ·å­çš„:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print reverse_string_by_word(s)</span><br><span class="line"># Expected: !World  Hello</span><br></pre></td></tr></table></figure>
<p>è¦æ”¹è¿›ä¸Šé¢çš„æ–¹æ¡ˆè¿˜ä¸æŠŠé—®é¢˜å¤æ‚åŒ–ï¼Œæ¨èä½¿ç”¨reæ¨¡å—ã€‚ä½ å¯ä»¥æŸ¥é˜…re.split() çš„å®˜æ–¹æ–‡æ¡£ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å…·ä½“ä¾‹å­</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; import re</span><br><span class="line">&gt;&gt;&gt; s &#x3D; &#39;Hello  World!&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; re.split(r&#39;\s+&#39;, s)    # will discard blank spaces</span><br><span class="line">[&#39;Hello&#39;, &#39;World!&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; re.split(r&#39;(\s+)&#39;, s)  # will keep spaces as a group</span><br><span class="line">[&#39;Hello&#39;, &#39;  &#39;, &#39;World!&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; s &#x3D; &#39;&lt; Welcome to EF.COM! &gt;&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; re.split(r&#39;\s+&#39;, s)  # split by spaces</span><br><span class="line">[&#39;&lt;&#39;, &#39;Welcome&#39;, &#39;to&#39;, &#39;EF.COM!&#39;, &#39;&gt;&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; re.split(r&#39;(\w+)&#39;, s)  # exactly split by word</span><br><span class="line">[&#39;&lt; &#39;, &#39;Welcome&#39;, &#39; &#39;, &#39;to&#39;, &#39; &#39;, &#39;EF&#39;, &#39;.&#39;, &#39;COM&#39;, &#39;! &gt;&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; re.split(r&#39;(\s+|\w+)&#39;, s)  # split by space and word</span><br><span class="line">[&#39;&lt;&#39;, &#39; &#39;, &#39;&#39;, &#39;Welcome&#39;, &#39;&#39;, &#39; &#39;, &#39;&#39;, &#39;to&#39;, &#39;&#39;, &#39; &#39;, &#39;&#39;, &#39;EF&#39;, &#39;.&#39;, &#39;COM&#39;, &#39;!&#39;, &#39; &#39;, &#39;&gt;&#39;]</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &#39;&#39;.join(re.split(r&#39;(\s+|\w+)&#39;, s)[::-1])</span><br><span class="line">&#39;&gt; !COM.EF to Welcome &lt;&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &#39;&#39;.join(re.split(r&#39;(\s+)&#39;, s)[::-1])</span><br><span class="line">&#39;&gt; EF.COM! to Welcome &lt;&#39;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; &#39;&#39;.join(re.split(r&#39;(\w+)&#39;, s)[::-1])</span><br><span class="line">&#39;! &gt;COM.EF to Welcome&lt; &#39;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ è§‰å¾—ç”¨åˆ‡ç‰‡å°†åºåˆ—å€’åºå¯è¯»æ€§ä¸é«˜ï¼Œé‚£ä¹ˆå…¶å®ä¹Ÿå¯ä»¥è¿™æ ·å†™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; &#39;&#39;.join(reversed(re.split(r&#39;(\s+|\w+)&#39;, s)))</span><br><span class="line">&#39;&gt; !COM.EF to Welcome &lt;</span><br></pre></td></tr></table></figure>


<p><a href="http://blog.jobbole.com/63320/" target="_blank" rel="noopener">30ä¸ªæœ‰å…³Pythonçš„å°æŠ€å·§</a><br><a href="http://www.revotu.com/most-common-learn-python-questions.html" target="_blank" rel="noopener">Pythonå­¦ä¹ ä¹‹è·¯ä¸Šçš„å‡ ä¸ªç»å…¸é—®é¢˜|å¤§å¸ˆå…„</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonæ“ä½œRedis</title>
    <url>/2020/04/20/python%E6%93%8D%E4%BD%9CRedis/</url>
    <content><![CDATA[<h2 id="pythonæ“ä½œRedis"><a href="#pythonæ“ä½œRedis" class="headerlink" title="pythonæ“ä½œRedis"></a>pythonæ“ä½œRedis</h2><h2 id="ä¸€-Redisæ˜¯ä»€ä¹ˆ"><a href="#ä¸€-Redisæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€. Redisæ˜¯ä»€ä¹ˆ"></a>ä¸€. Redisæ˜¯ä»€ä¹ˆ</h2><blockquote>
<p>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSDè®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ã€‚ å®ƒæ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ï¼Œ æ•£åˆ—ï¼ˆhashesï¼‰ï¼Œ åˆ—è¡¨ï¼ˆlistsï¼‰ï¼Œ é›†åˆï¼ˆsetsï¼‰ï¼Œ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ ä¸èŒƒå›´æŸ¥è¯¢ï¼Œ bitmapsï¼Œ hyperloglogs å’Œ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ ç´¢å¼•åŠå¾„æŸ¥è¯¢ã€‚ Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨ åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰<br><a href="https://github.com/CyC2018/Interview-Notebook/blob/master/notes/Redis.md" target="_blank" rel="noopener">Interview-Notebook/Redis.md-Notebook-GitHub</a><br><a href="http://www.redis.cn/" target="_blank" rel="noopener">redis.cn</a>   </p>
</blockquote>
<h2 id="äºŒ-RedisåŸºæœ¬ä»‹ç»"><a href="#äºŒ-RedisåŸºæœ¬ä»‹ç»" class="headerlink" title="äºŒ. RedisåŸºæœ¬ä»‹ç»"></a>äºŒ. RedisåŸºæœ¬ä»‹ç»</h2><blockquote>
<p>redisæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿã€‚å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬string(å­—ç¬¦ä¸²)ã€list(é“¾è¡¨)ã€set(é›†åˆ)ã€zset(sorted set â€“æœ‰åºé›†åˆ)å’Œhashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush/popã€add/removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œredisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚åŒºåˆ«çš„æ˜¯redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥</p>
</blockquote>
<h3 id="2-1-Redisçš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"><a href="#2-1-Redisçš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨" class="headerlink" title="2.1 Redisçš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨"></a>2.1 Redisçš„å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨</h3><ul>
<li>å®‰è£…<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;download.redis.io&#x2F;releases&#x2F;redis-3.0.6.tar.gz</span><br><span class="line">tar xzf redis-3.0.6.tar.gz</span><br><span class="line">cd redis-3.0.6</span><br><span class="line">make</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨æœåŠ¡ç«¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">src&#x2F;redis-server</span><br></pre></td></tr></table></figure></li>
<li>å¯åŠ¨å®¢æˆ·ç«¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">src&#x2F;redis-cli</span><br><span class="line">redis&gt; set foo bar</span><br><span class="line">OK</span><br><span class="line">redis&gt; get foo</span><br><span class="line">&quot;bar&quot;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="2-2-pythonæ“ä½œredis"><a href="#2-2-pythonæ“ä½œredis" class="headerlink" title="2.2 pythonæ“ä½œredis"></a>2.2 pythonæ“ä½œredis</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install redis</span><br><span class="line">or</span><br><span class="line">easy_install redis</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/WoLpH/redis-py" target="_blank" rel="noopener">GitHub - WoLpH/redis-py: Redis Python Client-æºç å®‰è£…</a></p>
<h2 id="ä¸‰-APIä½¿ç”¨"><a href="#ä¸‰-APIä½¿ç”¨" class="headerlink" title="ä¸‰. APIä½¿ç”¨"></a>ä¸‰. APIä½¿ç”¨</h2><p>redis-py çš„APIçš„ä½¿ç”¨å¯ä»¥åˆ†ç±»ä¸º:</p>
<ul>
<li>è¿æ¥æ–¹å¼<ul>
<li>ç›´æ¥è¿æ¥</li>
<li>è¿æ¥æ± </li>
</ul>
</li>
<li>æ“ä½œ<ul>
<li>String æ“ä½œ</li>
<li>Hash æ“ä½œ</li>
<li>List æ“ä½œ</li>
<li>Set æ“ä½œ</li>
<li>Sort Set æ“ä½œ</li>
</ul>
</li>
<li>ç®¡é“</li>
<li>å‘å¸ƒè®¢é˜…</li>
</ul>
<h2 id="å››-è¿æ¥æ–¹å¼"><a href="#å››-è¿æ¥æ–¹å¼" class="headerlink" title="å››. è¿æ¥æ–¹å¼"></a>å››. è¿æ¥æ–¹å¼</h2><h3 id="4-1-æ“ä½œæ¨¡å¼"><a href="#4-1-æ“ä½œæ¨¡å¼" class="headerlink" title="4.1 æ“ä½œæ¨¡å¼"></a>4.1 æ“ä½œæ¨¡å¼</h3><p>redis-pyæä¾›ä¸¤ä¸ªç±»Rediså’ŒStrictRedisç”¨äºå®ç°Redisçš„å‘½ä»¤ï¼ŒStrictRedisç”¨äºå®ç°å¤§éƒ¨åˆ†å®˜æ–¹çš„å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨å®˜æ–¹çš„è¯­æ³•å’Œå‘½ä»¤ï¼ŒRedisæ˜¯StrictRedisçš„å­ç±»ï¼Œç”¨äºå‘åå…¼å®¹æ—§ç‰ˆæœ¬çš„redis-py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">import redis</span><br><span class="line"></span><br><span class="line">r &#x3D; redis.Redis(host&#x3D;&#39;127.0.0.1&#39;, port&#x3D;6379)</span><br><span class="line">r.set(&#39;foo&#39;, &#39;Bar&#39;)</span><br><span class="line">print(r.get(&#39;foo&#39;))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">b&#39;Bar&#39;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>è¿æ¥redisï¼ŒåŠ ä¸Šdecode_responses=True,å†™å…¥é”®å€¼å¯¹ä¸­çš„valueä¸ºstrç±»å‹ï¼Œä¸åŠ è¿™ä¸ªå‚æ•°å†™å…¥çš„åˆ™ä¸ºå­—èŠ‚ç±»å‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import redis</span><br><span class="line"></span><br><span class="line">r &#x3D; redis.Redis(host&#x3D;&#39;127.0.0.1&#39;, port&#x3D;6379, decode_responses&#x3D;True)</span><br><span class="line">r.set(&#39;name&#39;, &#39;shuke&#39;)</span><br><span class="line">print(r.get(&#39;name&#39;))</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">shuke</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-è¿æ¥æ± "><a href="#4-2-è¿æ¥æ± " class="headerlink" title="4.2 è¿æ¥æ± "></a>4.2 è¿æ¥æ± </h3><p>redis-pyä½¿ç”¨connection poolæ¥ç®¡ç†å¯¹ä¸€ä¸ªredis serverçš„æ‰€æœ‰è¿æ¥ï¼Œé¿å…æ¯æ¬¡å»ºç«‹ã€é‡Šæ”¾è¿æ¥çš„å¼€é”€ã€‚é»˜è®¤ï¼Œæ¯ä¸ªRediså®ä¾‹éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè‡ªå·±çš„è¿æ¥æ± ã€‚å¯ä»¥ç›´æ¥å»ºç«‹ä¸€ä¸ªè¿æ¥æ± ï¼Œç„¶åä½œä¸ºå‚æ•°Redisï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¤šä¸ªRediså®ä¾‹å…±äº«ä¸€ä¸ªè¿æ¥æ± </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"> </span><br><span class="line">import redis</span><br><span class="line"></span><br><span class="line">pool &#x3D; redis.ConnectionPool(host&#x3D;&#39;127.0.0.1&#39;, port&#x3D;6379, decode_responses&#x3D;True)</span><br><span class="line"></span><br><span class="line">r &#x3D; redis.Redis(connection_pool&#x3D;pool)</span><br><span class="line">r.set(&#39;book&#39;, &#39;è¥¿æ¸¸è®°&#39;)</span><br><span class="line">print(r.get(&#39;book&#39;))</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">è¥¿æ¸¸è®°</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="äº”-String-æ“ä½œ"><a href="#äº”-String-æ“ä½œ" class="headerlink" title="äº”. String æ“ä½œ"></a>äº”. String æ“ä½œ</h2><p>Stringæ“ä½œï¼Œredisä¸­çš„Stringåœ¨åœ¨å†…å­˜ä¸­æŒ‰ç…§ä¸€ä¸ªnameå¯¹åº”ä¸€ä¸ªvalueæ¥å­˜å‚¨<br>Key|â€“&gt;|Value|<br>â€”-|â€”-|â€”-<br>k1|â€“&gt;|v1<br>k2|â€“&gt;|v2<br>k3|â€“&gt;|v3</p>
<ul>
<li>set(name, value, ex=None, px=None, nx=False, xx=False)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨Redisä¸­è®¾ç½®å€¼ï¼Œé»˜è®¤ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™ä¿®æ”¹</span><br><span class="line">å‚æ•°ï¼š</span><br><span class="line">     exï¼Œè¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span><br><span class="line">     pxï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span><br><span class="line">     nxï¼Œå¦‚æœè®¾ç½®ä¸ºTrueï¼Œåˆ™åªæœ‰nameä¸å­˜åœ¨æ—¶ï¼Œå½“å‰setæ“ä½œæ‰æ‰§è¡Œ</span><br><span class="line">     xxï¼Œå¦‚æœè®¾ç½®ä¸ºTrueï¼Œåˆ™åªæœ‰nameå­˜åœ¨æ—¶ï¼Œå²—å‰setæ“ä½œæ‰æ‰§è¡Œ</span><br></pre></td></tr></table></figure></li>
<li>setnx(name, value)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¾ç½®å€¼ï¼Œåªæœ‰nameä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œè®¾ç½®æ“ä½œ(æ·»åŠ )</span><br></pre></td></tr></table></figure></li>
<li>setex(name, value, time)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># è®¾ç½®å€¼</span><br><span class="line"># å‚æ•°ï¼š</span><br><span class="line">    # timeï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—ç§’ æˆ– timedeltaå¯¹è±¡ï¼‰</span><br><span class="line">&#96;&#96;&#96;&#96;    </span><br><span class="line">- psetex(name, time_ms, value)</span><br></pre></td></tr></table></figure>
<h1 id="è®¾ç½®å€¼"><a href="#è®¾ç½®å€¼" class="headerlink" title="è®¾ç½®å€¼"></a>è®¾ç½®å€¼</h1><h1 id="å‚æ•°ï¼š"><a href="#å‚æ•°ï¼š" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><h1 id="time-msï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—æ¯«ç§’-æˆ–-timedeltaå¯¹è±¡ï¼‰"><a href="#time-msï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—æ¯«ç§’-æˆ–-timedeltaå¯¹è±¡ï¼‰" class="headerlink" title="time_msï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—æ¯«ç§’ æˆ– timedeltaå¯¹è±¡ï¼‰"></a>time_msï¼Œè¿‡æœŸæ—¶é—´ï¼ˆæ•°å­—æ¯«ç§’ æˆ– timedeltaå¯¹è±¡ï¼‰</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- mset(args, *kwargs)</span><br></pre></td></tr></table></figure>
æ‰¹é‡è®¾ç½®å€¼<br>å¦‚ï¼š<br>  mset(k1=â€™v1â€™, k2=â€™v2â€™)<br>  æˆ–<br>  mset({â€˜k1â€™: â€˜v1â€™, â€˜k2â€™: â€˜v2â€™})<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- get(name)</span><br></pre></td></tr></table></figure>
è·å–å€¼<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- mget(keys, *args)</span><br></pre></td></tr></table></figure>
æ‰¹é‡è·å–<br>å¦‚ï¼š<br>  mget(â€˜nameâ€™, â€˜shukeâ€™)<br>  æˆ–<br>  r.mget([â€˜nameâ€™, â€˜shukeâ€™])<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- getset(name, value)</span><br></pre></td></tr></table></figure>
è®¾ç½®æ–°å€¼å¹¶è·å–åŸæ¥çš„å€¼<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- getrange(key, start, end)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å­åºåˆ—ï¼ˆæ ¹æ®å­—èŠ‚è·å–ï¼Œéå­—ç¬¦ï¼‰"><a href="#è·å–å­åºåˆ—ï¼ˆæ ¹æ®å­—èŠ‚è·å–ï¼Œéå­—ç¬¦ï¼‰" class="headerlink" title="è·å–å­åºåˆ—ï¼ˆæ ¹æ®å­—èŠ‚è·å–ï¼Œéå­—ç¬¦ï¼‰"></a>è·å–å­åºåˆ—ï¼ˆæ ¹æ®å­—èŠ‚è·å–ï¼Œéå­—ç¬¦ï¼‰</h1><h1 id="å‚æ•°ï¼š-1"><a href="#å‚æ•°ï¼š-1" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><h1 id="nameï¼ŒRedis-çš„-name"><a href="#nameï¼ŒRedis-çš„-name" class="headerlink" title="nameï¼ŒRedis çš„ name"></a>nameï¼ŒRedis çš„ name</h1><h1 id="startï¼Œèµ·å§‹ä½ç½®ï¼ˆå­—èŠ‚ï¼‰"><a href="#startï¼Œèµ·å§‹ä½ç½®ï¼ˆå­—èŠ‚ï¼‰" class="headerlink" title="startï¼Œèµ·å§‹ä½ç½®ï¼ˆå­—èŠ‚ï¼‰"></a>startï¼Œèµ·å§‹ä½ç½®ï¼ˆå­—èŠ‚ï¼‰</h1><h1 id="endï¼Œç»“æŸä½ç½®ï¼ˆå­—èŠ‚ï¼‰"><a href="#endï¼Œç»“æŸä½ç½®ï¼ˆå­—èŠ‚ï¼‰" class="headerlink" title="endï¼Œç»“æŸä½ç½®ï¼ˆå­—èŠ‚ï¼‰"></a>endï¼Œç»“æŸä½ç½®ï¼ˆå­—èŠ‚ï¼‰</h1><h1 id="å¦‚ï¼š-â€œæ­¦å¤§éƒâ€-ï¼Œ0-3è¡¨ç¤º-â€œæ­¦â€"><a href="#å¦‚ï¼š-â€œæ­¦å¤§éƒâ€-ï¼Œ0-3è¡¨ç¤º-â€œæ­¦â€" class="headerlink" title="å¦‚ï¼š â€œæ­¦å¤§éƒâ€ ï¼Œ0-3è¡¨ç¤º â€œæ­¦â€"></a>å¦‚ï¼š â€œæ­¦å¤§éƒâ€ ï¼Œ0-3è¡¨ç¤º â€œæ­¦â€</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- setrange(name, offset, value)</span><br></pre></td></tr></table></figure>
<h1 id="ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ï¼Œä»æŒ‡å®šå­—ç¬¦ä¸²ç´¢å¼•å¼€å§‹å‘åæ›¿æ¢ï¼ˆæ–°å€¼å¤ªé•¿æ—¶ï¼Œåˆ™å‘åæ·»åŠ ï¼‰"><a href="#ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ï¼Œä»æŒ‡å®šå­—ç¬¦ä¸²ç´¢å¼•å¼€å§‹å‘åæ›¿æ¢ï¼ˆæ–°å€¼å¤ªé•¿æ—¶ï¼Œåˆ™å‘åæ·»åŠ ï¼‰" class="headerlink" title="ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ï¼Œä»æŒ‡å®šå­—ç¬¦ä¸²ç´¢å¼•å¼€å§‹å‘åæ›¿æ¢ï¼ˆæ–°å€¼å¤ªé•¿æ—¶ï¼Œåˆ™å‘åæ·»åŠ ï¼‰"></a>ä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ï¼Œä»æŒ‡å®šå­—ç¬¦ä¸²ç´¢å¼•å¼€å§‹å‘åæ›¿æ¢ï¼ˆæ–°å€¼å¤ªé•¿æ—¶ï¼Œåˆ™å‘åæ·»åŠ ï¼‰</h1><h1 id="å‚æ•°ï¼š-2"><a href="#å‚æ•°ï¼š-2" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><h1 id="offsetï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œå­—èŠ‚ï¼ˆä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼‰"><a href="#offsetï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œå­—èŠ‚ï¼ˆä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼‰" class="headerlink" title="offsetï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œå­—èŠ‚ï¼ˆä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼‰"></a>offsetï¼Œå­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œå­—èŠ‚ï¼ˆä¸€ä¸ªæ±‰å­—ä¸‰ä¸ªå­—èŠ‚ï¼‰</h1><h1 id="valueï¼Œè¦è®¾ç½®çš„å€¼"><a href="#valueï¼Œè¦è®¾ç½®çš„å€¼" class="headerlink" title="valueï¼Œè¦è®¾ç½®çš„å€¼"></a>valueï¼Œè¦è®¾ç½®çš„å€¼</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- setbit(name, offset, value)</span><br></pre></td></tr></table></figure>
<h1 id="å¯¹nameå¯¹åº”å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ä½è¿›è¡Œæ“ä½œ"><a href="#å¯¹nameå¯¹åº”å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ä½è¿›è¡Œæ“ä½œ" class="headerlink" title="å¯¹nameå¯¹åº”å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ä½è¿›è¡Œæ“ä½œ"></a>å¯¹nameå¯¹åº”å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„ä½è¿›è¡Œæ“ä½œ</h1></li>
</ul>
<h1 id="å‚æ•°ï¼š-3"><a href="#å‚æ•°ï¼š-3" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# offsetï¼Œä½çš„ç´¢å¼•ï¼ˆå°†å€¼å˜æ¢æˆäºŒè¿›åˆ¶åå†è¿›è¡Œç´¢å¼•ï¼‰
# valueï¼Œå€¼åªèƒ½æ˜¯ 1 æˆ– 0</code></pre><h1 id="æ³¨ï¼šå¦‚æœåœ¨Redisä¸­æœ‰ä¸€ä¸ªå¯¹åº”ï¼š-n1-â€œfooâ€ï¼Œ"><a href="#æ³¨ï¼šå¦‚æœåœ¨Redisä¸­æœ‰ä¸€ä¸ªå¯¹åº”ï¼š-n1-â€œfooâ€ï¼Œ" class="headerlink" title="æ³¨ï¼šå¦‚æœåœ¨Redisä¸­æœ‰ä¸€ä¸ªå¯¹åº”ï¼š n1 = â€œfooâ€ï¼Œ"></a>æ³¨ï¼šå¦‚æœåœ¨Redisä¸­æœ‰ä¸€ä¸ªå¯¹åº”ï¼š n1 = â€œfooâ€ï¼Œ</h1><pre><code>    é‚£ä¹ˆå­—ç¬¦ä¸²fooçš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼š01100110 01101111 01101111
æ‰€ä»¥ï¼Œå¦‚æœæ‰§è¡Œ setbit(&apos;n1&apos;, 7, 1)ï¼Œåˆ™å°±ä¼šå°†ç¬¬7ä½è®¾ç½®ä¸º1ï¼Œ
    é‚£ä¹ˆæœ€ç»ˆäºŒè¿›åˆ¶åˆ™å˜æˆ 01100111 01101111 01101111ï¼Œå³ï¼š&quot;goo&quot;</code></pre><h1 id="æ‰©å±•ï¼Œè½¬æ¢äºŒè¿›åˆ¶è¡¨ç¤ºï¼š"><a href="#æ‰©å±•ï¼Œè½¬æ¢äºŒè¿›åˆ¶è¡¨ç¤ºï¼š" class="headerlink" title="æ‰©å±•ï¼Œè½¬æ¢äºŒè¿›åˆ¶è¡¨ç¤ºï¼š"></a>æ‰©å±•ï¼Œè½¬æ¢äºŒè¿›åˆ¶è¡¨ç¤ºï¼š</h1><pre><code># source = &quot;æ­¦æ²›é½&quot;
source = &quot;foo&quot;

for i in source:
    num = ord(i)
    print bin(num).replace(&apos;b&apos;,&apos;&apos;)

ç‰¹åˆ«çš„ï¼Œå¦‚æœsourceæ˜¯æ±‰å­— &quot;æ­¦æ²›é½&quot;æ€ä¹ˆåŠï¼Ÿ
ç­”ï¼šå¯¹äºutf-8ï¼Œæ¯ä¸€ä¸ªæ±‰å­—å  3 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆ &quot;æ­¦æ²›é½&quot; åˆ™æœ‰ 9ä¸ªå­—èŠ‚
   å¯¹äºæ±‰å­—ï¼Œforå¾ªç¯æ—¶å€™ä¼šæŒ‰ç…§ å­—èŠ‚ è¿­ä»£ï¼Œé‚£ä¹ˆåœ¨è¿­ä»£æ—¶ï¼Œå°†æ¯ä¸€ä¸ªå­—èŠ‚è½¬æ¢ åè¿›åˆ¶æ•°ï¼Œç„¶åå†å°†åè¿›åˆ¶æ•°è½¬æ¢æˆäºŒè¿›åˆ¶
    11100110 10101101 10100110 11100110 10110010 10011011 11101001 10111101 10010000
    -------------------------- ----------------------------- -----------------------------
                æ­¦                         æ²›                           é½</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- getbit(name, offset)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æŸä½çš„å€¼-ï¼ˆ0æˆ–1ï¼‰"><a href="#è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æŸä½çš„å€¼-ï¼ˆ0æˆ–1ï¼‰" class="headerlink" title="è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æŸä½çš„å€¼ ï¼ˆ0æˆ–1ï¼‰"></a>è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­çš„æŸä½çš„å€¼ ï¼ˆ0æˆ–1ï¼‰</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- bitcount(key, start&#x3D;None, end&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­-1-çš„ä¸ªæ•°"><a href="#è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­-1-çš„ä¸ªæ•°" class="headerlink" title="è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°"></a>è·å–nameå¯¹åº”çš„å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ 1 çš„ä¸ªæ•°</h1><h1 id="å‚æ•°ï¼š-4"><a href="#å‚æ•°ï¼š-4" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># keyï¼ŒRedisçš„name
# startï¼Œä½èµ·å§‹ä½ç½®
# endï¼Œä½ç»“æŸä½ç½®</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- bitop(operation, dest, *keys)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å¤šä¸ªå€¼ï¼Œå¹¶å°†å€¼åšä½è¿ç®—ï¼Œå°†æœ€åçš„ç»“æœä¿å­˜è‡³æ–°çš„nameå¯¹åº”çš„å€¼"><a href="#è·å–å¤šä¸ªå€¼ï¼Œå¹¶å°†å€¼åšä½è¿ç®—ï¼Œå°†æœ€åçš„ç»“æœä¿å­˜è‡³æ–°çš„nameå¯¹åº”çš„å€¼" class="headerlink" title="è·å–å¤šä¸ªå€¼ï¼Œå¹¶å°†å€¼åšä½è¿ç®—ï¼Œå°†æœ€åçš„ç»“æœä¿å­˜è‡³æ–°çš„nameå¯¹åº”çš„å€¼"></a>è·å–å¤šä¸ªå€¼ï¼Œå¹¶å°†å€¼åšä½è¿ç®—ï¼Œå°†æœ€åçš„ç»“æœä¿å­˜è‡³æ–°çš„nameå¯¹åº”çš„å€¼</h1><h1 id="å‚æ•°ï¼š-5"><a href="#å‚æ•°ï¼š-5" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># operation,ANDï¼ˆå¹¶ï¼‰ ã€ ORï¼ˆæˆ–ï¼‰ ã€ NOTï¼ˆéï¼‰ ã€ XORï¼ˆå¼‚æˆ–ï¼‰
# dest, æ–°çš„Redisçš„name
# *keys,è¦æŸ¥æ‰¾çš„Redisçš„name</code></pre><h1 id="å¦‚ï¼š"><a href="#å¦‚ï¼š" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code>bitop(&quot;AND&quot;, &apos;new_name&apos;, &apos;n1&apos;, &apos;n2&apos;, &apos;n3&apos;)
# è·å–Redisä¸­n1,n2,n3å¯¹åº”çš„å€¼ï¼Œç„¶åè®²æ‰€æœ‰çš„å€¼åšä½è¿ç®—ï¼ˆæ±‚å¹¶é›†ï¼‰ï¼Œç„¶åå°†ç»“æœä¿å­˜ new_name å¯¹åº”çš„å€¼ä¸­</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- strlen(name)</span><br></pre></td></tr></table></figure>
<h1 id="è¿”å›nameå¯¹åº”å€¼çš„å­—èŠ‚é•¿åº¦ï¼ˆä¸€ä¸ªæ±‰å­—3ä¸ªå­—èŠ‚ï¼‰"><a href="#è¿”å›nameå¯¹åº”å€¼çš„å­—èŠ‚é•¿åº¦ï¼ˆä¸€ä¸ªæ±‰å­—3ä¸ªå­—èŠ‚ï¼‰" class="headerlink" title="è¿”å›nameå¯¹åº”å€¼çš„å­—èŠ‚é•¿åº¦ï¼ˆä¸€ä¸ªæ±‰å­—3ä¸ªå­—èŠ‚ï¼‰"></a>è¿”å›nameå¯¹åº”å€¼çš„å­—èŠ‚é•¿åº¦ï¼ˆä¸€ä¸ªæ±‰å­—3ä¸ªå­—èŠ‚ï¼‰</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">- incr(self, name, amount&#x3D;1)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå¢-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚"><a href="#è‡ªå¢-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚" class="headerlink" title="è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚"></a>è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚</h1><h1 id="å‚æ•°ï¼š-6"><a href="#å‚æ•°ï¼š-6" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># name,Redisçš„name
# amount,è‡ªå¢æ•°ï¼ˆå¿…é¡»æ˜¯æ•´æ•°ï¼‰</code></pre><h1 id="æ³¨ï¼šåŒincrby"><a href="#æ³¨ï¼šåŒincrby" class="headerlink" title="æ³¨ï¼šåŒincrby"></a>æ³¨ï¼šåŒincrby</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- incrbyfloat(self, name, amount&#x3D;1.0)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå¢-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚-1"><a href="#è‡ªå¢-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚-1" class="headerlink" title="è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚"></a>è‡ªå¢ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå¢ã€‚</h1><h1 id="å‚æ•°ï¼š-7"><a href="#å‚æ•°ï¼š-7" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># name,Redisçš„name
# amount,è‡ªå¢æ•°ï¼ˆæµ®ç‚¹å‹)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- decr(self, name, amount&#x3D;1)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå‡-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå‡ã€‚"><a href="#è‡ªå‡-nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå‡ã€‚" class="headerlink" title="è‡ªå‡ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå‡ã€‚"></a>è‡ªå‡ nameå¯¹åº”çš„å€¼ï¼Œå½“nameä¸å­˜åœ¨æ—¶ï¼Œåˆ™åˆ›å»ºnameï¼amountï¼Œå¦åˆ™ï¼Œåˆ™è‡ªå‡ã€‚</h1><h1 id="å‚æ•°ï¼š-8"><a href="#å‚æ•°ï¼š-8" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># name,Redisçš„name
# amount,è‡ªå‡æ•°ï¼ˆæ•´æ•°ï¼‰</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">- append(key, value)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨redis-nameå¯¹åº”çš„å€¼åé¢è¿½åŠ å†…å®¹"><a href="#åœ¨redis-nameå¯¹åº”çš„å€¼åé¢è¿½åŠ å†…å®¹" class="headerlink" title="åœ¨redis nameå¯¹åº”çš„å€¼åé¢è¿½åŠ å†…å®¹"></a>åœ¨redis nameå¯¹åº”çš„å€¼åé¢è¿½åŠ å†…å®¹</h1><h1 id="å‚æ•°ï¼š-9"><a href="#å‚æ•°ï¼š-9" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code>key, redisçš„name
value, è¦è¿½åŠ çš„å­—ç¬¦ä¸²</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## å…­. Hash æ“ä½œ</span><br><span class="line">åœ¨redisä¸­å­˜å‚¨çš„ç»“æ„ä¸ºä¸‹è¡¨æ‰€ç¤º:</span><br><span class="line">Key|--&gt;|Value|</span><br><span class="line">----|----|----</span><br><span class="line">n1|--&gt;|k1-v1</span><br><span class="line">n2|--&gt;|k2-v2</span><br><span class="line">n3|--&gt;|k3-v3</span><br><span class="line"></span><br><span class="line">### 6.1 hset(name, key, value)</span><br></pre></td></tr></table></figure>
<h1 id="nameå¯¹åº”çš„hashä¸­è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›å¦åˆ™ï¼Œä¿®æ”¹ï¼‰"><a href="#nameå¯¹åº”çš„hashä¸­è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›å¦åˆ™ï¼Œä¿®æ”¹ï¼‰" class="headerlink" title="nameå¯¹åº”çš„hashä¸­è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›å¦åˆ™ï¼Œä¿®æ”¹ï¼‰"></a>nameå¯¹åº”çš„hashä¸­è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›å¦åˆ™ï¼Œä¿®æ”¹ï¼‰</h1><h1 id="å‚æ•°ï¼š-10"><a href="#å‚æ•°ï¼š-10" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# keyï¼Œnameå¯¹åº”çš„hashä¸­çš„key
# valueï¼Œnameå¯¹åº”çš„hashä¸­çš„value</code></pre><h1 id="æ³¨ï¼š"><a href="#æ³¨ï¼š" class="headerlink" title="æ³¨ï¼š"></a>æ³¨ï¼š</h1><pre><code># hsetnx(name, key, value),å½“nameå¯¹åº”çš„hashä¸­ä¸å­˜åœ¨å½“å‰keyæ—¶åˆ™åˆ›å»ºï¼ˆç›¸å½“äºæ·»åŠ ï¼‰</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.2 hmset(name, mapping)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„hashä¸­æ‰¹é‡è®¾ç½®é”®å€¼å¯¹"><a href="#åœ¨nameå¯¹åº”çš„hashä¸­æ‰¹é‡è®¾ç½®é”®å€¼å¯¹" class="headerlink" title="åœ¨nameå¯¹åº”çš„hashä¸­æ‰¹é‡è®¾ç½®é”®å€¼å¯¹"></a>åœ¨nameå¯¹åº”çš„hashä¸­æ‰¹é‡è®¾ç½®é”®å€¼å¯¹</h1><h1 id="å‚æ•°ï¼š-11"><a href="#å‚æ•°ï¼š-11" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# mappingï¼Œå­—å…¸ï¼Œå¦‚ï¼š{&apos;k1&apos;:&apos;v1&apos;, &apos;k2&apos;: &apos;v2&apos;}</code></pre><h1 id="å¦‚ï¼š-1"><a href="#å¦‚ï¼š-1" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># r.hmset(&apos;xx&apos;, {&apos;k1&apos;:&apos;v1&apos;, &apos;k2&apos;: &apos;v2&apos;})</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.3 hget(name,key)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„hashä¸­è·å–æ ¹æ®keyè·å–value"><a href="#åœ¨nameå¯¹åº”çš„hashä¸­è·å–æ ¹æ®keyè·å–value" class="headerlink" title="åœ¨nameå¯¹åº”çš„hashä¸­è·å–æ ¹æ®keyè·å–value"></a>åœ¨nameå¯¹åº”çš„hashä¸­è·å–æ ¹æ®keyè·å–value</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.4 hmget(name, keys, *args)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„hashä¸­è·å–å¤šä¸ªkeyçš„å€¼"><a href="#åœ¨nameå¯¹åº”çš„hashä¸­è·å–å¤šä¸ªkeyçš„å€¼" class="headerlink" title="åœ¨nameå¯¹åº”çš„hashä¸­è·å–å¤šä¸ªkeyçš„å€¼"></a>åœ¨nameå¯¹åº”çš„hashä¸­è·å–å¤šä¸ªkeyçš„å€¼</h1><h1 id="å‚æ•°ï¼š-12"><a href="#å‚æ•°ï¼š-12" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œreidså¯¹åº”çš„name
# keysï¼Œè¦è·å–keyé›†åˆï¼Œå¦‚ï¼š[&apos;k1&apos;, &apos;k2&apos;, &apos;k3&apos;]
# *argsï¼Œè¦è·å–çš„keyï¼Œå¦‚ï¼šk1,k2,k3</code></pre><h1 id="å¦‚ï¼š-2"><a href="#å¦‚ï¼š-2" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># r.mget(&apos;xx&apos;, [&apos;k1&apos;, &apos;k2&apos;])
# æˆ–
# print r.hmget(&apos;xx&apos;, &apos;k1&apos;, &apos;k2&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.5 hgetall(name)</span><br></pre></td></tr></table></figure>
<p>è·å–nameå¯¹åº”hashçš„æ‰€æœ‰é”®å€¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.6 hlen(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°"><a href="#è·å–nameå¯¹åº”çš„hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°" class="headerlink" title="è·å–nameå¯¹åº”çš„hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°"></a>è·å–nameå¯¹åº”çš„hashä¸­é”®å€¼å¯¹çš„ä¸ªæ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.7 hkeys(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„keyçš„å€¼"><a href="#è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„keyçš„å€¼" class="headerlink" title="è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„keyçš„å€¼"></a>è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„keyçš„å€¼</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.8 hvals(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„valueçš„å€¼"><a href="#è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„valueçš„å€¼" class="headerlink" title="è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„valueçš„å€¼"></a>è·å–nameå¯¹åº”çš„hashä¸­æ‰€æœ‰çš„valueçš„å€¼</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.9 hexists(name, key)</span><br></pre></td></tr></table></figure>
<h1 id="æ£€æŸ¥nameå¯¹åº”çš„hashæ˜¯å¦å­˜åœ¨å½“å‰ä¼ å…¥çš„key"><a href="#æ£€æŸ¥nameå¯¹åº”çš„hashæ˜¯å¦å­˜åœ¨å½“å‰ä¼ å…¥çš„key" class="headerlink" title="æ£€æŸ¥nameå¯¹åº”çš„hashæ˜¯å¦å­˜åœ¨å½“å‰ä¼ å…¥çš„key"></a>æ£€æŸ¥nameå¯¹åº”çš„hashæ˜¯å¦å­˜åœ¨å½“å‰ä¼ å…¥çš„key</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.10 hdel(name,\*keys)</span><br></pre></td></tr></table></figure>
<h1 id="å°†nameå¯¹åº”çš„hashä¸­æŒ‡å®škeyçš„é”®å€¼å¯¹åˆ é™¤"><a href="#å°†nameå¯¹åº”çš„hashä¸­æŒ‡å®škeyçš„é”®å€¼å¯¹åˆ é™¤" class="headerlink" title="å°†nameå¯¹åº”çš„hashä¸­æŒ‡å®škeyçš„é”®å€¼å¯¹åˆ é™¤"></a>å°†nameå¯¹åº”çš„hashä¸­æŒ‡å®škeyçš„é”®å€¼å¯¹åˆ é™¤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.11 hincrby(name, key, amount&#x3D;1)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount"><a href="#è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount" class="headerlink" title="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount"></a>è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount</h1><h1 id="å‚æ•°ï¼š-13"><a href="#å‚æ•°ï¼š-13" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisä¸­çš„name
# keyï¼Œ hashå¯¹åº”çš„key
# amountï¼Œè‡ªå¢æ•°ï¼ˆæ•´æ•°ï¼‰</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.12 hincrbyfloat(name, key, amount&#x3D;1.0)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount-1"><a href="#è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount-1" class="headerlink" title="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount"></a>è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount</h1><h1 id="å‚æ•°ï¼š-14"><a href="#å‚æ•°ï¼š-14" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisä¸­çš„name
# keyï¼Œ hashå¯¹åº”çš„key
# amountï¼Œè‡ªå¢æ•°ï¼ˆæµ®ç‚¹æ•°ï¼‰</code></pre><h1 id="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount-2"><a href="#è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey-amount-2" class="headerlink" title="è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount"></a>è‡ªå¢nameå¯¹åº”çš„hashä¸­çš„æŒ‡å®škeyçš„å€¼ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºkey=amount</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.13 hscan(name, cursor&#x3D;0, match&#x3D;None, count&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="å¢é‡å¼è¿­ä»£è·å–ï¼Œå¯¹äºæ•°æ®å¤§çš„æ•°æ®éå¸¸æœ‰ç”¨ï¼Œhscanå¯ä»¥å®ç°åˆ†ç‰‡çš„è·å–æ•°æ®ï¼Œå¹¶éä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨è·å–å®Œï¼Œä»è€Œæ”¾ç½®å†…å­˜è¢«æ’‘çˆ†"><a href="#å¢é‡å¼è¿­ä»£è·å–ï¼Œå¯¹äºæ•°æ®å¤§çš„æ•°æ®éå¸¸æœ‰ç”¨ï¼Œhscanå¯ä»¥å®ç°åˆ†ç‰‡çš„è·å–æ•°æ®ï¼Œå¹¶éä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨è·å–å®Œï¼Œä»è€Œæ”¾ç½®å†…å­˜è¢«æ’‘çˆ†" class="headerlink" title="å¢é‡å¼è¿­ä»£è·å–ï¼Œå¯¹äºæ•°æ®å¤§çš„æ•°æ®éå¸¸æœ‰ç”¨ï¼Œhscanå¯ä»¥å®ç°åˆ†ç‰‡çš„è·å–æ•°æ®ï¼Œå¹¶éä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨è·å–å®Œï¼Œä»è€Œæ”¾ç½®å†…å­˜è¢«æ’‘çˆ†"></a>å¢é‡å¼è¿­ä»£è·å–ï¼Œå¯¹äºæ•°æ®å¤§çš„æ•°æ®éå¸¸æœ‰ç”¨ï¼Œhscanå¯ä»¥å®ç°åˆ†ç‰‡çš„è·å–æ•°æ®ï¼Œå¹¶éä¸€æ¬¡æ€§å°†æ•°æ®å…¨éƒ¨è·å–å®Œï¼Œä»è€Œæ”¾ç½®å†…å­˜è¢«æ’‘çˆ†</h1><h1 id="å‚æ•°ï¼š-15"><a href="#å‚æ•°ï¼š-15" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# cursorï¼Œæ¸¸æ ‡ï¼ˆåŸºäºæ¸¸æ ‡åˆ†æ‰¹å–è·å–æ•°æ®ï¼‰
# matchï¼ŒåŒ¹é…æŒ‡å®škeyï¼Œé»˜è®¤None è¡¨ç¤ºæ‰€æœ‰çš„key
# countï¼Œæ¯æ¬¡åˆ†ç‰‡æœ€å°‘è·å–ä¸ªæ•°ï¼Œé»˜è®¤Noneè¡¨ç¤ºé‡‡ç”¨Redisçš„é»˜è®¤åˆ†ç‰‡ä¸ªæ•°</code></pre><h1 id="å¦‚ï¼š-3"><a href="#å¦‚ï¼š-3" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># ç¬¬ä¸€æ¬¡ï¼šcursor1, data1 = r.hscan(&apos;xx&apos;, cursor=0, match=None, count=None)
# ç¬¬äºŒæ¬¡ï¼šcursor2, data1 = r.hscan(&apos;xx&apos;, cursor=cursor1, match=None, count=None)
# ...
# ç›´åˆ°è¿”å›å€¼cursorçš„å€¼ä¸º0æ—¶ï¼Œè¡¨ç¤ºæ•°æ®å·²ç»é€šè¿‡åˆ†ç‰‡è·å–å®Œæ¯•</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 6.14 hscan_iter(name, match&#x3D;None, count&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="åˆ©ç”¨yieldå°è£…hscanåˆ›å»ºç”Ÿæˆå™¨ï¼Œå®ç°åˆ†æ‰¹å»redisä¸­è·å–æ•°æ®"><a href="#åˆ©ç”¨yieldå°è£…hscanåˆ›å»ºç”Ÿæˆå™¨ï¼Œå®ç°åˆ†æ‰¹å»redisä¸­è·å–æ•°æ®" class="headerlink" title="åˆ©ç”¨yieldå°è£…hscanåˆ›å»ºç”Ÿæˆå™¨ï¼Œå®ç°åˆ†æ‰¹å»redisä¸­è·å–æ•°æ®"></a>åˆ©ç”¨yieldå°è£…hscanåˆ›å»ºç”Ÿæˆå™¨ï¼Œå®ç°åˆ†æ‰¹å»redisä¸­è·å–æ•°æ®</h1><h1 id="å‚æ•°ï¼š-16"><a href="#å‚æ•°ï¼š-16" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># matchï¼ŒåŒ¹é…æŒ‡å®škeyï¼Œé»˜è®¤None è¡¨ç¤ºæ‰€æœ‰çš„key
# countï¼Œæ¯æ¬¡åˆ†ç‰‡æœ€å°‘è·å–ä¸ªæ•°ï¼Œé»˜è®¤Noneè¡¨ç¤ºé‡‡ç”¨Redisçš„é»˜è®¤åˆ†ç‰‡ä¸ªæ•°</code></pre><h1 id="å¦‚ï¼š-4"><a href="#å¦‚ï¼š-4" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># for item in r.hscan_iter(&apos;xx&apos;):
#     print(item)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## ä¸ƒ. List æ“ä½œ</span><br><span class="line">åœ¨redisä¸­å­˜å‚¨çš„ç»“æ„ä¸ºä¸‹è¡¨æ‰€ç¤º:</span><br><span class="line">Key|--&gt;|Value|</span><br><span class="line">----|----|----</span><br><span class="line">n1|--&gt;|v1,v2</span><br><span class="line">n2|--&gt;|v3,v4</span><br><span class="line">n3|--&gt;|v5,v6</span><br><span class="line"></span><br><span class="line">### 7.1 lpush(name,values)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œæ¯ä¸ªæ–°çš„å…ƒç´ éƒ½æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹"><a href="#åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œæ¯ä¸ªæ–°çš„å…ƒç´ éƒ½æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹" class="headerlink" title="åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œæ¯ä¸ªæ–°çš„å…ƒç´ éƒ½æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹"></a>åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œæ¯ä¸ªæ–°çš„å…ƒç´ éƒ½æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹</h1><h1 id="å¦‚ï¼š-5"><a href="#å¦‚ï¼š-5" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># r.lpush(&apos;oo&apos;, 11,22,33)
# ä¿å­˜é¡ºåºä¸º: 33,22,11</code></pre><h1 id="æ‰©å±•ï¼š"><a href="#æ‰©å±•ï¼š" class="headerlink" title="æ‰©å±•ï¼š"></a>æ‰©å±•ï¼š</h1><pre><code># rpush(name, values) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.2 lpushx(name,value)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œåªæœ‰nameå·²ç»å­˜åœ¨æ—¶ï¼Œå€¼æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹"><a href="#åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œåªæœ‰nameå·²ç»å­˜åœ¨æ—¶ï¼Œå€¼æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹" class="headerlink" title="åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œåªæœ‰nameå·²ç»å­˜åœ¨æ—¶ï¼Œå€¼æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹"></a>åœ¨nameå¯¹åº”çš„listä¸­æ·»åŠ å…ƒç´ ï¼Œåªæœ‰nameå·²ç»å­˜åœ¨æ—¶ï¼Œå€¼æ·»åŠ åˆ°åˆ—è¡¨çš„æœ€å·¦è¾¹</h1><h1 id="æ›´å¤šï¼š"><a href="#æ›´å¤šï¼š" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># rpushx(name, value) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.3 llen(name)</span><br></pre></td></tr></table></figure>
<h1 id="nameå¯¹åº”çš„listå…ƒç´ çš„ä¸ªæ•°"><a href="#nameå¯¹åº”çš„listå…ƒç´ çš„ä¸ªæ•°" class="headerlink" title="nameå¯¹åº”çš„listå…ƒç´ çš„ä¸ªæ•°"></a>nameå¯¹åº”çš„listå…ƒç´ çš„ä¸ªæ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.4 linsert(name, where, refvalue, value))</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„æŸä¸€ä¸ªå€¼å‰æˆ–åæ’å…¥ä¸€ä¸ªæ–°å€¼"><a href="#åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„æŸä¸€ä¸ªå€¼å‰æˆ–åæ’å…¥ä¸€ä¸ªæ–°å€¼" class="headerlink" title="åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„æŸä¸€ä¸ªå€¼å‰æˆ–åæ’å…¥ä¸€ä¸ªæ–°å€¼"></a>åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„æŸä¸€ä¸ªå€¼å‰æˆ–åæ’å…¥ä¸€ä¸ªæ–°å€¼</h1><h1 id="å‚æ•°ï¼š-17"><a href="#å‚æ•°ï¼š-17" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# whereï¼ŒBEFOREæˆ–AFTER
# refvalueï¼Œæ ‡æ†å€¼ï¼Œå³ï¼šåœ¨å®ƒå‰åæ’å…¥æ•°æ®
# valueï¼Œè¦æ’å…¥çš„æ•°æ®</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.5 r.lset(name, index, value)</span><br></pre></td></tr></table></figure>
<h1 id="å¯¹nameå¯¹åº”çš„listä¸­çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®é‡æ–°èµ‹å€¼"><a href="#å¯¹nameå¯¹åº”çš„listä¸­çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®é‡æ–°èµ‹å€¼" class="headerlink" title="å¯¹nameå¯¹åº”çš„listä¸­çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®é‡æ–°èµ‹å€¼"></a>å¯¹nameå¯¹åº”çš„listä¸­çš„æŸä¸€ä¸ªç´¢å¼•ä½ç½®é‡æ–°èµ‹å€¼</h1><h1 id="å‚æ•°ï¼š-18"><a href="#å‚æ•°ï¼š-18" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# indexï¼Œlistçš„ç´¢å¼•ä½ç½®
# valueï¼Œè¦è®¾ç½®çš„å€¼</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.6 r.lrem(name, value, num)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„listä¸­åˆ é™¤æŒ‡å®šçš„å€¼"><a href="#åœ¨nameå¯¹åº”çš„listä¸­åˆ é™¤æŒ‡å®šçš„å€¼" class="headerlink" title="åœ¨nameå¯¹åº”çš„listä¸­åˆ é™¤æŒ‡å®šçš„å€¼"></a>åœ¨nameå¯¹åº”çš„listä¸­åˆ é™¤æŒ‡å®šçš„å€¼</h1><h1 id="å‚æ•°ï¼š-19"><a href="#å‚æ•°ï¼š-19" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# valueï¼Œè¦åˆ é™¤çš„å€¼
# numï¼Œ  num=0ï¼Œåˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰çš„æŒ‡å®šå€¼ï¼›
       # num=2,ä»å‰åˆ°åï¼Œåˆ é™¤2ä¸ªï¼›
       # num=-2,ä»åå‘å‰ï¼Œåˆ é™¤2ä¸ª</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.7 lpop(name)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„å·¦ä¾§è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åœ¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿”å›å€¼åˆ™æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ "><a href="#åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„å·¦ä¾§è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åœ¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿”å›å€¼åˆ™æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ " class="headerlink" title="åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„å·¦ä¾§è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åœ¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿”å›å€¼åˆ™æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ "></a>åœ¨nameå¯¹åº”çš„åˆ—è¡¨çš„å·¦ä¾§è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶åœ¨åˆ—è¡¨ä¸­ç§»é™¤ï¼Œè¿”å›å€¼åˆ™æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ </h1><h1 id="æ›´å¤šï¼š-1"><a href="#æ›´å¤šï¼š-1" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># rpop(name) è¡¨ç¤ºä»å³å‘å·¦æ“ä½œ</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.8 lindex(name, index)</span><br></pre></td></tr></table></figure>
<p>åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­æ ¹æ®ç´¢å¼•è·å–åˆ—è¡¨å…ƒç´ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.9 lrange(name, start, end)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„åˆ—è¡¨åˆ†ç‰‡è·å–æ•°æ®"><a href="#åœ¨nameå¯¹åº”çš„åˆ—è¡¨åˆ†ç‰‡è·å–æ•°æ®" class="headerlink" title="åœ¨nameå¯¹åº”çš„åˆ—è¡¨åˆ†ç‰‡è·å–æ•°æ®"></a>åœ¨nameå¯¹åº”çš„åˆ—è¡¨åˆ†ç‰‡è·å–æ•°æ®</h1><h1 id="å‚æ•°ï¼š-20"><a href="#å‚æ•°ï¼š-20" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# startï¼Œç´¢å¼•çš„èµ·å§‹ä½ç½®
# endï¼Œç´¢å¼•ç»“æŸä½ç½®</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.10 ltrim(name, start, end)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­ç§»é™¤æ²¡æœ‰åœ¨start-endç´¢å¼•ä¹‹é—´çš„å€¼"><a href="#åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­ç§»é™¤æ²¡æœ‰åœ¨start-endç´¢å¼•ä¹‹é—´çš„å€¼" class="headerlink" title="åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­ç§»é™¤æ²¡æœ‰åœ¨start-endç´¢å¼•ä¹‹é—´çš„å€¼"></a>åœ¨nameå¯¹åº”çš„åˆ—è¡¨ä¸­ç§»é™¤æ²¡æœ‰åœ¨start-endç´¢å¼•ä¹‹é—´çš„å€¼</h1><h1 id="å‚æ•°ï¼š-21"><a href="#å‚æ•°ï¼š-21" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# startï¼Œç´¢å¼•çš„èµ·å§‹ä½ç½®
# endï¼Œç´¢å¼•ç»“æŸä½ç½®</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.11 rpoplpush(src, dst)</span><br></pre></td></tr></table></figure>
<h1 id="ä»ä¸€ä¸ªåˆ—è¡¨å–å‡ºæœ€å³è¾¹çš„å…ƒç´ ï¼ŒåŒæ—¶å°†å…¶æ·»åŠ è‡³å¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€å·¦è¾¹"><a href="#ä»ä¸€ä¸ªåˆ—è¡¨å–å‡ºæœ€å³è¾¹çš„å…ƒç´ ï¼ŒåŒæ—¶å°†å…¶æ·»åŠ è‡³å¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€å·¦è¾¹" class="headerlink" title="ä»ä¸€ä¸ªåˆ—è¡¨å–å‡ºæœ€å³è¾¹çš„å…ƒç´ ï¼ŒåŒæ—¶å°†å…¶æ·»åŠ è‡³å¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€å·¦è¾¹"></a>ä»ä¸€ä¸ªåˆ—è¡¨å–å‡ºæœ€å³è¾¹çš„å…ƒç´ ï¼ŒåŒæ—¶å°†å…¶æ·»åŠ è‡³å¦ä¸€ä¸ªåˆ—è¡¨çš„æœ€å·¦è¾¹</h1><h1 id="å‚æ•°ï¼š-22"><a href="#å‚æ•°ï¼š-22" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># srcï¼Œè¦å–æ•°æ®çš„åˆ—è¡¨çš„name
# dstï¼Œè¦æ·»åŠ æ•°æ®çš„åˆ—è¡¨çš„name</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.12 blpop(keys, timeout)</span><br></pre></td></tr></table></figure>
<h1 id="å°†å¤šä¸ªåˆ—è¡¨æ’åˆ—ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³å»popå¯¹åº”åˆ—è¡¨çš„å…ƒç´ "><a href="#å°†å¤šä¸ªåˆ—è¡¨æ’åˆ—ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³å»popå¯¹åº”åˆ—è¡¨çš„å…ƒç´ " class="headerlink" title="å°†å¤šä¸ªåˆ—è¡¨æ’åˆ—ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³å»popå¯¹åº”åˆ—è¡¨çš„å…ƒç´ "></a>å°†å¤šä¸ªåˆ—è¡¨æ’åˆ—ï¼ŒæŒ‰ç…§ä»å·¦åˆ°å³å»popå¯¹åº”åˆ—è¡¨çš„å…ƒç´ </h1><h1 id="å‚æ•°ï¼š-23"><a href="#å‚æ•°ï¼š-23" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># keysï¼Œredisçš„nameçš„é›†åˆ
# timeoutï¼Œè¶…æ—¶æ—¶é—´ï¼Œå½“å…ƒç´ æ‰€æœ‰åˆ—è¡¨çš„å…ƒç´ è·å–å®Œä¹‹åï¼Œé˜»å¡ç­‰å¾…åˆ—è¡¨å†…æœ‰æ•°æ®çš„æ—¶é—´ï¼ˆç§’ï¼‰, 0 è¡¨ç¤ºæ°¸è¿œé˜»å¡</code></pre><h1 id="æ›´å¤šï¼š-2"><a href="#æ›´å¤šï¼š-2" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># r.brpop(keys, timeout)ï¼Œä»å³å‘å·¦è·å–æ•°æ®</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.13 brpoplpush(src, dst, timeout&#x3D;0)</span><br></pre></td></tr></table></figure>
<h1 id="ä»ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§ç§»é™¤ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨çš„å·¦ä¾§"><a href="#ä»ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§ç§»é™¤ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨çš„å·¦ä¾§" class="headerlink" title="ä»ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§ç§»é™¤ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨çš„å·¦ä¾§"></a>ä»ä¸€ä¸ªåˆ—è¡¨çš„å³ä¾§ç§»é™¤ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨çš„å·¦ä¾§</h1><h1 id="å‚æ•°ï¼š-24"><a href="#å‚æ•°ï¼š-24" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># srcï¼Œå–å‡ºå¹¶è¦ç§»é™¤å…ƒç´ çš„åˆ—è¡¨å¯¹åº”çš„name
# dstï¼Œè¦æ’å…¥å…ƒç´ çš„åˆ—è¡¨å¯¹åº”çš„name
# timeoutï¼Œå½“srcå¯¹åº”çš„åˆ—è¡¨ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œé˜»å¡ç­‰å¾…å…¶æœ‰æ•°æ®çš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œ0 è¡¨ç¤ºæ°¸è¿œé˜»å¡</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 7.14 è‡ªå®šä¹‰å¢é‡è¿­ä»£(éå¸¸é‡è¦ï¼ŒåŸç”Ÿçš„æ¨¡å—æ²¡æœ‰æä¾›æ”¯æŒ)(***)</span><br></pre></td></tr></table></figure>
<h1 id="ç”±äºredisç±»åº“ä¸­æ²¡æœ‰æä¾›å¯¹åˆ—è¡¨å…ƒç´ çš„å¢é‡è¿­ä»£ï¼Œå¦‚æœæƒ³è¦å¾ªç¯nameå¯¹åº”çš„åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š"><a href="#ç”±äºredisç±»åº“ä¸­æ²¡æœ‰æä¾›å¯¹åˆ—è¡¨å…ƒç´ çš„å¢é‡è¿­ä»£ï¼Œå¦‚æœæƒ³è¦å¾ªç¯nameå¯¹åº”çš„åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š" class="headerlink" title="ç”±äºredisç±»åº“ä¸­æ²¡æœ‰æä¾›å¯¹åˆ—è¡¨å…ƒç´ çš„å¢é‡è¿­ä»£ï¼Œå¦‚æœæƒ³è¦å¾ªç¯nameå¯¹åº”çš„åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š"></a>ç”±äºredisç±»åº“ä¸­æ²¡æœ‰æä¾›å¯¹åˆ—è¡¨å…ƒç´ çš„å¢é‡è¿­ä»£ï¼Œå¦‚æœæƒ³è¦å¾ªç¯nameå¯¹åº”çš„åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦ï¼š</h1><pre><code># 1ã€è·å–nameå¯¹åº”çš„æ‰€æœ‰åˆ—è¡¨
# 2ã€å¾ªç¯åˆ—è¡¨</code></pre><h1 id="ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨ç¬¬ä¸€æ­¥æ—¶å°±å°†ç¨‹åºçš„å†…å®¹æ’‘çˆ†ï¼Œæ‰€æœ‰æœ‰å¿…è¦è‡ªå®šä¹‰ä¸€ä¸ªå¢é‡è¿­ä»£çš„åŠŸèƒ½ï¼š"><a href="#ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨ç¬¬ä¸€æ­¥æ—¶å°±å°†ç¨‹åºçš„å†…å®¹æ’‘çˆ†ï¼Œæ‰€æœ‰æœ‰å¿…è¦è‡ªå®šä¹‰ä¸€ä¸ªå¢é‡è¿­ä»£çš„åŠŸèƒ½ï¼š" class="headerlink" title="ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨ç¬¬ä¸€æ­¥æ—¶å°±å°†ç¨‹åºçš„å†…å®¹æ’‘çˆ†ï¼Œæ‰€æœ‰æœ‰å¿…è¦è‡ªå®šä¹‰ä¸€ä¸ªå¢é‡è¿­ä»£çš„åŠŸèƒ½ï¼š"></a>ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨éå¸¸å¤§ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½åœ¨ç¬¬ä¸€æ­¥æ—¶å°±å°†ç¨‹åºçš„å†…å®¹æ’‘çˆ†ï¼Œæ‰€æœ‰æœ‰å¿…è¦è‡ªå®šä¹‰ä¸€ä¸ªå¢é‡è¿­ä»£çš„åŠŸèƒ½ï¼š</h1><p>def list_iter(name):<br>    â€œâ€â€<br>    è‡ªå®šä¹‰redisåˆ—è¡¨å¢é‡è¿­ä»£<br>    :param name: redisä¸­çš„nameï¼Œå³ï¼šè¿­ä»£nameå¯¹åº”çš„åˆ—è¡¨<br>    :return: yield è¿”å› åˆ—è¡¨å…ƒç´ <br>    â€œâ€â€<br>    list_count = r.llen(name)<br>    for index in range(list_count):<br>        yield r.lindex(name, index)</p>
<h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>for item in list_iter(â€˜ppâ€™):<br>    print(item)</p>
<h1 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h1><p>def list_scan_iter(name):<br>    start = 0<br>    while True:<br>        vals = conn.lrange(name, start, start+3)<br>        start = start + 4<br>        if not vals:<br>            return<br>        for val in vals:<br>            yield val</p>
<p>result = list_scan_iter(â€˜usersâ€™)<br>                for item in result:<br>                    print(item)      </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## å…«. Setæ“ä½œ</span><br><span class="line">Setæ“ä½œï¼ŒSeté›†åˆå°±æ˜¯ä¸å…è®¸é‡å¤çš„åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">### 8.1 sadd(name,values)</span><br></pre></td></tr></table></figure>
<h1 id="nameå¯¹åº”çš„é›†åˆä¸­æ·»åŠ å…ƒç´ "><a href="#nameå¯¹åº”çš„é›†åˆä¸­æ·»åŠ å…ƒç´ " class="headerlink" title="nameå¯¹åº”çš„é›†åˆä¸­æ·»åŠ å…ƒç´ "></a>nameå¯¹åº”çš„é›†åˆä¸­æ·»åŠ å…ƒç´ </h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.2 scard(name)</span><br></pre></td></tr></table></figure>
<p>è·å–nameå¯¹åº”çš„é›†åˆä¸­å…ƒç´ ä¸ªæ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.3 sdiff(keys, \*args)</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆçš„å…ƒç´ é›†åˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.4 sdiffstore(dest, keys, \*args)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆï¼Œå†å°†å…¶æ–°åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­"><a href="#è·å–ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆï¼Œå†å°†å…¶æ–°åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­" class="headerlink" title="è·å–ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆï¼Œå†å°†å…¶æ–°åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­"></a>è·å–ç¬¬ä¸€ä¸ªnameå¯¹åº”çš„é›†åˆä¸­ä¸”ä¸åœ¨å…¶ä»–nameå¯¹åº”çš„é›†åˆï¼Œå†å°†å…¶æ–°åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.5 sinter(keys, \*args)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†"><a href="#è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†" class="headerlink" title="è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†"></a>è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.6 sinterstore(dest, keys, *args)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†ï¼Œå†è®²å…¶åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­"><a href="#è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†ï¼Œå†è®²å…¶åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­" class="headerlink" title="è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†ï¼Œå†è®²å…¶åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­"></a>è·å–å¤šä¸€ä¸ªnameå¯¹åº”é›†åˆçš„å¹¶é›†ï¼Œå†è®²å…¶åŠ å…¥åˆ°destå¯¹åº”çš„é›†åˆä¸­</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.7 sismember(name, value)</span><br></pre></td></tr></table></figure>
<h1 id="æ£€æŸ¥valueæ˜¯å¦æ˜¯nameå¯¹åº”çš„é›†åˆçš„æˆå‘˜"><a href="#æ£€æŸ¥valueæ˜¯å¦æ˜¯nameå¯¹åº”çš„é›†åˆçš„æˆå‘˜" class="headerlink" title="æ£€æŸ¥valueæ˜¯å¦æ˜¯nameå¯¹åº”çš„é›†åˆçš„æˆå‘˜"></a>æ£€æŸ¥valueæ˜¯å¦æ˜¯nameå¯¹åº”çš„é›†åˆçš„æˆå‘˜</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.8 smembers(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„é›†åˆçš„æ‰€æœ‰æˆå‘˜"><a href="#è·å–nameå¯¹åº”çš„é›†åˆçš„æ‰€æœ‰æˆå‘˜" class="headerlink" title="è·å–nameå¯¹åº”çš„é›†åˆçš„æ‰€æœ‰æˆå‘˜"></a>è·å–nameå¯¹åº”çš„é›†åˆçš„æ‰€æœ‰æˆå‘˜</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.9 smove(src, dst, value)</span><br></pre></td></tr></table></figure>
<h1 id="å°†æŸä¸ªæˆå‘˜ä»ä¸€ä¸ªé›†åˆä¸­ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé›†åˆ"><a href="#å°†æŸä¸ªæˆå‘˜ä»ä¸€ä¸ªé›†åˆä¸­ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé›†åˆ" class="headerlink" title="å°†æŸä¸ªæˆå‘˜ä»ä¸€ä¸ªé›†åˆä¸­ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé›†åˆ"></a>å°†æŸä¸ªæˆå‘˜ä»ä¸€ä¸ªé›†åˆä¸­ç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªé›†åˆ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.10 spop(name)</span><br></pre></td></tr></table></figure>
<h1 id="ä»é›†åˆçš„å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰ç§»é™¤ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶å°†å…¶è¿”å›"><a href="#ä»é›†åˆçš„å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰ç§»é™¤ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶å°†å…¶è¿”å›" class="headerlink" title="ä»é›†åˆçš„å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰ç§»é™¤ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶å°†å…¶è¿”å›"></a>ä»é›†åˆçš„å³ä¾§ï¼ˆå°¾éƒ¨ï¼‰ç§»é™¤ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶å°†å…¶è¿”å›</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.11 srandmember(name, numbers)</span><br></pre></td></tr></table></figure>
<h1 id="ä»nameå¯¹åº”çš„é›†åˆä¸­éšæœºè·å–-numbers-ä¸ªå…ƒç´ "><a href="#ä»nameå¯¹åº”çš„é›†åˆä¸­éšæœºè·å–-numbers-ä¸ªå…ƒç´ " class="headerlink" title="ä»nameå¯¹åº”çš„é›†åˆä¸­éšæœºè·å– numbers ä¸ªå…ƒç´ "></a>ä»nameå¯¹åº”çš„é›†åˆä¸­éšæœºè·å– numbers ä¸ªå…ƒç´ </h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.12 srem(name, values)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„é›†åˆä¸­åˆ é™¤æŸäº›å€¼"><a href="#åœ¨nameå¯¹åº”çš„é›†åˆä¸­åˆ é™¤æŸäº›å€¼" class="headerlink" title="åœ¨nameå¯¹åº”çš„é›†åˆä¸­åˆ é™¤æŸäº›å€¼"></a>åœ¨nameå¯¹åº”çš„é›†åˆä¸­åˆ é™¤æŸäº›å€¼</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.13 sunion(keys, \*args)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†"><a href="#è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†" class="headerlink" title="è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†"></a>è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.14 sunionstore(dest,keys, *args)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destå¯¹åº”çš„é›†åˆä¸­"><a href="#è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destå¯¹åº”çš„é›†åˆä¸­" class="headerlink" title="è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destå¯¹åº”çš„é›†åˆä¸­"></a>è·å–å¤šä¸€ä¸ªnameå¯¹åº”çš„é›†åˆçš„å¹¶é›†ï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ°destå¯¹åº”çš„é›†åˆä¸­</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 8.15 sscan(name, cursor&#x3D;0, match&#x3D;None, count&#x3D;None)</span><br><span class="line">sscan_iter(name, match&#x3D;None, count&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="åŒå­—ç¬¦ä¸²çš„æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£åˆ†æ‰¹è·å–å…ƒç´ ï¼Œé¿å…å†…å­˜æ¶ˆè€—å¤ªå¤§"><a href="#åŒå­—ç¬¦ä¸²çš„æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£åˆ†æ‰¹è·å–å…ƒç´ ï¼Œé¿å…å†…å­˜æ¶ˆè€—å¤ªå¤§" class="headerlink" title="åŒå­—ç¬¦ä¸²çš„æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£åˆ†æ‰¹è·å–å…ƒç´ ï¼Œé¿å…å†…å­˜æ¶ˆè€—å¤ªå¤§"></a>åŒå­—ç¬¦ä¸²çš„æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£åˆ†æ‰¹è·å–å…ƒç´ ï¼Œé¿å…å†…å­˜æ¶ˆè€—å¤ªå¤§</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## ä¹. Sort Set æ“ä½œ</span><br><span class="line">æœ‰åºé›†åˆï¼Œåœ¨é›†åˆçš„åŸºç¡€ä¸Šï¼Œä¸ºæ¯å…ƒç´ æ’åºï¼›å…ƒç´ çš„æ’åºéœ€è¦æ ¹æ®å¦å¤–ä¸€ä¸ªå€¼æ¥è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥ï¼Œå¯¹äºæœ‰åºé›†åˆï¼Œæ¯ä¸€ä¸ªå…ƒç´ æœ‰ä¸¤ä¸ªå€¼ï¼Œå³: å€¼å’Œåˆ†æ•°ï¼Œåˆ†æ•°ä¸“é—¨ç”¨æ¥åšæ’åº</span><br><span class="line"></span><br><span class="line">### 9.1 zadd(name, args, \*kwargs)</span><br></pre></td></tr></table></figure>
<h1 id="åœ¨nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ "><a href="#åœ¨nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ " class="headerlink" title="åœ¨nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ "></a>åœ¨nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ </h1><h1 id="å¦‚ï¼š-6"><a href="#å¦‚ï¼š-6" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># zadd(&apos;zz&apos;, &apos;n1&apos;, 1, &apos;n2&apos;, 2)
# æˆ–
# zadd(&apos;zz&apos;, n1=11, n2=22)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.2 zcard(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆå…ƒç´ çš„æ•°é‡"><a href="#è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆå…ƒç´ çš„æ•°é‡" class="headerlink" title="è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆå…ƒç´ çš„æ•°é‡"></a>è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆå…ƒç´ çš„æ•°é‡</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.3 zcount(name, min, max)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­åˆ†æ•°-åœ¨-min-max-ä¹‹é—´çš„ä¸ªæ•°"><a href="#è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­åˆ†æ•°-åœ¨-min-max-ä¹‹é—´çš„ä¸ªæ•°" class="headerlink" title="è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­åˆ†æ•° åœ¨ [min,max] ä¹‹é—´çš„ä¸ªæ•°"></a>è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­åˆ†æ•° åœ¨ [min,max] ä¹‹é—´çš„ä¸ªæ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.4 zincrby(name, value, amount)</span><br></pre></td></tr></table></figure>
<h1 id="è‡ªå¢nameå¯¹åº”çš„æœ‰åºé›†åˆçš„-name-å¯¹åº”çš„åˆ†æ•°"><a href="#è‡ªå¢nameå¯¹åº”çš„æœ‰åºé›†åˆçš„-name-å¯¹åº”çš„åˆ†æ•°" class="headerlink" title="è‡ªå¢nameå¯¹åº”çš„æœ‰åºé›†åˆçš„ name å¯¹åº”çš„åˆ†æ•°"></a>è‡ªå¢nameå¯¹åº”çš„æœ‰åºé›†åˆçš„ name å¯¹åº”çš„åˆ†æ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.5 r.zrange( name, start, end, desc&#x3D;False, withscores&#x3D;False, score_cast_func&#x3D;float)</span><br></pre></td></tr></table></figure>
<h1 id="æŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ "><a href="#æŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ " class="headerlink" title="æŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ "></a>æŒ‰ç…§ç´¢å¼•èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ </h1><h1 id="å‚æ•°ï¼š-25"><a href="#å‚æ•°ï¼š-25" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# startï¼Œæœ‰åºé›†åˆç´¢å¼•èµ·å§‹ä½ç½®ï¼ˆéåˆ†æ•°ï¼‰
# endï¼Œæœ‰åºé›†åˆç´¢å¼•ç»“æŸä½ç½®ï¼ˆéåˆ†æ•°ï¼‰
# descï¼Œæ’åºè§„åˆ™ï¼Œé»˜è®¤æŒ‰ç…§åˆ†æ•°ä»å°åˆ°å¤§æ’åº
# withscoresï¼Œæ˜¯å¦è·å–å…ƒç´ çš„åˆ†æ•°ï¼Œé»˜è®¤åªè·å–å…ƒç´ çš„å€¼
# score_cast_funcï¼Œå¯¹åˆ†æ•°è¿›è¡Œæ•°æ®è½¬æ¢çš„å‡½æ•°</code></pre><h1 id="æ›´å¤šï¼š-3"><a href="#æ›´å¤šï¼š-3" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># ä»å¤§åˆ°å°æ’åº
# zrevrange(name, start, end, withscores=False, score_cast_func=float)

# æŒ‰ç…§åˆ†æ•°èŒƒå›´è·å–nameå¯¹åº”çš„æœ‰åºé›†åˆçš„å…ƒç´ 
# zrangebyscore(name, min, max, start=None, num=None, withscores=False, score_cast_func=float)
# ä»å¤§åˆ°å°æ’åº
# zrevrangebyscore(name, max, min, start=None, num=None, withscores=False, score_cast_func=float)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.6 zrank(name, value)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–æŸä¸ªå€¼åœ¨-nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­çš„æ’è¡Œï¼ˆä»-0-å¼€å§‹ï¼‰"><a href="#è·å–æŸä¸ªå€¼åœ¨-nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­çš„æ’è¡Œï¼ˆä»-0-å¼€å§‹ï¼‰" class="headerlink" title="è·å–æŸä¸ªå€¼åœ¨ nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­çš„æ’è¡Œï¼ˆä» 0 å¼€å§‹ï¼‰"></a>è·å–æŸä¸ªå€¼åœ¨ nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­çš„æ’è¡Œï¼ˆä» 0 å¼€å§‹ï¼‰</h1><h1 id="æ›´å¤šï¼š-4"><a href="#æ›´å¤šï¼š-4" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># zrevrank(name, value)ï¼Œä»å¤§åˆ°å°æ’åº</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.7 zrangebylex(name, min, max, start&#x3D;None, num&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œæœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„-å€¼-ï¼ˆlexicographical-orderingï¼‰æ¥è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”®-key-ä¸­ï¼Œ-å…ƒç´ çš„å€¼ä»‹äº-min-å’Œ-max-ä¹‹é—´çš„æˆå‘˜"><a href="#å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œæœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„-å€¼-ï¼ˆlexicographical-orderingï¼‰æ¥è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”®-key-ä¸­ï¼Œ-å…ƒç´ çš„å€¼ä»‹äº-min-å’Œ-max-ä¹‹é—´çš„æˆå‘˜" class="headerlink" title="å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œæœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„ å€¼ ï¼ˆlexicographical orderingï¼‰æ¥è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”® key ä¸­ï¼Œ å…ƒç´ çš„å€¼ä»‹äº min å’Œ max ä¹‹é—´çš„æˆå‘˜"></a>å½“æœ‰åºé›†åˆçš„æ‰€æœ‰æˆå‘˜éƒ½å…·æœ‰ç›¸åŒçš„åˆ†å€¼æ—¶ï¼Œæœ‰åºé›†åˆçš„å…ƒç´ ä¼šæ ¹æ®æˆå‘˜çš„ å€¼ ï¼ˆlexicographical orderingï¼‰æ¥è¿›è¡Œæ’åºï¼Œè€Œè¿™ä¸ªå‘½ä»¤åˆ™å¯ä»¥è¿”å›ç»™å®šçš„æœ‰åºé›†åˆé”® key ä¸­ï¼Œ å…ƒç´ çš„å€¼ä»‹äº min å’Œ max ä¹‹é—´çš„æˆå‘˜</h1><h1 id="å¯¹é›†åˆä¸­çš„æ¯ä¸ªæˆå‘˜è¿›è¡Œé€ä¸ªå­—èŠ‚çš„å¯¹æ¯”ï¼ˆbyte-by-byte-compareï¼‰ï¼Œ-å¹¶æŒ‰ç…§ä»ä½åˆ°é«˜çš„é¡ºåºï¼Œ-è¿”å›æ’åºåçš„é›†åˆæˆå‘˜ã€‚-å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯ç›¸åŒçš„è¯ï¼Œ-é‚£ä¹ˆå‘½ä»¤ä¼šè®¤ä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²è¦å¤§"><a href="#å¯¹é›†åˆä¸­çš„æ¯ä¸ªæˆå‘˜è¿›è¡Œé€ä¸ªå­—èŠ‚çš„å¯¹æ¯”ï¼ˆbyte-by-byte-compareï¼‰ï¼Œ-å¹¶æŒ‰ç…§ä»ä½åˆ°é«˜çš„é¡ºåºï¼Œ-è¿”å›æ’åºåçš„é›†åˆæˆå‘˜ã€‚-å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯ç›¸åŒçš„è¯ï¼Œ-é‚£ä¹ˆå‘½ä»¤ä¼šè®¤ä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²è¦å¤§" class="headerlink" title="å¯¹é›†åˆä¸­çš„æ¯ä¸ªæˆå‘˜è¿›è¡Œé€ä¸ªå­—èŠ‚çš„å¯¹æ¯”ï¼ˆbyte-by-byte compareï¼‰ï¼Œ å¹¶æŒ‰ç…§ä»ä½åˆ°é«˜çš„é¡ºåºï¼Œ è¿”å›æ’åºåçš„é›†åˆæˆå‘˜ã€‚ å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯ç›¸åŒçš„è¯ï¼Œ é‚£ä¹ˆå‘½ä»¤ä¼šè®¤ä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²è¦å¤§"></a>å¯¹é›†åˆä¸­çš„æ¯ä¸ªæˆå‘˜è¿›è¡Œé€ä¸ªå­—èŠ‚çš„å¯¹æ¯”ï¼ˆbyte-by-byte compareï¼‰ï¼Œ å¹¶æŒ‰ç…§ä»ä½åˆ°é«˜çš„é¡ºåºï¼Œ è¿”å›æ’åºåçš„é›†åˆæˆå‘˜ã€‚ å¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²æœ‰ä¸€éƒ¨åˆ†å†…å®¹æ˜¯ç›¸åŒçš„è¯ï¼Œ é‚£ä¹ˆå‘½ä»¤ä¼šè®¤ä¸ºè¾ƒé•¿çš„å­—ç¬¦ä¸²æ¯”è¾ƒçŸ­çš„å­—ç¬¦ä¸²è¦å¤§</h1><h1 id="å‚æ•°ï¼š-26"><a href="#å‚æ•°ï¼š-26" class="headerlink" title="å‚æ•°ï¼š"></a>å‚æ•°ï¼š</h1><pre><code># nameï¼Œredisçš„name
# minï¼Œå·¦åŒºé—´ï¼ˆå€¼ï¼‰ã€‚ + è¡¨ç¤ºæ­£æ— é™ï¼› - è¡¨ç¤ºè´Ÿæ— é™ï¼› ( è¡¨ç¤ºå¼€åŒºé—´ï¼› [ åˆ™è¡¨ç¤ºé—­åŒºé—´
# minï¼Œå³åŒºé—´ï¼ˆå€¼ï¼‰
# startï¼Œå¯¹ç»“æœè¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œç´¢å¼•ä½ç½®
# numï¼Œå¯¹ç»“æœè¿›è¡Œåˆ†ç‰‡å¤„ç†ï¼Œç´¢å¼•åé¢çš„numä¸ªå…ƒç´ </code></pre><h1 id="å¦‚ï¼š-7"><a href="#å¦‚ï¼š-7" class="headerlink" title="å¦‚ï¼š"></a>å¦‚ï¼š</h1><pre><code># ZADD myzset 0 aa 0 ba 0 ca 0 da 0 ea 0 fa 0 ga
# r.zrangebylex(&apos;myzset&apos;, &quot;-&quot;, &quot;[ca&quot;) ç»“æœä¸ºï¼š[&apos;aa&apos;, &apos;ba&apos;, &apos;ca&apos;]</code></pre><h1 id="æ›´å¤šï¼š-5"><a href="#æ›´å¤šï¼š-5" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># ä»å¤§åˆ°å°æ’åº
# zrevrangebylex(name, max, min, start=None, num=None)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.8 zrem(name, values)</span><br></pre></td></tr></table></figure>
<h1 id="åˆ é™¤nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­å€¼æ˜¯valuesçš„æˆå‘˜"><a href="#åˆ é™¤nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­å€¼æ˜¯valuesçš„æˆå‘˜" class="headerlink" title="åˆ é™¤nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­å€¼æ˜¯valuesçš„æˆå‘˜"></a>åˆ é™¤nameå¯¹åº”çš„æœ‰åºé›†åˆä¸­å€¼æ˜¯valuesçš„æˆå‘˜</h1><h1 id="å¦‚ï¼šzrem-â€˜zzâ€™-â€˜s1â€™-â€˜s2â€™"><a href="#å¦‚ï¼šzrem-â€˜zzâ€™-â€˜s1â€™-â€˜s2â€™" class="headerlink" title="å¦‚ï¼šzrem(â€˜zzâ€™, [â€˜s1â€™, â€˜s2â€™])"></a>å¦‚ï¼šzrem(â€˜zzâ€™, [â€˜s1â€™, â€˜s2â€™])</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.9 zremrangebyrank(name, min, max)</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®æ’è¡ŒèŒƒå›´åˆ é™¤"><a href="#æ ¹æ®æ’è¡ŒèŒƒå›´åˆ é™¤" class="headerlink" title="æ ¹æ®æ’è¡ŒèŒƒå›´åˆ é™¤"></a>æ ¹æ®æ’è¡ŒèŒƒå›´åˆ é™¤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.10 zremrangebyscore(name, min, max)</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®åˆ†æ•°èŒƒå›´åˆ é™¤"><a href="#æ ¹æ®åˆ†æ•°èŒƒå›´åˆ é™¤" class="headerlink" title="æ ¹æ®åˆ†æ•°èŒƒå›´åˆ é™¤"></a>æ ¹æ®åˆ†æ•°èŒƒå›´åˆ é™¤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.11 zremrangebylex(name, min, max)</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®å€¼è¿”å›åˆ é™¤"><a href="#æ ¹æ®å€¼è¿”å›åˆ é™¤" class="headerlink" title="æ ¹æ®å€¼è¿”å›åˆ é™¤"></a>æ ¹æ®å€¼è¿”å›åˆ é™¤</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">zscore(name, value)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”æœ‰åºé›†åˆä¸­-value-å¯¹åº”çš„åˆ†æ•°"><a href="#è·å–nameå¯¹åº”æœ‰åºé›†åˆä¸­-value-å¯¹åº”çš„åˆ†æ•°" class="headerlink" title="è·å–nameå¯¹åº”æœ‰åºé›†åˆä¸­ value å¯¹åº”çš„åˆ†æ•°"></a>è·å–nameå¯¹åº”æœ‰åºé›†åˆä¸­ value å¯¹åº”çš„åˆ†æ•°</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.12 zinterstore(dest, keys, aggregate&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„äº¤é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ"><a href="#è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„äº¤é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ" class="headerlink" title="è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„äº¤é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ"></a>è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„äº¤é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ</h1><h1 id="aggregateçš„å€¼ä¸º-SUM-MIN-MAX"><a href="#aggregateçš„å€¼ä¸º-SUM-MIN-MAX" class="headerlink" title="aggregateçš„å€¼ä¸º:  SUM  MIN  MAX"></a>aggregateçš„å€¼ä¸º:  SUM  MIN  MAX</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.13 zunionstore(dest, keys, aggregate&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ"><a href="#è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ" class="headerlink" title="è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ"></a>è·å–ä¸¤ä¸ªæœ‰åºé›†åˆçš„å¹¶é›†ï¼Œå¦‚æœé‡åˆ°ç›¸åŒå€¼ä¸åŒåˆ†æ•°ï¼Œåˆ™æŒ‰ç…§aggregateè¿›è¡Œæ“ä½œ</h1><h1 id="aggregateçš„å€¼ä¸º-SUM-MIN-MAX-1"><a href="#aggregateçš„å€¼ä¸º-SUM-MIN-MAX-1" class="headerlink" title="aggregateçš„å€¼ä¸º:  SUM  MIN  MAX"></a>aggregateçš„å€¼ä¸º:  SUM  MIN  MAX</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9.14 zscan(name, cursor&#x3D;0, match&#x3D;None, count&#x3D;None, score_cast_func&#x3D;float)</span><br><span class="line">zscan_iter(name, match&#x3D;None, count&#x3D;None,score_cast_func&#x3D;float)</span><br></pre></td></tr></table></figure>
<h1 id="åŒå­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œç›¸è¾ƒäºå­—ç¬¦ä¸²æ–°å¢score-cast-funcï¼Œç”¨æ¥å¯¹åˆ†æ•°è¿›è¡Œæ“ä½œ"><a href="#åŒå­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œç›¸è¾ƒäºå­—ç¬¦ä¸²æ–°å¢score-cast-funcï¼Œç”¨æ¥å¯¹åˆ†æ•°è¿›è¡Œæ“ä½œ" class="headerlink" title="åŒå­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œç›¸è¾ƒäºå­—ç¬¦ä¸²æ–°å¢score_cast_funcï¼Œç”¨æ¥å¯¹åˆ†æ•°è¿›è¡Œæ“ä½œ"></a>åŒå­—ç¬¦ä¸²ç›¸ä¼¼ï¼Œç›¸è¾ƒäºå­—ç¬¦ä¸²æ–°å¢score_cast_funcï¼Œç”¨æ¥å¯¹åˆ†æ•°è¿›è¡Œæ“ä½œ</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## å. å…¶ä»–å¸¸ç”¨çš„æ“ä½œ</span><br><span class="line"></span><br><span class="line">### 10.1 delete(\*names)</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®åˆ é™¤redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹"><a href="#æ ¹æ®åˆ é™¤redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹" class="headerlink" title="æ ¹æ®åˆ é™¤redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹"></a>æ ¹æ®åˆ é™¤redisä¸­çš„ä»»æ„æ•°æ®ç±»å‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.2 exists(name)</span><br></pre></td></tr></table></figure>
<h1 id="æ£€æµ‹redisçš„nameæ˜¯å¦å­˜åœ¨"><a href="#æ£€æµ‹redisçš„nameæ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æµ‹redisçš„nameæ˜¯å¦å­˜åœ¨"></a>æ£€æµ‹redisçš„nameæ˜¯å¦å­˜åœ¨</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.3 keys(pattern&#x3D;â€™*â€™)</span><br></pre></td></tr></table></figure>
<h1 id="æ ¹æ®æ¨¡å‹è·å–redisçš„name"><a href="#æ ¹æ®æ¨¡å‹è·å–redisçš„name" class="headerlink" title="æ ¹æ®æ¨¡å‹è·å–redisçš„name"></a>æ ¹æ®æ¨¡å‹è·å–redisçš„name</h1><h1 id="æ›´å¤šï¼š-6"><a href="#æ›´å¤šï¼š-6" class="headerlink" title="æ›´å¤šï¼š"></a>æ›´å¤šï¼š</h1><pre><code># KEYS * åŒ¹é…æ•°æ®åº“ä¸­æ‰€æœ‰ key ã€‚
# KEYS h?llo åŒ¹é… hello ï¼Œ hallo å’Œ hxllo ç­‰ã€‚
# KEYS h*llo åŒ¹é… hllo å’Œ heeeeello ç­‰ã€‚
# KEYS h[ae]llo åŒ¹é… hello å’Œ hallo ï¼Œä½†ä¸åŒ¹é… hillo</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.4 expire(name ,time)</span><br></pre></td></tr></table></figure>
<h1 id="ä¸ºæŸä¸ªredisçš„æŸä¸ªnameè®¾ç½®è¶…æ—¶æ—¶é—´"><a href="#ä¸ºæŸä¸ªredisçš„æŸä¸ªnameè®¾ç½®è¶…æ—¶æ—¶é—´" class="headerlink" title="ä¸ºæŸä¸ªredisçš„æŸä¸ªnameè®¾ç½®è¶…æ—¶æ—¶é—´"></a>ä¸ºæŸä¸ªredisçš„æŸä¸ªnameè®¾ç½®è¶…æ—¶æ—¶é—´</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.5 rename(src, dst)</span><br></pre></td></tr></table></figure>
<h1 id="å¯¹redisçš„nameé‡å‘½åä¸º"><a href="#å¯¹redisçš„nameé‡å‘½åä¸º" class="headerlink" title="å¯¹redisçš„nameé‡å‘½åä¸º"></a>å¯¹redisçš„nameé‡å‘½åä¸º</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.6 move(name, db))</span><br></pre></td></tr></table></figure>
<h1 id="å°†redisçš„æŸä¸ªå€¼ç§»åŠ¨åˆ°æŒ‡å®šçš„dbä¸‹"><a href="#å°†redisçš„æŸä¸ªå€¼ç§»åŠ¨åˆ°æŒ‡å®šçš„dbä¸‹" class="headerlink" title="å°†redisçš„æŸä¸ªå€¼ç§»åŠ¨åˆ°æŒ‡å®šçš„dbä¸‹"></a>å°†redisçš„æŸä¸ªå€¼ç§»åŠ¨åˆ°æŒ‡å®šçš„dbä¸‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.7 randomkey()</span><br></pre></td></tr></table></figure>
<h1 id="éšæœºè·å–ä¸€ä¸ªredisçš„nameï¼ˆä¸åˆ é™¤ï¼‰"><a href="#éšæœºè·å–ä¸€ä¸ªredisçš„nameï¼ˆä¸åˆ é™¤ï¼‰" class="headerlink" title="éšæœºè·å–ä¸€ä¸ªredisçš„nameï¼ˆä¸åˆ é™¤ï¼‰"></a>éšæœºè·å–ä¸€ä¸ªredisçš„nameï¼ˆä¸åˆ é™¤ï¼‰</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.8 type(name)</span><br></pre></td></tr></table></figure>
<h1 id="è·å–nameå¯¹åº”å€¼çš„ç±»å‹"><a href="#è·å–nameå¯¹åº”å€¼çš„ç±»å‹" class="headerlink" title="è·å–nameå¯¹åº”å€¼çš„ç±»å‹"></a>è·å–nameå¯¹åº”å€¼çš„ç±»å‹</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.9 scan(cursor&#x3D;0, match&#x3D;None, count&#x3D;None)</span><br><span class="line">scan_iter(match&#x3D;None, count&#x3D;None)</span><br></pre></td></tr></table></figure>
<h1 id="åŒå­—ç¬¦ä¸²æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£è·å–key"><a href="#åŒå­—ç¬¦ä¸²æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£è·å–key" class="headerlink" title="åŒå­—ç¬¦ä¸²æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£è·å–key"></a>åŒå­—ç¬¦ä¸²æ“ä½œï¼Œç”¨äºå¢é‡è¿­ä»£è·å–key</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10.10 sentinel(å“¨å…µ)</span><br><span class="line">Redisä¸­çš„sentinelä¸»è¦ç”¨äºåœ¨redisä¸»ä»å¤åˆ¶ä¸­ï¼Œå¦‚æœmasteræ•…éšœï¼Œåˆ™è‡ªåŠ¨å°†slaveæ›¿æ¢æˆmaster</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from redis.sentinel import Sentinel</p>
<h1 id="è¿æ¥å“¨å…µæœåŠ¡å™¨-ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå"><a href="#è¿æ¥å“¨å…µæœåŠ¡å™¨-ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå" class="headerlink" title="è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå)"></a>è¿æ¥å“¨å…µæœåŠ¡å™¨(ä¸»æœºåä¹Ÿå¯ä»¥ç”¨åŸŸå)</h1><p>sentinel = Sentinel([(â€˜10.211.55.20â€™, 26379),<br>                     (â€˜10.211.55.20â€™, 26380),<br>                     ],<br>                    socket_timeout=0.5)</p>
<h1 id="è·å–ä¸»æœåŠ¡å™¨åœ°å€"><a href="#è·å–ä¸»æœåŠ¡å™¨åœ°å€" class="headerlink" title="# è·å–ä¸»æœåŠ¡å™¨åœ°å€"></a># è·å–ä¸»æœåŠ¡å™¨åœ°å€</h1><h1 id="master-sentinel-discover-master-â€˜mymasterâ€™"><a href="#master-sentinel-discover-master-â€˜mymasterâ€™" class="headerlink" title="master = sentinel.discover_master(â€˜mymasterâ€™)"></a>master = sentinel.discover_master(â€˜mymasterâ€™)</h1><h1 id="print-master"><a href="#print-master" class="headerlink" title="print(master)"></a>print(master)</h1><p>#</p>
<h1 id="è·å–ä»æœåŠ¡å™¨åœ°å€"><a href="#è·å–ä»æœåŠ¡å™¨åœ°å€" class="headerlink" title="# # è·å–ä»æœåŠ¡å™¨åœ°å€"></a># # è·å–ä»æœåŠ¡å™¨åœ°å€</h1><h1 id="slave-sentinel-discover-slaves-â€˜mymasterâ€™"><a href="#slave-sentinel-discover-slaves-â€˜mymasterâ€™" class="headerlink" title="slave = sentinel.discover_slaves(â€˜mymasterâ€™)"></a>slave = sentinel.discover_slaves(â€˜mymasterâ€™)</h1><h1 id="print-slave"><a href="#print-slave" class="headerlink" title="print(slave)"></a>print(slave)</h1><p>#<br>#</p>
<h1 id="è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥"><a href="#è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥" class="headerlink" title="# # è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥"></a># # è·å–ä¸»æœåŠ¡å™¨è¿›è¡Œå†™å…¥</h1><h1 id="master-sentinel-master-for-â€˜mymasterâ€™"><a href="#master-sentinel-master-for-â€˜mymasterâ€™" class="headerlink" title="master = sentinel.master_for(â€˜mymasterâ€™)"></a>master = sentinel.master_for(â€˜mymasterâ€™)</h1><h1 id="master-set-â€˜fooâ€™-â€˜barâ€™"><a href="#master-set-â€˜fooâ€™-â€˜barâ€™" class="headerlink" title="master.set(â€˜fooâ€™, â€˜barâ€™)"></a>master.set(â€˜fooâ€™, â€˜barâ€™)</h1><h1 id="è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰"><a href="#è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰" class="headerlink" title="# # # è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰"></a># # # è·å–ä»æœåŠ¡å™¨è¿›è¡Œè¯»å–ï¼ˆé»˜è®¤æ˜¯round-roubinï¼‰</h1><h1 id="slave-sentinel-slave-for-â€˜mymasterâ€™-password-â€™redis-auth-passâ€™"><a href="#slave-sentinel-slave-for-â€˜mymasterâ€™-password-â€™redis-auth-passâ€™" class="headerlink" title="slave = sentinel.slave_for(â€˜mymasterâ€™, password=â€™redis_auth_passâ€™)"></a>slave = sentinel.slave_for(â€˜mymasterâ€™, password=â€™redis_auth_passâ€™)</h1><h1 id="r-ret-slave-get-â€˜fooâ€™"><a href="#r-ret-slave-get-â€˜fooâ€™" class="headerlink" title="r_ret = slave.get(â€˜fooâ€™)"></a>r_ret = slave.get(â€˜fooâ€™)</h1><h1 id="print-r-ret"><a href="#print-r-ret" class="headerlink" title="print(r_ret)"></a>print(r_ret)</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## åä¸€. ç®¡é“(pipline)</span><br><span class="line">redis-pyé»˜è®¤åœ¨æ‰§è¡Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºï¼ˆè¿æ¥æ± ç”³è¯·è¿æ¥ï¼‰å’Œæ–­å¼€ï¼ˆå½’è¿˜è¿æ¥æ± ï¼‰ä¸€æ¬¡è¿æ¥æ“ä½œï¼Œå¦‚æœæƒ³è¦åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æŒ‡å®šå¤šä¸ªå‘½ä»¤ï¼Œåˆ™å¯ä»¥ä½¿ç”¨piplineå®ç°ä¸€æ¬¡è¯·æ±‚æŒ‡å®šå¤šä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ä¸€æ¬¡pipline æ˜¯åŸå­æ€§æ“ä½œ</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>import redis</p>
<p>pool = redis.ConnectionPool(host=â€™192.168.1.100â€™, port=6379)</p>
<p>r = redis.Redis(connection_pool=pool)</p>
<h1 id="pipe-r-pipeline-transaction-False"><a href="#pipe-r-pipeline-transaction-False" class="headerlink" title="pipe = r.pipeline(transaction=False)"></a>pipe = r.pipeline(transaction=False)</h1><p>pipe = r.pipeline(transaction=True)</p>
<p>r.set(â€˜nameâ€™, â€˜shukeâ€™)<br>r.set(â€˜roleâ€™, â€˜DevOpsâ€™)<br>pipe.execute()</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">## åäºŒ. å‘å¸ƒè®¢é˜…</span><br><span class="line">å‘å¸ƒè€…: æœåŠ¡å™¨</span><br><span class="line">è®¢é˜…è€…: Dashboadå’Œæ•°æ®å¤„ç†</span><br><span class="line"></span><br><span class="line">å·¥å…·ç±»:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-2"><a href="#coding-utf-8-2" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>import redis</p>
<p>class RedisHelper:</p>
<pre><code>def __init__(self):
    self.__conn = redis.Redis(host=&apos;192.168.1.100&apos;)
    self.chan_sub = &apos;fm104.5&apos;
    self.chan_pub = &apos;fm104.5&apos;

def public(self, msg):
    self.__conn.publish(self.chan_pub, msg)
    return True

def subscribe(self):
    pub = self.__conn.pubsub()
    pub.subscribe(self.chan_sub)
    pub.parse_response()
    return pub</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¢é˜…è€…:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-3"><a href="#coding-utf-8-3" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from monitor.RedisHelper import RedisHelper</p>
<p>obj = RedisHelper()<br>redis_sub = obj.subscribe()</p>
<p>while True:<br>    msg= redis_sub.parse_response()<br>    print msg</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å‘å¸ƒè€…:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-4"><a href="#coding-utf-8-4" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from monitor.RedisHelper import RedisHelper</p>
<p>obj = RedisHelper()<br>obj.public(â€˜helloâ€™)</p>
<pre><code>
## åä¸‰. Redisåº”ç”¨åœºæ™¯ä»‹ç»

1. ä½¿ç”¨Redisæœ‰å“ªäº›å¥½å¤„ï¼Ÿ
- é€Ÿåº¦å¿«ï¼Œå› ä¸ºæ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)

- æ”¯æŒä¸°å¯Œæ•°æ®ç±»å‹ï¼Œæ”¯æŒstringï¼Œlistï¼Œsetï¼Œsorted setï¼Œhash

- æ”¯æŒäº‹åŠ¡ï¼Œæ“ä½œéƒ½æ˜¯åŸå­æ€§ï¼Œæ‰€è°“çš„åŸå­æ€§å°±æ˜¯å¯¹æ•°æ®çš„æ›´æ”¹è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ

- ä¸°å¯Œçš„ç‰¹æ€§ï¼šå¯ç”¨äºç¼“å­˜ï¼Œæ¶ˆæ¯ï¼ŒæŒ‰keyè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿‡æœŸåå°†ä¼šè‡ªåŠ¨åˆ é™¤

2. redisç›¸æ¯”memcachedæœ‰å“ªäº›ä¼˜åŠ¿ï¼Ÿ

- memcachedæ‰€æœ‰çš„å€¼å‡æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œredisä½œä¸ºå…¶æ›¿ä»£è€…ï¼Œæ”¯æŒæ›´ä¸ºä¸°å¯Œçš„æ•°æ®ç±»å‹

- redisçš„é€Ÿåº¦æ¯”memcachedå¿«å¾ˆå¤š

- rediså¯ä»¥æŒä¹…åŒ–å…¶æ•°æ®

3. rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

-  Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚RDBå†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶

- å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡

- ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMasterå’ŒSlaveæœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…

- å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“

- ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3...

è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç°Slaveå¯¹Masterçš„æ›¿æ¢ã€‚å¦‚æœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚

4. MySQLé‡Œæœ‰2000wæ•°æ®ï¼Œredisä¸­åªå­˜20wçš„æ•°æ®ï¼Œå¦‚ä½•ä¿è¯redisä¸­çš„æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®

ç›¸å…³çŸ¥è¯†ï¼šredis å†…å­˜æ•°æ®é›†å¤§å°ä¸Šå‡åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™ï¼Œå°±ä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥,redisæä¾›6ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š

voltile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°

volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°

volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°

allkeys-lruï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°

allkeys-randomï¼šä»æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°

no-envictionï¼ˆé©±é€ï¼‰ï¼šç¦æ­¢é©±é€æ•°æ®

5. Memcacheä¸Redisçš„åŒºåˆ«éƒ½æœ‰å“ªäº›ï¼Ÿ

- å­˜å‚¨æ–¹å¼
MemecacheæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ï¼Œæ–­ç”µåä¼šæŒ‚æ‰ï¼Œæ•°æ®ä¸èƒ½è¶…è¿‡å†…å­˜å¤§å°ã€‚
Redisæœ‰éƒ¨ä»½å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™æ ·èƒ½ä¿è¯æ•°æ®çš„æŒä¹…æ€§ã€‚

- æ•°æ®æ”¯æŒç±»å‹
Memcacheå¯¹æ•°æ®ç±»å‹æ”¯æŒç›¸å¯¹ç®€å•ã€‚
Redisæœ‰å¤æ‚çš„æ•°æ®ç±»å‹ã€‚

- valueå¤§å°
redisæœ€å¤§å¯ä»¥è¾¾åˆ°1GBï¼Œè€Œmemcacheåªæœ‰1MB

6. Redis å¸¸è§çš„æ€§èƒ½é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ

- Masterå†™å†…å­˜å¿«ç…§ï¼Œsaveå‘½ä»¤è°ƒåº¦rdbSaveå‡½æ•°ï¼Œä¼šé˜»å¡ä¸»çº¿ç¨‹çš„å·¥ä½œï¼Œå½“å¿«ç…§æ¯”è¾ƒå¤§æ—¶å¯¹æ€§èƒ½å½±å“æ˜¯éå¸¸å¤§çš„ï¼Œä¼šé—´æ–­æ€§æš‚åœæœåŠ¡ï¼Œæ‰€ä»¥Masteræœ€å¥½ä¸è¦å†™å†…å­˜å¿«ç…§ã€‚

- Master AOFæŒä¹…åŒ–ï¼Œå¦‚æœä¸é‡å†™AOFæ–‡ä»¶ï¼Œè¿™ä¸ªæŒä¹…åŒ–æ–¹å¼å¯¹æ€§èƒ½çš„å½±å“æ˜¯æœ€å°çš„ï¼Œä½†æ˜¯AOFæ–‡ä»¶ä¼šä¸æ–­å¢å¤§ï¼ŒAOFæ–‡ä»¶è¿‡å¤§ä¼šå½±å“Masteré‡å¯çš„æ¢å¤é€Ÿåº¦ã€‚Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼ŒåŒ…æ‹¬å†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ä¸è¦å¯ç”¨å†…å­˜å¿«ç…§åšæŒä¹…åŒ–,å¦‚æœæ•°æ®æ¯”è¾ƒå…³é”®ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ã€‚

- Masterè°ƒç”¨BGREWRITEAOFé‡å†™AOFæ–‡ä»¶ï¼ŒAOFåœ¨é‡å†™çš„æ—¶å€™ä¼šå å¤§é‡çš„CPUå’Œå†…å­˜èµ„æºï¼Œå¯¼è‡´æœåŠ¡loadè¿‡é«˜ï¼Œå‡ºç°çŸ­æš‚æœåŠ¡æš‚åœç°è±¡ã€‚

- Redisä¸»ä»å¤åˆ¶çš„æ€§èƒ½é—®é¢˜ï¼Œä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒSlaveå’ŒMasteræœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…

7. redis æœ€é€‚åˆçš„åœºæ™¯

Redisæœ€é€‚åˆæ‰€æœ‰æ•°æ®in-momoryçš„åœºæ™¯ï¼Œè™½ç„¶Redisä¹Ÿæä¾›æŒä¹…åŒ–åŠŸèƒ½ï¼Œä½†å®é™…æ›´å¤šçš„æ˜¯ä¸€ä¸ªdisk-backedçš„åŠŸèƒ½ï¼Œè·Ÿä¼ ç»Ÿæ„ä¹‰ä¸Šçš„æŒä¹…åŒ–æœ‰æ¯”è¾ƒå¤§çš„å·®åˆ«ï¼Œé‚£ä¹ˆå¯èƒ½å¤§å®¶å°±ä¼šæœ‰ç–‘é—®ï¼Œä¼¼ä¹Redisæ›´åƒä¸€ä¸ªåŠ å¼ºç‰ˆçš„Memcachedï¼Œé‚£ä¹ˆä½•æ—¶ä½¿ç”¨Memcached,ä½•æ—¶ä½¿ç”¨Rediså‘¢?

å¦‚æœç®€å•åœ°æ¯”è¾ƒRedisä¸Memcachedçš„åŒºåˆ«ï¼Œå¤§å¤šæ•°éƒ½ä¼šå¾—åˆ°ä»¥ä¸‹è§‚ç‚¹ï¼š
- Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„k/vç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚
- Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚
- Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚

8. ä¼šè¯ç¼“å­˜ï¼ˆSession Cacheï¼‰

æœ€å¸¸ç”¨çš„ä¸€ç§ä½¿ç”¨Redisçš„æƒ…æ™¯æ˜¯ä¼šè¯ç¼“å­˜ï¼ˆsession cacheï¼‰ã€‚ç”¨Redisç¼“å­˜ä¼šè¯æ¯”å…¶ä»–å­˜å‚¨ï¼ˆå¦‚Memcachedï¼‰çš„ä¼˜åŠ¿åœ¨äºï¼šRedisæä¾›æŒä¹…åŒ–ã€‚å½“ç»´æŠ¤ä¸€ä¸ªä¸æ˜¯ä¸¥æ ¼è¦æ±‚ä¸€è‡´æ€§çš„ç¼“å­˜æ—¶ï¼Œå¦‚æœç”¨æˆ·çš„è´­ç‰©è½¦ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ï¼Œå¤§éƒ¨åˆ†äººéƒ½ä¼šä¸é«˜å…´çš„ï¼Œç°åœ¨ï¼Œä»–ä»¬è¿˜ä¼šè¿™æ ·å—ï¼Ÿ
å¹¸è¿çš„æ˜¯ï¼Œéšç€ Redis è¿™äº›å¹´çš„æ”¹è¿›ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ°æ€ä¹ˆæ°å½“çš„ä½¿ç”¨Redisæ¥ç¼“å­˜ä¼šè¯çš„æ–‡æ¡£ã€‚ç”šè‡³å¹¿ä¸ºäººçŸ¥çš„å•†ä¸šå¹³å°Magentoä¹Ÿæä¾›Redisçš„æ’ä»¶ã€‚

9. å…¨é¡µç¼“å­˜ï¼ˆFPCï¼‰

é™¤åŸºæœ¬çš„ä¼šè¯tokenä¹‹å¤–ï¼ŒRedisè¿˜æä¾›å¾ˆç®€ä¾¿çš„FPCå¹³å°ã€‚å›åˆ°ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ä½¿é‡å¯äº†Rediså®ä¾‹ï¼Œå› ä¸ºæœ‰ç£ç›˜çš„æŒä¹…åŒ–ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šçœ‹åˆ°é¡µé¢åŠ è½½é€Ÿåº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¤§æ”¹è¿›ï¼Œç±»ä¼¼PHPæœ¬åœ°FPCã€‚
å†æ¬¡ä»¥Magentoä¸ºä¾‹ï¼ŒMagentoæä¾›ä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨Redisä½œä¸ºå…¨é¡µç¼“å­˜åç«¯ã€‚
æ­¤å¤–ï¼Œå¯¹WordPressçš„ç”¨æˆ·æ¥è¯´ï¼ŒPantheonæœ‰ä¸€ä¸ªéå¸¸å¥½çš„æ’ä»¶  wp-redisï¼Œè¿™ä¸ªæ’ä»¶èƒ½å¸®åŠ©ä½ ä»¥æœ€å¿«é€Ÿåº¦åŠ è½½ä½ æ›¾æµè§ˆè¿‡çš„é¡µé¢ã€‚

10. é˜Ÿåˆ—
Reidsåœ¨å†…å­˜å­˜å‚¨å¼•æ“é¢†åŸŸçš„ä¸€å¤§ä¼˜ç‚¹æ˜¯æä¾› list å’Œ set æ“ä½œï¼Œè¿™ä½¿å¾—Redisèƒ½ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¶ˆæ¯é˜Ÿåˆ—å¹³å°æ¥ä½¿ç”¨ã€‚Redisä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨çš„æ“ä½œï¼Œå°±ç±»ä¼¼äºæœ¬åœ°ç¨‹åºè¯­è¨€ï¼ˆå¦‚Pythonï¼‰å¯¹ list çš„ push/pop æ“ä½œã€‚
å¦‚æœä½ å¿«é€Ÿçš„åœ¨Googleä¸­æœç´¢â€œRedis queuesâ€ï¼Œä½ é©¬ä¸Šå°±èƒ½æ‰¾åˆ°å¤§é‡çš„å¼€æºé¡¹ç›®ï¼Œè¿™äº›é¡¹ç›®çš„ç›®çš„å°±æ˜¯åˆ©ç”¨Redisåˆ›å»ºéå¸¸å¥½çš„åç«¯å·¥å…·ï¼Œä»¥æ»¡è¶³å„ç§é˜Ÿåˆ—éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒCeleryæœ‰ä¸€ä¸ªåå°å°±æ˜¯ä½¿ç”¨Redisä½œä¸ºbrokerï¼Œä½ å¯ä»¥ä»è¿™é‡Œå»æŸ¥çœ‹ã€‚

11. æ’è¡Œæ¦œ/è®¡æ•°å™¨
Redisåœ¨å†…å­˜ä¸­å¯¹æ•°å­—è¿›è¡Œé€’å¢æˆ–é€’å‡çš„æ“ä½œå®ç°çš„éå¸¸å¥½ã€‚é›†åˆï¼ˆSetï¼‰å’Œæœ‰åºé›†åˆï¼ˆSorted Setï¼‰ä¹Ÿä½¿å¾—æˆ‘ä»¬åœ¨æ‰§è¡Œè¿™äº›æ“ä½œçš„æ—¶å€™å˜çš„éå¸¸ç®€å•ï¼ŒRedisåªæ˜¯æ­£å¥½æä¾›äº†è¿™ä¸¤ç§æ•°æ®ç»“æ„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ä»æ’åºé›†åˆä¸­è·å–åˆ°æ’åæœ€é å‰çš„10ä¸ªç”¨æˆ·â€“æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œuser_scoresâ€ï¼Œæˆ‘ä»¬åªéœ€è¦åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œå³å¯ï¼š
å½“ç„¶ï¼Œè¿™æ˜¯å‡å®šä½ æ˜¯æ ¹æ®ä½ ç”¨æˆ·çš„åˆ†æ•°åšé€’å¢çš„æ’åºã€‚å¦‚æœä½ æƒ³è¿”å›ç”¨æˆ·åŠç”¨æˆ·çš„åˆ†æ•°ï¼Œä½ éœ€è¦è¿™æ ·æ‰§è¡Œï¼š
ZRANGE user_scores 0 10 WITHSCORES
Agora Gameså°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨Rubyå®ç°çš„ï¼Œå®ƒçš„æ’è¡Œæ¦œå°±æ˜¯ä½¿ç”¨Redisæ¥å­˜å‚¨æ•°æ®çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ã€‚

12. å‘å¸ƒ/è®¢é˜…
æœ€åï¼ˆä½†è‚¯å®šä¸æ˜¯æœ€ä¸é‡è¦çš„ï¼‰æ˜¯Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½ã€‚å‘å¸ƒ/è®¢é˜…çš„ä½¿ç”¨åœºæ™¯ç¡®å®éå¸¸å¤šã€‚æˆ‘å·²çœ‹è§äººä»¬åœ¨ç¤¾äº¤ç½‘ç»œè¿æ¥ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä½œä¸ºåŸºäºå‘å¸ƒ/è®¢é˜…çš„è„šæœ¬è§¦å‘å™¨ï¼Œç”šè‡³ç”¨Redisçš„å‘å¸ƒ/è®¢é˜…åŠŸèƒ½æ¥å»ºç«‹èŠå¤©ç³»ç»Ÿï¼(ä¸ï¼Œè¿™æ˜¯çœŸçš„ï¼Œä½ å¯ä»¥å»æ ¸å®)
Redisæä¾›çš„æ‰€æœ‰ç‰¹æ€§ä¸­ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªæ˜¯å–œæ¬¢çš„äººæœ€å°‘çš„ä¸€ä¸ªï¼Œè™½ç„¶å®ƒä¸ºç”¨æˆ·æä¾›å¦‚æœæ­¤å¤šåŠŸèƒ½ã€‚


å‚è€ƒæ–‡ç« :  
[Pythonæ“ä½œredisè¯¦è§£ | Polar Snow Documentation](https://docs.lvrui.io/2016/07/24/Python%E6%93%8D%E4%BD%9Credis%E8%AF%A6%E8%A7%A3/)  
[ä½¿ç”¨pythonæ¥æ“ä½œredisç”¨æ³•è¯¦è§£ - ç®€ä¹¦](https://www.jianshu.com/p/2639549bedc8)  
[Pythonæ“ä½œ RabbitMQã€Redisã€Memcacheã€SQLAlchemy](http://www.cnblogs.com/wupeiqi/articles/5132791.html)  
[GitHub - andymccurdy/redis-py: Redis Python Client](https://github.com/andymccurdy/redis-py/)  
</code></pre>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå•ä¾‹æ¨¡å¼</title>
    <url>/2020/04/20/python%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    <content><![CDATA[<h2 id="pythonå•ä¾‹æ¨¡å¼"><a href="#pythonå•ä¾‹æ¨¡å¼" class="headerlink" title="pythonå•ä¾‹æ¨¡å¼"></a>pythonå•ä¾‹æ¨¡å¼</h2><h2 id="ä¸€-ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"><a href="#ä¸€-ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼" class="headerlink" title="ä¸€. ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼"></a>ä¸€. ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼</h2><p>å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œè¯¥æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ã€‚å½“ä½ å¸Œæœ›åœ¨æ•´ä¸ªç³»ç»Ÿä¸­ï¼ŒæŸä¸ªç±»åªèƒ½å‡ºç°ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå•ä¾‹å¯¹è±¡å°±èƒ½æ´¾ä¸Šç”¨åœºã€‚</p>
<p>æ¯”å¦‚ï¼ŒæŸä¸ªæœåŠ¡å™¨ç¨‹åºçš„é…ç½®ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡ä¸€ä¸ª AppConfig çš„ç±»æ¥è¯»å–é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ã€‚å¦‚æœåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦åˆ›å»º AppConfig å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™å°±å¯¼è‡´ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ª AppConfig çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œè¿™æ ·ä¼šä¸¥é‡æµªè´¹å†…å­˜èµ„æºï¼Œå°¤å…¶æ˜¯åœ¨é…ç½®æ–‡ä»¶å†…å®¹å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚äº‹å®ä¸Šï¼Œç±»ä¼¼ AppConfig è¿™æ ·çš„ç±»ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹å¯¹è±¡ã€‚</p>
<h2 id="äºŒ-å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"><a href="#äºŒ-å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="äºŒ. å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"></a>äºŒ. å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼</h2><p>åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¤šç§æ–¹æ³•æ¥å®ç°å•ä¾‹æ¨¡å¼ï¼š<br>ä½¿ç”¨æ¨¡å—<br>ä½¿ç”¨ <strong>new</strong><br>ä½¿ç”¨è£…é¥°å™¨ï¼ˆdecoratorï¼‰<br>ä½¿ç”¨å…ƒç±»ï¼ˆmetaclass)</p>
<h3 id="2-1-ä½¿ç”¨æ¨¡å—"><a href="#2-1-ä½¿ç”¨æ¨¡å—" class="headerlink" title="2.1 ä½¿ç”¨æ¨¡å—"></a>2.1 ä½¿ç”¨æ¨¡å—</h3><p>å…¶å®ï¼ŒPython çš„æ¨¡å—å°±æ˜¯å¤©ç„¶çš„å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºæ¨¡å—åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶ï¼Œä¼šç”Ÿæˆ .pyc æ–‡ä»¶ï¼Œå½“ç¬¬äºŒæ¬¡å¯¼å…¥æ—¶ï¼Œå°±ä¼šç›´æ¥åŠ è½½ .pyc æ–‡ä»¶ï¼Œè€Œä¸ä¼šå†æ¬¡æ‰§è¡Œæ¨¡å—ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€æŠŠç›¸å…³çš„å‡½æ•°å’Œæ•°æ®å®šä¹‰åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå°±å¯ä»¥è·å¾—ä¸€ä¸ªå•ä¾‹å¯¹è±¡äº†ã€‚å¦‚æœæˆ‘ä»¬çœŸçš„æƒ³è¦ä¸€ä¸ªå•ä¾‹ç±»ï¼Œå¯ä»¥è€ƒè™‘è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># mysingleton.py</span><br><span class="line">class My_Singleton(object):</span><br><span class="line">    def foo(self):</span><br><span class="line">        pass</span><br><span class="line">        </span><br><span class="line">my_singleton &#x3D; My_Singleton()</span><br></pre></td></tr></table></figure>
<p>å°†ä¸Šé¢çš„ä»£ç ä¿å­˜åœ¨æ–‡ä»¶ mysingleton.py ä¸­ï¼Œç„¶åè¿™æ ·ä½¿ç”¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from mysingleton import my_singleton</span><br><span class="line">my_singleton.foo()</span><br></pre></td></tr></table></figure>

<h3 id="2-2-ä½¿ç”¨new"><a href="#2-2-ä½¿ç”¨new" class="headerlink" title="2.2 ä½¿ç”¨new"></a>2.2 ä½¿ç”¨<strong>new</strong></h3><p><strong>new</strong>()åœ¨<strong>init</strong>()ä¹‹å‰è¢«è°ƒç”¨ï¼Œç”¨äºç”Ÿæˆå®ä¾‹å¯¹è±¡ã€‚åˆ©ç”¨è¿™ä¸ªæ–¹æ³•å’Œç±»çš„å±æ€§çš„ç‰¹ç‚¹å¯ä»¥å®ç°è®¾è®¡æ¨¡å¼çš„å•ä¾‹æ¨¡å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singeton(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å•ä¾‹æ¨¡å¼</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not hasattr(cls, &#39;_instance&#39;):</span><br><span class="line">            # orig &#x3D; super(Singeton, cls)</span><br><span class="line">            cls._instance &#x3D; super(Singeton, cls).__new__(cls, *args, **kwargs)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MyCLass(Singeton):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line"></span><br><span class="line">one &#x3D; MyCLass()</span><br><span class="line">two &#x3D; MyCLass()</span><br><span class="line">print(one is two)</span><br><span class="line">print(one &#x3D;&#x3D; two)</span><br><span class="line">print(id(one), id(two))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">è¾“å‡º:</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">4436793720 4436793720</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†ç±»çš„å®ä¾‹å’Œä¸€ä¸ªç±»å˜é‡ _instance å…³è”èµ·æ¥ï¼Œå¦‚æœ cls._instance ä¸º None åˆ™åˆ›å»ºå®ä¾‹ï¼Œå¦åˆ™ç›´æ¥è¿”å› cls._instance</p>
<h3 id="2-3-å…±äº«å±æ€§"><a href="#2-3-å…±äº«å±æ€§" class="headerlink" title="2.3 å…±äº«å±æ€§"></a>2.3 å…±äº«å±æ€§</h3><p>åˆ›å»ºå®ä¾‹æ—¶æŠŠæ‰€æœ‰å®ä¾‹çš„<strong>dict</strong>æŒ‡å‘åŒä¸€ä¸ªå­—å…¸,è¿™æ ·å®ƒä»¬å…·æœ‰ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Borg(object):</span><br><span class="line">    _state &#x3D; &#123;&#125;</span><br><span class="line">    def __new__(cls, *args, **kw):</span><br><span class="line">        ob &#x3D; super(Borg, cls).__new__(cls, *args, **kw)</span><br><span class="line">        ob.__dict__ &#x3D; cls._state</span><br><span class="line">        return ob</span><br><span class="line"></span><br><span class="line">class MyClass2(Borg):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line">    </span><br><span class="line"># æ²¡æ˜ç™½è¯¥æ–¹å¼å¦‚ä½•å®ç°å•ä¾‹</span><br></pre></td></tr></table></figure>

<h3 id="2-4-è£…é¥°å™¨æ–¹å¼"><a href="#2-4-è£…é¥°å™¨æ–¹å¼" class="headerlink" title="2.4 è£…é¥°å™¨æ–¹å¼"></a>2.4 è£…é¥°å™¨æ–¹å¼</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œè£…é¥°å™¨ï¼ˆdecoratorï¼‰å¯ä»¥åŠ¨æ€åœ°ä¿®æ”¹ä¸€ä¸ªç±»æˆ–å‡½æ•°çš„åŠŸèƒ½ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¥è£…é¥°æŸä¸ªç±»ï¼Œä½¿å…¶åªèƒ½ç”Ÿæˆä¸€ä¸ªå®ä¾‹ï¼Œä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from functools import wraps</span><br><span class="line"></span><br><span class="line">def singleton(cls):</span><br><span class="line">    instances &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @wraps(cls)</span><br><span class="line">    def getinstance(*args, **kw):</span><br><span class="line">        if cls not in instances:</span><br><span class="line">            instances[cls] &#x3D; cls(*args, **kw)</span><br><span class="line">        return instances[cls]</span><br><span class="line"></span><br><span class="line">    return getinstance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@singleton</span><br><span class="line">class MyClass(object):</span><br><span class="line">    a &#x3D; 1</span><br><span class="line"></span><br><span class="line">one &#x3D; MyClass()</span><br><span class="line">two &#x3D; MyClass()</span><br><span class="line">print(one is two)</span><br><span class="line">print(one &#x3D;&#x3D; two)</span><br><span class="line">print(id(one), id(two))</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">4492352536 4492352536</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè£…é¥°å™¨singletonï¼Œå®ƒè¿”å›äº†ä¸€ä¸ªå†…éƒ¨å‡½æ•° getinstanceï¼Œè¯¥å‡½æ•°ä¼šåˆ¤æ–­æŸä¸ªç±»æ˜¯å¦åœ¨å­—å…¸ instances ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šå°† cls ä½œä¸º keyï¼Œcls(*args, **kw)ä½œä¸º valueå­˜åˆ°instancesä¸­,å¦åˆ™,ç›´æ¥è¿”å› instances[cls]ã€‚</p>
<h3 id="2-5-ä½¿ç”¨metaclass"><a href="#2-5-ä½¿ç”¨metaclass" class="headerlink" title="2.5 ä½¿ç”¨metaclass"></a>2.5 ä½¿ç”¨metaclass</h3><p>å…ƒç±»ï¼ˆmetaclassï¼‰å¯ä»¥æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå®ƒä¸»è¦åšä¸‰ä»¶äº‹ï¼š</p>
<ul>
<li>æ‹¦æˆªç±»çš„åˆ›å»º</li>
<li>ä¿®æ”¹ç±»çš„å®šä¹‰</li>
<li>è¿”å›ä¿®æ”¹åçš„ç±»<br>ä½¿ç”¨å…ƒç±»å®ç°å•ä¾‹æ¨¡å¼çš„ä»£ç å¦‚ä¸‹:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Singleton(type):</span><br><span class="line">    _instances &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def __call__(cls, *args, **kwargs):</span><br><span class="line">        if cls not in cls._instances:</span><br><span class="line">            cls._instances[cls] &#x3D; super(Singleton, cls).__call__(*args, **kwargs)</span><br><span class="line">        return cls._instances[cls]</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">class MyClass(object):</span><br><span class="line">    __metaclass__ &#x3D; Singleton</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Python3</span><br><span class="line">class MyClass(metaclass&#x3D;Singleton):</span><br><span class="line">    pass</span><br></pre></td></tr></table></figure>
</li>
</ul>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€äº›æœ‰è¶£çš„pythonæŠ€å·§</title>
    <url>/2020/04/20/%E4%B8%80%E4%BA%9B%E6%9C%89%E8%B6%A3%E7%9A%84python%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<h2 id="ä¸€äº›æœ‰è¶£çš„pythonæŠ€å·§"><a href="#ä¸€äº›æœ‰è¶£çš„pythonæŠ€å·§" class="headerlink" title="ä¸€äº›æœ‰è¶£çš„pythonæŠ€å·§"></a>ä¸€äº›æœ‰è¶£çš„pythonæŠ€å·§</h2><p>pythonæœ‰æ—¶å€™ç®€å•èµ·æ¥è¿æˆ‘è‡ªå·±éƒ½æ€•ï¼Œæœ‰æ—¶å€™å…¶ä»–è¯­è¨€éœ€è¦å‡ åå†™å‡ºæ¥çš„pythonå‡ è¡Œæå®šã€‚ è¿™é‡Œç»å¸¸æ”¶é›†ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿è¿˜æ˜¯å¾ˆå¥½ç©çš„ã€‚</p>
<h3 id="ç®€å•çš„HTTPæœåŠ¡å™¨"><a href="#ç®€å•çš„HTTPæœåŠ¡å™¨" class="headerlink" title="ç®€å•çš„HTTPæœåŠ¡å™¨"></a>ç®€å•çš„HTTPæœåŠ¡å™¨</h3><p>ä½ æƒ³å¿«é€Ÿç®€å•çš„åˆ†äº«ç›®å½•ä¸‹çš„æ–‡ä»¶å—ï¼Ÿå¯ä»¥è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd $HOME&#x2F;work&#x2F;</span><br><span class="line"></span><br><span class="line"># Python2</span><br><span class="line">python -m SimpleHTTPServer</span><br><span class="line"></span><br><span class="line"># Python 3</span><br><span class="line">python3 -m http.server 8000</span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ«äººå°±å¯ä»¥æ‰“å¼€<a href="http://ip:8000" target="_blank" rel="noopener">http://ip:8000</a> æ¥è®¿é—®è¿™ä¸ªç®€å•çš„WebæœåŠ¡å™¨äº†,å¦‚æœè¯¥æ–‡ä»¶å¤¹é‡Œé¢æœ‰ä¸ªindex.htmlå°±æ˜¾ç¤ºå®ƒï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ã€‚ è¿™æ ·å°±èƒ½ç»™åˆ«äººå¿«é€Ÿåˆ†äº«æ–‡ä»¶æˆ–å±•ç¤ºä½ çš„ç½‘ç«™ã€‚</p>
<h3 id="ç®€å•çš„FTPæœåŠ¡å™¨"><a href="#ç®€å•çš„FTPæœåŠ¡å™¨" class="headerlink" title="ç®€å•çš„FTPæœåŠ¡å™¨"></a>ç®€å•çš„FTPæœåŠ¡å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pip install pyftpdlib</span><br><span class="line">python -m pyftpdlib -p 21</span><br></pre></td></tr></table></figure>
<p>å¯é€‰å‚æ•°</p>
<ul>
<li>-i æŒ‡å®šIPåœ°å€ï¼ˆé»˜è®¤ä¸ºæœ¬æœºçš„IPåœ°å€ï¼‰</li>
<li>-p æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤ä¸º2121ï¼‰</li>
<li>-w å†™æƒé™ï¼ˆé»˜è®¤ä¸ºåªè¯»ï¼‰</li>
<li>-d æŒ‡å®šç›®å½• ï¼ˆé»˜è®¤ä¸ºå½“å‰ç›®å½•ï¼‰</li>
<li>-u æŒ‡å®šç”¨æˆ·åç™»å½•</li>
<li>-P è®¾ç½®ç™»å½•å¯†ç </li>
</ul>
<h3 id="ä¼˜é›…çš„æ‰“å°"><a href="#ä¼˜é›…çš„æ‰“å°" class="headerlink" title="ä¼˜é›…çš„æ‰“å°"></a>ä¼˜é›…çš„æ‰“å°</h3><p>ä¸‹é¢çš„æ–¹å¼å¯ä»¥ç”¨ä¼˜é›…çš„æ–¹å¼æ‰“å°å­—å…¸å’Œåˆ—è¡¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from pprint import pprint</span><br><span class="line">pprint(my_dict)</span><br></pre></td></tr></table></figure>
<p>è¿™ç”¨äºå­—æ®µæ‰“å°æ˜¯éå¸¸é«˜æ•ˆçš„,å¦‚æœä½ æƒ³ä»æ–‡ä»¶ä¸­å¿«é€Ÿä¼˜é›…çš„æ‰“å°jsonæ ¼å¼çš„æ•°æ®,å¯ä»¥è¿™æ ·åš:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat file.json | python -m json.tool</span><br></pre></td></tr></table></figure>




]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>python é­”æœ¯æ–¹æ³•</title>
    <url>/2020/04/20/python-%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="python-é­”æœ¯æ–¹æ³•"><a href="#python-é­”æœ¯æ–¹æ³•" class="headerlink" title="python é­”æœ¯æ–¹æ³•"></a>python é­”æœ¯æ–¹æ³•</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨åšpythonå¼€å‘çš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬å¤§å®¶éƒ½ä¼šé‡åˆ°åœ¨class(ç±»)ä¸­ä½¿ç”¨åŒä¸‹åˆ’çº¿çš„æ–¹æ³•,è¿™äº›éƒ½æ˜¯æˆ‘ä»¬ç»å¸¸æ‰€è¯´çš„â€é­”æ³•â€æ–¹æ³•.è¿™äº›æ–¹æ³•å¯ä»¥å¯¹ç±»æ·»åŠ ç‰¹æ®Šçš„åŠŸèƒ½,ä½¿ç”¨æ°å½“å¯ä»¥å¾ˆå¤§çš„æå‡æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­çš„ä¾¿æ·æ€§,æ–¹ä¾¿çš„è¿›è¡Œæ‰©å±•.</p>
<h3 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h3><p>ç›®å‰æˆ‘ä»¬å¸¸è§çš„é­”æ³•æ–¹æ³•å¤§è‡´å¯åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li>æ„é€ ä¸åˆå§‹åŒ–</li>
<li>ç±»çš„è¡¨ç¤º</li>
<li>è®¿é—®æ§åˆ¶</li>
<li>æ¯”è¾ƒæ“ä½œ</li>
<li>å®¹å™¨ç±»æ“ä½œ</li>
<li>å¯è°ƒç”¨å¯¹è±¡</li>
<li>Picklingåºåˆ—åŒ–</li>
</ul>
<p>æˆ‘ä»¬è¿™æ¬¡ä¸»è¦ä»‹ç»è¿™å‡ ç±»å¸¸ç”¨é­”æ³•æ–¹æ³•:</p>
<h4 id="1-æ„é€ ä¸åˆå§‹åŒ–"><a href="#1-æ„é€ ä¸åˆå§‹åŒ–" class="headerlink" title="1.æ„é€ ä¸åˆå§‹åŒ–"></a>1.æ„é€ ä¸åˆå§‹åŒ–</h4><p>__init__<br>æ„é€ æ–¹æ³•æ˜¯æˆ‘ä»¬ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„é­”æ³•æ–¹æ³•äº†ï¼Œå‡ ä¹åœ¨æˆ‘ä»¬å®šä¹‰ç±»çš„æ—¶å€™ï¼Œéƒ½ä¼šå»å®šä¹‰æ„é€ æ–¹æ³•ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨å°±æ˜¯åœ¨åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®šä¹‰è¿™ä¸ªå¯¹è±¡çš„åˆå§‹å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 &#x3D; Person(&#39;Jack&#39;, 25)</span><br><span class="line">p2 &#x3D; Person(&#39;shuke&#39;, 20)</span><br></pre></td></tr></table></figure>
<p>__new__</p>
<ol>
<li>äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬ç†è§£äº†<strong>new</strong>æ–¹æ³•åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨å®ƒæ¥åšä¸€äº›å…¶ä»–æœ‰è¶£çš„äº‹æƒ…ï¼Œæ¯”å¦‚å®ç° è®¾è®¡æ¨¡å¼ä¸­çš„ å•ä¾‹æ¨¡å¼(singleton)</li>
<li>ä¾ç…§Pythonå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼Œ<strong>new</strong>æ–¹æ³•ä¸»è¦æ˜¯å½“ä½ ç»§æ‰¿ä¸€äº›ä¸å¯å˜çš„classæ—¶(æ¯”å¦‚int, str, tuple)ï¼Œ æä¾›ç»™ä½ ä¸€ä¸ªè‡ªå®šä¹‰è¿™äº›ç±»çš„å®ä¾‹åŒ–è¿‡ç¨‹çš„é€”å¾„ã€‚è¿˜æœ‰å°±æ˜¯å®ç°è‡ªå®šä¹‰çš„metaclass</li>
<li>è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ä¸€èˆ¬å¾ˆå°‘å®šä¹‰ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨ä¸€äº›å¼€æºæ¡†æ¶ä¸­å¶å°”ä¼šé‡åˆ°å®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»ã€‚å®é™…ä¸Šï¼Œè¿™æ‰æ˜¯â€çœŸæ­£çš„æ„é€ æ–¹æ³•â€ï¼Œå®ƒä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨ï¼Œç„¶åå†è°ƒç”¨<strong>init</strong>ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦å¦‚ä¸‹ï¼š</li>
</ol>
<ul>
<li><strong>new</strong>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯clsï¼Œè€Œ<strong>init</strong>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯self</li>
<li><strong>new</strong>è¿”å›å€¼æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œè€Œ<strong>init</strong>æ²¡æœ‰ä»»ä½•è¿”å›å€¼ï¼Œåªåšåˆå§‹åŒ–æ“ä½œ</li>
<li><strong>new</strong>ç”±äºæ˜¯è¿”å›ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç»™æ‰€æœ‰å®ä¾‹è¿›è¡Œç»Ÿä¸€çš„åˆå§‹åŒ–æ“ä½œ</li>
</ul>
<ol start="4">
<li>ç”±äº<strong>new</strong>ä¼˜å…ˆäº<strong>init</strong>è°ƒç”¨ï¼Œä¸”è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæ¯æ¬¡è¿”å›åŒä¸€ä¸ªå®ä¾‹æ¥å®ç°ä¸€ä¸ªå•ä¾‹ç±»ï¼š</li>
</ol>
<p>__new__çš„ä½œç”¨:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class PositiveInteger(int):</span><br><span class="line"></span><br><span class="line">  def __init__(self, value):</span><br><span class="line"></span><br><span class="line">    super(PositiveInteger, self).__init__(self, abs(value))</span><br><span class="line"></span><br><span class="line">i &#x3D; PositiveInteger(-3)</span><br><span class="line"></span><br><span class="line">print(i)</span><br></pre></td></tr></table></figure>
<p>ä½†è¿è¡Œåä¼šå‘ç°ï¼Œç»“æœæ ¹æœ¬ä¸æ˜¯æˆ‘ä»¬æƒ³çš„é‚£æ ·ï¼Œæˆ‘ä»¬ä»ç„¶å¾—åˆ°äº†-3ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºintè¿™ç§ä¸å¯å˜çš„å¯¹è±¡ï¼Œæˆ‘ä»¬åªæœ‰é‡è½½å®ƒçš„<strong>new</strong>æ–¹æ³•æ‰èƒ½èµ·åˆ°è‡ªå®šä¹‰çš„ä½œç”¨ã€‚<br>ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class PositiveInteger(int):</span><br><span class="line"></span><br><span class="line">  def __new__(cls, value):</span><br><span class="line"></span><br><span class="line">    return super(PositiveInteger, cls).__new__(cls, abs(value))</span><br><span class="line"></span><br><span class="line">i &#x3D; PositiveInteger(-3)</span><br><span class="line"></span><br><span class="line">print(i)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡é‡è½½<strong>new</strong>æ–¹æ³•ï¼Œæˆ‘ä»¬å®ç°äº†éœ€è¦çš„åŠŸèƒ½.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class g(float):</span><br><span class="line">    &quot;&quot;&quot;åƒå…‹è½¬å…‹&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __new__(cls, kg):</span><br><span class="line">        return float.__new__(cls, kg * 2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 50åƒå…‹è½¬ä¸ºå…‹</span><br><span class="line">a &#x3D; g(50)</span><br><span class="line">print(a)  # 100.0</span><br><span class="line">print(a + 100)  # 200.0 ç”±äºç»§æ‰¿äº†floatï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿ç®—ï¼Œéå¸¸æ–¹ä¾¿ï¼</span><br></pre></td></tr></table></figure>


<p>ç”¨<strong>new</strong>æ¥å®ç°å•ä¾‹<br>å› ä¸ºç±»æ¯ä¸€æ¬¡å®ä¾‹åŒ–åäº§ç”Ÿçš„è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡<strong>new</strong>æ¥æ§åˆ¶çš„ï¼Œæ‰€ä»¥é€šè¿‡é‡è½½<strong>new</strong>æ–¹æ³•ï¼Œæˆ‘ä»¬ å¯ä»¥å¾ˆç®€å•çš„å®ç°å•ä¾‹æ¨¡å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># å†™æ³•ä¸€</span><br><span class="line">class Singleton(object):</span><br><span class="line">    def __new__(cls):</span><br><span class="line">        # å…³é”®åœ¨äºè¿™ï¼Œæ¯ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½åªä¼šè¿”å›è¿™åŒä¸€ä¸ªinstanceå¯¹è±¡</span><br><span class="line"></span><br><span class="line">        if not hasattr(cls, &#39;instance&#39;):</span><br><span class="line">            cls.instance &#x3D; super(Singleton, cls).__new__(cls)</span><br><span class="line"></span><br><span class="line">        return cls.instance</span><br><span class="line"></span><br><span class="line">obj1 &#x3D; Singleton()</span><br><span class="line">obj2 &#x3D; Singleton()</span><br><span class="line">obj1.attr1 &#x3D; &#39;value1&#39;</span><br><span class="line">print(obj1.attr1, obj2.attr1)</span><br><span class="line">print(obj1 is obj2)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">value1 value1</span><br><span class="line">True</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">å¯ä»¥çœ‹åˆ°obj1å’Œobj2æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</span><br><span class="line"></span><br><span class="line"># å†™æ³•äºŒ</span><br><span class="line">class Singleton(object):</span><br><span class="line">    &quot;&quot;&quot;å•ä¾‹&quot;&quot;&quot;</span><br><span class="line">    _instance &#x3D; None</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not cls._instance:</span><br><span class="line">            cls._instance &#x3D; super(Singleton, cls).__new__(cls, *args, **kwargs)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MySingleton(Singleton):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a &#x3D; MySingleton()</span><br><span class="line">b &#x3D; MySingleton()</span><br><span class="line">print(a is b)</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">True</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h4 id="2-delææ„æ–¹æ³•"><a href="#2-delææ„æ–¹æ³•" class="headerlink" title="2. delææ„æ–¹æ³•"></a>2. <strong>del</strong>ææ„æ–¹æ³•</h4><p>è¿™ä¸ªæ–¹æ³•ä»£è¡¨ææ„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è¢«è°ƒç”¨ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œæ‰§è¡Œdel xä¸ä¸€å®šä¼šæ‰§è¡Œæ­¤æ–¹æ³•ã€‚</p>
<p>ç”±äºPythonæ˜¯é€šè¿‡å¼•ç”¨è®¡æ•°æ¥è¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¿™ä¸ªå®ä¾‹è¿˜æ˜¯æœ‰è¢«å¼•ç”¨åˆ°ï¼Œå³ä½¿æ‰§è¡Œdelé”€æ¯è¿™ä¸ªå¯¹è±¡ï¼Œä½†å…¶å¼•ç”¨è®¡æ•°è¿˜æ˜¯å¤§äº0ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘æ‰§è¡Œ<strong>del</strong>ã€‚<br>ä¾‹å­:<br>æ­¤æ—¶æˆ‘ä»¬æ²¡æœ‰å¯¹å®ä¾‹è¿›è¡Œä»»ä½•æ“ä½œæ—¶ï¼Œ<strong>del</strong>åœ¨ç¨‹åºé€€å‡ºåè¢«è°ƒç”¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __del__(self):</span><br><span class="line">        print(&#39;__del__&#39;)</span><br><span class="line"></span><br><span class="line">a &#x3D; Person()</span><br><span class="line">print(&#39;exit&#39;)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">exit</span><br><span class="line">__del__</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ­¤å®ä¾‹æ²¡æœ‰è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨ï¼Œå½“æˆ‘ä»¬æ‰‹åŠ¨é”€æ¯è¿™ä¸ªå®ä¾‹æ—¶ï¼Œ<strong>del</strong>è¢«è°ƒç”¨åç¨‹åºæ­£å¸¸é€€å‡ºã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __del__(self):</span><br><span class="line">        print(&#39;__del__&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a &#x3D; Person()</span><br><span class="line">b &#x3D; a  # bå¼•ç”¨a</span><br><span class="line">del a  # æ‰‹åŠ¨é”€æ¯,ä¸è§¦å‘__del__</span><br><span class="line">print(&#39;exit&#39;)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">exit</span><br><span class="line">__del__</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶å®ä¾‹æœ‰è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œå°½ç®¡æˆ‘ä»¬æ‰‹åŠ¨é”€æ¯è¿™ä¸ªå®ä¾‹ï¼Œä½†ä¾ç„¶ä¸ä¼šè§¦å‘<strong>del</strong>æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨ç¨‹åºæ­£å¸¸é€€å‡ºåè¢«è°ƒç”¨æ‰§è¡Œã€‚<br>ä¸ºäº†ä¿é™©èµ·è§ï¼Œå½“æˆ‘ä»¬åœ¨å¯¹æ–‡ä»¶ã€socketè¿›è¡Œæ“ä½œæ—¶ï¼Œè¦æƒ³å®‰å…¨åœ°å…³é—­å’Œé”€æ¯è¿™äº›å¯¹è±¡ï¼Œæœ€å¥½æ˜¯åœ¨tryå¼‚å¸¸å—åçš„finallyä¸­è¿›è¡Œå…³é—­å’Œé‡Šæ”¾æ“ä½œï¼</p>
<h4 id="3-ç±»çš„è¡¨ç¤º"><a href="#3-ç±»çš„è¡¨ç¤º" class="headerlink" title="3. ç±»çš„è¡¨ç¤º"></a>3. ç±»çš„è¡¨ç¤º</h4><p><strong>str</strong>/<strong>repr</strong><br>è¿™ä¸¤ä¸ªé­”æ³•æ–¹æ³•ä¸€èˆ¬ä¼šæ”¾åˆ°ä¸€èµ·è¿›è¡Œè®²è§£ï¼Œå®ƒä»¬çš„ä¸»è¦å·®åˆ«ä¸ºï¼š</p>
<p><strong>str</strong>å¼ºè°ƒå¯è¯»æ€§ï¼Œè€Œ<strong>repr</strong>å¼ºè°ƒå‡†ç¡®æ€§/æ ‡å‡†æ€§<br><strong>str</strong>çš„ç›®æ ‡äººç¾¤æ˜¯ç”¨æˆ·ï¼Œè€Œ<strong>repr</strong>çš„ç›®æ ‡äººç¾¤æ˜¯æœºå™¨ï¼Œå®ƒçš„ç»“æœæ˜¯å¯ä»¥è¢«æ‰§è¡Œçš„<br>%sè°ƒç”¨<strong>str</strong>æ–¹æ³•ï¼Œè€Œ%rè°ƒç”¨<strong>repr</strong>æ–¹æ³•<br>æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼Œäº†è§£å†…ç½®ç±»å®ç°è¿™2ä¸ªæ–¹æ³•çš„æ•ˆæœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; &#39;hello&#39;</span><br><span class="line">&gt;&gt;&gt; str(a)</span><br><span class="line">&#39;hello&#39;</span><br><span class="line">&gt;&gt;&gt; &#39;%s&#39; % a   # è°ƒç”¨__str__</span><br><span class="line">&#39;hello&#39;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; repr(a)     # å¯¹è±¡açš„æ ‡å‡†è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯aæ˜¯å¦‚ä½•åˆ›å»ºçš„</span><br><span class="line">&quot;&#39;hello&#39;&quot;</span><br><span class="line">&gt;&gt;&gt; &#39;%r&#39; % a    # è°ƒç”¨__repr__ </span><br><span class="line">&quot;&#39;hello&#39;&quot;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; import datetime</span><br><span class="line">&gt;&gt;&gt; b &#x3D; datetime.datetime.now()</span><br><span class="line">&gt;&gt;&gt; str(b)</span><br><span class="line">&#39;2018-05-03 19:08:45.921879&#39;</span><br><span class="line">&gt;&gt;&gt; print(b)     # ç­‰åŒäºprint str(b)</span><br><span class="line">2018-05-03 19:08:45.921879</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; repr(b)     # å±•ç¤ºå¯¹è±¡bçš„æ ‡å‡†åˆ›å»ºæ–¹å¼(å¦‚ä½•åˆ›å»ºçš„ </span><br><span class="line">&#39;datetime.datetime(2018, 5, 3, 19, 8, 45, 921879)&#39;</span><br><span class="line">&gt;&gt;&gt; b</span><br><span class="line">datetime.datetime(2018, 5, 3, 19, 8, 45, 921879)</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt; c &#x3D; eval(repr(b))</span><br><span class="line">&gt;&gt;&gt; c</span><br><span class="line">datetime.datetime(2018, 5, 3, 19, 8, 45, 921879)</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºè¿™ä¸¤ä¸ªæ–¹æ³•çš„ä¸»è¦åŒºåˆ«ï¼Œåœ¨å®é™…ä¸­æˆ‘ä»¬å®šä¹‰ç±»æ—¶ï¼Œä¸€èˆ¬è¿™æ ·å®šä¹‰å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __init__(self, name, age):</span><br><span class="line">        self.name &#x3D; name</span><br><span class="line">        self.age &#x3D; age</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        # æ ¼å¼åŒ–ï¼Œå‹å¥½å¯¹ç”¨æˆ·å±•ç¤º</span><br><span class="line">        return &#39;name: %s, age: %s&#39; % (self.name, self.age)</span><br><span class="line"></span><br><span class="line">    def __repr__(self):</span><br><span class="line">        # æ ‡å‡†åŒ–å±•ç¤º</span><br><span class="line">        return &quot;Person(&#39;%s&#39;, %s)&quot; % (self.name, self.age)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person &#x3D; Person(&#39;zhangsan&#39;, 20)</span><br><span class="line">print(str(person))      # name: zhangsan, age: 20</span><br><span class="line">print(&#39;%s&#39; % person)    # name: zhangsan, age: 20</span><br><span class="line">print(repr(person))     # Person(&#39;zhangsan&#39;, 20)</span><br><span class="line">print(&#39;%r&#39; % person)    # Person(&#39;zhangsan&#39;, 20)</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">name: zhangsan, age: 20</span><br><span class="line">name: zhangsan, age: 20</span><br><span class="line">Person(&#39;zhangsan&#39;, 20)</span><br><span class="line">Person(&#39;zhangsan&#39;, 20)</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåªå®šä¹‰äº†<strong>str</strong>æˆ–<strong>repr</strong>å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¼šæ˜¯ä»€ä¹ˆç»“æœï¼Ÿ</p>
<p>å¦‚æœåªå®šä¹‰äº†<em>str__ï¼Œé‚£ä¹ˆrepr(person)è¾“å‡º&lt;<em>_main</em></em>.Person object at 0x10783b400&gt;<br>å¦‚æœåªå®šä¹‰äº†<strong>repr</strong>ï¼Œé‚£ä¹ˆstr(person)ä¸repr(person)ç»“æœæ˜¯ç›¸åŒçš„<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>repr</strong>åœ¨è¡¨ç¤ºç±»æ—¶ï¼Œæ˜¯ä¸€çº§çš„ï¼Œå¦‚æœåªå®šä¹‰å®ƒï¼Œé‚£ä¹ˆ<strong>str</strong> = <strong>repr</strong>ã€‚<br>è€Œ<strong>str</strong>å±•ç¤ºç±»æ—¶æ˜¯æ¬¡çº§çš„ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰ç±»çš„å±•ç¤ºæ ¼å¼ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰<strong>repr</strong>ï¼Œé‚£ä¹ˆrepr(person)å°†ä¼šå±•ç¤ºç¼ºçœçš„å®šä¹‰ã€‚</p>
<h4 id="4-å¯¹è±¡åˆ¤æ–­"><a href="#4-å¯¹è±¡åˆ¤æ–­" class="headerlink" title="4. å¯¹è±¡åˆ¤æ–­"></a>4. å¯¹è±¡åˆ¤æ–­</h4><p><strong>hash</strong>/<strong>eq</strong><br><strong>hash</strong>æ–¹æ³•è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œç”¨æ¥è¡¨ç¤ºè¯¥å¯¹è±¡çš„å”¯ä¸€æ ‡è¯†ï¼Œé…åˆ<strong>eq</strong>æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰(==)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __init__(self, uid):</span><br><span class="line">        self.uid &#x3D; uid</span><br><span class="line"></span><br><span class="line">    def __repr__(self):</span><br><span class="line">        return &#39;Person(%s)&#39; % self.uid</span><br><span class="line"></span><br><span class="line">    def __hash__(self):</span><br><span class="line">        return self.uid</span><br><span class="line"></span><br><span class="line">    def __eq__(self, other):</span><br><span class="line">        return self.uid &#x3D;&#x3D; other.uid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 &#x3D; Person(1)</span><br><span class="line">p2 &#x3D; Person(1)</span><br><span class="line">print(p1 &#x3D;&#x3D; p2)</span><br><span class="line">p3 &#x3D; Person(2)</span><br><span class="line">print(set([p1, p2, p3]))  # æ ¹æ®å”¯ä¸€æ ‡è¯†å»é‡è¾“å‡º set([Person(1), Person(2)])</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">True</span><br><span class="line">&#123;Person(1), Person(2)&#125;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œåªè¦æˆ‘ä»¬é‡å†™<strong>hash</strong>å’Œ<strong>eq</strong>æ–¹æ³•å°±å¯ä»¥å®Œæˆæ­¤åŠŸèƒ½ã€‚æ­¤å¤–ä½¿ç”¨setå­˜æ”¾è¿™äº›å¯¹è±¡æ—¶ï¼Œä¼šæ ¹æ®è¿™ä¸¤ä¸ªæ–¹æ³•è¿›è¡Œå»é‡æ“ä½œã€‚</p>
<h4 id="5-å¯¹è±¡å¸ƒå°”åˆ¤æ–­"><a href="#5-å¯¹è±¡å¸ƒå°”åˆ¤æ–­" class="headerlink" title="5. å¯¹è±¡å¸ƒå°”åˆ¤æ–­"></a>5. å¯¹è±¡å¸ƒå°”åˆ¤æ–­</h4><p><strong>bool</strong><br>å½“è°ƒç”¨bool(obj)æ—¶ï¼Œä¼šè°ƒç”¨<strong>bool</strong>æ–¹æ³•ï¼Œè¿”å›True/Falseã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Person(object):</span><br><span class="line">    def __init__(self, uid):</span><br><span class="line">        self.uid &#x3D; uid</span><br><span class="line"></span><br><span class="line">    def __bool__(self):</span><br><span class="line">        return self.uid &gt; 10</span><br><span class="line"></span><br><span class="line">p1 &#x3D; Person(1)</span><br><span class="line">p2 &#x3D; Person(15)</span><br><span class="line">print(bool(p1))  # False</span><br><span class="line">print(bool(p2))  # True</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">False</span><br><span class="line">True</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p>âš ï¸: åœ¨Python3ä¸­ï¼Œ<strong>nonzero</strong>è¢«é‡å‘½å<strong>bool</strong></p>
<h4 id="6-è®¿é—®æ§åˆ¶"><a href="#6-è®¿é—®æ§åˆ¶" class="headerlink" title="6. è®¿é—®æ§åˆ¶"></a>6. è®¿é—®æ§åˆ¶</h4><p>è®¿é—®æ§åˆ¶ç›¸å…³çš„é­”æ³•æ–¹æ³•ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªï¼š</p>
<p><strong>setattr</strong>ï¼šé€šè¿‡.è®¾ç½®å±æ€§æˆ–setattr(key, value)<br><strong>getattr</strong>ï¼šè®¿é—®ä¸å­˜åœ¨çš„å±æ€§<br><strong>delattr</strong>ï¼šåˆ é™¤æŸä¸ªå±æ€§<br><strong>getattribute</strong>ï¼šè®¿é—®ä»»æ„å±æ€§æˆ–æ–¹æ³•<br>æ¥çœ‹ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">class Person(object):</span><br><span class="line">    def __setattr__(self, key, value):</span><br><span class="line">        &quot;&quot;&quot;å±æ€§èµ‹å€¼&quot;&quot;&quot;</span><br><span class="line">        if key not in (&#39;name&#39;, &#39;age&#39;):</span><br><span class="line">            return</span><br><span class="line">        if key &#x3D;&#x3D; &#39;age&#39; and value &lt; 0:</span><br><span class="line">            raise ValueError()</span><br><span class="line">        super(Person, self).__setattr__(key, value)</span><br><span class="line"></span><br><span class="line">    def __getattr__(self, key):</span><br><span class="line">        &quot;&quot;&quot;è®¿é—®æŸä¸ªä¸å­˜åœ¨çš„å±æ€§&quot;&quot;&quot;</span><br><span class="line">        return &#39;unknown&#39;</span><br><span class="line"></span><br><span class="line">    def __delattr__(self, key):</span><br><span class="line">        &quot;&quot;&quot;åˆ é™¤æŸä¸ªå±æ€§&quot;&quot;&quot;</span><br><span class="line">        if key &#x3D;&#x3D; &#39;name&#39;:</span><br><span class="line">            raise AttributeError()</span><br><span class="line">        super(Person, self).__delattr__(key)</span><br><span class="line"></span><br><span class="line">    def __getattribute__(self, key):</span><br><span class="line">        &quot;&quot;&quot;æ‰€æœ‰å±æ€§&#x2F;æ–¹æ³•è°ƒç”¨éƒ½ç»è¿‡è¿™é‡Œ&quot;&quot;&quot;</span><br><span class="line">        if key &#x3D;&#x3D; &#39;money&#39;:</span><br><span class="line">            return 100</span><br><span class="line">        if key &#x3D;&#x3D; &#39;hello&#39;:</span><br><span class="line">            return self.say</span><br><span class="line">        return super(Person, self).__getattribute__(key)</span><br><span class="line"></span><br><span class="line">    def say(self):</span><br><span class="line">        return &#39;hello&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 &#x3D; Person()</span><br><span class="line">p1.name &#x3D; &#39;zhangsan&#39;  # è°ƒç”¨__setattr__</span><br><span class="line">p1.age &#x3D; 20  # è°ƒç”¨__setattr__</span><br><span class="line">print(p1.name)  # zhangsan</span><br><span class="line">print(p1.age)  # 20</span><br><span class="line">setattr(p1, &#39;name&#39;, &#39;lisi&#39;)  # è°ƒç”¨__setattr__</span><br><span class="line">setattr(p1, &#39;age&#39;, 30)  # è°ƒç”¨__setattr__</span><br><span class="line">print(p1.name)  # lisi</span><br><span class="line">print(p1.age)  # 30</span><br><span class="line"></span><br><span class="line">p1.gender &#x3D; &#39;male&#39;  # __setattr__ä¸­å¿½ç•¥å¯¹genderèµ‹å€¼</span><br><span class="line">print(p1.gender)  # genderä¸å­˜åœ¨,è°ƒç”¨__getattr__è¿”å›ï¼šunknown</span><br><span class="line">print(p1.money)  # moneyä¸å­˜åœ¨,åœ¨__getattribute__ä¸­è¿”å›100</span><br><span class="line">print(p1.say())  # hello</span><br><span class="line">print(p1.hello())  # hello,è°ƒç”¨__getattribute__ï¼Œé—´æ¥è°ƒç”¨sayæ–¹æ³•</span><br><span class="line"></span><br><span class="line">del p1.name  # __delattr__ä¸­å¼•å‘AttributeError</span><br><span class="line">p2 &#x3D; Person()</span><br><span class="line">p2.age &#x3D; -1  # __setattr__ä¸­å¼•å‘ValueError</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>setattr</strong><br>é€šè¿‡æ­¤æ–¹æ³•ï¼Œå¯¹è±¡å¯åœ¨åœ¨å¯¹å±æ€§è¿›è¡Œèµ‹å€¼æ—¶è¿›è¡Œæ§åˆ¶ï¼Œæ‰€æœ‰çš„å±æ€§èµ‹å€¼éƒ½ä¼šç»è¿‡å®ƒã€‚<br>ä¸€èˆ¬å¸¸ç”¨äºå¯¹æŸäº›å±æ€§èµ‹å€¼çš„æ£€æŸ¥æ ¡éªŒé€»è¾‘ï¼Œä¾‹å¦‚ageä¸èƒ½å°äº0ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯éæ³•æ•°æ®ç­‰ç­‰ã€‚</li>
<li><strong>getattr</strong><br>å¾ˆå¤šåŒå­¦ä»¥ä¸ºæ­¤æ–¹æ³•æ˜¯å’Œ<strong>setattr</strong>å®Œå…¨å¯¹ç«‹çš„ï¼Œå…¶å®ä¸ç„¶ï¼<br>è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨è®¿é—®æŸä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶æ‰ä¼šè¢«è°ƒç”¨ï¼Œçœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œç”±äºgenderå±æ€§åœ¨èµ‹å€¼æ—¶ï¼Œå¿½ç•¥äº†æ­¤å­—æ®µçš„èµ‹å€¼æ“ä½œï¼Œæ‰€ä»¥æ­¤å±æ€§æ˜¯æ²¡æœ‰è¢«æˆåŠŸèµ‹å€¼ç»™å¯¹è±¡çš„ã€‚å½“è®¿é—®è¿™ä¸ªå±æ€§æ—¶ï¼Œ<strong>getattr</strong>è¢«è°ƒç”¨ï¼Œè¿”å›unknownã€‚</li>
<li><strong>del</strong><br>åˆ é™¤å¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œæ­¤æ–¹æ³•è¢«è°ƒç”¨ã€‚ä¸€èˆ¬å¸¸ç”¨äºæŸä¸ªå±æ€§å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œåç»­çš„é€»è¾‘æ“ä½œï¼Œä¼šé‡å†™æ­¤æ–¹æ³•ï¼Œå¯¹åˆ é™¤å±æ€§é€»è¾‘è¿›è¡Œæ£€æŸ¥å’Œæ ¡éªŒã€‚</li>
<li><strong>getattribute</strong><br>è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬å¾ˆå°‘ç”¨åˆ°ï¼Œå®ƒä¸<strong>getattr</strong>å¾ˆå®¹æ˜“æ··æ·†ã€‚å®ƒä¸å‰è€…çš„åŒºåˆ«åœ¨äºï¼š<br><strong>getattr</strong>è®¿é—®æŸä¸ªä¸å­˜åœ¨çš„å±æ€§è¢«è°ƒç”¨ï¼Œ<strong>getattribute</strong>è®¿é—®ä»»æ„å±æ€§è¢«è°ƒç”¨<br><strong>getattr</strong>åªé’ˆå¯¹å±æ€§è®¿é—®ï¼Œ<strong>getattribute</strong>ä¸ä»…é’ˆå¯¹æ‰€æœ‰å±æ€§è®¿é—®ï¼Œè¿˜åŒ…æ‹¬æ–¹æ³•è°ƒç”¨<br>è¶Šæ˜¯å¼ºå¤§çš„é­”æ³•æ–¹æ³•ï¼Œè´£ä»»è¶Šå¤§ï¼Œå¦‚æœä½ ä¸èƒ½æ­£ç¡®ä½¿ç”¨å®ƒï¼Œæœ€å¥½è¿˜æ˜¯ä¸ç”¨ä¸ºå¥½ï¼Œå¦åˆ™åœ¨å‡ºç°é—®é¢˜æ—¶å¾ˆéš¾æ’æŸ¥!</li>
</ol>
<p><a href="http://kaito-kidd.com/2017/02/22/python-magic-methods/" target="_blank" rel="noopener">å‚è€ƒåŸæ–‡</a><br><a href="http://kaito-kidd.com/2017/02/23/python-magic-methods-2/" target="_blank" rel="noopener">é­”æœ¯æ–¹æ³•äºŒ</a><br><a href="http://pycoders-weekly-chinese.readthedocs.io/en/latest/issue6/a-guide-to-pythons-magic-methods.html" target="_blank" rel="noopener">å»¶ä¼¸</a></p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonçš„loggingæ¨¡å—å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡º</title>
    <url>/2020/04/20/python%E7%9A%84logging%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0json%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA/</url>
    <content><![CDATA[<h2 id="pythonçš„loggingæ¨¡å—å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡º"><a href="#pythonçš„loggingæ¨¡å—å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡º" class="headerlink" title="pythonçš„loggingæ¨¡å—å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡º"></a>pythonçš„loggingæ¨¡å—å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡º</h2><blockquote>
<p>æƒ³è¦è®©å¼€å‘è¿‡ç¨‹æˆ–è€…æ˜¯ä¸Šçº¿åçš„bugæ— å¤„å¯è—ï¼Œæœ€å¥½çš„æ–¹å¼ä¾¿æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸æ–­æ”¶é›†é‡è¦çš„æ—¥å¿—ï¼Œä»¥ä¾›åˆ†æä½¿ç”¨ã€‚Pythonä¸­å†…ç½®çš„logæ”¶é›†æ¨¡å—æ˜¯loggingï¼Œè¯¥æ¨¡å—ä½¿ç”¨èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯ç¾ä¸­ä¸è¶³çš„åœ°æ–¹å°±æ˜¯æ—¥å¿—çš„æ ¼å¼è½¬æˆjsonæ¯”è¾ƒéº»çƒ¦ã€‚äºæ˜¯æˆ‘ç»“åˆloggingå’Œå¦ä¸€ä¸ªæ¨¡å—python-json-logger(pip install python-json-logger), å®ç°jsonæ ¼å¼çš„æ—¥å¿—è¾“å‡ºã€‚</p>
</blockquote>
<p>ä»¥ä¸‹ä»£ç å¯ä»¥åšæˆæ¨¡å—ï¼Œç›´æ¥å¯¼å…¥ä½¿ç”¨</p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;user&#x2F;bin&#x2F;env python</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import logging, logging.config, os</span><br><span class="line">import structlog</span><br><span class="line">import traceback</span><br><span class="line">from structlog import configure, processors, stdlib, threadlocal</span><br><span class="line">from pythonjsonlogger import jsonlogger</span><br><span class="line">BASE_DIR &#x3D; BASE_DIR &#x3D; os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">DEBUG &#x3D; True  # æ ‡è®°æ˜¯å¦åœ¨å¼€å‘ç¯å¢ƒ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»™è¿‡æ»¤å™¨ä½¿ç”¨çš„åˆ¤æ–­</span><br><span class="line">class RequireDebugTrue(logging.Filter):</span><br><span class="line">    # å®ç°filteræ–¹æ³•</span><br><span class="line">    def filter(self, record):</span><br><span class="line">        return DEBUG</span><br><span class="line"></span><br><span class="line">def get_logger():</span><br><span class="line">    LOGGING &#x3D; &#123;</span><br><span class="line">    # åŸºæœ¬è®¾ç½®</span><br><span class="line">        &#39;version&#39;: 1,  # æ—¥å¿—çº§åˆ«</span><br><span class="line">        &#39;disable_existing_loggers&#39;: False,  # æ˜¯å¦ç¦ç”¨ç°æœ‰çš„è®°å½•å™¨</span><br><span class="line"></span><br><span class="line">    # æ—¥å¿—æ ¼å¼é›†åˆ</span><br><span class="line">        &#39;formatters&#39;: &#123;</span><br><span class="line">        # æ ‡å‡†è¾“å‡ºæ ¼å¼</span><br><span class="line">            &#39;json&#39;: &#123;</span><br><span class="line">            # [å…·ä½“æ—¶é—´][çº¿ç¨‹å:çº¿ç¨‹ID][æ—¥å¿—åå­—:æ—¥å¿—çº§åˆ«åç§°(æ—¥å¿—çº§åˆ«ID)] [è¾“å‡ºçš„æ¨¡å—:è¾“å‡ºçš„å‡½æ•°]:æ—¥å¿—å†…å®¹</span><br><span class="line">                &#39;format&#39;: &#39;[%(asctime)s][%(threadName)s:%(thread)d][%(name)s:%(levelname)s(%(lineno)d)]\n[%(module)s:%(funcName)s]:%(message)s&#39;,</span><br><span class="line">                &#39;class&#39;: &#39;pythonjsonlogger.jsonlogger.JsonFormatter&#39;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    # è¿‡æ»¤å™¨</span><br><span class="line">        &#39;filters&#39;: &#123;</span><br><span class="line">            &#39;require_debug_true&#39;: &#123;</span><br><span class="line">                &#39;()&#39;: RequireDebugTrue,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    # å¤„ç†å™¨é›†åˆ</span><br><span class="line">        &#39;handlers&#39;: &#123;</span><br><span class="line">        # è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">        # è¾“å‡ºåˆ°æ–‡ä»¶</span><br><span class="line">            &#39;TimeChecklog&#39;: &#123;</span><br><span class="line">                &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">                &#39;class&#39;: &#39;logging.handlers.RotatingFileHandler&#39;,</span><br><span class="line">                &#39;formatter&#39;: &#39;json&#39;,</span><br><span class="line">                &#39;filename&#39;: os.path.join(&quot;.&#x2F;&quot;, &#39;TimeoutCheck.log&#39;),  # è¾“å‡ºä½ç½®</span><br><span class="line">                &#39;maxBytes&#39;: 1024 * 1024 * 5,  # æ–‡ä»¶å¤§å° 5M</span><br><span class="line">                &#39;backupCount&#39;: 5,  # å¤‡ä»½ä»½æ•°</span><br><span class="line">                &#39;encoding&#39;: &#39;utf8&#39;,  # æ–‡ä»¶ç¼–ç </span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    # æ—¥å¿—ç®¡ç†å™¨é›†åˆ</span><br><span class="line">        &#39;loggers&#39;: &#123;</span><br><span class="line">        # ç®¡ç†å™¨</span><br><span class="line">            &#39;proxyCheck&#39;: &#123;</span><br><span class="line">                &#39;handlers&#39;: [&#39;TimeChecklog&#39;],</span><br><span class="line">                &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">                &#39;propagate&#39;: True,  # æ˜¯å¦ä¼ é€’ç»™çˆ¶è®°å½•å™¨</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    logging.config.dictConfig(LOGGING)</span><br><span class="line">    logger &#x3D; logging.getLogger(&quot;proxyCheck&quot;)</span><br><span class="line">    return logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æµ‹è¯•ç”¨ä¾‹ï¼Œä½ å¯ä»¥æŠŠget_logger()å°è£…æˆä¸€ä¸ªæ¨¡å—ï¼Œfrom xxx import get_logger()</span><br><span class="line">logger1 &#x3D; get_logger()</span><br><span class="line">def test():</span><br><span class="line">    try:</span><br><span class="line">        a &#x3D; 1 &#x2F; 0</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logger1.error(&quot;This is a error info&quot;,exc_info&#x3D;True)  # å†™å…¥é”™è¯¯æ—¥å¿—</span><br><span class="line">        #å¦‚æœéœ€è¦æ·»åŠ é¢å¤–çš„ä¿¡æ¯ï¼Œä½¿ç”¨extraå…³é”®å­—å³å¯</span><br><span class="line">        logger1.error(str(traceback.format_exc()), extra&#x3D;&#123;&quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;:&quot;value2&quot;&#125;)</span><br><span class="line">        # å…¶ä»–é”™è¯¯å¤„ç†ä»£ç </span><br><span class="line">        pass</span><br><span class="line">test()</span><br></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•ç»“æœ"><a href="#æµ‹è¯•ç»“æœ" class="headerlink" title="æµ‹è¯•ç»“æœ"></a>æµ‹è¯•ç»“æœ</h3><p>æµ‹è¯•çš„ç»“æœï¼Œå¯ä»¥åœ¨./TimeoutCheck.logæ–‡ä»¶ä¸­çœ‹åˆ°è¾“å‡ºçš„æ—¥å¿—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat TimeoutCheck.log</span><br><span class="line">&#123;&quot;asctime&quot;: &quot;2019-01-31 11:29:16,818&quot;, &quot;threadName&quot;: &quot;MainThread&quot;, &quot;thread&quot;: 140735830963008, &quot;name&quot;: &quot;proxyCheck&quot;, &quot;levelname&quot;: &quot;ERROR&quot;, &quot;%(lineno&quot;: null, &quot;module&quot;: &quot;log&quot;, &quot;funcName&quot;: &quot;test&quot;, &quot;message&quot;: &quot;This is a error info&quot;, &quot;exc_info&quot;: &quot;Traceback (most recent call last):\n  File \&quot;log.py\&quot;, line 74, in test\n    a &#x3D; 1 &#x2F; 0\nZeroDivisionError: division by zero&quot;&#125;</span><br><span class="line">&#123;&quot;asctime&quot;: &quot;2019-01-31 11:29:16,819&quot;, &quot;threadName&quot;: &quot;MainThread&quot;, &quot;thread&quot;: 140735830963008, &quot;name&quot;: &quot;proxyCheck&quot;, &quot;levelname&quot;: &quot;ERROR&quot;, &quot;%(lineno&quot;: null, &quot;module&quot;: &quot;log&quot;, &quot;funcName&quot;: &quot;test&quot;, &quot;message&quot;: &quot;Traceback (most recent call last):\n  File \&quot;log.py\&quot;, line 74, in test\n    a &#x3D; 1 &#x2F; 0\nZeroDivisionError: division by zero\n&quot;, &quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;: &quot;value2&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç‰ˆæœ¬äºŒ"><a href="#ç‰ˆæœ¬äºŒ" class="headerlink" title="ç‰ˆæœ¬äºŒ"></a>ç‰ˆæœ¬äºŒ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import json</span><br><span class="line">import datetime</span><br><span class="line">import logging</span><br><span class="line">import logging.config</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">class LogstashFormatter(logging.Formatter):</span><br><span class="line">    def __init__(self, task_name&#x3D;None):</span><br><span class="line">        self.task_name &#x3D; task_name</span><br><span class="line"></span><br><span class="line">        super(LogstashFormatter, self).__init__()</span><br><span class="line"></span><br><span class="line">    def format(self, record):</span><br><span class="line">        data &#x3D; &#123;&#39;@message&#39;: record.msg,</span><br><span class="line">                &#39;@timestamp&#39;: datetime.datetime.utcnow().strftime(&#39;%Y-%m-%dT%H:%M:%S.%fZ&#39;),</span><br><span class="line">                &#39;@type&#39;: &#39;Add log extra test&#39;&#125;</span><br><span class="line"></span><br><span class="line">        if self.task_name:</span><br><span class="line">            data[&#39;@task_name&#39;] &#x3D; self.task_name</span><br><span class="line"></span><br><span class="line">        for key, value in record.args.items():</span><br><span class="line">            data[key] &#x3D; value</span><br><span class="line"></span><br><span class="line">        return json.dumps(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logger &#x3D; logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line">logging.config.dictConfig(&#123;</span><br><span class="line">    &#39;version&#39;: 1,</span><br><span class="line">    &#39;disable_existing_loggers&#39;: False,  # this fixes the problem</span><br><span class="line">    &#39;formatters&#39;: &#123;</span><br><span class="line">        &#39;json&#39;: &#123;</span><br><span class="line">            &#39;()&#39;: LogstashFormatter,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#39;handlers&#39;: &#123;</span><br><span class="line">        &#39;console&#39;: &#123;</span><br><span class="line">            &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">            &#39;class&#39;: &#39;logging.StreamHandler&#39;,</span><br><span class="line">            &#39;formatter&#39;: &#39;json&#39;,</span><br><span class="line">            &#39;stream&#39;: sys.stdout</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#39;loggers&#39;: &#123;</span><br><span class="line">        &#39;&#39;: &#123;</span><br><span class="line">            &#39;handlers&#39;: [&#39;console&#39;],</span><br><span class="line">            &#39;level&#39;: &#39;INFO&#39;,</span><br><span class="line">            &#39;propagate&#39;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">logger.info(&#39;It works!&#39;, &#123;&#39;aaa&#39;:&#39;bbbb&#39;,&#39;cccc&#39;:&#39;dddd&#39;&#125;)</span><br><span class="line"></span><br><span class="line"># output:</span><br><span class="line">&#123;&quot;@message&quot;: &quot;It works!&quot;, &quot;@timestamp&quot;: &quot;2019-01-31T02:52:24.786570Z&quot;, &quot;@type&quot;: &quot;Add log extra test&quot;, &quot;aaa&quot;: &quot;bbbb&quot;, &quot;cccc&quot;: &quot;dddd&quot;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç‰ˆæœ¬ä¸‰"><a href="#ç‰ˆæœ¬ä¸‰" class="headerlink" title="ç‰ˆæœ¬ä¸‰"></a>ç‰ˆæœ¬ä¸‰</h3><blockquote>
<p>æ­¤ç‰ˆæœ¬ä¸ºä¼˜åŒ–ç‰ˆæœ¬,ç»§æ‰¿pythonjsonlogger.jsonloggeråº“ä¸­çš„JsonFormatterç±»,é‡å†™formatæ–¹æ³•</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: shuke</span><br><span class="line">@file: jsonlog.py </span><br><span class="line">@time: 2019&#x2F;01&#x2F;20 15:36</span><br><span class="line">@contact: shu_ke163@163.com</span><br><span class="line">@software:  shuke-logging</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import time</span><br><span class="line">import json</span><br><span class="line">import socket</span><br><span class="line">import datetime</span><br><span class="line">import logging</span><br><span class="line">import traceback</span><br><span class="line">import logging.config</span><br><span class="line">from pythonjsonlogger.jsonlogger import JsonFormatter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class JsonFormatter(JsonFormatter):</span><br><span class="line">    def __init__(self, *args, **kwargs):</span><br><span class="line">        self.host &#x3D; socket.getfqdn()</span><br><span class="line">        self.message_type &#x3D; &quot;json&quot;</span><br><span class="line">        self.version &#x3D; &quot;v1.0&quot;</span><br><span class="line">        super(JsonFormatter, self).__init__(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">    def get_extra_fields(self, record):</span><br><span class="line">        # The list contains all the attributes listed in</span><br><span class="line">        # http:&#x2F;&#x2F;docs.python.org&#x2F;library&#x2F;logging.html#logrecord-attributes</span><br><span class="line">        builtin_attr_list &#x3D; [</span><br><span class="line">            &#39;args&#39;, &#39;asctime&#39;, &#39;created&#39;, &#39;exc_info&#39;, &#39;exc_text&#39;, &#39;filename&#39;, &#39;id&#39;, &#39;levelname&#39;, &#39;levelno&#39;, &#39;module&#39;,</span><br><span class="line">            &#39;msecs&#39;, &#39;msecs&#39;, &#39;message&#39;, &#39;msg&#39;, &#39;name&#39;, &#39;pathname&#39;, &#39;relativeCreated&#39;, &#39;extra&#39;]</span><br><span class="line"></span><br><span class="line">        fields &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        for key, value in record.__dict__.items():</span><br><span class="line">            if key not in builtin_attr_list:</span><br><span class="line">                fields[key] &#x3D; repr(value)</span><br><span class="line"></span><br><span class="line">        fields[&quot;project&quot;] &#x3D; &quot;WEHOST&quot;</span><br><span class="line">        fields[&quot;team&quot;] &#x3D; &quot;OPS&quot;</span><br><span class="line">        fields[&quot;department&quot;] &#x3D; &quot;IT&quot;</span><br><span class="line">        fields[&quot;log_debug&quot;] &#x3D; True</span><br><span class="line"></span><br><span class="line">        return fields</span><br><span class="line"></span><br><span class="line">    def format_timestamp(self, time):</span><br><span class="line">        return datetime.datetime.now().strftime(&#39;%Y-%m-%d %H:%M:%S %f&#39;)</span><br><span class="line"></span><br><span class="line">    def format(self, record):</span><br><span class="line">        message &#x3D; &#123;</span><br><span class="line">            &#39;@timestamp&#39;: self.format_timestamp(record.created),</span><br><span class="line">            &#39;@version&#39;: &#39;v1.0&#39;,</span><br><span class="line">            &#39;name&#39;: record.name,</span><br><span class="line">            &#39;host&#39;: self.host,</span><br><span class="line">            &#39;pathname&#39;: record.pathname,</span><br><span class="line">            &#39;levelno&#39;: record.levelno,</span><br><span class="line">            &#39;filename&#39;: record.filename,</span><br><span class="line">            &#39;module&#39;: record.module,</span><br><span class="line">            &#39;exc_info&#39;: &#39;&#39;.join(traceback.format_exception(*record.exc_info)),</span><br><span class="line">            &#39;exc_text&#39;: record.exc_text,</span><br><span class="line">            &#39;stack_info&#39;: record.stack_info,</span><br><span class="line">            &#39;created&#39;: time.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;, time.localtime(record.created)),</span><br><span class="line">            &#39;msecs&#39;: record.msecs,</span><br><span class="line">            &#39;relativeCreated&#39;: record.relativeCreated,</span><br><span class="line">            &#39;type&#39;: self.message_type,</span><br><span class="line">            &#39;level&#39;: record.levelname,</span><br><span class="line">            &#39;message&#39;: record.getMessage(),</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        # Add extra fields</span><br><span class="line">        message.update(self.get_extra_fields(record))</span><br><span class="line"></span><br><span class="line">        return json.dumps(message, indent&#x3D;4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_logger():</span><br><span class="line">    LOGGING &#x3D; &#123;</span><br><span class="line">        # åŸºæœ¬è®¾ç½®</span><br><span class="line">        &#39;version&#39;: 1,  # æ—¥å¿—çº§åˆ«</span><br><span class="line">        &#39;disable_existing_loggers&#39;: False,  # æ˜¯å¦ç¦ç”¨ç°æœ‰çš„è®°å½•å™¨</span><br><span class="line"></span><br><span class="line">        # æ—¥å¿—æ ¼å¼é›†åˆ</span><br><span class="line">        &#39;formatters&#39;: &#123;</span><br><span class="line">            # æ ‡å‡†è¾“å‡ºæ ¼å¼</span><br><span class="line">            &#39;json&#39;: &#123;</span><br><span class="line">                # [å…·ä½“æ—¶é—´][çº¿ç¨‹å:çº¿ç¨‹ID][æ—¥å¿—åå­—:æ—¥å¿—çº§åˆ«åç§°(æ—¥å¿—çº§åˆ«ID)] [è¾“å‡ºçš„æ¨¡å—:è¾“å‡ºçš„å‡½æ•°]:æ—¥å¿—å†…å®¹</span><br><span class="line">                # &#39;format&#39;: &#39;[%(asctime)s][%(threadName)s:%(thread)d][%(name)s:%(levelname)s(%(lineno)d)]\n[%(module)s:%(funcName)s]:%(message)s&#39;,</span><br><span class="line">                # &#39;format&#39;: &#39;[%(asctime)s][%(threadName)s:%(thread)d][%(created)s:%(process)d:%(processName)s][%(relativeCreated)s:%(msecs)s][%(pathname)s:%(filename)s][%(name)s:%(levelname)s:%(lineno)d)][%(module)s:%(funcName)s]:%(message)s&#39;,</span><br><span class="line">                # &#39;()&#39;: JsonFormatter.format,</span><br><span class="line">                # &#39;class&#39;: &#39;pythonjsonlogger.jsonlogger.JsonFormatter&#39;,</span><br><span class="line">                &#39;()&#39;: JsonFormatter,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        # å¤„ç†å™¨é›†åˆ</span><br><span class="line">        &#39;handlers&#39;: &#123;</span><br><span class="line">            # è¾“å‡ºåˆ°æ§åˆ¶å°</span><br><span class="line">            &#39;console&#39;: &#123;</span><br><span class="line">                &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">                &#39;class&#39;: &#39;logging.StreamHandler&#39;,</span><br><span class="line">                &#39;formatter&#39;: &#39;json&#39;,</span><br><span class="line">                &#39;stream&#39;: sys.stdout</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        # æ—¥å¿—ç®¡ç†å™¨é›†åˆ</span><br><span class="line">        &#39;loggers&#39;: &#123;</span><br><span class="line">            # ç®¡ç†å™¨</span><br><span class="line">            &#39;mylog&#39;: &#123;</span><br><span class="line">                &#39;handlers&#39;: [&#39;console&#39;],</span><br><span class="line">                &#39;level&#39;: &#39;DEBUG&#39;,</span><br><span class="line">                &#39;propagate&#39;: True,  # æ˜¯å¦ä¼ é€’ç»™çˆ¶è®°å½•å™¨</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    logging.config.dictConfig(LOGGING)</span><br><span class="line">    logger &#x3D; logging.getLogger(&quot;mylog&quot;)</span><br><span class="line">    return logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æµ‹è¯•ç”¨ä¾‹ï¼Œä½ å¯ä»¥æŠŠget_logger()å°è£…æˆä¸€ä¸ªæ¨¡å—ï¼Œfrom xxx import get_logger()</span><br><span class="line">logger &#x3D; get_logger()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    try:</span><br><span class="line">        a &#x3D; 1 &#x2F; 0</span><br><span class="line">    except Exception as e:</span><br><span class="line">        # å¦‚æœéœ€è¦æ·»åŠ é¢å¤–çš„ä¿¡æ¯ï¼Œä½¿ç”¨extraå…³é”®å­—å³å¯</span><br><span class="line">        logger.info(&quot;This is a info message&quot;, extra&#x3D;&#123;&quot;type&quot;: &quot;json&quot;, &quot;department&quot;: &quot;IT&quot;, &quot;bussiness&quot;: &quot;game&quot;&#125;,</span><br><span class="line">                    exc_info&#x3D;True)</span><br><span class="line">        logger.info(&quot;Hello World&quot;, extra&#x3D;&#123;&quot;key1&quot;: &quot;value1&quot;, &quot;key2&quot;: &quot;value2&quot;&#125;, exc_info&#x3D;True)</span><br><span class="line">        # å…¶ä»–é”™è¯¯å¤„ç†ä»£ç </span><br><span class="line">        pass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># output:</span><br><span class="line">&#123;</span><br><span class="line">    &quot;@timestamp&quot;: &quot;2019-01-31 18:53:39 581892&quot;,</span><br><span class="line">    &quot;@version&quot;: &quot;v1.0&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;mylog&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;MacBooKPro&quot;,</span><br><span class="line">    &quot;pathname&quot;: &quot;jsonlog.py&quot;,</span><br><span class="line">    &quot;levelno&quot;: 20,</span><br><span class="line">    &quot;filename&quot;: &quot;jsonlog.py&quot;,</span><br><span class="line">    &quot;module&quot;: &quot;jsonlog&quot;,</span><br><span class="line">    &quot;exc_info&quot;: &quot;Traceback (most recent call last):\n  File \&quot;jsonlog.py\&quot;, line 129, in test\n    a &#x3D; 1 &#x2F; 0\nZeroDivisionError: division by zero\n&quot;,</span><br><span class="line">    &quot;exc_text&quot;: null,</span><br><span class="line">    &quot;stack_info&quot;: &quot;None&quot;,</span><br><span class="line">    &quot;created&quot;: &quot;2019-01-31 18:53:39&quot;,</span><br><span class="line">    &quot;msecs&quot;: 581.8040370941162,</span><br><span class="line">    &quot;relativeCreated&quot;: 47.5161075592041,</span><br><span class="line">    &quot;type&quot;: &quot;&#39;json&#39;&quot;,</span><br><span class="line">    &quot;level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;This is a info message&quot;,</span><br><span class="line">    &quot;lineno&quot;: &quot;133&quot;,</span><br><span class="line">    &quot;funcName&quot;: &quot;&#39;test&#39;&quot;,</span><br><span class="line">    &quot;thread&quot;: &quot;140735830963008&quot;,</span><br><span class="line">    &quot;threadName&quot;: &quot;&#39;MainThread&#39;&quot;,</span><br><span class="line">    &quot;processName&quot;: &quot;&#39;MainProcess&#39;&quot;,</span><br><span class="line">    &quot;process&quot;: &quot;83309&quot;,</span><br><span class="line">    &quot;department&quot;: &quot;IT&quot;,</span><br><span class="line">    &quot;bussiness&quot;: &quot;&#39;game&#39;&quot;,</span><br><span class="line">    &quot;project&quot;: &quot;WEHOST&quot;,</span><br><span class="line">    &quot;team&quot;: &quot;OPS&quot;,</span><br><span class="line">    &quot;log_debug&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;@timestamp&quot;: &quot;2019-01-31 18:53:39 582770&quot;,</span><br><span class="line">    &quot;@version&quot;: &quot;v1.0&quot;,</span><br><span class="line">    &quot;name&quot;: &quot;mylog&quot;,</span><br><span class="line">    &quot;host&quot;: &quot;MacBooKPro&quot;,</span><br><span class="line">    &quot;pathname&quot;: &quot;jsonlog.py&quot;,</span><br><span class="line">    &quot;levelno&quot;: 20,</span><br><span class="line">    &quot;filename&quot;: &quot;jsonlog.py&quot;,</span><br><span class="line">    &quot;module&quot;: &quot;jsonlog&quot;,</span><br><span class="line">    &quot;exc_info&quot;: &quot;Traceback (most recent call last):\n  File \&quot;jsonlog.py\&quot;, line 129, in test\n    a &#x3D; 1 &#x2F; 0\nZeroDivisionError: division by zero\n&quot;,</span><br><span class="line">    &quot;exc_text&quot;: null,</span><br><span class="line">    &quot;stack_info&quot;: &quot;None&quot;,</span><br><span class="line">    &quot;created&quot;: &quot;2019-01-31 18:53:39&quot;,</span><br><span class="line">    &quot;msecs&quot;: 582.7357769012451,</span><br><span class="line">    &quot;relativeCreated&quot;: 48.44784736633301,</span><br><span class="line">    &quot;type&quot;: &quot;json&quot;,</span><br><span class="line">    &quot;level&quot;: &quot;INFO&quot;,</span><br><span class="line">    &quot;message&quot;: &quot;Hello World&quot;,</span><br><span class="line">    &quot;lineno&quot;: &quot;134&quot;,</span><br><span class="line">    &quot;funcName&quot;: &quot;&#39;test&#39;&quot;,</span><br><span class="line">    &quot;thread&quot;: &quot;140735830963008&quot;,</span><br><span class="line">    &quot;threadName&quot;: &quot;&#39;MainThread&#39;&quot;,</span><br><span class="line">    &quot;processName&quot;: &quot;&#39;MainProcess&#39;&quot;,</span><br><span class="line">    &quot;process&quot;: &quot;83309&quot;,</span><br><span class="line">    &quot;key1&quot;: &quot;&#39;value1&#39;&quot;,</span><br><span class="line">    &quot;key2&quot;: &quot;&#39;value2&#39;&quot;,</span><br><span class="line">    &quot;project&quot;: &quot;WEHOST&quot;,</span><br><span class="line">    &quot;team&quot;: &quot;OPS&quot;,</span><br><span class="line">    &quot;department&quot;: &quot;IT&quot;,</span><br><span class="line">    &quot;log_debug&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°æ—¥å¿—æ˜¯jsonæ ¼å¼ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½¿ç”¨grafnaå’Œkafka-&gt;logstash-&gt;esçš„æ–¹å¼è¿›è¡Œæ—¥å¿—æ”¶é›†å±•ç¤ºäº†.å¦‚æœéœ€è¦å°†æ—¥å¿—ç›´æ¥æ‰“åˆ°kafkaä¸­,éœ€è¦ä½¿ç”¨kafka-pythonåº“,åŒæ—¶å®šä¹‰handlersè¿›è¡Œå¤„ç†.</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonæ“ä½œzabbix API</title>
    <url>/2020/04/20/python%E6%93%8D%E4%BD%9Czabbix-API/</url>
    <content><![CDATA[<h2 id="pythonæ“ä½œzabbix-API"><a href="#pythonæ“ä½œzabbix-API" class="headerlink" title="pythonæ“ä½œzabbix API"></a>pythonæ“ä½œzabbix API</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import json</span><br><span class="line">import urllib2</span><br><span class="line">import sys</span><br><span class="line">class zabbixtools:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.url &#x3D; &quot;http:&#x2F;&#x2F;192.168.1.1&#x2F;zabbix&#x2F;api_jsonrpc.php&quot;</span><br><span class="line">        self.header &#x3D; &#123;&quot;Content-Type&quot;: &quot;application&#x2F;json&quot;&#125;</span><br><span class="line">        self.authID &#x3D; self.user_login()</span><br><span class="line">    def user_login(self):</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;: &quot;user.login&quot;,</span><br><span class="line">                    &quot;params&quot;: &#123;</span><br><span class="line">                        &quot;user&quot;: &quot;Admin&quot;,</span><br><span class="line">                        &quot;password&quot;: &quot;admin&quot;</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &quot;id&quot;: 0</span><br><span class="line">                    &#125;)</span><br><span class="line">        request &#x3D; urllib2.Request(self.url,data)</span><br><span class="line">        for key in self.header:</span><br><span class="line">            request.add_header(key,self.header[key])</span><br><span class="line">        try:</span><br><span class="line">            result &#x3D; urllib2.urlopen(request)</span><br><span class="line">        except URLError as e:</span><br><span class="line">            print &quot;Auth Failed, Please Check Your Name And Password:&quot;,e.code</span><br><span class="line">        else:</span><br><span class="line">            response &#x3D; json.loads(result.read())</span><br><span class="line">            result.close()</span><br><span class="line">            authID &#x3D; response[&#39;result&#39;]</span><br><span class="line">            return authID</span><br><span class="line">    def get_data(self,data,hostip&#x3D;&quot;&quot;):</span><br><span class="line">        request &#x3D; urllib2.Request(self.url,data)</span><br><span class="line">        for key in self.header:</span><br><span class="line">            request.add_header(key,self.header[key])</span><br><span class="line">        try:</span><br><span class="line">            result &#x3D; urllib2.urlopen(request)</span><br><span class="line">        except URLError as e:</span><br><span class="line">            if hasattr(e, &#39;reason&#39;):</span><br><span class="line">                print &#39;We failed to reach a server.&#39;</span><br><span class="line">                print &#39;Reason: &#39;, e.reason</span><br><span class="line">            elif hasattr(e, &#39;code&#39;):</span><br><span class="line">                print &#39;The server could not fulfill the request.&#39;</span><br><span class="line">                print &#39;Error code: &#39;, e.code</span><br><span class="line">            return 0</span><br><span class="line">        else:</span><br><span class="line">            response &#x3D; json.loads(result.read())</span><br><span class="line">            result.close()</span><br><span class="line">            return response</span><br><span class="line">    def host_get(self,hostip):</span><br><span class="line">        #hostip &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter Your Check Host:Host_ip :&#39;)</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;: &quot;host.get&quot;,</span><br><span class="line">                    &quot;params&quot;: &#123;</span><br><span class="line">                        &quot;output&quot;:[&quot;hostid&quot;,&quot;name&quot;,&quot;status&quot;,&quot;host&quot;],</span><br><span class="line">                        &quot;filter&quot;: &#123;&quot;host&quot;: [hostip]&#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &quot;auth&quot;: self.authID,</span><br><span class="line">                    &quot;id&quot;: 1</span><br><span class="line">                &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)[&#39;result&#39;]</span><br><span class="line">        if (res !&#x3D; 0) and (len(res) !&#x3D; 0):</span><br><span class="line">            #for host in res:</span><br><span class="line">            host &#x3D; res[0]</span><br><span class="line">            if host[&#39;status&#39;] &#x3D;&#x3D; &#39;1&#39;:</span><br><span class="line">                print &quot;\t&quot;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;Host_IP:&quot;,&quot;\033[1;31;40m%s\033[0m&quot; %host[&#39;host&#39;].ljust(15),&#39;\t&#39;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;Host_Name:&quot;,&quot;\033[1;31;40m%s\033[0m&quot;% host[&#39;name&#39;].encode(&#39;GBK&#39;),&#39;\t&#39;,&quot;\033[1;31;40m%s\033[0m&quot; % u&#39;monitor&#39;.encode(&#39;GBK&#39;)</span><br><span class="line">                return host[&#39;hostid&#39;]</span><br><span class="line">            elif host[&#39;status&#39;] &#x3D;&#x3D; &#39;0&#39;:</span><br><span class="line">                print &quot;\t&quot;,&quot;\033[1;32;40m%s\033[0m&quot; % &quot;Host_IP:&quot;,&quot;\033[1;32;40m%s\033[0m&quot; %host[&#39;host&#39;].ljust(15),&#39;\t&#39;,&quot;\033[1;32;40m%s\033[0m&quot; % &quot;Host_Name:&quot;,&quot;\033[1;32;40m%s\033[0m&quot;% host[&#39;name&#39;].encode(&#39;GBK&#39;),&#39;\t&#39;,&quot;\033[1;32;40m%s\033[0m&quot; % u&#39;unmonitor&#39;.encode(&#39;GBK&#39;)</span><br><span class="line">                return host[&#39;hostid&#39;]</span><br><span class="line">            print</span><br><span class="line">        else:</span><br><span class="line">            print &#39;\t&#39;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;Get Host Error or cannot find this host,please check !&quot;</span><br><span class="line">            return 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def get_grouphost(self):</span><br><span class="line">        groupid &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter Your groupid:&#39;)</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">            &#123;</span><br><span class="line">               &quot;jsonrpc&quot;:&quot;2.0&quot;,</span><br><span class="line">               &quot;method&quot;:&quot;host.get&quot;,</span><br><span class="line">               &quot;params&quot;:&#123;</span><br><span class="line">                   &quot;output&quot;:[&quot;hostid&quot;,&quot;name&quot;,&quot;status&quot;,&quot;host&quot;],</span><br><span class="line">                   #&quot;output&quot;: &quot;extend&quot;,</span><br><span class="line">                   #&quot;filter&quot;: &#123;&quot;host&quot;: [&quot;42.62.121.16&quot;]&#125;</span><br><span class="line">                   &quot;groupids&quot;:groupid,</span><br><span class="line">               &#125;,</span><br><span class="line">               &quot;auth&quot;: self.authID, </span><br><span class="line">               &quot;id&quot;:1,</span><br><span class="line">            &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)</span><br><span class="line">        if &#39;result&#39; in res.keys():</span><br><span class="line">            res &#x3D; res[&#39;result&#39;]</span><br><span class="line">            if (res !&#x3D;0) or (len(res) !&#x3D; 0):</span><br><span class="line">                print &quot;\033[1;32;40m%s\033[0m&quot; % &quot;Number Of Hosts: &quot;,&quot;\033[1;31;40m%d\033[0m&quot; % len(res)</span><br><span class="line">                for host in res:</span><br><span class="line">                    print &quot;Host ID:&quot;,host[&#39;hostid&#39;],&quot;Visible name:&quot;,host[&#39;name&#39;],&quot;Host-status:&quot;,host[&#39;status&#39;],&quot;HostName:&quot;,host[&#39;host&#39;]</span><br><span class="line">        else:</span><br><span class="line">            print &quot;The groupid does not exist, please check!&quot;</span><br><span class="line">            return 0</span><br><span class="line"></span><br><span class="line">    def get_hostlist(self):</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;:&quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;:&quot;host.get&quot;,</span><br><span class="line">                    &quot;params&quot;:&#123;</span><br><span class="line">                        &quot;output&quot;:[&quot;hostid&quot;,&quot;name&quot;],</span><br><span class="line">                        &quot;filter&quot;:&#123;&quot;host&quot;:&quot;&quot;&#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;auth&quot;:self.authID, </span><br><span class="line">                &quot;id&quot;:1,</span><br><span class="line">            &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)</span><br><span class="line">        if &#39;result&#39; in res.keys():</span><br><span class="line">            res &#x3D; res[&#39;result&#39;]</span><br><span class="line">            if (res !&#x3D;0) or (len(res) !&#x3D; 0):</span><br><span class="line">                print &quot;\033[1;32;40m%s\033[0m&quot; % &quot;Number Of Hosts: &quot;,&quot;\033[1;31;40m%d\033[0m&quot; % len(res)</span><br><span class="line">                for host in res:</span><br><span class="line">                    print &quot;Host ID:&quot;,host[&#39;hostid&#39;].encode(&#39;UTF-8&#39;),&quot;Host Name:&quot;,host[&#39;name&#39;].encode(&#39;UTF-8&#39;)</span><br><span class="line">        else:</span><br><span class="line">            print &#39;\t&#39;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;Get hostlist Error or cannot find this host,please check !&quot;</span><br><span class="line">        return 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def host_del(self):</span><br><span class="line">        hostip &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter Your Check Host:Host_ip :&#39;)</span><br><span class="line">        hostid &#x3D; self.host_get(hostip)</span><br><span class="line">    print hostid</span><br><span class="line">        if hostid &#x3D;&#x3D; 0:</span><br><span class="line">            print &#39;\t&#39;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;This host cannot find in zabbix,please check it !&quot;</span><br><span class="line">            sys.exit()</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;: &quot;host.delete&quot;,</span><br><span class="line">                    &quot;params&quot;: [hostid],</span><br><span class="line">                    &quot;auth&quot;: self.authID,</span><br><span class="line">                    &quot;id&quot;: 1</span><br><span class="line">                &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)[&#39;result&#39;]</span><br><span class="line">        if &#39;hostids&#39; in res.keys():</span><br><span class="line">            print &quot;\t&quot;,&quot;\033[1;32;40m%s\033[0m&quot; % &quot;Delet Host:%s success !&quot; % hostip</span><br><span class="line">        else:</span><br><span class="line">            print &quot;\t&quot;,&quot;\033[1;31;40m%s\033[0m&quot; % &quot;Delet Host:%s failure !&quot; % hostip</span><br><span class="line">    def hostgroup_get(self):</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;: &quot;hostgroup.get&quot;,</span><br><span class="line">                    &quot;params&quot;: &#123;</span><br><span class="line">                        &quot;output&quot;: &quot;extend&quot;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &quot;auth&quot;: self.authID,</span><br><span class="line">                    &quot;id&quot;: 1,</span><br><span class="line">                    &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)</span><br><span class="line">        if &#39;result&#39; in res.keys():</span><br><span class="line">            res &#x3D; res[&#39;result&#39;]</span><br><span class="line">            if (res !&#x3D;0) or (len(res) !&#x3D; 0):</span><br><span class="line">                print &quot;\033[1;32;40m%s\033[0m&quot; % &quot;Number Of Group: &quot;,&quot;\033[1;31;40m%d\033[0m&quot; % len(res)</span><br><span class="line">                for host in res:</span><br><span class="line">                    print&quot;\t&quot;,&quot;HostGroup_id:&quot;,host[&#39;groupid&#39;],&quot;\t&quot;,&quot;HostGroup_Name:&quot;,host[&#39;name&#39;].encode(&#39;GBK&#39;)</span><br><span class="line">        else:</span><br><span class="line">            print &quot;Get HostGroup Error,please check !&quot;</span><br><span class="line">    def template_get(self):</span><br><span class="line">        data &#x3D; json.dumps(</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                    &quot;method&quot;: &quot;template.get&quot;,</span><br><span class="line">                    &quot;params&quot;: &#123;</span><br><span class="line">                        &quot;output&quot;: &quot;extend&quot;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &quot;auth&quot;: self.authID,</span><br><span class="line">                    &quot;id&quot;: 1,</span><br><span class="line">                    &#125;)</span><br><span class="line">        res &#x3D; self.get_data(data)#[&#39;result&#39;]</span><br><span class="line">        if &#39;result&#39; in res.keys():</span><br><span class="line">            res &#x3D; res[&#39;result&#39;]</span><br><span class="line">            if (res !&#x3D;0) or (len(res) !&#x3D; 0):</span><br><span class="line">                print &quot;\033[1;32;40m%s\033[0m&quot; % &quot;Number Of Template: &quot;,&quot;\033[1;31;40m%d\033[0m&quot; % len(res)</span><br><span class="line">                for host in res:</span><br><span class="line">                    print&quot;\t&quot;,&quot;Template_id:&quot;,host[&#39;templateid&#39;],&quot;\t&quot;,&quot;Template_Name:&quot;,host[&#39;name&#39;].encode(&#39;GBK&#39;)</span><br><span class="line">                print</span><br><span class="line">        else:</span><br><span class="line">            print &quot;Get Template Error,please check !&quot;</span><br><span class="line">    def host_create(self):</span><br><span class="line">        hostip &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter your:Host_ip :&#39;)</span><br><span class="line">        #Visible_name &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter your:Visible name :&#39;)</span><br><span class="line">        groupid &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter your:Group_id :&#39;)</span><br><span class="line">        templateid &#x3D; raw_input(&quot;\033[1;35;40m%s\033[0m&quot; % &#39;Enter your:Tempate_id :&#39;)</span><br><span class="line">        g_list&#x3D;[]</span><br><span class="line">        t_list&#x3D;[]</span><br><span class="line">        for i in groupid.split(&#39;,&#39;):</span><br><span class="line">            var &#x3D; &#123;&#125;</span><br><span class="line">            var[&#39;groupid&#39;] &#x3D; i</span><br><span class="line">            g_list.append(var)</span><br><span class="line">        for i in templateid.split(&#39;,&#39;):</span><br><span class="line">            var &#x3D; &#123;&#125;</span><br><span class="line">            var[&#39;templateid&#39;] &#x3D; i</span><br><span class="line">            t_list.append(var)</span><br><span class="line">        if hostip and groupid and templateid:</span><br><span class="line">            data &#x3D; json.dumps(</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;jsonrpc&quot;: &quot;2.0&quot;,</span><br><span class="line">                        &quot;method&quot;: &quot;host.create&quot;,</span><br><span class="line">                        &quot;params&quot;: &#123;</span><br><span class="line">                            &quot;host&quot;: hostip,</span><br><span class="line">                            &quot;interfaces&quot;: [</span><br><span class="line">                                &#123;</span><br><span class="line">                                    &quot;type&quot;: 1,</span><br><span class="line">                                    &quot;main&quot;: 1,</span><br><span class="line">                                    &quot;useip&quot;: 1,</span><br><span class="line">                                    &quot;ip&quot;: hostip,</span><br><span class="line">                                    &quot;dns&quot;: &quot;&quot;,</span><br><span class="line">                                    &quot;port&quot;: &quot;10050&quot;</span><br><span class="line">                                &#125;</span><br><span class="line">                            ],</span><br><span class="line">                            &quot;groups&quot;: g_list,</span><br><span class="line">                            &quot;templates&quot;: t_list,</span><br><span class="line">                    &#125;,</span><br><span class="line">                        &quot;auth&quot;: self.authID,</span><br><span class="line">                        &quot;id&quot;: 1,</span><br><span class="line">                        &#125;)</span><br><span class="line">            res &#x3D; self.get_data(data,hostip)</span><br><span class="line">            if &#39;result&#39; in res.keys():</span><br><span class="line">                res &#x3D; res[&#39;result&#39;]</span><br><span class="line">                if &#39;hostids&#39; in res.keys():</span><br><span class="line">                    print &quot;\033[1;32;40m%s\033[0m&quot; % &quot;Create host success&quot;</span><br><span class="line">            else:</span><br><span class="line">                print &quot;\033[1;31;40m%s\033[0m&quot; % &quot;Create host failure: %s&quot; % res[&#39;error&#39;][&#39;data&#39;]</span><br><span class="line">        else:</span><br><span class="line">            print &quot;\033[1;31;40m%s\033[0m&quot; % &quot;Enter Error: ip or groupid or tempateid is NULL,please check it !&quot;</span><br><span class="line">def main():</span><br><span class="line">    test &#x3D; zabbixtools()</span><br><span class="line">    #test.template_get()</span><br><span class="line">    #test.hostgroup_get()</span><br><span class="line">    #test.host_get()</span><br><span class="line">    #test.host_del()</span><br><span class="line">    #test.host_create()</span><br><span class="line">    #test.get_grouphost()</span><br><span class="line">    #test.get_hostlist()</span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°</title>
    <url>/2020/04/20/%E4%B8%80%E4%BA%9B%E6%9C%89%E7%94%A8%E7%9A%84Python%E5%BA%93/</url>
    <content><![CDATA[<h2 id="Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°"><a href="#Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°" class="headerlink" title="Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°"></a>Pythonå°æŠ€å·§å’Œæœ‰è¶£çš„å†…ç½®å‡½æ•°</h2><blockquote>
<p>ä¸€ä¸ªpythonå°æŠ€å·§çš„é›†åˆå’Œä¸€äº›å¾ˆæœ‰ç”¨çš„Pythonå†…ç½®å‡½æ•°,è¿™äº›å‡½æ•°ç®€ç›´æ˜¯å±Œçˆ†äº†ï¼Œæˆ‘è®¤ä¸ºæ¯ä¸ª Pythoner éƒ½åº”è¯¥çŸ¥é“è¿™äº›å‡½æ•°ã€‚</p>
</blockquote>
<h3 id="1-1-æ‹†ç®±"><a href="#1-1-æ‹†ç®±" class="headerlink" title="1.1 æ‹†ç®±"></a>1.1 æ‹†ç®±</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, b, c &#x3D; 1, 2, 3  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 2, 3)  </span><br><span class="line">&gt;&gt;&gt; a, b, c &#x3D; [1, 2, 3]  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 2, 3)  </span><br><span class="line">&gt;&gt;&gt; a, b, c &#x3D; (2 * i + 1  for i in range(3))  </span><br><span class="line">&gt;&gt;&gt; a, b, c  </span><br><span class="line">(1, 3, 5)  </span><br><span class="line">&gt;&gt;&gt; a, (b, c), d &#x3D; [1, (2, 3), 4]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; b  </span><br><span class="line">2  </span><br><span class="line">&gt;&gt;&gt; c  </span><br><span class="line">3  </span><br><span class="line">&gt;&gt;&gt; d  </span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="1-2-æ‹†ç®±å˜é‡äº¤æ¢"><a href="#1-2-æ‹†ç®±å˜é‡äº¤æ¢" class="headerlink" title="1.2 æ‹†ç®±å˜é‡äº¤æ¢"></a>1.2 æ‹†ç®±å˜é‡äº¤æ¢</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, b &#x3D; 1, 2  </span><br><span class="line">&gt;&gt;&gt; a, b &#x3D; b, a  </span><br><span class="line">&gt;&gt;&gt; a, b  </span><br><span class="line">(2, 1)</span><br></pre></td></tr></table></figure>
<h3 id="1-3-æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3"><a href="#1-3-æ‰©å±•æ‹†ç®±-åªå…¼å®¹python3" class="headerlink" title="1.3 æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)"></a>1.3 æ‰©å±•æ‹†ç®±(åªå…¼å®¹python3)</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a, *b, c &#x3D; [1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; b  </span><br><span class="line">[2, 3, 4]  </span><br><span class="line">&gt;&gt;&gt; c  </span><br><span class="line">5</span><br></pre></td></tr></table></figure>
<h3 id="1-4-è´Ÿæ•°ç´¢å¼•"><a href="#1-4-è´Ÿæ•°ç´¢å¼•" class="headerlink" title="1.4 è´Ÿæ•°ç´¢å¼•"></a>1.4 è´Ÿæ•°ç´¢å¼•</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[-1]  </span><br><span class="line">10  </span><br><span class="line">&gt;&gt;&gt; a[-3]  </span><br><span class="line">8</span><br></pre></td></tr></table></figure>
<h3 id="1-5-åˆ‡å‰²åˆ—è¡¨"><a href="#1-5-åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.5 åˆ‡å‰²åˆ—è¡¨"></a>1.5 åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[2:8]  </span><br><span class="line">[2, 3, 4, 5, 6, 7]</span><br></pre></td></tr></table></figure>
<h3 id="1-6-è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨"><a href="#1-6-è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.6 è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨"></a>1.6 è´Ÿæ•°ç´¢å¼•åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[-4:-2]  </span><br><span class="line">[7, 8]</span><br></pre></td></tr></table></figure>
<h3 id="1-7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨"><a href="#1-7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨"></a>1.7æŒ‡å®šæ­¥é•¿åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::2]  </span><br><span class="line">[0, 2, 4, 6, 8, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::3]  </span><br><span class="line">[0, 3, 6, 9]  </span><br><span class="line">&gt;&gt;&gt; a[2:8:2]  </span><br><span class="line">[2, 4, 6]</span><br></pre></td></tr></table></figure>
<h3 id="1-8-è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨"><a href="#1-8-è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨" class="headerlink" title="1.8 è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨"></a>1.8 è´Ÿæ•°æ­¥é•¿åˆ‡å‰²åˆ—è¡¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  </span><br><span class="line">&gt;&gt;&gt; a[::-1]  </span><br><span class="line">[10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]  </span><br><span class="line">&gt;&gt;&gt; a[::-2]  </span><br><span class="line">[10, 8, 6, 4, 2, 0]</span><br></pre></td></tr></table></figure>
<h3 id="1-9-åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"><a href="#1-9-åˆ—è¡¨åˆ‡å‰²èµ‹å€¼" class="headerlink" title="1.9 åˆ—è¡¨åˆ‡å‰²èµ‹å€¼"></a>1.9 åˆ—è¡¨åˆ‡å‰²èµ‹å€¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[2:3] &#x3D; [0, 0]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 2, 0, 0, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[1:1] &#x3D; [8, 9]  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 8, 9, 2, 0, 0, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; a[1:-1] &#x3D; []  </span><br><span class="line">&gt;&gt;&gt; a  </span><br><span class="line">[1, 5]</span><br></pre></td></tr></table></figure>
<h3 id="1-10-å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"><a href="#1-10-å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼" class="headerlink" title="1.10 å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼"></a>1.10 å‘½ååˆ—è¡¨åˆ‡å‰²æ–¹å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [0, 1, 2, 3, 4, 5]  </span><br><span class="line">&gt;&gt;&gt; LASTTHREE &#x3D; slice(-3, None)  </span><br><span class="line">&gt;&gt;&gt; LASTTHREE  </span><br><span class="line">slice(-3, None, None)  </span><br><span class="line">&gt;&gt;&gt; a[LASTTHREE]  </span><br><span class="line">[3, 4, 5]</span><br></pre></td></tr></table></figure>
<h3 id="1-11-åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"><a href="#1-11-åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©" class="headerlink" title="1.11 åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©"></a>1.11 åˆ—è¡¨ä»¥åŠè¿­ä»£å™¨çš„å‹ç¼©å’Œè§£å‹ç¼©</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3]  </span><br><span class="line">&gt;&gt;&gt; b &#x3D; [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]  </span><br><span class="line">&gt;&gt;&gt; z &#x3D; zip(a, b)  </span><br><span class="line">&gt;&gt;&gt; z  </span><br><span class="line">[(1, &#39;a&#39;), (2, &#39;b&#39;), (3, &#39;c&#39;)]  </span><br><span class="line">&gt;&gt;&gt; zip(*z)  </span><br><span class="line">[(1, 2, 3), (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;)]</span><br></pre></td></tr></table></figure>
<h3 id="1-12-åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨"><a href="#1-12-åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨" class="headerlink" title="1.12 åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨"></a>1.12 åˆ—è¡¨ç›¸é‚»å…ƒç´ å‹ç¼©å™¨</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5, 6]  </span><br><span class="line">&gt;&gt;&gt; zip(*([iter(a)] * 2))  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent &#x3D; lambda a, k: zip(*([iter(a)] * k))  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 3)  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 2)  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 1)  </span><br><span class="line">[(1,), (2,), (3,), (4,), (5,), (6,)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; zip(a[::2], a[1::2])  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; zip(a[::3], a[1::3], a[2::3])  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; group_adjacent &#x3D; lambda a, k: zip(*(a[i::k] for i in range(k)))  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 3)  </span><br><span class="line">[(1, 2, 3), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 2)  </span><br><span class="line">[(1, 2), (3, 4), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; group_adjacent(a, 1)  </span><br><span class="line">[(1,), (2,), (3,), (4,), (5,), (6,)]</span><br></pre></td></tr></table></figure>
<h3 id="1-13-åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£"><a href="#1-13-åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£" class="headerlink" title="1.13 åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£"></a>1.13 åœ¨åˆ—è¡¨ä¸­ç”¨å‹ç¼©å™¨å’Œè¿­ä»£å™¨æ»‘åŠ¨å–å€¼çª—å£</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; def n_grams(a, n):  </span><br><span class="line">... z &#x3D; [iter(a[i:]) for i in range(n)]  </span><br><span class="line">... return zip(*z)  </span><br><span class="line">...  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, 3, 4, 5, 6]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 3)  </span><br><span class="line">[(1, 2, 3), (2, 3, 4), (3, 4, 5), (4, 5, 6)]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 2)  </span><br><span class="line">[(1, 2), (2, 3), (3, 4), (4, 5), (5, 6)]  </span><br><span class="line">&gt;&gt;&gt; n_grams(a, 4)  </span><br><span class="line">[(1, 2, 3, 4), (2, 3, 4, 5), (3, 4, 5, 6)]</span><br></pre></td></tr></table></figure>
<h3 id="ç”¨å‹ç¼©å™¨åè½¬å­—å…¸"><a href="#ç”¨å‹ç¼©å™¨åè½¬å­—å…¸" class="headerlink" title="ç”¨å‹ç¼©å™¨åè½¬å­—å…¸"></a>ç”¨å‹ç¼©å™¨åè½¬å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;  </span><br><span class="line">&gt;&gt;&gt; m.items()  </span><br><span class="line">[(&#39;a&#39;, 1), (&#39;c&#39;, 3), (&#39;b&#39;, 2), (&#39;d&#39;, 4)]  </span><br><span class="line">&gt;&gt;&gt; zip(m.values(), m.keys())  </span><br><span class="line">[(1, &#39;a&#39;), (3, &#39;c&#39;), (2, &#39;b&#39;), (4, &#39;d&#39;)]  </span><br><span class="line">&gt;&gt;&gt; mi &#x3D; dict(zip(m.values(), m.keys()))  </span><br><span class="line">&gt;&gt;&gt; mi  </span><br><span class="line">&#123;1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;, 4: &#39;d&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-15-åˆ—è¡¨å±•å¼€"><a href="#1-15-åˆ—è¡¨å±•å¼€" class="headerlink" title="1.15 åˆ—è¡¨å±•å¼€"></a>1.15 åˆ—è¡¨å±•å¼€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; a &#x3D; [[1, 2], [3, 4], [5, 6]]  </span><br><span class="line">&gt;&gt;&gt; list(itertools.chain.from_iterable(a))  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; sum(a, [])  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; [x for l in a for x in l]  </span><br><span class="line">[1, 2, 3, 4, 5, 6]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [[[1, 2], [3, 4]], [[5, 6], [7, 8]]]  </span><br><span class="line">&gt;&gt;&gt; [x for l1 in a for l2 in l1 for x in l2]  </span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; a &#x3D; [1, 2, [3, 4], [[5, 6], [7, 8]]]  </span><br><span class="line">&gt;&gt;&gt; flatten &#x3D; lambda x: [y for l in x for y in flatten(l)] if type(x) is list else [x]  </span><br><span class="line">&gt;&gt;&gt; flatten(a)  </span><br><span class="line">[1, 2, 3, 4, 5, 6, 7, 8]</span><br></pre></td></tr></table></figure>
<h3 id="1-16-ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#1-16-ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="1.16 ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>1.16 ç”Ÿæˆå™¨è¡¨è¾¾å¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; g &#x3D; (x ** 2  for x in xrange(10))  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">0  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">1  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">4  </span><br><span class="line">&gt;&gt;&gt; next(g)  </span><br><span class="line">9  </span><br><span class="line">&gt;&gt;&gt; sum(x ** 3  for x in xrange(10))  </span><br><span class="line">2025  </span><br><span class="line">&gt;&gt;&gt; sum(x ** 3  for x in xrange(10) if x % 3 &#x3D;&#x3D; 1)  </span><br><span class="line">408</span><br></pre></td></tr></table></figure>
<h3 id="1-17-å­—å…¸æ¨å¯¼"><a href="#1-17-å­—å…¸æ¨å¯¼" class="headerlink" title="1.17 å­—å…¸æ¨å¯¼"></a>1.17 å­—å…¸æ¨å¯¼</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: x ** 2  for x in range(5)&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;0: 0, 1: 1, 2: 4, 3: 9, 4: 16&#125;  </span><br><span class="line">  </span><br><span class="line">&gt;&gt;&gt; m &#x3D; &#123;x: &#39;A&#39; + str(x) for x in range(10)&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;0: &#39;A0&#39;, 1: &#39;A1&#39;, 2: &#39;A2&#39;, 3: &#39;A3&#39;, 4: &#39;A4&#39;, 5: &#39;A5&#39;, 6: &#39;A6&#39;, 7: &#39;A7&#39;, 8: &#39;A8&#39;, 9: &#39;A9&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-18-ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸"><a href="#1-18-ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸" class="headerlink" title="1.18 ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸"></a>1.18 ç”¨å­—å…¸æ¨å¯¼åè½¬å­—å…¸</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; m &#x3D; &#123;&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;  </span><br><span class="line">&gt;&gt;&gt; m  </span><br><span class="line">&#123;&#39;d&#39;: 4, &#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 3&#125;  </span><br><span class="line">&gt;&gt;&gt; &#123;v: k for k, v in m.items()&#125;  </span><br><span class="line">&#123;1: &#39;a&#39;, 2: &#39;b&#39;, 3: &#39;c&#39;, 4: &#39;d&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-19-å‘½åå…ƒç»„"><a href="#1-19-å‘½åå…ƒç»„" class="headerlink" title="1.19 å‘½åå…ƒç»„"></a>1.19 å‘½åå…ƒç»„</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; Point &#x3D; collections.namedtuple(&#39;Point&#39;, [&#39;x&#39;, &#39;y&#39;])  </span><br><span class="line">&gt;&gt;&gt; p &#x3D; Point(x&#x3D;1.0, y&#x3D;2.0)  </span><br><span class="line">&gt;&gt;&gt; p  </span><br><span class="line">Point(x&#x3D;1.0, y&#x3D;2.0)  </span><br><span class="line">&gt;&gt;&gt; p.x  </span><br><span class="line">1.0  </span><br><span class="line">&gt;&gt;&gt; p.y  </span><br><span class="line">2.0</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://python.jobbole.com/63320/" target="_blank" rel="noopener">æ›´å¤šè¯·æŸ¥çœ‹åŸæ–‡</a>  </p>
</blockquote>
<h3 id="å‡½æ•°éƒ¨åˆ†"><a href="#å‡½æ•°éƒ¨åˆ†" class="headerlink" title="å‡½æ•°éƒ¨åˆ†"></a>å‡½æ•°éƒ¨åˆ†</h3><h3 id="all-iterable"><a href="#all-iterable" class="headerlink" title="all(iterable)"></a>all(iterable)</h3><p>å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡(æ•°ç»„ï¼Œå­—ç¬¦ä¸²ï¼Œåˆ—è¡¨ç­‰ï¼Œä¸‹åŒ)ä¸­çš„å…ƒç´ éƒ½æ˜¯true(æˆ–è€…ä¸ºç©º)çš„è¯è¿”å›True</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_all &#x3D; True  </span><br><span class="line">for item in iterable:  </span><br><span class="line">if  not item:  </span><br><span class="line">_all &#x3D; False  </span><br><span class="line">break  </span><br><span class="line">if _all:  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<p>æ›´ç®€ä¾¿çš„å†™æ³•æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if all(iterable):  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>

<h3 id="any-iterable"><a href="#any-iterable" class="headerlink" title="any(iterable)"></a>any(iterable)</h3><p>å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå…ƒç´ ä¸ºtrueçš„è¯è¿”å›True,å¦‚æœå¯è¿­ä»£çš„å¯¹è±¡ä¸ºç©ºåˆ™è¿”å›False</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_any &#x3D; False  </span><br><span class="line">for item in iterable:  </span><br><span class="line">if item:  </span><br><span class="line">_any &#x3D; True  </span><br><span class="line">break  </span><br><span class="line">if _any:  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<p>æ›´ç®€ä¾¿çš„å†™æ³•æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if any(iterable):  </span><br><span class="line"># do stuff</span><br></pre></td></tr></table></figure>
<h3 id="cmp-x-y"><a href="#cmp-x-y" class="headerlink" title="cmp(x, y)"></a>cmp(x, y)</h3><p>æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ x å’Œ y , x &lt; y çš„æ—¶å€™è¿”å›è´Ÿæ•°ï¼Œ x ==y çš„æ—¶å€™è¿”å› 0ï¼Œ x &gt; y çš„æ—¶å€™è¿”å›æ­£æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def compare(x,y):  </span><br><span class="line">if x &lt; y:  </span><br><span class="line">return -1  </span><br><span class="line">elif x &#x3D;&#x3D; y:  </span><br><span class="line">return  0  </span><br><span class="line">else:  </span><br><span class="line">return  1</span><br></pre></td></tr></table></figure>
<p>ä½ å®Œå…¨å¯ä»¥ä½¿ç”¨ä¸€å¥ cmp(x, y) æ¥æ›¿ä»£ã€‚</p>
<h3 id="dict-arg"><a href="#dict-arg" class="headerlink" title="dict([arg])"></a>dict([arg])</h3><p>ä½¿ç”¨ arg æä¾›çš„æ¡ç›®ç”Ÿæˆä¸€ä¸ªæ–°çš„å­—å…¸ã€‚<br>arg é€šå¸¸æ˜¯æœªçŸ¥çš„ï¼Œä½†æ˜¯å®ƒå¾ˆæ–¹ä¾¿ï¼æ¯”å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠä¸€ä¸ªå«ä¸¤ä¸ªå…ƒç»„çš„åˆ—è¡¨è½¬æ¢æˆä¸€ä¸ªå­—å…¸ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l &#x3D; [(&#39;Knights&#39;, &#39;Ni&#39;), (&#39;Monty&#39;, &#39;Python&#39;), (&#39;SPAM&#39;, &#39;SPAAAM&#39;)]  </span><br><span class="line">d &#x3D; dict()  </span><br><span class="line">for tuple in l:  </span><br><span class="line">Â  Â d[tuple[0]] &#x3D; tuple[1]  </span><br><span class="line"># &#123;&#39;Knights&#39;: &#39;Ni&#39;, &#39;Monty&#39;: &#39;Python&#39;, &#39;SPAM&#39;: &#39;SPAAAM&#39;&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿™æ ·:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l &#x3D; [(&#39;Knights&#39;, &#39;Ni&#39;), (&#39;Monty&#39;, &#39;Python&#39;), (&#39;SPAM&#39;, &#39;SPAAAM&#39;)]  </span><br><span class="line">d &#x3D; dict(l) # &#123;&#39;Knights&#39;: &#39;Ni&#39;, &#39;Monty&#39;: &#39;Python&#39;, &#39;SPAM&#39;: &#39;SPAAAM&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="enumerate-iterable-start-0"><a href="#enumerate-iterable-start-0" class="headerlink" title="enumerate(iterable [,start=0])"></a>enumerate(iterable [,start=0])</h3><p>æˆ‘çœŸçš„æ˜¯è¶…çº§å–œæ¬¢è¿™ä¸ª!å¦‚æœä½ ä»¥å‰å†™è¿‡Cè¯­è¨€ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šè¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i in range(len(list)):  </span><br><span class="line"># do stuff with list[i], for example, print it  </span><br><span class="line">print i, list[i]</span><br></pre></td></tr></table></figure>
<p>å™¢,ä¸ç”¨é‚£ä¹ˆéº»çƒ¦!ä½ å¯ä»¥ä½¿ç”¨enumerate()æ¥æé«˜å¯è¯»æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for i, item in enumerate(list):  </span><br><span class="line"># so stuff with item, for example print it  </span><br><span class="line">print i, item</span><br></pre></td></tr></table></figure>
<h3 id="isinstance-object-classinfo"><a href="#isinstance-object-classinfo" class="headerlink" title="isinstance(object, classinfo)"></a>isinstance(object, classinfo)</h3><p>å¦‚æœ object å‚æ•°æ˜¯ classinfo å‚æ•°çš„ä¸€ä¸ªå®ä¾‹æˆ–è€…å­ç±»(ç›´æ¥æˆ–è€…é—´æ¥)çš„è¯è¿”å› True<br>å½“ä½ æƒ³æ£€éªŒä¸€ä¸ªå¯¹è±¡çš„ç±»å‹çš„æ—¶å€™,ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„åº”è¯¥æ˜¯ä½¿ç”¨type()å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if type(obj) &#x3D;&#x3D; type(dict):  </span><br><span class="line"># do stuff  </span><br><span class="line">elif type(obj) &#x3D;&#x3D; type(list):  </span><br><span class="line"># do other stuff  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…ä½ å¯ä»¥è¿™ä¹ˆå†™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if isinstance(obj, dict):  </span><br><span class="line"># do stuff  </span><br><span class="line">elif isinstance(obj, list):  </span><br><span class="line"># do other stuff  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="pow-x-y-z"><a href="#pow-x-y-z" class="headerlink" title="pow(x, y [,z])"></a>pow(x, y [,z])</h3><p>è¿”å› x çš„ y æ¬¡å¹‚(å¦‚æœ z å­˜åœ¨çš„è¯åˆ™ä»¥ z ä¸ºæ¨¡)ã€‚<br>å¦‚æœä½ æƒ³è®¡ç®— x çš„ y æ¬¡æ–¹ï¼Œä»¥ z ä¸ºæ¨¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mod &#x3D; (x ** y) % z</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å½“ x=1234567ï¼Œ y=4567676ï¼Œ z=56 çš„æ—¶å€™æˆ‘çš„ç”µè„‘è¶³è¶³è·‘äº† 64 ç§’ï¼<br>ä¸è¦ç”¨ ** å’Œ % äº†ï¼Œä½¿ç”¨ pow(x, y, z) å§ï¼è¿™ä¸ªä¾‹å­å¯ä»¥å†™æˆ pow(1234567, 4567676, 56) ï¼Œåªç”¨äº† 0.034 ç§’å°±å‡ºäº†ç»“æœï¼</p>
<h3 id="zip-iterable"><a href="#zip-iterable" class="headerlink" title="zip([iterable, ])"></a>zip([iterable, ])</h3><p>è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå«å…ƒç»„çš„åˆ—è¡¨ï¼Œå…·ä½“è¯·çœ‹ä¾‹å­:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l1 &#x3D; (&#39;You gotta&#39;, &#39;the&#39;)  </span><br><span class="line">l2 &#x3D; (&#39;love&#39;, &#39;built-in&#39;)  </span><br><span class="line">out &#x3D; []  </span><br><span class="line">if len(l1) &#x3D;&#x3D; len(l2):  </span><br><span class="line">for i in range(len(l1)):  </span><br><span class="line">Â  Â  Â  Â out.append((l1[i], l2[i]))  </span><br><span class="line"># out &#x3D; [(&#39;You gotta&#39;, &#39;love&#39;), (&#39;the&#39;, &#39;built-in)]</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…è¿™ä¹ˆå†™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">l1 &#x3D; [&#39;You gotta&#39;, &#39;the&#39;]  </span><br><span class="line">l2 &#x3D; [&#39;love&#39;, &#39;built-in&#39;]  </span><br><span class="line">out &#x3D; zip(l1, l2) # [(&#39;You gotta&#39;, &#39;love&#39;), (&#39;the&#39;, &#39;built-in)]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æƒ³å¾—åˆ°å€’åºçš„è¯åŠ ä¸Š * æ“ä½œç¬¦å°±å¯ä»¥äº†:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">print zip(*out)  </span><br><span class="line"># [(&#39;You gotta&#39;, &#39;the&#39;), (&#39;love&#39;, &#39;built-in&#39;)]</span><br></pre></td></tr></table></figure>

<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>Python å†…ç½®å‡½æ•°å¾ˆæ–¹ä¾¿ï¼Œå®ƒä»¬å¾ˆå¿«å¹¶ä¸”ç»è¿‡äº†ä¼˜åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬å¯èƒ½æ•ˆç‡æ›´é«˜ã€‚<br>æˆ‘çœŸå¿ƒè®¤ä¸ºæ¯ä¸ª Python å¼€å‘è€…éƒ½åº”è¯¥å¥½å¥½çœ‹çœ‹å†…ç½®å‡½æ•°çš„æ–‡æ¡£(å¼•è¨€éƒ¨åˆ†)ã€‚<br>å¿˜äº†è¯´äº†ï¼Œåœ¨ itertools æ¨¡å—ä¸­æœ‰å¾ˆå¤šå¾ˆä¸é”™çš„å‡½æ•°ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸–ç•Œä¸Šæœ€å°çš„Djangoé¡¹ç›®ç¤ºä¾‹</title>
    <url>/2020/04/20/%E4%B8%96%E7%95%8C%E4%B8%8A%E6%9C%80%E5%B0%8F%E7%9A%84Django%E9%A1%B9%E7%9B%AE%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="ä¸€-ä¸–ç•Œä¸Šæœ€å°çš„Djangoé¡¹ç›®ç¤ºä¾‹"><a href="#ä¸€-ä¸–ç•Œä¸Šæœ€å°çš„Djangoé¡¹ç›®ç¤ºä¾‹" class="headerlink" title="ä¸€. ä¸–ç•Œä¸Šæœ€å°çš„Djangoé¡¹ç›®ç¤ºä¾‹"></a>ä¸€. ä¸–ç•Œä¸Šæœ€å°çš„Djangoé¡¹ç›®ç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># hello.py</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line">DEBUG &#x3D; os.environ.get(&quot;DEBUG&quot;,&quot;on&quot;) &#x3D;&#x3D; &quot;on&quot;</span><br><span class="line">SECRET_KEY &#x3D; os.environ.get(&quot;SECRET_KEY&quot;,&quot;&#123;&#123; secret_key &#125;&#125;&quot;)</span><br><span class="line">ALLOWED_HOSTS &#x3D; os.environ.get(&quot;ALLOWED_HOST&quot;,&quot;localhost&quot;).split(&quot;,&quot;)</span><br><span class="line"></span><br><span class="line">settings.configure(</span><br><span class="line">    DEBUG&#x3D;DEBUG,</span><br><span class="line">    SECRET_KEY&#x3D;SECRET_KEY,</span><br><span class="line">    ALLOWED_HOSTS&#x3D;ALLOWED_HOSTS,</span><br><span class="line">    ROOT_URLCONF&#x3D;__name__,</span><br><span class="line">    MIDDLEWARE_CLASSES&#x3D;(</span><br><span class="line">        &#39;django.middleware.common.CommonMiddleware&#39;,</span><br><span class="line">        &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span><br><span class="line">        &#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;,</span><br><span class="line">    ),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from django.http import HttpResponse</span><br><span class="line"></span><br><span class="line">def index(request):</span><br><span class="line">    return HttpResponse(&#39;Heello World&#39;)</span><br><span class="line">    </span><br><span class="line">urlpatters &#x3D; (</span><br><span class="line">    url(r&#39;^$&#39;,index),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">if __name &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    from django.core.management import execute_from_command_line</span><br><span class="line">    execute_from_command_line(sys.argv)</span><br></pre></td></tr></table></figure>

<h2 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ python hello.py runserver</span><br></pre></td></tr></table></figure>


<h2 id="äºŒ-ä½¿ç”¨gunincornè¿è¡ŒpythonæœåŠ¡"><a href="#äºŒ-ä½¿ç”¨gunincornè¿è¡ŒpythonæœåŠ¡" class="headerlink" title="äºŒ. ä½¿ç”¨gunincornè¿è¡ŒpythonæœåŠ¡"></a>äºŒ. ä½¿ç”¨gunincornè¿è¡ŒpythonæœåŠ¡</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat hello.py</span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from django.core.wsgi import get_wsgi_application</span><br><span class="line">from django.http import Httpresponse</span><br><span class="line"></span><br><span class="line">application &#x3D; get_wsgi_application()</span><br><span class="line"></span><br><span class="line">if __name &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">   from django.core.management import execute_from_command_line</span><br><span class="line">   execute_from_command_line(sys.argv)</span><br></pre></td></tr></table></figure>
<h3 id="å®‰è£…gunicornå¹¶è¿è¡Œ"><a href="#å®‰è£…gunicornå¹¶è¿è¡Œ" class="headerlink" title="å®‰è£…gunicornå¹¶è¿è¡Œ"></a>å®‰è£…gunicornå¹¶è¿è¡Œ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pip install gunicorn</span><br><span class="line"># gunicorn hello --log-file&#x3D;-</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•ç¦ç”¨è‡ªåŠ¨å‘½åçš„Djangoè¿ç§»</title>
    <url>/2020/04/20/%E5%A6%82%E4%BD%95%E7%A6%81%E7%94%A8%E8%87%AA%E5%8A%A8%E5%91%BD%E5%90%8D%E7%9A%84Django%E8%BF%81%E7%A7%BB/</url>
    <content><![CDATA[<h2 id="å¦‚ä½•ç¦ç”¨è‡ªåŠ¨å‘½åçš„Djangoè¿ç§»"><a href="#å¦‚ä½•ç¦ç”¨è‡ªåŠ¨å‘½åçš„Djangoè¿ç§»" class="headerlink" title="å¦‚ä½•ç¦ç”¨è‡ªåŠ¨å‘½åçš„Djangoè¿ç§»"></a>å¦‚ä½•ç¦ç”¨è‡ªåŠ¨å‘½åçš„Djangoè¿ç§»</h2><blockquote>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨<code>Django</code>æ‰§è¡Œ<code>makemigrations</code>æ—¶å®Œæˆæ–‡ä»¶çš„å‘½å</p>
</blockquote>
<p>å½“ä½ è¿è¡ŒDjangoçš„manage.py makemigrationsæ—¶ï¼Œå®ƒå°†æ ¹æ®è¿ç§»çš„å†…å®¹ä¸ºè¿ç§»ç”Ÿæˆä¸€ä¸ªåç§°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ˜¯åœ¨æ·»åŠ å•ä¸ªå­—æ®µï¼Œå®ƒä¼šå°†è¿ç§»å‘½åä¸º0002_mymodel_myfield.pyã€‚ä½†æ˜¯ï¼Œå½“ä½ çš„è¿ç§»ä¸­åŒ…å«ä¸æ­¢ä¸€æ­¥æ“ä½œæ—¶ï¼Œå®ƒå°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„â€˜autoâ€™å’Œå½“å‰æ—¥æœŸ+æ—¶é—´è¿›è¡Œå‘½åï¼Œä¾‹å¦‚ï¼Œ0002_auto_20200113_1837.pyã€‚ä½ å¯ä»¥ä¸ºmakemigrationsæä¾›-n/â€“nameå‚æ•°ï¼Œä½†æ˜¯å¼€å‘äººå‘˜ç»å¸¸ä¼šå¿˜è®°è¿™ä¸€ç‚¹ã€‚</p>
<p>å‘½åæ˜¯ç¼–ç¨‹ä¸­ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„éš¾é¢˜ã€‚ç®¡ç†è¿™äº›å…·æœ‰è‡ªåŠ¨åç§°çš„è¿ç§»ä¼šå¾ˆå›°éš¾: å¦‚æœä¸æ‰“å¼€å®ƒä»¬ï¼Œä½ å°±æ— æ³•åˆ†è¾¨å“ªä¸ªæ˜¯å“ªä¸ªï¼Œè€Œä¸”å¦‚æœå®ƒä»¬æ˜¯åœ¨åŒä¸€å¤©ç”Ÿæˆçš„ï¼Œå®ƒä»¬å°±ä¼šæœ‰ç›¸åŒçš„åç§°ï¼Œé‚£ä½ å°±å¯èƒ½ä¼šæ··æ·†å®ƒä»¬ã€‚</p>
<p>è¿™åœ¨ä»¥ä¸‹æƒ…å†µä¸­ä¼šéå¸¸ä»¤äººå¤´ç–¼:</p>
<ul>
<li>å˜åŸºåˆ†æ”¯</li>
<li>æŒ–æ˜å†å²è®°å½•</li>
<li>éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ</li>
</ul>
<p>åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿è¡Œé”™è¯¯çš„è¿ç§»å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±!<br>æˆ‘ä»¬è¿˜å¾ˆå®¹æ˜“å¿˜è®°ä¿®æ”¹è¿ç§»åç§°å’Œæäº¤ï¼Œå› ä¸ºDjangoä¸ä¼šæç¤ºä½ è¾“å…¥ä¸€ä¸ªæ›´å¥½çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›è‡ªåŠ¨åŒ–æªæ–½æ¥é˜²èŒƒè¿™ç§æƒ…å†µ!</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ç°è¿™ä¸€ç‚¹çš„ä¸‰ç§æŠ€æœ¯ã€‚</p>
<ol>
<li><strong>é‡å†™makemigrationsä»¥è¦æ±‚æä¾› -n/â€“name</strong><br>è¿™ä¸ªæ–¹æ³•ä½¿ç”¨äº†é‡å†™å†…ç½®ç®¡ç†å‘½ä»¤çš„æŠ€æœ¯ï¼Œè¿™ä¸æˆ‘åœ¨æ–‡ç« ã€Šè®©Djangoæµ‹è¯•æ€»æ˜¯é‡æ–°æ„å»ºæ•°æ®åº“(å¦‚æœå®ƒå­˜åœ¨çš„è¯)ã€‹ä¸­ä½¿ç”¨çš„æŠ€æœ¯ç›¸åŒã€‚</li>
</ol>
<p>åœ¨ä½ çš„é¡¹ç›®çš„â€œæ ¸å¿ƒâ€åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„makemigrationså‘½ä»¤(ä¾‹å¦‚:myapp/management/commands/makemigrations.py)ï¼Œå†…å®¹å¦‚ä¸‹:</p>
]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>æ“ä½œexcel</title>
    <url>/2020/04/20/%E6%93%8D%E4%BD%9Cexcel/</url>
    <content><![CDATA[<h2 id="è¯»å–excel"><a href="#è¯»å–excel" class="headerlink" title="è¯»å–excel"></a>è¯»å–excel</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import xlrd</span><br><span class="line">from xlrd.book import Book</span><br><span class="line">from xlrd.sheet import Sheet</span><br><span class="line">from xlrd.sheet import Cell</span><br><span class="line"></span><br><span class="line">workbook &#x3D; xlrd.open_workbook(&#39;åŸºç¡€è¯¾ç¨‹å¤§çº².xlsx&#39;)</span><br><span class="line"></span><br><span class="line">sheet_names &#x3D; workbook.sheet_names()</span><br><span class="line"></span><br><span class="line"># sheet &#x3D; workbook.sheet_by_name(&#39;å·¥ä½œè¡¨1&#39;)</span><br><span class="line">sheet &#x3D; workbook.sheet_by_index(1)</span><br><span class="line"></span><br><span class="line"># å¾ªç¯Excelæ–‡ä»¶çš„æ‰€æœ‰è¡Œ</span><br><span class="line">for row in sheet.get_rows():</span><br><span class="line">    # å¾ªç¯ä¸€è¡Œçš„æ‰€æœ‰åˆ—</span><br><span class="line">    for col in row:</span><br><span class="line">        # è·å–ä¸€ä¸ªå•å…ƒæ ¼ä¸­çš„å€¼</span><br><span class="line">        print(col.value)</span><br></pre></td></tr></table></figure>
<h2 id="å†™excel"><a href="#å†™excel" class="headerlink" title="å†™excel"></a>å†™excel</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import xlwt</span><br><span class="line"></span><br><span class="line">wb &#x3D; xlwt.Workbook()</span><br><span class="line">sheet &#x3D; wb.add_sheet(&#39;sheet1&#39;)</span><br><span class="line"></span><br><span class="line">for row in range(10):</span><br><span class="line">    for col in range(5):</span><br><span class="line">        sheet.write(row, col, &#39;ç¬¬&#123;0&#125;è¡Œç¬¬&#123;1&#125;åˆ—&#39;.format(row, col))</span><br><span class="line"></span><br><span class="line">wb.save(&#39;xxx.xls&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æ›´å¤šç¤ºä¾‹ï¼šhttps:&#x2F;&#x2F;github.com&#x2F;python-excel&#x2F;xlwt&#x2F;tree&#x2F;master&#x2F;examples</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>kafkaä¸“é¢˜</title>
    <url>/2020/04/20/kafka%E4%B8%93%E9%A2%98/</url>
    <content><![CDATA[<h1 id="kafkaä¸“é¢˜"><a href="#kafkaä¸“é¢˜" class="headerlink" title="kafkaä¸“é¢˜"></a>kafkaä¸“é¢˜</h1><blockquote>
<p><a href="https://www.cnblogs.com/BYRans/p/6054930.html" target="_blank" rel="noopener">Kafkaç®€ä»‹</a></p>
</blockquote>
<h2 id="æ¶ˆæ¯ç³»ç»Ÿä»‹ç»"><a href="#æ¶ˆæ¯ç³»ç»Ÿä»‹ç»" class="headerlink" title="æ¶ˆæ¯ç³»ç»Ÿä»‹ç»"></a>æ¶ˆæ¯ç³»ç»Ÿä»‹ç»</h2><p>ä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿè´Ÿè´£å°†æ•°æ®ä»ä¸€ä¸ªåº”ç”¨ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªåº”ç”¨ï¼Œåº”ç”¨åªéœ€å…³æ³¨äºæ•°æ®ï¼Œæ— éœ€å…³æ³¨æ•°æ®åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªåº”ç”¨é—´æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’åŸºäºå¯é çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåœ¨å®¢æˆ·ç«¯åº”ç”¨å’Œæ¶ˆæ¯ç³»ç»Ÿä¹‹é—´å¼‚æ­¥ä¼ é€’æ¶ˆæ¯ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼šç‚¹å¯¹ç‚¹ä¼ é€’æ¨¡å¼ã€å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚å¤§éƒ¨åˆ†çš„æ¶ˆæ¯ç³»ç»Ÿé€‰ç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚</p>
<h2 id="ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ"><a href="#ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ"></a>ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿ</h2><p>åœ¨ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯æŒä¹…åŒ–åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚æ­¤æ—¶ï¼Œå°†æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«æ¶ˆè´¹ä¸€æ¬¡ã€‚å½“ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹äº†é˜Ÿåˆ—ä¸­çš„æŸæ¡æ•°æ®ä¹‹åï¼Œè¯¥æ¡æ•°æ®åˆ™ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚è¯¥æ¨¡å¼å³ä½¿æœ‰å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹æ•°æ®ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®å¤„ç†çš„é¡ºåº.</p>
<h2 id="å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ"><a href="#å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ" class="headerlink" title="å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ"></a>å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿ</h2><p>åœ¨å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°ä¸€ä¸ªtopicä¸­ã€‚ä¸ç‚¹å¯¹ç‚¹æ¶ˆæ¯ç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªtopicï¼Œæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹è¯¥topicä¸­æ‰€æœ‰çš„æ•°æ®ï¼ŒåŒä¸€æ¡æ•°æ®å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæ•°æ®è¢«æ¶ˆè´¹åä¸ä¼šç«‹é©¬åˆ é™¤ã€‚åœ¨å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯çš„ç”Ÿäº§è€…ç§°ä¸ºå‘å¸ƒè€…ï¼Œæ¶ˆè´¹è€…ç§°ä¸ºè®¢é˜…è€…ã€‚è¯¥æ¨¡å¼çš„ç¤ºä¾‹å›¾å¦‚ä¸‹ï¼š</p>
<h2 id="Kafkaæ¦‚è¿°"><a href="#Kafkaæ¦‚è¿°" class="headerlink" title="Kafkaæ¦‚è¿°"></a>Kafkaæ¦‚è¿°</h2><p>Apache Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ”¯æ’‘æµ·é‡æ•°æ®çš„æ•°æ®ä¼ é€’ã€‚åœ¨ç¦»çº¿å’Œå®æ—¶çš„æ¶ˆæ¯å¤„ç†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒKafkaéƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚Kafkaå°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œå¹¶å¯¹æ¶ˆæ¯åˆ›å»ºäº†å¤‡ä»½ä¿è¯äº†æ•°æ®çš„å®‰å…¨ã€‚Kafkaåœ¨ä¿è¯äº†è¾ƒé«˜çš„å¤„ç†é€Ÿåº¦çš„åŒæ—¶ï¼Œåˆèƒ½ä¿è¯æ•°æ®å¤„ç†çš„ä½å»¶è¿Ÿå’Œæ•°æ®çš„é›¶ä¸¢å¤±ã€‚</p>
<p>Kafkaçš„ä¼˜åŠ¿åœ¨äºï¼š</p>
<p>å¯é æ€§ï¼šKafkaæ˜¯ä¸€ä¸ªå…·æœ‰åˆ†åŒºæœºåˆ¶ã€å‰¯æœ¬æœºåˆ¶å’Œå®¹é”™æœºåˆ¶çš„åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ<br>å¯æ‰©å±•æ€§ï¼šKafkaæ¶ˆæ¯ç³»ç»Ÿæ”¯æŒé›†ç¾¤è§„æ¨¡çš„çƒ­æ‰©å±•<br>é«˜æ€§èƒ½ï¼šKafkaåœ¨æ•°æ®å‘å¸ƒå’Œè®¢é˜…è¿‡ç¨‹ä¸­éƒ½èƒ½ä¿è¯æ•°æ®çš„é«˜ååé‡ã€‚å³ä¾¿åœ¨TBçº§æ•°æ®å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œä»ç„¶èƒ½ä¿è¯ç¨³å®šçš„æ€§èƒ½ã€‚</p>
<h2 id="Kafka-ä¸“ç”¨æœ¯è¯­"><a href="#Kafka-ä¸“ç”¨æœ¯è¯­" class="headerlink" title="Kafka ä¸“ç”¨æœ¯è¯­"></a>Kafka ä¸“ç”¨æœ¯è¯­</h2><p>ä¸€ä¸ªtopicé…ç½®äº†3ä¸ªpartitionã€‚Partition1æœ‰ä¸¤ä¸ªoffsetï¼š0å’Œ1ã€‚Partition2æœ‰4ä¸ªoffsetã€‚Partition3æœ‰1ä¸ªoffsetã€‚å‰¯æœ¬çš„idå’Œå‰¯æœ¬æ‰€åœ¨çš„æœºå™¨çš„idæ°å¥½ç›¸åŒã€‚</p>
<p>å¦‚æœä¸€ä¸ªtopicçš„å‰¯æœ¬æ•°ä¸º3ï¼Œé‚£ä¹ˆKafkaå°†åœ¨é›†ç¾¤ä¸­ä¸ºæ¯ä¸ªpartitionåˆ›å»º3ä¸ªç›¸åŒçš„å‰¯æœ¬ã€‚é›†ç¾¤ä¸­çš„æ¯ä¸ªbrokerå­˜å‚¨ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚å¤šä¸ªproducerå’Œconsumerå¯åŒæ—¶ç”Ÿäº§å’Œæ¶ˆè´¹æ•°æ®ã€‚</p>
<p>å„ä¸ªæœ¯è¯­çš„è¯¦ç»†ä»‹ç»å¦‚ä¸‹:</p>
<ul>
<li>Topicï¼šåœ¨Kafkaä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªç±»åˆ«å±æ€§æ¥åˆ’åˆ†æ•°æ®çš„æ‰€å±ç±»ï¼Œåˆ’åˆ†æ•°æ®çš„è¿™ä¸ªç±»ç§°ä¸ºtopicã€‚å¦‚æœæŠŠKafkaçœ‹åšä¸ºä¸€ä¸ªæ•°æ®åº“ï¼Œtopicå¯ä»¥ç†è§£ä¸ºæ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼Œtopicçš„åå­—å³ä¸ºè¡¨åã€‚</li>
<li>Partitionï¼štopicä¸­çš„æ•°æ®åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚æ¯ä¸ªtopicè‡³å°‘æœ‰ä¸€ä¸ªpartitionã€‚æ¯ä¸ªpartitionä¸­çš„æ•°æ®ä½¿ç”¨å¤šä¸ªsegmentæ–‡ä»¶å­˜å‚¨ã€‚partitionä¸­çš„æ•°æ®æ˜¯æœ‰åºçš„ï¼Œpartitioné—´çš„æ•°æ®ä¸¢å¤±äº†æ•°æ®çš„é¡ºåºã€‚å¦‚æœtopicæœ‰å¤šä¸ªpartitionï¼Œæ¶ˆè´¹æ•°æ®æ—¶å°±ä¸èƒ½ä¿è¯æ•°æ®çš„é¡ºåºã€‚åœ¨éœ€è¦ä¸¥æ ¼ä¿è¯æ¶ˆæ¯çš„æ¶ˆè´¹é¡ºåºçš„åœºæ™¯ä¸‹ï¼Œéœ€è¦å°†partitionæ•°ç›®è®¾ä¸º1ã€‚</li>
<li>Partition offsetï¼šæ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå½“å‰Partitionä¸‹å”¯ä¸€çš„64å­—èŠ‚çš„offsetï¼Œå®ƒæŒ‡æ˜äº†è¿™æ¡æ¶ˆæ¯çš„èµ·å§‹ä½ç½®ã€‚</li>
<li>Replicas of partitionï¼šå‰¯æœ¬æ˜¯ä¸€ä¸ªåˆ†åŒºçš„å¤‡ä»½ã€‚å‰¯æœ¬ä¸ä¼šè¢«æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå‰¯æœ¬åªç”¨äºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå³æ¶ˆè´¹è€…ä¸ä»ä¸ºfollowerçš„partitionä¸­æ¶ˆè´¹æ•°æ®ï¼Œè€Œæ˜¯ä»ä¸ºleaderçš„partitionä¸­è¯»å–æ•°æ®ã€‚</li>
<li>Brokerï¼š<ul>
<li>Kafka é›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨èŠ‚ç‚¹ç§°ä¸ºbrokerã€‚</li>
<li>brokerå­˜å‚¨topicçš„æ•°æ®ã€‚å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤æœ‰Nä¸ªbrokerï¼Œé‚£ä¹ˆæ¯ä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªpartitionã€‚</li>
<li>å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤æœ‰(N+M)ä¸ªbrokerï¼Œé‚£ä¹ˆå…¶ä¸­æœ‰Nä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªpartitionï¼Œå‰©ä¸‹çš„Mä¸ªbrokerä¸å­˜å‚¨è¯¥topicçš„partitionæ•°æ®ã€‚</li>
<li>å¦‚æœæŸtopicæœ‰Nä¸ªpartitionï¼Œé›†ç¾¤ä¸­brokeræ•°ç›®å°‘äºNä¸ªï¼Œé‚£ä¹ˆä¸€ä¸ªbrokerå­˜å‚¨è¯¥topicçš„ä¸€ä¸ªæˆ–å¤šä¸ªpartitionã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°½é‡é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™ç§æƒ…å†µå®¹æ˜“å¯¼è‡´Kafkaé›†ç¾¤æ•°æ®ä¸å‡è¡¡ã€‚</li>
</ul>
</li>
<li>Producerï¼šç”Ÿäº§è€…å³æ•°æ®çš„å‘å¸ƒè€…ï¼Œè¯¥è§’è‰²å°†æ¶ˆæ¯å‘å¸ƒåˆ°Kafkaçš„topicä¸­ã€‚brokeræ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯åï¼Œbrokerå°†è¯¥æ¶ˆæ¯è¿½åŠ åˆ°å½“å‰ç”¨äºè¿½åŠ æ•°æ®çš„segmentæ–‡ä»¶ä¸­ã€‚ç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œå­˜å‚¨åˆ°ä¸€ä¸ªpartitionä¸­ï¼Œç”Ÿäº§è€…ä¹Ÿå¯ä»¥æŒ‡å®šæ•°æ®å­˜å‚¨çš„partitionã€‚</li>
<li>Consumerï¼šæ¶ˆè´¹è€…å¯ä»¥ä»brokerä¸­è¯»å–æ•°æ®ã€‚æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªtopicä¸­çš„æ•°æ®ã€‚</li>
<li>Leaderï¼šæ¯ä¸ªpartitionæœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä½œä¸ºLeaderï¼ŒLeaderæ˜¯å½“å‰è´Ÿè´£æ•°æ®çš„è¯»å†™çš„partitionã€‚</li>
<li>Followerï¼šFollowerè·ŸéšLeaderï¼Œæ‰€æœ‰å†™è¯·æ±‚éƒ½é€šè¿‡Leaderè·¯ç”±ï¼Œæ•°æ®å˜æ›´ä¼šå¹¿æ’­ç»™æ‰€æœ‰Followerï¼ŒFollowerä¸Leaderä¿æŒæ•°æ®åŒæ­¥ã€‚å¦‚æœLeaderå¤±æ•ˆï¼Œåˆ™ä»Followerä¸­é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„Leaderã€‚å½“Followerä¸LeaderæŒ‚æ‰ã€å¡ä½æˆ–è€…åŒæ­¥å¤ªæ…¢ï¼Œleaderä¼šæŠŠè¿™ä¸ªfollowerä»â€œin sync replicasâ€ï¼ˆISRï¼‰åˆ—è¡¨ä¸­åˆ é™¤ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªFollowerã€‚</li>
</ul>
<h2 id="Kafkaæ¶æ„"><a href="#Kafkaæ¶æ„" class="headerlink" title="Kafkaæ¶æ„"></a>Kafkaæ¶æ„</h2><ul>
<li>Brokerï¼šKafkaçš„brokeræ˜¯æ— çŠ¶æ€çš„ï¼Œbrokerä½¿ç”¨Zookeeperç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ã€‚Leaderçš„é€‰ä¸¾ä¹Ÿç”±Zookeeperè´Ÿè´£ã€‚</li>
<li>Zookeeperï¼šZookeeperè´Ÿè´£ç»´æŠ¤å’Œåè°ƒbrokerã€‚å½“Kafkaç³»ç»Ÿä¸­æ–°å¢äº†brokeræˆ–è€…æŸä¸ªbrokerå‘ç”Ÿæ•…éšœå¤±æ•ˆæ—¶ï¼Œç”±ZooKeeperé€šçŸ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¾æ®Zookeeperçš„brokerçŠ¶æ€ä¿¡æ¯ä¸brokeråè°ƒæ•°æ®çš„å‘å¸ƒå’Œè®¢é˜…ä»»åŠ¡ã€‚</li>
<li>Producerï¼šç”Ÿäº§è€…å°†æ•°æ®æ¨é€åˆ°brokerä¸Šï¼Œå½“é›†ç¾¤ä¸­å‡ºç°æ–°çš„brokeræ—¶ï¼Œæ‰€æœ‰çš„ç”Ÿäº§è€…å°†ä¼šæœå¯»åˆ°è¿™ä¸ªæ–°çš„brokerï¼Œå¹¶è‡ªåŠ¨å°†æ•°æ®å‘é€åˆ°è¿™ä¸ªbrokerä¸Šã€‚</li>
<li>Consumerï¼šå› ä¸ºKafkaçš„brokeræ˜¯æ— çŠ¶æ€çš„ï¼Œæ‰€ä»¥consumerå¿…é¡»ä½¿ç”¨partition offsetæ¥è®°å½•æ¶ˆè´¹äº†å¤šå°‘æ•°æ®ã€‚å¦‚æœä¸€ä¸ªconsumeræŒ‡å®šäº†ä¸€ä¸ªtopicçš„offsetï¼Œæ„å‘³ç€è¯¥consumerå·²ç»æ¶ˆè´¹äº†è¯¥offsetä¹‹å‰çš„æ‰€æœ‰æ•°æ®ã€‚consumerå¯ä»¥é€šè¿‡æŒ‡å®šoffsetï¼Œä»topicçš„æŒ‡å®šä½ç½®å¼€å§‹æ¶ˆè´¹æ•°æ®ã€‚consumerçš„offsetå­˜å‚¨åœ¨Zookeeperä¸­ã€‚</li>
</ul>
<h2 id="Kafkaå·¥ä½œæµç¨‹"><a href="#Kafkaå·¥ä½œæµç¨‹" class="headerlink" title="Kafkaå·¥ä½œæµç¨‹"></a>Kafkaå·¥ä½œæµç¨‹</h2><p>Kafkaå°†æŸtopicçš„æ•°æ®å­˜å‚¨åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªpartitionä¸­ã€‚ä¸€ä¸ªpartitionå†…æ•°æ®æ˜¯æœ‰åºçš„ï¼Œæ¯æ¡æ•°æ®éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„indexï¼Œè¿™ä¸ªindexå«åšoffsetã€‚æ–°æ¥çš„æ•°æ®è¿½åŠ åˆ°partitionçš„å°¾éƒ¨ã€‚æ¯æ¡æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„brokerä¸Šåšå¤‡ä»½ï¼Œä»è€Œä¿è¯äº†Kafkaä½¿ç”¨çš„å¯é æ€§ã€‚</p>
<p>ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°topicä¸­ï¼Œæ¶ˆè´¹è€…å¯ä»¥é€‰æ‹©å¤šç§æ¶ˆè´¹æ–¹å¼æ¶ˆè´¹Kafkaä¸­çš„æ•°æ®ã€‚ä¸‹é¢ä»‹ç»ä¸¤ç§æ¶ˆè´¹æ–¹å¼çš„æµç¨‹ã€‚</p>
<h3 id="ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š"><a href="#ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š" class="headerlink" title="ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š"></a>ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…æ•°æ®ï¼š</h3><ul>
<li>ç”Ÿäº§è€…å°†æ•°æ®å‘é€åˆ°æŒ‡å®štopicä¸­</li>
<li>Kafkaå°†æ•°æ®ä»¥partitionçš„æ–¹å¼å­˜å‚¨åˆ°brokerä¸Šã€‚Kafkaæ”¯æŒæ•°æ®å‡è¡¡ï¼Œä¾‹å¦‚ç”Ÿäº§è€…ç”Ÿæˆäº†ä¸¤æ¡æ¶ˆæ¯ï¼Œtopicæœ‰ä¸¤ä¸ªpartitionï¼Œé‚£ä¹ˆKafkaå°†åœ¨ä¸¤ä¸ªpartitionä¸Šåˆ†åˆ«å­˜å‚¨ä¸€æ¡æ¶ˆæ¯</li>
<li>æ¶ˆè´¹è€…è®¢é˜…æŒ‡å®štopicçš„æ•°æ®</li>
<li>å½“æ¶ˆè´¹è€…è®¢é˜…topicä¸­æ¶ˆæ¯æ—¶ï¼ŒKafkaå°†å½“å‰çš„offsetå‘ç»™æ¶ˆè´¹è€…ï¼ŒåŒæ—¶å°†offsetå­˜å‚¨åˆ°Zookeeperä¸­</li>
<li>æ¶ˆè´¹è€…ä»¥ç‰¹å®šçš„é—´éš”ï¼ˆå¦‚100msï¼‰å‘Kafkaè¯·æ±‚æ•°æ®</li>
<li>å½“Kafkaæ¥æ”¶åˆ°ç”Ÿäº§è€…å‘é€çš„æ•°æ®æ—¶ï¼ŒKafkaå°†è¿™äº›æ•°æ®æ¨é€ç»™æ¶ˆè´¹è€…</li>
<li>æ¶ˆè´¹è€…å—åˆ°Kafkaæ¨é€çš„æ•°æ®ï¼Œå¹¶è¿›è¡Œå¤„ç†</li>
<li>å½“æ¶ˆè´¹è€…å¤„ç†å®Œè¯¥æ¡æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…å‘Kafka brokerå‘é€ä¸€ä¸ªè¯¥æ¶ˆæ¯å·²è¢«æ¶ˆè´¹çš„åé¦ˆ</li>
<li>å½“Kafkaæ¥åˆ°æ¶ˆè´¹è€…çš„åé¦ˆåï¼ŒKafkaæ›´æ–°offsetåŒ…æ‹¬Zookeeperä¸­çš„offsetã€‚</li>
<li>ä»¥ä¸Šè¿‡ç¨‹ä¸€ç›´é‡å¤ï¼Œç›´åˆ°æ¶ˆè´¹è€…åœæ­¢è¯·æ±‚æ•°æ®</li>
<li>æ¶ˆè´¹è€…å¯ä»¥é‡ç½®offsetï¼Œä»è€Œå¯ä»¥çµæ´»æ¶ˆè´¹å­˜å‚¨åœ¨Kafkaä¸Šçš„æ•°æ®</li>
</ul>
<h3 id="æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹"><a href="#æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹" class="headerlink" title="æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹"></a>æ¶ˆè´¹è€…ç»„æ•°æ®æ¶ˆè´¹æµç¨‹</h3><p>Kafkaæ”¯æŒæ¶ˆè´¹è€…ç»„å†…çš„å¤šä¸ªæ¶ˆè´¹è€…åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªtopicï¼Œä¸€ä¸ªæ¶ˆè´¹è€…ç»„ç”±å…·æœ‰åŒä¸€ä¸ªGroup IDçš„å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”Ÿäº§è€…å‘é€æ•°æ®åˆ°æŒ‡å®šçš„topic</li>
<li>Kafkaå°†æ•°æ®å­˜å‚¨åˆ°brokerä¸Šçš„partitionä¸­</li>
<li>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è®¢é˜…äº†ä¸€ä¸ªtopicï¼Œtopicåå­—ä¸ºâ€œtestâ€ï¼Œæ¶ˆè´¹è€…çš„Group IDä¸ºâ€œGroup1â€</li>
<li>æ­¤æ—¶Kafkaçš„å¤„ç†æ–¹å¼ä¸åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…çš„æƒ…å†µä¸€æ ·</li>
<li>å½“Kafkaæ¥æ”¶åˆ°ä¸€ä¸ªåŒæ ·Group IDä¸ºâ€œGroup1â€ã€æ¶ˆè´¹çš„topicåŒæ ·ä¸ºâ€œtestâ€çš„æ¶ˆè´¹è€…çš„è¯·æ±‚æ—¶ï¼ŒKafkaæŠŠæ•°æ®æ“ä½œæ¨¡å¼åˆ‡æ¢ä¸ºåˆ†äº«æ¨¡å¼ï¼Œæ­¤æ—¶æ•°æ®å°†åœ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ä¸Šå…±äº«ã€‚</li>
<li>å½“æ¶ˆè´¹è€…çš„æ•°ç›®è¶…è¿‡topicçš„partitionæ•°ç›®æ—¶ï¼Œåæ¥çš„æ¶ˆè´¹è€…å°†æ¶ˆè´¹ä¸åˆ°Kafkaä¸­çš„æ•°æ®ã€‚å› ä¸ºåœ¨Kafkaç»™æ¯ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹è€…è‡³å°‘åˆ†é…ä¸€ä¸ªpartitionï¼Œä¸€æ—¦partitionéƒ½è¢«æŒ‡æ´¾ç»™æ¶ˆè´¹è€…äº†ï¼Œæ–°æ¥çš„æ¶ˆè´¹è€…å°†ä¸ä¼šå†åˆ†é…partitionã€‚å³ä¸€ä¸ªpartitionåªèƒ½åˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ªpartitionã€‚</li>
</ol>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><a href="http://kafka.apache.org/" target="_blank" rel="noopener">Apache Kafka</a></p>
<h2 id="å®‰è£…zookeeperä¾èµ–"><a href="#å®‰è£…zookeeperä¾èµ–" class="headerlink" title="å®‰è£…zookeeperä¾èµ–"></a>å®‰è£…zookeeperä¾èµ–</h2><p><a href="http://zookeeper.apache.org/" target="_blank" rel="noopener">Apache ZooKeeper - Home</a><br>å¯åŠ¨kafkaå¾ˆç®€å•ï¼Œé…ç½®å¥½å‰ç½®çš„æ“ä½œåï¼Œå…ˆè¿›å…¥zookeeperçš„ç›®å½•ä¸‹ï¼Œå¯åŠ¨zookeeper,å¯ä»¥å•ç‹¬å®‰è£…,ä¹Ÿå¯ä»¥ä½¿ç”¨kafkaä¸­é›†æˆçš„zookeeper,é»˜è®¤åœ¨binç›®å½•ä¸‹æœ‰zookeeperçš„å¯åŠ¨è„šæœ¬,zookeeperå’Œkafkaçš„é…ç½®å‡åœ¨kafkaå®‰è£…åŒ…ä¸‹çš„configç›®å½•ä¸‹,ä¸‹é¢é‡‡ç”¨å•ç‹¬å®‰è£…kafkaçš„æ–¹å¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;soft&#x2F;zookeeper</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨è„šæœ¬ä½¿ç”¨æ–¹æ³•</span><br><span class="line">Usage: .&#x2F;bin&#x2F;zkServer.sh &#123;start|start-foreground|stop|restart|status|upgrade|print-cmd&#125;</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨Zookeeper</span><br><span class="line">.&#x2F;bin&#x2F;zkServer.sh  start</span><br><span class="line">&#x2F;&#x2F; å…³é—­Zookeeper</span><br><span class="line">.&#x2F;bin&#x2F;zkServer.sh  stop</span><br><span class="line">&#x2F;&#x2F; æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨</span><br><span class="line">ps -ef | grep zookeepe</span><br></pre></td></tr></table></figure>
<p>PSï¼šå› ä¸ºkafkaæ˜¯éœ€è¦æ³¨å†Œåœ¨zookeeperä¸Šé¢ï¼Œé€šè¿‡zookeeperè¿›è¡Œç®¡ç†å’Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥å¯åŠ¨kafkaä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»è¦å¯åŠ¨zookeeperã€‚</p>
<h2 id="2-kafkaå®‰è£…"><a href="#2-kafkaå®‰è£…" class="headerlink" title="2. kafkaå®‰è£…"></a>2. kafkaå®‰è£…</h2><p>éšåæˆ‘ä»¬è¿›å…¥Kafkaç›®å½•ä¸‹ï¼Œå¯åŠ¨kafkaï¼Œå…·ä½“æ“ä½œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd &#x2F;usr&#x2F;local&#x2F;kafka_2.11-1.0.0</span><br><span class="line">&#x2F;&#x2F; ä¿®æ”¹é…ç½®</span><br><span class="line">vim &#x2F;usr&#x2F;local&#x2F;kafka&#x2F;config&#x2F;server.properties  kafkaé…ç½®</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;kafka&#x2F;config&#x2F;zookeeper.properties   kafkaé›†æˆçš„zookeeperé…ç½®</span><br><span class="line">&#x2F;&#x2F; å¯åŠ¨kafka</span><br><span class="line">.&#x2F;bin&#x2F;kafka-server-start.sh -daemon .&#x2F;config&#x2F;server.properties</span><br><span class="line">&#x2F;&#x2F; æŸ¥çœ‹</span><br><span class="line">jps -lm</span><br><span class="line">11776 &#x2F;usr&#x2F;local&#x2F;cerebro-0.7.2&#x2F;lib&#x2F;cerebro.cerebro-0.7.2-launcher.jar</span><br><span class="line">1392 &#x2F;usr&#x2F;share&#x2F;jenkins&#x2F;jenkins.war --webroot&#x3D;&#x2F;var&#x2F;cache&#x2F;jenkins&#x2F;war --httpPort&#x3D;8080</span><br><span class="line">24209 sun.tools.jps.Jps -lm</span><br><span class="line">20867 com.github.ltsopensource.startup.jobtracker.JobTrackerStartup &#x2F;data&#x2F;soft&#x2F;lts&#x2F;conf&#x2F;zoo</span><br><span class="line">20755 com.github.ltsopensource.startup.admin.JettyContainer &#x2F;data&#x2F;soft&#x2F;lts</span><br><span class="line">7972 org.apache.zookeeper.server.quorum.QuorumPeerMain &#x2F;data&#x2F;soft&#x2F;zookeeper-3.3.6&#x2F;bin&#x2F;..&#x2F;conf&#x2F;zoo.cfg</span><br><span class="line">10486 kafka.Kafka ..&#x2F;config&#x2F;server.properties</span><br><span class="line">12029 com.quantifind.kafka.offsetapp.OffsetGetterWeb --zk 127.0.0.1:2181 --port 9001 --refresh 10.seconds --retain 2.days</span><br><span class="line">11471 org.elasticsearch.bootstrap.Elasticsearch</span><br><span class="line">PS: å¯ä»¥çœ‹åˆ°zookeeperå’Œkafkaéƒ½å·²ç»è¿è¡Œèµ·æ¥äº†ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯å•æœºçš„å‘½ä»¤ï¼Œé›†ç¾¤çš„å‘½ä»¤åé¢å†è®²ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“"><a href="#kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“" class="headerlink" title="kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“"></a>kafkaå¸¸ç”¨å‘½ä»¤æ€»ç»“</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. æŸ¥çœ‹topicçš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">bin&#x2F;kafka-topics.sh -zookeeper 127.0.0.1:2181 -describe -topic testKJ1</span><br><span class="line">2. ä¸ºtopicå¢åŠ å‰¯æœ¬</span><br><span class="line">bin&#x2F;kafka-reassign -partitions.sh -zookeeper 127.0.0.1:2181 -reassignment-json-file json&#x2F;partitions-to-move.json -execute</span><br><span class="line">3. åˆ›å»ºtopic</span><br><span class="line">bin&#x2F;kafka-topics.sh --create --zookeeper localhost:2181 --replication -factor1 --partitions 1 --topic testKJ1</span><br><span class="line">4. ä¸ºtopicå¢åŠ partition</span><br><span class="line">bin&#x2F;bin&#x2F;kafka-topics.sh â€“zookeeper 127.0.0.1:2181 â€“alter â€“partitions2 â€“topic testKJ1</span><br><span class="line">5. kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯å‘½ä»¤</span><br><span class="line">bin&#x2F;kafka-console-producer.sh --broker-list localhost:9092 --topic testKJ1</span><br><span class="line">6. kafkaæ¶ˆè´¹è€…å®¢æˆ·ç«¯å‘½ä»¤</span><br><span class="line">bin&#x2F;kafka-console-consumer.sh -zookeeper localhost:2181 --from-beginning --topic testKJ1</span><br><span class="line">7. kafkaæœåŠ¡å¯åŠ¨</span><br><span class="line">bin&#x2F;kafka-server-start.sh -daemon ..&#x2F;config&#x2F;server.properties</span><br><span class="line">8. ä¸‹çº¿broker</span><br><span class="line">bin&#x2F;kafka-run-class.sh kafka.admin.ShutdownBroker --zookeeper 127.0.0.1:2181 --broker #brokerId# --num.retries3--retry.interval.ms 60</span><br><span class="line">shutdownÂ broker</span><br><span class="line">9. åˆ é™¤topic,åªä¼šåˆ é™¤zookeeperä¸­çš„å…ƒæ•°æ®ï¼Œæ¶ˆæ¯æ–‡ä»¶é¡»æ‰‹åŠ¨åˆ é™¤</span><br><span class="line">bin&#x2F;kafka-run-class.sh kafka.admin.DeleteTopicCommand --topic testKJ1 --zookeeper 127.0.0.1:2181</span><br><span class="line">10. æŸ¥çœ‹topicæ¶ˆè´¹è¿›åº¦</span><br><span class="line">è¿™ä¸ªä¼šæ˜¾ç¤ºå‡ºconsumer groupçš„offsetæƒ…å†µï¼Œ å¿…é¡»å‚æ•°ä¸º--groupï¼Œ ä¸æŒ‡å®š--topicï¼Œé»˜è®¤ä¸ºæ‰€æœ‰topic</span><br><span class="line">æŸ¥çœ‹consumerç»„å†…æ¶ˆè´¹çš„offset</span><br><span class="line">bin&#x2F;kafka-run-class.sh kafka.tools.ConsumerOffsetChecker --zookeeper localhost:2181 --group test --topic testKJ1</span><br><span class="line">bin&#x2F;kafka-consumer-offset-checker.sh --zookeeper 192.168.0.201:12181 --group group1 --topic group1</span><br><span class="line">11. åˆ—å‡ºæ‰€æœ‰çš„TOPIC</span><br><span class="line">bin&#x2F;kafka-topics.sh --zookeeper 127.0.0.1:2181 --list</span><br></pre></td></tr></table></figure>
<h2 id="Connecting-to-ZooKeeper"><a href="#Connecting-to-ZooKeeper" class="headerlink" title="Connecting to ZooKeeper"></a>Connecting to ZooKeeper</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. check status</span><br><span class="line">$ bin&#x2F;zkServer.sh status</span><br><span class="line">2. connect</span><br><span class="line">$ bin&#x2F;zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯: <a href="http://zookeeper.apache.org/doc/current/zookeeperStarted.html" target="_blank" rel="noopener">ZooKeeper Getting Started Guide</a></p>
]]></content>
      <categories>
        <category>Kafka</category>
      </categories>
      <tags>
        <tag>Kafka</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨èä¸€äº›èƒ½æå¤§æé«˜ç”Ÿäº§åŠ›çš„ Python åº“
</title>
    <url>/2020/04/20/%E6%8E%A8%E8%8D%90%E4%B8%80%E4%BA%9B%E8%83%BD%E6%9E%81%E5%A4%A7%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E5%8A%9B%E7%9A%84-Python-%E5%BA%93/</url>
    <content><![CDATA[<p>ä¸€é—¨è¯­è¨€å¥½ç”¨ã€æ–¹ä¾¿çš„ç¨‹åº¦åœ¨å¾ˆå¤šæ—¶å€™ä¼šå–å†³äºè¿™é—¨è¯­è¨€ç›¸å…³çš„åº“å¤Ÿä¸å¤Ÿä¸°å¯Œï¼ŒPython ä¹‹æ‰€ä»¥ç«çˆ†é™¤äº†å…¶æœ¬èº«çš„è¯­æ³•å’Œç‰¹æ€§ä¹‹å¤–ï¼Œè¿˜åœ¨ä¸€å®šç¨‹åº¦ä¸Šå–å†³äºå…¶æœ‰å¤ªå¤šå¤ªå¤šåº“çš„æ”¯æŒï¼Œä¸è®ºæ˜¯å®˜æ–¹ç»´æŠ¤çš„è¿˜æ˜¯ç¬¬ä¸‰æ–¹å¼€å‘çš„ã€‚å°±æ¯”å¦‚è¯´åšæœºå™¨å­¦ä¹ ä¸ºä»€ä¹ˆå¾ˆå¤šäººéƒ½ç”¨ Pythonï¼Œä¸€ä¸ªéå¸¸å¤§çš„å› ç´ å°±æ˜¯ TensorFlow å’Œ PyTorch å¯¹ Python çš„æ”¯æŒã€‚å½“ç„¶åœ¨è¿™é‡Œå¹¶ä¸æ˜¯è¯´ Python çš„åº“çœŸçš„å°±å…¨çš„ä¸è¦ä¸è¦çš„ï¼Œå®ƒåœ¨æŸäº›é¢†åŸŸæˆ–è€…é¡¹ç›®çš„ç”Ÿæ€è¿˜æ˜¯æœ‰å¾…å®Œå–„çš„ã€‚</p>
<ol>
<li><p>attrsã€cattrs<br>GitHubï¼š<a href="https://github.com/python-attrs/attrsã€https://github.com/Tinche/cattrs" target="_blank" rel="noopener">https://github.com/python-attrs/attrsã€https://github.com/Tinche/cattrs</a><br>ç®€åŒ–ç±»çš„å®šä¹‰ã€åºåˆ—åŒ–ååºåˆ—åŒ–ç­‰æ“ä½œã€‚<br>ä¸ªäººå†™çš„ç®€ä»‹ï¼š<code>https://mp.weixin.qq.com/s/oHK-Y4lOeaQCFtDWgqXxFA</code></p>
</li>
<li><p>loguru<br>GitHubï¼š<a href="https://github.com/Delgan/loguru" target="_blank" rel="noopener">https://github.com/Delgan/loguru</a><br>å¯ç®€åŒ–æ—¥å¿—è®°å½•å†™æ³•ã€‚<br>ä¸ªäººå†™çš„ç®€ä»‹ï¼š<a href="https://mp.weixin.qq.com/s/5Ri1WS5cTGCNAQ0I_zYycg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/5Ri1WS5cTGCNAQ0I_zYycg</a></p>
</li>
<li><p>autopep8<br>GitHubï¼š<a href="https://github.com/hhatto/autopep8" target="_blank" rel="noopener">https://github.com/hhatto/autopep8</a><br>æŠŠ Python ä»£ç è½¬æˆç¬¦åˆ PEP8 è§„èŒƒçš„ä»£ç ã€‚</p>
</li>
<li><p>psutil<br>GitHubï¼š<a href="https://github.com/giampaolo/psutil" target="_blank" rel="noopener">https://github.com/giampaolo/psutil</a><br>Python å®ç°ä»»åŠ¡ç›‘æ§çš„åº“ã€‚</p>
</li>
<li><p>furl<br>GitHubï¼š<a href="https://github.com/gruns/furl" target="_blank" rel="noopener">https://github.com/gruns/furl</a><br>å¯¹ url çš„å¤„ç†éå¸¸æ–¹ä¾¿ï¼Œæ¯” urllib ç­‰åº“å¥½ç”¨å¤šã€‚</p>
</li>
<li><p>retryingã€tenacity<br>GitHubï¼š<a href="https://github.com/rholder/retryingã€https://github.com/jd/tenacity" target="_blank" rel="noopener">https://github.com/rholder/retryingã€https://github.com/jd/tenacity</a><br>å¼‚å¸¸é‡è¯•åº“ï¼Œå¦‚å‡ºé”™ä¹‹åé‡è¯•å¤šå°‘æ¬¡ï¼Œå°¤å…¶åœ¨å‘èµ·ä¸€äº› HTTP è¯·æ±‚æ—¶éå¸¸æœ‰ç”¨ï¼Œå½“ç„¶ä¹Ÿèƒ½ç”¨äºå…¶ä»–åœ°æ–¹ã€‚</p>
</li>
<li><p>typing<br>Docsï¼š<a href="https://docs.python.org/zh-cn/3/library/typing.html#module-typing" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3/library/typing.html#module-typing</a><br>å¯¹ Python ç±»å‹çš„æ”¯æŒï¼Œæ”¯æŒå¤šç§ç±»å‹ã€åµŒå¥—ç±»å‹ï¼Œä¹Ÿæ¨èå¤šå¤šä½¿ç”¨ Python çš„ç±»å‹æ³¨è§£ã€‚</p>
</li>
<li><p>argparse<br>Docsï¼š<a href="https://docs.python.org/zh-cn/3/library/argparse.html" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3/library/argparse.html</a></p>
</li>
</ol>
<p>ä¸ªäººæ›¾ç»ä½¿ç”¨è¿‡å‡ ä¸ªå‘½ä»¤è¡Œè§£æå·¥å…·ï¼Œå¦‚ docoptï¼Œä½†åæ¥è¿˜æ˜¯è½¬å›æ¥äº† argparseï¼ŒåŠŸèƒ½é½å…¨å¼ºå¤§ã€‚</p>
<ol start="9">
<li><p>absl-py<br>GitHubï¼š<a href="https://github.com/abseil/abseil-py" target="_blank" rel="noopener">https://github.com/abseil/abseil-py</a><br>ä¸ªäººæ„Ÿè§‰æ¯” argparse æ›´æ˜“ç”¨çš„åº“ï¼Œå¦‚ TensorFlow å°±åœ¨ä½¿ç”¨è¿™ä¸ªï¼Œå¯¹äºå®šä¹‰ä¸€äº› Flag éå¸¸æ–¹ä¾¿ã€‚</p>
</li>
<li><p>pipenv<br>GitHubï¼š<a href="https://github.com/pypa/pipenv" target="_blank" rel="noopener">https://github.com/pypa/pipenv</a><br>åŠŸèƒ½æ›´å…¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œé›†æˆè™šæ‹Ÿç¯å¢ƒã€æ”¯æŒ Lock æœºåˆ¶é”å®šå®‰è£…åŒ…ç‰ˆæœ¬å’Œä¾èµ–ä¿¡æ¯ã€‚å½“ç„¶ä¹Ÿæœ‰å‘ç‚¹ï¼Œå¯è‡ªè¡Œæœç´¢.</p>
</li>
<li><p>drf<br>Docsï¼š<a href="https://www.django-rest-framework.org/" target="_blank" rel="noopener">https://www.django-rest-framework.org/</a><br>åŸºäº Django çš„ REST Frameworkï¼Œå¿«é€Ÿå®ç° REST APIã€‚</p>
</li>
<li><p>watchdog<br>GitHubï¼š<a href="https://github.com/gorakhargosh/watchdog" target="_blank" rel="noopener">https://github.com/gorakhargosh/watchdog</a></p>
</li>
</ol>
<p>æ–¹ä¾¿ç›‘è§†æ–‡ä»¶ç³»ç»Ÿæ”¹åŠ¨ã€‚</p>
<ol start="13">
<li>glob<br>Docsï¼š<a href="https://docs.python.org/3/library/glob.html" target="_blank" rel="noopener">https://docs.python.org/3/library/glob.html</a></li>
</ol>
<p>å¯¹æ–‡ä»¶çš„æ“ä½œéå¸¸æ–¹ä¾¿ã€‚</p>
<ol start="14">
<li>2to3<br>Docsï¼š<a href="https://docs.python.org/2/library/2to3.html" target="_blank" rel="noopener">https://docs.python.org/2/library/2to3.html</a></li>
</ol>
<p>æŠŠ Python2 ä»£ç è½¬æˆ Python3 ä»£ç ã€‚</p>
<ol start="15">
<li>glom<br>GitHubï¼š<a href="https://github.com/mahmoud/glom" target="_blank" rel="noopener">https://github.com/mahmoud/glom</a></li>
</ol>
<p>å¯¹ JSON åµŒå¥—çš„å¤„ç†éå¸¸æ–¹ä¾¿ã€‚</p>
<ol start="16">
<li>pathlib<br>Docsï¼š<a href="https://docs.python.org/3/library/pathlib.html" target="_blank" rel="noopener">https://docs.python.org/3/library/pathlib.html</a></li>
</ol>
<p>æ›´ä¸ºæ–¹ä¾¿çš„ Python è·¯å¾„æ“ä½œåº“ã€‚</p>
<ol start="17">
<li>environs<br>GitHubï¼š<a href="https://github.com/sloria/environs" target="_blank" rel="noopener">https://github.com/sloria/environs</a></li>
</ol>
<p>å¯¹äºç¯å¢ƒå˜é‡çš„è·å–éå¸¸æ–¹ä¾¿ï¼Œæ”¯æŒå¤šç§ç±»å‹ï¼Œå¦‚ intã€bool ç­‰ã€‚</p>
<ol start="18">
<li>pysnooper<br>GitHubï¼š<a href="https://github.com/cool-RR/PySnooper" target="_blank" rel="noopener">https://github.com/cool-RR/PySnooper</a></li>
</ol>
<p>éå¸¸æ–¹ä¾¿ç®€å•çš„ Python è°ƒè¯•å™¨ï¼Œå¯ä»¥è¿½è¸ªåˆ°ä»£ç æ¯ä¸€å¤„ç»†èŠ‚çš„æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<ol start="19">
<li>tqdm<br>GitHubï¼š<a href="https://github.com/tqdm/tqdm" target="_blank" rel="noopener">https://github.com/tqdm/tqdm</a></li>
</ol>
<p>è¿›åº¦æ¡æ§åˆ¶æ˜¾ç¤ºéå¸¸æ–¹ä¾¿ã€‚</p>
<ol start="20">
<li>sh<br>GitHubï¼š<a href="https://github.com/amoffat/sh" target="_blank" rel="noopener">https://github.com/amoffat/sh</a></li>
</ol>
<p>å¯¹ Linux ä¸€äº›å‘½ä»¤çš„å°è£…ï¼Œç®€å•å¥½ç”¨åˆé«˜æ•ˆã€‚</p>
<ol start="21">
<li>faker<br>GitHubï¼š<a href="https://github.com/joke2k/faker" target="_blank" rel="noopener">https://github.com/joke2k/faker</a></li>
</ol>
<p>æ¨¡æ‹Ÿæ•°æ®çš„ç”Ÿæˆã€‚</p>
<p>ä¸ªäººå†™çš„ç®€ä»‹ï¼š<a href="https://mp.weixin.qq.com/s/iLjr95uqgTclxYfWWNxrAA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/iLjr95uqgTclxYfWWNxrAA</a></p>
<ol start="22">
<li>arrowã€dateutilã€dateparserã€pendulum</li>
</ol>
<ul>
<li>GitHubï¼š<a href="https://github.com/crsmithdev/arrow" target="_blank" rel="noopener">https://github.com/crsmithdev/arrow</a></li>
<li><a href="https://github.com/dateutil/dateutil" target="_blank" rel="noopener">https://github.com/dateutil/dateutil</a></li>
<li><a href="https://github.com/scrapinghub/dateparser" target="_blank" rel="noopener">https://github.com/scrapinghub/dateparser</a></li>
<li><a href="https://github.com/sdispater/pendulum" target="_blank" rel="noopener">https://github.com/sdispater/pendulum</a><br>æ—¶é—´è§£æå’Œå¤„ç†åº“ï¼Œéå¸¸æ–¹ä¾¿ã€‚arrow ç›®å‰ Star æœ€å¤šï¼Œå¥½è¯„æœ€å¤šã€‚</li>
</ul>
<ol start="23">
<li>yagmail<br>GitHubï¼š<a href="https://github.com/kootenpv/yagmail" target="_blank" rel="noopener">https://github.com/kootenpv/yagmail</a></li>
</ol>
<p>æ–¹ä¾¿çš„å‘é‚®ä»¶åº“ï¼Œæ›¿ä»£è‡ªå¸¦çš„ smtplibã€‚</p>
<ol start="24">
<li>chardet<br>GitHubï¼š<a href="https://github.com/chardet/chardet" target="_blank" rel="noopener">https://github.com/chardet/chardet</a></li>
</ol>
<p>å­—ç¬¦ä¸²ç±»å‹ç¼–ç æ£€æµ‹ã€‚</p>
<ol start="25">
<li>pypinyin<br>GitHubï¼š<a href="https://github.com/mozillazg/python-pinyin" target="_blank" rel="noopener">https://github.com/mozillazg/python-pinyin</a></li>
</ol>
<p>æ±‰å­—è½¬æ‹¼éŸ³ï¼Œåœ¨ä¸€äº›ä¸­æ–‡è½¬åŒ–å¤„ç†ä¸Šå¾ˆæœ‰ç”¨ã€‚</p>
<p>ä¸ªäººå†™çš„ç®€ä»‹ï¼š<a href="https://mp.weixin.qq.com/s/NvA3j8Ns1-6CFgWpUcWwQw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/NvA3j8Ns1-6CFgWpUcWwQw</a></p>
<ol start="26">
<li>sphinx<br>Docsï¼š<a href="https://www.sphinx-doc.org/en/master/" target="_blank" rel="noopener">https://www.sphinx-doc.org/en/master/</a></li>
</ol>
<p>ç¼–å†™æ–‡æ¡£ä½¿ç”¨ï¼Œå¤§å¤šæ•° Python åº“æ–‡æ¡£éƒ½æ˜¯è¿™ä¸ªå†™çš„ï¼Œå¦‚ Scrapyã€requestsã€‚</p>
<p>ä¸ªäºº sphinx + markdown çš„æ ·ä¾‹ï¼š<a href="https://github.com/Gerapy/Docs" target="_blank" rel="noopener">https://github.com/Gerapy/Docs</a></p>
<ol start="27">
<li>jinja2<br>GitHubï¼š<a href="https://github.com/pallets/jinja" target="_blank" rel="noopener">https://github.com/pallets/jinja</a></li>
</ol>
<p>ä¸€ä¸ªæ–¹ä¾¿çš„æ¨¡æ¿å¼•æ“ï¼Œå‘ˆç°é¡µé¢æ—¶å¾ˆæ–¹ä¾¿ã€‚</p>
<ol start="28">
<li>click<br>GitHubï¼š<a href="https://github.com/pallets/click" target="_blank" rel="noopener">https://github.com/pallets/click</a></li>
</ol>
<p>æ›´æ–¹ä¾¿çµæ´»åœ°å®ç°å‘½ä»¤è¡Œä¼ é€’å‚æ•°ã€‚</p>
<ol start="29">
<li>ray<br>GitHubï¼š<a href="https://github.com/ray-project/ray" target="_blank" rel="noopener">https://github.com/ray-project/ray</a></li>
</ol>
<p>åˆ†å¸ƒå¼å¤šè¿›ç¨‹ç®¡ç†ã€‚</p>
<ol start="30">
<li>supervisor<br>GitHubï¼š<a href="https://github.com/Supervisor/supervisor" target="_blank" rel="noopener">https://github.com/Supervisor/supervisor</a></li>
</ol>
<p>è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¦‚å®ç°å¤šä»»åŠ¡åå°è¿è¡Œï¼ŒDocker æ‰“åŒ…æ—¶ä¼šç»å¸¸ç”¨åˆ°ã€‚</p>
<ol start="31">
<li>apscheduler<br>GitHubï¼š<a href="https://github.com/agronholm/apscheduler" target="_blank" rel="noopener">https://github.com/agronholm/apscheduler</a></li>
</ol>
<p>Python å®šæ—¶ä»»åŠ¡ï¼Œä¸è¿‡ K8S ä¹Ÿå¯ä»¥å®ç°ï¼Œä¸ªäººç›®å‰å¯èƒ½æ›´å€¾å‘äº K8Sã€‚</p>
<ol start="32">
<li>intelpython<br>Homeï¼š<a href="https://software.intel.com/en-us/distribution-for-python" target="_blank" rel="noopener">https://software.intel.com/en-us/distribution-for-python</a></li>
</ol>
<p>è¿™ä¸æ˜¯ Python åº“ï¼Œæ˜¯ä¸€ä¸ª Intel å¼€å‘çš„åŸºäº Intel å¤„ç†å™¨ä¼˜åŒ–çš„ Python è§£é‡Šå™¨ï¼Œå¯¹äºå¤§è§„æ¨¡è¿ç®—æå‡å¾ˆå¤§ã€‚</p>
<p>å®Œæ¯•ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ©ç”¨P2Pè½¯ä»¶(Murder)å¤§è§„æ¨¡åˆ†å‘å¤§æ–‡ä»¶</title>
    <url>/2020/04/20/%E5%88%A9%E7%94%A8P2P%E8%BD%AF%E4%BB%B6-Murder-%E5%A4%A7%E8%A7%84%E6%A8%A1%E5%88%86%E5%8F%91%E5%A4%A7%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="åˆ©ç”¨P2Pè½¯ä»¶-Murder-å¤§è§„æ¨¡åˆ†å‘å¤§æ–‡ä»¶"><a href="#åˆ©ç”¨P2Pè½¯ä»¶-Murder-å¤§è§„æ¨¡åˆ†å‘å¤§æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨P2Pè½¯ä»¶(Murder)å¤§è§„æ¨¡åˆ†å‘å¤§æ–‡ä»¶"></a>åˆ©ç”¨P2Pè½¯ä»¶(Murder)å¤§è§„æ¨¡åˆ†å‘å¤§æ–‡ä»¶</h2><h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å½“æœåŠ¡å™¨å¤šæ—¶ï¼Œä¸ºäº†ç®¡ç†æ–¹ä¾¿å’Œæå‡æ•ˆç‡ï¼Œå°±ä¼šç”¨åˆ°è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·ï¼ˆå¦‚Ansibleï¼‰æ¥è‡ªåŠ¨éƒ¨ç½²å’Œæ‰¹é‡åˆ†å‘æ–‡ä»¶ã€‚</p>
<blockquote>
<p>åœºæ™¯æè¿°ï¼šç›®å‰æœ‰50+å°æœåŠ¡å™¨ï¼Œå·²éƒ¨ç½²Ansibleç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæ‰¹é‡åˆ†å‘æ–‡ä»¶ã€‚æ‰¹é‡åˆ†å‘æ–‡ä»¶æ—¶ï¼Œä¸€èˆ¬æŠŠæ–‡ä»¶ä¼ åˆ° Ansible æ‰€åœ¨çš„æœåŠ¡å™¨å¹¶é€šè¿‡ copyæˆ–è€…synchronize æ¨¡å—ä¼ è¾“ï¼Œæ–‡ä»¶å°äº100Mæ—¶ï¼Œåˆ†å‘æ­£å¸¸ã€‚å½“ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼ˆ100M+ï¼‰ï¼Œå—å•èŠ‚ç‚¹åŠå…¶å¸¦å®½çš„å½±å“ï¼Œæ•´ä¸ªåˆ†å‘è¿‡ç¨‹å˜å¾—éå¸¸ç¼“æ…¢ï¼Œç”šè‡³å‡ºç°Ansibleå¡æ­»ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ Ansible æ¥åˆ†å‘å°æ–‡ä»¶é€Ÿåº¦å¾ˆå¿«ï¼Œä½†å¯¹äºå¤§æ–‡ä»¶ï¼Œæ–‡ä»¶åˆ†å‘å°±æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨ä½¿ç”¨å•ä¸€åˆ†å¸ƒç‚¹å’Œå›ºå®šå‡ºå£å¸¦å®½çš„æƒ…å†µä¸‹ï¼Œç»å¸¸å­˜åœ¨å¸¦å®½æ‹¥å µã€è€—è´¹æ—¶é—´é•¿çš„é—®é¢˜ã€‚</p>
<p>å¯¹äºå¤§æ–‡ä»¶åˆ†å‘ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ BitTorrent ï¼Œåˆ©ç”¨ P2P åè®®å®ç°å¿«é€Ÿåˆ†å‘ï¼ŒèŠ‚çœå¸¦å®½ï¼Œæé«˜æ•ˆç‡ã€‚</p>
<h2 id="P2Pè½¯ä»¶ä»‹ç»"><a href="#P2Pè½¯ä»¶ä»‹ç»" class="headerlink" title="P2Pè½¯ä»¶ä»‹ç»"></a>P2Pè½¯ä»¶ä»‹ç»</h2><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Murder </p>
<p><a href="https://github.com/lg/murder" target="_blank" rel="noopener">Murder</a>æ˜¯ Twitter çš„å¼€æºé¡¹ç›®ï¼Œå¾ˆé€‚åˆå¤§æ–‡ä»¶åˆ†å‘ã€‚ï¼ˆè¯¥é¡¹ç›®è¿˜èƒ½ç”¨ï¼Œä½†å®˜æ–¹å·²ç»ä¸å†ç»§ç»­ç»´æŠ¤ï¼‰</p>
<p>é¡¹ç›®ä»‹ç»ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼šLarge scale server deploys using BitTorrent and the BitTornado library</p>
<p>æ ¹æ® Murder å¼€å‘è€…çš„åšå®¢ï¼Œå¯ä»¥çŸ¥é“è¿™ä¸ªé¡¹ç›®çš„æ¥é¾™å»è„‰ï¼š</p>
<blockquote>
<p>Twitter åœ¨æ—©æœŸä¾¿ä¾èµ– Capistrano æ¥è¿›è¡Œåº”ç”¨ç¨‹åºçš„éƒ¨ç½²ï¼Œæ¯å½“æœ‰æ–°ç‰ˆæœ¬éœ€è¦å‘å¸ƒæ—¶ï¼ŒCapistrano ä¼šæ ¹æ®é¢„è®¾å¥½çš„å„ç§è®¾ç½®å’Œæµç¨‹åˆ° Twitter æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œæ›´æ–°çš„æ“ä½œã€‚<br>åœ¨è¿‡å»æœåŠ¡å™¨è¿˜ä¸å¤šçš„æƒ…æ³ä¸‹ä¸€åˆ‡éƒ½å¾ˆç¾å¥½ï¼Œä½†éšç€ Twitter æœåŠ¡å™¨æ•°é‡çš„å¢é•¿ï¼Œåˆ°äº†å‡ ç™¾å°æœåŠ¡å™¨æ—¶ï¼Œäº‹æƒ…å·²ç»ä¸å†åƒè¿‡å»ä¸€æ ·ç¾å¥½ï¼Œç”šè‡³åˆ°åæ¥æ‹¥æœ‰æ•°åƒå°æœåŠ¡å™¨æ—¶ï¼Œæ›´æ–°çš„æ“ä½œä¼šè€—è´¹ 40 åˆ†é’Ÿã€‚<br>Twitter é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œè®¤ä¸ºé—®é¢˜çš„å…³é”®åœ¨äºï¼šä½¿ç”¨é›†ä¸­å¼çš„ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„æœåŠ¡å™¨è¦è½®æµæ’é˜Ÿåˆ°åŒä¸€å°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸Šè¿›è¡Œä»£ç æ›´æ–°ã€‚</p>
</blockquote>
<p>Twitter æœ€åˆçš„æƒ³æ³•æ˜¯å°†ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¹Ÿåšå‡ºåˆ†æ•£å¼çš„æ¶æ„ï¼ŒæœåŠ¡å™¨çš„ä»£ç æ›´æ–°å°±å¯ä»¥åˆ†æ•£åˆ°ä¸åŒçš„æœºå™¨æ¥å‹ç¼©éƒ¨ç½²æ—¶é—´ï¼Œä½†äº‹å®ä¸Šç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå³ä½¿åˆ†æ•£åœ¨å¤šå°æœåŠ¡å™¨ä¸Šï¼Œè¿™äº›æœåŠ¡å™¨è¦æ›´æ–°æ–‡ä»¶ä¹ŸåŒæ ·éœ€è¦æ—¶é—´ã€‚<br>å› æ­¤ Twitter å‘ç°æˆ–è®¸éœ€è¦ä¸€ä¸ªå®Œå…¨å»ä¸­å¿ƒåŒ–ã€æœ€å¥½æ˜¯åƒ BitTorrent è¿™æ ·çš„ï¼Œåˆ©ç”¨ P2P çš„ç‰¹ç‚¹è®©æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å¯ä»¥ååŠ©è¿›è¡Œç¨‹åºä»£ç çš„æ›´æ–°ã€‚</p>
<p>ä»ç»“æœæ¥çœ‹ï¼Œåœ¨é‡‡ç”¨äº† BitTorrent çš„æ–¹å¼æ¥æ›´æ–°ä»£ç ï¼Œéƒ¨ç½²çš„æ—¶é—´ä» 40 åˆ†é’Ÿå¤§å¹…å‡å°‘åˆ°åªè¦ 12 ç§’ï¼å®åœ¨æ˜¯éå¸¸æƒŠäººçš„æ”¹å–„ï¼Œæ•°åƒå°æœåŠ¡å™¨çš„ä»£ç æ›´æ–°å±…ç„¶åªè¦çŸ­çŸ­ 12 ç§’å°±èƒ½å®Œæˆã€‚</p>
<p>é›†ä¸­å¼æ¶æ„å’ŒMurderæ¶æ„å¯¹æ¯”:</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb17ecf2d648c399a8e681511fbeb8997?method=download&shareKey=7c1ea1579628222596f0e3e3f2d106ce" alt="image"></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB7aa1edd58d4910b55f320ba6f7c19327?method=download&shareKey=357ea31cc3b84346b9f99004fb033aef" alt="image"></p>
<h2 id="éƒ¨ç½²Murder"><a href="#éƒ¨ç½²Murder" class="headerlink" title="éƒ¨ç½²Murder"></a>éƒ¨ç½²Murder</h2><h3 id="Murder-ç»„ä»¶ä»‹ç»"><a href="#Murder-ç»„ä»¶ä»‹ç»" class="headerlink" title="Murder ç»„ä»¶ä»‹ç»"></a>Murder ç»„ä»¶ä»‹ç»</h3><p>Murder æ˜¯åŸºäº BitTornado æ¥å®ç°çš„ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç»„ä»¶ï¼š</p>
<ol>
<li>torrent tracker: tracker ä½¿ç”¨ murder_tracker.py è¿è¡Œï¼Œtracker å®é™…ä¸Šæ˜¯è¿è¡Œä¸­ä¸€å°æœåŠ¡å™¨ä¸Šçš„å•ä¸ªæœåŠ¡ï¼Œå…¶ä»–ä»»ä½•æˆå‘˜éƒ½è¦ä¾èµ–å®ƒã€‚Murderä¸ºäº†ä¿æŒç®€å•ï¼Œå¹¶æ²¡æœ‰å®ç°tracker-less distributionï¼ˆDHTï¼‰åŠŸèƒ½ã€‚tracker å®é™…ä¸Šæ˜¯ä¸ªè¿·ä½ çš„ httpd æœåŠ¡ï¼Œå­˜æ”¾ç€BitTorrentå®¢æˆ·ç«¯éœ€è¦æ›´æ–°çŠ¶æ€çš„è·¯å¾„ã€‚</li>
<li>seeder ï¼šsender æ˜¯å­˜æ”¾è¦åˆ†å‘åˆ°å…¶ä»–ä¸»æœºçš„æ–‡ä»¶çš„æœåŠ¡å™¨ã€‚è¿™äº›æ–‡ä»¶å­˜æ”¾åœ¨ seeder çš„ä¸€ä¸ªç›®å½•ä¸­ï¼ŒMurder ä¼šå°†è¿™ä¸ªç›®å½•æ‰“åŒ…æˆ tgz æ ¼å¼å¹¶åˆ›å»ºä¸€ä¸ª .torrent æ–‡ä»¶ï¼ˆéå¸¸å°çš„æ–‡ä»¶ï¼ŒåŒ…å«æœ‰å…³è¿™ä¸ªtgzæ–‡ä»¶çš„åŸºæœ¬hashä¿¡æ¯ï¼‰ã€‚è¿™ä¸ª .torrent æ–‡ä»¶è®©å„ä¸ª peer èŠ‚ç‚¹çŸ¥é“ä»–ä»¬ä¸‹è½½çš„æ˜¯ä»€ä¹ˆæ–‡ä»¶ã€‚åŒæ—¶ï¼Œtracker ä¼šä¿æŒè·Ÿè¸ªæœ‰å“ªäº› .torrent æ–‡ä»¶æ­£åœ¨è¢«åˆ†å‘ã€‚ä¸€æ—¦ Murder å¼€å§‹ä¼ è¾“æ–‡ä»¶ï¼Œseeder æœåŠ¡å™¨å°†æ˜¯å„ä¸ª peer èŠ‚ç‚¹è·å–ç§å­çš„åœ°æ–¹ã€‚</li>
<li>peers ï¼špeer æ˜¯æˆç™¾ä¸Šåƒéœ€è¦æ¥æ”¶æ–‡ä»¶çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’ä¼ è¾“æ–‡ä»¶ï¼ˆä¸‹è½½ã€ä¸Šä¼ ï¼‰ã€‚ä¸€æ—¦ä¸€ä¸ªpeerèŠ‚ç‚¹ä¸‹è½½å®Œæ•´ä¸ª tgz æ–‡ä»¶ï¼Œè¿˜å°†ç»§ç»­ seeding ä¸€æ®µæ—¶é—´ï¼Œé˜²æ­¢èœœç½æ•ˆåº”ã€‚</li>
</ol>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>åœ¨ tracker æœåŠ¡å™¨ä¸‹è½½å¹¶å®‰è£… Murderï¼Œå†™æˆè„šæœ¬è¿è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">cd &#x2F;usr&#x2F;local&#x2F;src</span><br><span class="line">wget https:&#x2F;&#x2F;codeload.github.com&#x2F;lg&#x2F;murder&#x2F;zip&#x2F;master</span><br><span class="line">mv master murder.zip</span><br><span class="line">unzip murder.zip</span><br><span class="line">mv murder-master &#x2F;usr&#x2F;local&#x2F;murder</span><br></pre></td></tr></table></figure>
<p>é…ç½®å¥½ ansible æœåŠ¡ï¼Œè¿é€šå„ä¸ª peer èŠ‚ç‚¹ã€‚</p>
<p>é€šè¿‡ ansible å°†trackeræœåŠ¡å™¨ä¸‹çš„ master.zip åˆ†å‘åˆ°å„ä¸ª peer èŠ‚ç‚¹çš„å®¶ç›®å½•ä¸‹ï¼Œå¹¶è§£å‹å®‰è£… Murder ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m copy -a &quot;src&#x3D;&#x2F;usr&#x2F;local&#x2F;src&#x2F;murder.zip dest&#x3D;~&quot;</span><br><span class="line"># ansible all -m shell -a &quot;unzip murder.zip ; mv murder-master murder&quot;</span><br></pre></td></tr></table></figure>
<p>å„ä¸ªèŠ‚ç‚¹ipå’Œç¯å¢ƒè¯´æ˜ï¼š</p>
<ul>
<li>tracker : 192.168.1.100</li>
<li>seeder : 192.168.1.100</li>
<li>peers : 192.168.1.101-111</li>
<li>æœåŠ¡å™¨éƒ½åœ¨åŒä¸€ä¸ªæœºæˆ¿</li>
<li>éƒ½æ˜¯ CentOS 6.5 ç³»ç»Ÿ</li>
</ul>
<h2 id="å¯åŠ¨-tracker-æœåŠ¡"><a href="#å¯åŠ¨-tracker-æœåŠ¡" class="headerlink" title="å¯åŠ¨ tracker æœåŠ¡"></a>å¯åŠ¨ tracker æœåŠ¡</h2><p>åœ¨ Tracker æœåŠ¡å™¨ï¼Œå¯åŠ¨ tracker æœåŠ¡ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># python &#x2F;usr&#x2F;local&#x2F;murder&#x2F;dist&#x2F;murder_tracker.py &gt; &#x2F;var&#x2F;log&#x2F;murder_tracker.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç«¯å£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># netstat -tnlp|grep 8998</span><br></pre></td></tr></table></figure>
<p>å®æ—¶æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># tailf &#x2F;var&#x2F;log&#x2F;murder_tracker.log</span><br></pre></td></tr></table></figure>
<p>é…ç½®é˜²ç«å¢™ï¼ˆå¦‚æœé˜²ç«å¢™æ˜¯å…³é—­çš„ï¼Œåˆ™ä¸ç”¨æ­¤æ“ä½œï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># iptables -I INPUT -s 192.168.100.0&#x2F;24 -p tcp --dport 8998 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>murder_tracker.py å®é™…ä¸Šæ˜¯è°ƒç”¨ BitTornado/BT1/track.py è¿™ä¸ªæ–‡ä»¶ã€‚ track.py æœ‰å¾ˆå¤šå‚æ•°ï¼Œå¦‚æœéœ€è¦æ·»åŠ å‚æ•°ï¼Œå¯ä»¥ä¿®æ”¹ murder_tracker.pyã€‚</p>
<p>å‡ ä¸ªé‡è¦å‚æ•°ï¼š</p>
<ul>
<li>port ï¼štracker ç›‘å¬çš„ç«¯å£ï¼Œé»˜è®¤ 8998</li>
<li>dfile ï¼šå­˜å‚¨è¿‘æœŸä¸‹è½½ä¿¡æ¯çš„æ–‡ä»¶</li>
<li>logfile ï¼štracker æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯æ ‡å‡†è¾“å‡º</li>
</ul>
<h2 id="åœ¨-seeder-æœåŠ¡å™¨ä¸Šå‡†å¤‡è¦åˆ†å‘çš„æ–‡ä»¶å¹¶åˆ›å»ºç§å­"><a href="#åœ¨-seeder-æœåŠ¡å™¨ä¸Šå‡†å¤‡è¦åˆ†å‘çš„æ–‡ä»¶å¹¶åˆ›å»ºç§å­" class="headerlink" title="åœ¨ seeder æœåŠ¡å™¨ä¸Šå‡†å¤‡è¦åˆ†å‘çš„æ–‡ä»¶å¹¶åˆ›å»ºç§å­"></a>åœ¨ seeder æœåŠ¡å™¨ä¸Šå‡†å¤‡è¦åˆ†å‘çš„æ–‡ä»¶å¹¶åˆ›å»ºç§å­</h2><p>è¿™é‡Œå°† seeder å’Œ tracker æœåŠ¡ æ”¾åœ¨åŒä¸€å°æœåŠ¡å™¨ã€‚<br>å‡†å¤‡åˆ†å‘æ–‡ä»¶ï¼Œå¹¶æ”¾åœ¨ /home/data/murder/ ç›®å½•ä¸‹ã€‚</p>
<p>ç”Ÿæˆç§å­æ–‡ä»¶çš„è„šæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># å®šä¹‰å˜é‡</span><br><span class="line">deploy_file&#x3D;&#x2F;home&#x2F;data&#x2F;murder&#x2F;deploy.test.tar.gz</span><br><span class="line"># å› æ‰€æœ‰peerèŠ‚ç‚¹å·²ç»æ‰“é€šå†…ç½‘ï¼Œè¿™é‡Œç”¨seederæœåŠ¡å™¨çš„å†…ç½‘åœ°å€</span><br><span class="line">Seeder_IP&#x3D;192.168.1.100</span><br><span class="line">make_torrent_command&#x3D;&#x2F;usr&#x2F;local&#x2F;murder&#x2F;dist&#x2F;murder_make_torrent.py</span><br><span class="line"># ç”Ÿæˆç§å­</span><br><span class="line">python $&#123;make_torrent_command&#125; $&#123;deploy_file&#125; $&#123;Seeder_IP&#125;:8998 $&#123;deploy_file&#125;.torrent</span><br></pre></td></tr></table></figure>

<h2 id="åˆ†å‘ç§å­æ–‡ä»¶ç»™æ‰€æœ‰çš„peerèŠ‚ç‚¹"><a href="#åˆ†å‘ç§å­æ–‡ä»¶ç»™æ‰€æœ‰çš„peerèŠ‚ç‚¹" class="headerlink" title="åˆ†å‘ç§å­æ–‡ä»¶ç»™æ‰€æœ‰çš„peerèŠ‚ç‚¹"></a>åˆ†å‘ç§å­æ–‡ä»¶ç»™æ‰€æœ‰çš„peerèŠ‚ç‚¹</h2><p>åˆ©ç”¨ ansible åˆ†å‘seederæœåŠ¡å™¨ä¸Šçš„ç§å­æ–‡ä»¶ç»™æ‰€æœ‰çš„ peer èŠ‚ç‚¹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m synchronize -a &quot;src&#x3D;&#x2F;home&#x2F;data&#x2F;murder&#x2F;deploy.test.tar.gz.torrent dest&#x3D;~&quot;</span><br></pre></td></tr></table></figure>
<h2 id="å¯åŠ¨-seeder-æœåŠ¡"><a href="#å¯åŠ¨-seeder-æœåŠ¡" class="headerlink" title="å¯åŠ¨ seeder æœåŠ¡"></a>å¯åŠ¨ seeder æœåŠ¡</h2><p>å¯åŠ¨ seeder æœåŠ¡çš„è„šæœ¬ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># å®šä¹‰å˜é‡</span><br><span class="line">deploy_file&#x3D;&#x2F;home&#x2F;data&#x2F;murder&#x2F;deploy.test.tar.gz</span><br><span class="line">start_ip&#x3D;192.168.1.100</span><br><span class="line">make_torrent_command&#x3D;&#x2F;usr&#x2F;local&#x2F;murder&#x2F;dist&#x2F;murder_client.py</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨ seederï¼Œæ”¾åˆ°åå°è¿è¡Œ</span><br><span class="line">python $&#123;make_torrent_command&#125; seed $&#123;deploy_file&#125;.torrent $&#123;deploy_file&#125; $&#123;start_ip&#125; &amp;</span><br></pre></td></tr></table></figure>
<p>è¦ç¡®ä¿ seeder æœåŠ¡åœ¨å¯åŠ¨çŠ¶æ€ï¼Œå¦åˆ™ peer èŠ‚ç‚¹ä¸‹è½½æ—¶è¿æ¥ä¸åˆ°ã€‚</p>
<p>åœ¨å„ä¸ªpeerèŠ‚ç‚¹æ‰§è¡Œä¸‹è½½ä»»åŠ¡<br>ç¼–å†™ä¸‹è½½è„šæœ¬ peer_download.sh ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># ç”¨äºå„ä¸ª peer èŠ‚ç‚¹æ ¹æ®ç§å­æ–‡ä»¶ä¿¡æ¯ï¼Œæ‰§è¡Œä¸‹è½½ä»»åŠ¡</span><br><span class="line"># å®šä¹‰å˜é‡</span><br><span class="line">torrent_file&#x3D;~&#x2F;deploy.test.tar.gz.torrent</span><br><span class="line">download_file&#x3D;~&#x2F;download&#x2F;deploy.test.tar.gz</span><br><span class="line"># è¿™é‡Œè·å–å„ä¸ª peer èŠ‚ç‚¹è‡ªå·±çš„å†…ç½‘IP</span><br><span class="line">local_ip&#x3D;$(hostname -I|awk &#39;&#123;print $2&#125;&#39;)</span><br><span class="line">murder_client_bin&#x3D;~&#x2F;murder&#x2F;dist&#x2F;murder_client.py</span><br><span class="line"># åœ¨å„ä¸ª peer èŠ‚ç‚¹æ‰§è¡Œ P2P ä¸‹è½½å‘½ä»¤</span><br><span class="line">python  $murder_client_bin peer $torrent_file $download_file $local_ip</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ansibleè¿œç¨‹æ“æ§ï¼Œåœ¨æ¯ä¸ªpeerèŠ‚ç‚¹éƒ½æ‰§è¡Œä¸‹è½½è„šæœ¬ã€‚ä½¿ç”¨ansibleçš„ script æ¨¡å—ï¼Œåœ¨æœ¬åœ°å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶ååœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ansible all -m script -a &quot;peer_download.sh&quot;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½é€Ÿåº¦åˆ†æ"><a href="#ä¸‹è½½é€Ÿåº¦åˆ†æ" class="headerlink" title="ä¸‹è½½é€Ÿåº¦åˆ†æ"></a>ä¸‹è½½é€Ÿåº¦åˆ†æ</h2><p>Murder é»˜è®¤æ˜¯æœåŠ¡å™¨éƒ½å­˜äºä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„å½¼æ­¤ç›¸äº’ä¿¡ä»»çš„å†…ç½‘ï¼Œå¹¶ä¸”æ¯å°æœåŠ¡å™¨éƒ½æ˜¯å…³é—­é˜²ç«å¢™çš„ã€‚</p>
<p>Murder å°è£…çš„æ˜¯ BitTornadoï¼Œåœ¨ BitTornado/download_bt1.py ä»£ç ä¸­é»˜è®¤æ˜¯å¯åŠ¨ä¸€ä¸ª 10000-60000 èŒƒå›´çš„éšæœºç«¯å£ï¼Œæ¯ä¸ª peer åœ¨ä¸‹è½½çš„åŒæ—¶å‘å…¶ä»– peer æä¾›ä¸‹è½½æœåŠ¡ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªéšæœºç«¯å£ã€‚</p>
<p>å¯¹äºç«¯å£çš„é…ç½®ï¼ŒæŠŠé˜²ç«å¢™å…³äº†å½“ç„¶å¥½ï¼Œå½“ç„¶ä¸ºäº†å®‰å…¨ï¼Œè¿˜æ˜¯å¼€æ”¾ç«¯å£æ›´å¥½ã€‚ç„¶è€Œå¼€æ”¾è¿™ä¸ªå¤§çš„ç«¯å£èŒƒå›´ï¼Œè‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œè¿™é‡Œé€‰æ‹©å¼€æ”¾ 10000-10500 500ä¸ªç«¯å£ï¼Œåªå…è®¸å†…ç½‘IPè®¿é—®ã€‚</p>
<p>åœ¨å„ä¸ª peer èŠ‚ç‚¹ä¸­é…ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># iptables -I INPUT -s 192.168.1.0&#x2F;24 -p tcp --dport 10000:10500 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”åœ¨ dist/BitTornado/download_bt1.py ä¸­ä¿®æ”¹ä»£ç çš„ç«¯å£èŒƒå›´ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&#39;minport&#39;, 10000, &#39;minimum port to listen on, counts up if unavailable&#39;),</span><br><span class="line">(&#39;maxport&#39;, 10500, &#39;maximum port to listen on&#39;),</span><br><span class="line">(&#39;random_port&#39;, 1, &#39;whether to choose randomly inside the port range &#39; + &#39;instead of counting up linearly&#39;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸€æ­¥æœ€å¥½åœ¨æŠŠMurderä»£ç åˆ†å‘åˆ°å„ä¸ªpeerèŠ‚ç‚¹å‰åšï¼Œå¦‚æœå·²ç»åšäº†ï¼Œåªèƒ½é‡æ–°åˆ†å‘è¦†ç›–äº†ã€‚</p>
</blockquote>
<p>åˆ†å‘æµ‹è¯•çš„æœºå™¨æœ‰11å°ï¼Œéƒ½æ˜¯å†…ç½‘IPï¼Œåƒå…†è·¯ç”±å™¨ï¼Œä½†é˜²ç«å¢™å¼€å¯ï¼Œæµ‹è¯•æ–‡ä»¶æœ‰ 560 M å¤§å°ã€‚</p>
<ul>
<li>ç¬¬ä¸€æ¬¡åˆ†å‘ï¼šæ²¡æœ‰é…å¥½é˜²ç«å¢™ï¼Œç”¨æ—¶ 5m åˆ†å‘å®Œæˆã€‚</li>
<li>ç¬¬äºŒæ¬¡åˆ†å‘ï¼šé…å¥½äº†é˜²ç«å¢™ï¼Œç”¨æ—¶ 2m30s åˆ†å‘å®Œæˆã€‚</li>
<li>ç¬¬ä¸‰æ¬¡åˆ†å‘ï¼šä¸ç”¨Murderï¼Œç”¨ ansible ç›´æ¥åˆ†å‘ï¼Œç”¨æ—¶ 36s åˆ†å‘å®Œæˆã€‚<br>è¿™é‡Œæµ‹è¯•çš„æœåŠ¡å™¨è¿˜æ˜¯å¤ªå°‘ï¼ŒæœåŠ¡å™¨è¶Šå¤šæ—¶ï¼ŒP2Pæ–¹å¼åˆ†å‘æ–‡ä»¶é€Ÿåº¦è¶Šå¿«ã€‚æœåŠ¡å™¨ä¸è¶…è¿‡50+æ—¶ï¼Œè¿˜æ˜¯ç”¨ ansible ç›´æ¥åˆ†å‘æ›´å¿«ã€‚</li>
</ul>
<p>æ–‡ä»¶éƒ½ä¸‹è½½å®Œåï¼Œå…³é—­ seeder æœåŠ¡å™¨è¿›ç¨‹<br>kill æ‰ seeder çš„è¿›ç¨‹PIDï¼Œé¿å…å®ƒä¸€ç›´åšç§å­å’Œæå‡å®‰å…¨æ€§ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pgrep -f seed|xargs kill -9</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://blog.51cto.com/john88wang/1793080" target="_blank" rel="noopener">ç»“åˆP2Pè½¯ä»¶ä½¿ç”¨Ansibleåˆ†å‘å¤§æ–‡ä»¶</a><br><a href="http://jaminzhang.github.io/p2p/use-Murder-to-distribute-big-software-package-in-production-environment/" target="_blank" rel="noopener">Murder åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆ†å‘å¤§è½¯ä»¶åŒ…çš„åº”ç”¨</a><br><a href="https://wuyanteng.github.io/2017/10/12/%E5%9C%A8%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%ADP2P%E5%88%86%E5%8F%91%E5%A4%A7%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%9A%84%E5%BA%94%E7%94%A8-Murder/" target="_blank" rel="noopener">åœ¨ç”Ÿäº§ç¯å¢ƒä¸­-P2Påˆ†å‘å¤§è½¯ä»¶åŒ…çš„åº”ç”¨-Murder</a>  </p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>open-falcon æ»´æ»´å¼€æºç‰ˆæœ¬</title>
    <url>/2020/04/20/open-falcon-%E6%BB%B4%E6%BB%B4%E5%BC%80%E6%BA%90%E7%89%88%E6%9C%AC/</url>
    <content><![CDATA[<h2 id="Nightingale"><a href="#Nightingale" class="headerlink" title="Nightingale"></a>Nightingale</h2><blockquote>
<p>open falcon å¼€æºç‰ˆæœ¬æ»´æ»´å®ç°<br><a href="https://n9e.didiyun.com/docs/" target="_blank" rel="noopener">https://n9e.didiyun.com/docs/</a></p>
</blockquote>
]]></content>
      <categories>
        <category>DevOps</category>
        <category>open-falcon</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
        <tag>open-falcon</tag>
      </tags>
  </entry>
  <entry>
    <title>ç”Ÿäº§é…ç½®ç¤ºä¾‹</title>
    <url>/2020/04/20/%E7%94%9F%E4%BA%A7%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h2 id="ç”Ÿäº§é…ç½®ç¤ºä¾‹"><a href="#ç”Ÿäº§é…ç½®ç¤ºä¾‹" class="headerlink" title="ç”Ÿäº§é…ç½®ç¤ºä¾‹"></a>ç”Ÿäº§é…ç½®ç¤ºä¾‹</h2><h4 id="1-nginx-conf"><a href="#1-nginx-conf" class="headerlink" title="1. nginx.conf"></a>1. nginx.conf</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">user  www-data;</span><br><span class="line"></span><br><span class="line">worker_processes  auto;</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line">error_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log warn;</span><br><span class="line">pid        &#x2F;var&#x2F;run&#x2F;nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  4096;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">    default_type  application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#39;$http_x_forwarded_for - $remote_addr - $remote_user &#39;</span><br><span class="line">    #                  &#39;[$time_local] &quot;$request&quot; $status $body_bytes_sent &#39;</span><br><span class="line">    #                  &#39;&quot;$http_referer&quot; &quot;$http_user_agent&quot;&#39;</span><br><span class="line">    #                  &#39;&quot;$http_x_forwarded_for&quot; $request_time&#39;;</span><br><span class="line"></span><br><span class="line">    #access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;</span><br><span class="line">    ## LOG ##</span><br><span class="line">    log_format  main  &#39;$upstream_response_time $remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span><br><span class="line">                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span><br><span class="line">                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &quot;$request_time&quot;&#39;;</span><br><span class="line"></span><br><span class="line">    log_format json &#39;&#123;&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,&#39;</span><br><span class="line">                     &#39;&quot;department&quot;:&quot;devops&quot;,&#39;</span><br><span class="line">                     &#39;&quot;type&quot;:&quot;prod_america_nginx&quot;,&#39;</span><br><span class="line">                     &#39;&quot;@version&quot;:&quot;1&quot;,&#39;</span><br><span class="line">                     &#39;&quot;host&quot;:&quot;$server_addr&quot;,&#39;</span><br><span class="line">                     &#39;&quot;client&quot;:&quot;$remote_addr&quot;,&#39;</span><br><span class="line">                     &#39;&quot;real-client&quot;:&quot;$http_x_forwarded_for&quot;,&#39;</span><br><span class="line">                     &#39;&quot;auth_user&quot;:&quot;$remote_user&quot;,&#39;</span><br><span class="line">                     &#39;&quot;request&quot;:&quot;$request&quot;,&#39;</span><br><span class="line">                     &#39;&quot;method&quot;:&quot;$request_method&quot;,&#39;</span><br><span class="line">                     &#39;&quot;port&quot;:&quot;$server_port&quot;,&#39;</span><br><span class="line">                     &#39;&quot;size&quot;:$body_bytes_sent,&#39;</span><br><span class="line">                     &#39;&quot;responsetime&quot;:$request_time,&#39;</span><br><span class="line">                     &#39;&quot;domain&quot;:&quot;$host&quot;,&#39;</span><br><span class="line">                     &#39;&quot;UserAgent&quot;:&quot;$http_user_agent&quot;,&#39;</span><br><span class="line">                     &#39;&quot;url&quot;:&quot;$uri&quot;,&#39;</span><br><span class="line">                     &#39;&quot;status&quot;:&quot;$status&quot;&#125;&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;!--log_format logstash_json &#39;&#123; &quot;@timestamp&quot;: &quot;$time_iso8601&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;remote_addr&quot;: &quot;$remote_addr&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;referer&quot;: &quot;$http_referer&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;request&quot;: &quot;$request&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;status&quot;: $status, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;bytes&quot;:$body_bytes_sent, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;agent&quot;: &quot;$http_user_agent&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;x_forwarded&quot;: &quot;$http_x_forwarded_for&quot;, &#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;upstr_addr&quot;: &quot;$upstream_addr&quot;,&#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;upstr_host&quot;: &quot;$upstream_http_host&quot;,&#39;--&gt;</span><br><span class="line">        &lt;!--&#39;&quot;ups_resp_time&quot;: &quot;$upstream_response_time&quot; &#125;&#39;;--&gt;</span><br><span class="line"></span><br><span class="line">    access_log   &#x2F;data&#x2F;logs&#x2F;nginx&#x2F;access_json.log   json;</span><br><span class="line">    error_log    &#x2F;data&#x2F;logs&#x2F;nginx&#x2F;error.log   warn;</span><br><span class="line"></span><br><span class="line">    ssi on;</span><br><span class="line">    ssi_silent_errors off;</span><br><span class="line"></span><br><span class="line">    server_tokens   off;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    tcp_nopush      on;</span><br><span class="line">    tcp_nodelay     on;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 8M;</span><br><span class="line">    client_body_buffer_size 128k;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_min_length 10k;</span><br><span class="line">    gzip_comp_level 3;</span><br><span class="line">    gzip_types text&#x2F;plain text&#x2F;css application&#x2F;javascript application&#x2F;json</span><br><span class="line">               application&#x2F;xml application&#x2F;xhtml+xml text&#x2F;csv;</span><br><span class="line"></span><br><span class="line">    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-redirect-all-to-https-conf"><a href="#2-redirect-all-to-https-conf" class="headerlink" title="2. redirect-all-to-https.conf"></a>2. redirect-all-to-https.conf</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80  default_server;</span><br><span class="line">    listen 443 default_server;</span><br><span class="line">    server_name _;</span><br><span class="line"></span><br><span class="line">    access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;redirect-all-to-https.access.log main;</span><br><span class="line">    error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;redirect-all-to-https.error.log warn;</span><br><span class="line"></span><br><span class="line">    return 302 https:&#x2F;&#x2F;$host$request_uri;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-upstream"><a href="#3-upstream" class="headerlink" title="3. upstream"></a>3. upstream</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">####################</span><br><span class="line">#  æ•°æ®æŒ–æ˜</span><br><span class="line">####################</span><br><span class="line">upstream wecash_mining_apis &#123;</span><br><span class="line">    server 10.40.58.116:8080 max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">&#125;</span><br><span class="line">upstream wecash_mining_router &#123;</span><br><span class="line">    server 10.40.58.114:8080 max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">&#125;</span><br><span class="line">upstream wecash_restful_apis &#123;</span><br><span class="line">    server 10.40.58.115:8081 max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">    server 10.40.61.93:8081  max_fails&#x3D;2 fail_timeout&#x3D;30s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-Serveræ®µ"><a href="#4-Serveræ®µ" class="headerlink" title="4. Serveræ®µ"></a>4. Serveræ®µ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       8081;</span><br><span class="line">    server_name  10.40.61.75;</span><br><span class="line">    aio threads&#x3D;default;</span><br><span class="line">    client_max_body_size    2048m;</span><br><span class="line">    access_log  logs&#x2F;wecash_mining.access.log main;</span><br><span class="line">    error_log  logs&#x2F;wecash_mining.error.log  error;</span><br><span class="line">    location ~ ^&#x2F;v1&#x2F;(sms|employer) &#123;</span><br><span class="line">       proxy_next_upstream error timeout http_503 http_502 http_504;</span><br><span class="line">       proxy_pass http:&#x2F;&#x2F;wecash_mining_apis;</span><br><span class="line">       proxy_set_header X-Forwarded-For $http_x_forwarded_for;</span><br><span class="line">       proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">       proxy_set_header Host $http_host;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ ^&#x2F;api&#x2F;v1&#x2F;dispatch &#123;</span><br><span class="line">        proxy_next_upstream error timeout http_503 http_502 http_504;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;wecash_mining_router;</span><br><span class="line">        proxy_set_header X-Forwarded-For $http_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ ^&#x2F;api&#x2F;v1&#x2F;(phone_book|segmentation|apply_info|lastest_company|fund|credit_report|social_security|simple_operator|phone_tag) &#123;</span><br><span class="line">        proxy_next_upstream error timeout http_503 http_502 http_504;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;wecash_restful_apis;</span><br><span class="line">        proxy_set_header X-Forwarded-For $http_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header Host $http_host;</span><br><span class="line">    &#125;</span><br><span class="line">    error_page   500 502 503 504  &#x2F;50x.html;</span><br><span class="line">    location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">        root   html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼å¤§å…¨</title>
    <url>/2020/04/20/%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%A4%A7%E5%85%A8/</url>
    <content><![CDATA[<h3 id="ä¸€-æ ¡éªŒæ•°å­—çš„è¡¨è¾¾å¼"><a href="#ä¸€-æ ¡éªŒæ•°å­—çš„è¡¨è¾¾å¼" class="headerlink" title="ä¸€. æ ¡éªŒæ•°å­—çš„è¡¨è¾¾å¼"></a>ä¸€. æ ¡éªŒæ•°å­—çš„è¡¨è¾¾å¼</h3><ol>
<li><p>æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[0-9\]*$</span><br></pre></td></tr></table></figure>
</li>
<li><p>nä½çš„æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d&#123;n&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>è‡³å°‘nä½çš„æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d&#123;n,&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>m-nä½çš„æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d&#123;m,n&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>é›¶å’Œéé›¶å¼€å¤´çš„æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(0|\[1-9\]\[0-9\]*)$</span><br></pre></td></tr></table></figure></li>
<li><p>éé›¶å¼€å¤´çš„æœ€å¤šå¸¦ä¸¤ä½å°æ•°çš„æ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\[1-9\]\[0-9\]*)+(.\[0-9\]&#123;1,2&#125;)?$</span><br></pre></td></tr></table></figure></li>
<li><p>å¸¦1-2ä½å°æ•°çš„æ­£æ•°æˆ–è´Ÿæ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\\-)?\\d+(\\.\\d&#123;1,2&#125;)?$</span><br></pre></td></tr></table></figure></li>
<li><p>æ­£æ•°ã€è´Ÿæ•°ã€å’Œå°æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\\-|\\+)?\\d+(\\.\\d+)?$</span><br></pre></td></tr></table></figure></li>
<li><p>æœ‰ä¸¤ä½å°æ•°çš„æ­£å®æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[0-9\]+(.\[0-9\]&#123;2&#125;)?$</span><br></pre></td></tr></table></figure></li>
<li><p>æœ‰1~3ä½å°æ•°çš„æ­£å®æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[0-9\]+(.\[0-9\]&#123;1,3&#125;)?$</span><br></pre></td></tr></table></figure></li>
<li><p>éé›¶çš„æ­£æ•´æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[1-9\]\\d*$ æˆ– ^(\[1-9\]\[0-9\]*)&#123;1,3&#125;$ æˆ– ^\\+?\[1-9\]\[0-9\]*$</span><br></pre></td></tr></table></figure></li>
<li><p>éé›¶çš„è´Ÿæ•´æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\-\[1-9\]\[\]0-9&quot;*$ æˆ– ^-\[1-9\]\\d*$</span><br></pre></td></tr></table></figure></li>
<li><p>éè´Ÿæ•´æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d+$ æˆ– ^\[1-9\]\\d*|0$</span><br></pre></td></tr></table></figure></li>
<li><p>éæ­£æ•´æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^-\[1-9\]\\d*|0$ æˆ– ^((-\\d+)|(0+))$</span><br></pre></td></tr></table></figure></li>
<li><p>éè´Ÿæµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d+(\\.\\d+)?$ æˆ– ^\[1-9\]\\d*\\.\\d*|0\\.\\d*\[1-9\]\\d*|0?\\.0+|0$</span><br></pre></td></tr></table></figure></li>
<li><p>éæ­£æµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$ æˆ– ^(-(\[1-9\]\\d*\\.\\d*|0\\.\\d*\[1-9\]\\d*))|0?\\.0+|0$</span><br></pre></td></tr></table></figure></li>
<li><p>æ­£æµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[1-9\]\\d*\\.\\d*|0\\.\\d*\[1-9\]\\d*$ æˆ– ^((\[0-9\]+\\.\[0-9\]*\[1-9\]\[0-9\]*)|(\[0-9\]*\[1-9\]\[0-9\]*\\.\[0-9\]+)|(\[0-9\]*\[1-9\]\[0-9\]*))$</span><br></pre></td></tr></table></figure></li>
<li><p>è´Ÿæµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^-(\[1-9\]\\d*\\.\\d*|0\\.\\d*\[1-9\]\\d*)$ æˆ– ^(-((\[0-9\]+\\.\[0-9\]*\[1-9\]\[0-9\]*)|(\[0-9\]*\[1-9\]\[0-9\]*\\.\[0-9\]+)|(\[0-9\]*\[1-9\]\[0-9\]*)))$</span><br></pre></td></tr></table></figure></li>
<li><p>æµ®ç‚¹æ•°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(-?\\d+)(\\.\\d+)?$ æˆ– ^-?(\[1-9\]\\d*\\.\\d*|0\\.\\d*\[1-9\]\\d*|0?\\.0+|0)$</span><br></pre></td></tr></table></figure>
<h3 id="äºŒ-æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼"><a href="#äºŒ-æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼" class="headerlink" title="äºŒ. æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼"></a>äºŒ. æ ¡éªŒå­—ç¬¦çš„è¡¨è¾¾å¼</h3></li>
<li><p>æ±‰å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[\\u4e00-\\u9fa5\]&#123;0,&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>è‹±æ–‡å’Œæ•°å­—ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[A-Za-z0-9\]+$ æˆ– ^\[A-Za-z0-9\]&#123;4,40&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>é•¿åº¦ä¸º3-20çš„æ‰€æœ‰å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^.&#123;3,20&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[A-Za-z\]+$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±26ä¸ªå¤§å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[A-Z\]+$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±26ä¸ªå°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[a-z\]+$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±æ•°å­—å’Œ26ä¸ªè‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[A-Za-z0-9\]+$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”±æ•°å­—ã€26ä¸ªè‹±æ–‡å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ç»„æˆçš„å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\w+$ æˆ– ^\\w&#123;3,20&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—åŒ…æ‹¬ä¸‹åˆ’çº¿ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[\\u4E00-\\u9FA5A-Za-z0-9_\]+$</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸­æ–‡ã€è‹±æ–‡ã€æ•°å­—ä½†ä¸åŒ…æ‹¬ä¸‹åˆ’çº¿ç­‰ç¬¦å·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[\\u4E00-\\u9FA5A-Za-z0-9\]+$ æˆ– ^\[\\u4E00-\\u9FA5A-Za-z0-9\]&#123;2,20&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>å¯ä»¥è¾“å…¥å«æœ‰^%&amp;â€™,;=?$\â€œç­‰å­—ç¬¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ï¼š\[^%&amp;&#39;,;&#x3D;?$\\x22\]+</span><br></pre></td></tr></table></figure></li>
<li><p>ç¦æ­¢è¾“å…¥å«æœ‰~çš„å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[^~\\x22\]+</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰-ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼"><a href="#ä¸‰-ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼" class="headerlink" title="ä¸‰. ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼"></a>ä¸‰. ç‰¹æ®Šéœ€æ±‚è¡¨è¾¾å¼</h3></li>
<li><p>Emailåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\w+(\[-+.\]\\w+)*@\\w+(\[-.\]\\w+)*\\.\\w+(\[-.\]\\w+)*$</span><br></pre></td></tr></table></figure></li>
<li><p>åŸŸåï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[a-zA-Z0-9\]\[-a-zA-Z0-9\]&#123;0,62&#125;(&#x2F;.\[a-zA-Z0-9\]\[-a-zA-Z0-9\]&#123;0,62&#125;)+&#x2F;.?</span><br></pre></td></tr></table></figure></li>
<li><p>InternetURLï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[a-zA-z\]+:&#x2F;&#x2F;\[^\\s\]* æˆ– ^http:&#x2F;&#x2F;(\[\\w-\]+\\.)+\[\\w-\]+(&#x2F;\[\\w-.&#x2F;?%&amp;&#x3D;\]*)?$</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰‹æœºå·ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(13\[0-9\]|14\[5|7\]|15\[0|1|2|3|5|6|7|8|9\]|18\[0|1|2|3|5|6|7|8|9\])\\d&#123;8&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>ç”µè¯å·ç (â€œXXX-XXXXXXXâ€ã€â€XXXX-XXXXXXXXâ€ã€â€XXX-XXXXXXXâ€ã€â€XXX-XXXXXXXXâ€ã€â€XXXXXXXâ€å’Œâ€XXXXXXXX)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\\(\\d&#123;3,4&#125;-)|\\d&#123;3.4&#125;-)?\\d&#123;7,8&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>å›½å†…ç”µè¯å·ç (0511-4405222ã€021-87888822)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\\d&#123;3&#125;-\\d&#123;8&#125;|\\d&#123;4&#125;-\\d&#123;7&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>èº«ä»½è¯å·(15ä½ã€18ä½æ•°å­—)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d&#123;15&#125;|\\d&#123;18&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>çŸ­èº«ä»½è¯å·ç (æ•°å­—ã€å­—æ¯xç»“å°¾)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\[0-9\])&#123;7,18&#125;(x|X)?$ æˆ– ^\\d&#123;8,18&#125;|\[0-9x\]&#123;8,18&#125;|\[0-9X\]&#123;8,18&#125;?$</span><br></pre></td></tr></table></figure></li>
<li><p>å¸å·æ˜¯å¦åˆæ³•(å­—æ¯å¼€å¤´ï¼Œå…è®¸5-16å­—èŠ‚ï¼Œå…è®¸å­—æ¯æ•°å­—ä¸‹åˆ’çº¿)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[a-zA-Z\]\[a-zA-Z0-9_\]&#123;4,15&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>å¯†ç (ä»¥å­—æ¯å¼€å¤´ï¼Œé•¿åº¦åœ¨6~18ä¹‹é—´ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\[a-zA-Z\]\\w&#123;5,17&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>å¼ºå¯†ç (å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—çš„ç»„åˆï¼Œä¸èƒ½ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦åœ¨8-10ä¹‹é—´)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(?&#x3D;.*\\d)(?&#x3D;.*\[a-z\])(?&#x3D;.*\[A-Z\]).&#123;8,10&#125;$</span><br></pre></td></tr></table></figure></li>
<li><p>æ—¥æœŸæ ¼å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\d&#123;4&#125;-\\d&#123;1,2&#125;-\\d&#123;1,2&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸€å¹´çš„12ä¸ªæœˆ(01ï½09å’Œ1ï½12)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(0?\[1-9\]|1\[0-2\])$</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸€ä¸ªæœˆçš„31å¤©(01ï½09å’Œ1ï½31)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^((0?\[1-9\])|((1|2)\[0-9\])|30|31)$</span><br></pre></td></tr></table></figure></li>
<li><p>é’±çš„è¾“å…¥æ ¼å¼ï¼š</p>
</li>
<li><p>æœ‰å››ç§é’±çš„è¡¨ç¤ºå½¢å¼æˆ‘ä»¬å¯ä»¥æ¥å—:â€10000.00â€³ å’Œ â€œ10,000.00â€, å’Œæ²¡æœ‰ â€œåˆ†â€ çš„ â€œ10000â€ å’Œ â€œ10,000â€ï¼š^[1-9][0-9]*$</p>
</li>
<li><p>è¿™è¡¨ç¤ºä»»æ„ä¸€ä¸ªä¸ä»¥0å¼€å¤´çš„æ•°å­—,ä½†æ˜¯,è¿™ä¹Ÿæ„å‘³ç€ä¸€ä¸ªå­—ç¬¦â€0â€³ä¸é€šè¿‡,æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ä¸‹é¢çš„å½¢å¼ï¼š^(0|[1-9][0-9]*)$</p>
</li>
<li><p>ä¸€ä¸ª0æˆ–è€…ä¸€ä¸ªä¸ä»¥0å¼€å¤´çš„æ•°å­—.æˆ‘ä»¬è¿˜å¯ä»¥å…è®¸å¼€å¤´æœ‰ä¸€ä¸ªè´Ÿå·ï¼š^(0|-?[1-9][0-9]*)$</p>
</li>
<li><p>è¿™è¡¨ç¤ºä¸€ä¸ª0æˆ–è€…ä¸€ä¸ªå¯èƒ½ä¸ºè´Ÿçš„å¼€å¤´ä¸ä¸º0çš„æ•°å­—.è®©ç”¨æˆ·ä»¥0å¼€å¤´å¥½äº†.æŠŠè´Ÿå·çš„ä¹Ÿå»æ‰,å› ä¸ºé’±æ€»ä¸èƒ½æ˜¯è´Ÿçš„å§.ä¸‹é¢æˆ‘ä»¬è¦åŠ çš„æ˜¯è¯´æ˜å¯èƒ½çš„å°æ•°éƒ¨åˆ†ï¼š^[0-9]+(.[0-9]+)?$</p>
</li>
<li><p>å¿…é¡»è¯´æ˜çš„æ˜¯,å°æ•°ç‚¹åé¢è‡³å°‘åº”è¯¥æœ‰1ä½æ•°,æ‰€ä»¥â€10.â€æ˜¯ä¸é€šè¿‡çš„,ä½†æ˜¯ â€œ10â€ å’Œ â€œ10.2â€ æ˜¯é€šè¿‡çš„ï¼š^[0-9]+(.[0-9]{2})?$</p>
</li>
<li><p>è¿™æ ·æˆ‘ä»¬è§„å®šå°æ•°ç‚¹åé¢å¿…é¡»æœ‰ä¸¤ä½,å¦‚æœä½ è®¤ä¸ºå¤ªè‹›åˆ»äº†,å¯ä»¥è¿™æ ·ï¼š^[0-9]+(.[0-9]{1,2})?$</p>
</li>
<li><p>è¿™æ ·å°±å…è®¸ç”¨æˆ·åªå†™ä¸€ä½å°æ•°.ä¸‹é¢æˆ‘ä»¬è¯¥è€ƒè™‘æ•°å­—ä¸­çš„é€—å·äº†,æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š^[0-9]{1,3}(,[0-9]{3})*(.[0-9]{1,2})?$</p>
</li>
<li><p>1åˆ°3ä¸ªæ•°å­—,åé¢è·Ÿç€ä»»æ„ä¸ªé€—å·+3ä¸ªæ•°å­—,é€—å·æˆä¸ºå¯é€‰,è€Œä¸æ˜¯å¿…é¡»ï¼š^([0-9]+|[0-9]{1,3}(,[0-9]{3})<em>)(.[0-9]{1,2})?$<br>å¤‡æ³¨ï¼šè¿™å°±æ˜¯æœ€ç»ˆç»“æœäº†,åˆ«å¿˜äº†â€+â€å¯ä»¥ç”¨â€</em>â€æ›¿ä»£å¦‚æœä½ è§‰å¾—ç©ºå­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ¥å—çš„è¯(å¥‡æ€ª,ä¸ºä»€ä¹ˆ?)æœ€å,åˆ«å¿˜äº†åœ¨ç”¨å‡½æ•°æ—¶å»æ‰å»æ‰é‚£ä¸ªåæ–œæ ,ä¸€èˆ¬çš„é”™è¯¯éƒ½åœ¨è¿™é‡Œ</p>
</li>
<li><p>xmlæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^(\[a-zA-Z\]+-?)+\[a-zA-Z0-9\]+\\\.\[x|X\]\[m|M\]\[l|L\]$</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸­æ–‡å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[\\u4e00-\\u9fa5\]</span><br></pre></td></tr></table></figure></li>
<li><p>åŒå­—èŠ‚å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[^\\x00-\\xff\] (åŒ…æ‹¬æ±‰å­—åœ¨å†…ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦(ä¸€ä¸ªåŒå­—èŠ‚å­—ç¬¦é•¿åº¦è®¡2ï¼ŒASCIIå­—ç¬¦è®¡1))</span><br></pre></td></tr></table></figure></li>
<li><p>ç©ºç™½è¡Œçš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\\n\\s*\\r (å¯ä»¥ç”¨æ¥åˆ é™¤ç©ºç™½è¡Œ)</span><br></pre></td></tr></table></figure></li>
<li><p>HTMLæ ‡è®°çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;(\\S*?)\[^&gt;\]*&gt;.*?|&lt;.*? &#x2F;&gt; (ç½‘ä¸Šæµä¼ çš„ç‰ˆæœ¬å¤ªç³Ÿç³•ï¼Œä¸Šé¢è¿™ä¸ªä¹Ÿä»…ä»…èƒ½éƒ¨åˆ†ï¼Œå¯¹äºå¤æ‚çš„åµŒå¥—æ ‡è®°ä¾æ—§æ— èƒ½ä¸ºåŠ›)</span><br></pre></td></tr></table></figure></li>
<li><p>é¦–å°¾ç©ºç™½å­—ç¬¦çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">^\\s*|\\s*$ æˆ– (^\\s*)|(\\s*$) (å¯ä»¥ç”¨æ¥åˆ é™¤è¡Œé¦–è¡Œå°¾çš„ç©ºç™½å­—ç¬¦(åŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰)ï¼Œéå¸¸æœ‰ç”¨çš„è¡¨è¾¾å¼)</span><br></pre></td></tr></table></figure></li>
<li><p>è…¾è®¯QQå·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[1-9\]\[0-9\]&#123;4,&#125; (è…¾è®¯QQå·ä»10000å¼€å§‹)</span><br></pre></td></tr></table></figure></li>
<li><p>ä¸­å›½é‚®æ”¿ç¼–ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\[1-9\]\\d&#123;5&#125;(?!\\d) (ä¸­å›½é‚®æ”¿ç¼–ç ä¸º6ä½æ•°å­—)</span><br></pre></td></tr></table></figure></li>
<li><p>IPåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\\d+\\.\\d+\\.\\d+\\.\\d+ (æå–IPåœ°å€æ—¶æœ‰ç”¨)</span><br></pre></td></tr></table></figure></li>
<li><p>IPåœ°å€ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((?:(?:25\[0-5\]|2\[0-4\]\\\d|\[01\]?\\\d?\\\d)\\\.)&#123;3&#125;(?:25\[0-5\]|2\[0-4\]\\\d|\[01\]?\\\d?\\\d))</span><br></pre></td></tr></table></figure>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3></li>
</ol>
<ul>
<li><a href="http://www.aikaiyuan.com/9609.html" target="_blank" rel="noopener">æ£€æµ‹IPåœ°å€çš„æ­£åˆ™è¡¨è¾¾å¼</a></li>
<li><a href="http://www.aikaiyuan.com/6836.html" target="_blank" rel="noopener">Pythonä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼åŸç†å’Œä¼˜åŒ–ç¬”è®°</a></li>
<li><a href="http://www.aikaiyuan.com/7981.html" target="_blank" rel="noopener">æ­£åˆ™è¡¨è¾¾å¼ å†…éƒ¨åŸ¹è®­ PPT</a></li>
<li><a href="http://www.aikaiyuan.com/10014.html" target="_blank" rel="noopener">grep å‘½ä»¤ä¸­æ­£åˆ™è¡¨è¾¾å¼çš„ç”¨æ³•</a></li>
<li><a href="http://www.aikaiyuan.com/8975.html" target="_blank" rel="noopener">ä¼˜é…·çœŸå®è§†é¢‘åœ°å€è§£æ</a></li>
<li><a href="http://www.aikaiyuan.com/7764.html" target="_blank" rel="noopener">Nginxé‡å†™è§„åˆ™ rewrite æŒ‡å—</a></li>
</ul>
<p>è½¬è½½è¯·æ³¨æ˜ï¼š<a href="http://www.aikaiyuan.com" target="_blank" rel="noopener">çˆ±å¼€æº</a> Â» <a href="http://www.aikaiyuan.com/10924.html" target="_blank" rel="noopener">æœ€å…¨é¢çš„å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼å¤§å…¨</a></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>æ—¥æœŸæ ¼å¼è½¬æ¢</title>
    <url>/2020/04/20/%E6%97%A5%E6%9C%9F%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2/</url>
    <content><![CDATA[<h2 id="æ—¥æœŸæ ¼å¼è½¬æ¢"><a href="#æ—¥æœŸæ ¼å¼è½¬æ¢" class="headerlink" title="æ—¥æœŸæ ¼å¼è½¬æ¢"></a>æ—¥æœŸæ ¼å¼è½¬æ¢</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2017&#x2F;9&#x2F;11</span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">from datetime import date</span><br><span class="line">from datetime import datetime</span><br><span class="line"></span><br><span class="line">class JsonCustomEncoder(json.JSONEncoder):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¤„ç†datetimeæ ¼å¼æ•°æ®</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def default(self, field):</span><br><span class="line">        if isinstance(field, datetime):</span><br><span class="line">            return field.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)</span><br><span class="line">        elif isinstance(field, date):</span><br><span class="line">            return field.strftime(&#39;%Y-%m-%d&#39;)</span><br><span class="line">        else:</span><br><span class="line">            return json.JSONEncoder.default(self, field)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®</title>
    <url>/2020/04/20/%E6%94%B9%E5%96%84Python%E7%A8%8B%E5%BA%8F%E7%9A%8491%E4%B8%AA%E5%BB%BA%E8%AE%AE/</url>
    <content><![CDATA[<h2 id="æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®"><a href="#æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®" class="headerlink" title="æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®"></a>æ”¹å–„Pythonç¨‹åºçš„91ä¸ªå»ºè®®</h2><h3 id="1ï¼šå¼•è®º"><a href="#1ï¼šå¼•è®º" class="headerlink" title="1ï¼šå¼•è®º"></a>1ï¼šå¼•è®º</h3><p>å»ºè®®1ã€ç†è§£Pythonicæ¦‚å¿µâ€”-è¯¦è§Pythonä¸­çš„ã€ŠPythonä¹‹ç¦…ã€‹</p>
<p>å»ºè®®2ã€ç¼–å†™Pythonicä»£ç </p>
<p>ï¼ˆ1ï¼‰é¿å…ä¸è§„èŒƒä»£ç ï¼Œæ¯”å¦‚åªç”¨å¤§å°å†™åŒºåˆ†å˜é‡ã€ä½¿ç”¨å®¹æ˜“æ··æ·†çš„å˜é‡åã€å®³æ€•è¿‡é•¿å˜é‡åç­‰ã€‚æœ‰æ—¶å€™é•¿çš„å˜é‡åä¼šä½¿ä»£ç æ›´åŠ å…·æœ‰å¯è¯»æ€§ã€‚</p>
<p>ï¼ˆ2ï¼‰æ·±å…¥å­¦ä¹ Pythonç›¸å…³çŸ¥è¯†ï¼Œæ¯”å¦‚è¯­è¨€ç‰¹æ€§ã€åº“ç‰¹æ€§ç­‰ï¼Œæ¯”å¦‚Pythonæ¼”å˜è¿‡ç¨‹ç­‰ã€‚æ·±å…¥å­¦ä¹ ä¸€ä¸¤ä¸ªä¸šå†…å…¬è®¤çš„Pythonicçš„ä»£ç åº“ï¼Œæ¯”å¦‚Flaskç­‰ã€‚</p>
<p>å»ºè®®3ï¼šç†è§£Pythonä¸Cçš„ä¸åŒä¹‹å¤„ï¼Œæ¯”å¦‚ç¼©è¿›ä¸{}ï¼Œå•å¼•å·åŒå¼•å·ï¼Œä¸‰å…ƒæ“ä½œç¬¦ï¼Ÿï¼ŒSwitch-Caseè¯­å¥ç­‰ã€‚</p>
<p>å»ºè®®4ï¼šåœ¨ä»£ç ä¸­é€‚å½“æ·»åŠ æ³¨é‡Š</p>
<p>å»ºè®®5ï¼šé€‚å½“æ·»åŠ ç©ºè¡Œä½¿ä»£ç å¸ƒå±€æ›´åŠ åˆç†</p>
<p>å»ºè®®6ï¼šç¼–å†™å‡½æ•°çš„4ä¸ªåŸåˆ™</p>
<p>ï¼ˆ1ï¼‰å‡½æ•°è®¾è®¡è¦å°½é‡çŸ­å°ï¼ŒåµŒå¥—å±‚æ¬¡ä¸å®œè¿‡æ·±</p>
<p>ï¼ˆ2ï¼‰å‡½æ•°å£°æ˜åº”è¯¥åšåˆ°åˆç†ã€ç®€å•ã€æ˜“ç”¨</p>
<p>ï¼ˆ3ï¼‰å‡½æ•°å‚æ•°è®¾è®¡åº”è¯¥è€ƒè™‘å‘ä¸‹å…¼å®¹</p>
<p>ï¼ˆ4ï¼‰ä¸€ä¸ªå‡½æ•°åªåšä¸€ä»¶äº‹ï¼Œå°½é‡ä¿è¯å‡½æ•°ç²’åº¦çš„ä¸€è‡´æ€§</p>
<p>å»ºè®®7ï¼šå°†å¸¸é‡é›†ä¸­åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸”å¸¸é‡åå°½é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯</p>
<h3 id="2ï¼šç¼–ç¨‹æƒ¯ç”¨æ³•"><a href="#2ï¼šç¼–ç¨‹æƒ¯ç”¨æ³•" class="headerlink" title="2ï¼šç¼–ç¨‹æƒ¯ç”¨æ³•"></a>2ï¼šç¼–ç¨‹æƒ¯ç”¨æ³•</h3><p>å»ºè®®8ï¼šåˆ©ç”¨assertè¯­å¥æ¥å‘ç°é—®é¢˜ï¼Œä½†è¦æ³¨æ„ï¼Œæ–­è¨€assertä¼šå½±å“æ•ˆç‡</p>
<p>å»ºè®®9ï¼šæ•°æ®äº¤æ¢å€¼æ—¶ä¸æ¨èä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œè€Œæ˜¯ç›´æ¥a, b = b, a</p>
<p>å»ºè®®10ï¼šå……åˆ†åˆ©ç”¨æƒ°æ€§è®¡ç®—ï¼ˆLazy evaluationï¼‰çš„ç‰¹æ€§ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„è®¡ç®—</p>
<p>å»ºè®®11ï¼šç†è§£æšä¸¾æ›¿ä»£å®ç°çš„ç¼ºé™·ï¼ˆæœ€æ–°ç‰ˆPythonä¸­å·²ç»åŠ å…¥äº†æšä¸¾ç‰¹æ€§ï¼‰</p>
<p>å»ºè®®12ï¼šä¸æ¨èä½¿ç”¨typeæ¥è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå› ä¸ºæœ‰äº›æ—¶å€™typeçš„ç»“æœå¹¶ä¸ä¸€å®šå¯é ã€‚å¦‚æœæœ‰éœ€æ±‚ï¼Œå»ºè®®ä½¿ç”¨isinstanceå‡½æ•°æ¥ä»£æ›¿</p>
<p>å»ºè®®13ï¼šå°½é‡å°†å˜é‡è½¬åŒ–ä¸ºæµ®ç‚¹ç±»å‹åå†åšé™¤æ³•ï¼ˆPython3ä»¥åä¸ç”¨è€ƒè™‘ï¼‰</p>
<p>å»ºè®®14ï¼šè­¦æƒ•eval()å‡½æ•°çš„å®‰å…¨æ¼æ´ï¼Œæœ‰ç‚¹ç±»ä¼¼äºSQLæ³¨å…¥</p>
<p>å»ºè®®15ï¼šä½¿ç”¨enumerate()åŒæ—¶è·å–åºåˆ—è¿­ä»£çš„ç´¢å¼•å’Œå€¼</p>
<p>å»ºè®®16ï¼šåˆ†æ¸…==å’Œisçš„é€‚ç”¨åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¯”è¾ƒå­—ç¬¦ä¸²ç­‰ä¸å¯å˜ç±»å‹å˜é‡æ—¶ï¼ˆè¯¦è§è¯„è®ºï¼‰</p>
<p>å»ºè®®17ï¼šå°½é‡ä½¿ç”¨Unicodeã€‚åœ¨Python2ä¸­ç¼–ç æ˜¯å¾ˆè®©äººå¤´ç—›çš„ä¸€ä»¶äº‹ï¼Œä½†Python3å°±ä¸ç”¨è¿‡å¤šè€ƒè™‘äº†</p>
<p>å»ºè®®18ï¼šæ„å»ºåˆç†çš„åŒ…å±‚æ¬¡æ¥ç®¡ç†Module</p>
<h3 id="3ï¼šåŸºç¡€ç”¨æ³•"><a href="#3ï¼šåŸºç¡€ç”¨æ³•" class="headerlink" title="3ï¼šåŸºç¡€ç”¨æ³•"></a>3ï¼šåŸºç¡€ç”¨æ³•</h3><p>å»ºè®®19ï¼šæœ‰èŠ‚åˆ¶çš„ä½¿ç”¨fromâ€¦importè¯­å¥ï¼Œé˜²æ­¢æ±¡æŸ“å‘½åç©ºé—´</p>
<p>å»ºè®®20ï¼šä¼˜å…ˆä½¿ç”¨absolute importæ¥å¯¼å…¥æ¨¡å—ï¼ˆPython3ä¸­å·²ç»ç§»é™¤äº†relative importï¼‰</p>
<p>å»ºè®®21ï¼ši+=1ä¸ç­‰äº++iï¼Œåœ¨Pythonä¸­ï¼Œ++iå‰è¾¹çš„åŠ å·ä»…è¡¨ç¤ºæ­£ï¼Œä¸è¡¨ç¤ºæ“ä½œ</p>
<p>å»ºè®®22ï¼šä¹ æƒ¯ä½¿ç”¨withè‡ªåŠ¨å…³é—­èµ„æºï¼Œç‰¹åˆ«æ˜¯åœ¨æ–‡ä»¶è¯»å†™ä¸­</p>
<p>å»ºè®®23ï¼šä½¿ç”¨elseå­å¥ç®€åŒ–å¾ªç¯ï¼ˆå¼‚å¸¸å¤„ç†ï¼‰</p>
<p>å»ºè®®24ï¼šéµå¾ªå¼‚å¸¸å¤„ç†çš„å‡ ç‚¹åŸºæœ¬åŸåˆ™</p>
<p>ï¼ˆ1ï¼‰æ³¨æ„å¼‚å¸¸çš„ç²’åº¦ï¼Œtryå—ä¸­å°½é‡å°‘å†™ä»£ç </p>
<p>ï¼ˆ2ï¼‰è°¨æ…ä½¿ç”¨å•ç‹¬çš„exceptè¯­å¥ï¼Œæˆ–except Exceptionè¯­å¥ï¼Œè€Œæ˜¯å®šä½åˆ°å…·ä½“å¼‚å¸¸</p>
<p>ï¼ˆ3ï¼‰æ³¨æ„å¼‚å¸¸æ•è·çš„é¡ºåºï¼Œåœ¨åˆé€‚çš„å±‚æ¬¡å¤„ç†å¼‚å¸¸</p>
<p>ï¼ˆ4ï¼‰ä½¿ç”¨æ›´åŠ å‹å¥½çš„å¼‚å¸¸ä¿¡æ¯ï¼Œéµå®ˆå¼‚å¸¸å‚æ•°çš„è§„èŒƒ</p>
<p>å»ºè®®25ï¼šé¿å…finallyä¸­å¯èƒ½å‘ç”Ÿçš„é™·é˜±</p>
<p>å»ºè®®26ï¼šæ·±å…¥ç†è§£Noneï¼Œæ­£ç¡®åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºç©ºã€‚Pythonä¸­ä¸‹åˆ—æ•°æ®ä¼šåˆ¤æ–­ä¸ºç©ºï¼š<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iciaMJDiaNTbG52ZVEtvvWrJdfxjeHnC0h2nJcvp2sZwpqMdESQCm3pUhzcPcBsOyWfj6NJ0vIT3D6AVHMzZLCjmA/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="ç©ºå€¼åˆ¤æ–­"><br>å»ºè®®27ï¼šè¿æ¥å­—ç¬¦ä¸²åº”ä¼˜å…ˆä½¿ç”¨joinå‡½æ•°ï¼Œè€Œä¸æ˜¯+æ“ä½œ</p>
<p>å»ºè®®28ï¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²æ—¶å°½é‡ä½¿ç”¨.formatå‡½æ•°ï¼Œè€Œä¸æ˜¯%å½¢å¼</p>
<p>å»ºè®®29ï¼šåŒºåˆ«å¯¹å¾…å¯å˜å¯¹è±¡å’Œä¸å¯å˜å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯ä½œä¸ºå‡½æ•°å‚æ•°æ—¶</p>
<p>å»ºè®®30ï¼š[], {}å’Œ()ï¼šä¸€è‡´çš„å®¹å™¨åˆå§‹åŒ–å½¢å¼ã€‚ä½¿ç”¨åˆ—è¡¨è§£æå¯ä»¥ä½¿ä»£ç æ›´æ¸…æ™°ï¼ŒåŒæ—¶æ•ˆç‡æ›´é«˜</p>
<p>å»ºè®®31ï¼šå‡½æ•°ä¼ å‚æ•°ï¼Œæ—¢ä¸æ˜¯ä¼ å€¼ä¹Ÿä¸æ˜¯ä¼ å¼•ç”¨ï¼Œè€Œæ˜¯ä¼ å¯¹è±¡æˆ–è€…è¯´å¯¹è±¡çš„å¼•ç”¨</p>
<p>å»ºè®®32ï¼šè­¦æƒ•é»˜è®¤å‚æ•°æ½œåœ¨çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“é»˜è®¤å‚æ•°ä¸ºå¯å˜å¯¹è±¡æ—¶</p>
<p>å»ºè®®33ï¼šå‡½æ•°ä¸­æ…ç”¨å˜é•¿å‚æ•°argså’Œ*kargs</p>
<p>ï¼ˆ1ï¼‰è¿™ç§ä½¿ç”¨å¤ªçµæ´»ï¼Œä»è€Œä½¿å¾—å‡½æ•°ç­¾åä¸å¤Ÿæ¸…æ™°ï¼Œå¯è¯»æ€§è¾ƒå·®</p>
<p>ï¼ˆ2ï¼‰å¦‚æœå› ä¸ºå‡½æ•°å‚æ•°è¿‡å¤šè€Œæ˜¯ç”¨å˜é•¿å‚æ•°ç®€åŒ–å‡½æ•°å®šä¹‰ï¼Œé‚£ä¹ˆä¸€èˆ¬è¯¥å‡½æ•°å¯ä»¥é‡æ„</p>
<p>å»ºè®®34ï¼šæ·±å…¥ç†è§£str()å’Œrepr()çš„åŒºåˆ«</p>
<p>ï¼ˆ1ï¼‰ä¸¤è€…ä¹‹é—´çš„ç›®æ ‡ä¸åŒï¼šsträ¸»è¦é¢å‘å®¢æˆ·ï¼Œå…¶ç›®çš„æ˜¯å¯è¯»æ€§ï¼Œè¿”å›å½¢å¼ä¸ºç”¨æˆ·å‹å¥½æ€§å’Œå¯è¯»æ€§éƒ½æ¯”è¾ƒé«˜çš„å­—ç¬¦ä¸²å½¢å¼ï¼›è€Œrepræ˜¯é¢å‘Pythonè§£é‡Šå™¨æˆ–è€…è¯´Pythonå¼€å‘äººå‘˜ï¼Œå…¶ç›®çš„æ˜¯å‡†ç¡®æ€§ï¼Œå…¶è¿”å›å€¼è¡¨ç¤ºPythonè§£é‡Šå™¨å†…éƒ¨çš„å®šä¹‰</p>
<p>ï¼ˆ2ï¼‰åœ¨è§£é‡Šå™¨ä¸­ç›´æ¥è¾“å…¥å˜é‡ï¼Œé»˜è®¤è°ƒç”¨reprå‡½æ•°ï¼Œè€Œprint(var)é»˜è®¤è°ƒç”¨strå‡½æ•°</p>
<p>ï¼ˆ3ï¼‰reprå‡½æ•°çš„è¿”å›å€¼ä¸€èˆ¬å¯ä»¥ç”¨evalå‡½æ•°æ¥è¿˜åŸå¯¹è±¡</p>
<p>ï¼ˆ4ï¼‰ä¸¤è€…åˆ†åˆ«è°ƒç”¨å¯¹è±¡çš„å†…å»ºå‡½æ•°str__()å’Œ__repr()</p>
<p>å»ºè®®35ï¼šåˆ†æ¸…é™æ€æ–¹æ³•staticmethodå’Œç±»æ–¹æ³•classmethodçš„ä½¿ç”¨åœºæ™¯</p>
<h3 id="4ï¼šåº“"><a href="#4ï¼šåº“" class="headerlink" title="4ï¼šåº“"></a>4ï¼šåº“</h3><p>å»ºè®®36ï¼šæŒæ¡å­—ç¬¦ä¸²çš„åŸºæœ¬ç”¨æ³•</p>
<p>å»ºè®®37ï¼šæŒ‰éœ€é€‰æ‹©sort()å’Œsorted()å‡½æ•°</p>
<p>ã€‹sort()æ˜¯åˆ—è¡¨åœ¨å°±åœ°è¿›è¡Œæ’åºï¼Œæ‰€ä»¥ä¸èƒ½æ’åºå…ƒç»„ç­‰ä¸å¯å˜ç±»å‹ã€‚</p>
<p>ã€‹sorted()å¯ä»¥æ’åºä»»æ„çš„å¯è¿­ä»£ç±»å‹ï¼ŒåŒæ—¶ä¸æ”¹å˜åŸå˜é‡æœ¬èº«ã€‚</p>
<p>å»ºè®®38ï¼šä½¿ç”¨copyæ¨¡å—æ·±æ‹·è´å¯¹è±¡ï¼ŒåŒºåˆ†æµ…æ‹·è´ï¼ˆshallow copyï¼‰å’Œæ·±æ‹·è´ï¼ˆdeep copyï¼‰</p>
<p>å»ºè®®39ï¼šä½¿ç”¨Counterè¿›è¡Œè®¡æ•°ç»Ÿè®¡ï¼ŒCounteræ˜¯å­—å…¸ç±»çš„å­ç±»ï¼Œåœ¨collectionsæ¨¡å—ä¸­</p>
<p>å»ºè®®40ï¼šæ·±å…¥æŒæ¡ConfigParser</p>
<p>å»ºè®®41ï¼šä½¿ç”¨argparseæ¨¡å—å¤„ç†å‘½ä»¤è¡Œå‚æ•°</p>
<p>å»ºè®®42ï¼šä½¿ç”¨pandaså¤„ç†å¤§å‹CSVæ–‡ä»¶</p>
<p>ã€‹Pythonæœ¬èº«æä¾›ä¸€ä¸ªCSVæ–‡ä»¶å¤„ç†æ¨¡å—ï¼Œå¹¶æä¾›readerã€writerç­‰å‡½æ•°ã€‚</p>
<p>ã€‹Pandaså¯æä¾›åˆ†å—ã€åˆå¹¶å¤„ç†ç­‰ï¼Œé€‚ç”¨äºæ•°æ®é‡å¤§çš„æƒ…å†µï¼Œä¸”å¯¹äºŒç»´æ•°æ®æ“ä½œæ›´æ–¹ä¾¿ã€‚</p>
<p>å»ºè®®43ï¼šä½¿ç”¨ElementTreeè§£æXML</p>
<p>å»ºè®®44ï¼šç†è§£æ¨¡å—pickleçš„ä¼˜åŠ£</p>
<p>ã€‹ä¼˜åŠ¿ï¼šæ¥å£ç®€å•ã€å„å¹³å°é€šç”¨ã€æ”¯æŒçš„æ•°æ®ç±»å‹å¹¿æ³›ã€æ‰©å±•æ€§å¼º</p>
<p>ã€‹åŠ£åŠ¿ï¼šä¸ä¿è¯æ•°æ®æ“ä½œçš„åŸå­æ€§ã€å­˜åœ¨å®‰å…¨é—®é¢˜ã€ä¸åŒè¯­è¨€ä¹‹é—´ä¸å…¼å®¹</p>
<p>å»ºè®®45ï¼šåºåˆ—åŒ–çš„å¦ä¸€ä¸ªé€‰æ‹©JSONæ¨¡å—ï¼šloadå’Œdumpæ“ä½œ</p>
<p>å»ºè®®46ï¼šä½¿ç”¨tracebackè·å–æ ˆä¿¡æ¯</p>
<p>å»ºè®®47ï¼šä½¿ç”¨loggingè®°å½•æ—¥å¿—ä¿¡æ¯</p>
<p>å»ºè®®48ï¼šä½¿ç”¨threadingæ¨¡å—ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº</p>
<p>å»ºè®®49ï¼šä½¿ç”¨Queueæ¨¡å—ä½¿å¤šçº¿ç¨‹ç¼–ç¨‹æ›´å®‰å…¨</p>
<h3 id="5ï¼šè®¾è®¡æ¨¡å¼"><a href="#5ï¼šè®¾è®¡æ¨¡å¼" class="headerlink" title="5ï¼šè®¾è®¡æ¨¡å¼"></a>5ï¼šè®¾è®¡æ¨¡å¼</h3><p>å»ºè®®50ï¼šåˆ©ç”¨æ¨¡å—å®ç°å•ä¾‹æ¨¡å¼</p>
<p>å»ºè®®51ï¼šç”¨mixinæ¨¡å¼è®©ç¨‹åºæ›´åŠ çµæ´»</p>
<p>å»ºè®®52ï¼šç”¨å‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°æ¾è€¦åˆ</p>
<p>å»ºè®®53ï¼šç”¨çŠ¶æ€æ¨¡å¼ç¾åŒ–ä»£ç </p>
<h3 id="6ï¼šå†…éƒ¨æœºåˆ¶"><a href="#6ï¼šå†…éƒ¨æœºåˆ¶" class="headerlink" title="6ï¼šå†…éƒ¨æœºåˆ¶"></a>6ï¼šå†…éƒ¨æœºåˆ¶</h3><p>å»ºè®®54ï¼šç†è§£build-inå¯¹è±¡</p>
<p>å»ºè®®55ï¼šinit__()ä¸æ˜¯æ„é€ æ–¹æ³•ï¼Œç†è§£__new()ä¸å®ƒä¹‹é—´çš„åŒºåˆ«</p>
<p>å»ºè®®56ï¼šç†è§£å˜é‡çš„æŸ¥æ‰¾æœºåˆ¶ï¼Œå³ä½œç”¨åŸŸ</p>
<p>ã€‹å±€éƒ¨ä½œç”¨åŸŸ</p>
<p>ã€‹å…¨å±€ä½œç”¨åŸŸ</p>
<p>ã€‹åµŒå¥—ä½œç”¨åŸŸ</p>
<p>ã€‹å†…ç½®ä½œç”¨åŸŸ</p>
<p>å»ºè®®57ï¼šä¸ºä»€ä¹ˆéœ€è¦selfå‚æ•°</p>
<p>å»ºè®®58ï¼šç†è§£MROï¼ˆæ–¹æ³•è§£æé¡ºåºï¼‰ä¸å¤šç»§æ‰¿</p>
<p>å»ºè®®59ï¼šç†è§£æè¿°ç¬¦æœºåˆ¶</p>
<p>å»ºè®®60ï¼šåŒºåˆ«getattr__()ä¸__getattribute()æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«</p>
<p>å»ºè®®61ï¼šä½¿ç”¨æ›´å®‰å…¨çš„property</p>
<p>å»ºè®®62ï¼šæŒæ¡å…ƒç±»metaclass</p>
<p>å»ºè®®63ï¼šç†Ÿæ‚‰Pythonå¯¹è±¡åè®®<br><img src="https://mmbiz.qpic.cn/mmbiz_jpg/iciaMJDiaNTbG52ZVEtvvWrJdfxjeHnC0h2mTYUZQBgtMVG5BQzVEnnkMDu5U9MzPJp99DzicxZ6hUjT03ib6wicwalw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="å†…ç½®æ–¹æ³•"><br>å»ºè®®64ï¼šåˆ©ç”¨æ“ä½œç¬¦é‡è½½å®ç°ä¸­ç¼€è¯­æ³•</p>
<p>å»ºè®®65ï¼šç†Ÿæ‚‰Pythonçš„è¿­ä»£å™¨åè®®</p>
<p>å»ºè®®66ï¼šç†Ÿæ‚‰Pythonçš„ç”Ÿæˆå™¨</p>
<p>å»ºè®®67ï¼šåŸºäºç”Ÿæˆå™¨çš„åç¨‹å’Œgreenletï¼Œç†è§£åç¨‹ã€å¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ä¹‹é—´çš„åŒºåˆ«</p>
<p>å»ºè®®68ï¼šç†è§£GILçš„å±€é™æ€§</p>
<p>å»ºè®®69ï¼šå¯¹è±¡çš„ç®¡ç†å’Œåƒåœ¾å›æ”¶</p>
<h3 id="7ï¼šä½¿ç”¨å·¥å…·è¾…åŠ©é¡¹ç›®å¼€å‘"><a href="#7ï¼šä½¿ç”¨å·¥å…·è¾…åŠ©é¡¹ç›®å¼€å‘" class="headerlink" title="7ï¼šä½¿ç”¨å·¥å…·è¾…åŠ©é¡¹ç›®å¼€å‘"></a>7ï¼šä½¿ç”¨å·¥å…·è¾…åŠ©é¡¹ç›®å¼€å‘</h3><p>å»ºè®®70ï¼šä»PyPIå®‰è£…ç¬¬ä¸‰æ–¹åŒ…</p>
<p>å»ºè®®71ï¼šä½¿ç”¨pipå’Œyolkå®‰è£…ã€ç®¡ç†åŒ…</p>
<p>å»ºè®®72ï¼šåšpasteråˆ›å»ºåŒ…</p>
<p>å»ºè®®73ï¼šç†è§£å•å…ƒæµ‹è¯•çš„æ¦‚å¿µ</p>
<p>å»ºè®®74ï¼šä¸ºåŒ…ç¼–å†™å•å…ƒæµ‹è¯•</p>
<p>å»ºè®®75ï¼šåˆ©ç”¨æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰æé«˜ä»£ç çš„å¯æµ‹æ€§</p>
<p>å»ºè®®76ï¼šä½¿ç”¨Pylintæ£€æŸ¥ä»£ç é£æ ¼</p>
<p>ã€‹ä»£ç é£æ ¼å®¡æŸ¥</p>
<p>ã€‹ä»£ç é”™è¯¯æ£€æŸ¥</p>
<p>ã€‹å‘ç°é‡å¤ä»¥åŠä¸åˆç†çš„ä»£ç ï¼Œæ–¹ä¾¿é‡æ„</p>
<p>ã€‹é«˜åº¦çš„å¯é…ç½®åŒ–å’Œå¯å®šåˆ¶åŒ–</p>
<p>ã€‹æ”¯æŒå„ç§IDEå’Œç¼–è¾‘å™¨çš„é›†æˆ</p>
<p>ã€‹èƒ½å¤ŸåŸºäºPythonä»£ç ç”ŸæˆUMLå›¾</p>
<p>ã€‹èƒ½å¤Ÿä¸Jenkinsç­‰æŒç»­é›†æˆå·¥å…·ç›¸ç»“åˆï¼Œæ”¯æŒè‡ªåŠ¨ä»£ç å®¡æŸ¥</p>
<p>å»ºè®®77ï¼šè¿›è¡Œé«˜æ•ˆçš„ä»£ç å®¡æŸ¥</p>
<p>å»ºè®®78ï¼šå°†åŒ…å‘å¸ƒåˆ°PyPI</p>
<h3 id="8ï¼šæ€§èƒ½å‰–æä¸ä¼˜åŒ–"><a href="#8ï¼šæ€§èƒ½å‰–æä¸ä¼˜åŒ–" class="headerlink" title="8ï¼šæ€§èƒ½å‰–æä¸ä¼˜åŒ–"></a>8ï¼šæ€§èƒ½å‰–æä¸ä¼˜åŒ–</h3><p>å»ºè®®79ï¼šäº†è§£ä»£ç ä¼˜åŒ–çš„åŸºæœ¬åŸåˆ™</p>
<p>å»ºè®®80ï¼šå€ŸåŠ©æ€§èƒ½ä¼˜åŒ–å·¥å…·</p>
<p>å»ºè®®81ï¼šåˆ©ç”¨cProfileå®šä½æ€§èƒ½ç“¶é¢ˆ</p>
<p>å»ºè®®82ï¼šä½¿ç”¨memory_profilerå’Œobjgraphå‰–æå†…å­˜ä½¿ç”¨</p>
<p>å»ºè®®83ï¼šåŠªåŠ›é™ä½ç®—æ³•å¤æ‚åº¦</p>
<p>å»ºè®®84ï¼šæŒæ¡å¾ªç¯ä¼˜åŒ–çš„åŸºæœ¬æŠ€å·§</p>
<p>ã€‹å‡å°‘å¾ªç¯å†…éƒ¨çš„è®¡ç®—</p>
<p>ã€‹å°†æ˜¾å¼å¾ªç¯æ”¹ä¸ºéšå¼å¾ªç¯ï¼Œå½“ç„¶è¿™ä¼šç‰ºç‰²ä»£ç çš„å¯è¯»æ€§</p>
<p>ã€‹åœ¨å¾ªç¯ä¸­å°½é‡å¼•ç”¨å±€éƒ¨å˜é‡</p>
<p>ã€‹å…³æ³¨å†…å±‚åµŒå¥—å¾ªç¯</p>
<p>å»ºè®®85ï¼šä½¿ç”¨ç”Ÿæˆå™¨æé«˜æ•ˆç‡</p>
<p>å»ºè®®86ï¼šä½¿ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ä¼˜åŒ–æ€§èƒ½</p>
<p>å»ºè®®87ï¼šå……åˆ†åˆ©ç”¨setçš„ä¼˜åŠ¿</p>
<p>å»ºè®®88ï¼šä½¿ç”¨multiprocessingæ¨¡å—å…‹æœGILç¼ºé™·</p>
<p>å»ºè®®89ï¼šä½¿ç”¨çº¿ç¨‹æ± æé«˜æ•ˆç‡</p>
<p>å»ºè®®90ï¼šä½¿ç”¨C/C++æ¨¡å—æ‰©å±•æé«˜æ€§èƒ½</p>
<p>å»ºè®®91ï¼šä½¿ç”¨Cythonbç¼–å†™æ‰©å±•æ¨¡å—</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>å€¼å¾—çœ‹çš„7æœ¬ä¹¦</title>
    <url>/2020/04/20/%E5%80%BC%E5%BE%97%E7%9C%8B%E7%9A%847%E6%9C%AC%E4%B9%A6/</url>
    <content><![CDATA[<h2 id="ä¹¦ç±"><a href="#ä¹¦ç±" class="headerlink" title="ä¹¦ç±"></a>ä¹¦ç±</h2><ol>
<li>ç©·çˆ¸çˆ¸å¯Œçˆ¸çˆ¸</li>
<li>è§è¯†</li>
<li>è¢«è®¨åŒçš„å‹‡æ°”</li>
<li>æƒ…ç»ªå‹’ç´¢</li>
<li>è‹è²çš„ä¸–ç•Œ</li>
<li>ç§˜å¯†</li>
<li>å°±è¿™æ ·ï¼Œæˆ‘ç¡äº†å…¨ä¸–ç•Œçš„æ²™å‘</li>
</ol>
]]></content>
      <categories>
        <category>Book</category>
      </categories>
      <tags>
        <tag>Book</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨Gitå‘½ä»¤æ¸…å•-v0.1</title>
    <url>/2020/04/20/%E5%B8%B8%E7%94%A8Git%E5%91%BD%E4%BB%A4%E6%B8%85%E5%8D%95-v0-1/</url>
    <content><![CDATA[<h2 id="å¸¸ç”¨Gitå‘½ä»¤æ¸…å•"><a href="#å¸¸ç”¨Gitå‘½ä»¤æ¸…å•" class="headerlink" title="å¸¸ç”¨Gitå‘½ä»¤æ¸…å•"></a>å¸¸ç”¨Gitå‘½ä»¤æ¸…å•</h2><blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæ—¥å¸¸ä½¿ç”¨åªè¦è®°ä½ä¸‹å›¾6ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥äº†ã€‚ä½†æ˜¯ç†Ÿç»ƒä½¿ç”¨ï¼Œææ€•è¦è®°ä½60ï½100ä¸ªå‘½ä»¤ã€‚</p>
</blockquote>
<h3 id="åæ¬¡è§£é‡Š"><a href="#åæ¬¡è§£é‡Š" class="headerlink" title="åæ¬¡è§£é‡Š"></a>åæ¬¡è§£é‡Š</h3><p><img src="https://note.youdao.com/yws/api/personal/file/WEB392fff8491cd94960a8296d7607e51b4?method=download&shareKey=e5b3ec746227b33cc6120efe14ca3fde" alt="image"><br>ä¸‹é¢æ˜¯æˆ‘æ•´ç†çš„å¸¸ç”¨ Git å‘½ä»¤æ¸…å•ã€‚å‡ ä¸ªä¸“ç”¨åè¯çš„è¯‘åå¦‚ä¸‹:<br>Workspaceï¼šå·¥ä½œåŒº<br>Index / Stageï¼šæš‚å­˜åŒº<br>Repositoryï¼šä»“åº“åŒºï¼ˆæˆ–æœ¬åœ°ä»“åº“ï¼‰<br>Remoteï¼šè¿œç¨‹ä»“åº“</p>
<h3 id="ä¸€-æ–°å»ºä»£ç åº“"><a href="#ä¸€-æ–°å»ºä»£ç åº“" class="headerlink" title="ä¸€. æ–°å»ºä»£ç åº“"></a>ä¸€. æ–°å»ºä»£ç åº“</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åœ¨å½“å‰ç›®å½•æ–°å»ºä¸€ä¸ªGitä»£ç åº“</span><br><span class="line">$ git init</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°†å…¶åˆå§‹åŒ–ä¸ºGitä»£ç åº“</span><br><span class="line">$ git init [project-name]</span><br><span class="line"></span><br><span class="line"># ä¸‹è½½ä¸€ä¸ªé¡¹ç›®å’Œå®ƒçš„æ•´ä¸ªä»£ç å†å²</span><br><span class="line">$ git clone [url]</span><br></pre></td></tr></table></figure>

<h3 id="äºŒ-é…ç½®"><a href="#äºŒ-é…ç½®" class="headerlink" title="äºŒ.é…ç½®"></a>äºŒ.é…ç½®</h3><p>Gitçš„è®¾ç½®æ–‡ä»¶ä¸º.gitconfigï¼Œå®ƒå¯ä»¥åœ¨ç”¨æˆ·ä¸»ç›®å½•ä¸‹(å…¨å±€é…ç½®)ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ç›®å½•ä¸‹(é¡¹ç›®é…ç½®)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ˜¾ç¤ºå½“å‰çš„Gité…ç½®</span><br><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line"># ç¼–è¾‘Gité…ç½®æ–‡ä»¶</span><br><span class="line">$ git config -e [--global]</span><br><span class="line"></span><br><span class="line"># è®¾ç½®æäº¤ä»£ç æ—¶çš„ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">$ git config [--global] user.name &quot;[name]&quot;</span><br><span class="line">$ git config [--global] user.email &quot;[email address]&quot;</span><br><span class="line"></span><br><span class="line"># é¢œè‰²è®¾ç½®</span><br><span class="line">git config --global color.ui true                         # git statusç­‰å‘½ä»¤è‡ªåŠ¨ç€è‰²</span><br><span class="line">git config --global color.status auto</span><br><span class="line">git config --global color.diff auto</span><br><span class="line">git config --global color.branch auto</span><br><span class="line">git config --global color.interactive auto</span><br><span class="line">git config --global --unset http.proxy                    # remove  proxy configuration on git</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰-å¢åŠ -åˆ é™¤æ–‡ä»¶"><a href="#ä¸‰-å¢åŠ -åˆ é™¤æ–‡ä»¶" class="headerlink" title="ä¸‰. å¢åŠ /åˆ é™¤æ–‡ä»¶"></a>ä¸‰. å¢åŠ /åˆ é™¤æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ·»åŠ æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒº</span><br><span class="line">$ git add [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æŒ‡å®šç›®å½•åˆ°æš‚å­˜åŒºï¼ŒåŒ…æ‹¬å­ç›®å½•</span><br><span class="line">$ git add [dir]</span><br><span class="line"></span><br><span class="line"># æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº</span><br><span class="line">$ git add .</span><br><span class="line"></span><br><span class="line"># æ·»åŠ æ¯ä¸ªå˜åŒ–å‰ï¼Œéƒ½ä¼šè¦æ±‚ç¡®è®¤</span><br><span class="line"># å¯¹äºåŒä¸€ä¸ªæ–‡ä»¶çš„å¤šå¤„å˜åŒ–ï¼Œå¯ä»¥å®ç°åˆ†æ¬¡æäº¤</span><br><span class="line">$ git add -p</span><br><span class="line"></span><br><span class="line"># åˆ é™¤å·¥ä½œåŒºæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™æ¬¡åˆ é™¤æ”¾å…¥æš‚å­˜åŒº</span><br><span class="line">$ git rm [file1] [file2] ...</span><br><span class="line"></span><br><span class="line"># åœæ­¢è¿½è¸ªæŒ‡å®šæ–‡ä»¶ï¼Œä½†è¯¥æ–‡ä»¶ä¼šä¿ç•™åœ¨å·¥ä½œåŒº</span><br><span class="line">$ git rm --cached [file]</span><br><span class="line"></span><br><span class="line"># æ”¹åæ–‡ä»¶ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ”¹åæ”¾å…¥æš‚å­˜åŒº</span><br><span class="line">$ git mv [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>

<h3 id="å››-ä»£ç æäº¤"><a href="#å››-ä»£ç æäº¤" class="headerlink" title="å››. ä»£ç æäº¤"></a>å››. ä»£ç æäº¤</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æäº¤æš‚å­˜åŒºåˆ°ä»“åº“åŒº</span><br><span class="line">$ git commit -m [message]</span><br><span class="line"></span><br><span class="line"># æäº¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°ä»“åº“åŒº</span><br><span class="line">$ git commit [file1] [file2] ... -m [message]</span><br><span class="line"></span><br><span class="line"># æäº¤å·¥ä½œåŒºè‡ªä¸Šæ¬¡commitä¹‹åçš„å˜åŒ–ï¼Œç›´æ¥åˆ°ä»“åº“åŒº</span><br><span class="line">$ git commit -a</span><br><span class="line"></span><br><span class="line"># æäº¤æ—¶æ˜¾ç¤ºæ‰€æœ‰diffä¿¡æ¯</span><br><span class="line">$ git commit -v</span><br><span class="line"></span><br><span class="line"># å°†addå’Œcommitåˆä¸ºä¸€æ­¥</span><br><span class="line">$ git commit -am &#39;message&#39;</span><br><span class="line"></span><br><span class="line"># ä½¿ç”¨ä¸€æ¬¡æ–°çš„commitï¼Œæ›¿ä»£ä¸Šä¸€æ¬¡æäº¤</span><br><span class="line"># å¦‚æœä»£ç æ²¡æœ‰ä»»ä½•æ–°å˜åŒ–ï¼Œåˆ™ç”¨æ¥æ”¹å†™ä¸Šä¸€æ¬¡commitçš„æäº¤ä¿¡æ¯</span><br><span class="line">$ git commit --amend -m [message]</span><br><span class="line"></span><br><span class="line"># é‡åšä¸Šä¸€æ¬¡commitï¼Œå¹¶åŒ…æ‹¬æŒ‡å®šæ–‡ä»¶çš„æ–°å˜åŒ–</span><br><span class="line">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>

<h3 id="äº”-åˆ†æ”¯"><a href="#äº”-åˆ†æ”¯" class="headerlink" title="äº”. åˆ†æ”¯"></a>äº”. åˆ†æ”¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯</span><br><span class="line">$ git branch</span><br><span class="line"></span><br><span class="line"># åˆ—å‡ºæ‰€æœ‰è¿œç¨‹åˆ†æ”¯</span><br><span class="line">$ git branch -r</span><br><span class="line"></span><br><span class="line"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯</span><br><span class="line">$ git branch -a</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</span><br><span class="line">$ git branch [branch-name]</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><br><span class="line">$ git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŒ‡å®šcommit</span><br><span class="line">$ git branch [branch] [commit]</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯å»ºç«‹è¿½è¸ªå…³ç³»</span><br><span class="line">$ git branch --track [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œå¹¶æ›´æ–°å·¥ä½œåŒº</span><br><span class="line">$ git checkout [branch-name]</span><br><span class="line"></span><br><span class="line"># åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªåˆ†æ”¯</span><br><span class="line">$ git checkout -</span><br><span class="line"></span><br><span class="line"># å»ºç«‹è¿½è¸ªå…³ç³»ï¼Œåœ¨ç°æœ‰åˆ†æ”¯ä¸æŒ‡å®šçš„è¿œç¨‹åˆ†æ”¯ä¹‹é—´</span><br><span class="line">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class="line"></span><br><span class="line"># åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"># é€‰æ‹©ä¸€ä¸ªcommitï¼Œåˆå¹¶è¿›å½“å‰åˆ†æ”¯</span><br><span class="line">$ git cherry-pick [commit]</span><br><span class="line"></span><br><span class="line"># åˆ é™¤åˆ†æ”¯</span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote&#x2F;branch]</span><br><span class="line"></span><br><span class="line"># æ£€å‡ºç‰ˆæœ¬v2.0</span><br><span class="line">$ git checkout v2.0</span><br><span class="line"></span><br><span class="line"># ä»è¿œç¨‹åˆ†æ”¯developåˆ›å»ºæ–°æœ¬åœ°åˆ†æ”¯develå¹¶æ£€å‡º</span><br><span class="line">$ git checkout -b devel origin&#x2F;develop</span><br><span class="line"></span><br><span class="line"># æ£€å‡ºheadç‰ˆæœ¬çš„READMEæ–‡ä»¶ï¼ˆå¯ç”¨äºä¿®æ”¹é”™è¯¯å›é€€ï¼‰</span><br><span class="line">git checkout -- README</span><br></pre></td></tr></table></figure>

<h3 id="å…­-æ ‡ç­¾"><a href="#å…­-æ ‡ç­¾" class="headerlink" title="å…­. æ ‡ç­¾"></a>å…­. æ ‡ç­¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># åˆ—å‡ºæ‰€æœ‰tag</span><br><span class="line">$ git tag</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªtagåœ¨å½“å‰commit</span><br><span class="line">$ git tag [tag]</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªtagåœ¨æŒ‡å®šcommit</span><br><span class="line">$ git tag [tag] [commit]</span><br><span class="line"></span><br><span class="line"># åˆ é™¤æœ¬åœ°tag</span><br><span class="line">$ git tag -d [tag]</span><br><span class="line"></span><br><span class="line"># åˆ é™¤è¿œç¨‹tag</span><br><span class="line">$ git push origin :refs&#x2F;tags&#x2F;[tagName]</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹tagä¿¡æ¯</span><br><span class="line">$ git show [tag]</span><br><span class="line"></span><br><span class="line"># æäº¤æŒ‡å®štag</span><br><span class="line">$ git push [remote] [tag]</span><br><span class="line"></span><br><span class="line"># æäº¤æ‰€æœ‰tag</span><br><span class="line">$ git push [remote] --tags</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼ŒæŒ‡å‘æŸä¸ªtag</span><br><span class="line">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ƒ-æŸ¥çœ‹ä¿¡æ¯"><a href="#ä¸ƒ-æŸ¥çœ‹ä¿¡æ¯" class="headerlink" title="ä¸ƒ. æŸ¥çœ‹ä¿¡æ¯"></a>ä¸ƒ. æŸ¥çœ‹ä¿¡æ¯</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ˜¾ç¤ºæœ‰å˜æ›´çš„æ–‡ä»¶</span><br><span class="line">$ git status</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„ç‰ˆæœ¬å†å²</span><br><span class="line">$ git log</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºcommitå†å²ï¼Œä»¥åŠæ¯æ¬¡commitå‘ç”Ÿå˜æ›´çš„æ–‡ä»¶</span><br><span class="line">$ git log --stat</span><br><span class="line"></span><br><span class="line"># æœç´¢æäº¤å†å²ï¼Œæ ¹æ®å…³é”®è¯</span><br><span class="line">$ git log -S [keyword]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œæ¯ä¸ªcommitå æ®ä¸€è¡Œ</span><br><span class="line">$ git log [tag] HEAD --pretty&#x3D;format:%s</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸä¸ªcommitä¹‹åçš„æ‰€æœ‰å˜åŠ¨ï¼Œå…¶&quot;æäº¤è¯´æ˜&quot;å¿…é¡»ç¬¦åˆæœç´¢æ¡ä»¶</span><br><span class="line">$ git log [tag] HEAD --grep feature</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å†å²ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ”¹å</span><br><span class="line">$ git log --follow [file]</span><br><span class="line">$ git whatchanged [file]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç›¸å…³çš„æ¯ä¸€æ¬¡diff</span><br><span class="line">$ git log -p [file]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºè¿‡å»5æ¬¡æäº¤</span><br><span class="line">$ git log -5 --pretty --oneline</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæ‰€æœ‰æäº¤è¿‡çš„ç”¨æˆ·ï¼ŒæŒ‰æäº¤æ¬¡æ•°æ’åº</span><br><span class="line">$ git shortlog -sn</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶æ˜¯ä»€ä¹ˆäººåœ¨ä»€ä¹ˆæ—¶é—´ä¿®æ”¹è¿‡</span><br><span class="line">$ git blame [file]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„å·®å¼‚</span><br><span class="line">$ git diff</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæš‚å­˜åŒºå’Œä¸Šä¸€ä¸ªcommitçš„å·®å¼‚</span><br><span class="line">$ git diff --cached [file]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºå·¥ä½œåŒºä¸å½“å‰åˆ†æ”¯æœ€æ–°commitä¹‹é—´çš„å·®å¼‚</span><br><span class="line">$ git diff HEAD</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚</span><br><span class="line">$ git diff [first-branch]...[second-branch]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºä»Šå¤©ä½ å†™äº†å¤šå°‘è¡Œä»£ç </span><br><span class="line">$ git diff --shortstat &quot;@&#123;0 day ago&#125;&quot;</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸæ¬¡æäº¤çš„å…ƒæ•°æ®å’Œå†…å®¹å˜åŒ–</span><br><span class="line">$ git show [commit]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸæ¬¡æäº¤å‘ç”Ÿå˜åŒ–çš„æ–‡ä»¶</span><br><span class="line">$ git show --name-only [commit]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸæ¬¡æäº¤æ—¶ï¼ŒæŸä¸ªæ–‡ä»¶çš„å†…å®¹</span><br><span class="line">$ git show [commit]:[filename]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æœ€è¿‘å‡ æ¬¡æäº¤</span><br><span class="line">$ git reflog</span><br></pre></td></tr></table></figure>

<h3 id="å…«-è¿œç¨‹åŒæ­¥"><a href="#å…«-è¿œç¨‹åŒæ­¥" class="headerlink" title="å…«. è¿œç¨‹åŒæ­¥"></a>å…«. è¿œç¨‹åŒæ­¥</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ä¸‹è½½è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜åŠ¨</span><br><span class="line">$ git fetch [remote]</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæ‰€æœ‰è¿œç¨‹ä»“åº“</span><br><span class="line">$ git remote -v</span><br><span class="line"></span><br><span class="line"># æ˜¾ç¤ºæŸä¸ªè¿œç¨‹ä»“åº“çš„ä¿¡æ¯</span><br><span class="line">$ git remote show [remote]</span><br><span class="line"></span><br><span class="line"># å¢åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼Œå¹¶å‘½å</span><br><span class="line">$ git remote add [shortname] [url]</span><br><span class="line"></span><br><span class="line"># å–å›è¿œç¨‹ä»“åº“çš„å˜åŒ–ï¼Œå¹¶ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶</span><br><span class="line">$ git pull [remote] [branch]</span><br><span class="line"></span><br><span class="line"># ä¸Šä¼ æœ¬åœ°æŒ‡å®šåˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">$ git push [remote] [branch]</span><br><span class="line"></span><br><span class="line"># å¼ºè¡Œæ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“ï¼Œå³ä½¿æœ‰å†²çª</span><br><span class="line">$ git push [remote] --force</span><br><span class="line"></span><br><span class="line"># æ¨é€æ‰€æœ‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">$ git push [remote] --all</span><br></pre></td></tr></table></figure>

<h3 id="ä¹-æ’¤é”€"><a href="#ä¹-æ’¤é”€" class="headerlink" title="ä¹. æ’¤é”€"></a>ä¹. æ’¤é”€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># æ¢å¤æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶åˆ°å·¥ä½œåŒº</span><br><span class="line">$ git checkout [file]</span><br><span class="line"></span><br><span class="line"># æ¢å¤æŸä¸ªcommitçš„æŒ‡å®šæ–‡ä»¶åˆ°æš‚å­˜åŒºå’Œå·¥ä½œåŒº</span><br><span class="line">$ git checkout [commit] [file]</span><br><span class="line"></span><br><span class="line"># æ¢å¤æš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶åˆ°å·¥ä½œåŒº</span><br><span class="line">$ git checkout .</span><br><span class="line"></span><br><span class="line"># é‡ç½®æš‚å­˜åŒºçš„æŒ‡å®šæ–‡ä»¶ï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´ï¼Œä½†å·¥ä½œåŒºä¸å˜</span><br><span class="line">$ git reset [file]</span><br><span class="line"></span><br><span class="line"># é‡ç½®æš‚å­˜åŒºä¸å·¥ä½œåŒºï¼Œä¸ä¸Šä¸€æ¬¡commitä¿æŒä¸€è‡´</span><br><span class="line">$ git reset --hard</span><br><span class="line"></span><br><span class="line"># é‡ç½®å½“å‰åˆ†æ”¯çš„æŒ‡é’ˆä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºï¼Œä½†å·¥ä½œåŒºä¸å˜</span><br><span class="line">$ git reset [commit]</span><br><span class="line"></span><br><span class="line"># é‡ç½®å½“å‰åˆ†æ”¯çš„HEADä¸ºæŒ‡å®šcommitï¼ŒåŒæ—¶é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œåŒºï¼Œä¸æŒ‡å®šcommitä¸€è‡´</span><br><span class="line">$ git reset --hard [commit]</span><br><span class="line"></span><br><span class="line"># é‡ç½®å½“å‰HEADä¸ºæŒ‡å®šcommitï¼Œä½†ä¿æŒæš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸å˜</span><br><span class="line">$ git reset --keep [commit]</span><br><span class="line"></span><br><span class="line"># æ–°å»ºä¸€ä¸ªcommitï¼Œç”¨æ¥æ’¤é”€æŒ‡å®šcommit</span><br><span class="line"># åè€…çš„æ‰€æœ‰å˜åŒ–éƒ½å°†è¢«å‰è€…æŠµæ¶ˆï¼Œå¹¶ä¸”åº”ç”¨åˆ°å½“å‰åˆ†æ”¯</span><br><span class="line">$ git revert [commit]</span><br><span class="line"></span><br><span class="line"># æš‚æ—¶å°†æœªæäº¤çš„å˜åŒ–ç§»é™¤ï¼Œç¨åå†ç§»å…¥</span><br><span class="line">$ git stash</span><br><span class="line">$ git stash pop</span><br></pre></td></tr></table></figure>

<h3 id="å-å…¶ä»–"><a href="#å-å…¶ä»–" class="headerlink" title="å. å…¶ä»–"></a>å. å…¶ä»–</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git init                                                  # åˆå§‹åŒ–æœ¬åœ°gitä»“åº“ï¼ˆåˆ›å»ºæ–°ä»“åº“ï¼‰</span><br><span class="line">git config --global user.name &quot;xxx&quot;                       # é…ç½®ç”¨æˆ·å</span><br><span class="line">git config --global user.email &quot;xxx@xxx.com&quot;              # é…ç½®é‚®ä»¶</span><br><span class="line">git config --global color.ui true                         # git statusç­‰å‘½ä»¤è‡ªåŠ¨ç€è‰²</span><br><span class="line">git config --global color.status auto</span><br><span class="line">git config --global color.diff auto</span><br><span class="line">git config --global color.branch auto</span><br><span class="line">git config --global color.interactive auto</span><br><span class="line">git config --global --unset http.proxy                    # remove  proxy configuration on git</span><br><span class="line">git clone git+ssh:&#x2F;&#x2F;git@192.168.53.168&#x2F;VT.git             # cloneè¿œç¨‹ä»“åº“</span><br><span class="line">git status                                                # æŸ¥çœ‹å½“å‰ç‰ˆæœ¬çŠ¶æ€ï¼ˆæ˜¯å¦ä¿®æ”¹ï¼‰</span><br><span class="line">git add xyz                                               # æ·»åŠ xyzæ–‡ä»¶è‡³index</span><br><span class="line">git add .                                                 # å¢åŠ å½“å‰å­ç›®å½•ä¸‹æ‰€æœ‰æ›´æ”¹è¿‡çš„æ–‡ä»¶è‡³index</span><br><span class="line">git commit -m &#39;xxx&#39;                                       # æäº¤</span><br><span class="line">git commit --amend -m &#39;xxx&#39;                               # åˆå¹¶ä¸Šä¸€æ¬¡æäº¤ï¼ˆç”¨äºåå¤ä¿®æ”¹ï¼‰</span><br><span class="line">git commit -am &#39;xxx&#39;                                      # å°†addå’Œcommitåˆä¸ºä¸€æ­¥</span><br><span class="line">git rm xxx                                                # åˆ é™¤indexä¸­çš„æ–‡ä»¶</span><br><span class="line">git rm -r *                                               # é€’å½’åˆ é™¤</span><br><span class="line">git log                                                   # æ˜¾ç¤ºæäº¤æ—¥å¿—</span><br><span class="line">git log -1                                                # æ˜¾ç¤º1è¡Œæ—¥å¿— -nä¸ºnè¡Œ</span><br><span class="line">git log -5</span><br><span class="line">git log --stat                                            # æ˜¾ç¤ºæäº¤æ—¥å¿—åŠç›¸å…³å˜åŠ¨æ–‡ä»¶</span><br><span class="line">git log -p -m</span><br><span class="line">git show dfb02e6e4f2f7b573337763e5c0013802e392818         # æ˜¾ç¤ºæŸä¸ªæäº¤çš„è¯¦ç»†å†…å®¹</span><br><span class="line">git show dfb02                                            # å¯åªç”¨commitidçš„å‰å‡ ä½</span><br><span class="line">git show HEAD                                             # æ˜¾ç¤ºHEADæäº¤æ—¥å¿—</span><br><span class="line">git show HEAD^                                            # æ˜¾ç¤ºHEADçš„çˆ¶ï¼ˆä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼‰çš„æäº¤æ—¥å¿— ^^ä¸ºä¸Šä¸¤ä¸ªç‰ˆæœ¬ ^5ä¸ºä¸Š5ä¸ªç‰ˆæœ¬</span><br><span class="line">git tag                                                   # æ˜¾ç¤ºå·²å­˜åœ¨çš„tag</span><br><span class="line">git tag -a v2.0 -m &#39;xxx&#39;                                  # å¢åŠ v2.0çš„tag</span><br><span class="line">git show v2.0                                             # æ˜¾ç¤ºv2.0çš„æ—¥å¿—åŠè¯¦ç»†å†…å®¹</span><br><span class="line">git log v2.0                                              # æ˜¾ç¤ºv2.0çš„æ—¥å¿—</span><br><span class="line">git diff                                                  # æ˜¾ç¤ºæ‰€æœ‰æœªæ·»åŠ è‡³indexçš„å˜æ›´</span><br><span class="line">git diff --cached                                         # æ˜¾ç¤ºæ‰€æœ‰å·²æ·»åŠ indexä½†è¿˜æœªcommitçš„å˜æ›´</span><br><span class="line">git diff HEAD^                                            # æ¯”è¾ƒä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„å·®å¼‚</span><br><span class="line">git diff HEAD -- .&#x2F;lib                                    # æ¯”è¾ƒä¸HEADç‰ˆæœ¬libç›®å½•çš„å·®å¼‚</span><br><span class="line">git diff origin&#x2F;master..master                            # æ¯”è¾ƒè¿œç¨‹åˆ†æ”¯masterä¸Šæœ‰æœ¬åœ°åˆ†æ”¯masterä¸Šæ²¡æœ‰çš„</span><br><span class="line">git diff origin&#x2F;master..master --stat                     # åªæ˜¾ç¤ºå·®å¼‚çš„æ–‡ä»¶ï¼Œä¸æ˜¾ç¤ºå…·ä½“å†…å®¹</span><br><span class="line">git remote add origin git+ssh:&#x2F;&#x2F;git@192.168.53.168&#x2F;VT.git # å¢åŠ è¿œç¨‹å®šä¹‰ï¼ˆç”¨äºpush&#x2F;pull&#x2F;fetchï¼‰</span><br><span class="line">git branch                                                # æ˜¾ç¤ºæœ¬åœ°åˆ†æ”¯</span><br><span class="line">git branch --contains 50089                               # æ˜¾ç¤ºåŒ…å«æäº¤50089çš„åˆ†æ”¯</span><br><span class="line">git branch -a                                             # æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯</span><br><span class="line">git branch -r                                             # æ˜¾ç¤ºæ‰€æœ‰åŸåˆ›åˆ†æ”¯</span><br><span class="line">git branch --merged                                       # æ˜¾ç¤ºæ‰€æœ‰å·²åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯</span><br><span class="line">git branch --no-merged                                    # æ˜¾ç¤ºæ‰€æœ‰æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯</span><br><span class="line">git branch -m master master_copy                          # æœ¬åœ°åˆ†æ”¯æ”¹å</span><br><span class="line">git checkout -b master_copy                               # ä»å½“å‰åˆ†æ”¯åˆ›å»ºæ–°åˆ†æ”¯master_copyå¹¶æ£€å‡º</span><br><span class="line">git checkout -b master master_copy                        # ä¸Šé¢çš„å®Œæ•´ç‰ˆ</span><br><span class="line">git checkout features&#x2F;performance                         # æ£€å‡ºå·²å­˜åœ¨çš„features&#x2F;performanceåˆ†æ”¯</span><br><span class="line">git checkout --track hotfixes&#x2F;BJVEP933                    # æ£€å‡ºè¿œç¨‹åˆ†æ”¯hotfixes&#x2F;BJVEP933å¹¶åˆ›å»ºæœ¬åœ°è·Ÿè¸ªåˆ†æ”¯</span><br><span class="line">git checkout v2.0                                         # æ£€å‡ºç‰ˆæœ¬v2.0</span><br><span class="line">git checkout -b devel origin&#x2F;develop                      # ä»è¿œç¨‹åˆ†æ”¯developåˆ›å»ºæ–°æœ¬åœ°åˆ†æ”¯develå¹¶æ£€å‡º</span><br><span class="line">git checkout -- README                                    # æ£€å‡ºheadç‰ˆæœ¬çš„READMEæ–‡ä»¶ï¼ˆå¯ç”¨äºä¿®æ”¹é”™è¯¯å›é€€ï¼‰</span><br><span class="line">git merge origin&#x2F;master                                   # åˆå¹¶è¿œç¨‹masteråˆ†æ”¯è‡³å½“å‰åˆ†æ”¯</span><br><span class="line">git cherry-pick ff44785404a8e                             # åˆå¹¶æäº¤ff44785404a8eçš„ä¿®æ”¹</span><br><span class="line">git push origin master                                    # å°†å½“å‰åˆ†æ”¯pushåˆ°è¿œç¨‹masteråˆ†æ”¯</span><br><span class="line">git push origin :hotfixes&#x2F;BJVEP933                        # åˆ é™¤è¿œç¨‹ä»“åº“çš„hotfixes&#x2F;BJVEP933åˆ†æ”¯</span><br><span class="line">git push --tags                                           # æŠŠæ‰€æœ‰tagæ¨é€åˆ°è¿œç¨‹ä»“åº“</span><br><span class="line">git fetch                                                 # è·å–æ‰€æœ‰è¿œç¨‹åˆ†æ”¯ï¼ˆä¸æ›´æ–°æœ¬åœ°åˆ†æ”¯ï¼Œå¦éœ€mergeï¼‰</span><br><span class="line">git fetch --prune                                         # è·å–æ‰€æœ‰åŸåˆ›åˆ†æ”¯å¹¶æ¸…é™¤æœåŠ¡å™¨ä¸Šå·²åˆ æ‰çš„åˆ†æ”¯</span><br><span class="line">git pull origin master                                    # è·å–è¿œç¨‹åˆ†æ”¯masterå¹¶mergeåˆ°å½“å‰åˆ†æ”¯</span><br><span class="line">git mv README README2                                     # é‡å‘½åæ–‡ä»¶READMEä¸ºREADME2</span><br><span class="line">git reset --hard HEAD                                     # å°†å½“å‰ç‰ˆæœ¬é‡ç½®ä¸ºHEADï¼ˆé€šå¸¸ç”¨äºmergeå¤±è´¥å›é€€ï¼‰</span><br><span class="line">git rebase</span><br><span class="line">git branch -d hotfixes&#x2F;BJVEP933                           # åˆ é™¤åˆ†æ”¯hotfixes&#x2F;BJVEP933ï¼ˆæœ¬åˆ†æ”¯ä¿®æ”¹å·²åˆå¹¶åˆ°å…¶ä»–åˆ†æ”¯ï¼‰</span><br><span class="line">git branch -D hotfixes&#x2F;BJVEP933                           # å¼ºåˆ¶åˆ é™¤åˆ†æ”¯hotfixes&#x2F;BJVEP933</span><br><span class="line">git ls-files                                              # åˆ—å‡ºgit indexåŒ…å«çš„æ–‡ä»¶</span><br><span class="line">git show-branch                                           # å›¾ç¤ºå½“å‰åˆ†æ”¯å†å²</span><br><span class="line">git show-branch --all                                     # å›¾ç¤ºæ‰€æœ‰åˆ†æ”¯å†å²</span><br><span class="line">git whatchanged                                           # æ˜¾ç¤ºæäº¤å†å²å¯¹åº”çš„æ–‡ä»¶ä¿®æ”¹</span><br><span class="line">git revert dfb02e6e4f2f7b573337763e5c0013802e392818       # æ’¤é”€æäº¤dfb02e6e4f2f7b573337763e5c0013802e392818</span><br><span class="line">git ls-tree HEAD                                          # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªgitå¯¹è±¡</span><br><span class="line">git rev-parse v2.0                                        # å†…éƒ¨å‘½ä»¤ï¼šæ˜¾ç¤ºæŸä¸ªrefå¯¹äºçš„SHA1 HASH</span><br><span class="line">git reflog                                                # æ˜¾ç¤ºæ‰€æœ‰æäº¤ï¼ŒåŒ…æ‹¬å­¤ç«‹èŠ‚ç‚¹</span><br><span class="line">git show HEAD@&#123;5&#125;</span><br><span class="line">git show master@&#123;yesterday&#125;                               # æ˜¾ç¤ºmasteråˆ†æ”¯æ˜¨å¤©çš„çŠ¶æ€</span><br><span class="line">git log --pretty&#x3D;format:&#39;%h %s&#39; --graph                   # å›¾ç¤ºæäº¤æ—¥å¿—</span><br><span class="line">git show HEAD~3</span><br><span class="line">git show -s --pretty&#x3D;raw 2be7fcb476</span><br><span class="line">git stash                                                 # æš‚å­˜å½“å‰ä¿®æ”¹ï¼Œå°†æ‰€æœ‰è‡³ä¸ºHEADçŠ¶æ€</span><br><span class="line">git stash list                                            # æŸ¥çœ‹æ‰€æœ‰æš‚å­˜</span><br><span class="line">git stash show -p stash@&#123;0&#125;                               # å‚è€ƒç¬¬ä¸€æ¬¡æš‚å­˜</span><br><span class="line">git stash apply stash@&#123;0&#125;                                 # åº”ç”¨ç¬¬ä¸€æ¬¡æš‚å­˜</span><br><span class="line">git grep &quot;delete from&quot;                                    # æ–‡ä»¶ä¸­æœç´¢æ–‡æœ¬â€œdelete fromâ€</span><br><span class="line">git grep -e &#39;#define&#39; --and -e SORT_DIRENT</span><br><span class="line">git gc</span><br><span class="line">git fsck</span><br><span class="line"># ç”Ÿæˆä¸€ä¸ªå¯ä¾›å‘å¸ƒçš„å‹ç¼©åŒ…</span><br><span class="line">$ git archive</span><br></pre></td></tr></table></figure>

<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">å¸¸ç”¨ Git å‘½ä»¤æ¸…å• - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a><br><a href="http://www.cnblogs.com/wupeiqi/p/7295372.html" target="_blank" rel="noopener">è€é“ï¼Œè¿™å¹´å¤´ä¸ä¼šç‚¹GitçœŸä¸è¡Œ</a><br><a href="https://gist.github.com/guweigang/9848271" target="_blank" rel="noopener">ä¸€äº›å‘½ä»¤-github</a><br><a href="https://github.com/geeeeeeeeek/git-recipes/wiki" target="_blank" rel="noopener">Home-geeeeeeeeek/git-recipes Wiki-GitHub</a>  </p>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸‰)</title>
    <url>/2020/04/20/%E7%AE%80%E6%B4%81%E7%9A%84Bash-Programming%E6%8A%80%E5%B7%A7-%E4%B8%89/</url>
    <content><![CDATA[<h2 id="ç®€æ´çš„Bash-ProgrammingæŠ€å·§-ä¸€"><a href="#ç®€æ´çš„Bash-ProgrammingæŠ€å·§-ä¸€" class="headerlink" title="ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸€)"></a>ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸€)</h2><h3 id="1-bashä¸­aliasçš„ä½¿ç”¨"><a href="#1-bashä¸­aliasçš„ä½¿ç”¨" class="headerlink" title="1. bashä¸­aliasçš„ä½¿ç”¨"></a>1. bashä¸­aliasçš„ä½¿ç”¨</h3><p>aliaså…¶å®æ˜¯ç»™å¸¸ç”¨çš„å‘½ä»¤å®šä¸€ä¸ªåˆ«åï¼Œæ¯”å¦‚å¾ˆå¤šäººä¼šå®šä¹‰ä¸€ä¸‹çš„ä¸€ä¸ªåˆ«åï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias ll&#x3D;&#39;ls -l&#39;</span><br></pre></td></tr></table></figure>
<p>ä»¥åå°±å¯ä»¥ä½¿ç”¨llï¼Œå®é™…å±•å¼€åæ‰§è¡Œçš„æ˜¯ls -lã€‚ç°åœ¨å¾ˆå¤šå‘è¡Œç‰ˆéƒ½ä¼šå¸¦å‡ ä¸ªé»˜è®¤çš„åˆ«åï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alias grep&#x3D;&#39;grep --color&#x3D;auto&#39;  # å¸¦é¢œè‰²æ˜¾ç¤º</span><br><span class="line">alias ls&#x3D;&#39;ls --color&#x3D;auto&#39; # åŒä¸Š</span><br><span class="line">alias rm&#x3D;&#39;rm -i&#39;  # åˆ é™¤æ–‡ä»¶éœ€è¦ç¡®è®¤</span><br></pre></td></tr></table></figure>
<p>aliasåœ¨æŸäº›æ–¹é¢ç¡®å®æé«˜äº†å¾ˆå¤§çš„æ•ˆç‡ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰éšæ‚£çš„ï¼Œè¿™ç‚¹å¯ä»¥çœ‹æˆ‘ä»¥å‰çš„ä¸€ç¯‡æ–‡ç« ç»ˆç«¯ä¸‹è‚‰çœ¼çœ‹ä¸è§çš„ä¸œè¥¿ã€‚é‚£ä¹ˆå¦‚ä½•ä¸è¦å±•å¼€aliasï¼Œè€Œæ˜¯ç”¨æœ¬æ¥çš„æ„æ€å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä½¿ç”¨è½¬ä¹‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\ls</span><br><span class="line">\grep</span><br></pre></td></tr></table></figure>
<p>åœ¨å‘½ä»¤å‰é¢åŠ ä¸€ä¸ªåæ–œæ åå°±å¯ä»¥äº†ã€‚ è¿™é‡Œè¦æ’ä¸€æ®µæ•…äº‹ï¼Œå‰ä¸¤å¤©æˆ‘åœ¨shellè„šæœ¬ä¸­å®šä¹‰äº†ä¸‹é¢çš„ä¸€ä¸ªaliasï¼Œå‡è®¾ä½äºæ–‡ä»¶util.shï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">alias ssh&#x3D;&#39;ssh -o StrictHostKeyChecking&#x3D;no -o LogLevel&#x3D;quiet -o BatchMode&#x3D;yes&#39;</span><br></pre></td></tr></table></figure>
<p>åé¢è¿™ä¸²sshé€‰é¡¹æ˜¯ä¸ºäº†å»æ‰ä¸€äº›warningçš„ä¿¡æ¯ï¼Œä¸æç¤ºè¾“å…¥å¯†ç ç­‰ç­‰ã€‚å…·ä½“å¯ä»¥çœ‹sshçš„æ–‡æ¡£è¯´æ˜ã€‚æˆ‘è‡ªå·±æµ‹è¯•çš„æ—¶å€™å¥½å¥½çš„ï¼Œå½“æ—¶æˆ‘åŒäº‹è·‘å¾—æ—¶å€™å´ä¾ç„¶æœ‰æŠ¥Warningã€‚æˆ‘å¯¹æ¯”äº†ä¸‹æˆ‘ä»¬ä¸¤ä¸ªäººçš„ç”¨æ³•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sh util.sh  # æ–¹å¼ä¸€</span><br><span class="line">.&#x2F;util.sh   # æ–¹å¼äºŒ</span><br></pre></td></tr></table></figure>
<p>å¤§å®¶åº”è¯¥çŸ¥é“ï¼Œç›´æ¥./util.shæ‰§è¡Œï¼Œshellä¼šå»æ‰¾è„šæœ¬ç¬¬ä¸€è¡Œçš„shebangä¸­ç»™å®šçš„è§£é‡Šå™¨å»æ‰§è¡Œæ”¹è„šæœ¬ï¼Œæ‰€ä»¥ç¬¬äºŒç§ç”¨æ³•ç›¸å½“äºç›´æ¥ç”¨bashæ¥æ‰§è¡Œã€‚é‚£æƒ³å¿…æ˜¯bash/shå¯¹aliasæ˜¯å¦é»˜è®¤å±•å¼€è¿™ä¸€ç‚¹ä¸Šæ˜¯æœ‰åŒºåˆ«çš„äº†ã€‚ç¿»é˜…äº†ä¸‹Bashçš„manæ‰‹å†Œï¼Œå‘ç°å¯ä»¥é€šè¿‡è®¾ç½®expand_aliasesé€‰é¡¹æ¥æ‰“å¼€aliaså±•å¼€çš„åŠŸèƒ½ï¼Œé»˜è®¤åœ¨éäº¤äº’å¼Shellä¸‹æ˜¯å…³é—­çš„ï¼ˆä»€ä¹ˆæ˜¯äº¤äº’å¼ç™»å½•Shell)<br>ä¿®æ”¹ä¸‹util.shï¼Œæ‰“å¼€è¿™ä¸ªé€‰é¡¹å°±Okäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"># Expand aliases in script</span><br><span class="line">shopt -s expand_aliases</span><br><span class="line">alias ssh&#x3D;&#39;ssh -o StrictHostKeyChecking&#x3D;no -o LogLevel&#x3D;quiet -o BatchMode&#x3D;yes&#39;</span><br></pre></td></tr></table></figure>

<h3 id="2-awkæ‰“å°é™¤ç¬¬ä¸€åˆ—ä¹‹å¤–çš„å…¶ä»–åˆ—"><a href="#2-awkæ‰“å°é™¤ç¬¬ä¸€åˆ—ä¹‹å¤–çš„å…¶ä»–åˆ—" class="headerlink" title="2. awkæ‰“å°é™¤ç¬¬ä¸€åˆ—ä¹‹å¤–çš„å…¶ä»–åˆ—"></a>2. awkæ‰“å°é™¤ç¬¬ä¸€åˆ—ä¹‹å¤–çš„å…¶ä»–åˆ—</h3><p>awkç”¨æ¥æˆªå–è¾“å…¥è¡Œä¸­çš„æŸå‡ åˆ—å¾ˆæœ‰ç”¨ï¼Œå½“æ—¶å¦‚æœè¦æ’é™¤æŸå‡ åˆ—å‘¢ï¼Ÿ ä¾‹å¦‚æœ‰å¦‚ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;test.txt</span><br><span class="line">1 2 3 4 5</span><br><span class="line">10 20 30 40 50</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç è§£å†³:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ awk &#39;&#123;$1&#x3D;&quot;&quot;;print $0&#125;&#39; &#x2F;tmp&#x2F;test.txt</span><br><span class="line"> 2 3 4 5</span><br><span class="line"> 20 30 40 50</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å‰é¢å¤šäº†ä¸€ä¸ªç©ºæ ¼ï¼Œå¯ä»¥ç”¨cutå‘½ä»¤ç¨å¾®è°ƒæ•´ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ awk &#39;&#123;$1&#x3D;&quot;&quot;;print $0&#125;&#39; &#x2F;tmp&#x2F;test.txt | cut -c2-</span><br><span class="line">2 3 4 5</span><br><span class="line">20 30 40 50</span><br></pre></td></tr></table></figure>

<h3 id="3-å·§ç”¨bashçš„å‘½ä»¤å±•å¼€åŠŸèƒ½å¤‡ä»½æ–‡ä»¶"><a href="#3-å·§ç”¨bashçš„å‘½ä»¤å±•å¼€åŠŸèƒ½å¤‡ä»½æ–‡ä»¶" class="headerlink" title="3. å·§ç”¨bashçš„å‘½ä»¤å±•å¼€åŠŸèƒ½å¤‡ä»½æ–‡ä»¶"></a>3. å·§ç”¨bashçš„å‘½ä»¤å±•å¼€åŠŸèƒ½å¤‡ä»½æ–‡ä»¶</h3><p>å‡è®¾è¦å¤‡ä»½æ–‡ä»¶/your/path/to/file.listä¸º/your/path/to/file.list.20121106ï¼Œå¸¸è§„çš„æ–¹æ³•æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp &#x2F;your&#x2F;path&#x2F;to&#x2F;file.list &#x2F;your&#x2F;path&#x2F;to&#x2F;file.list.20121106</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·é‡å¤å†™ä¸Šä¸€é•¿ä¸²çš„è·¯å¾„ï¼Œæ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼Œè¿™é‡Œåˆ©ç”¨bashçš„å±•å¼€ç‰¹æ€§å¯ä»¥è¿™æ ·åšï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cp &#x2F;your&#x2F;path&#x2F;to&#x2F;file.list&#123;,.20180406&#125;</span><br></pre></td></tr></table></figure>
<p>/your/path/to/file.list{,.20121106}è¿™ä¸€éƒ¨åˆ†ä¼šå±•å¼€ä¸º/your/path/to/file.list /your/path/to/file.list.20121106,å†å°†æ­¤ä¼ ç»™cpå‘½ä»¤ï¼Œå°±è¾¾åˆ°äº†ä¸å‰é¢åŒæ ·çš„æ•ˆæœã€‚ï¼ˆæ€è·¯åŒls *ï¼‰ã€‚å…·ä½“å¯ä»¥man bashä¸­çš„Brace Expansionè¿™ä¸€æ®µã€‚</p>
<h3 id="4-ä½ çŸ¥é“sedçš„è¿™ä¸ªç‰¹æ€§å—ï¼Ÿ"><a href="#4-ä½ çŸ¥é“sedçš„è¿™ä¸ªç‰¹æ€§å—ï¼Ÿ" class="headerlink" title="4. ä½ çŸ¥é“sedçš„è¿™ä¸ªç‰¹æ€§å—ï¼Ÿ"></a>4. ä½ çŸ¥é“sedçš„è¿™ä¸ªç‰¹æ€§å—ï¼Ÿ</h3><p>å‡è®¾ä¸€ä¸ªæ–‡ä»¶çš„æ¯ä¸€è¡Œä¸ºä¸€ä¸ªè·¯å¾„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;test.txt</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;hello</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;hello&#x2F;world</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;good</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;good&#x2F;bye</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨è¦æŠŠ/home/kodango/goodæ›¿æ¢æˆ/home/kodango/badï¼Œæ™®é€šçš„ä½œæ³•æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sed -n &#39;s&#x2F;\&#x2F;home\&#x2F;kodango\&#x2F;good&#x2F;\&#x2F;home\&#x2F;kodango\&#x2F;bye&#x2F;p&#39; &#x2F;tmp&#x2F;test.txt </span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;bye</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;bye&#x2F;bye</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºè·¯å¾„ä¸­çš„åˆ†éš”ç¬¦ä¸sedçš„æ›¿æ¢å‘½ä»¤çš„åˆ†éš”ç¬¦éƒ½æ˜¯â€™/â€˜ï¼Œæ‰€ä»¥éœ€è¦è½¬ä¹‰ï¼Œéå¸¸éº»çƒ¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œsedå¯ä»¥æ›´æ”¹åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ä½¿ç”¨#ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -n &#39;s#&#x2F;home&#x2F;kodango&#x2F;good#&#x2F;home&#x2F;kodango&#x2F;bad#p&#39; &#x2F;tmp&#x2F;test.txt </span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;bad</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;bad&#x2F;bye</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±æ¸…çˆ½å¤šäº†ã€‚ è¡¥å……ï¼Œå¦‚æœæ˜¯åœ¨åœ°å€å¯¹ä¸­ä½¿ç”¨ï¼Œé¦–ä¸ªåˆ†éš”ç¬¦å‰é¢è¦åŠ åæ–œæ ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sed -n &#39;\#&#x2F;home&#x2F;kodango&#x2F;#p&#39; &#x2F;tmp&#x2F;test.txt </span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;hello</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;hello&#x2F;world</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;good</span><br><span class="line">&#x2F;home&#x2F;kodango&#x2F;good&#x2F;bye</span><br></pre></td></tr></table></figure>

<h3 id="5-åˆå¹¶è¿ç»­é‡å¤çš„å­—ç¬¦ï¼ˆå³squeezeæ“ä½œï¼‰"><a href="#5-åˆå¹¶è¿ç»­é‡å¤çš„å­—ç¬¦ï¼ˆå³squeezeæ“ä½œï¼‰" class="headerlink" title="5. åˆå¹¶è¿ç»­é‡å¤çš„å­—ç¬¦ï¼ˆå³squeezeæ“ä½œï¼‰"></a>5. åˆå¹¶è¿ç»­é‡å¤çš„å­—ç¬¦ï¼ˆå³squeezeæ“ä½œï¼‰</h3><p>ä¾‹å¦‚è¦åˆå¹¶ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­è¿ç»­çš„å¤šä¸ªç©ºæ ¼ï¼Œå‡è®¾å­—ç¬¦ä¸²ä¸ºâ€™print hello, worldâ€™ã€‚ ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨sedå‘½ä»¤ï¼Œæ‰«ææ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ›¿æ¢2ä¸ªä»¥ä¸Šçš„ç©ºæ ¼ä¸º1æ ¼:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#39;print  hello,   world  &#39; | sed -r &#39;s&#x2F; &#123;2,&#125;&#x2F; &#x2F;g&#39;</span><br><span class="line">print hello, world</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§æ–¹æ³•ï¼Œä½¿ç”¨trå‘½ä»¤çš„-sé€‰é¡¹ï¼Œä¸“é—¨å°±æ˜¯ä¸ºäº†åˆå¹¶è¿ç»­é‡å¤çš„å­—ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#39;print  hello,   world  &#39; | tr -s &#39; &#39;</span><br><span class="line">print hello, world</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä½¿ç”¨awkçš„åŸŸèµ‹å€¼æ¥å®Œæˆè¯¥ç›®çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#39;print  hello,   world  &#39; | awk &#39;$1&#x3D;$1&#39;</span><br><span class="line">print hello, world</span><br></pre></td></tr></table></figure>

<h3 id="6-å°†æ–‡æœ¬ä¸­æŸåˆ—ç›¸åŒçš„è¡Œè¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­"><a href="#6-å°†æ–‡æœ¬ä¸­æŸåˆ—ç›¸åŒçš„è¡Œè¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­" class="headerlink" title="6. å°†æ–‡æœ¬ä¸­æŸåˆ—ç›¸åŒçš„è¡Œè¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­"></a>6. å°†æ–‡æœ¬ä¸­æŸåˆ—ç›¸åŒçš„è¡Œè¾“å‡ºåˆ°ä¸åŒçš„æ–‡ä»¶ä¸­</h3><p>æ ‡é¢˜æœ‰ç‚¹ç»•å£ï¼Œæˆ‘ä»¬ä»¥å®é™…ä¾‹å­æ¥è®²è§£ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;test.txt</span><br><span class="line">a char</span><br><span class="line">1 int</span><br><span class="line">2 int</span><br><span class="line">b char</span><br><span class="line">abc string</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†è¯¥æ–‡æœ¬ä¸­çš„è¡ŒæŒ‰ç¬¬äºŒåˆ—çš„å€¼å½’ç±»ï¼Œå¹¶ä¸”è¾“å‡ºåˆ°ç›¸åº”çš„æ–‡ä»¶ä¸­ï¼Œæ–‡ä»¶åä¸ºç¬¬äºŒåˆ—çš„åç§°ã€‚ä¾‹å¦‚ç¬¬2è¡Œã€ç¬¬3è¡Œä¼šè¾“å‡ºåˆ°int.txtæ–‡ä»¶ä¸­ï¼Œè€Œç¬¬1è¡Œã€ç¬¬4è¡Œåˆ™è¾“å‡ºåˆ°char.txtï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>æˆ‘æ²¡æœ‰æ‰¾åˆ°å…¶å®ƒç®€å•çš„æ–¹æ³•ï¼Œåªæ‰¾åˆ°ä¸€ç§ç”¨awkæ¥å¤„ç†çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">awk &#39;&#123;print $1 &gt; $2 &quot;.txt&quot;&#125;&#39; &#x2F;tmp&#x2F;test.txt</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥æ£€æŸ¥ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">grep -nH . *</span><br><span class="line">char.txt:1:a</span><br><span class="line">char.txt:2:b</span><br><span class="line">int.txt:1:1</span><br><span class="line">int.txt:2:2</span><br><span class="line">string.txt:1:abc</span><br></pre></td></tr></table></figure>
<h3 id="7-ç”¨execå‘½ä»¤æ¥å®Œæˆé‡å®šå‘"><a href="#7-ç”¨execå‘½ä»¤æ¥å®Œæˆé‡å®šå‘" class="headerlink" title="7. ç”¨execå‘½ä»¤æ¥å®Œæˆé‡å®šå‘"></a>7. ç”¨execå‘½ä»¤æ¥å®Œæˆé‡å®šå‘</h3><p>ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­å¼€å§‹ï¼Œç°åœ¨éœ€è¦ä¸€ä¸ªè„šæœ¬ï¼Œå®ƒå¯ä»¥æ¥å—ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºå‚æ•°ï¼Œç„¶åæŒ‰è¡Œè¯»å–è¯¥æ–‡ä»¶çš„å†…å®¹å¹¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶åï¼Œåˆ™é»˜è®¤ä»æ ‡å‡†è¾“å…¥è¯»ã€‚é¦–å…ˆæŒ‰ä¸Šé¢çš„åŠŸèƒ½éœ€æ±‚å†™å‡ºä¸€ä¸ªå¯ä»¥å®ŒæˆåŠŸèƒ½çš„è„šæœ¬:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat test.sh </span><br><span class="line"></span><br><span class="line">filename&#x3D;$1</span><br><span class="line"></span><br><span class="line">if [ -z &quot;$filename&quot; ]; then</span><br><span class="line">    while read line; do</span><br><span class="line">        echo $line</span><br><span class="line">    done</span><br><span class="line">else</span><br><span class="line">    while read line; do</span><br><span class="line">        echo $line</span><br><span class="line">    done &lt; $filename</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ¢execæ¥å®ç°é‡å®šå‘ï¼Œå¯ä»¥æŠŠè„šæœ¬å†™å¾—æ›´ä¼˜é›…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat test1.sh </span><br><span class="line"></span><br><span class="line">filename&#x3D;$1</span><br><span class="line"></span><br><span class="line">if [ -n &quot;$filename&quot; ]; then</span><br><span class="line">    exec 0&lt; $filename</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">while read line; do</span><br><span class="line">    echo $line</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„å…³é”®åœ¨ç¬¬5è¡Œä»£ç ï¼Œexecå‘½ä»¤ä¸ä»…å¯ä»¥ç”¨äºæ‰§è¡Œå‘½ä»¤ï¼Œè¿˜å¯ä»¥ç”¨äºæ‰“å¼€ã€å…³é—­æˆ–è€…å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨execå°†æŒ‡å®šçš„æ–‡ä»¶åæ‰“å¼€é‡å®šå‘åˆ°æ ‡å‡†è¾“å…¥ã€‚ç±»ä¼¼åœ°å¯ä»¥ç”¨exec &gt;$filenameå°†æ–‡ä»¶é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºã€‚æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šåšä¸€ä¸ªè¯•éªŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ exec 3&gt;&amp;1                   # é¦–å…ˆå°†fd 3é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œä½œä¸ºæ ‡å‡†è¾“å‡ºçš„ä¸€ä¸ªå¤‡ä»½</span><br><span class="line"></span><br><span class="line">$ ls &#x2F;proc&#x2F;629&#x2F;fd&#x2F;&#123;1,3&#125; -l    # ç°åœ¨fd 3å’Œfd 1æŒ‡å‘åŒä¸€ä¸ªè®¾å¤‡æ–‡ä»¶</span><br><span class="line">lrwx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -&gt; &#x2F;dev&#x2F;pts&#x2F;1</span><br><span class="line">lrwx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;3 -&gt; &#x2F;dev&#x2F;pts&#x2F;1</span><br><span class="line"></span><br><span class="line">$ exec &gt;stdout               # ç°åœ¨æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°stdoutè¿™ä¸ªæ–‡ä»¶ä¸­</span><br><span class="line"></span><br><span class="line">$ ls &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -l        # å¦‚æœä½ æ­¤åˆ»åœ¨åŒä¸€ä¸ªç»ˆç«¯ä¸‹æ‰§è¡Œæœ¬å‘½ä»¤æ˜¯æ²¡æœ‰è¿”å›çš„</span><br><span class="line"></span><br><span class="line">$ ls &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -l        # ç°åœ¨é‡æ–°æ‰“å¼€ä¸€ä¸ªç»ˆç«¯çœ‹çœ‹ï¼Œç¡®å®å·²ç»é‡å®šå‘åˆ°stdoutè¿™ä¸ªæ–‡ä»¶</span><br><span class="line">l-wx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -&gt; &#x2F;home&#x2F;kodango&#x2F;stdout</span><br><span class="line"></span><br><span class="line">$ exec 1&gt;&amp;3                   # ç°åœ¨é‡æ–°æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°ä¹‹å‰å¤‡ä»½çš„fd 3ä¸Š</span><br><span class="line">$ ls &#x2F;proc&#x2F;629&#x2F;fd&#x2F;&#123;1,3&#125; -l  # ç°åœ¨å±å¹•å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ï¼Œä½†æ˜¯fd 3è¿™ä¸ªæè¿°ç¬¦è¿˜æ‰“å¼€ï¼Œéœ€è¦å…³é—­</span><br><span class="line">lrwx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -&gt; &#x2F;dev&#x2F;pts&#x2F;1</span><br><span class="line">lrwx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;3 -&gt; &#x2F;dev&#x2F;pts&#x2F;1</span><br><span class="line"></span><br><span class="line">$ exec 3&gt;&amp;-                   # å…³é—­fd 3</span><br><span class="line">$ ls &#x2F;proc&#x2F;629&#x2F;fd&#x2F;3 -l</span><br><span class="line">ls: cannot access &#x2F;proc&#x2F;629&#x2F;fd&#x2F;3: No such file or directory</span><br><span class="line"></span><br><span class="line">$ cat stdout                  # æ£€æŸ¥stdoutæ–‡ä»¶ï¼Œç¡®å®æœ‰ä¹‹å‰è¢«åƒæ‰çš„è¾“å‡º</span><br><span class="line">l-wx------ 1 kodango kodango 64 Nov 10 00:26 &#x2F;proc&#x2F;629&#x2F;fd&#x2F;1 -&gt; &#x2F;home&#x2F;kodango&#x2F;stdout</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€ç‚¹åœ¨while read; do xxx; done &lt; fileå†…éƒ¨ä»éœ€è¦ä»æ ‡å‡†è¾“å…¥è¯»å–å†…å®¹æ—¶éå¸¸æœ‰ç”¨ï¼Œæ­¤æ—¶å¿…é¡»è¦å°†å¾ªç¯å¤–éƒ¨çš„é‡å®šå‘å’Œå†…éƒ¨çš„å‰¥ç¦»å¼€æ¥ã€‚</p>
<h3 id="8-å¼•å·ä¹‹é—´çš„åŒºåˆ«"><a href="#8-å¼•å·ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="8. å¼•å·ä¹‹é—´çš„åŒºåˆ«"></a>8. å¼•å·ä¹‹é—´çš„åŒºåˆ«</h3><p>Shellä¸­æ¯”è¾ƒè®©äººæŠ“ç‹‚çš„æ˜¯å„ç§å¼•å·çš„å¤„ç†ï¼Œå…¶ä¸­ï¼Œåå¼•å·(cmd)æ˜¯æœ€å®¹æ˜“æŒæ¡çš„ï¼Œå®ƒå…¶å®å’Œ$(cmd)æ˜¯å·®ä¸å¤šçš„ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¼•å·çš„ä½œç”¨æœ‰å‡ ç‚¹ï¼Œä¸€ä¸ªæ˜¯ä¸ºäº†å°†å¤šä¸ªå› ä¸ºç©ºæ ¼æˆ–è€…å›è½¦ç­‰åˆ†éš”ç¬¦éš”å¼€çš„å­—ç¬¦ä¸²åˆåœ¨ä¸€èµ·ï¼Œé¿å…è¢«å‘½ä»¤è¡Œè§£æåˆ†å¼€ï¼Œä¾‹å¦‚&quot;one two three&quot;å°±æ˜¯ä¸€æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åƒone two threeä¼šè¢«è§£ææˆä¸‰ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ï¼›å¦å¤–ä¸€æ–¹é¢ï¼Œå¼•å·å¯ä»¥è®©ä¸€äº›ç‰¹æ®Šç¬¦å·ä¿æŒåŸä¹‰ã€‚</span><br><span class="line"></span><br><span class="line">å…¶ä¸­ï¼Œå•å¼•å·çš„å¤„ç†æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œè¢«å•å¼•å·åŒ…æ‹¬çš„æ‰€æœ‰å­—ç¬¦éƒ½ä¿ç•™åŸæœ‰çš„æ„æ€ï¼Œä¾‹å¦‚&#39;$a&#39;ä¸ä¼šè¢«å±•å¼€, &#39;cmd&#39;ä¹Ÿä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼›è€ŒåŒå¼•å·ï¼Œåˆ™ç›¸å¯¹æ¯”è¾ƒæ¾ï¼Œåœ¨åŒå¼•å·ä¸­ï¼Œä»¥ä¸‹å‡ ä¸ªå­—ç¬¦$, , \ä¾ç„¶æœ‰å…¶ç‰¹æ®Šçš„å«ä¹‰ï¼Œæ¯”å¦‚$å¯ä»¥ç”¨äºå˜é‡å±•å¼€, åå¼•å·å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œåæ–œæ å¯ä»¥ç”¨äºè½¬ä¹‰ã€‚ä½†æ˜¯ï¼Œåœ¨åŒå¼•å·åŒ…å›´çš„å­—ç¬¦ä¸²é‡Œï¼Œåæ–œæ çš„è½¬ä¹‰ä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå®ƒåªèƒ½è½¬ä¹‰$, &#96;, &quot;, æˆ–è€…newlineï¼ˆå›è½¦ï¼‰è¿™å‡ ä¸ªå­—ç¬¦ï¼Œåé¢å¦‚æœè·Ÿç€çš„ä¸æ˜¯è¿™å‡ ä¸ªå­—ç¬¦ï¼Œåªä¸ä¼šè¢«é»‘åº•ï¼Œåæ–œæ ä¼šè¢«ä¿ç•™ï¼Œä¾‹å¦‚ï¼š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ echo &quot;\$,\&quot;,\&#96;,\&#39;,\t&quot;</span><br><span class="line">$,&quot;,&#96;,\&#39;,\t</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®åŒå¼•å·å’Œå•å¼•å·çš„åŒºåˆ«å·²ç»è¯´å¾—å·®ä¸å¤šäº†ã€‚ä¸è¿‡è¿˜å¯ä»¥å†è¯´å‡ ä¸ªç‰¹æ®Šçš„ç”¨æ³•ï¼Œå‰é¢è¯´è¿‡å¯ä»¥åœ¨åŒå¼•å·å†…éƒ¨ä½¿ç”¨å•å¼•å·ï¼Œä½ æœ‰æƒ³è¿‡åœ¨å•å¼•å·é‡Œé¢ä½¿ç”¨å•å¼•å·å—ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#39;\&#39;&#39;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯å‘ç°ä¸èƒ½ç”¨ï¼Œå› ä¸ºå•å¼•å·ä¸­åæ–œæ æ˜¯æ²¡æœ‰è½¬ä¹‰çš„æ•ˆæœçš„ï¼Œä»»ä½•å­—ç¬¦éƒ½æ²¡æœ‰ç‰¹æ®Šçš„å«ä¹‰ã€‚é‚£å°±æ²¡æœ‰åŠæ³•äº†å—ï¼Ÿæ–¹æ³•æ€»æ˜¯æœ‰çš„ï¼Œå¯ä»¥åœ¨ç¬¬ä¸€ä¸ªå•å¼•å·å‰é¢åŠ ä¸ª$ç¬¦å·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $&#39;\&#39;&#39;</span><br><span class="line">&#39;</span><br></pre></td></tr></table></figure>

<h3 id="9-ç‰¹æ®Šç”¨æ³•-â€™stringâ€™"><a href="#9-ç‰¹æ®Šç”¨æ³•-â€™stringâ€™" class="headerlink" title="9. ç‰¹æ®Šç”¨æ³•$â€™stringâ€™"></a>9. ç‰¹æ®Šç”¨æ³•$â€™stringâ€™</h3><p>å‰é¢ä¸€ç‚¹ä¸­å·²ç»ä»‹ç»äº† $â€™stringâ€™è¿™ç§ç”¨æ³•ï¼Œæ¯”å¦‚ $â€™â€™â€™ï¼Œä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ç”¨ï¼Œé€šä¿—åœ°è®²ï¼Œå°±æ˜¯åœ¨è¿™ç§è¯­æ³•é‡Œä¸€äº›è½¬ä¹‰å­—ç¬¦ä¸²æ˜¯è¢«è®¤å¯çš„ï¼Œäº‹å®ä¸Šæœ‰æ•ˆåœ°çš„è½¬ä¹‰åº•å­—ç¬¦ä¸²åˆ—è¡¨å¯ä»¥çœ‹è¿™é‡Œï¼Œä¾‹å¦‚bï¼Œâ€™,n,f,nnn,xhhç­‰ç­‰ï¼Œæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ã€‚ $â€™stringâ€™çš„è¿™ä¸ªç‰¹æ€§ï¼Œå…¶å®ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å¾ˆæœ‰ç”¨çš„æŠ€å·§ï¼š</p>
<p>$ echo $â€™\x41â€™<br>A<br>ä»–å¯ä»¥å°†ASCIIå¯¹åº”çš„å­—ç¬¦èµ‹å€¼ç»™æŸä¸ªå˜é‡æˆ–è€…è¾“å‡ºã€‚</p>
<h3 id="10-ç”¨åŒå¼•å·æ¯”ä¸ç”¨æ›´åŠ å®‰å…¨"><a href="#10-ç”¨åŒå¼•å·æ¯”ä¸ç”¨æ›´åŠ å®‰å…¨" class="headerlink" title="10. ç”¨åŒå¼•å·æ¯”ä¸ç”¨æ›´åŠ å®‰å…¨"></a>10. ç”¨åŒå¼•å·æ¯”ä¸ç”¨æ›´åŠ å®‰å…¨</h3><p>åŒå¼•å·é™¤äº†å‰é¢ç¬¬10ç‚¹è®²åˆ°çš„å»é™¤ç‰¹æ®Šæ¶µä¹‰çš„ä½œç”¨å¤–ï¼Œè¿˜å¯ä»¥é¿å…å­—ç¬¦ä¸²è¢«åˆ†éš”è§£æï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#96;ls -l&#96;</span><br><span class="line">total 4.0K -rw-r--r-- 1 kodango kodango 4 Nov 10 20:09 1 -rw-r--r-- 1 kodango kodango 0 Nov 10 20:09 2</span><br><span class="line">$ echo &quot;&#96;ls -l&#96;&quot;</span><br><span class="line">total 4.0K</span><br><span class="line">-rw-r--r-- 1 kodango kodango 4 Nov 10 20:09 1</span><br><span class="line">-rw-r--r-- 1 kodango kodango 0 Nov 10 20:09 2</span><br></pre></td></tr></table></figure>
<p>å‰è€…æ²¡æœ‰åŠ åŒå¼•å·ï¼Œls -lè¾“å‡ºè¡Œä¹‹é—´çš„å›è½¦å°±è¢«åƒæ‰äº†ã€‚åŸå› æ˜¯ï¼Œå½“ls -lè¿”å›çš„ç»“æœä¼ é€’ç»™echoä¹‹å‰ï¼Œä¼šå…ˆè¢«shellè¿›è¡Œå‚æ•°è§£æï¼Œè€Œshellæ˜¯ç”¨IFSå®šä¹‰çš„åˆ†éš”ç¬¦æ¥åˆ†éš”å­—ç¬¦ä¸²çš„ï¼Œä¸€èˆ¬åŒ…æ‹¬nï¼Œæ‰€ä»¥å®ƒæŠŠè§£æåçš„ç»“æœå†ä¼ é€’ç»™echoï¼Œå°±æˆä¸ºecho â€œline 1â€¦.â€ â€œline 2â€¦â€è¿™ç§å½¢å¼äº†ï¼Œç»“æœå°±åƒä¸Šé¢ä¸€æ ·ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è€Œç”¨åŒå¼•å·åŒ…æ‹¬èµ·æ¥å¯ä»¥é¿å¼€å­—ç¬¦ä¸²è¢«æ‹†å¼€è§£æï¼Œå› ä¸ºshellè®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„å­—ç¬¦ä¸²ã€‚æ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤šç”¨å¼•å·åŒ…æ‹¬å˜é‡æ˜¯å¥½çš„ï¼Œ&quot;$var&quot;æ¯”$varæ›´å®‰å…¨ã€‚</span><br></pre></td></tr></table></figure>

<h3 id="11-æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”åœ¨æ¯è¡Œå¼€å¤´æ·»åŠ è¡Œå·"><a href="#11-æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”åœ¨æ¯è¡Œå¼€å¤´æ·»åŠ è¡Œå·" class="headerlink" title="11. æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”åœ¨æ¯è¡Œå¼€å¤´æ·»åŠ è¡Œå·"></a>11. æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”åœ¨æ¯è¡Œå¼€å¤´æ·»åŠ è¡Œå·</h3><p>æœ‰ä¸¤ç§åšæ³•ï¼Œç¬¬ä¸€ç§å€ŸåŠ©catå’Œnlå‘½ä»¤æ¥å®Œæˆï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat test.txt | nl</span><br><span class="line">     1    line 1 </span><br><span class="line">     2    line 2</span><br><span class="line">$ cat -n test.txt</span><br><span class="line">     1    line 1 </span><br><span class="line">     2    line 2</span><br><span class="line">$ nl test.txt     </span><br><span class="line">     1    line 1 </span><br><span class="line">     2    line 2</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ä¸€ç§åšæ³•æ˜¯ç”¨sedå‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sed &#39;&#x3D;&#39; test.txt | sed &#39;N;s&#x2F;\n&#x2F;\t&#x2F;&#39;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡cat -næˆ–è€…cat -bå‘½ä»¤ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯åè€…ä¸ä¼šç»™ç©ºè¡Œå¢åŠ è¡Œå·,nlå‘½ä»¤ç‰¹åˆ«æ–¹ä¾¿,è€Œä¸”ç©ºè¡Œæ²¡æœ‰è¡Œå·;</p>
<h3 id="12-åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ç›¸åŒçš„è¡Œå’Œä¸åŒçš„è¡Œ"><a href="#12-åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ç›¸åŒçš„è¡Œå’Œä¸åŒçš„è¡Œ" class="headerlink" title="12. åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ç›¸åŒçš„è¡Œå’Œä¸åŒçš„è¡Œ"></a>12. åˆ†åˆ«è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ç›¸åŒçš„è¡Œå’Œä¸åŒçš„è¡Œ</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo test&#123;,2&#125;.txt;paste test&#123;,2&#125;.txt</span><br><span class="line">test.txt test2.txt</span><br><span class="line">line 1     line 11</span><br><span class="line">line 2    line 2</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ä¹‹é—´ç›¸åŒçš„è¡Œï¼Œåªæœ‰test.txtæ‹¥æœ‰çš„è¡Œä»¥åŠåªæœ‰test2.txtæ‹¥æœ‰çš„è¡Œï¼Œæ€ä¹ˆåšï¼Ÿé¦–å…ˆå¯ä»¥ä½¿ç”¨grep -fï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ grep -f test&#123;,2&#125;.txt</span><br><span class="line">line 2</span><br><span class="line">$ grep -vf test&#123;,2&#125;.txt</span><br><span class="line">line 11</span><br><span class="line">$ grep -vf test&#123;2,&#125;.txt</span><br><span class="line">line 1</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ç§é€‰æ‹©æ˜¯commå‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯ä¸“é—¨ç”¨äºæ¯”è¾ƒæ–‡ä»¶çš„ï¼š comm - compare two sorted files line by lineã€‚ ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œcommæ¯”è¾ƒä¸¤ä¸ªæ’åºå¥½çš„æ–‡ä»¶è¿”å›çš„ç»“æœæœ‰ä¸‰åˆ—ï¼Œç¬¬ä¸€åˆ—æ˜¯åªæœ‰åœ¨æ–‡ä»¶Aä¸­æœ‰çš„è¡Œï¼Œç¬¬äºŒåˆ—æ˜¯åªæœ‰åœ¨æ–‡ä»¶Bä¸­æœ‰çš„è¡Œï¼Œç¬¬ä¸‰åˆ—åˆ™æ˜¯ä¸¤ä¸ªæ–‡ä»¶å…±æœ‰çš„è¡Œï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ comm test.txt test2.txt                </span><br><span class="line">line 1 </span><br><span class="line">    line 11</span><br><span class="line">        line 2</span><br></pre></td></tr></table></figure>
<p>è¦å¾—åˆ°æœ€åˆè¦æ±‚çš„ç»“æœï¼Œåˆ™åªéœ€è¦å–ç›¸åº”çš„åˆ—å°±å¯ä»¥äº†ã€‚commå‘½ä»¤éå¸¸äººæ€§åŒ–åœ°è€ƒè™‘åˆ°è¿™ä¸ªéœ€æ±‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ comm test.txt test2.txt -1 -2</span><br><span class="line">line 2</span><br><span class="line">$ comm test.txt test2.txt -2 -3</span><br><span class="line">line 1 </span><br><span class="line">$ comm test.txt test2.txt -1 -3</span><br><span class="line">line 11</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ=1, -2ä¸-3è¿™ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºä¸è¾“å‡ºç¬¬1ã€2æˆ–è€…3åˆ—ã€‚</p>
<h3 id="13-è·å–è¢«sourceçš„è„šæœ¬çš„åç§°"><a href="#13-è·å–è¢«sourceçš„è„šæœ¬çš„åç§°" class="headerlink" title="13. è·å–è¢«sourceçš„è„šæœ¬çš„åç§°"></a>13. è·å–è¢«sourceçš„è„šæœ¬çš„åç§°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œè„šæœ¬çš„åç§°å¯ä»¥é€šè¿‡$0è·å–ï¼Œä½†æ˜¯è¿™åœ¨è¢«sourceå¯¼å…¥çš„è„šæœ¬ä¸­å´ä¸æˆç«‹ã€‚å‡è®¾Aè„šæœ¬ä¸­sourceäº†Bè„šæœ¬ï¼Œé‚£ä¹ˆå®ƒæ˜¯æŠŠBçš„ä»£ç å¯¼å…¥åˆ°Açš„ç¯å¢ƒä¸­ç›´æ¥æ‰§è¡Œçš„ï¼Œå› æ­¤Aå’ŒBçš„ä»£ç å…¶å®æ˜¯åœ¨åŒä¸€ä¸ªæ‰§è¡Œç¯å¢ƒä¸‹åˆ†ä¸å¼€çš„ï¼ŒBçš„ä»£ç ä¸­è®¿é—®åˆ°çš„$0ï¼Œç”šè‡³$1, $2ç­‰ä½ç½®å‚æ•°éƒ½æ˜¯ä¸Aè„šæœ¬æ˜¯ä¸€è‡´çš„ã€‚</span><br></pre></td></tr></table></figure>

<p>å› æ­¤$0å¹¶éæ˜¯è¢«å¯¼å…¥çš„è„šæœ¬çš„åç§°ï¼Œå®é™…ä¸Šï¼ŒBashå°†è¢«sourceçš„è„šæœ¬åç§°ä¿å­˜åœ¨ä¸€ä¸ªå«BASH_SOURCEçš„æ•°ç»„ä¸­ï¼Œè¯¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ­£æ˜¯å½“å‰è¢«sourceçš„è„šæœ¬çš„åç§°ã€‚è¯¥å˜é‡ä¸æˆ‘åœ¨bashè·å–å½“å‰å‡½æ•°åä¸­ä»‹ç»çš„FUNCNAMEæ˜¯ç±»ä¼¼çš„ï¼Œå½“ä¸€ä¸ªè„šæœ¬è¢«sourceæ—¶ï¼Œå®ƒçš„åç§°å°±è¢«å‹å…¥åˆ°è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Šï¼Œä¸¾ä¸ªå®é™…çš„ä¾‹å­ï¼Œå‡è®¾æœ‰ä¸‰ä¸ªè„šæœ¬a.sh,b.sh,c.shï¼Œå®ƒä»¬çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat a.sh </span><br><span class="line">. .&#x2F;b.sh</span><br><span class="line">echo &quot;\$0&#x3D;$0&quot;</span><br><span class="line">echo &quot;\$&#123;BASH_SOURCE[0]&#125;&#x3D;$&#123;BASH_SOURCE[0]&#125;&quot;</span><br><span class="line">echo &quot;\$BASH_SOURCE&#x3D;($&#123;BASH_SOURCE[@]&#125;)&quot;</span><br><span class="line"></span><br><span class="line">$ cat b.sh </span><br><span class="line">. .&#x2F;c.sh</span><br><span class="line">. .&#x2F;c.sh</span><br><span class="line">echo &quot;\$0&#x3D;$0&quot;</span><br><span class="line">echo &quot;\$&#123;BASH_SOURCE[0]&#125;&#x3D;$&#123;BASH_SOURCE[0]&#125;&quot;</span><br><span class="line">echo &quot;\$BASH_SOURCE&#x3D;($&#123;BASH_SOURCE[@]&#125;)&quot;</span><br><span class="line"></span><br><span class="line">$ cat c.sh </span><br><span class="line">$ cat c.sh </span><br><span class="line">echo &quot;\$0&#x3D;$0&quot;</span><br><span class="line">echo &quot;\$&#123;BASH_SOURCE[0]&#125;&#x3D;$&#123;BASH_SOURCE[0]&#125;&quot;</span><br><span class="line">echo &quot;\$BASH_SOURCE&#x3D;($&#123;BASH_SOURCE[@]&#125;)&quot;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æ‰§è¡Œa.shè¿™ä¸ªè„šæœ¬ï¼Œå®é™…çš„è¾“å‡ºæ˜¯ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘åœ¨å®é™…çš„è¾“å‡ºä¸­åŠ äº†ä¸€äº›æ³¨é‡Šå’Œç©ºè¡Œï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ bash a.sh</span><br><span class="line"># c.shçš„è¾“å‡º</span><br><span class="line">$0&#x3D;a.sh</span><br><span class="line">$&#123;BASH_SOURCE[0]&#125;&#x3D;.&#x2F;c.sh</span><br><span class="line">$BASH_SOURCE&#x3D;(.&#x2F;c.sh .&#x2F;b.sh a.sh)</span><br><span class="line"></span><br><span class="line"># b.shçš„è¾“å‡º</span><br><span class="line">$0&#x3D;a.sh</span><br><span class="line">$&#123;BASH_SOURCE[0]&#125;&#x3D;.&#x2F;b.sh</span><br><span class="line">$BASH_SOURCE&#x3D;(.&#x2F;b.sh a.sh)</span><br><span class="line"></span><br><span class="line"># a.shçš„è¾“å‡º</span><br><span class="line">$0&#x3D;a.sh</span><br><span class="line">$&#123;BASH_SOURCE[0]&#125;&#x3D;a.sh</span><br><span class="line">$BASH_SOURCE&#x3D;(a.sh)</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨BASH_SOURCEçš„å€¼ï¼Œåœ¨è„šæœ¬ä¸­åˆ¤æ–­æ˜¯è¢«ç›´æ¥æ‰§è¡Œè¿˜æ˜¯è¢«å¯¼å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if [ -n &quot;$BASH_SOURCE&quot; -a &quot;$BASH_SOURCE&quot; !&#x3D; &quot;$0&quot; ]</span><br><span class="line">then</span><br><span class="line">    echo &quot;be sourced by other scripts&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;be run in shell&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<h3 id="14-å‚æ•°å±•å¼€"><a href="#14-å‚æ•°å±•å¼€" class="headerlink" title="14. ${}å‚æ•°å±•å¼€"></a>14. ${}å‚æ•°å±•å¼€</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬çŸ¥é“$&#123;parameter&#125;æ˜¯å±•å¼€å˜é‡parameterè¿™ä¸ªå€¼ï¼Œåœ¨ä¸Šä¸€ç¯‡ç®€æ´çš„bashç¼–ç¨‹æŠ€å·§ä¸­ä¹Ÿæ›¾ç»ä»‹ç»è¿‡$&#123;parameter:-word&#125;è¿™ç§ç”¨æ³•ï¼Œç”¨äºç»™å˜é‡èµ‹ä¸€ä¸ªé»˜è®¤å€¼ã€‚ äº‹å®ä¸Šé™¤æ­¤ä¹‹å¤–ï¼Œå‚æ•°å±•å¼€è¿˜æœ‰è®¸å¤šå½¢å¼ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œé¦–å…ˆè¦è¯´æ˜ä¸€ä¸‹å˜é‡çš„å‡ ç§å€¼çš„å½¢å¼ï¼š</span><br></pre></td></tr></table></figure>

<p>unsetï¼š å˜é‡æœªè®¾ç½®ï¼Œå³å˜é‡ä»æœªå£°æ˜ï¼Œæˆ–è€…è¢«unsetå‘½ä»¤é‡ç½®ï¼›<br>null: å˜é‡å£°æ˜ä½†æœªè¢«èµ‹å€¼ï¼ˆvar=ï¼‰æˆ–è€…è¢«èµ‹å€¼æˆç©ºï¼ˆvar=â€â€ï¼‰ï¼›<br>not nullï¼š å˜é‡è¢«èµ‹å€¼ï¼›<br>unsetå’Œnullåœ¨å‚æ•°å±•å¼€çš„æ—¶å€™è¿˜æ˜¯æœ‰å¾ˆå¤§çš„åŒºåˆ«çš„ï¼Œä»¥ä¸‹æ˜¯å‚æ•°å±•å¼€çš„å„ç§å½¢å¼ï¼š</p>
<p>${parameter:-word}ï¼šå‡å¦‚parameterä¸ºunsetæˆ–è€…nullï¼Œåˆ™å±•å¼€åè¿”å›wordçš„å€¼ï¼›<br>${parameter-word}ï¼šå‡å¦‚parameterä¸ºunsetæ—¶ï¼Œåˆ™å±•å¼€åè¿”å›wordçš„å€¼;<br>${parameter:=word}ï¼šå‡å¦‚parameterä¸ºunsetæˆ–è€…nullï¼Œå°†wordèµ‹å€¼ç»™parameterï¼›<br>${parameter=word}ï¼šå‡å¦‚parameterä¸ºunsetï¼Œå°†wordèµ‹å€¼ç»™parameterï¼›<br>${parameter:?word}ï¼šå‡å¦‚parameterä¸ºunsetæˆ–è€…nullï¼Œåˆ™å°†wordä½œä¸ºé”™è¯¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼›<br>${parameter?word}ï¼šå‡å¦‚parameterä¸ºunsetï¼Œåˆ™å°†wordä½œä¸ºé”™è¯¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼›<br>${parameter:+word}ï¼šå‡å¦‚parameterä¸ºunsetæˆ–è€…nullï¼Œåˆ™ä¸åšå±•å¼€ï¼Œè¿”å›ä¸ºç©ºï¼›ï¼ˆåˆšå¥½ä¸:-ç›¸åï¼‰<br>${parameter:word}ï¼šå‡å¦‚parameterä¸ºunsetï¼Œåˆ™ä¸åšå±•å¼€ï¼Œè¿”å›ä¸ºç©ºï¼›ï¼ˆåˆšå¥½ä¸-ç›¸åï¼‰<br>ä¸Šé¢å…¶å®å‡†ç¡®åœ°åº”è¯¥æ˜¯åˆ†æˆ2ç»„ï¼Œä¸€ç»„å¸¦:ï¼Œä¸€ç»„ä¸å¸¦:ï¼Œä¸å¸¦:çš„è¿™ç»„æ›´åŠ ä¸¥æ ¼ï¼Œåªæ£€æŸ¥unsetè¿™ç§æƒ…å†µã€‚ä»¥:+ä¸ºä¾‹å­, unsetçš„æƒ…å†µå‡æ— è¿”å›ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ unset var &amp;&amp; echo $&#123;var:+hello&#125;</span><br><span class="line">$ unset var &amp;&amp; echo $&#123;var+hello&#125;</span><br></pre></td></tr></table></figure>
<p>å½“varä¸ºç©ºæ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ var&#x3D; &amp;&amp; echo &quot;$&#123;var:+hello&#125;&quot;</span><br><span class="line">$ var&#x3D; &amp;&amp; echo &quot;$&#123;var+hello&#125;&quot;</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<p>å½“varä¸ºéç©ºæ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ var&#x3D;1 &amp;&amp; echo &quot;$&#123;var:+hello&#125;&quot;</span><br><span class="line">hello</span><br><span class="line">$ var&#x3D;1 &amp;&amp; echo &quot;$&#123;var+hello&#125;&quot;</span><br><span class="line">hello</span><br></pre></td></tr></table></figure>
<h3 id="15-å†’å·çš„å¤šç§ä½¿ç”¨åœºæ™¯"><a href="#15-å†’å·çš„å¤šç§ä½¿ç”¨åœºæ™¯" class="headerlink" title="15. å†’å·çš„å¤šç§ä½¿ç”¨åœºæ™¯"></a>15. å†’å·çš„å¤šç§ä½¿ç”¨åœºæ™¯</h3><p>å†’å·æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ç¬¦å·ï¼Œå®ƒçš„ç”¨é€”æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä»‹ç»å‡ ç§å¸¸ç”¨çš„ï¼š</p>
<ol>
<li>å†…ç½®å‘½ä»¤null commandï¼šnopï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸åšï¼Œä¹Ÿå¯ä»¥è¢«å½“ä½œtrueå€¼ä½¿ç”¨ï¼›<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ :</span><br><span class="line">$ echo $?    # return 0</span><br></pre></td></tr></table></figure>
å®ƒä¹Ÿå¯ä»¥åœ¨å¾ªç¯ä¸­å½“ä½œtrueå€¼ï¼Œä¾‹å¦‚:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">while :; do   # ç­‰ä»·äº while true; do</span><br><span class="line">    take-some-action</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if condition</span><br><span class="line">then :</span><br><span class="line">else </span><br><span class="line">    take-some-action</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></li>
<li>å ä½ç¬¦ å†’å·å¯ä»¥åœ¨å¾ˆå¤šåœºæ™¯ä¸‹å……å½“å ä½ç¬¦ï¼Œä¾‹å¦‚ä¹‹å‰ä»‹ç»çš„${parameter=var}ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œä¼šæŠ¥é”™ï¼Œè¡¨ç¤ºæ‰¾ä¸åˆ°å‘½ä»¤ï¼›è¿™æ—¶å¯ä»¥å€Ÿç”¨å†’å·æ¥å®Œæˆèµ‹å€¼ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">: $&#123;parameter&#x3D;var&#125;</span><br></pre></td></tr></table></figure>
åŒæ ·åœ°ï¼Œå¯ä»¥æ¥åˆ¤æ–­å˜é‡æ˜¯å¦èµ‹å€¼ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">: $&#123;parameter1?&#125; $&#123;parameter2?&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16-æ‰©å±•çš„æ‹¬å·å±•å¼€åŠŸèƒ½"><a href="#16-æ‰©å±•çš„æ‹¬å·å±•å¼€åŠŸèƒ½" class="headerlink" title="16. æ‰©å±•çš„æ‹¬å·å±•å¼€åŠŸèƒ½"></a>16. æ‰©å±•çš„æ‹¬å·å±•å¼€åŠŸèƒ½</h3>è¿™ä¸ªåŠŸèƒ½ä¸èƒ½è¯´é¸¡è‚‹ï¼Œä¹Ÿå¯ä»¥äº†è§£ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo &#123;0..3&#125;</span><br><span class="line">0 1 2 3</span><br><span class="line">$ echo &#123;z..a&#125;</span><br><span class="line">z y x w v u t s r q p o n m l k j i h g f e d c b a</span><br><span class="line">$ echo &#123;a..z&#125;</span><br><span class="line">a b c d e f g h i j k l m n o p q r s t u v w x y z</span><br></pre></td></tr></table></figure>
<h3 id="17-å®‰å…¨çš„ä¸­æ‹¬å·"><a href="#17-å®‰å…¨çš„ä¸­æ‹¬å·" class="headerlink" title="17. å®‰å…¨çš„ä¸­æ‹¬å·"></a>17. å®‰å…¨çš„ä¸­æ‹¬å·</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[[]]çš„åŠŸèƒ½æ¯”[]æ›´åŠ å¤šï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ å®‰å…¨ã€‚</span><br><span class="line"></span><br><span class="line">1. é¦–å…ˆ[[]]å†…éƒ¨ä¸ä¼šå‘ç”Ÿæ–‡ä»¶åå±•å¼€å’Œå•è¯åˆ†éš”ã€‚ ä¾‹å¦‚ï¼š</span><br><span class="line"></span><br><span class="line">$ touch hello\ world</span><br><span class="line">$ [[ -f $file ]] &amp;&amp; echo yes</span><br><span class="line">yes</span><br><span class="line">$ [ -f $file ] &amp;&amp; echo yes</span><br><span class="line">-bash: [: hello: binary operator expected</span><br><span class="line"></span><br><span class="line">2. è¿›åˆ¶ä¹‹é—´è‡ªåŠ¨è½¬åŒ– å½“ä¸€ä¸ªåè¿›åˆ¶ä¸å…«è¿›åˆ¶åšæ¯”è¾ƒæ—¶ï¼Œä¼šè‡ªåŠ¨è®¡ç®—ä¸¤ä¸ªæ•°çš„å€¼ï¼Œç»Ÿä¸€ååšæ¯”è¾ƒï¼š</span><br><span class="line">$ o&#x3D;017</span><br><span class="line">$ h&#x3D;0x0f</span><br><span class="line">$ [[ $o -eq $h ]] &amp;&amp; echo yes</span><br><span class="line">yes</span><br><span class="line">$ [[ $o -eq 15 ]] &amp;&amp; echo yes</span><br><span class="line">yes</span><br><span class="line"></span><br><span class="line">3. [[]]æ”¯æŒ&amp;&amp;ï¼Œ||ç­‰è¿ç®—ç¬¦</span><br><span class="line">$ a&#x3D;1;b&#x3D;3</span><br><span class="line">$ [[ $a &gt; 0 &amp;&amp; $b &lt; 4 ]] &amp;&amp; echo yes</span><br><span class="line">yes</span><br></pre></td></tr></table></figure>
<h3 id="18-è·å–Bashè„šæœ¬çš„æœ€åä¸€ä¸ªå‚æ•°"><a href="#18-è·å–Bashè„šæœ¬çš„æœ€åä¸€ä¸ªå‚æ•°" class="headerlink" title="18. è·å–Bashè„šæœ¬çš„æœ€åä¸€ä¸ªå‚æ•°"></a>18. è·å–Bashè„šæœ¬çš„æœ€åä¸€ä¸ªå‚æ•°</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥ç”¨$0ï¼Œ$1ç­‰æ¥è·å–ä¼ é€’ç»™è„šæœ¬æˆ–è€…å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨$*æˆ–è€…$@è·å–æ‰€æœ‰çš„å‚æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘åªæƒ³è¦è·å–æœ€åä¸€ä¸ªå‚æ•°å‘¢ï¼Ÿ</span><br></pre></td></tr></table></figure>
é¦–å…ˆï¼Œä½ å¯èƒ½æƒ³åˆ°ç”¨éå†åœ°æ–¹æ³•ï¼ˆè¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨setå‘½ä»¤æ¥è®¾ç½®ä½ç½®å‚æ•°ï¼‰ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ set -- arg1 arg2 arg3</span><br><span class="line">$ for i in $@; do :; done</span><br><span class="line">$ echo $i</span><br><span class="line">arg3</span><br></pre></td></tr></table></figure>
è¿™é‡Œçš„å¾ªç¯ä»€ä¹ˆäº‹æƒ…éƒ½æ²¡åšï¼Œæˆ‘ç”¨å†’å·ï¼ˆ:ï¼‰å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼›å¾ªç¯ç»“æŸå, $iå°±æ˜¯ä¿å­˜ç€æœ€åä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ ä¸‹é¢æ˜¯ä¸¤ç§æ›´åŠ ç®€å•çš„æ–¹æ³•çš„ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $&#123;@: -1&#125;</span><br><span class="line">$ echo $&#123;!#&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸Šé¢çš„ç¬¬ä¸€ç§æ–¹æ³•äº‹å®ä¸Šå°±æ˜¯Parameter Expansionä¸­çš„$&#123;parameter:offset:length&#125;è¿™ç§å½¢å¼ï¼Œåªä¸è¿‡offsetä¸º-1è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¿½ç•¥lengthè¡¨æ˜æ˜¯ä»offsetå¼€å§‹å¾€åç›´åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå³åªå–æœ€åä¸€ä¸ªå…ƒç´ ã€‚è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨å†’å·å’ŒçŸ­æ¨ªä¹‹é—´çš„ç©ºæ ¼ä¸èƒ½å°‘ï¼Œå¦åˆ™å°±å˜æˆ15. $&#123;&#125;å‚æ•°å±•å¼€ä¸­ä»‹ç»çš„$&#123;parameter:-var&#125;è¿™ç§ç”¨æ³•äº†ã€‚</span><br><span class="line"></span><br><span class="line">è€Œç¬¬äºŒç§æ–¹æ³•åˆ™æ˜¯indirect referencingçš„ä¸€ç§è¡¨ç°ï¼Œ#è¿™ä¸ªç‰¹æ®Šçš„å˜é‡å­˜æ”¾å‚æ•°çš„ä¸ªæ•°ï¼Œ!#åˆ™æ˜¯å¯¹æœ€åä¸€ä¸ªå˜é‡çš„å¼•ç”¨ã€‚</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="19-Bashä¸­çš„å¼•ç”¨-indirect-referencing"><a href="#19-Bashä¸­çš„å¼•ç”¨-indirect-referencing" class="headerlink" title="19. Bashä¸­çš„å¼•ç”¨(indirect referencing)"></a>19. Bashä¸­çš„å¼•ç”¨(indirect referencing)</h3><p>æœ‰æ²¡æœ‰æƒ³æ³•åœ¨Bashä¸­ä¹Ÿå¯ä»¥è¾¾åˆ°C++å¼•ç”¨çš„æ•ˆæœï¼Ÿä½ å¯èƒ½ä¸çŸ¥é“ï¼Œä½†æ˜¯ä½ å¯èƒ½æ›¾ç»æœ‰è¿™ç§éœ€æ±‚ï¼Œæˆ‘å°±æœ‰è¿‡ï¼š</p>
<p>æœ‰æ—¶å€™ï¼Œæˆ‘æƒ³è¦ä¸€ä¸ªå˜é‡å­˜æ”¾å¦å¤–ä¸€ä¸ªå˜é‡çš„åç§°ï¼Œç„¶ååœ¨åé¢æˆ‘æƒ³é€šè¿‡è¿™ä¸ªå˜é‡çš„åç§°å¼•ç”¨å®ƒçš„å€¼<br>ä¾‹å­æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ a&#x3D;b</span><br><span class="line">$ b&#x3D;1</span><br><span class="line">$ echo $a</span><br><span class="line">b</span><br><span class="line">$ eval &quot;echo \$a&quot;</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯åˆ©ç”¨indirect referencingçš„ç”¨æ³•ï¼Œä½ å¯ä»¥è¿™æ ·è·å–bçš„å€¼:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $&#123;!a&#125;</span><br><span class="line">1</span><br><span class="line">$ b&#x3D;2</span><br><span class="line">$ echo $&#123;!a&#125;</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p><a href="https://yq.aliyun.com/articles/68540?spm=a2c4e.11153959.teamhomeleft.71.7e4c8bc1kg1JeI" target="_blank" rel="noopener"> åŸæ–‡åœ°å€</a></p>
]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸€)</title>
    <url>/2020/04/20/%E7%AE%80%E6%B4%81%E7%9A%84Bash-Programming%E6%8A%80%E5%B7%A7-%E4%B8%80/</url>
    <content><![CDATA[<h2 id="ç®€æ´çš„Bash-ProgrammingæŠ€å·§-äºŒ"><a href="#ç®€æ´çš„Bash-ProgrammingæŠ€å·§-äºŒ" class="headerlink" title="ç®€æ´çš„Bash ProgrammingæŠ€å·§(äºŒ)"></a>ç®€æ´çš„Bash ProgrammingæŠ€å·§(äºŒ)</h2><h3 id="1-æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸ"><a href="#1-æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸ" class="headerlink" title="1. æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸ"></a>1. æ£€æŸ¥å‘½ä»¤æ‰§è¡Œæ˜¯å¦æˆåŠŸ</h3><p>ç¬¬ä¸€ç§å†™æ³•ï¼Œæ¯”è¾ƒå¸¸è§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo abcdee | grep -q abcd</span><br><span class="line"></span><br><span class="line">if [ $? -eq 0 ]; then</span><br><span class="line">    echo &quot;Found&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;Not found&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>ç®€æ´çš„å†™æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if echo abcdee | grep -q abc; then</span><br><span class="line">    echo &quot;Found&quot;</span><br><span class="line">else</span><br><span class="line">    echo &quot;Not found&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è¦if/else,ä¸è¿‡è¿™æ ·å¯è¯»æ€§æ¯”è¾ƒå·®:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo abcdee | grep -q abc &amp;&amp; echo &quot;Found&quot; || echo &quot;Not found&quot;</span><br><span class="line">Found</span><br></pre></td></tr></table></figure>
<h3 id="2-å°†æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°-dev-null"><a href="#2-å°†æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°-dev-null" class="headerlink" title="2. å°†æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°/dev/null"></a>2. å°†æ ‡å‡†è¾“å‡ºä¸æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°/dev/null</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. ç¬¬ä¸€ç§å†™æ³•ï¼Œæ¯”è¾ƒå¸¸è§ï¼š</span><br><span class="line">grep &quot;abc&quot; test.txt 1&gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">2. å¸¸è§çš„é”™è¯¯å†™æ³•ï¼š</span><br><span class="line">grep &quot;abc&quot; test.txt 2&gt;&amp;1 1&gt;&#x2F;dev&#x2F;null</span><br><span class="line">3. ç®€æ´çš„å†™æ³•ï¼š</span><br><span class="line">grep &quot;abc&quot; test.txt &amp;&gt; &#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure>
<h3 id="3-awkçš„ä½¿ç”¨"><a href="#3-awkçš„ä½¿ç”¨" class="headerlink" title="3. awkçš„ä½¿ç”¨"></a>3. awkçš„ä½¿ç”¨</h3><p>ä¸¾ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œè·å–Xen DomUçš„idã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. å¸¸è§çš„å†™æ³•ï¼š</span><br><span class="line">sudo xm li | grep vm_name | awk &#39;&#123;print $2&#125;&#39;</span><br><span class="line">2. ç®€æ´çš„å†™æ³•ï¼š</span><br><span class="line">sudo xm li | awk &#39;&#x2F;vm_name&#x2F;&#123;print $2&#125;&#39;</span><br></pre></td></tr></table></figure>
<h3 id="4-å°†ä¸€ä¸ªæ–‡æœ¬çš„æ‰€æœ‰è¡Œç”¨é€—å·è¿æ¥èµ·æ¥"><a href="#4-å°†ä¸€ä¸ªæ–‡æœ¬çš„æ‰€æœ‰è¡Œç”¨é€—å·è¿æ¥èµ·æ¥" class="headerlink" title="4. å°†ä¸€ä¸ªæ–‡æœ¬çš„æ‰€æœ‰è¡Œç”¨é€—å·è¿æ¥èµ·æ¥"></a>4. å°†ä¸€ä¸ªæ–‡æœ¬çš„æ‰€æœ‰è¡Œç”¨é€—å·è¿æ¥èµ·æ¥</h3><p>å‡è®¾æ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;ip.txt </span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨Sedå‘½ä»¤ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sed &#39;:a;$!N;s&#x2F;\n&#x2F;,&#x2F;;ta&#39; &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.100,192.168.1.101,192.168.1.102</span><br></pre></td></tr></table></figure>
<p>ç®€æ´çš„å†™æ³•(ä¸€)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ paste -sd, &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.100,192.168.1.101,192.168.1.102</span><br></pre></td></tr></table></figure>
<p>ç®€æ´çš„å†™æ³•(äºŒ)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;ip.txt | tr &quot;\n&quot; &quot;,&quot;</span><br><span class="line">192.168.1.100,192.168.1.101,192.168.1.102,</span><br><span class="line">âš ï¸ ç»“å°¾çš„æ¢è¡Œç¬¦ä¹Ÿä¼šè¢«æ›¿æ¢ä¸ºé€—å·</span><br></pre></td></tr></table></figure>
<h3 id="5-è¿‡æ»¤é‡å¤è¡Œ"><a href="#5-è¿‡æ»¤é‡å¤è¡Œ" class="headerlink" title="5. è¿‡æ»¤é‡å¤è¡Œ"></a>5. è¿‡æ»¤é‡å¤è¡Œ</h3><p>å‡è®¾æ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sort &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<p>å¸¸ç”¨çš„æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sort &#x2F;tmp&#x2F;ip.txt | uniq</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<p>ç®€å•çš„å†™æ³•:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># sort -u &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<h3 id="6-grepæŸ¥æ‰¾å•è¯"><a href="#6-grepæŸ¥æ‰¾å•è¯" class="headerlink" title="6. grepæŸ¥æ‰¾å•è¯"></a>6. grepæŸ¥æ‰¾å•è¯</h3><p>å‡è®¾ä¸€ä¸ªæ–‡æœ¬çš„æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªipåœ°å€ï¼Œä¾‹å¦‚:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cat &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br><span class="line">192.168.1.102</span><br><span class="line">192.168.1.100</span><br><span class="line">192.168.1.101</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨grepæŸ¥æ‰¾æ˜¯å¦åŒ…æ‹¬192.168.1.102è¿™ä¸ªipåœ°å€ã€‚å¸¸è§çš„å†™æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># grep &#39;192.168.1.102\&gt;&#39; &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<p>ç®€å•çš„æ–¹æ³•ï¼ˆå…¶å®è¿™æ–¹æ³•ä¸è§å¾—ç®€å•ï¼Œåªæ˜¯ä¸ºäº†è¯´æ˜-wè¿™ä¸ªå‚æ•°è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># grep -w &#39;192.168.1.102&#39; &#x2F;tmp&#x2F;ip.txt</span><br><span class="line">192.168.1.102</span><br></pre></td></tr></table></figure>
<p>æ³¨âš ï¸: grepçš„-n/-H/-v/-f/-cè¿™å‡ å‚æ•°éƒ½å¾ˆæœ‰ç”¨.</p>
<h3 id="7-ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#7-ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="7. ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡"></a>7. ä¸´æ—¶è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>å¸¸è§çš„å†™æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ export LC_ALL&#x3D;zh_CN.UTF-8 </span><br><span class="line"></span><br><span class="line">$ date</span><br><span class="line">2012å¹´ 11æœˆ 03æ—¥ æ˜ŸæœŸå…­ 22:26:55 CST</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line">ç®€æ´çš„å†™æ³•:</span><br></pre></td></tr></table></figure>
<p>$ unset LC_ALL<br>$ LC_ALL=zh_CN.UTF-8 date<br>2012å¹´ 11æœˆ 03æ—¥ æ˜ŸæœŸå…­ 22:27:43 CST</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">åœ¨å‘½ä»¤ä¹‹å‰åŠ ä¸Šç¯å¢ƒå˜æ›´çš„è®¾ç½®ï¼Œåªæ˜¯ä¸´æ—¶æ”¹å˜å½“å‰æ‰§è¡Œå‘½ä»¤çš„ç¯å¢ƒã€‚</span><br><span class="line">### 8. \$1,\$2...ç­‰ä½ç½®å‚æ•°çš„ä½¿ç”¨</span><br><span class="line">å‡è®¾åªæƒ³ä½¿ç”¨$2,$3..è¿™å‡ ä¸ªå‚æ•°ï¼Œå¸¸è§çš„åšæ³•æ˜¯:</span><br></pre></td></tr></table></figure>
<p>shift<br>echo â€œ$@â€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸ºä»€ä¹ˆä¸è¿™æ ·å†™å‘¢ï¼Ÿ</span><br></pre></td></tr></table></figure>
<p>echo â€œ${@:2}â€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 9. é€€è€Œæ±‚å…¶æ¬¡çš„å†™æ³•</span><br><span class="line">ç›¸ä¿¡å¤§å®¶ä¼šæœ‰è¿™ç§éœ€æ±‚ï¼Œå½“ä¸€ä¸ªå‚æ•°å€¼æ²¡æœ‰æä¾›æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚å¸¸è§çš„å†™æ³•æ˜¯ï¼š</span><br></pre></td></tr></table></figure>
<p>arg=$1<br>if [ -z â€œ$argâ€ ]; then<br>   arg=0<br>fi</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç®€æ´çš„å†™æ³•æ˜¯è¿™æ ·çš„:</span><br></pre></td></tr></table></figure>
<p>arg=${1:-0}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 10. bashç‰¹æ®Šå‚æ•°--çš„ç”¨æ³•</span><br><span class="line">å‡è®¾è¦ç”¨grepæŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«-iï¼Œæˆ‘ä»¬ä¼šè¿™æ ·å°è¯•ï¼š</span><br></pre></td></tr></table></figure>
<h1 id="echo-â€˜abc-iâ€™-grep-â€œ-iâ€"><a href="#echo-â€˜abc-iâ€™-grep-â€œ-iâ€" class="headerlink" title="echo â€˜abc-iâ€™ | grep â€œ-iâ€"></a>echo â€˜abc-iâ€™ | grep â€œ-iâ€</h1><p>Usage: grep [OPTION]â€¦ PATTERN [FILE]â€¦<br>Try â€˜grep â€“helpâ€™ for more information.</p>
<h1 id="echo-â€˜abc-iâ€™-grep-â€œ-iâ€-1"><a href="#echo-â€˜abc-iâ€™-grep-â€œ-iâ€-1" class="headerlink" title="echo â€˜abc-iâ€™ | grep â€œ-iâ€"></a>echo â€˜abc-iâ€™ | grep â€œ-iâ€</h1><p>abc-i</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç®€æ´çš„æ–¹æ³•æ˜¯ï¼š</span><br></pre></td></tr></table></figure>
<h1 id="echo-â€˜abc-iâ€™-grep-â€“-i"><a href="#echo-â€˜abc-iâ€™-grep-â€“-i" class="headerlink" title="echo â€˜abc-iâ€™ | grep â€“ -i"></a>echo â€˜abc-iâ€™ | grep â€“ -i</h1><p>abc-i</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ³¨âš ï¸:bashä¸­--åé¢çš„å‚æ•°ä¸ä¼šè¢«å½“ä½œé€‰é¡¹è§£æã€‚</span><br><span class="line">### 11. å‡½æ•°çš„è¿”å›å€¼é»˜è®¤æ˜¯æœ€åä¸€è¡Œè¯­å¥çš„è¿”å›å€¼</span><br></pre></td></tr></table></figure>
<h1 id="Check-whether-an-item-is-a-function"><a href="#Check-whether-an-item-is-a-function" class="headerlink" title="Check whether an item is a function"></a>Check whether an item is a function</h1><h1 id="1-the-function-name"><a href="#1-the-function-name" class="headerlink" title="$1: the function name"></a>$1: the function name</h1><h1 id="Return-0-yes-or-1-no"><a href="#Return-0-yes-or-1-no" class="headerlink" title="Return: 0(yes) or 1(no)"></a>Return: 0(yes) or 1(no)</h1><p>function is_function()<br>{<br>    local func_name=$1<br>    test â€œ<code>type -t $1 2&gt;/dev/null</code>â€œ = â€œfunctionâ€<br>}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸è¦ç”»è›‡æ·»è¶³å†åœ¨åé¢åŠ ä¸€è¡Œreturn $?äº†ã€‚</span><br><span class="line">### 12. å°†printfæ ¼å¼åŒ–çš„ç»“æœèµ‹å€¼ç»™å˜é‡</span><br><span class="line">ä¾‹å¦‚å°†æ•°å­—è½¬æ¢æˆå…¶åå…­è¿›åˆ¶å½¢å¼ï¼Œå¸¸è§çš„å†™æ³•æ˜¯ï¼š</span><br></pre></td></tr></table></figure>
<p>$ var=$(printf â€˜%%%02xâ€™ 111)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç®€å•çš„å†™æ³•æ˜¯ï¼š</span><br></pre></td></tr></table></figure>
<p>$ printf -v var â€˜%%%02xâ€™ 111 </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">printfçš„helpï¼š</span><br></pre></td></tr></table></figure>
<h1 id="help-printf-grep-A-1-B-1-â€“-v"><a href="#help-printf-grep-A-1-B-1-â€“-v" class="headerlink" title="help printf | grep -A 1 -B 1 â€“ -v"></a>help printf | grep -A 1 -B 1 â€“ -v</h1><p>printf: printf [-v var] format [arguments]<br>    Formats and prints ARGUMENTS under control of the FORMAT.<br>â€“<br>    Options:<br>      -v var    assign the output to shell variable VAR rather than<br>            display it on the standard output</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 13. æ‰“å°æ–‡ä»¶è¡Œ</span><br><span class="line">æ‰“å°æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼š</span><br></pre></td></tr></table></figure>
<p>head -1 test.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰“å°æ–‡ä»¶çš„ç¬¬2è¡Œï¼š</span><br></pre></td></tr></table></figure>
<p>sed -n â€˜2pâ€™ test.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰“å°æ–‡ä»¶çš„ç¬¬2åˆ°5è¡Œï¼š</span><br></pre></td></tr></table></figure>
<p>sed -n â€˜2,5pâ€™ test.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰“å°æ–‡ä»¶çš„ç¬¬2è¡Œå§‹ï¼ˆåŒ…æ‹¬ç¬¬2è¡Œåœ¨å†…ï¼‰5è¡Œçš„å†…å®¹ï¼š</span><br></pre></td></tr></table></figure>
<p>sed -n â€˜2,+4pâ€™ test.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰“å°å€’æ•°ç¬¬äºŒè¡Œï¼š</span><br></pre></td></tr></table></figure>
<p>$ tail -2 test.txt | head -1<br>$ tac test.txt | sed -n â€˜2pâ€™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 14.å–„ç”¨letæˆ–è€…(())å‘½ä»¤åšç®—æœ¯è¿ç®—</span><br><span class="line">å¦‚ä½•å¯¹ä¸€ä¸ªæ•°å­—åš++è¿ç®—ï¼Œå¯èƒ½ä½ ä¼šè¿™æ ·ç”¨ï¼š</span><br></pre></td></tr></table></figure>
<p>a=1<br>a=<code>expr a + 1</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸ºä½•ä¸ç”¨ä½ ç†Ÿæ‚‰çš„:</span><br></pre></td></tr></table></figure>
<p>a=1<br>let a++<br>let a+=2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 15. è·å–è½¯è¿æ¥æŒ‡å®šçš„çœŸå®æ–‡ä»¶å</span><br><span class="line">å¦‚æœä½ ä¸çŸ¥é“ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·è·å–ï¼š</span><br></pre></td></tr></table></figure>
<p>$ ls -l /usr/bin/python | awk -Fâ€™-&gt;â€™ â€˜{print $2}â€™ | tr -d â€˜ â€˜<br>/usr/bin/python2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¦‚æœä½ çŸ¥é“æœ‰ä¸€ä¸ªå«readlinkçš„å‘½ä»¤ï¼Œé‚£ä¹ˆï¼š</span><br></pre></td></tr></table></figure>
<p>$ readlink /usr/bin/python<br>/usr/bin/python2</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 16. è·å–ä¸€ä¸ªå­—ç¬¦çš„ASCIIç </span><br></pre></td></tr></table></figure>
<p>$ printf â€˜%02xâ€™ â€œâ€˜+â€<br>2b<br>$ echo -n â€˜+â€™ | od -tx1 -An | tr -d â€˜ â€˜<br>2b</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 17. æ¸…ç©ºä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">å¸¸è§çš„ç”¨æ³•:</span><br></pre></td></tr></table></figure>
<p>echo â€œâ€ &gt; test.txt</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç®€å•çš„å†™æ³•ï¼š</span><br></pre></td></tr></table></figure>
<blockquote>
<p>test.txt</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 18 ä¸è¦å¿˜è®°æœ‰here document</span><br><span class="line">ä¸‹é¢ä¸€æ®µä»£ç ï¼š</span><br></pre></td></tr></table></figure>
<p>grep -v 1 /tmp/test.txt | while read line; do<br>    let a++<br>    echo â€“$lineâ€“<br>done<br>echo a:$a</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ‰§è¡Œåæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</span><br></pre></td></tr></table></figure>
<p>$ sh test.sh<br>â€“2â€“<br>â€“3â€“<br>a:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é—®é¢˜: å‘ç°aè¿™ä¸ªå˜é‡æ²¡æœ‰è¢«èµ‹å€¼ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç®¡é“åé¢çš„ä»£ç æ˜¯åœ¨åœ¨ä¸€ä¸ªå­shellä¸­æ‰§è¡Œçš„ï¼Œæ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šå¯¹å½“å‰shellæœ‰å½±å“ï¼Œè‡ªç„¶aè¿™ä¸ªå˜é‡å°±ä¸ä¼šæœ‰èµ‹å€¼äº†ã€‚</span><br><span class="line"></span><br><span class="line">æ¢ä¸€ç§æ€è·¯ï¼Œå¯ä»¥è¿™æ ·åšï¼š</span><br></pre></td></tr></table></figure>
<p>grep -v 1 /tmp/test.txt &gt; /tmp/test.tmp</p>
<p>while read line; do<br>    let a++<br>    echo â€“$lineâ€“<br>done &lt; /tmp/test.tmp</p>
<p>echo a:$a<br>rm -f /tmp/test.tmp</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä¸è¿‡å¤šäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œæœ€åè¿˜è¦åˆ é™¤ã€‚è¿™é‡Œå…¶å®å¯ä»¥ç”¨åˆ°here documentï¼š</span><br></pre></td></tr></table></figure>
<p>while read line2; do<br>    let b++<br>    echo ??$line2??<br>done &lt;&lt; EOF<br><code>grep -v 1 /tmp/test.txt</code><br>EOF<br>echo b: $b</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">here documentå¾€å¾€ç”¨äºéœ€è¦è¾“å‡ºä¸€å¤§æ®µæ–‡æœ¬çš„åœ°æ–¹ï¼Œä¾‹å¦‚è„šæœ¬çš„helpå‡½æ•°</span><br><span class="line"></span><br><span class="line">### 19.åˆ é™¤å­—ç¬¦ä¸²ä¸­çš„ç¬¬ä¸€ä¸ªæˆ–è€…æœ€åä¸€ä¸ªå­—ç¬¦</span><br><span class="line">å‡è®¾å­—ç¬¦ä¸²ä¸ºï¼š</span><br></pre></td></tr></table></figure>
<p>$ str=â€aremovebâ€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¯èƒ½ä½ ç¬¬ä¸€ä¸ªæƒ³æ³•æ˜¯é€šè¿‡sedæˆ–è€…å…¶å®ƒå‘½ä»¤æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯å…¶å®æœ‰å¾ˆç®€å•çš„æ–¹æ³•,æ­¤å¤„åˆ©ç”¨shellçš„æ•°ç»„è¿›è¡Œå¤„ç†ï¼š</span><br></pre></td></tr></table></figure>
<p>$ echo â€œ${str#?}â€<br>removeb<br>$ echo â€œ${str%?}â€<br>aremove</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç±»ä¼¼åœ°ï¼Œä½ ä¹Ÿå¯ä»¥åˆ é™¤2ä¸ªã€3ä¸ªã€4ä¸ªâ€¦â€¦</span><br><span class="line"></span><br><span class="line">æœ‰æ²¡æœ‰ä¸€æ¬¡æ€§åˆ é™¤ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—ç¬¦çš„æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ï¼š</span><br></pre></td></tr></table></figure>
<p>$ echo â€œ${str:1:-1}â€<br>remove</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å…³äºè¿™äº›å˜é‡æ›¿æ¢çš„å†…å®¹åœ¨bashçš„manæ‰‹å†Œä¸­éƒ½æœ‰è¯´æ˜ã€‚</span><br><span class="line">### 20. ä½¿ç”¨é€—å·joinæ•°ç»„å…ƒç´ </span><br><span class="line">å‡è®¾æ•°ç»„å…ƒç´ æ²¡æœ‰ç©ºæ ¼ï¼Œå¯ä»¥ç”¨è¿™ç§æ–¹æ³•ï¼š</span><br></pre></td></tr></table></figure>
<p>$ a=(1 2 3)<br>$ b=â€${a[*]}â€</p>
<p>$ echo ${b// /,}<br>1,2,3</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ³¨âš ï¸ï¼šå½“è¯¥æ•°ç»„çš„é•¿åº¦éå¸¸é•¿æ—¶ï¼Œä½¿ç”¨è¿™ç§æ›¿æ¢çš„æ—¶é—´å¼€é”€å¾ˆé«˜ï¼Œæ€§èƒ½å¾ˆå·®ï¼Œæ¨èç”¨sedã€‚</span><br><span class="line">å‡è®¾æ•°ç»„å…ƒç´ åŒ…å«æœ‰ç©ºæ ¼ï¼Œå¯ä»¥å€Ÿç”¨printfå‘½ä»¤æ¥è¾¾åˆ°ï¼š</span><br></pre></td></tr></table></figure>
<p>$ a=(1 â€œ2 3â€ 4)<br>$ printf â€œ,%sâ€ â€œ${a[@]}â€ | cut -c2-<br>1,2 3,4</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 21. Shellä¸­çš„å¤šè¿›ç¨‹</span><br><span class="line">åœ¨å‘½ä»¤è¡Œä¸‹ï¼Œæˆ‘ä»¬ä¼šåœ¨å‘½ä»¤è¡Œåé¢åŠ ä¸Š&amp;ç¬¦å·æ¥è®©è¯¥å‘½ä»¤åœ¨åå°æ‰§è¡Œï¼Œåœ¨shellè„šæœ¬ä¸­ï¼Œä½¿ç”¨&quot;(cmd)&quot;å¯ä»¥è®©forkä¸€ä¸ªå­shellæ¥æ‰§è¡Œè¯¥å‘½ä»¤ã€‚åˆ©ç”¨è¿™ä¸¤ç‚¹ï¼Œå¯ä»¥å®ç°shellçš„å¤šçº¿ç¨‹ï¼š</span><br></pre></td></tr></table></figure>
<p>job_num=10</p>
<p>function do_work()<br>{<br>    echo â€œDo work..â€<br>}</p>
<p>for ((i=0; i &lt; job_num ;i++)); do<br>    echo â€œFork job $iâ€<br>    (do_work) &amp;<br>done</p>
<p>wait   # wait for all job done<br>echo â€œAll job have been done!â€</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ³¨âš ï¸: æœ€åçš„waitå‘½ä»¤ï¼Œä½œç”¨æ˜¯ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸã€‚</span><br><span class="line">é™„å‡ åˆ™å°æŠ€å·§ï¼š</span><br></pre></td></tr></table></figure>
<p>1ï¼‰sudo iptables -L -n | vim -<br>2ï¼‰grep -v xxx | vim -<br>3ï¼‰echo $â€™&#39;â€˜<br>4ï¼‰set â€“ 1 2 3; echo â€œ$@â€<br>5ï¼‰æœç´¢stackoverflow/superuserç­‰ç«™ç‚¹<br>6ï¼‰VIMç¼–è¾‘è¿œç¨‹æ–‡ä»¶ vim scp://xxx//etc/vimrc<br>7ï¼‰è¿œç¨‹æ‰§è¡Œè„šæœ¬ ssh xxx bash &lt; xxx.sh</p>
<pre><code>
[åŸæ–‡åœ°å€](https://yq.aliyun.com/articles/68541?spm=a2c4e.11153959.blogcont72014.7.6f252cb3xPFFVx)

</code></pre>]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®€æ´çš„Bash ProgrammingæŠ€å·§(äºŒ)</title>
    <url>/2020/04/20/%E7%AE%80%E6%B4%81%E7%9A%84Bash-Programming%E6%8A%80%E5%B7%A7-%E4%BA%8C/</url>
    <content><![CDATA[<h2 id="ç®€æ´çš„Bash-ProgrammingæŠ€å·§-ä¸‰"><a href="#ç®€æ´çš„Bash-ProgrammingæŠ€å·§-ä¸‰" class="headerlink" title="ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸‰)"></a>ç®€æ´çš„Bash ProgrammingæŠ€å·§(ä¸‰)</h2><p>è¿™ä¸€ç³»åˆ—çš„æ–‡ç« ä¸“é—¨ä»‹ç» Bash ç¼–ç¨‹ä¸­ä¸€äº›ç®€æ´çš„æŠ€å·§ï¼Œå¸®åŠ©å¤§å®¶æé«˜å¹³æ—¶ Bash ç¼–ç¨‹çš„æ•ˆç‡ã€‚</p>
<h3 id="1-æ›¿æ¢è¯­æ³•-parameter-pattern-string-çš„å¦™ç”¨"><a href="#1-æ›¿æ¢è¯­æ³•-parameter-pattern-string-çš„å¦™ç”¨" class="headerlink" title="1. æ›¿æ¢è¯­æ³•${parameter/pattern/string}çš„å¦™ç”¨"></a>1. æ›¿æ¢è¯­æ³•${parameter/pattern/string}çš„å¦™ç”¨</h3><p>${parameter/pattern/string}å°†parameterä¸­åŒ¹é…patternçš„éƒ¨åˆ†æ›¿æ¢æˆstringï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­å°†å­—ç¬¦ä¸²ä¸­çš„eæ›¿æ¢æˆxï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ str&#x3D;&quot;three&quot;</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;e&#x2F;x&#125;&quot;</span><br><span class="line">thrxe</span><br></pre></td></tr></table></figure>
<p>å¦‚æœpatternéƒ¨åˆ†ä»¥/å¼€å¤´ï¼Œè¡¨ç¤ºæ›¿æ¢parameterä¸­æ‰€æœ‰åŒ¹é…çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ str&#x3D;&quot;three&quot;</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;&#x2F;e&#x2F;x&#125;&quot;  # thrxx</span><br></pre></td></tr></table></figure>
<p>å¦‚æœpatternéƒ¨åˆ†ä»¥#å¼€å¤´ï¼Œè¡¨ç¤ºä»…å½“parameterå¼€å§‹å¤„åŒ¹é…patternçš„æ—¶å€™æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">str&#x3D;&quot;three&quot;</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;#e&#x2F;x&#125;&quot; # three</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;#t&#x2F;x&#125;&quot; # xhree</span><br></pre></td></tr></table></figure>
<p>ä¸æ­¤å¯¹åº”åœ°æ˜¯ï¼Œå¦‚æœpatternéƒ¨åˆ†ä»¥%å¼€å¤´ï¼Œè¡¨ç¤ºä»…å½“parameterç»“å°¾å¤„åŒ¹é…patternçš„æ—¶å€™æ›¿æ¢ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ str&#x3D;&quot;three&quot;</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;%e&#x2F;x&#125;&quot; # threx</span><br></pre></td></tr></table></figure>
<p>å¦‚æœstringéƒ¨åˆ†ä¸ºç©ºï¼ŒåŒ¹é…patternçš„éƒ¨åˆ†è¢«åˆ é™¤ï¼ˆæ›¿æ¢ä¸ºç©ºï¼‰ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ str&#x3D;&quot;three&quot;</span><br><span class="line">$ echo &quot;$&#123;str&#x2F;h&#x2F;&#125;&quot;  # tree</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™ç¬¬äºŒä¸ªæ–œæ å¯ä»¥åˆ é™¤ï¼Œå³ï¼šecho â€œ${str/h}â€ å¦‚æœparameteræ˜¯ä¸€ä¸ªæ•°ç»„ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹Bashçš„manæ‰‹å†Œè¯´æ˜ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">man -P &#39;less -p &quot;\\$\&#123;parameter&#x2F;pattern&#x2F;string&#125;&quot;&#39; bash</span><br></pre></td></tr></table></figure>
<h3 id="2-è¿ç®—ç¬¦"><a href="#2-è¿ç®—ç¬¦" class="headerlink" title="2. +=è¿ç®—ç¬¦"></a>2. +=è¿ç®—ç¬¦</h3><p>æœ‰ä¸€å¤©ï¼Œæˆ‘çœ‹åˆ°è¿™æ ·ä¸€ä¸ªç”¨æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ arr&#x3D;(1 2 3)</span><br><span class="line">$ arr+&#x3D;(4 5)</span><br></pre></td></tr></table></figure>
<p>åŸæ¥æ•°ç»„è¿˜å¯ä»¥è¿™æ ·ç›¸åŠ ï¼Œåæ¥æˆ‘çœ‹äº†ä¸‹Bashçš„æ‰‹å†Œï¼Œç¡®å®æœ‰ä¸€æ®µè¿™ä¹ˆè¯´æ˜çš„ï¼Œè¿™é‡Œæœªå¼•ç”¨è¿™æ®µæ–‡å­—ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æŸ¥çœ‹<a href="http://www.gnu.org/software/bash/manual/bashref.html?spm=a2c4e.11153959.blogcont68524.12.4dbf3d2foIG0jZ#Shell-Parameters" target="_blank" rel="noopener">Bash Reference Manual</a> è‡ªç„¶åœ°æˆ‘ä»¬ä¼šæƒ³åˆ°å¦‚æœä¸€ä¸ªå˜é‡æ˜¯æ•°å­—ï¼Œæ˜¯å¦ä¹Ÿå¯ä»¥ç”¨+=ä½œè¿ç®—å‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ i&#x3D;1</span><br><span class="line">$ i+&#x3D;1</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œè¿è¡Œåä½ ä¼šå‘ç°içš„ç»“æœå¹¶ä¸ä¸º2ï¼Œè€Œæ˜¯11ï¼Œè¿™é‡Œbashå¹¶ä¸è®¤ä¸ºiæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè€Œæ˜¯ä½œä¸ºå­—ç¬¦ä¸²ã€‚ è¿™æ—¶å¯ä»¥é€šè¿‡declareå£°æ˜ä¸€ä¸ªå˜é‡ä¸ºæ•´æ•°ï¼Œä¸Šé¢çš„é—®é¢˜å°±è§£å†³äº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ declare -i int&#x3D;1</span><br><span class="line">$ int+&#x3D;1</span><br><span class="line">$ echo $int</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<h3 id="3-Here-documentä¸ä¸ºäººçŸ¥çš„ç”¨æ³•"><a href="#3-Here-documentä¸ä¸ºäººçŸ¥çš„ç”¨æ³•" class="headerlink" title="3. Here documentä¸ä¸ºäººçŸ¥çš„ç”¨æ³•"></a>3. Here documentä¸ä¸ºäººçŸ¥çš„ç”¨æ³•</h3><p>Shellå­¦å¾—è¶Šå¤šï¼Œè¶Šä¼šå‘ç°ä¸€äº›ç¥å¥‡çš„ç”¨æ³•ï¼Œæ¯å¤©éƒ½è§‰å¾—è‡ªå·±å®åœ¨æ˜¯ä¸€ä¸ªåˆšå…¥é—¨çš„èœé¸Ÿã€‚</p>
<ol>
<li>Here Document æ˜¯åœ¨Linux Shell ä¸­çš„ä¸€ç§ç‰¹æ®Šçš„é‡å®šå‘æ–¹å¼ï¼Œå®ƒçš„åŸºæœ¬çš„å½¢å¼å¦‚ä¸‹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cmd &lt;&lt; delimiter</span><br><span class="line">  Here Document Content</span><br><span class="line">delimiter</span><br></pre></td></tr></table></figure>
å®ƒçš„ä½œç”¨å°±æ˜¯å°†ä¸¤ä¸ª delimiter ä¹‹é—´çš„å†…å®¹(Here Document Content éƒ¨åˆ†) ä¼ é€’ç»™cmd ä½œä¸ºè¾“å…¥å‚æ•°ã€‚</li>
<li>æ¯”å¦‚åœ¨ç»ˆç«¯ä¸­è¾“å…¥cat &lt;&lt; EOF ï¼Œç³»ç»Ÿä¼šæç¤ºç»§ç»­è¿›è¡Œè¾“å…¥ï¼Œè¾“å…¥å¤šè¡Œä¿¡æ¯å†è¾“å…¥EOFï¼Œä¸­é—´è¾“å…¥çš„ä¿¡æ¯å°†ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å¦‚ä¸‹ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &lt;&lt; EOF</span><br><span class="line">&gt;  First Line</span><br><span class="line">&gt; Second Line</span><br><span class="line">&gt; Third Line EOF</span><br><span class="line">&gt; EOF</span><br><span class="line"> First Line</span><br><span class="line">Second Line</span><br><span class="line">Third Line EOF</span><br></pre></td></tr></table></figure>
æ³¨âš ï¸ï¼š &gt;è¿™ä¸ªç¬¦å·æ˜¯ç»ˆç«¯äº§ç”Ÿçš„æç¤ºè¾“å…¥ä¿¡æ¯çš„æ ‡è¯†ç¬¦<br>è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹</li>
<li>EOF åªæ˜¯ä¸€ä¸ªæ ‡è¯†è€Œå·²ï¼Œå¯ä»¥æ›¿æ¢æˆä»»æ„çš„åˆæ³•å­—ç¬¦</li>
<li>ä½œä¸ºç»“å°¾çš„delimiterä¸€å®šè¦é¡¶æ ¼å†™ï¼Œå‰é¢ä¸èƒ½æœ‰ä»»ä½•å­—ç¬¦</li>
<li>ä½œä¸ºç»“å°¾çš„delimiteråé¢ä¹Ÿä¸èƒ½æœ‰ä»»ä½•çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰</li>
<li>ä½œä¸ºèµ·å§‹çš„delimiterå‰åçš„ç©ºæ ¼ä¼šè¢«çœç•¥æ‰<br>Here Document ä¸ä»…å¯ä»¥åœ¨ç»ˆç«¯ä¸Šä½¿ç”¨ï¼Œåœ¨shell æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä¾‹å¦‚ä¸‹é¢çš„here.sh æ–‡ä»¶<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &lt;&lt; EOF &gt; output.sh</span><br><span class="line">echo &quot;hello&quot;</span><br><span class="line">echo &quot;world&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
ä½¿ç”¨ bash here.sh è¿è¡Œè¿™ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œä¼šå¾—åˆ°output.sh è¿™ä¸ªæ–°æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹å¦‚ä¸‹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;hello&quot;</span><br><span class="line">echo &quot;world&quot;</span><br></pre></td></tr></table></figure></li>
<li>delimiter ä¸å˜é‡<br>åœ¨Here Document çš„å†…å®¹ä¸­ï¼Œä¸ä»…å¯ä»¥åŒ…æ‹¬æ™®é€šçš„å­—ç¬¦ï¼Œè¿˜å¯ä»¥åœ¨é‡Œé¢ä½¿ç”¨å˜é‡,ä¾‹å¦‚å°†ä¸Šé¢çš„here.shæ”¹ä¸º<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat here.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; EOF &gt; output.sh  #æ²¡æœ‰å¼•å·</span><br><span class="line">echo &quot;hello, $USER&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ bash here.sh</span><br><span class="line">$ cat output.sh</span><br><span class="line">echo &quot;hello, shuke&quot;</span><br></pre></td></tr></table></figure>
ä½¿ç”¨bash here.sh HereDocument è¿è¡Œè„šæœ¬å¾—åˆ°output.shçš„å†…å®¹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat output.sh</span><br><span class="line">echo &quot;hello $USER&quot;</span><br></pre></td></tr></table></figure>
åœ¨è¿™é‡Œ $1 è¢«å±•å¼€æˆä¸ºäº†è„šæœ¬çš„å‚æ•° HereDocument<br>ä½†æ˜¯æœ‰æ—¶å€™ä¸æƒ³å±•å¼€è¿™ä¸ªå˜é‡æ€ä¹ˆåŠå‘¢ï¼Œå¯ä»¥é€šè¿‡åœ¨èµ·å§‹çš„ delimiterçš„å‰åæ·»åŠ  â€œ æ¥å®ç°,å°†EOFæœ‰å¼•å·æ‹¬èµ·æ¥å°±å¯ä»¥ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat here.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">cat &lt;&lt; &quot;EOF&quot;     #æ³¨æ„å¼•å·</span><br><span class="line">echo &quot;hello, $USER&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ bash here.sh</span><br><span class="line">echo &quot;hello, $USER&quot;</span><br></pre></td></tr></table></figure>
<h3 id="4-Â«-å˜ä¸º-Â«"><a href="#4-Â«-å˜ä¸º-Â«" class="headerlink" title="4. Â« å˜ä¸º Â«-"></a>4. Â« å˜ä¸º Â«-</h3>Here Document è¿˜æœ‰ä¸€ä¸ªç”¨æ³•å°±æ˜¯å°† â€˜Â«â€™ å˜ä¸º â€˜Â«-â€˜ã€‚ ä½¿ç”¨ &lt;&lt;- çš„å”¯ä¸€å˜åŒ–å°±æ˜¯Here Document çš„å†…å®¹éƒ¨åˆ†æ¯è¡Œå‰é¢çš„ tab (åˆ¶è¡¨ç¬¦)å°†ä¼šè¢«åˆ é™¤æ‰ï¼Œè¿™ç§ç”¨æ³•æ˜¯ä¸ºäº†ç¼–å†™Here Documentçš„æ—¶å€™å¯ä»¥å°†å†…å®¹éƒ¨åˆ†è¿›è¡Œç¼©è¿›ï¼Œæ–¹ä¾¿é˜…è¯»ä»£ç .<br>å¦‚æœä½ æœ‰å¼ºè¿«ç—‡ï¼Œæœ‰æ—¶å€™ä½¿ç”¨here documentçš„æ—¶å€™ä¼šå¾ˆä¸çˆ½ï¼Œå› ä¸ºhere documenté‡Œé¢æ¯è¡Œé¦–éƒ¨çš„ç©ºæ ¼éƒ½ä¼šè¢«ä¿ç•™ï¼Œè€Œå¦‚æœè¦é¡¶æ ¼å†™ï¼Œåœ¨ç¼©è¿›çš„åœ°æ–¹åˆä¼šæœ‰ç‚¹æ‰“ä¹±ç»“æ„ï¼Œä¾‹å¦‚ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat b.sh</span><br><span class="line"># part 1</span><br><span class="line">if :; then</span><br><span class="line">    cat &lt;&lt; EOF</span><br><span class="line">    hello, $USER    </span><br><span class="line">EOF</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># part 2</span><br><span class="line">if :; then</span><br><span class="line">    if :; then</span><br><span class="line">        cat &lt;&lt; EOF</span><br><span class="line">hello, $USER    </span><br><span class="line">EOF</span><br><span class="line">    fi</span><br></pre></td></tr></table></figure>
ä¸Šé¢çš„è„šæœ¬æ‰§è¡Œçš„ç»“æœä¸ºï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sh b.sh </span><br><span class="line">    hello, kodango   # part 1 result</span><br><span class="line">hello, kodango       # part 2 result</span><br></pre></td></tr></table></figure>
æœ‰æ²¡æœ‰åŠæ³•æ—¢å…¼é¡¾åˆ°ç¼©è¿›åˆèƒ½ä¸ä¿ç•™è¡Œé¦–ç©ºæ ¼å‘¢ï¼Ÿ</li>
</ol>
<p>ç­”æ¡ˆä¹Ÿæ˜¯è‚¯å®šçš„ï¼Œåªä¸è¿‡è¯­æ³•åˆè¦ç¨ç¨å˜ä¸€ä¸‹ï¼Œç°åœ¨åœ¨&lt;&lt;çš„åé¢åŠ ä¸€ä¸ªçŸ­æ¨ªï¼Œè¿™ä¸ªç”¨æ³•ä¸‹ï¼Œè¡Œé¦–çš„Tabå­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat b.sh </span><br><span class="line">if :; then</span><br><span class="line">    cat &lt;&lt;- EOF</span><br><span class="line">    hello, $USER    </span><br><span class="line">EOF</span><br><span class="line">fi</span><br><span class="line">$ sh b.sh </span><br><span class="line">hello, shuke</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>ä¸€å®šè¦æ˜¯Tabé”®å“¦ï¼Œç©ºæ ¼ä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼Œåœ¨vimé‡Œé¢è¿˜è¦æ³¨æ„å¦‚æœè®¾ç½®äº†smarttabé€‰é¡¹ï¼Œè¡Œé¦–æ’å…¥çš„Tabé”®ä¼šæ›¿æ¢æˆç›¸åº”ä¸ªæ•°çš„ç©ºæ ¼(è¿™é‡Œå¯ä»¥æŒ‰ctrl+v tabæ’å…¥å®é™…çš„ç©ºæ ¼)</p>
<h3 id="5-ä½¿ç”¨å†…ç½®å‘½ä»¤declareæ˜¾ç¤ºè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°"><a href="#5-ä½¿ç”¨å†…ç½®å‘½ä»¤declareæ˜¾ç¤ºè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°" class="headerlink" title="5. ä½¿ç”¨å†…ç½®å‘½ä»¤declareæ˜¾ç¤ºè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°"></a>5. ä½¿ç”¨å†…ç½®å‘½ä»¤declareæ˜¾ç¤ºè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°</h3><p>declareçš„-Fé€‰é¡¹å¯ä»¥åˆ—å‡ºè„šæœ¬ä¸­å®šä¹‰çš„å‡½æ•°åç§°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat fun.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function one()</span><br><span class="line">&#123;</span><br><span class="line">    :</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function two()</span><br><span class="line">&#123;</span><br><span class="line">    :</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare -F | sed &#39;s&#x2F;declare -f &#x2F;&#x2F;&#39;</span><br><span class="line">shuke@MacBooKPro:&#x2F;tmp</span><br><span class="line">$ bash fun.sh</span><br><span class="line">one</span><br><span class="line">two</span><br></pre></td></tr></table></figure>
<h3 id="6-åµŒå¥—å‡½æ•°è¿˜å¯ä»¥è¿™ä¹ˆç”¨"><a href="#6-åµŒå¥—å‡½æ•°è¿˜å¯ä»¥è¿™ä¹ˆç”¨" class="headerlink" title="6. åµŒå¥—å‡½æ•°è¿˜å¯ä»¥è¿™ä¹ˆç”¨"></a>6. åµŒå¥—å‡½æ•°è¿˜å¯ä»¥è¿™ä¹ˆç”¨</h3><p>Bashä¸­å¯ä»¥åµŒå¥—å‡½æ•°å®šä¹‰ï¼Œå³åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®šä¹‰å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat fun.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">function out()</span><br><span class="line">&#123;</span><br><span class="line">    echo &quot;out&quot;</span><br><span class="line"></span><br><span class="line">    function inner() &#123;</span><br><span class="line">        echo &quot;inner&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">inner</span><br><span class="line">out</span><br><span class="line">inner</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œoutå‡½æ•°é‡Œé¢å®šä¹‰äº†innerå‡½æ•°ï¼Œå½¢æˆåµŒå¥—å‡½æ•°ã€‚ä½†æ˜¯ï¼Œæ‰§è¡Œä¸Šé¢çš„ä¾‹å­ä¼šå‡ºé”™ï¼ˆnest.sh: line 12: inner: command not foundï¼‰ï¼Œè¿™æ˜¯å› ä¸ºè¿™æ˜¯åinnerå‡½æ•°è¿˜æ²¡å®šä¹‰ã€‚ä¸€æ—¦outå‡½æ•°æ‰§è¡Œä¹‹åï¼Œinnerå‡½æ•°å°±è¢«å®šä¹‰äº†ã€‚æ•´ä¸ªä¾‹å­çš„æ‰§è¡Œç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ bash fun.sh</span><br><span class="line">fun.sh: line 13: inner: command not found</span><br><span class="line">out</span><br><span class="line">inner</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæƒ³åµŒå¥—å‡½æ•°æœ‰ä»€ä¹ˆç”¨ï¼Ÿäº‹å®ä¸Šï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸ä¼šç”¨åˆ°åµŒå¥—å‡½æ•°ã€‚ä½†æ˜¯å®ƒå¹¶éä¸€æ— æ˜¯å¤„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±å‘æˆ‘ä»¬å±•ç¤ºäº†åµŒå¥—å‡½æ•°çš„ç¥å¥‡ç”¨æ³•ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€ä¸ªè°ƒè¯•å‡½æ•°ï¼ŒåŒæ—¶éœ€è¦ä¸€ä¸ªå¼€å…³æ§åˆ¶è¯¥å‡½æ•°æ˜¯å¦è¾“å‡ºè°ƒè¯•æ—¥å¿—ï¼Œæœ€ç®€å•çš„å†™æ³•æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function log()</span><br><span class="line">&#123;</span><br><span class="line">    if [ &quot;$verbose&quot; &#x3D; &quot;1&quot; ]; then</span><br><span class="line">        echo &quot;$@&quot;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒå¯ä»¥å®Œæˆä»»åŠ¡ï¼Œä½†æ˜¯å”¯ä¸€ç¾ä¸­ä¸è¶³çš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨è¯¥å‡½æ•°éƒ½è¦åˆ¤æ–­verboseçš„å€¼æ˜¯å¦ä¸º1ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨åµŒå¥—å‡½æ•°æ¥å¼¥è¡¥è¿™ä¸ªä¸è¶³ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat fun.sh</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">verbose&#x3D;$&#123;1:-1&#125;</span><br><span class="line"></span><br><span class="line">function log()</span><br><span class="line">&#123;</span><br><span class="line">    if [ $verbose -eq 1 ]; then</span><br><span class="line">        function log() &#123;</span><br><span class="line">            echo &quot;$@&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        echo &quot;$@&quot;</span><br><span class="line">    else</span><br><span class="line">        function log() &#123;</span><br><span class="line">            :</span><br><span class="line">        &#125;</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">log what is your name</span><br><span class="line">log my name is shuke</span><br><span class="line"></span><br><span class="line">$ bash fun.sh</span><br><span class="line">what is your name</span><br><span class="line">my name is shuke</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ ¹æ®verboseçš„å€¼å®šä¹‰äº†ä¸¤ä¸ªåŒåçš„logå‡½æ•°æ¥è¦†ç›–ä¹‹å‰çš„æ—§å‡½æ•°ï¼Œä»¥åè°ƒç”¨çš„å‡½æ•°å°±éƒ½æ˜¯åå®šä¹‰çš„å‡½æ•°äº†ã€‚</p>
<h3 id="7-åˆ é™¤ps-auxf-grep-pythonç»“æœä¸­çš„grepè¿›ç¨‹"><a href="#7-åˆ é™¤ps-auxf-grep-pythonç»“æœä¸­çš„grepè¿›ç¨‹" class="headerlink" title="7. åˆ é™¤ps auxf | grep pythonç»“æœä¸­çš„grepè¿›ç¨‹"></a>7. åˆ é™¤ps auxf | grep pythonç»“æœä¸­çš„grepè¿›ç¨‹</h3><p>åœ¨shellè„šæœ¬ä¸­ï¼Œç»å¸¸éœ€è¦åˆ©ç”¨pså’Œgrepå‘½ä»¤ä¸€èµ·åœ¨æŸ¥æ‰¾è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹python/java/shellç­‰è„šæœ¬è¿›ç¨‹ï¼Œå› ä¸ºpidofæœ¬èº«ä¸å¤§æ”¯æŒæŸ¥æ‰¾è„šæœ¬è¿›ç¨‹å¯¹åº”çš„pidã€‚</p>
<p>åœ¨ç”¨ps auxf | grep pythonçš„æ—¶å€™ï¼Œä¸€ä¸ªå¾ˆæ¼äººçš„äº‹æƒ…æ˜¯ï¼Œç»å¸¸ä¼šå‡ºç°å¤šä½™çš„grepè¿›ç¨‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ps aux | grep python</span><br><span class="line">shuke            76718   0.1  0.5  4341192  42404 s001  S+   12:52ä¸‹åˆ   0:01.32 &#x2F;Users&#x2F;zhao&#x2F;anaconda3&#x2F;envs&#x2F;sloth&#x2F;bin&#x2F;python manage.py runserver 8000</span><br><span class="line">shuke            76732   0.0  0.0  4284136    884 s003  S+   12:53ä¸‹åˆ   0:00.00 grep python</span><br><span class="line">shuke            76716   0.0  0.4  4329332  32936 s001  S+   12:52ä¸‹åˆ   0:00.68 python manage.py runserver 8000</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†åŠ ä¸€ä¸ªgrep -v grepæ¥æ’é™¤å®ƒã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ps aux | grep python | grep -v grep</span><br><span class="line">shuke            76718   0.1  0.5  4341192  42404 s001  R+   12:52ä¸‹åˆ   0:02.13 &#x2F;Users&#x2F;zhao&#x2F;anaconda3&#x2F;envs&#x2F;sloth&#x2F;bin&#x2F;python manage.py runserver 8000</span><br><span class="line">shuke            76716   0.0  0.4  4329332  32936 s001  S+   12:52ä¸‹åˆ   0:00.68 python manage.py runserver 8000</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯å·§ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ps aux | grep [p]ython</span><br><span class="line">shuke            76718   0.5  0.5  4341192  42412 s001  S+   12:52ä¸‹åˆ   0:03.58 &#x2F;Users&#x2F;zhao&#x2F;anaconda3&#x2F;envs&#x2F;sloth&#x2F;bin&#x2F;python manage.py runserver 8000</span><br><span class="line">shuke            76716   0.0  0.4  4329332  32936 s001  S+   12:52ä¸‹åˆ   0:00.68 python manage.py runserver 8000</span><br></pre></td></tr></table></figure>

<p> ä¸€ä¸ªå¾ˆå¥½çš„è§£é‡Š: shellåœ¨æ‰§è¡Œä»¥ä¸Šå‘½ä»¤çš„æ—¶å€™ï¼Œå…¶å®åˆ›å»ºäº†ä¸€ä¸ªç®¡é“ï¼Œå¹¶ä¸”forkäº†ä¸¤ä¸ªå­è¿›ç¨‹ï¼šps auxfä¸grep pythonï¼Œå¹¶ä¸”å°†ç®¡é“è¯»çš„è¿™ä¸€ç«¯ç»‘å®šåˆ°grepçš„æ ‡å‡†è¾“å…¥ï¼Œç®¡é“å†™çš„è¿™ä¸€æ®µç»‘å®šåˆ°psçš„æ ‡å‡†è¾“å‡ºã€‚pså°†è‡ªå·±çš„è¾“å‡ºå†™åˆ°ç®¡é“ï¼Œgrepä»ç®¡é“ä¸­è¯»å–è¾“å…¥ã€‚å¯èƒ½åœ¨è¿™ä¸ªæ—¶å€™ï¼Œpsä¸grepæ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œæ‰€ä»¥psçš„ç»“æœä¸­ä¹Ÿä¼šåŒ…å«grepè¿›ç¨‹çš„ä¿¡æ¯ã€‚</p>
<h3 id="8-Shellå¦‚ä½•å®ç°timeoutåŠŸèƒ½"><a href="#8-Shellå¦‚ä½•å®ç°timeoutåŠŸèƒ½" class="headerlink" title="8. Shellå¦‚ä½•å®ç°timeoutåŠŸèƒ½"></a>8. Shellå¦‚ä½•å®ç°timeoutåŠŸèƒ½</h3><p> æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›æŸä¸ªå‘½ä»¤æ‰§è¡Œå¤ªä¹…ï¼Œæ‰€ä»¥å¦‚æœåœ¨ç»™å®šçš„æ—¶é—´å†…æ²¡æœ‰å®Œæˆï¼Œèƒ½å¤Ÿæ€æ‰è¿™ä¸ªå‘½ä»¤å¯¹åº”çš„è¿›ç¨‹ï¼Œè¿™å°±æ˜¯timeoutåŠŸèƒ½ï¼Œå¯æƒœbashæ²¡æœ‰æä¾›è¯¥åŠŸèƒ½ã€‚æ‰€ä»¥å°±å¾—æˆ‘ä»¬è‡ªå·±æ¥å®ç°ã€‚</p>
<p>å®ç°ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function timeout()</span><br><span class="line">&#123;</span><br><span class="line">    local time cmd pid</span><br><span class="line"></span><br><span class="line">    if echo &quot;$1&quot; | grep -Eq &#39;^[0-9]+&#39;; then</span><br><span class="line">        time&#x3D;$1</span><br><span class="line">        shift &amp;&amp; cmd&#x3D;&quot;$@&quot;</span><br><span class="line">    else</span><br><span class="line">        time&#x3D;5</span><br><span class="line">        cmd&#x3D;&quot;$@&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    $cmd &amp;</span><br><span class="line">    pid&#x3D;$!</span><br><span class="line"></span><br><span class="line">    while kill -0 $pid &amp;&gt;&#x2F;dev&#x2F;null; do</span><br><span class="line">        sleep 1</span><br><span class="line">        let time-&#x3D;1</span><br><span class="line"></span><br><span class="line">        if [ &quot;$time&quot; &#x3D; &quot;0&quot; ]; then</span><br><span class="line">            kill -9 $pid &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">            wait $pid &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">        fi</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡è®¾æœ‰ä¸€ä¸ªæµ‹è¯•è„šæœ¬,å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat sleep.sh</span><br><span class="line">echo &quot;sleep $1 seconds&quot;</span><br><span class="line">sleep $1</span><br><span class="line">echo &quot;awake from sleep&quot;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨åˆ©ç”¨æˆ‘ä»¬å†™çš„timeoutå‡½æ•°æ¥è¾¾åˆ°è¶…æ—¶killåŠŸèƒ½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ time bash timeout.sh 2 &#39;sh sleep.sh 100&#39;</span><br><span class="line">sleep 100 seconds</span><br><span class="line"></span><br><span class="line">real    0m2.005s</span><br><span class="line">user    0m0.002s</span><br><span class="line">sys    0m0.001s</span><br></pre></td></tr></table></figure>
<p>çœ‹æœ€ç»ˆæ‰§è¡Œçš„æ—¶é—´ï¼Œå·®ä¸å¤šå°±æ˜¯2ç§’é’Ÿã€‚<br>ä¸Šé¢timeoutå‡½æ•°å®ç°çš„ä»£ç ä¸­ï¼Œåˆ©ç”¨äº†ä¸¤ä¸ªæŠ€å·§ï¼š</p>
<ol>
<li>kill -0 $pidï¼šå‘é€ä¿¡å·0ç»™è¿›ç¨‹ï¼Œå¯ä»¥æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœè¿›ç¨‹ä¸å­˜åœ¨æˆ–è€…æ²¡æœ‰æƒé™ï¼Œåˆ™è¿”å›é”™è¯¯ï¼Œé”™è¯¯ç ä¸º1ï¼›</li>
<li>wait $pid &amp;&gt;/dev/nullï¼šç­‰å¾…æŸä¸ªè¿›ç¨‹é€€å‡ºè¿”å›ï¼Œè¿™æ ·ç›¸å¯¹æ¯”è¾ƒä¼˜é›…ï¼ŒåŒæ—¶å°†é”™è¯¯é‡å®šå‘åˆ°é»‘æ´ï¼Œä»è€Œéšè—åå°è¿›ç¨‹è¢«killçš„é”™è¯¯è¾“å‡ºï¼›<h3 id="9-åˆ©ç”¨-etc-inittabå®ç°watchdog"><a href="#9-åˆ©ç”¨-etc-inittabå®ç°watchdog" class="headerlink" title="9. åˆ©ç”¨/etc/inittabå®ç°watchdog"></a>9. åˆ©ç”¨/etc/inittabå®ç°watchdog</h3>è¿˜åœ¨ä¸ºå®ç°watch dogè€Œå¤´ç–¼å—ï¼Œå…¶å®inittabä¸­å·²ç»åŒ…å«äº†è¯¥åŠŸèƒ½ã€‚å¯ä»¥å°†è‡ªå·±çš„è„šæœ¬æˆ–è€…ç¨‹åºå†™åˆ°inittabæ–‡ä»¶ä¸­ï¼š<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tt:2345:respawn:&#x2F;home&#x2F;kodango&#x2F;sleep.sh 100</span><br></pre></td></tr></table></figure>
ç„¶åæ‰§è¡Œtelinit qä½¿å…¶ç”Ÿæ•ˆï¼Œpsçœ‹ä¸‹è¯¥è„šæœ¬æ˜¯å¦å·²ç»åœ¨è¿è¡Œäº†ï¼Œå°è¯•killåï¼Œåˆä¼šè¢«èµ·èµ·æ¥ã€‚</li>
</ol>
<h3 id="10-æ…ç”¨æ³¢æµªå·å±•å¼€"><a href="#10-æ…ç”¨æ³¢æµªå·å±•å¼€" class="headerlink" title="10. æ…ç”¨æ³¢æµªå·å±•å¼€"></a>10. æ…ç”¨æ³¢æµªå·å±•å¼€</h3><p>åœ¨shellä¸­å¯¹æ¯”ä¸‹é¢ä¸¤ç§ç”¨æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ home1&#x3D;~shuke</span><br><span class="line">$ home2&#x3D;&quot;~shuke&quot;</span><br><span class="line">$ echo -e &quot;$home1\n$home2&quot;</span><br><span class="line">&#x2F;Users&#x2F;zhao</span><br><span class="line">~shuke</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œæ³¢æµªå·æ­£ç¡®å±•å¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°äº†kodangoç”¨æˆ·çš„å®¶ç›®å½•åœ°å€ï¼›ç¬¬äºŒä¸ªå˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†åŒå¼•å·ï¼Œè¿™ä¸ªæ—¶å€™æ³¢æ³¢æµªå·å¹¶æ²¡æœ‰å±•å¼€ã€‚è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼Œæ³¢æµªå·å±•å¼€åªåœ¨:æˆ–è€…=å·åé¢æ‰ä¼šæ‰§è¡Œã€‚æ‰€ä»¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ path&#x3D;1~shuke</span><br><span class="line">$ echo &quot;$path&quot;</span><br><span class="line">1~shuke</span><br><span class="line"></span><br><span class="line">$ path&#x3D;1:~shuke</span><br><span class="line">$ echo &quot;$path&quot;</span><br><span class="line">1:&#x2F;Users&#x2F;shuke</span><br></pre></td></tr></table></figure>
<p>ä¸ºä»€ä¹ˆè¦åœ¨:åé¢ä¹Ÿå¯ä»¥å±•å¼€å‘¢ï¼Ÿæƒ³æƒ³PATHçš„å®šä¹‰å§ã€‚</p>
<h3 id="11-pushd-popd"><a href="#11-pushd-popd" class="headerlink" title="11. pushd/popd"></a>11. pushd/popd</h3><p>è¿™ä¸ªåœ¨è„šæœ¬ä¸­éå¸¸å¥½ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾ªç¯ä¸­<br>å¦‚ä¸‹æ‰€ç¤ºï¼Œå‡è®¾ä½ æ­£åœ¨å†™ä¸€ä¸ªè¿›å…¥é€€å‡ºæ–‡ä»¶å¤¹çš„forå¾ªç¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for d1 in $(ls -d *&#x2F;)</span><br><span class="line">do</span><br><span class="line"> # Store original working directory.</span><br><span class="line"> original_wd&#x3D;&quot;$(pwd)&quot;</span><br><span class="line"> cd &quot;$d1&quot;</span><br><span class="line"> for d2 in $(ls -d *&#x2F;)</span><br><span class="line"> do</span><br><span class="line">   pushd &quot;$d2&quot;</span><br><span class="line">   # Do something</span><br><span class="line">   popd</span><br><span class="line"> done</span><br><span class="line"> # Return to original working directory</span><br><span class="line"> cd &quot;$&#123;original_wd&#125;&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<p>ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨pushdæ ˆæ¥é‡å†™ä¸Šæ–¹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for d1 in $(ls -d *)</span><br><span class="line">do</span><br><span class="line"> pushd &quot;$d1&quot;</span><br><span class="line"> for d2 in $(ls  -d *&#x2F;)</span><br><span class="line"> do</span><br><span class="line">   pushd &quot;$d2&quot;</span><br><span class="line">   # Do something</span><br><span class="line">   popd</span><br><span class="line"> done</span><br><span class="line"> popd</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>å®ƒå¯ä»¥è¿½è¸ªè®°å½•ä½ åˆ‡æ¢çš„ç›®å½•å¹¶è¿›è¡Œå…¥æ ˆæˆ–å‡ºæ ˆ<br>æ³¨æ„ï¼Œå½“ä½¿ç”¨pushdå‡ºç°é”™è¯¯æ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±æ ˆçš„è®°å½•å¹¶ä¸”popdå¤šæ¬¡ã€‚å› æ­¤ä½ å¯èƒ½ä¼šæƒ³è¦åœ¨è„šæœ¬ä¸­ä½¿ç”¨set -eï¼ˆè§ä¸Šä¸€ç¯‡æ–‡ç« ï¼‰</p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç”¨cd -ï¼Œä½†æ˜¯å®ƒä¸ä¼šä½¿ç”¨æ ˆâ€”â€”ä»…ä»…è¿”å›å‰ä¸€ä¸ªç›®å½•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd ~</span><br><span class="line">cd &#x2F;tmp</span><br><span class="line">cd blah</span><br><span class="line">cd - # Back to &#x2F;tmp</span><br><span class="line">cd - # Back to &#39;blah&#39;</span><br><span class="line">cd - # Back to &#x2F;tmp</span><br><span class="line">cd - # Back to &#39;blah&#39; ...</span><br></pre></td></tr></table></figure>

<h3 id="12-shopt-vs-set"><a href="#12-shopt-vs-set" class="headerlink" title="12.shopt vs set"></a>12.shopt vs set</h3><p>è¿™ä¸¤ä¸ªå‘½ä»¤å›°æ‰°äº†æˆ‘ä¸€é˜µå­ã€‚<br>ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ<br>setåœ¨ä¹‹å‰çš„æ–‡ç« å·²ç»ä»‹ç»è¿‡äº†ï¼Œè€Œshoptçœ‹èµ·æ¥ä¸ä¹‹ç›¸ä¼¼ã€‚åªè¾“å…¥shoptä¼šæ˜¾ç¤ºä¸€ç³»åˆ—é€‰é¡¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ shopt</span><br><span class="line">cdable_vars    off</span><br><span class="line">cdspell        on</span><br><span class="line">checkhash      off</span><br><span class="line">checkwinsize   on</span><br><span class="line">cmdhist        on</span><br><span class="line">compat31       off</span><br><span class="line">dotglob        off</span><br></pre></td></tr></table></figure>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œä¼¼ä¹æœ‰ä¸€ç³»åˆ—çš„bashï¼ˆå’Œå…¶ä»–shellsï¼‰å»ºç«‹åœ¨shä¹‹ä¸Šï¼Œè€Œæ·»åŠ shoptå‘½ä»¤åˆ™ä¸ºè®¾ç½®é¢å¤–çš„shellé€‰é¡¹æä¾›äº†ä¸€ç§æ–¹å¼</p>
<h3 id="13-Here-Docs-ä¸-Here-Strings"><a href="#13-Here-Docs-ä¸-Here-Strings" class="headerlink" title="13. Here Docs ä¸ Here Strings"></a>13. Here Docs ä¸ Here Strings</h3><p>â€œHere Docsâ€æ˜¯åœ¨shellä¸­ç”¨ä¸€äº›è¯­å¥åˆ›å»ºçš„æ–‡ä»¶ã€‚</p>
<p>â€œè¯€çªâ€å¾ˆç®€å•ã€‚å®šä¹‰ä¸€ä¸ªç”¨äºç»“æŸçš„å•è¯ï¼Œåˆ™åœ¨è¿™ä¸ªå•è¯å•ç‹¬å‡ºç°åœ¨ä¸€è¡Œä¹‹å‰çš„æ‰€æœ‰è¾“å…¥è¡Œå°†æ„æˆæ–‡ä»¶ã€‚</p>
<p>åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &gt; afile &lt;&lt; SOMEENDSTRING</span><br><span class="line">&gt; here is a doc</span><br><span class="line">&gt; it has three lines</span><br><span class="line">&gt; SOMEENDSTRING alone on a line will save the doc</span><br><span class="line">&gt; SOMEENDSTRING</span><br><span class="line">$ cat afile</span><br><span class="line">here is a doc</span><br><span class="line">it has three lines</span><br><span class="line">SOMEENDSTRING alone on a line will save the doc</span><br><span class="line">$</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>å¦‚æœç»“æŸå•è¯ä¸æ˜¯â€œå•ç‹¬â€å‡ºç°åœ¨ä¸€è¡Œä¸­ï¼Œé‚£å®ƒå¯ä»¥æ„æˆæ–‡ä»¶</li>
<li>SOMEENDSTRINGé€šå¸¸æ˜¯ENDï¼Œä½†è¿™ä»…ä»…åªæ˜¯ä¹ æƒ¯<br>æ›´é²œä¸ºäººçŸ¥çš„æ˜¯â€here stringâ€:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat &gt; asd &lt;&lt;&lt; &#39;This file has one line&#39;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="14-å­—ç¬¦ä¸²å˜é‡çš„æ“ä½œ"><a href="#14-å­—ç¬¦ä¸²å˜é‡çš„æ“ä½œ" class="headerlink" title="14. å­—ç¬¦ä¸²å˜é‡çš„æ“ä½œ"></a>14. å­—ç¬¦ä¸²å˜é‡çš„æ“ä½œ</h3><p>ä»¥å‰ä½ å¯èƒ½æ˜¯åƒä¸‹é¢å±•ç¤ºçš„é‚£æ ·å†™ä»£ç ï¼Œç”¨sedä¸€ç±»çš„å·¥å…·æ¥æ“ä½œå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ VAR&#x3D;&#39;HEADERMy voice is my passwordFOOTER&#39;</span><br><span class="line">$ PASS&#x3D;&quot;$(echo $VAR | sed &#39;s&#x2F;^HEADER(.*)FOOTER&#x2F;1&#x2F;&#39;)&quot;</span><br><span class="line">$ echo $PASS</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä½ å¯èƒ½ä¸çŸ¥é“bashæœ¬èº«ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>è¿™æ„å‘³ç€ä½ å¯ä»¥çœå»å¤§é‡çš„sedå’Œawkã€‚<br>ä¸€ç§é‡å†™ä¸Šè¿°ä»£ç çš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ VAR&#x3D;&#39;HEADERMy voice is my passwordFOOTER&#39;</span><br><span class="line">$ PASS&#x3D;&quot;$&#123;VAR#HEADER&#125;&quot;</span><br><span class="line">$ PASS&#x3D;&quot;$&#123;PASS%FOOTER&#125;&quot;</span><br><span class="line">$ echo $PASS</span><br></pre></td></tr></table></figure>
<ul>
<li>#è¡¨ç¤ºâ€ä»å­—ç¬¦ä¸²å¼€å¤´å¼€å§‹åŒ¹é…å¹¶åˆ é™¤æ‰€ç»™çš„æ¨¡å¼ä¸²â€</li>
<li>%è¡¨ç¤ºâ€ä»å­—ç¬¦ä¸²ç»“å°¾å¼€å§‹åŒ¹é…å¹¶åˆ é™¤æ‰€ç»™çš„æ¨¡å¼ä¸²â€</li>
</ul>
<p>åœ¨æˆ‘çš„ç”µè„‘ä¸Šï¼Œåä¸€ç§æ–¹æ³•æ¯”å‰ä¸€ç§å¿«ä¸¤å€ã€‚å¹¶ä¸”(ä»¤æˆ‘åƒæƒŠçš„æ˜¯),ä»–çš„é€Ÿåº¦è·Ÿç±»ä¼¼åŠŸèƒ½çš„pythonè„šæœ¬é€Ÿåº¦å¤§è‡´ç›¸å½“<br>å¦‚æœä½ æƒ³ä½¿ç”¨é€šé…ç¬¦ï¼ˆè§å‰æ–‡ï¼‰æ¨¡å¼ä¸²å¹¶é‡‡ç”¨è´ªå©ªæ¨¡å¼ï¼Œä½ éœ€è¦åŒå†™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ VAR&#x3D;&#39;HEADERMy voice is my passwordFOOTER&#39;</span><br><span class="line">$ echo $&#123;VAR##HEADER*&#125;</span><br><span class="line">$ echo $&#123;VAR%%*FOOTER&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-å˜é‡çš„é»˜è®¤å€¼"><a href="#15-å˜é‡çš„é»˜è®¤å€¼" class="headerlink" title="15.å˜é‡çš„é»˜è®¤å€¼"></a>15.å˜é‡çš„é»˜è®¤å€¼</h3><p>è¿™äº›å¯¹å†™è„šæœ¬æ¥è¯´éå¸¸å¥½ç”¨ã€‚<br>å¦‚æœä½ æœ‰ä¸€ä¸ªæ²¡æœ‰èµ‹å€¼çš„å˜é‡ï¼Œä½ å¯ä»¥åƒè¿™æ ·ç»™å®ƒâ€œèµ‹é»˜è®¤å€¼â€<br>åˆ›å»ºä¸€ä¸ªdefault.shæ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">FIRST_ARG&#x3D;&quot;$&#123;1:-no_first_arg&#125;&quot;</span><br><span class="line">SECOND_ARG&#x3D;&quot;$&#123;2:-no_second_arg&#125;&quot;</span><br><span class="line">THIRD_ARG&#x3D;&quot;$&#123;3:-no_third_arg&#125;&quot;</span><br><span class="line">echo $&#123;FIRST_ARG&#125;</span><br><span class="line">echo $&#123;SECOND_ARG&#125;</span><br><span class="line">echo $&#123;THIRD_ARG&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ‰§è¡Œchmod +x default.shå¹¶ç”¨./default.sh first secondæ¥è¿è¡Œè„šæœ¬ï¼š<br>è§‚å¯Ÿç¬¬ä¸‰ä¸ªå‚æ•°çš„é»˜è®¤å€¼æ˜¯å¦‚ä½•è¢«åˆ†é…çš„ï¼Œè€Œä¸æ˜¯å‰ä¸¤ä¸ªã€‚<br>ä½ ä¹Ÿå¯ä»¥ç›´æ¥ç”¨${VAR:=defaultval}(ç­‰å·ï¼Œä¸æ˜¯ç ´æŠ˜å·)ï¼Œä½†æ˜¯æ³¨æ„è¿™ä¸é€‚ç”¨äºè„šæœ¬æˆ–å‡½æ•°ä¸­çš„ä½ç½®å˜é‡ã€‚å°è¯•ä¿®æ”¹ä¸Šé¢çš„è„šæœ¬æ¥çœ‹å®ƒæ˜¯å¦‚ä½•å¤±è´¥çš„ã€‚</p>
<h3 id="16-Traps"><a href="#16-Traps" class="headerlink" title="16. Traps"></a>16. Traps</h3><p>å½“ä¸€ä¸ªä¿¡å·è¢«é€åˆ°è„šæœ¬æ—¶ï¼Œå†…å»ºçš„trapå¯ä»¥ç”¨äºâ€œæ•è·â€<br>ä¸‹é¢æ˜¯æˆ‘ç”¨åœ¨è‡ªå·±çš„chepciè„šæœ¬ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function cleanup() &#123;</span><br><span class="line">   rm -rf &quot;$&#123;BUILD_DIR&#125;&quot;</span><br><span class="line">   rm -f &quot;$&#123;LOCK_FILE&#125;&quot;</span><br><span class="line">   # get rid of &#x2F;tmp detritus, leaving anything accessed 2 days ago+</span><br><span class="line">   find &quot;$&#123;BUILD_DIR_BASE&#125;&quot;&#x2F;* -type d -atime +1 | rm -rf</span><br><span class="line">   echo &quot;cleanup done&quot;                                                     &#125;</span><br><span class="line">trap cleanup TERM INT QUIT</span><br></pre></td></tr></table></figure>
<p>ä»»ä½•ä½¿ç”¨TERMä¿¡å·çš„CTRL-C,CTRL-æˆ–ç»ˆæ­¢ç¨‹åºçš„æ“ä½œå°†ä¼šé¦–å…ˆè°ƒç”¨cleanup<br>âš ï¸ æ³¨æ„ï¼š</p>
<ul>
<li>trapçš„é€»è¾‘å¯èƒ½éå¸¸æ£˜æ‰‹ï¼ˆä¾‹å¦‚å¤„ç†ä¿¡å·ç«äº‰æ¡ä»¶ï¼‰</li>
<li>KILLä¿¡å·ä¸èƒ½ä»¥è¿™ç§æ–¹å¼æ•è·<br>ä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä¼šæŠŠå®ƒç”¨äºç±»ä¼¼ä¸Šè¿°çš„â€˜cleanupâ€™ä¸­ï¼Œæ¥è¾¾æˆå‡½æ•°çš„ç›®çš„ã€‚</li>
</ul>
<h3 id="17-Shellå˜é‡"><a href="#17-Shellå˜é‡" class="headerlink" title="17. Shellå˜é‡"></a>17. Shellå˜é‡</h3><p>äº†è§£å¯ç”¨çš„æ ‡å‡†shellå˜é‡æ˜¯éå¸¸å€¼å¾—çš„ã€‚è¿™äº›æ˜¯æˆ‘æœ€å–œæ¬¢çš„ã€‚<br>RANDOM<br>ä¸è¦ä¾èµ–è¿™ä¸ªæ¥åŠ å¯†å †æ ˆï¼Œä½†ä½ å¯ä»¥ç”Ÿæˆéšæœºæ•°å­—ï¼Œä¾‹å¦‚åœ¨è„šæœ¬ä¸­åˆ›å»ºä¸´æ—¶æ–‡ä»¶æ—¶ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $&#123;RANDOM&#125;</span><br><span class="line">16313</span><br><span class="line">$ # Not enough digits?</span><br><span class="line">$ echo $&#123;RANDOM&#125;$&#123;RANDOM&#125;</span><br><span class="line">113610703</span><br><span class="line">$ NEWFILE&#x3D;&#x2F;tmp&#x2F;newfile_$&#123;RANDOM&#125;</span><br><span class="line">$ touch $NEWFILE</span><br></pre></td></tr></table></figure>

<p>REPLY<br>ä¸åœ¨éœ€è¦ç»™readä¸€ä¸ªå˜é‡åç§°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ read</span><br><span class="line">my input</span><br><span class="line">$ echo $&#123;REPLY&#125;</span><br></pre></td></tr></table></figure>

<p>LINENO ä¸ SECONDS<br>æ–¹ä¾¿è°ƒè¯•</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ echo $&#123;LINENO&#125;</span><br><span class="line">115</span><br><span class="line">$ echo $&#123;SECONDS&#125;; sleep 1; echo $&#123;SECONDS&#125;; echo $LINENO</span><br><span class="line">174380</span><br><span class="line">174381</span><br><span class="line">116</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œå³ä¾¿ä½¿ç”¨;æ¥éš”å¼€å‘½ä»¤ï¼Œä¸Šé¢çš„ä»£ç ä¹Ÿè¦åˆ†ä¸¤è¡Œ</p>
<p>TMOUT<br>å¯ä»¥ç”¨æ¥è¶…æ—¶è¯»å–ï¼Œåœ¨ä¸€äº›è„šæœ¬ä¸­çœŸçš„å¾ˆå¥½ç”¨</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">TMOUT&#x3D;5</span><br><span class="line">echo You have 5 seconds to respond...</span><br><span class="line">read</span><br><span class="line">echo $&#123;REPLY:-noreply&#125;</span><br></pre></td></tr></table></figure>

<p>Extglobs</p>
<p>å¦‚æœä½ çœŸçš„æ²‰è¿·bashä¸èƒ½è‡ªæ‹”ï¼Œé‚£ä¹ˆä½ å¯èƒ½æƒ³è¦å¢å¼ºä½ çš„é€šé…åŠŸèƒ½ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®shellä¸­çš„extglobé€‰é¡¹ã€‚è¿™æ˜¯è®¾ç½®æ–¹æ³•ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">shopt -s extglob</span><br><span class="line">A&#x3D;&quot;12345678901234567890&quot;</span><br><span class="line">B&#x3D;&quot;  $&#123;A&#125;  &quot;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æ¥çœ‹çœ‹ä½ æ˜¯å¦èƒ½æŒ‡å‡ºä»¥ä¸‹è¿™äº›è¯­å¥å„è‡ªçš„åŠŸèƒ½ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">echo &quot;B      |$&#123;B&#125;|&quot;</span><br><span class="line">echo &quot;B#+( ) |$&#123;B#+( )&#125;|&quot;</span><br><span class="line">echo &quot;B#?( ) |$&#123;B#?( )&#125;|&quot;</span><br><span class="line">echo &quot;B#*( ) |$&#123;B#*( )&#125;|&quot;</span><br><span class="line">echo &quot;B##+( )|$&#123;B##+( )&#125;|&quot;</span><br><span class="line">echo &quot;B##*( )|$&#123;B##*( )&#125;|&quot;</span><br><span class="line">echo &quot;B##?( )|$&#123;B##?( )&#125;|&quot;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶å®ƒå¯èƒ½å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¾ˆéš¾æƒ³è±¡å‡ºä¸€ç§ä½ å¿…é¡»è¦ç”¨è¿™ç§æ–¹å¼çš„æƒ…å†µã€‚é€šå¸¸ä½ ä¼šä½¿ç”¨ä¸€äº›æ›´é€‚åˆç›¸åº”ä»»åŠ¡çš„å·¥å…·ï¼ˆåƒsedï¼‰æˆ–è€…ç›´æ¥æ”¾å¼ƒbashå»ä½¿ç”¨ä¸€äº›åƒpythoné‚£æ ·çš„â€œåˆé€‚çš„â€ç¼–ç¨‹è¯­è¨€ã€‚</p>
<h3 id="18-å…³è”æ•°ç»„"><a href="#18-å…³è”æ•°ç»„" class="headerlink" title="18.å…³è”æ•°ç»„"></a>18.å…³è”æ•°ç»„</h3><p>è°ˆåˆ°ç§»æ¤åˆ°å…¶ä»–è¯­è¨€ï¼Œä¸€æ¡é‡è¦çš„è§„åˆ™æ˜¯ï¼Œå¦‚æœæˆ‘éœ€è¦ç”¨åˆ°æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä¼šæ”¾å¼ƒbashï¼Œä½¿ç”¨pythonï¼ˆä¸ºæ­¤æˆ‘ç”šè‡³åˆ›å»ºäº†ä¸€ä¸ªDocker Containeræ¥è¿è¡Œä¸€ä¸ªä¸“é—¨çš„å·¥å…·ï¼‰</p>
<p>çŸ¥é“è¯»åˆ°å®ƒæˆ‘æ‰çŸ¥é“ï¼Œåœ¨bashä¸­æœ‰å…³è”æ•°ç»„</p>
<p>ä»¥ä¸‹æ˜¯æ¼”ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ declare -A MYAA&#x3D;([one]&#x3D;1 [two]&#x3D;2 [three]&#x3D;3)</span><br><span class="line">$ MYAA[one]&#x3D;&quot;1&quot;</span><br><span class="line">$ MYAA[two]&#x3D;&quot;2&quot;</span><br><span class="line">$ echo $MYAA</span><br><span class="line">$ echo $&#123;MYAA[one]&#125;</span><br><span class="line">$ MYAA[one]&#x3D;&quot;1&quot;</span><br><span class="line">$ WANT&#x3D;two</span><br><span class="line">$ echo $&#123;MYAA[$WANT]&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ä»…é€‚ç”¨äºbash4.x+ç‰ˆæœ¬</p>
<h3 id="19-å®ç”¨çš„shellæ–‡ç« "><a href="#19-å®ç”¨çš„shellæ–‡ç« " class="headerlink" title="19. å®ç”¨çš„shellæ–‡ç« "></a>19. å®ç”¨çš„shellæ–‡ç« </h3><p><a href="http://mywiki.wooledge.org/BashPitfalls?spm=a2c4e.11153959.blogcont68524.18.4dbf3d2foIG0jZ" target="_blank" rel="noopener">BashPitfalls - Gregâ€™s Wiki</a><br><a href="http://mywiki.wooledge.org/ProcessManagement?spm=a2c4e.11153959.blogcont68524.19.4dbf3d2foIG0jZ" target="_blank" rel="noopener">ProcessManagement - Gregâ€™s Wiki</a><br><a href="http://mywiki.wooledge.org/BashGuide?spm=a2c4e.11153959.blogcont68524.20.4dbf3d2foIG0jZ" target="_blank" rel="noopener">BashGuide - Gregâ€™s Wiki</a><br><a href="http://mywiki.wooledge.org/BashFAQ?spm=a2c4e.11153959.blogcont68524.21.4dbf3d2foIG0jZ" target="_blank" rel="noopener">BashFAQ - Gregâ€™s Wiki</a></p>
<p><a href="https://yq.aliyun.com/articles/68524?spm=a2c4e.11153959.teamhomeleft.136.7e4c8bc1kg1JeI" target="_blank" rel="noopener">åŸæ–‡å‚è€ƒåœ°å€</a></p>
<p><a href="https://yq.aliyun.com/articles/72012?spm=a2c4e.11153959.teamhomeleft.10.7e4c8bc1kg1JeI" target="_blank" rel="noopener">Sed&amp;awkç¬”è®°ç³»åˆ—-åšå®¢</a></p>
]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>ç®—æ³•å’ŒREST-API</title>
    <url>/2020/04/20/%E7%AE%97%E6%B3%95%E5%92%8CREST-API/</url>
    <content><![CDATA[<h2 id="ç®—æ³•å’ŒREST-API"><a href="#ç®—æ³•å’ŒREST-API" class="headerlink" title="ç®—æ³•å’ŒREST API"></a>ç®—æ³•å’ŒREST API</h2><h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><p>ï¼ˆå†’æ³¡æ’åºï¼Œé€‰æ‹©æ’åºï¼Œæ’å…¥æ’åºï¼‰<br>  å†’æ³¡ï¼šé¦–å…ˆï¼Œåˆ—è¡¨æ¯ä¸¤ä¸ªç›¸é‚»çš„æ•°ï¼Œå¦‚æœå‰é¢çš„æ¯”åè¾¹çš„å¤§ï¼Œ<br>  é‚£ä¹ˆäº¤æ¢è¿™ä¸¤ä¸ªæ•°ï¼Œä»£ç å…³é”®ç‚¹ï¼šè¶Ÿå’Œæ— åºåŒºï¼Œ<br>  æ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n2)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import random</span><br><span class="line">def dublue_sort(li):</span><br><span class="line">	for i in range(len(li)-1):</span><br><span class="line">		exchange&#x3D; False</span><br><span class="line">		for j in range(len(li)-i -1):</span><br><span class="line">			if li[j] &gt; li[j+1]:</span><br><span class="line">				li[j],li[j+1] &#x3D; li[j+1],li[j]</span><br><span class="line">				exchange &#x3D; True</span><br><span class="line">		if not exchange:</span><br><span class="line">			return</span><br><span class="line">	return li</span><br><span class="line">li&#x3D;list(range(100))</span><br><span class="line">random.shuffle(li)</span><br><span class="line">print(li)</span><br><span class="line">print(dublue_sort(li))</span><br></pre></td></tr></table></figure>

<p>é€‰æ‹©ï¼šä¸€è¶Ÿéå†è®°å½•æœ€å°çš„æ•°ï¼Œæ”¾åˆ°ç¬¬ä¸€ä¸ªä½ç½®ï¼Œå†ä¸€è¶Ÿéå†è®°å½•å‰©ä½™åˆ—è¡¨ä¸­æœ€å°çš„æ•°ï¼Œ<br>ç»§ç»­æ”¾ç½®ï¼Œä»£ç å…³é”®ç‚¹ï¼šæ— åºåŒºå’Œæœ€å°æ•°çš„ä½ç½®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n2)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def select_sort(li):</span><br><span class="line">     for i in range(len(li)-1): #iæ˜¯è¶Ÿ</span><br><span class="line">         min_loc&#x3D;i</span><br><span class="line">         #æ‰¾iä½ç½®åˆ°æœ€åä½ç½®èŒƒå›´å†…æœ€å°çš„æ•°</span><br><span class="line">         for j in range(i,len(li)):</span><br><span class="line">             if li[j] &lt; li[min_loc]:</span><br><span class="line">                 min_loc &#x3D; j</span><br><span class="line">         #å’Œæ— åºåŒºç¬¬ä¸€ä¸ªæ•°ä½œäº¤æ¢</span><br><span class="line">                 li[min_loc],li[i] &#x3D; li[i],li[min_loc]</span><br><span class="line">     return li</span><br><span class="line">li&#x3D;list(range(100))</span><br><span class="line">random.shuffle(li)</span><br><span class="line">print(select_sort(li))</span><br></pre></td></tr></table></figure>

<p>æ’å…¥ï¼šåˆ—è¡¨è¢«åˆ†ä¸ºæœ‰åºåŒºå’Œæ— åºåŒºä¸¤ä¸ªéƒ¨åˆ†ã€‚æœ€åˆæœ‰åºåŒºåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œ<br>æ¯æ¬¡ä»æ— åºåŒºé€‰æ‹©ä¸€ä¸ªå…ƒç´ ï¼Œæ’å…¥åˆ°æœ‰åºåŒºçš„ä½ç½®ï¼Œç›´åˆ°æ— åºåŒºå˜ç©ºï¼Œ<br>      ä»£ç å…³é”®ç‚¹ï¼šæ‘¸åˆ°çš„ç‰Œå’Œæ‰‹é‡Œçš„ç‰Œï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºï¼šO(n2)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def insert_sort(li):</span><br><span class="line">	for i in range(1,len(li)):  #i ä»£è¡¨æ¯æ¬¡æ‘¸åˆ°çš„ç‰Œçš„ä¸‹æ ‡</span><br><span class="line">		tmp&#x3D;li[i]</span><br><span class="line">		j &#x3D; i-1  # jä»£è¡¨æ‰‹é‡Œæœ€åä¸€å¼ ç‰Œçš„ä¸‹æ ‡</span><br><span class="line">		while True:</span><br><span class="line">			if j &lt; 0 or tmp &gt;&#x3D; li[j]:</span><br><span class="line">				break</span><br><span class="line">			li[ j + 1] &#x3D; li [j]</span><br><span class="line">			j -&#x3D;1</span><br><span class="line">		li[j+1] &#x3D; tmp</span><br><span class="line">li&#x3D;list(range(100))</span><br><span class="line">print(insert_sort(li))</span><br></pre></td></tr></table></figure>

<p>äºŒåˆ†ï¼šåˆ—è¡¨æŸ¥æ‰¾ï¼šä»åˆ—è¡¨ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ï¼Œè¾“å…¥ï¼šåˆ—è¡¨ã€å¾…æŸ¥æ‰¾å…ƒç´ ï¼Œè¾“å‡ºï¼šå…ƒç´ ä¸‹æ ‡æˆ–æœªæŸ¥æ‰¾åˆ°å…ƒç´ ã€‚<br>äºŒåˆ†æŸ¥æ‰¾ï¼Œä»æœ‰åºåˆ—è¡¨çš„å€™é€‰åŒºdata[0:n]å¼€å§‹ï¼Œé€šè¿‡å¯¹å¾…æŸ¥æ‰¾çš„å€¼ä¸å€™é€‰åŒºä¸­é—´å€¼çš„æ¯”è¾ƒï¼Œ<br>å¯ä»¥ä½¿å€™é€‰åŒºå‡å°‘ä¸€åŠã€‚æ—¶é—´å¤æ‚ä¸ºï¼šO(logn)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def bin_search(data,val):</span><br><span class="line">    low&#x3D;0</span><br><span class="line">    high&#x3D;len(data)-1</span><br><span class="line">    while low &lt;&#x3D; high :</span><br><span class="line">        mid&#x3D; (low+high) &#x2F;&#x2F;2</span><br><span class="line">        if data[mid] &#x3D;&#x3D; val:</span><br><span class="line">            return mid</span><br><span class="line">        elif data[mid] &lt; high :</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid - 1</span><br><span class="line">    return None</span><br><span class="line">print(bin_search([1,2,3,4,5,6,7,8],4))</span><br></pre></td></tr></table></figure>

<h3 id="RESTful-APIè®¾è®¡æŒ‡å—"><a href="#RESTful-APIè®¾è®¡æŒ‡å—" class="headerlink" title="RESTful APIè®¾è®¡æŒ‡å—"></a>RESTful APIè®¾è®¡æŒ‡å—</h3><pre><code>    å‚è€ƒåœ°å€ï¼š
      http://www.ruanyifeng.com/blog/2014/05/restful_api.html

1ã€åè®®       

      APIä¸ç”¨æˆ·çš„é€šä¿¡åè®®ï¼Œæ€»æ˜¯ä½¿ç”¨HTTPsåè®®
2ã€åŸŸå

      åº”è¯¥å°½é‡å°†APIéƒ¨ç½²åœ¨ä¸“ç”¨åŸŸåä¹‹ä¸‹         
 https://api.example.com
      å¦‚æœç¡®å®šAPIå¾ˆç®€å•ï¼Œä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨ä¸»åŸŸåä¸‹                     
 https://example.org/api/
3ã€ç‰ˆæœ¬

      åº”è¯¥å°†APIçš„ç‰ˆæœ¬å·æ”¾å…¥URL        
 https://api.example.com/v1/
        å¦ä¸€ç§åšæ³•æ˜¯ï¼šå°†ç‰ˆæœ¬å·æ”¾åœ¨HTTPå¤´ä¿¡æ¯ä¸­ï¼Œ
4ã€è·¯å¾„      
  https://api.example.com/v1/zoos
  https://api.example.com/v1/animals
  https://api.example.com/v1/employees</code></pre><p>5ã€åŠ¨è¯<br>  å¯¹äºèµ„æºçš„å…·ä½“æ“ä½œç±»å‹ï¼Œç”±HTTPåŠ¨è¯è¡¨ç¤º<br>        GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰ã€‚<br>        POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æºã€‚<br>        PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰ã€‚<br>        PATCHï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰ã€‚<br>        DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æºã€‚<br>è¿˜æœ‰ä¸¤ä¸ªä¸å¸¸ç”¨çš„HTTPåŠ¨è¯<br>       GET /zoosï¼šåˆ—å‡ºæ‰€æœ‰åŠ¨ç‰©å›­<br>       POST /zoosï¼šæ–°å»ºä¸€ä¸ªåŠ¨ç‰©å›­<br>       GET /zoos/IDï¼šè·å–æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯<br>       PUT /zoos/IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„å…¨éƒ¨ä¿¡æ¯ï¼‰<br>       PATCH /zoos/IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰<br>       DELETE /zoos/IDï¼šåˆ é™¤æŸä¸ªåŠ¨ç‰©å›­<br>       GET /zoos/ID/animalsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æ‰€æœ‰åŠ¨ç‰©<br>       DELETE /zoos/ID/animals/IDï¼šåˆ é™¤æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æŒ‡å®šåŠ¨ç‰©</p>
<p>6ã€è¿‡æ»¤ä¿¡æ¯ï¼ˆFilteringï¼‰<br>    å¦‚æœè®°å½•æ•°é‡å¾ˆå¤šï¼ŒæœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·ï¼ŒAPIåº”è¯¥æä¾›å‚æ•°ï¼Œè¿‡æ»¤è¿”å›ç»“æœ<br>        ?limit=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡<br>        ?offset=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®ã€‚<br>        ?page=2&amp;per_page=100ï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°ã€‚<br>        ?sortby=name&amp;order=ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåºã€‚<br>        ?animal_type_id=1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶    </p>
<p>7ã€çŠ¶æ€ç ï¼ˆStatus Codeï¼‰<br>      200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ˆIdempotentï¼‰ã€‚<br>      201 CREATED - [POST/PUT/PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚<br>      202 Accepted - [<em>]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰<br>      204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚<br>      400 INVALID REQUEST - [POST/PUT/PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚<br>      401 Unauthorized - [</em>]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚<br>      403 Forbidden - [<em>] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚<br>      404 NOT FOUND - [</em>]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚<br>      406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚<br>      410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚<br>      422 Unprocesable entity - [POST/PUT/PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚<br>      500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚        </p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>è·å–æ‰€æœ‰çš„AWS EC2ä¸»æœºä¿¡æ¯</title>
    <url>/2020/04/20/%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E7%9A%84AWS-EC2%E4%B8%BB%E6%9C%BA%E4%BF%A1%E6%81%AF/</url>
    <content><![CDATA[<h2 id="è·å–æ‰€æœ‰çš„AWS-EC2ä¸»æœºä¿¡æ¯"><a href="#è·å–æ‰€æœ‰çš„AWS-EC2ä¸»æœºä¿¡æ¯" class="headerlink" title="è·å–æ‰€æœ‰çš„AWS EC2ä¸»æœºä¿¡æ¯"></a>è·å–æ‰€æœ‰çš„AWS EC2ä¸»æœºä¿¡æ¯</h2><h3 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h3><ol>
<li>æœ¬åœ°éœ€è¦å®‰è£…aws cliå·¥å…·,ä»¥åŠé…ç½®å¥½ç›¸å…³çš„key;</li>
<li>EC2 ä¸»æœºéœ€è¦æ·»åŠ Tag(ç¯å¢ƒ/éƒ¨é—¨/ä¸šåŠ¡);</li>
</ol>
<h3 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h3><ol>
<li>éœ€è¦å®‰è£…PrettyTableæ¨¡å—<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pip install PrettyTable</span><br></pre></td></tr></table></figure></li>
<li>è„šæœ¬å†…å®¹<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;2&#x2F;7</span><br><span class="line"></span><br><span class="line">from prettytable import PrettyTable</span><br><span class="line">import subprocess</span><br><span class="line">import datetime</span><br><span class="line">import xlwt</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">import getopt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_all_aws_ec2():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æ‰€æœ‰çš„EC2å®ä¾‹ID</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        command &#x3D; &quot;aws ec2 describe-instances --query &#39;Reservations[*].Instances[*].[InstanceId]&#39;&quot;</span><br><span class="line">        ret &#x3D; subprocess.getoutput(command)</span><br><span class="line">        ret &#x3D; json.loads(ret)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;ERROR: &quot;, e)</span><br><span class="line">        sys.exit(&quot;Bey Bey!&quot;)</span><br><span class="line"></span><br><span class="line">    all_aws_ec2_list &#x3D; []</span><br><span class="line">    for ec2 in ret:</span><br><span class="line">        if len(ec2) &gt; 1:</span><br><span class="line">            for item in ec2:</span><br><span class="line">                all_aws_ec2_list.append(item[0])</span><br><span class="line">        else:</span><br><span class="line">            all_aws_ec2_list.append(ec2[0][0])</span><br><span class="line">    return all_aws_ec2_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_ec2_info():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è·å–æ‰€æœ‰çš„ EC2 å±æ€§ä¿¡æ¯</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        command &#x3D; &quot;aws ec2 describe-instances --query &#39;Reservations[*].Instances[*].[InstanceId,Placement.AvailabilityZone,State.Name,Tags[?Key&#x3D;&#x3D;&#96;Name&#96;].Value,PrivateIpAddress,NetworkInterfaces[0].PrivateIpAddresses[0].Association.PublicIp,SecurityGroups[0].GroupName,SecurityGroups[1].GroupName,Tags[?Key&#x3D;&#x3D;&#96;ç¯å¢ƒ&#96;].Value,Tags[?Key&#x3D;&#x3D;&#96;éƒ¨é—¨&#96;].Value,Tags[?Key&#x3D;&#x3D;&#96;ä¸šåŠ¡&#96;].Value,Tags[?Key&#x3D;&#x3D;&#96;å¤‡æ³¨&#96;].Value]&#39;&quot;</span><br><span class="line">        ret &#x3D; subprocess.getoutput(command)</span><br><span class="line">        all_aws_ec2_list &#x3D; json.loads(ret)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;ERROR: &quot;, e)</span><br><span class="line">        sys.exit(&quot;Bey Bey!&quot;)</span><br><span class="line">    host_info_list &#x3D; []</span><br><span class="line">    for item in all_aws_ec2_list:</span><br><span class="line">        if len(item) &gt; 1:</span><br><span class="line">            for ec2 in item:</span><br><span class="line">                host_info_list.append([ec2])</span><br><span class="line">        else:</span><br><span class="line">            host_info_list.append(item)</span><br><span class="line"></span><br><span class="line">    return host_info_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def set_style(name, height, bold&#x3D;False):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è¡¨æ ¼æ ·å¼</span><br><span class="line">    :param name:</span><br><span class="line">    :param height:</span><br><span class="line">    :param bold:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    style &#x3D; xlwt.XFStyle()  # åˆå§‹åŒ–æ ·å¼</span><br><span class="line"></span><br><span class="line">    font &#x3D; xlwt.Font()  # ä¸ºæ ·å¼åˆ›å»ºå­—ä½“</span><br><span class="line">    font.name &#x3D; name  # &#39;Times New Roman&#39;</span><br><span class="line">    font.bold &#x3D; bold</span><br><span class="line">    font.color_index &#x3D; 3</span><br><span class="line">    font.height &#x3D; height</span><br><span class="line">    style.font &#x3D; font</span><br><span class="line"></span><br><span class="line">    return style</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write_execl(filename):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è¾“å‡ºåˆ°excelæ–‡ä»¶ä¸­</span><br><span class="line">    :param filename:</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    f &#x3D; xlwt.Workbook()  # åˆ›å»ºå·¥ä½œç°¿</span><br><span class="line">    sheet1 &#x3D; f.add_sheet(&#39;AWSä¸»æœºä¿¡æ¯è¡¨&#39;, cell_overwrite_ok&#x3D;True)</span><br><span class="line">    title &#x3D; [&#39;å®ä¾‹ID&#39;, &#39;region&#39;, &#39;çŠ¶æ€&#39;, &#39;Name&#39;, &#39;å†…ç½‘IP&#39;, &#39;å…¬ç½‘IP&#39;, &#39;å®‰å…¨ç»„-1&#39;, &#39;å®‰å…¨ç»„-2&#39;, &#39;ç¯å¢ƒ&#39;, &#39;éƒ¨é—¨&#39;, &#39;ä¸šåŠ¡&#39;, &#39;å¤‡æ³¨&#39;]</span><br><span class="line">    # ç”Ÿæˆç¬¬ä¸€è¡Œ</span><br><span class="line">    for i in range(0, len(title)):</span><br><span class="line">        sheet1.write(0, i, title[i], set_style(&#39;ç®€ä½“ä¸­æ–‡&#39;, 350, True))</span><br><span class="line"></span><br><span class="line">    host_info_list &#x3D; get_ec2_info()</span><br><span class="line">    i &#x3D; 1</span><br><span class="line">    while i &lt; int(len(host_info_list) + 1):</span><br><span class="line">        for j in range(0, len(title)):</span><br><span class="line">            if isinstance(host_info_list[i - 1][0][j], list):</span><br><span class="line">                cell &#x3D; host_info_list[i - 1][0][j] if host_info_list[i - 1][0][j] else None</span><br><span class="line">            else:</span><br><span class="line">                cell &#x3D; host_info_list[i - 1][0][j]</span><br><span class="line">            sheet1.write(i, j, cell)</span><br><span class="line">        i +&#x3D; 1</span><br><span class="line"></span><br><span class="line">    f.save(filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def table_stdout():</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è¾“å‡ºä¸ºè¡¨æ ¼å½¢å¼</span><br><span class="line">    :return:</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    table &#x3D; PrettyTable(</span><br><span class="line">        [&quot;ç¼–å·&quot;, &quot;å®ä¾‹ID&quot;, &quot;region&quot;, &quot;çŠ¶æ€&quot;, &quot;Name&quot;, &quot;å†…ç½‘IP&quot;, &quot;å…¬ç½‘IP&quot;, &quot;å®‰å…¨ç»„-1&quot;, &quot;å®‰å…¨ç»„-2&quot;, &quot;ç¯å¢ƒ&quot;, &quot;éƒ¨é—¨&quot;, &quot;ä¸šåŠ¡&quot;, &quot;å¤‡æ³¨&quot;])</span><br><span class="line"></span><br><span class="line">    all_ec2_instance_id_list &#x3D; get_all_aws_ec2()</span><br><span class="line">    host_info_list &#x3D; get_ec2_info()</span><br><span class="line">    if len(all_ec2_instance_id_list) !&#x3D; len(host_info_list):</span><br><span class="line">        sys.exit(&quot;ERROR: ä¸»æœºæ•°é‡ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥!&quot;)</span><br><span class="line">    count &#x3D; 0</span><br><span class="line">    for ec2_info in host_info_list:</span><br><span class="line">        temp &#x3D; []</span><br><span class="line">        count +&#x3D; 1</span><br><span class="line">        ec2_info[0].insert(0, count)</span><br><span class="line">        for item in ec2_info[0]:</span><br><span class="line">            if isinstance(item, list):</span><br><span class="line">                temp.append(item[0] if item else None)</span><br><span class="line">            else:</span><br><span class="line">                temp.append(item)</span><br><span class="line">        table.add_row(temp)</span><br><span class="line">    table.reversesort &#x3D; True</span><br><span class="line">    print(table)</span><br><span class="line">    print(&quot;\033[0;32m%s:, AWS EC2 Total: %d\033[0m&quot; % (datetime.datetime.now(), len(all_ec2_instance_id_list)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main(argv, excel_path):</span><br><span class="line">    usage &#x3D; &quot;&quot;&quot;usage:</span><br><span class="line">        test.py -t&#x2F;--table</span><br><span class="line">        test.py -f&#x2F;--outfile</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        opts, args &#x3D; getopt.getopt(argv, &quot;htf&quot;, [&quot;help&quot;, &quot;table&quot;, &quot;outfile&quot;])</span><br><span class="line">    except getopt.GetoptError:</span><br><span class="line">        print(usage)</span><br><span class="line">        sys.exit(2)</span><br><span class="line">    for opt, arg in opts:</span><br><span class="line">        if opt in (&quot;-h&quot;, &quot;--help&quot;):</span><br><span class="line">            print(usage)</span><br><span class="line">            sys.exit(2)</span><br><span class="line">        elif opt in (&quot;-t&quot;, &quot;--table&quot;):</span><br><span class="line">            table_stdout()</span><br><span class="line">        elif opt in (&quot;-f&quot;, &quot;--outfile&quot;):</span><br><span class="line">            write_execl(excel_path)</span><br><span class="line">        else:</span><br><span class="line">            print(usage)</span><br><span class="line">            sys.exit(2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    excel_path &#x3D; &quot;&#x2F;tmp&#x2F;AWSä¸»æœºä¿¡æ¯è¡¨-&#123;date&#125;.xlsx&quot;.format(date&#x3D;datetime.date.today())</span><br><span class="line">    main(sys.argv[1:], excel_path</span><br></pre></td></tr></table></figure>
</li>
</ol>
]]></content>
      <categories>
        <category>aws</category>
      </categories>
      <tags>
        <tag>aws</tag>
      </tags>
  </entry>
  <entry>
    <title>è“é²¸è¿›ç¨‹ç®¡ç†è„šæœ¬å‚è€ƒ</title>
    <url>/2020/04/20/%E8%93%9D%E9%B2%B8%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E8%84%9A%E6%9C%AC%E5%8F%82%E8%80%83/</url>
    <content><![CDATA[<p>è“é²¸è¿›ç¨‹ç®¡ç†è„šæœ¬å‚è€ƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line"># use bash to execute this script</span><br><span class="line">echo $BASH |grep -q &#39;bash&#39; || &#123; exec bash &quot;$0&quot; &quot;$@&quot; || exit 1; &#125;</span><br><span class="line"></span><br><span class="line"># enable extended pattern matching operators</span><br><span class="line">shopt -s extglob</span><br><span class="line"></span><br><span class="line">VERSION_BK&#x3D;&quot;1.1.1&quot;</span><br><span class="line"></span><br><span class="line">DIR_HOME&#x3D;&quot;$(readlink -f $(dirname $0))&quot;</span><br><span class="line"></span><br><span class="line">DIR_CMDB&#x3D;&quot;$DIR_HOME&#x2F;cmdb&quot;</span><br><span class="line">DIR_JOB&#x3D;&quot;$DIR_HOME&#x2F;job&quot;</span><br><span class="line">DIR_GSE&#x3D;&quot;$DIR_HOME&#x2F;gse&quot;</span><br><span class="line">DIR_ZK&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;zookeeper&#x2F;zookeeper-3.4.6&quot;</span><br><span class="line">DIR_DOWN&#x3D;&quot;$DIR_HOME&#x2F;index&#x2F;download&quot;</span><br><span class="line">DIR_SESSION&#x3D;&quot;$DIR_HOME&#x2F;.session&quot;</span><br><span class="line"></span><br><span class="line">FILE_CONF&#x3D;&quot;$DIR_HOME&#x2F;bk.conf&quot;</span><br><span class="line">FILE_LOG&#x3D;&quot;$DIR_HOME&#x2F;bk.log&quot;</span><br><span class="line"></span><br><span class="line">FILE_TPL&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;function.tpl&quot;</span><br><span class="line">FILE_FUNC&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;function&quot;</span><br><span class="line"></span><br><span class="line">FILE_SETUP&#x3D;&quot;$DIR_HOME&#x2F;init_data&#x2F;setup.sh&quot;</span><br><span class="line">FILE_INITDB&#x3D;&quot;$DIR_HOME&#x2F;init_data&#x2F;init_db.sh&quot;</span><br><span class="line"></span><br><span class="line">FILE_CRT&#x3D;&quot;$DIR_HOME&#x2F;ssl_certificates.tar.gz&quot;</span><br><span class="line">FILE_INIT&#x3D;&quot;$DIR_HOME&#x2F;.bkallowinit&quot;</span><br><span class="line">SO_libaio&#x3D;&quot;&#x2F;lib64&#x2F;libaio.so.1&quot;</span><br><span class="line"></span><br><span class="line">NGINX_LOGS&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;nginx&#x2F;logs&quot;</span><br><span class="line"></span><br><span class="line">PHP_EXE&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;php&#x2F;bin&#x2F;php&quot;</span><br><span class="line"></span><br><span class="line">MYSQL_HOME&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;mysql&quot;</span><br><span class="line">MYSQL_DATA&#x3D;&quot;$MYSQL_HOME&#x2F;data&#x2F;&quot;</span><br><span class="line">MYSQL_BIN&#x3D;&quot;$MYSQL_HOME&#x2F;bin&#x2F;mysql&quot;</span><br><span class="line">MYSOCK&#x3D;&quot;$MYSQL_HOME&#x2F;data&#x2F;mysql.sock&quot;</span><br><span class="line"></span><br><span class="line">TOMCAT_DIR&#x3D;&quot;$DIR_JOB&#x2F;apache-tomcat-7.0.19&quot;</span><br><span class="line">TOMCAT_LOGS&#x3D;&quot;$TOMCAT_DIR&#x2F;logs&quot;</span><br><span class="line">TOMCAT_BIN&#x3D;&quot;$TOMCAT_DIR&#x2F;bin&#x2F;catalina.sh&quot;</span><br><span class="line"></span><br><span class="line">JAVA_HOME&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;java&quot;</span><br><span class="line">JAVA_BIN&#x3D;&quot;$JAVA_HOME&#x2F;bin&quot;</span><br><span class="line">PATH&#x3D;$JAVA_BIN:$PATH</span><br><span class="line">CLASSPATH&#x3D;.:$JAVA_HOME&#x2F;lib&#x2F;dt.jar:$JAVA_HOME&#x2F;lib&#x2F;tools.jar</span><br><span class="line"></span><br><span class="line">LC_ALL&#x3D;C</span><br><span class="line">LANG&#x3D;C</span><br><span class="line"></span><br><span class="line">ACTION&#x3D;&#39;@(start|stop|restart|status|summary|reload|report|init)&#39;</span><br><span class="line">MODULE&#x3D;&#39;@(all|redis-server|nginx|mysqld|zk1|zk2|zk3|gsedba|gsetask|gsebtfilesserver|yydba|gsedata|gsecacheapiserver|gseagent|cmdb|job|-*||)&#39;</span><br><span class="line">GROUP&#x3D;&#39;@(gse|zk)&#39;</span><br><span class="line"></span><br><span class="line">monit() &#123; </span><br><span class="line">    local MONIT_DIR&#x3D;&quot;$DIR_HOME&#x2F;common&#x2F;monit&quot;</span><br><span class="line">    local MONIT_BIN&#x3D;&quot;$MONIT_DIR&#x2F;bin&#x2F;monit&quot;</span><br><span class="line">    local MONIT_RC&#x3D;&quot;$MONIT_DIR&#x2F;conf&#x2F;monitrc&quot;</span><br><span class="line">    local MONIT_EXE&#x3D;&quot;$MONIT_BIN -c $MONIT_RC&quot;</span><br><span class="line">    </span><br><span class="line">    chmod 700 $MONIT_RC</span><br><span class="line">    </span><br><span class="line">    case &quot;$1&quot; in</span><br><span class="line">        self_start)</span><br><span class="line">            log &quot;Info: monit self_start...&quot;</span><br><span class="line">            $MONIT_EXE &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">            wait_check &quot;$MONIT_EXE summary&quot;</span><br><span class="line">            log &quot;Info: monit self_start, ok&quot;</span><br><span class="line">            ;;</span><br><span class="line">        self_stop)</span><br><span class="line">            $MONIT_EXE quit</span><br><span class="line">            ;;</span><br><span class="line">        self_reload) </span><br><span class="line">            $MONIT_EXE reload</span><br><span class="line">            ;;</span><br><span class="line">        self_restart)</span><br><span class="line">            monit self_stop</span><br><span class="line">            monit self_start</span><br><span class="line">            ;;</span><br><span class="line">        wait_stop)</span><br><span class="line">            wait_check &quot;$MONIT_EXE summary |grep -c monitored |grep -q 16&quot;</span><br><span class="line">            ;;  </span><br><span class="line">        *)</span><br><span class="line">            [[ $1 &#x3D;&#x3D; &quot;start&quot; ]] &amp;&amp; [[ $2 &#x3D;&#x3D; &quot;all&quot; ]] &amp;&amp; monit self_start</span><br><span class="line">            $MONIT_EXE &quot;$@&quot;</span><br><span class="line">            [[ $1 &#x3D;&#x3D; &quot;start&quot; ]] &amp;&amp; [[ $2 &#x3D;&#x3D; &quot;all&quot; ]] &amp;&amp; writed_ip</span><br><span class="line">            echo $1 |grep -Eq &#39;start|stop|restart&#39; &amp;&amp; &#123; sleep 3;monit summary; &#125;</span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">usage() &#123;</span><br><span class="line">    cat &lt;&lt;EOF</span><br><span class="line">Usage: $0 : &lt;action&gt; &lt;module&gt;</span><br><span class="line">actionçš„å–å€¼ä¸ºï¼š(start|stop|restart|status|summary|reload|report|init)æ—¶ï¼Œéœ€è¦ç¬¬äºŒä¸ªå‚æ•°module</span><br><span class="line">moduleçš„å–å€¼ä¸ºï¼š(all|redis-server|nginx|mysqld|zk1|zk2|zk3|gsedba|gsetask|gsebtfilesserver|yydba|gsedata|gsecacheapiserver|gseagent|cmdb|job)</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ‰€æœ‰çš„è¿›ç¨‹çŠ¶æ€ï¼š$0 summary </span><br><span class="line">EOF</span><br><span class="line">    exit 1 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">echo -en &quot;Current Version: $VERSION_BK \n&quot;</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    init) </span><br><span class="line">        source $FILE_SETUP || &#123; echo -en &quot;Error: source $FILE_SETUP, failed\n&quot;;exit 1; &#125;</span><br><span class="line">        monit self_start &amp;&amp; monit unmonitor all</span><br><span class="line">        monit stop all &amp;&amp; monit wait_stop</span><br><span class="line">        monit start mysqld</span><br><span class="line">        monit -g zk start </span><br><span class="line">        init_db</span><br><span class="line">        exit $?</span><br><span class="line">        ;;</span><br><span class="line">    $ACTION)</span><br><span class="line">        : ;;</span><br><span class="line">    *)</span><br><span class="line">        usage</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">source $FILE_FUNC || log_exit &quot;Error: source $FILE_FUNC, failed&quot;</span><br><span class="line"></span><br><span class="line">case &quot;$2&quot; in </span><br><span class="line">    $MODULE)</span><br><span class="line">        monit &quot;$@&quot;</span><br><span class="line">        ;;</span><br><span class="line">    $GROUP)</span><br><span class="line">        monit -g $2 $1</span><br><span class="line">        ;;</span><br><span class="line">    monit)</span><br><span class="line">        monit self_$1</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        usage</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Linux</category>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>ç»´æŠ¤JAVAæœåŠ¡è„šæœ¬ç¤ºä¾‹</title>
    <url>/2020/04/20/%E7%BB%B4%E6%8A%A4JAVA%E6%9C%8D%E5%8A%A1%E8%84%9A%E6%9C%AC%E7%A4%BA%E4%BE%8B/</url>
    <content><![CDATA[<h3 id="ç»´æŠ¤JAVAæœåŠ¡è„šæœ¬ç¤ºä¾‹"><a href="#ç»´æŠ¤JAVAæœåŠ¡è„šæœ¬ç¤ºä¾‹" class="headerlink" title="ç»´æŠ¤JAVAæœåŠ¡è„šæœ¬ç¤ºä¾‹"></a>ç»´æŠ¤JAVAæœåŠ¡è„šæœ¬ç¤ºä¾‹</h3><p>start_env.sh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">CURRENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; pwd)</span><br><span class="line">PARENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; cd ..; pwd)</span><br><span class="line">CURRENT_SERVICE_NAME&#x3D;$(echo $&#123;CURRENT_PATH&#125; | awk -F &#39;&#x2F;&#39; &#39;&#123;print $(NF)&#125;&#39;)</span><br><span class="line"></span><br><span class="line"># USE THOSE VARIABLE</span><br><span class="line">GC_LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs&#x2F;$&#123;CURRENT_SERVICE_NAME&#125;-gcdetail.log</span><br><span class="line">COMMON_CONFIG_PATH&#x3D;$&#123;PARENT_PATH&#125;</span><br><span class="line">CONFIG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;config</span><br><span class="line">JAR_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;jar</span><br><span class="line">LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs</span><br><span class="line"></span><br><span class="line">## MODIFY FOLLOWING LINES</span><br><span class="line">EXECUT_JAR&#x3D;&quot;america-business-auth-impl-1.0-SNAPSHOT-all.jar&quot;</span><br><span class="line">DUBBO_PARAMETER&#x3D;&quot;</span><br><span class="line">-Dapp.id&#x3D;america-business-auth</span><br><span class="line">-Xdebug</span><br><span class="line">-server</span><br><span class="line">-Xmx512m</span><br><span class="line">-Xms512m</span><br><span class="line">-Xnoagent</span><br><span class="line">-XX:+PrintGCDateStamps</span><br><span class="line">-XX:+PrintGCDetails</span><br><span class="line">-XX:NewRatio&#x3D;2</span><br><span class="line">-XX:SurvivorRatio&#x3D;8</span><br><span class="line">-XX:MetaspaceSize&#x3D;128m</span><br><span class="line">-XX:MaxMetaspaceSize&#x3D;128m</span><br><span class="line">-Xloggc:$&#123;GC_LOG_PATH&#125;</span><br><span class="line">-Ddubbo.registry.file&#x3D;$&#123;JAR_PATH&#125;&#x2F;dubbo.cache</span><br><span class="line">-Dconfig.path&#x3D;file:$&#123;COMMON_CONFIG_PATH&#125;&#x2F;common.properties;file:$&#123;CONFIG_PATH&#125;&#x2F;config.properties</span><br><span class="line">$&#123;JAR_PATH&#125;&#x2F;$&#123;EXECUT_JAR&#125;</span><br><span class="line">&quot;</span><br><span class="line">## STOP MODIFY</span><br><span class="line"></span><br><span class="line">java -jar $&#123;DUBBO_PARAMETER&#125; | &#x2F;usr&#x2F;bin&#x2F;cronolog $LOG_PATH&#x2F;out.%Y%m%d.nohup &gt;&gt; &#x2F;dev&#x2F;null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>
<p>service_control.sh</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">#set -x</span><br><span class="line"></span><br><span class="line">source &#x2F;etc&#x2F;profile</span><br><span class="line"></span><br><span class="line"># USE THOSE VARIABLE</span><br><span class="line">CURRENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; pwd)</span><br><span class="line">PARENT_PATH&#x3D;$(cd &#96;dirname $0&#96;; cd ..; pwd)</span><br><span class="line">CURRENT_SERVICE_NAME&#x3D;$(echo $&#123;CURRENT_PATH&#125; | awk -F &#39;&#x2F;&#39; &#39;&#123;print $(NF)&#125;&#39;)</span><br><span class="line">STOP_WAIT_TIME&#x3D;10</span><br><span class="line">CURRENT_TIME&#x3D;&#96;date +%Y%m%d-%H%M%S&#96;</span><br><span class="line"></span><br><span class="line">DUMP_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;dump</span><br><span class="line">LOG_PATH&#x3D;$&#123;CURRENT_PATH&#125;&#x2F;logs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">log() &#123;</span><br><span class="line">    echo &quot;$(date +&quot;%Y-%m-%d %H:%M:%S&quot;): $1&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exit_status() &#123;</span><br><span class="line">    if [ $? &#x3D;&#x3D; 0 ]</span><br><span class="line">    then</span><br><span class="line">        echo -e &quot;\\033[1;32m[OK]\\033[0;39m&quot;</span><br><span class="line">    else</span><br><span class="line">        echo -e &quot;\\033[1;31m[Failed]\\033[0;39m&quot;</span><br><span class="line">        log &quot;Error&quot;</span><br><span class="line">        exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_user() &#123;</span><br><span class="line">    if [ &#96;whoami&#96; !&#x3D; &quot;app&quot; || &#96;whoami&#96; !&#x3D; &quot;root&quot; ]; then</span><br><span class="line">        log &quot;Please use app user to run this command.&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop_service() &#123;</span><br><span class="line"></span><br><span class="line">    log &quot;Stop Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 1 ]</span><br><span class="line">    then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; run more than one process&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">    if [ x$Service_PID &#x3D;&#x3D; x ];then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; process is NOT exist&quot;</span><br><span class="line">        exit_status</span><br><span class="line">    else</span><br><span class="line">        log &quot;KILL Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">        kill  $Service_PID</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    echo &quot;&quot;</span><br><span class="line">    log &quot;Search Service Process ...&quot;</span><br><span class="line">    Check&#x3D;N</span><br><span class="line">    N&#x3D;0</span><br><span class="line">    while [ $Check &#x3D;&#x3D; &quot;N&quot; ]</span><br><span class="line">    do</span><br><span class="line">        N&#x3D;$(($N+1))</span><br><span class="line">        Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line"></span><br><span class="line">        if [ &quot;$Service_PID&quot; &#x3D; &quot;&quot; ]</span><br><span class="line">        then</span><br><span class="line">            log &quot;Not found Service PID alive&quot;</span><br><span class="line">            break</span><br><span class="line">        else</span><br><span class="line">            log &quot;$N: Check Service PID:$Service_PID, Sleep 1 Sec Wait Service Exit ...&quot;</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        if [ $((N)) -gt $STOP_WAIT_TIME ]</span><br><span class="line">        then</span><br><span class="line">            log &quot;Force KILL Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">            #jstack $Service_PID &gt;&gt; &#x2F;var&#x2F;log&#x2F;jstack.log</span><br><span class="line">            #skill -9 $Service_PID</span><br><span class="line">            kill -9 $Service_PID</span><br><span class="line">            exit_status</span><br><span class="line">            break</span><br><span class="line">        fi</span><br><span class="line">        sleep 1</span><br><span class="line">    done</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start_service() &#123;</span><br><span class="line"></span><br><span class="line">    log &quot;Start Service Service: $&#123;CURRENT_SERVICE_NAME&#125;&quot;</span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F; | grep -v grep |grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 0 ]</span><br><span class="line">    then</span><br><span class="line">        log &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; already running&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    if [ ! -d $LOG_PATH ]; then</span><br><span class="line">        mkdir -p $LOG_PATH</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    nohup &#x2F;bin&#x2F;bash $CURRENT_PATH&#x2F;start_env.sh &amp;&gt;&gt; &#x2F;dev&#x2F;null &amp;</span><br><span class="line"></span><br><span class="line">    #exit_status</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">status() &#123;</span><br><span class="line"></span><br><span class="line">    Service_NUM&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;|wc -l&#96;</span><br><span class="line">    if [ $((Service_NUM)) -gt 1 ]</span><br><span class="line">    then</span><br><span class="line">        echo &quot;Service run more than one process,please check&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    fi</span><br><span class="line">    Service_PID&#x3D;&#96;ps -ef|grep $&#123;CURRENT_SERVICE_NAME&#125;&#x2F;jar&#x2F;|grep -v grep|grep -v cronolog|grep -v $0|awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">    if [ x$Service_PID &#x3D;&#x3D; x ];then</span><br><span class="line">        echo &quot;Service: $&#123;CURRENT_SERVICE_NAME&#125; process is NOT exist&quot;</span><br><span class="line">        false</span><br><span class="line">        exit_status</span><br><span class="line">    else</span><br><span class="line">        Service_startTime&#x3D;&#96;ps -p $&#123;Service_PID&#125; -o lstart|grep -v &quot;START&quot;&#96;</span><br><span class="line">        echo -e &quot;service: $&#123;CURRENT_SERVICE_NAME&#125; started,\npid: $&#123;Service_PID&#125;,\nstartTime: $&#123;Service_startTime&#125;,\nlogPath: $&#123;LOG_PATH&#125;&#x2F;out.&#96;date +%Y%m%d&#96;.nohup&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dump() &#123;</span><br><span class="line">    if [ ! -d $DUMP_PATH ]; then</span><br><span class="line">        mkdir -p $DUMP_PATH</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo -e &quot;Dumping the $&#123;CURRENT_SERVICE_NAME&#125; ...\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstack $Service_PID &gt; $DUMP_PATH&#x2F;jstack-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jinfo $Service_PID &gt; $DUMP_PATH&#x2F;jinfo-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstat -gcutil $Service_PID &gt; $DUMP_PATH&#x2F;jstat-gcutil-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jstat -gccapacity $Service_PID &gt; $DUMP_PATH&#x2F;jstat-gccapacity-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap $Service_PID &gt; $DUMP_PATH&#x2F;jmap-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap -heap $Service_PID &gt; $DUMP_PATH&#x2F;jmap-heap-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    sudo &#x2F;usr&#x2F;local&#x2F;jdk&#x2F;bin&#x2F;jmap -histo $Service_PID &gt; $DUMP_PATH&#x2F;jmap-histo-$Service_PID.$&#123;CURRENT_TIME&#125;.dump 2&gt;&amp;1</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    if [ -r &#x2F;usr&#x2F;sbin&#x2F;lsof ]; then</span><br><span class="line">    &#x2F;usr&#x2F;sbin&#x2F;lsof -p $Service_PID &gt; $DUMP_PATH&#x2F;lsof-$Service_PID.$&#123;CURRENT_TIME&#125;.dump</span><br><span class="line">    echo -e &quot;.\c&quot;</span><br><span class="line">    fi</span><br><span class="line">    echo -e &quot;\nDump Complete, files in $&#123;DUMP_PATH&#125;\n&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tail_log() &#123;</span><br><span class="line">    if [ ! -n &quot;$1&quot; ] ; then</span><br><span class="line">        tail_num&#x3D;10</span><br><span class="line">    else</span><br><span class="line">        tail_num&#x3D;$1</span><br><span class="line">    fi</span><br><span class="line">    tail -$&#123;tail_num&#125;f $&#123;LOG_PATH&#125;&#x2F;out.&#96;date +%Y%m%d&#96;.nohup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">help() &#123;</span><br><span class="line">    echo &quot;USAGE: $0 &#123;stop|start|restart|status|dump|log [tail line of numbers:200]|help&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ $# -gt 0 ] ; then</span><br><span class="line"></span><br><span class="line">    case $1 in</span><br><span class="line">    start)</span><br><span class="line">        log &quot;Will Start Service ...&quot;</span><br><span class="line">        start_service</span><br><span class="line">        log &quot;Sleep 3 Sec for Status ...&quot;</span><br><span class="line">        sleep 3</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        log &quot;Will Stop Service ...&quot;</span><br><span class="line">        stop_service</span><br><span class="line">        ;;</span><br><span class="line">    restart)</span><br><span class="line">        log &quot;Will Restart Service ...&quot;</span><br><span class="line"></span><br><span class="line">        stop_service</span><br><span class="line">        log &quot;Sleep 3 Sec&quot;</span><br><span class="line">        sleep 3</span><br><span class="line"></span><br><span class="line">        start_service</span><br><span class="line">        log &quot;Sleep 3 Sec for Status ...&quot;</span><br><span class="line">        sleep 3</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    status)</span><br><span class="line">        status</span><br><span class="line">        ;;</span><br><span class="line">    dump)</span><br><span class="line">        check_user</span><br><span class="line">        status</span><br><span class="line">        if [ $? &#x3D;&#x3D; 0 ]</span><br><span class="line">        then</span><br><span class="line">            dump</span><br><span class="line">        else</span><br><span class="line">            exit 1</span><br><span class="line">        fi</span><br><span class="line"></span><br><span class="line">        ;;</span><br><span class="line">    log)</span><br><span class="line">        tail_log $2</span><br><span class="line">        ;;</span><br><span class="line">    help)</span><br><span class="line">        help</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Bad Parameter: $1&quot;</span><br><span class="line">        help</span><br><span class="line">        exit 1</span><br><span class="line">        ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">else</span><br><span class="line">    help</span><br><span class="line">    exit 1;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿›ç¨‹å¯åœè‡ªå®šä¹‰è„šæœ¬</title>
    <url>/2020/04/20/%E8%BF%9B%E7%A8%8B%E5%90%AF%E5%81%9C%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<p>è¿›ç¨‹å¯åœè‡ªå®šä¹‰è„šæœ¬</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash </span><br><span class="line"></span><br><span class="line">usage()</span><br><span class="line">&#123; </span><br><span class="line">  echo &quot;Usage: $0 &#123;start|stop|restart|status&#125; [lineid]&quot; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">suffix&#x3D;_stable</span><br><span class="line">LINELIST&#x3D;&quot;1 2 3 4 5 6&quot;</span><br><span class="line">LINK_NUM&#x3D;3</span><br><span class="line">UNAMED_ACTIVE&#x3D;0</span><br><span class="line">PROGRAME_ACTIVE&#x3D;0</span><br><span class="line"></span><br><span class="line">start_line()</span><br><span class="line">&#123;</span><br><span class="line">	IDLIST&#x3D;$LINELIST</span><br><span class="line">	if [ ! -z $1 ]; then</span><br><span class="line">		IDLIST&#x3D;$1</span><br><span class="line">	fi</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	cd gamed</span><br><span class="line">	for LN in $IDLIST</span><br><span class="line">	do</span><br><span class="line">		PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;gs$suffix gs.conf gmserver.conf config&#x2F;gsalias$LN.conf&quot;&#96;</span><br><span class="line">		if [ -z &quot;$PIDS&quot; ]; then</span><br><span class="line">			echo start line $LN</span><br><span class="line">			nohup setsid .&#x2F;gs$suffix gs.conf gmserver.conf config&#x2F;gsalias$LN.conf &amp;&gt;..&#x2F;logs&#x2F;game$LN.log &amp;</span><br><span class="line">			#nohup setsid .&#x2F;gs_asan$suffix gs.conf gmserver.conf config&#x2F;gsalias$LN.conf  &amp;&gt;..&#x2F;logs&#x2F;game$LN.log &amp;</span><br><span class="line">		else</span><br><span class="line">			echo line $LN is already running</span><br><span class="line">		fi</span><br><span class="line">		sleep 1</span><br><span class="line">	done</span><br><span class="line">	cd ..</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">status() </span><br><span class="line">&#123;</span><br><span class="line">	PROGRAME_ACTIVE&#x3D;0;</span><br><span class="line">	for LN in $LINELIST</span><br><span class="line">	do</span><br><span class="line">		check_line $LN</span><br><span class="line">		PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	done</span><br><span class="line">	check_process zlogd </span><br><span class="line">	PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	check_process gdeliveryd</span><br><span class="line">	PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	check_process gamedbd</span><br><span class="line">	PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	# check_process gonlineinfod</span><br><span class="line">	# PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	if [ $UNAMED_ACTIVE -eq 1 ]; then</span><br><span class="line">		check_process unamed</span><br><span class="line">		PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	fi</span><br><span class="line">	check_process glinkd</span><br><span class="line">	PROGRAME_ACTIVE&#x3D;&#96;expr $PROGRAME_ACTIVE + $?&#96;;</span><br><span class="line">	return $PROGRAME_ACTIVE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_process()</span><br><span class="line">&#123;</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;$1$suffix.*$1.conf&quot;&#96;</span><br><span class="line">	if [ ! -z &quot;$PIDS&quot; ]; then</span><br><span class="line">		echo service $1 is running, pid $PIDS</span><br><span class="line">		return 1;</span><br><span class="line">	else</span><br><span class="line">		echo service $1 is stopped.</span><br><span class="line">		return 0;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exists()</span><br><span class="line">&#123;</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;$1$suffix.*$1.conf&quot;&#96;</span><br><span class="line">	if [ ! -z &quot;$PIDS&quot; ]; then</span><br><span class="line">		echo service $1 is running, pid $PIDS</span><br><span class="line">		return 1</span><br><span class="line">	fi</span><br><span class="line">	return 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kill_process()</span><br><span class="line">&#123;</span><br><span class="line">	NAME&#x3D;$1</span><br><span class="line">	SIG&#x3D;$2</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;$NAME$suffix.*$NAME.conf&quot;&#96;</span><br><span class="line">	if [ -n &quot;$PIDS&quot; ]; then</span><br><span class="line">		for PID in $PIDS</span><br><span class="line">		do</span><br><span class="line">			kill -$SIG $PID</span><br><span class="line">			echo service $NAME pid $PID is killed.</span><br><span class="line">		done</span><br><span class="line">	else</span><br><span class="line">		echo service $NAME is not running.</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">check_line()</span><br><span class="line">&#123;</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	LN&#x3D;$1</span><br><span class="line">	PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;gs$suffix gs.conf gmserver.conf config&#x2F;gsalias$LN.conf&quot;&#96;</span><br><span class="line">	if [ ! -z &quot;$PIDS&quot; ]; then</span><br><span class="line">		echo line $LN is running, pid $PIDS</span><br><span class="line">		return 1;</span><br><span class="line">	else</span><br><span class="line">		echo line $LN is stopped.</span><br><span class="line">		return 0;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kill_line()</span><br><span class="line">&#123;</span><br><span class="line">	SELFID&#x3D;&#96;id -u&#96;</span><br><span class="line">	LN&#x3D;$1</span><br><span class="line">	PIDS&#x3D;&#96;pgrep -u $SELFID -f &quot;.&#x2F;gs$suffix gs.conf gmserver.conf config&#x2F;gsalias$LN.conf&quot;&#96;</span><br><span class="line">	if [ -n &quot;$PIDS&quot; ]; then</span><br><span class="line">		for PID in $PIDS</span><br><span class="line">		do</span><br><span class="line">			kill -9 $PID</span><br><span class="line">			echo line $LN pid $PID is killed.</span><br><span class="line">		done</span><br><span class="line">	else</span><br><span class="line">		echo line $LN is not running.</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">kill_grc()</span><br><span class="line">&#123;</span><br><span class="line">	kill -9  $(ps -ef|grep grc.jar$suffix |grep -v grep|awk &#39;&#123;print $2&#125;&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start_grc()</span><br><span class="line">&#123;</span><br><span class="line">	cd grc</span><br><span class="line">	rm -rf .&#x2F;lib</span><br><span class="line">	unzip lib.zip</span><br><span class="line">	rm -rf grc.jar$suffix</span><br><span class="line">	cp grc.jar grc.jar$suffix</span><br><span class="line">	nohup java -jar .&#x2F;grc.jar$suffix  -Xms1G -Xmx2G &gt;&gt;&#x2F;dev&#x2F;null  2&gt;&gt;&#x2F;tmp&#x2F;grc.err$suffix &amp;</span><br><span class="line">	cd ..</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">start()</span><br><span class="line">&#123;</span><br><span class="line">	mkdir -p logs</span><br><span class="line">        export LD_LIBRARY_PATH&#x3D;.:..&#x2F;..&#x2F;lib</span><br><span class="line">	ulimit -c unlimited</span><br><span class="line">	ulimit -n 4096</span><br><span class="line"></span><br><span class="line">	if [ ! -z $1 ]; then</span><br><span class="line">                start_line $1</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	exists zlogd</span><br><span class="line">	if [ $? -eq 0 ]; then</span><br><span class="line">		cd zlogd</span><br><span class="line">		echo &#39;start zlogd service&#39;</span><br><span class="line">		nohup setsid .&#x2F;zlogd$suffix zlogd.conf &amp;&gt;&#x2F;dev&#x2F;null &amp;</span><br><span class="line">		sleep 2</span><br><span class="line">		cd ..</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	exists gdeliveryd</span><br><span class="line">	if [ $? -eq 0 ]; then</span><br><span class="line">		cd gdeliveryd</span><br><span class="line">		echo &#39;start DS service&#39;</span><br><span class="line">		nohup setsid .&#x2F;gdeliveryd$suffix gdeliveryd.conf &amp;&gt;..&#x2F;logs&#x2F;gdelivery.log  &amp;</span><br><span class="line">		#nohup setsid valgrind --log-file&#x3D;..&#x2F;logs&#x2F;valgrind_ds.log .&#x2F;gdeliveryd$suffix gdeliveryd.conf &amp;&gt;..&#x2F;logs&#x2F;gdelivery.log  &amp;</span><br><span class="line">		cd ..</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	exists glinkd</span><br><span class="line">	if [ $? -eq 0 ]; then</span><br><span class="line">		cd glinkd</span><br><span class="line">		echo &#39;start LS service&#39;</span><br><span class="line">		nohup setsid .&#x2F;glinkd$suffix --ccs glinkd.conf &amp;&gt;..&#x2F;logs&#x2F;glinkd.ccs.log  &amp;</span><br><span class="line">		for ((i &#x3D; 1; i &lt;&#x3D; $LINK_NUM; i++))</span><br><span class="line">		do</span><br><span class="line">			nohup setsid .&#x2F;glinkd$suffix --cls -i $i glinkd.conf &amp;&gt;..&#x2F;logs&#x2F;glinkd.cls$i.log  &amp;</span><br><span class="line">		done</span><br><span class="line">		cd ..</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	exists gamedbd</span><br><span class="line">	if [ $? -eq 0 ]; then</span><br><span class="line">		cd gamedbd</span><br><span class="line">		echo &#39;start DB service&#39;</span><br><span class="line">		nohup setsid .&#x2F;gamedbd$suffix gamedbd.conf &amp;&gt;..&#x2F;logs&#x2F;gamedbd.log &amp;</span><br><span class="line">		cd ..</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	if [ $UNAMED_ACTIVE -eq 1 ]; then</span><br><span class="line">		exists unamed</span><br><span class="line">		if [ $? -eq 0 ]; then</span><br><span class="line">			cd unamed</span><br><span class="line">			echo &#39;start unamed service&#39;</span><br><span class="line">			nohup setsid .&#x2F;unamed$suffix unamed.conf &amp;&gt;..&#x2F;logs&#x2F;unamed.log &amp;</span><br><span class="line">			cd ..</span><br><span class="line">		fi</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">#	exists gonlineinfod</span><br><span class="line">#	if [ $? -eq 0 ]; then</span><br><span class="line">#		cd gonlineinfod</span><br><span class="line">#		echo &#39;start OL service&#39;</span><br><span class="line">#		nohup setsid .&#x2F;gonlineinfod$suffix gonlineinfod.conf &amp;&gt;..&#x2F;logs&#x2F;gonlineinfod.log  &amp;</span><br><span class="line">#		cd ..</span><br><span class="line">#	fi</span><br><span class="line"></span><br><span class="line">	#start_grc</span><br><span class="line"></span><br><span class="line">	start_line</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop()</span><br><span class="line">&#123;</span><br><span class="line">	if [ ! -z $1 ]; then</span><br><span class="line">                kill_line $1</span><br><span class="line">		return</span><br><span class="line">	fi</span><br><span class="line">	#kill_grc</span><br><span class="line">	kill_process glinkd KILL</span><br><span class="line">	kill_process gdeliveryd KILL</span><br><span class="line">	kill_process gamedbd USR1</span><br><span class="line">	#kill_process gonlineinfod KILL</span><br><span class="line">	if [ $UNAMED_ACTIVE -eq 1 ]; then</span><br><span class="line">		kill_process unamed USR1</span><br><span class="line">	fi</span><br><span class="line">        for LN in $LINELIST</span><br><span class="line">        do</span><br><span class="line">                kill_line $LN</span><br><span class="line">        done</span><br><span class="line">	kill_process zlogd KILL</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">wait()</span><br><span class="line">&#123;</span><br><span class="line">	for (( i&#x3D;0; i&lt;5; i++))</span><br><span class="line">	do</span><br><span class="line">		echo -n &quot;.&quot;</span><br><span class="line">		sleep 0.2</span><br><span class="line">	done</span><br><span class="line">	echo &quot;.&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart()</span><br><span class="line">&#123;</span><br><span class="line">        stop $1</span><br><span class="line">	if [ ! -z $1 ]; then</span><br><span class="line">		wait</span><br><span class="line">	else</span><br><span class="line">		PROGRAME_ACTIVE&#x3D;1;</span><br><span class="line">		while [ &quot;$PROGRAME_ACTIVE&quot; !&#x3D; &quot;0&quot; ]</span><br><span class="line">		do</span><br><span class="line">			wait</span><br><span class="line">			status</span><br><span class="line">			echo $PROGRAME_ACTIVE program is running</span><br><span class="line">		done</span><br><span class="line">	fi</span><br><span class="line">        start $1</span><br><span class="line">	wait</span><br><span class="line">	echo &#39;task accomplished&#39;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">case $1 in </span><br><span class="line">start) </span><br><span class="line">        start $2</span><br><span class="line">        ;; </span><br><span class="line">stop)</span><br><span class="line">        stop $2</span><br><span class="line">        ;; </span><br><span class="line">restart)</span><br><span class="line">        restart $2</span><br><span class="line">        ;; </span><br><span class="line">status)</span><br><span class="line">        status </span><br><span class="line">        ;; </span><br><span class="line">*) </span><br><span class="line">        usage </span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>SHELL</category>
      </categories>
      <tags>
        <tag>SHELL</tag>
      </tags>
  </entry>
  <entry>
    <title>æœ€å…¨çš„DevOpså·¥å…·é›†åˆï¼Œå†ä¹Ÿä¸æ€•é€‰å‹äº†ï¼
</title>
    <url>/2020/04/20/%E6%9C%80%E5%85%A8%E7%9A%84DevOps%E5%B7%A5%E5%85%B7%E9%9B%86%E5%90%88%EF%BC%8C%E5%86%8D%E4%B9%9F%E4%B8%8D%E6%80%95%E9%80%89%E5%9E%8B%E4%BA%86%EF%BC%81/</url>
    <content><![CDATA[<p>[TOC]</p>
<p>éšç€ DevOps çš„å‡ºç°é¢‘ç‡è¶Šæ¥è¶Šé«˜ï¼Œå¾ˆå¤šä¼ä¸šéƒ½åœ¨è ¢è ¢æ¬²åŠ¨ï¼Œæƒ³è¦è®¾è®¡å’Œå¼€å‘ DevOps å¹³å°ã€‚å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œæœ¬æ–‡ä¸ºå¤§å®¶æ€»ç»“äº† DevOps å„ä¸ªé˜¶æ®µå¯ä»¥é€‰æ‹©çš„å·¥å…·ï¼Œä¹Ÿè®¸ DevOps å¹³å°çš„æŠ€æœ¯é€‰å‹åœ¨è¿™ä¸€ç¯‡æ–‡ç« ä¸­å°±å¯ä»¥å®Œæˆã€‚<br>DevOps çš„ç›®æ ‡æ˜¯æŒç»­æ”¹è¿›ï¼Œå› æ­¤æŠ€æœ¯é€‰å‹ä¹Ÿæ˜¯åˆ†é˜¶æ®µçš„ã€‚</p>
<ol>
<li>è§„åˆ’å·¥å…·<br>åœ¨è§„åˆ’é˜¶æ®µæœ€é‡è¦çš„æ˜¯è¦åˆ¶å®šå…±åŒçš„ç›®æ ‡ã€ä¿è¯é€æ˜åº¦å’Œèµ‹æƒã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„è§„åˆ’å·¥å…·ä¸»è¦åŒ…æ‹¬ GitLabã€TaskTopã€CollabNet VersionOneã€Pivotal Trackerã€Trello å’Œ Azure Boardsã€‚</li>
</ol>
<p>GitLab<br>GitLab æ˜¯åŸºäº Web çš„ DevOps ç”Ÿå‘½å‘¨æœŸå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ª Git å­˜å‚¨åº“ç®¡ç†å™¨ï¼Œä½¿ç”¨ç”± GitLab Inc. å¼€å‘çš„å¼€æºè®¸å¯è¯æ¥æä¾› Wikiã€é—®é¢˜è·Ÿè¸ªå’Œ CI/CD ç®¡é“åŠŸèƒ½ã€‚<br>GitLab æä¾›äº†ä¸€äº›å·¥å…·ç”¨æ¥åœ¨å®è·µä¸­è§„åˆ’äº‹åŠ¡ï¼Œè¿˜å¯ä»¥ç”¨æ¥æŸ¥çœ‹å·¥ä½œçš„èŒƒå›´ã€‚</p>
<p>Tasktop<br>Tasktop å¯ä»¥å°†æ‰€æœ‰è¿™äº›å·¥å…·æ·»åŠ åˆ° Tasktop æ”¯æŒçš„å…¨å¥—æ•æ·å’Œåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆALMï¼‰ã€PPM å’Œ ITSM å·¥å…·ä¸­ï¼Œä»è€Œåœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æä¾›å‰æ‰€æœªæœ‰çš„å¯è§†åŒ–ç‰¹æ€§ã€‚</p>
<p>CollabNet VersionOne<br>VersionOne æ”¯æŒ Scrumã€çœ‹æ¿ã€XPã€SAFe å’Œæ··åˆå¼€å‘æ–¹æ³•ï¼Œç®€åŒ–äº†è·¨æ‰€æœ‰å›¢é˜Ÿã€ç¨‹åºã€è½¯ä»¶äº§å“ç»„åˆå’Œä¼ä¸šçš„è®¡åˆ’ã€è·Ÿè¸ªå’ŒæŠ¥å‘Šå·¥ä½œ</p>
<p>Pivotal Tracker<br>å…¨çƒå„åœ°å¼€å‘äººå‘˜éƒ½å¯ä»¥ä½¿ç”¨è¿™æ¬¾æ•æ·é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå›´ç»•ä¸€ä¸ªå…±äº«çš„ï¼Œå¸¦æœ‰ä¼˜å…ˆçº§çš„ backlog è¿›è¡Œå®æ—¶åä½œã€‚</p>
<p>Trello<br>Trello æ˜¯åŸºäº Web çš„çœ‹æ¿é£æ ¼åˆ—è¡¨åˆ¶ä½œåº”ç”¨ç¨‹åºï¼Œæ˜¯ Atlassian çš„å­åº”ç”¨ã€‚<br>è®¸å¤šå›¢é˜Ÿåœ¨è§„åˆ’å„ä¸ª sprint æ—¶éƒ½ä¼šç”¨å®ƒã€‚</p>
<p>Azure Boards<br>å¯ä»¥è·Ÿè¸ªè½¯ä»¶é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨æ•æ·å·¥å…·ï¼ˆåŒ…æ‹¬ Scrum boardsã€çœ‹æ¿ boards å’Œä»ªè¡¨æ¿ç­‰ï¼‰æ”¹è¿›è§„åˆ’å·¥ä½œã€‚åŒæ—¶ï¼Œè¿˜æœ‰å·¥å…·å¯ä»¥å¸®åŠ©ä½ å¯è§†åŒ–å·¥ä½œã€å…±äº«è®¡åˆ’ã€è·Ÿè¸ªè¿›åº¦ï¼Œå¹¶ç¡®ä¿ä½ æ­£åœ¨å‘ç›®æ ‡è¿ˆè¿›ã€‚</p>
<ol start="2">
<li>é—®é¢˜è·Ÿè¸ª<br>é—®é¢˜è·Ÿè¸ªé˜¶æ®µæ˜¯ä¸ºäº†æä¾›å®¢æˆ·å“åº”èƒ½åŠ›ï¼Œå‡å°‘çŸ¥è¯†æµªè´¹ï¼Œç¼©çŸ­åé¦ˆé“¾è·¯ã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„é—®é¢˜è·Ÿè¸ªå·¥å…·åŒ…æ‹¬ Atlassian Jiraã€JetBrains YouTrack å’Œ ZenDeskã€‚</li>
</ol>
<p>Atlassian Jira<br>Jira æ˜¯ Atlassian å¼€å‘çš„ä¸“ç”¨é—®é¢˜è·Ÿè¸ªäº§å“ï¼Œæä¾›äº†é”™è¯¯è·Ÿè¸ªå’Œæ•æ·é¡¹ç›®ç®¡ç†åŠŸèƒ½ã€‚</p>
<p>JetBrains YouTrack<br>YouTrack æ˜¯ç”± JetBrains å¼€å‘çš„ï¼ŒåŸºäºæµè§ˆå™¨çš„ä¸“ç”¨å•†ä¸šè½¯ä»¶ï¼Œèåˆäº†é”™è¯¯è·Ÿè¸ªå™¨ã€é—®é¢˜è·Ÿè¸ªç³»ç»Ÿä»¥åŠé¡¹ç›®ç®¡ç†è½¯ä»¶ã€‚å®ƒçš„å–ç‚¹æ˜¯åŸºäºæŸ¥è¯¢çš„é—®é¢˜æœç´¢ï¼Œæ‹¥æœ‰è‡ªåŠ¨å®Œæˆã€åˆ†æ‰¹å¤„ç†é—®é¢˜ã€è‡ªå®šä¹‰é—®é¢˜å±æ€§é›†ï¼Œä»¥åŠåˆ›å»ºè‡ªå®šä¹‰å·¥ä½œæµçš„ç‰¹æ€§ã€‚</p>
<p>Zendesk<br>Zendesk å¯ä»¥è½»æ¾åœ°ä»æ‰€æœ‰æ¸ é“è·Ÿè¸ªæ¯ä¸€ä¸ªå®¢æˆ·é—®é¢˜ã€‚ç›®å‰ Uber å’Œ Airbnb ç­‰è®¸å¤šå…¬å¸éƒ½åœ¨ä½¿ç”¨ Zendesk Support ä½œä¸ºä»–ä»¬çš„é—®é¢˜è·Ÿè¸ªè½¯ä»¶ã€‚</p>
<ol start="3">
<li>æºä»£ç æ§åˆ¶<br>æºä»£ç æ§åˆ¶ä¸»è¦æ˜¯ä¸ºäº†æ§åˆ¶èµ„äº§ï¼Œå‡å°‘æ²Ÿé€šéšœç¢ï¼Œèµ‹èƒ½å›¢é˜Ÿã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„ SCM å·¥å…·åŒ…æ‹¬ Gitã€GitHubã€GitLabã€Bitbucket å’Œ Subversionã€‚</li>
</ol>
<p>Git<br>Git æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç”¨æ¥åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­è·Ÿè¸ªæºä»£ç çš„æ›´æ”¹ã€‚å®ƒæ˜¯ä¸“ä¸ºåè°ƒä¸åŒç¨‹åºå‘˜çš„å·¥ä½œè€Œè®¾è®¡çš„ï¼Œä¹Ÿå¯ç”¨äºè·Ÿè¸ªå„ç§æ–‡ä»¶é›†ä¸­çš„æ›´æ”¹ã€‚å®ƒçš„ä¼˜åŠ¿åŒ…æ‹¬é€Ÿåº¦ã€æ•°æ®å®Œæ•´æ€§ä»¥åŠå¯¹åˆ†å¸ƒå¼éçº¿æ€§å·¥ä½œæµçš„æ”¯æŒ</p>
<p>GitHub<br>GitHub æä¾›äº† Git çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å’Œæºä»£ç ç®¡ç†åŠŸèƒ½ï¼Œè‡ªå·±ä¹Ÿæœ‰å¾ˆå¤šç‰¹æ€§ã€‚</p>
<p>GitLab<br>GitLab ä¸­çš„ç‰ˆæœ¬æ§åˆ¶æä¾›äº†ä¸–ç•Œä¸€æµçš„æºä»£ç ç®¡ç†åŠŸèƒ½ï¼Œå¯å¸®åŠ©ä½ çš„å¼€å‘å›¢é˜Ÿå…±äº«ã€åä½œå¹¶å°½å¯èƒ½æé«˜ç”Ÿäº§åŠ›ã€‚</p>
<p>Bitbucket<br>Bitbucket æ˜¯ Atlassian æ‰€æœ‰çš„ã€åŸºäº Web çš„ç‰ˆæœ¬æ§åˆ¶åº“æ‰˜ç®¡æœåŠ¡ï¼Œå¯ç”¨åœ¨ä½¿ç”¨ Mercurial æˆ– Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æºä»£ç å’Œå¼€å‘é¡¹ç›®ä¸Šã€‚</p>
<p>Subversion<br>Apache Subversion æ˜¯ä¸€ä¸ªè½¯ä»¶ç‰ˆæœ¬å’Œä¿®è®¢æ§åˆ¶ç³»ç»Ÿï¼Œå…¶æ ¹æ® Apache è®¸å¯å¼€æºã€‚è½¯ä»¶å¼€å‘äººå‘˜å¯ä½¿ç”¨ Subversion æ¥ç»´æŠ¤æºä»£ç ã€ç½‘é¡µå’Œæ–‡æ¡£ç­‰æ–‡ä»¶çš„å½“å‰å’Œå†å²ç‰ˆæœ¬ã€‚</p>
<ol start="4">
<li>æ„å»ºå·¥å…·<br>æ„å»ºé˜¶æ®µä¸»è¦æ˜¯ä¸ºäº†ä¿æŒæ‰“åŒ…çš„ä¸€è‡´æ€§ï¼Œè‡ªåŠ¨æ‰§è¡Œå®¹æ˜“å‡ºé”™çš„æ´»åŠ¨ï¼Œç”Ÿæˆæ—©æœŸè´¨é‡ä¿¡å·ã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„æ„å»ºå·¥å…·åŒ…æ‹¬ Maven/Gradleã€MSBuildã€Rakeã€JFrog Artifactoryã€Sonatype Nexus å’Œ NuGetã€‚</li>
</ol>
<p>Maven/Gradle<br>Maven æ˜¯ä¸»è¦ç”¨äº Java é¡¹ç›®çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚Maven è¿˜å¯ä»¥æ„å»ºå’Œç®¡ç†ä»¥ C#ã€Rubyã€Scala ç­‰è¯­è¨€ç¼–å†™çš„é¡¹ç›®ã€‚<br>Gradle æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªåŠ¨åŒ–æ„å»ºç³»ç»Ÿï¼Œå…¶åŸºäº Apache Ant å’Œ Apache Maven çš„ç†å¿µï¼Œå¹¶å¼•å…¥äº†åŸºäº Groovy çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œæ›¿ä»£ Apache Maven ä½¿ç”¨çš„ XML æ ¼å¼æ¥å£°æ˜é¡¹ç›®é…ç½®ã€‚</p>
<p>MSBuild<br>Microsoft Build Engineï¼ˆé€šå¸¸ç§°ä¸º MSBuildï¼‰æ˜¯ç”¨æ¥æ‰˜ç®¡ä»£ç åŠåŸç”Ÿ C++ ä»£ç çš„å…è´¹å¼€æºæ„å»ºå·¥å…·é›†ï¼Œå®ƒä¹‹å‰æ˜¯.NET Framework çš„ä¸€éƒ¨åˆ†ã€‚Visual Studio ä¾èµ– MSBuildï¼ˆåä¹‹åˆ™ä¸ç„¶ï¼‰ã€‚</p>
<p>Rake<br>Rake æ˜¯ä¸€ä¸ªè½¯ä»¶ä»»åŠ¡ç®¡ç†å’Œè‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚å®ƒå…è®¸ç”¨æˆ·æŒ‡å®šä»»åŠ¡å¹¶æè¿°ä¾èµ–å…³ç³»ã€‚ä½ ä¹Ÿå¯ä»¥å¯¹å‘½åç©ºé—´ä¸­çš„ç»„ä»»åŠ¡æ‰§è¡Œè¿™äº›æ“ä½œã€‚</p>
<p>JFrog Artifactory<br>JFrog Artifactory è¿™æ¬¾å·¥å…·å¯ç”¨æ¥å­˜å‚¨æ„å»ºè¿‡ç¨‹çš„äºŒè¿›åˆ¶è¾“å‡ºï¼Œä»¥å¤‡åˆ†å‘å’Œéƒ¨ç½²ä¹‹ç”¨ã€‚Artifactory æ”¯æŒè®¸å¤šè½¯ä»¶åŒ…æ ¼å¼ï¼Œå¦‚ Mavenã€Debianã€npmã€Helmã€Rubyã€Python å’Œ Dockerã€‚<br>JFrog æä¾›äº†é«˜å¯ç”¨æ€§ã€å¤åˆ¶ã€ç¾éš¾æ¢å¤å’Œå¯ä¼¸ç¼©ç‰¹æ€§ï¼Œå¹¶å…¼å®¹è®¸å¤šæœ¬åœ°å’Œäº‘å­˜å‚¨äº§å“ã€‚</p>
<p>Sonatype Nexus<br>Sonatype Nexus æ˜¯ä¸€æ¬¾å­˜å‚¨åº“ç®¡ç†å™¨ã€‚ä½ å¯ä»¥ç”¨å®ƒä»£ç†ã€æ”¶é›†å’Œç®¡ç†ä¾èµ–é¡¹ï¼Œè¿™æ ·å°±ç”¨ä¸ç€å’Œä¸€å¤§å † JAR æ‰“äº¤é“äº†ã€‚å®ƒç®€åŒ–äº†è½¯ä»¶åˆ†å‘çš„å·¥ä½œã€‚<br>ä½ å¯ä»¥é…ç½®è‡ªå·±çš„å†…éƒ¨æ„å»ºï¼Œç„¶åå‘å¸ƒåˆ° Nexus ä¸Šä¾›å…¶ä»–å¼€å‘è€…ä½¿ç”¨ã€‚</p>
<p>NuGet<br>NuGet æ˜¯.NET çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ã€‚NuGet å®¢æˆ·ç«¯å·¥å…·æä¾›äº†ç”Ÿæˆå’Œä½¿ç”¨è½¯ä»¶åŒ…çš„åŠŸèƒ½ã€‚<br>NuGet Gallery æ˜¯ä¸ºæ‰€æœ‰åŒ…ä½œè€…å’Œä½¿ç”¨è€…æä¾›çš„è½¯ä»¶åŒ…ä¸­å¿ƒå­˜å‚¨åº“ã€‚</p>
<ol start="5">
<li>æµ‹è¯•å·¥å…·<br>æµ‹è¯•é˜¶æ®µä¸»è¦æ˜¯æ£€æµ‹å†…éƒ¨è´¨é‡ï¼Œå»ºç«‹å¯¹å·²éƒ¨ç½²æ„ä»¶çš„ä¿¡å¿ƒã€‚ç›®å‰ä¸šå†…å¸¸ç”¨çš„æµ‹è¯•å·¥å…·åŒ…æ‹¬ JUnitã€xUnit.netã€Seleniumã€Jasmine å’Œ Cucumberã€‚</li>
</ol>
<p>JUnit<br>JUnit æ˜¯ç”¨äº Java ç¼–ç¨‹è¯­è¨€çš„å•å…ƒæµ‹è¯•æ¡†æ¶ã€‚JUnit åœ¨æµ‹è¯•é©±åŠ¨å¼€å‘çš„ç¯å¢ƒä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œä» SUnit èµ·æºçš„ä¸€ç»„å•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆç»Ÿç§°ä¸º xUnitï¼‰ä¹‹ä¸€ã€‚</p>
<p>xUnit.net<br>xUnit.net æ˜¯ç”± NUnit çš„åŸä½œè€…ç¼–å†™çš„ï¼Œç”¨äº.NET Framework çš„å¼€æºå•å…ƒæµ‹è¯•å·¥å…·ã€‚</p>
<p>Selenium<br>Selenium æ˜¯ç”¨äºæµ‹è¯• Web åº”ç”¨ç¨‹åºçš„å¯ç§»æ¤æ¡†æ¶ã€‚Selenium æä¾›äº†ä¸€ç§å›æ”¾å·¥å…·ï¼Œä½¿ç”¨æˆ·æ— éœ€å­¦ä¹ æµ‹è¯•è„šæœ¬è¯­è¨€å°±èƒ½ç¼–å†™åŠŸèƒ½æµ‹è¯•ã€‚</p>
<p>Jasmine<br>Jasmine æ˜¯ç”¨äº JavaScript çš„å¼€æºæµ‹è¯•æ¡†æ¶ã€‚å®ƒå¯ä»¥åœ¨ä»»ä½•æ”¯æŒ JavaScript çš„å¹³å°ä¸Šè¿è¡Œï¼Œä¸ä¼šå…¥ä¾µåº”ç”¨ç¨‹åºæˆ– IDEï¼Œè¿˜æœ‰ç€æ˜“è¯»çš„è¯­æ³•ã€‚åœ¨å®ƒèº«ä¸Šå¯ä»¥æ‰¾åˆ° Screw.Unitã€JSSpecã€JSpec å’Œ RSpec ç­‰è¯¸å¤šå•å…ƒæµ‹è¯•æ¡†æ¶çš„å½±å­</p>
<p>Cucumber<br>Cucumber æ˜¯ä¸€ç§æ”¯æŒè¡Œä¸ºé©±åŠ¨å¼€å‘çš„è½¯ä»¶å·¥å…·ã€‚Cucumber BDD æ–¹æ³•çš„æ ¸å¿ƒæ˜¯ä¸€ç§ç§°ä¸º Gherkin çš„æ™®é€šè¯­è¨€è§£æå™¨ã€‚å®ƒèƒ½ç”¨å®¢æˆ·å¯ä»¥ç†è§£çš„é€»è¾‘è¯­è¨€æ¥æŒ‡å®šé¢„æœŸçš„è½¯ä»¶è¡Œä¸ºã€‚</p>
<ol start="6">
<li>æŒç»­é›†æˆå’Œéƒ¨ç½²ï¼ˆCI/CDï¼‰<br>CI å·¥å…·çš„å­˜åœ¨æ˜¯ä¸ºäº†å¿«é€Ÿåé¦ˆå’Œå‡å°‘ç¼ºé™·ã€ç­‰å¾…ã€‚ç›®å‰ä¸šåŠ¡æ¯”è¾ƒå¸¸ç”¨çš„ CI å·¥å…·åŒ…æ‹¬ Jenkinsã€CircleCIã€Travis CIã€Concourseã€AWS CodePipeline å’Œ Azure Pipelinesã€‚</li>
</ol>
<p>Jenkins<br>Jenkins æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºè‡ªåŠ¨åŒ–æœåŠ¡å™¨ã€‚Jenkins å¯ç”¨æ¥è‡ªåŠ¨åŒ–è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­éäººç±»å‚ä¸çš„å·¥ä½œï¼ŒåŸºäº CI å’Œ CD çš„æŠ€æœ¯ç†å¿µã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºæœåŠ¡å™¨çš„ç³»ç»Ÿï¼Œå¯åœ¨ servlet å®¹å™¨ï¼ˆä¾‹å¦‚ Apache Tomcatï¼‰ä¸­è¿è¡Œã€‚</p>
<p>CircleCI<br>CircleCI æ˜¯ä¸–ç•Œä¸Šæœ€å¤§çš„å…±äº« CI/CD å¹³å°ï¼Œä¹Ÿæ˜¯ä»£ç ä»æ„æ€åˆ°äº¤ä»˜è¿‡ç¨‹çš„ä¸­å¤®æ¢çº½ã€‚<br>ä½œä¸ºæœ€å¸¸ç”¨çš„ DevOps å·¥å…·ä¹‹ä¸€ï¼ŒCircleCI æ¯å¤©å¤„ç†è¶…è¿‡ 100 ä¸‡ä¸ªæ„å»ºï¼Œå› æ­¤æ”¶é›†äº†å¤§é‡å…³äºå·¥ç¨‹å›¢é˜Ÿå·¥ä½œæ–¹å¼ä»¥åŠä»£ç è¿è¡Œæ–¹å¼çš„æ•°æ®ã€‚Spotifyã€Coinbaseã€Stitch Fix å’Œ BuzzFeed ç­‰å…¬å¸ä½¿ç”¨ CircleCI æ¥æå‡å·¥ç¨‹å›¢é˜Ÿçš„ç”Ÿäº§åŠ›ã€å‘å¸ƒæ›´å¥½çš„äº§å“å¹¶æ›´å¿«åœ°å°†äº§å“æ¨å‘å¸‚åœºã€‚</p>
<p>Travis CI<br>TravisCI æ˜¯ä¸€é¡¹æ‰˜ç®¡ CI æœåŠ¡ï¼Œç”¨äºæ„å»ºå’Œæµ‹è¯• GitHub ä¸Šæ‰˜ç®¡çš„è½¯ä»¶é¡¹ç›®ã€‚Travis CI ä¸ºç§æœ‰é¡¹ç›®æä¾›å„ç§ä»˜è´¹è®¡åˆ’ï¼Œå¹¶æä¾›äº†å¼€æºçš„å…è´¹æ–¹æ¡ˆã€‚TravisPro æä¾›äº†åœ¨å®¢æˆ·è‡ªå·±çš„ç¡¬ä»¶ä¸Šå®šåˆ¶åŒ–éƒ¨ç½²ä¸“æœ‰ç‰ˆæœ¬çš„èƒ½åŠ›ã€‚</p>
<p>Concourse<br>Concourse æ˜¯ç”¨ Go ç¼–å†™çš„è‡ªåŠ¨åŒ–ç³»ç»Ÿã€‚äººä»¬ç»å¸¸å°†å®ƒç”¨äº CI/CDï¼Œå…¶å–ç‚¹æ˜¯å¼ºå¤§çš„å¯ä¼¸ç¼©æ€§ï¼Œå¯ä»¥æä¾›å¾ˆç®€å•æˆ–è€…å¾ˆå¤æ‚çš„è‡ªåŠ¨åŒ–ç®¡é“ã€‚</p>
<ol start="7">
<li><p>AWS CodePipeline<br>AWS CodePipeline æ˜¯ä¸€é¡¹å®Œå…¨æ‰˜ç®¡çš„ CD æœåŠ¡ï¼Œå¯å¸®åŠ©ä½ è‡ªåŠ¨åŒ–å‘å¸ƒç®¡é“ï¼Œä»¥å®ç°å¿«é€Ÿã€å¯é çš„åº”ç”¨ç¨‹åºå’ŒåŸºç¡€æ¶æ„æ›´æ–°æµç¨‹ã€‚<br>æ¯å½“ä½ æ›´æ”¹ä»£ç æ—¶ï¼ŒCodePipeline éƒ½ä¼šæ ¹æ®ä½ å®šä¹‰çš„å‘å¸ƒæ¨¡å‹è‡ªåŠ¨æ‰§è¡Œå‘å¸ƒæµç¨‹ä¸­çš„æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²é˜¶æ®µã€‚è¿™ä½¿ä½ èƒ½å¤Ÿå¿«é€Ÿå¯é åœ°äº¤ä»˜åŠŸèƒ½å’Œæ›´æ–°ã€‚<br>ä½ å¯ä»¥è½»æ¾åœ°å°† AWS CodePipeline ä¸ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆä¾‹å¦‚ GitHubï¼‰æˆ–ä½ è‡ªå·±çš„è‡ªåˆ¶æ’ä»¶é›†æˆã€‚ä½¿ç”¨ AWS CodePipeline æ—¶ä½ æŒ‰éœ€ä»˜è´¹å³å¯ã€‚å®ƒæ²¡æœ‰å‰æœŸè´¹ç”¨æˆ–é•¿æœŸæ‰¿è¯ºã€‚</p>
</li>
<li><p>Azure Pipelines<br>å¯ç”¨å®ƒè·å–é€‚ç”¨äº Linuxã€macOS å’Œ Windows çš„äº‘æ‰˜ç®¡ç®¡é“ã€‚ç”Ÿæˆ Webã€æ¡Œé¢å’Œç§»åŠ¨åº”ç”¨ç¨‹åºã€‚éƒ¨ç½²åˆ°äº‘ç«¯æˆ–æœ¬åœ°ã€‚<br>ä½¿ç”¨ Pipelines è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²æµç¨‹å¯ä»¥èŠ‚çº¦å¾ˆå¤šæ—¶é—´ï¼Œä»è€Œè…¾å‡ºæ›´å¤šèµ„æºæŠ•å…¥åˆ›é€ æ´»åŠ¨ã€‚<br>è€Œ CD å·¥å…·ä¸»è¦æ˜¯ä¸ºäº†å°†å¤æ‚çš„ç®¡é“è‡ªåŠ¨åŒ–ï¼Œç»Ÿä¸€å›¢é˜Ÿç›®æ ‡ã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„ CD å·¥å…·åŒ…æ‹¬ Spinnakerã€Octopus Deploy å’Œ AWS CodeDeployã€‚</p>
</li>
</ol>
<p>Spinnaker<br>Spinnaker æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº CD è½¯ä»¶å¹³å°ï¼Œæœ€åˆç”± Netflix å¼€å‘ï¼Œä¸ä¹…è¢«è°·æ­Œçœ‹ä¸­å¹¶å‘å±•èµ·æ¥ã€‚<br>Spinnaker æ˜¯ä¸€ä¸ªå¤šäº‘ CD å¹³å°ï¼Œèƒ½å¤Ÿä»¥é«˜é€Ÿåº¦å’Œå¼ºä¿¡å¿ƒæ¥å‘å¸ƒè½¯ä»¶æ›´æ”¹ã€‚å®ƒæä¾›äº†å¼ºå¤§è€Œçµæ´»çš„ç®¡é“ç®¡ç†ç³»ç»Ÿï¼Œå¹¶æ”¯æŒä¸ä¸»æµäº‘æä¾›å•†çš„é›†æˆã€‚</p>
<p>Octopus Deploy<br>Octopus Deploy æ˜¯å…¨çƒé¢†å…ˆçš„ CD å›¢é˜Ÿä½¿ç”¨çš„è‡ªåŠ¨éƒ¨ç½²å’Œå‘å¸ƒç®¡ç†å·¥å…·ã€‚<br>Octopus æ˜¯ä¸€ä¸ªå·¥å…·é›†ï¼Œå¯ä»¥æ˜¾è‘—ç®€åŒ–ä»»ä½• DevOps æµç¨‹ï¼Œä»¥é€šè¿‡äº‘æˆ–è™šæ‹Ÿæœºè¿ç»­æµ‹è¯•å’Œéƒ¨ç½²å¤§é‡å¾®æœåŠ¡æˆ–åº”ç”¨ç¨‹åºã€‚</p>
<p>AWS CodeDeploy<br>AWS CodeDeploy æ˜¯ä¸€é¡¹å®Œå…¨æ‰˜ç®¡çš„éƒ¨ç½²æœåŠ¡ï¼Œå¯è‡ªåŠ¨å°†è½¯ä»¶éƒ¨ç½²åˆ°å„ç§è®¡ç®—æœåŠ¡ä¸Šï¼Œä¾‹å¦‚ Amazon EC2ã€AWS Fargateã€AWS Lambda å’Œä½ çš„æœ¬åœ°æœåŠ¡å™¨ç­‰ã€‚<br>ä½ å¯ä»¥ä½¿ç”¨ AWS CodeDeploy è‡ªåŠ¨æ‰§è¡Œè½¯ä»¶éƒ¨ç½²ï¼Œæ— éœ€å®¹æ˜“å‡ºé”™çš„æ‰‹åŠ¨æ“ä½œã€‚</p>
<ol start="7">
<li>é…ç½®ç®¡ç†å·¥å…·<br>é…ç½®ç®¡ç†å·¥å…·çš„ä½œç”¨æ˜¯å°†åŸºç¡€æ¶æ„ä»£ç åŒ–ï¼ŒåŠ å¼ºä¸€è‡´æ€§ã€‚ç›®å‰ä¸šå†…å¸¸ç”¨çš„é…ç½®ç®¡ç†å·¥å…·åŒ…æ‹¬ Terraformã€BOSHã€Chefã€Ansibleã€Puppetã€Google Cloud Deployment Managerã€‚</li>
</ol>
<p>Terraform<br>Terraform æ˜¯ç”± HashiCorp åˆ›å»ºçš„å¼€æºåŸºç¡€æ¶æ„å³ä»£ç ï¼ˆIaCï¼‰è½¯ä»¶å·¥å…·ã€‚å®ƒè®©ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ Hashicorp é…ç½®è¯­è¨€æˆ– JSONï¼ˆå¯é€‰ï¼‰è¿™ä¸¤ç§é«˜çº§é…ç½®è¯­è¨€æ¥å®šä¹‰å’Œé…ç½®æ•°æ®ä¸­å¿ƒåŸºç¡€æ¶æ„ã€‚</p>
<p>BOSH<br>BOSH æ˜¯ä¸€ä¸ªå°†å°å‹å’Œå¤§è§„æ¨¡äº‘è½¯ä»¶çš„å‘å¸ƒå·¥ç¨‹ã€éƒ¨ç½²å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç»Ÿä¸€åœ¨ä¸€èµ·çš„é¡¹ç›®ã€‚BOSH å¯ä»¥åœ¨æ•°ç™¾ä¸ª VM ä¸Šé…ç½®å’Œéƒ¨ç½²è½¯ä»¶ã€‚å®ƒè¿˜èƒ½ä»¥æ¥è¿‘é›¶çš„åœæœºæ—¶é—´æ‰§è¡Œç›‘è§†ã€æ•…éšœæ¢å¤å’Œè½¯ä»¶æ›´æ–°ä»»åŠ¡ã€‚<br>è™½ç„¶ BOSH æ˜¯ä¸ºäº†éƒ¨ç½² Cloud Foundry è€Œå¼€å‘çš„ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ç”¨æ¥éƒ¨ç½²å‡ ä¹æ‰€æœ‰è½¯ä»¶ï¼ˆä¾‹å¦‚ Hadoopï¼‰ã€‚BOSH ç‰¹åˆ«é€‚åˆå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚<br>æ­¤å¤–ï¼ŒBOSH æ”¯æŒå¤šä¸ªåŸºç¡€æ¶æ„å³æœåŠ¡ï¼ˆIaaSï¼‰æä¾›å•†ï¼Œä¾‹å¦‚ VMware vSphereã€Google Cloud Platformã€Amazon WebServices EC2ã€Microsoft Azureã€OpenStack å’Œé˜¿é‡Œäº‘ã€‚å®ƒå¸¦æœ‰ä¸€ä¸ªäº‘æä¾›å•†ç•Œé¢ï¼ˆCPIï¼‰ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ‰©å±• BOSH ä»¥æ”¯æŒå…¶ä»– IaaS æä¾›å•†ï¼Œå¦‚ Apache CloudStack å’Œ VirtualBox ç­‰ã€‚</p>
<p>Chef<br>Chef æ˜¯ä¸€ç§é…ç½®ç®¡ç†å·¥å…·ï¼Œç”¨æ¥å¤„ç†ç‰©ç†æœåŠ¡å™¨ã€è™šæ‹Ÿæœºå’Œäº‘ä¸­çš„æœºå™¨è®¾ç½®ã€‚è®¸å¤šå…¬å¸ä½¿ç”¨ Chef è½¯ä»¶æ¥æ§åˆ¶å’Œç®¡ç†è‡ªå·±çš„åŸºç¡€æ¶æ„ï¼Œä»–ä»¬åŒ…æ‹¬ Facebookã€Etsyã€Cheezburger å’Œ Indiegogo ç­‰ã€‚<br>Chef æ˜¯æŒç»­è‡ªåŠ¨åŒ–è½¯ä»¶é¢†åŸŸçš„é¢†å¯¼è€…ã€åº”ç”¨ç¨‹åºè‡ªåŠ¨åŒ–é¢†åŸŸçš„åˆ›æ–°è€…ï¼Œä¹Ÿæ˜¯ DevOps è¿åŠ¨çš„åˆ›å§‹äººä¹‹ä¸€ã€‚Chef ä¸å…¨çƒ 1000 å¤šå®¶æœ€å…·åˆ›æ–°åŠ›çš„å…¬å¸åˆä½œï¼Œä»¥å®ç°ä»–ä»¬æ•°å­—åŒ–è½¬å‹çš„æ„¿æ™¯ï¼Œå¹¶æä¾›å¯å¿«é€Ÿäº¤ä»˜è½¯ä»¶çš„å®è·µå’Œå¹³å°ã€‚</p>
<p>Ansible<br>Ansible æ˜¯ä¸€ç§å¼€æºçš„è½¯ä»¶é¢„å¤‡ã€é…ç½®ç®¡ç†å’Œåº”ç”¨ç¨‹åºéƒ¨ç½²å·¥å…·ã€‚å®ƒå¯ä»¥åœ¨è®¸å¤šç±» Unix ç³»ç»Ÿä¸Šè¿è¡Œï¼Œæ—¢å¯ä»¥é…ç½®ç±» Unix ç³»ç»Ÿä¹Ÿå¯ä»¥é…ç½®å¾®è½¯ Windowsã€‚å®ƒè‡ªå¸¦å£°æ˜å¼è¯­è¨€æ¥æè¿°ç³»ç»Ÿé…ç½®ã€‚</p>
<p>Puppet<br>Puppet æä¾›çš„èƒ½åŠ›å¯ä»¥å®šä¹‰ç³»ç»Ÿæ‰€éœ€çš„è½¯ä»¶å’Œé…ç½®ï¼Œç„¶ååœ¨åˆå§‹è®¾ç½®åä¿æŒæŒ‡å®šçŠ¶æ€ã€‚<br>ç”¨æˆ·ä½¿ç”¨ä¸ Ruby ç±»ä¼¼çš„å£°æ˜å¼é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰æ¥å®šä¹‰æŒ‡å®šç¯å¢ƒæˆ–åŸºç¡€æ¶æ„çš„é…ç½®å‚æ•°ã€‚Puppet ä½¿ç”¨ç§°ä¸º Facter çš„ä¸€ä¸ªå®ç”¨ç¨‹åºè·å–ç³»ç»Ÿä¿¡æ¯ï¼Œè¯¥ç¨‹åºè·Ÿéš Puppet è½¯ä»¶åŒ…ä¸€å¹¶å®‰è£…ã€‚<br>Puppet master æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œä½¿ç”¨æ¸…å•æ¥ç®¡ç†å®ƒæ‰€æ§åˆ¶çš„æ‰€æœ‰èŠ‚ç‚¹çš„é‡è¦é…ç½®ä¿¡æ¯ã€‚<br>Master æ§åˆ¶çš„èŠ‚ç‚¹éƒ½å®‰è£…äº† Puppet å¹¶è¿è¡Œ Puppet ä»£ç†ï¼ˆå³å®ˆæŠ¤ç¨‹åºï¼‰ã€‚ä»£ç†æ”¶é›†çš„èŠ‚ç‚¹é…ç½®ä¿¡æ¯å°†å‘é€åˆ° Puppet masterã€‚ç„¶åï¼ŒPuppet master æ ¹æ®èŠ‚ç‚¹çš„é…ç½®ç­–ç•¥æ¥ç¼–åˆ¶ä¸€ä¸ªç›®å½•ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥å°†ä»»ä½•å¿…è¦çš„é…ç½®æ›´æ–°åº”ç”¨åˆ°è‡ªå·±èº«ä¸Šã€‚<br>Puppet ä½¿ç”¨çš„æ˜¯ pull æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œä»£ç†å®šæœŸè½®è¯¢ masterï¼Œä»¥æ£€ç´¢ç‰¹å®šäºç«™ç‚¹å’ŒèŠ‚ç‚¹çš„é…ç½®ã€‚åœ¨è¿™ç§åŸºç¡€æ¶æ„ä¸­ï¼Œå—ç®¡ç†çš„èŠ‚ç‚¹é€šå¸¸ä»¥åå°æœåŠ¡çš„å½¢å¼è¿è¡Œ Puppet ä»£ç†åº”ç”¨ç¨‹åºã€‚</p>
<p>Google Cloud Deployment Manager<br>Google Cloud Deployment Manager æ˜¯ä¸€é¡¹åŸºç¡€æ¶æ„ç®¡ç†æœåŠ¡ï¼Œå¯è½»æ¾åˆ›å»ºã€éƒ¨ç½²å’Œç®¡ç† Google Cloud Platform èµ„æºã€‚</p>
<ol start="8">
<li>äº‘å¹³å°<br>äº‘å¹³å°ä¸»è¦æ˜¯ä¸ºäº†è‡ªåŠ¨åŒ–ã€è§‚å¯Ÿè½¯ä»¶çš„è¿è¡Œæ—¶ï¼Œç›®å‰ä¸šå†…å¸¸ç”¨çš„äº‘å¹³å°åŒ…æ‹¬ Amazon Web Servicesã€Microsoft Azureã€Google Cloud Platformã€Pivotal Cloud Foundryã€Heroku å’Œ Container Schedulersã€‚</li>
</ol>
<p>Amazon Web Services<br>Amazon Web Servicesï¼ˆAWSï¼‰æ˜¯ä¸€ä¸ªå®‰å…¨çš„äº‘æœåŠ¡å¹³å°ï¼Œæä¾›è®¡ç®—èƒ½åŠ›ã€æ•°æ®åº“å­˜å‚¨ã€å†…å®¹äº¤ä»˜ç­‰åŠŸèƒ½ï¼Œä»¥å¸®åŠ©ä¸šåŠ¡æ‰©å±•å’Œæˆé•¿ã€‚<br>ç®€å•æ¥è¯´ï¼ŒAWS å…è®¸ä½ è¿›è¡Œä»¥ä¸‹æ“ä½œï¼š<br>åœ¨äº‘ä¸­è¿è¡Œ Web å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä»¥æ‰˜ç®¡åŠ¨æ€ç½‘ç«™<br>å°†æ‰€æœ‰æ–‡ä»¶å®‰å…¨åœ°å­˜å‚¨åœ¨äº‘ä¸­ï¼Œå¯ä»¥ä»ä»»ä½•åœ°æ–¹è®¿é—®å®ƒä»¬<br>ä½¿ç”¨æ‰˜ç®¡æ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLã€Oracle æˆ– SQLServerï¼‰å­˜å‚¨ä¿¡æ¯<br>ä½¿ç”¨å†…å®¹äº¤ä»˜ç½‘ç»œï¼ˆCDNï¼‰åœ¨ä¸–ç•ŒèŒƒå›´å†…å¿«é€Ÿäº¤ä»˜é™æ€å’ŒåŠ¨æ€æ–‡ä»¶<br>å‘ä½ çš„ä¼—å¤šå®¢æˆ·å‘é€å¤§é‡ç”µå­é‚®ä»¶</p>
<p>Microsoft Azure<br>Microsoft Azure æ˜¯ç”±å¾®è½¯åˆ›å»ºçš„ä¸€ç§äº‘è®¡ç®—æœåŠ¡ï¼Œå¯é€šè¿‡å¾®è½¯ç®¡ç†çš„æ•°æ®ä¸­å¿ƒæ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²å’Œç®¡ç†åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚<br>Microsoft Azureï¼ˆä»¥å‰ç§°ä¸º Windows Azureï¼‰æ˜¯å¾®è½¯çš„å…¬å…±äº‘è®¡ç®—å¹³å°ã€‚å®ƒæä¾›äº†å¤šç§äº‘æœåŠ¡ï¼ŒåŒ…æ‹¬è®¡ç®—ã€åˆ†æã€å­˜å‚¨å’Œç½‘ç»œç­‰ç”¨é€”ã€‚ç”¨æˆ·å¯ä»¥åœ¨è¿™äº›æœåŠ¡ä¸­æŒ‘é€‰è‡ªå·±æ‰€éœ€çš„é€‰é¡¹ï¼Œä»¥åœ¨å…¬æœ‰äº‘ä¸­å¼€å‘å’Œæ‰©å±•æ–°çš„åº”ç”¨ç¨‹åºï¼Œæˆ–è¿è¡Œç°æœ‰åº”ç”¨ç¨‹åºã€‚</p>
<p>Google Cloud Platform<br>ç”±è°·æ­Œæä¾›çš„ Google Cloud Platform æ˜¯ä¸€å¥—äº‘è®¡ç®—æœåŠ¡ï¼Œè¿è¡Œåœ¨è°·æ­Œå†…éƒ¨ä¸ºå…¶æœ€ç»ˆç”¨æˆ·äº§å“ï¼ˆä¾‹å¦‚ Google Searchã€Gmail å’Œ YouTubeï¼‰æ‰“é€ çš„åŒä¸€å¥—åŸºç¡€æ¶æ„ä¸Šã€‚<br>Google Cloud Platform æä¾›äº†è®¡ç®—èµ„æºï¼Œç”¨äºåœ¨ Web ä¸Šéƒ¨ç½²å’Œè¿è¥åº”ç”¨ç¨‹åºã€‚å®ƒçš„ä¸“é•¿æ˜¯ä¸ºä¸ªäººå’Œä¼ä¸šæä¾›æ„å»ºå’Œè¿è¡Œè½¯ä»¶çš„åœºæ‰€ï¼Œå¹¶ä½¿ç”¨ Web æ¥è¿æ¥è½¯ä»¶ç”¨æˆ·ã€‚<br>è°·æ­Œçš„äº‘è®¡ç®—æœåŠ¡å¯å¸®åŠ©ä½ ç›´é¢å„ç§ä¸šåŠ¡æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬æ•°æ®ç®¡ç†ã€æ··åˆå’Œå¤šäº‘ä»¥åŠ AI å’Œ ML ç­‰ã€‚</p>
<p>Pivotal Cloud Foundry<br>Pivotal Cloud Foundryï¼ˆPCFï¼‰æ˜¯ä¸€ä¸ªå¼€æºã€å¤šäº‘çš„åº”ç”¨ç¨‹åºå¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰ï¼Œç”± 501 ç»„ç»‡ Cloud Foundry Foundation ç®¡ç†ã€‚è¯¥è½¯ä»¶æœ€åˆç”± VMware å¼€å‘ï¼Œä½†ä¹‹åè½¬ç§»åˆ°äº† Pivotal Softwareã€‚éšç€ VMware äº 2019 å¹´åº•æ”¶è´­ Pivotalï¼Œå®ƒä¹Ÿé‡æ–°å›åˆ°äº† VMwareã€‚<br>PCF æ˜¯ç”¨äºéƒ¨ç½²ã€ç®¡ç†å’ŒæŒç»­äº¤ä»˜åº”ç”¨ç¨‹åºã€å®¹å™¨å’Œå‡½æ•°çš„å¤šäº‘å¹³å°ã€‚PCF å…è®¸å¼€å‘äººå‘˜å¿«é€Ÿéƒ¨ç½²å’Œäº¤ä»˜è½¯ä»¶ï¼Œè€Œæ— éœ€ç®¡ç†åº•å±‚åŸºç¡€æ¶æ„ã€‚</p>
<p>Pivotal Cloud Foundry<br>Pivotal Cloud Foundryï¼ˆPCFï¼‰æ˜¯ä¸€ä¸ªå¼€æºã€å¤šäº‘çš„åº”ç”¨ç¨‹åºå¹³å°å³æœåŠ¡ï¼ˆPaaSï¼‰ï¼Œç”± 501 ç»„ç»‡ Cloud Foundry Foundation ç®¡ç†ã€‚è¯¥è½¯ä»¶æœ€åˆç”± VMware å¼€å‘ï¼Œä½†ä¹‹åè½¬ç§»åˆ°äº† Pivotal Softwareã€‚éšç€ VMware äº 2019 å¹´åº•æ”¶è´­ Pivotalï¼Œå®ƒä¹Ÿé‡æ–°å›åˆ°äº† VMwareã€‚<br>PCF æ˜¯ç”¨äºéƒ¨ç½²ã€ç®¡ç†å’ŒæŒç»­äº¤ä»˜åº”ç”¨ç¨‹åºã€å®¹å™¨å’Œå‡½æ•°çš„å¤šäº‘å¹³å°ã€‚PCF å…è®¸å¼€å‘äººå‘˜å¿«é€Ÿéƒ¨ç½²å’Œäº¤ä»˜è½¯ä»¶ï¼Œè€Œæ— éœ€ç®¡ç†åº•å±‚åŸºç¡€æ¶æ„ã€‚</p>
<ol start="9">
<li>å®¹å™¨è°ƒåº¦ç¨‹åº<br>å®¹å™¨è°ƒåº¦ç¨‹åºçš„ä¸»è¦ä»»åŠ¡æ˜¯åœ¨æœ€åˆé€‚çš„ä¸»æœºä¸Šå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚å®ƒå¿…é¡»å…·å¤‡è‡ªåŠ¨æ•…éšœè½¬ç§»èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨æ•°æ®å¤ªå¤šï¼Œå•ä¸ªå®ä¾‹æ— æ³•å¤„ç† / è®¡ç®—æ—¶æ‰©å±•å®¹å™¨ã€‚<br>ä¸‰ç§æœ€å—æ¬¢è¿çš„å®¹å™¨è°ƒåº¦ç¨‹åºåˆ†åˆ«æ˜¯ Docker Swarmã€Apache Mesos å’Œ Kubernetesã€‚</li>
</ol>
<p>Docker Swarm<br>DockerSwarm æ˜¯ Docker å¼€å‘çš„å®¹å™¨è°ƒåº¦ç¨‹åºã€‚ç”± Docker å¼€å‘çš„è¿™ä¸ªé›†ç¾¤è§£å†³æ–¹æ¡ˆæä¾›äº†å¾ˆå¤šä¼˜åŠ¿ï¼Œæ¯”å¦‚è¯´å®ƒä½¿ç”¨äº†æ ‡å‡†çš„ Docker APIã€‚Swarm çš„æ¶æ„ç”±ä¸¤å¤§å…ƒç´ ç»„æˆï¼š</p>
<p>Apache Mesos å’Œ Mesosphere Marathon<br>Mesos çš„ç›®çš„æ˜¯å»ºç«‹ä¸€ä¸ªå¯æ‰©å±•ä¸”é«˜æ•ˆçš„ç³»ç»Ÿï¼Œä»¥æ”¯æŒå½“å‰å’Œå°†æ¥çš„å„ç§æ¡†æ¶ã€‚è¿™ä¹Ÿæ˜¯ä¸»è¦é—®é¢˜æ‰€åœ¨ï¼šHadoop å’Œ MPI ä¹‹ç±»çš„æ¡†æ¶éƒ½æ˜¯ç‹¬ç«‹å¼€å‘çš„ï¼Œå› æ­¤æ— æ³•åœ¨å„ä¸ªæ¡†æ¶ä¹‹é—´è¿›è¡Œç»†ç²’åº¦çš„å…±äº«ã€‚<br>Mesos çš„å¯¹ç­–æ˜¯æ·»åŠ ä¸€ä¸ªèµ„æºå…±äº«è–„å±‚ï¼Œä¸ºæ¡†æ¶æä¾›è®¿é—®é›†ç¾¤èµ„æºçš„å…¬å…±æ¥å£ã€‚Mesos æ­£åœ¨å°†å¯¹è°ƒåº¦çš„æ§åˆ¶æƒå§”æ´¾ç»™æ¡†æ¶ï¼Œå› ä¸ºè®¸å¤šæ¡†æ¶å·²ç»å®ç°äº†å¤æ‚çš„è°ƒåº¦æœºåˆ¶ã€‚<br>æ ¹æ®è¦åœ¨é›†ç¾¤ä¸Šè¿è¡Œçš„ä½œä¸šç±»å‹å¯ä»¥å°†æ¡†æ¶åˆ†ä¸ºå››ç±»ï¼Œå…¶ä¸­ä¸€äº›å…·æœ‰ Marathon ä¹‹ç±»çš„åŸç”Ÿ Docker æ”¯æŒã€‚Mesos 0.20.0 ä¸­æ·»åŠ äº†å¯¹ Docker å®¹å™¨çš„æ”¯æŒã€‚<br>æˆ‘ä»¬å°†é‡ç‚¹ä»‹ç» Mesos ä¸ Marathon çš„æ­é…ç”¨æ³•ï¼Œå› ä¸ºåè€…æ˜¯ Mesosphere ç§¯æç»´æŠ¤çš„æ¡†æ¶ï¼Œåœ¨è°ƒåº¦æ–¹é¢æä¾›äº†è®¸å¤šåŠŸèƒ½ï¼Œå¦‚çº¦æŸã€è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€æœåŠ¡å‘ç°å’Œè´Ÿè½½å¹³è¡¡ç­‰ã€‚</p>
<p>å¦‚å›¾æ‰€è§ï¼Œé›†ç¾¤ä¸­æœ‰å››ä¸ªå…ƒç´ ã€‚ZooKeeper å¸®åŠ© Marathon æŸ¥æ‰¾ Mesos master çš„åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªå®ä¾‹æ¥å¤„ç†æ•…éšœã€‚<br>Marathon è´Ÿè´£å¯åŠ¨ã€ç›‘è§†å¹¶æ‰©å±•å®¹å™¨ã€‚Mesos master å°†åˆ†é…ç»™èŠ‚ç‚¹çš„ä»»åŠ¡å‘é€ç»™ Marathonï¼Œå¹¶åœ¨èŠ‚ç‚¹å…·æœ‰ä¸€äº›å¯ç”¨çš„ CPU/RAM æ—¶å‘ Marathon æå‡ºè¦çº¦ã€‚Mesos slaves è´Ÿè´£è¿è¡Œå®¹å™¨å¹¶æäº¤è‡ªèº«å¯ç”¨èµ„æºçš„åˆ—è¡¨ã€‚</p>
<p>Kubernetes<br>Kubernetes æ˜¯ç”¨äº Docker å®¹å™¨çš„ç¼–æ’ç³»ç»Ÿï¼Œä½¿ç”¨æ ‡ç­¾å’Œ pods çš„æ¦‚å¿µå°†å®¹å™¨åˆ†ä¸ºè®¸å¤šé€»è¾‘å•å…ƒã€‚Pod æ˜¯ Kubernetes ä¸å…¶ä»–ä¸¤ç§è§£å†³æ–¹æ¡ˆä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ‰€åœ¨â€”â€”å®ƒä»¬æ˜¯ä½äºåŒä¸€åœ°ç‚¹çš„å®¹å™¨çš„é›†åˆï¼Œå…±åŒç»„æˆéƒ¨ç½²å’Œè°ƒåº¦æœåŠ¡ã€‚ä¸åŸºäºåŸºäºç›¸ä¼¼æ€§çš„å®¹å™¨ååŒè°ƒåº¦æœºåˆ¶ï¼ˆå¦‚ Swarm å’Œ Mesosï¼‰ç›¸æ¯”ï¼Œè¿™ç§æ–¹æ³•ç®€åŒ–äº†é›†ç¾¤çš„ç®¡ç†ã€‚<br>Kubernetes è°ƒåº¦ç¨‹åºçš„ä»»åŠ¡æ˜¯ç›‘è§† PodSpec ä¸ºç©ºçš„ Podã€‚NodeName èµ‹äºˆä¸€ä¸ªå€¼ï¼Œä»¥å°†å®¹å™¨è°ƒåº¦åœ¨é›†ç¾¤ä¸­çš„æŸä¸ªä½ç½®ã€‚<br>è¿™æ˜¯ä¸ Swarm å’Œ Mesos ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå› ä¸º Kubernetes å…è®¸å¼€å‘äººå‘˜åœ¨è¿è¡Œ Pod æ—¶é€šè¿‡å®šä¹‰ PodSpec.NodeName æ¥ç»•è¿‡è°ƒåº¦ç¨‹åºã€‚<br>è°ƒåº¦ç¨‹åºä½¿ç”¨è°“è¯å’Œä¼˜å…ˆçº§æ¥å®šä¹‰å®¹å™¨åº”è¿è¡Œçš„èŠ‚ç‚¹ã€‚è¿™äº›å‚æ•°çš„é»˜è®¤å€¼å¯ä»¥ä½¿ç”¨æ–°çš„è°ƒåº¦ç¨‹åºç­–ç•¥é…ç½®è¦†ç›–ã€‚<br>å¦‚æœä½¿ç”¨å‘½ä»¤è¡Œæ ‡å¿— policy-config-file æŒ‡å‘æè¿°å¯åŠ¨ Kubernetes æ—¶è¦ä½¿ç”¨çš„è°“è¯å’Œä¼˜å…ˆçº§çš„ JSON æ–‡ä»¶ï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šä½¿ç”¨ç®¡ç†å‘˜å®šä¹‰çš„ç­–ç•¥ã€‚</p>
<ol start="10">
<li>ç›‘æ§å’Œè®°å½•å·¥å…·<br>ç›‘æ§å’Œè®°å½•å·¥å…·ä¸»è¦æ˜¯ä¸ºäº†åœ¨å‘ç”Ÿæ•…éšœæ—¶å¿«é€Ÿå“åº”ï¼Œå¿«é€Ÿæ¢å¤ï¼ŒåŒæ—¶å‡å°‘äº‹æ•…æœŸé—´çš„äººå‘˜å‚ä¸ã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„ç›‘æ§å’Œè®°å½•å·¥å…·åŒ…æ‹¬ ELK Stackã€Datadogã€New Relicã€Prometheusã€Zipkin å’Œ Azure Monitorã€‚</li>
</ol>
<p>ELK Stack<br>ELK Stack æ˜¯ä¸‰ä¸ªå¼€æºäº§å“çš„é›†åˆâ€”â€”å®ƒä»¬åˆ†åˆ«æ˜¯ Elasticsearchã€Logstash å’Œ Kibanaã€‚å®ƒä»¬éƒ½æ˜¯ç”± Elastic å…¬å¸å¼€å‘ã€ç®¡ç†å’Œç»´æŠ¤çš„ã€‚<br>E ä»£è¡¨ ElasticSearchï¼Œç”¨äºå­˜å‚¨æ—¥å¿—<br>L ä»£è¡¨ Logstashï¼Œç”¨äºä¼ è¾“ã€å¤„ç†å’Œå­˜å‚¨æ—¥å¿—<br>K ä»£è¡¨ Kibanaï¼Œæ˜¯ä¸€ç§å¯è§†åŒ–å·¥å…·ï¼ˆWeb ç•Œé¢ï¼‰</p>
<p>Datadog<br>Datadog æ˜¯é’ˆå¯¹äº‘è§„æ¨¡åº”ç”¨ç¨‹åºçš„ç›‘è§†æœåŠ¡ï¼Œå¯é€šè¿‡åŸºäº SaaS çš„æ•°æ®åˆ†æå¹³å°æ¥ç›‘è§†æœåŠ¡å™¨ã€æ•°æ®åº“ã€å·¥å…·å’ŒæœåŠ¡ã€‚<br>Datadog Application Performance Monitoringï¼ˆAPM æˆ–è·Ÿè¸ªï¼‰å¯ä¸ä½ çš„æ—¥å¿—å’ŒåŸºç¡€æ¶æ„ç›‘è§†å™¨å¹¶ç”¨ï¼Œæä¾›è‡ªåŠ¨ç”Ÿæˆçš„ä»ªè¡¨æ¿ï¼ˆç”¨äºç›‘è§†å…³é”®æŒ‡æ ‡ï¼Œå¦‚è¯·æ±‚é‡å’Œå»¶è¿Ÿï¼‰ä¹ƒè‡³å•ä¸ªè¯·æ±‚çš„è·Ÿè¸ªç»†èŠ‚ï¼Œå¸®åŠ©ä½ æ·±å…¥äº†è§£åº”ç”¨ç¨‹åºçš„æ€§èƒ½è¡¨ç°ã€‚<br>åº”ç”¨ç¨‹åºæ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒDatadog å¯ä»¥åœ¨æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸ŠæŸ¥çœ‹è·Ÿè¸ªï¼Œå¹¶å‘ä½ æ˜¾ç¤ºå…³äºè¯¥è¯·æ±‚çŠ¶å†µçš„è¯¦ç»†ç³»ç»Ÿæ•°æ®ã€‚</p>
<p>New Relic<br>New Relic æ˜¯ä¸€å®¶ä½äºåŠ å·æ—§é‡‘å±±çš„æŠ€æœ¯å…¬å¸ï¼Œè‡´åŠ›äºå¼€å‘åŸºäºäº‘çš„è½¯ä»¶ï¼Œä»¥å¸®åŠ©ç½‘ç«™å’Œåº”ç”¨ç¨‹åºæ‰€æœ‰è€…è·Ÿè¸ªæœåŠ¡æ€§èƒ½ã€‚<br>New Relic å¼€å‘çš„ç”¨äºåº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†ï¼ˆAPMï¼‰çš„è½¯ä»¶åˆ†æäº§å“ï¼Œå¯æä¾›æœ‰å…³ Web åº”ç”¨ç¨‹åºæ€§èƒ½ä»¥åŠæœ€ç»ˆç”¨æˆ·ä½“éªŒæ»¡æ„åº¦çš„å®æ—¶å’Œè¶‹åŠ¿æ•°æ®ã€‚</p>
<p>Prometheus<br>Prometheus æ˜¯ç”¨äºäº‹ä»¶ç›‘è§†å’Œè­¦æŠ¥çš„å…è´¹è½¯ä»¶åº”ç”¨ç¨‹åºã€‚å®ƒå°†å®æ—¶æŒ‡æ ‡è®°å½•åœ¨ä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®åº“ä¸­ï¼Œè¯¥æ•°æ®åº“ä½¿ç”¨ HTTP æ‹‰å–æ¨¡å‹æ„å»ºï¼Œæ”¯æŒçµæ´»æŸ¥è¯¢å’Œå®æ—¶è­¦æŠ¥ã€‚<br>Prometheus æœåŠ¡å™¨çš„å·¥ä½œæ–¹å¼æ˜¯æŠ“å–ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ç›‘è§†å™¨ä¸Šé…ç½®çš„å„ä¸ªèŠ‚ç‚¹çš„æŒ‡æ ‡ç«¯ç‚¹ã€‚å®ƒå®šæœŸæ”¶é›†è¿™äº›æŒ‡æ ‡å¹¶å°†å…¶å­˜å‚¨åœ¨æœ¬åœ°ã€‚èŠ‚ç‚¹åœ¨ Prometheus æœåŠ¡å™¨æŠ“å–çš„ç«¯ç‚¹ä¸Šå…¬å¼€è¿™äº›æŒ‡æ ‡ã€‚</p>
<p>Zipkin<br>Zipkin æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿã€‚å®ƒèƒ½æ”¶é›†ç”¨æ¥è§£å†³æœåŠ¡æ¶æ„ä¸­å»¶è¿Ÿé—®é¢˜æ‰€éœ€çš„æ—¶åºæ•°æ®ã€‚å…¶åŠŸèƒ½åŒ…æ‹¬æ”¶é›†å’ŒæŸ¥æ‰¾è¿™ç±»æ•°æ®ã€‚<br>å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸­æœ‰è·Ÿè¸ª IDï¼Œåˆ™ä½ å¯ä»¥ç›´æ¥è·³è‡³è¯¥è·Ÿè¸ª IDã€‚å¦åˆ™ï¼Œä½ å¯ä»¥åŸºäºå±æ€§æ¥æŸ¥è¯¢ï¼Œå¯ç”¨å±æ€§åŒ…æ‹¬æœåŠ¡ã€æ“ä½œåç§°ã€tagsm å’ŒæŒç»­æ—¶é—´ç­‰ã€‚ç³»ç»Ÿä¼šä¸ºä½ æ€»ç»“ä¸€äº›æœ‰è¶£çš„æ•°æ®ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªæœåŠ¡ä¸­èŠ±è´¹çš„æ—¶é—´ç™¾åˆ†æ¯”ï¼Œä»¥åŠæ“ä½œæ˜¯å¦å¤±è´¥ç­‰ã€‚</p>
<p>Azure Monitor<br>Azure Monitor æä¾›äº†ä¸€ä¸ªå…¨é¢çš„è§£å†³æ–¹æ¡ˆï¼Œä»ä½ çš„äº‘å’Œæœ¬åœ°ç¯å¢ƒä¸­æ”¶é›†ã€åˆ†ææ•°æ®å’Œæ‰§è¡Œé¥æµ‹ä»»åŠ¡ï¼Œä»è€Œæœ€å¤§ç¨‹åº¦åœ°æé«˜åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚<br>å®ƒå¯ä»¥å¸®åŠ©ä½ äº†è§£åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œå¹¶ä¸»åŠ¨è¯†åˆ«å½±å“å®ƒä»¬çš„é—®é¢˜ä»¥åŠå®ƒä»¬æ‰€ä¾èµ–çš„èµ„æºã€‚<br>ä½ å¯ä»¥ä½¿ç”¨ Azure Monitor åšå¾ˆå¤šäº‹æƒ…ï¼Œä¾‹å¦‚ï¼š<br>ä½¿ç”¨ Application Insights æ£€æµ‹å’Œè¯Šæ–­è·¨åº”ç”¨ç¨‹åºå’Œä¾èµ–é¡¹çš„é—®é¢˜<br>å°†åŸºç¡€æ¶æ„é—®é¢˜ä¸åˆ†åˆ«é€‚ç”¨äº VM/ å®¹å™¨çš„ AzureMonitor ç›¸å…³è”<br>ä½¿ç”¨ Log Analytics æ·±åº¦åˆ†æç›‘è§†æ•°æ®ï¼Œä»¥è¿›è¡Œæ•…éšœæ’é™¤å’Œæ·±åº¦è¯Šæ–­<br>é€šè¿‡æ™ºèƒ½è­¦æŠ¥å’Œè‡ªåŠ¨åŒ–æ“ä½œæ”¯æŒå¤§è§„æ¨¡è¿è¥<br>ä½¿ç”¨ Azure ä»ªè¡¨æ¿å’Œå·¥ä½œç°¿åˆ›å»ºå¯è§†åŒ–å†…å®¹</p>
<ol start="11">
<li>é€šè®¯å·¥å…·<br>é€šè®¯å·¥å…·ä¸»è¦æ˜¯ç”¨äºå¤šå›¢é˜Ÿæ²Ÿé€šï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼Œæ”¹å–„åä½œèƒ½åŠ›ã€‚ç›®å‰ä¸šå†…æ¯”è¾ƒå¸¸ç”¨çš„é€šè®¯å·¥å…·åŒ…æ‹¬ Slackã€Microsoft Teamsã€Google Hangouts å’Œ Zoomã€‚</li>
</ol>
<p>Slack<br>Slack æ˜¯ Slack Technologies å¼€å‘çš„ä¸“ç”¨å³æ—¶æ¶ˆæ¯å¹³å°ã€‚<br>Slack æœ¬è´¨ä¸Šæ˜¯æ•´ä¸ªå…¬å¸çš„èŠå¤©å®¤ï¼Œæ—¨åœ¨å–ä»£ç”µå­é‚®ä»¶ä½œä¸ºä½ äº¤æµå’Œå…±äº«ä¿¡æ¯çš„ä¸»è¦æ–¹æ³•ã€‚å®ƒçš„å·¥ä½œç©ºé—´ä½¿ä½ å¯ä»¥æŒ‰é¢‘é“æ¥ç»„ç»‡å°ç»„è®¨è®ºï¼Œå¹¶æ”¯æŒç§ä¿¡åŠŸèƒ½ï¼Œå¯ä»¥ä¸€ç«™å¼å…±äº«ä¿¡æ¯å’Œæ–‡ä»¶ç­‰ã€‚</p>
<p>Microsoft Teams<br>Microsoft Teams æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„é€šä¿¡å’Œåä½œå¹³å°ï¼Œæä¾›äº†å¯é çš„å·¥ä½œèŠå¤©ã€è§†é¢‘ä¼šè®®ã€æ–‡ä»¶å­˜å‚¨å’Œåº”ç”¨ç¨‹åºé›†æˆç‰¹æ€§ã€‚<br>Teams æ˜¯åŸºäºèŠå¤©çš„åä½œå·¥å…·ï¼Œå¯ä¸ºè·¨è¶Šå…¨çƒã€è¿œç¨‹å’Œåˆ†æ•£çš„å›¢é˜Ÿæä¾›åœ¨ä¸€ä¸ªå…¬å…±ç©ºé—´å…±åŒå·¥ä½œå’Œå…±äº«ä¿¡æ¯çš„èƒ½åŠ›ã€‚å®ƒæœ‰ä¸€äº›å¾ˆé…·çš„åŠŸèƒ½ï¼Œå¦‚æ–‡æ¡£åä½œã€ä¸€å¯¹ä¸€èŠå¤©å’Œå›¢é˜ŸèŠå¤©ç­‰ç­‰ã€‚</p>
<p>Google Hangouts<br>Google Hangouts æ˜¯è°·æ­Œå¼€å‘çš„ä¸€ç§é€šè®¯è½¯ä»¶äº§å“ã€‚Hangouts æœ€åˆæ˜¯ Google+ çš„åŠŸèƒ½ï¼Œåæ¥åœ¨ 2013 å¹´æˆä¸ºç‹¬ç«‹äº§å“ï¼Œå½“æ—¶è°·æ­Œä¹Ÿå¼€å§‹å°† Google+ Messenger å’Œ Google Talk çš„åŠŸèƒ½é›†æˆåˆ° Hangouts ä¸­ã€‚<br>Hangouts Chat æ˜¯ä¸€ç§ä¸ç»„ç»‡ä¸­çš„æˆå‘˜äº¤æµçš„æœ‰æ•ˆæ–¹æ³•ã€‚ä½ å¯ä»¥å‘ä¸€ä½æˆ–å¤šä½åŒäº‹å‘é€æ¶ˆæ¯ï¼Œåˆ›å»ºç©ºé—´æ¥ä¸å¤šäººå¼€å§‹æŒç»­ä¼šè¯ï¼Œå¹¶ä½¿ç”¨æœºå™¨åŠ©æ‰‹æ¥å¸®åŠ©ä½ è‡ªåŠ¨åŒ–æ“ä½œã€‚Chat å¯åœ¨ä½ çš„è®¡ç®—æœºæµè§ˆå™¨ä»¥åŠé€‚ç”¨äº Android å’Œ iOS çš„ç§»åŠ¨åº”ç”¨ä¸­ä½¿ç”¨ã€‚</p>
<p>Zoom<br>Zoom Video Communications æ˜¯ä¸€å®¶è¿œç¨‹ä¼šè®®æœåŠ¡å…¬å¸ï¼Œæ€»éƒ¨ä½äºåŠ å·åœ£ä½•å¡ã€‚å®ƒæä¾›äº†å°†è§†é¢‘ä¼šè®®ã€åœ¨çº¿ä¼šè®®ã€èŠå¤©å’Œç§»åŠ¨åä½œç»“åˆåœ¨ä¸€èµ·çš„è¿œç¨‹ä¼šè®®æœåŠ¡ã€‚<br>å¯¹äºå¯»æ±‚æ•´ä½“ä¸šåŠ¡è§£å†³æ–¹æ¡ˆçš„å›¢é˜Ÿæ¥è¯´ï¼ŒSkype æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚Zoom éå¸¸é€‚åˆç»å¸¸è¿›è¡Œè§†é¢‘èŠå¤©å’Œä¼šè®®çš„å›¢é˜Ÿã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ç§å·¥å…·éƒ½ä¸æ˜¯ä¸“é—¨ä¸ºè¿œç¨‹å·¥ä½œè€Œæ„å»ºçš„ã€‚</p>
<ol start="12">
<li>çŸ¥è¯†å…±äº«å·¥å…·<br>çŸ¥è¯†å…±äº«å·¥å…·ä¸»è¦æ˜¯ä¸ºäº†æé«˜æ–°å‘˜å·¥çš„ç”Ÿäº§åŠ›ï¼Œå‡å°‘é‡å¤é”™è¯¯ã€‚ç›®å‰æ¯”è¾ƒå¸¸ç”¨çš„çŸ¥è¯†å…±äº«å·¥å…·åŒ…æ‹¬ GitHub Pagesã€Confluenceã€Jekyll å’Œ Google Sitesã€‚</li>
</ol>
<p>GitHub Pages<br>GitHub Pages æ˜¯ä¸€ç§é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼Œå¯ç›´æ¥ä» GitHub ä¸Šçš„å­˜å‚¨åº“ä¸­è·å– HTMLã€CSS å’Œ JavaScript æ–‡ä»¶ï¼Œè¿˜å¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿è¡Œè¿™äº›æ–‡ä»¶å¹¶å‘å¸ƒç½‘ç«™ã€‚ä½ å¯ä»¥åœ¨ GitHub Pages ç¤ºä¾‹é›†åˆä¸­æŸ¥çœ‹ GitHub Pages ç½‘ç«™çš„ç¤ºä¾‹ã€‚</p>
<p>Confluence<br>Confluence æ˜¯ Atlassian å¼€å‘å’Œå‘è¡Œçš„åä½œè½¯ä»¶ç¨‹åºã€‚Atlassian ç”¨ Java ç¼–ç¨‹è¯­è¨€ç¼–å†™äº† Confluenceï¼Œå¹¶äº 2004 å¹´é¦–æ¬¡å‘å¸ƒã€‚<br>Confluence æ˜¯ä¸€ä¸ªåä½œ Wiki å·¥å…·ï¼Œç”¨äºå¸®åŠ©å›¢é˜Ÿæœ‰æ•ˆåœ°åä½œå’Œå…±äº«çŸ¥è¯†ã€‚å€ŸåŠ© Confluenceï¼Œä½ å¯ä»¥åœ¨ Team Calendars é™„åŠ ç»„ä»¶çš„å¸®åŠ©ä¸‹æ•è·é¡¹ç›®éœ€æ±‚ã€å‘ç‰¹å®šç”¨æˆ·åˆ†é…ä»»åŠ¡ï¼Œè¿˜èƒ½ä¸€æ¬¡ç®¡ç†å¤šä¸ªæ—¥å†ã€‚</p>
<p>Jekyll<br>Jekyll æ˜¯ä¸€ä¸ªç®€å•çš„ï¼Œåšå®¢å‹çš„é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œå¯ç”¨äºä¸ªäººã€é¡¹ç›®æˆ–ç»„ç»‡çš„ç½‘ç«™ç”Ÿæˆã€‚å®ƒæ˜¯ç”± GitHub çš„è”åˆåˆ›å§‹äºº Tom Preston-Werner ç”¨ Ruby ç¼–å†™çš„ï¼Œæ ¹æ®å¼€æº MIT è®¸å¯å‘è¡Œã€‚<br>Jekyll æ˜¯ä¸€ä¸ªè§£æå¼•æ“ï¼Œæ‰“åŒ…ä¸ºä¸€ä¸ª Ruby gemï¼Œç”¨æ¥ä»åŠ¨æ€ç»„ä»¶ï¼ˆä¾‹å¦‚æ¨¡æ¿ã€éƒ¨ä»¶ã€æ¶²æ€ä»£ç ã€markdown ç­‰ï¼‰æ„å»ºé™æ€ç½‘ç«™ã€‚Jekyll è¢«ç§°ä¸ºâ€œç®€å•ã€åšå®¢å‹çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨â€ã€‚</p>
<p>Google Sites<br>Google Sites æ˜¯è°·æ­Œæä¾›çš„ç»“æ„åŒ– Wiki å’Œç½‘é¡µåˆ›å»ºå·¥å…·ã€‚Google Sites å®£ç§°çš„ç›®æ ‡æ˜¯è®©ä»»ä½•äººéƒ½èƒ½å¤Ÿåˆ›å»ºè®©ä¸åŒç¼–è¾‘è€…åä½œçš„ç®€å•ç½‘ç«™ã€‚<br>ä½ ä»¬å¯ä»¥ä¸€èµ·ç”¨å®ƒä¸ºå›¢é˜Ÿã€é¡¹ç›®æˆ–æ´»åŠ¨åˆ›å»ºå¼•äººå…¥èƒœçš„é«˜è´¨é‡ç«™ç‚¹ã€‚è¿™äº›ç½‘ç«™åœ¨å„ç§è®¾å¤‡çš„å±å¹•ä¸Šçœ‹èµ·æ¥éƒ½å¾ˆæ¼‚äº®â€”â€”æ‰€æœ‰è¿™äº›å·¥ä½œéƒ½æ— éœ€å­¦ä¹ è®¾è®¡æˆ–ç¼–ç¨‹çŸ¥è¯†ã€‚</p>
<ol start="13">
<li>å°ç»“<br>æœ¬æ–‡ä»‹ç»æ•´ä¸ª DevOps å·¥å…·é“¾â€”â€”åŒ…æ‹¬è§„åˆ’å·¥å…·ã€é—®é¢˜è·Ÿè¸ªå·¥å…·ã€æºä»£ç ç®¡ç†ã€æ„å»ºå’Œæµ‹è¯•ä»£ç ã€æŒç»­é›†æˆå’Œéƒ¨ç½²æºä»£ç ã€ç®¡ç†é…ç½®ã€ä½¿ç”¨äº‘å¹³å°ã€ç›‘æ§å’Œè®°å½•ç­‰å·¥å…·ï¼Œåé¢è¿˜æœ‰æ²Ÿé€šå’ŒçŸ¥è¯†å…±äº«è¿™äº›è½¯å·¥å…·çš„ä»‹ç»ã€‚<br>DevOps æ˜¯ä¸€ç§ä»¤äººå…´å¥‹çš„å·¥ä½œæ–¹å¼ã€‚è¿™ä¸æ˜¯å”¯ä¸€å¯è¡Œçš„æ–¹æ³•ï¼Œç”šè‡³å¯èƒ½ä¸æ˜¯æœ€å¥½çš„æ–¹æ³•ï¼Œå°†æ¥å¯èƒ½ä¼šå‡ºç°æ›´å¥½çš„é€‰æ‹©ã€‚ä½†å°±ç›®å‰è€Œè¨€ï¼Œè¿™æ˜¯ä¸€ç§å›¢é˜Ÿé›†ä½“åˆä½œï¼Œä¸”æ˜¯é€šè¿‡å¯æŒ</li>
</ol>
<h2 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h2><p><a href="https://medium.com/better-programming/the-devops-toolchain-a56713179700" target="_blank" rel="noopener">https://medium.com/better-programming/the-devops-toolchain-a56713179700</a></p>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonå°æŠ€å·§</title>
    <url>/2020/04/29/python%E5%B0%8F%E6%8A%80%E5%B7%A7/</url>
    <content><![CDATA[<blockquote class="blockquote-center"><p>æ¯å¤©æ—©æ™¨æ´—ä¸€éè„‘å­ç‰¹å¹¶æ¸…é†’ </p>
</blockquote>

<ol>
<li><p>List: all_equal<br>åŠŸèƒ½å®ç°: æ£€éªŒä¸€ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½ä¸€æ ·</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def all_equal(lst):</span><br><span class="line">    return lst[1:] &#x3D;&#x3D; lst[:-1]</span><br><span class="line"></span><br><span class="line">ret &#x3D; all_equal([1, 2, 3, 4, 5, 6])</span><br><span class="line"></span><br><span class="line">ret2 &#x3D; all_equal([1, 1, 1, 1])</span><br><span class="line"></span><br><span class="line">print(ret, ret2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># True False</span><br></pre></td></tr></table></figure>
</li>
<li><p>List: all_unique<br>åŠŸèƒ½å®ç°: å¦‚æœåˆ—è¡¨æ‰€æœ‰å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œè¿”å›True, å¦åˆ™è¿”å›False</p>
<blockquote>
<p>è§£è¯»: åœ¨ç»™å®šåˆ—è¡¨ä¸Šä½¿ç”¨é›†åˆset()å»é‡, æ¯”è¾ƒå®ƒå’ŒåŸåˆ—è¡¨çš„é•¿åº¦</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def all_unique(lst):</span><br><span class="line">    return len(lst) &#x3D;&#x3D; len(set(lst))</span><br><span class="line"></span><br><span class="line"># ä¸¾ä¾‹:</span><br><span class="line">x &#x3D; [1, 2, 3, 4, 5, 6]</span><br><span class="line">y &#x3D; [1, 2, 2, 3, 4, 5]</span><br><span class="line">z &#x3D; all_unique(x)</span><br><span class="line">b &#x3D; all_unique(y)</span><br><span class="line">print(z, b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># True False</span><br></pre></td></tr></table></figure>
</li>
<li><p>List: bifucate<br>åŠŸèƒ½å®ç°: å°†åˆ—è¡¨å€¼åˆ†ç»„ã€‚å¦‚æœfilterçš„å…ƒç´ æ˜¯True, é‚£ä¹ˆå¯¹åº”çš„å…ƒç´ å±äºç¬¬ä¸€ä¸ªç»„,å¦åˆ™å±äºç¬¬äºŒä¸ªç»„<br>è§£è¯»: ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼å’Œenumerate()åŸºäºfiterå…ƒç´ åˆ°å„ç»„</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def bifurcate(lst, filter):</span><br><span class="line">    return [</span><br><span class="line">        [x for i, x in enumerate(lst) if filter[i] &#x3D;&#x3D; True],</span><br><span class="line">        [x for i, x in enumerate(lst) if filter[i] &#x3D;&#x3D; False]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">r &#x3D; bifurcate([&quot;beep&quot;, &quot;boop&quot;, &quot;foo&quot;, &quot;bar&quot;], [True, True, False, True])</span><br><span class="line"># [[&#39;beep&#39;, &#39;boop&#39;, &#39;bar&#39;], [&#39;foo&#39;]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>List: difference<br>åŠŸèƒ½å®ç°: è¿”å›ä¸¤ä¸ªiterablesé—´çš„å·®å¼‚<br>è§£è¯»: åˆ›å»ºbçš„é›†åˆï¼Œä½¿ç”¨açš„åˆ—è¡¨æ¨å¯¼å¼ä¿ç•™ä¸åœ¨_bä¸­çš„å…ƒç´ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def difference(a, b):</span><br><span class="line">    _b &#x3D; set(b)</span><br><span class="line">    return [item for item in a if item not in _b]</span><br><span class="line"></span><br><span class="line">print(difference([1, 2, 3], [1, 2, 4]))</span><br><span class="line"></span><br><span class="line"># [3]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Math: digitize<br>åŠŸèƒ½å®ç°: å°†ä¸€ä¸ªæ•°åˆ†è§£è½¬æ¢ä¸ºä¸ªä½æ•°å­—<br>è§£è¯»: å°†nå­—ç¬¦åŒ–åä½¿ç”¨map()å‡½æ•°ç»“åˆintå®Œæˆè½¬åŒ–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def digitize(n):</span><br><span class="line">    return list(map(int, str(n)))</span><br><span class="line"></span><br><span class="line">print(digitize(123))</span><br><span class="line"># [1,2,3]</span><br></pre></td></tr></table></figure>
</li>
<li><p>List: shuffle<br>åŠŸèƒ½å®ç°: å°†åˆ—è¡¨å…ƒç´ é¡ºåºéšæœºæ‰“ä¹±<br>è§£è¯»: ä½¿ç”¨Fisher-Yatesç®—æ³•é‡æ–°æ’åºåˆ—è¡¨å…ƒç´ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from copy import deepcopy</span><br><span class="line">from random import randint</span><br><span class="line"></span><br><span class="line">def shuffle(lst):</span><br><span class="line">    temp_lst &#x3D; deepcopy(lst)</span><br><span class="line">    m &#x3D; len(temp_lst)</span><br><span class="line">    while (m):</span><br><span class="line">        m -&#x3D; 1</span><br><span class="line">        i &#x3D; randint(0, m)</span><br><span class="line">        temp_lst[m], temp_lst[i] &#x3D; temp_lst[i], temp_lst[m]</span><br><span class="line">    return temp_lst</span><br><span class="line"></span><br><span class="line">foo &#x3D; [1, 2, 3]</span><br><span class="line">print(shuffle(foo))</span><br><span class="line"></span><br><span class="line"># [2, 1, 3]</span><br></pre></td></tr></table></figure>
</li>
<li><p>Math: clamp_number<br>åŠŸèƒ½å®ç°: å°†æ•°å­—numåµŒåœ¨ç”±aå’Œbè¾¹ç•Œå€¼è§„å®šçš„èŒƒå›´ä¸­<br>è§£è¯»: å¦‚æœnumè½å°½èŒƒå›´å†…,è¿”å›num å¦åˆ™ï¼Œè¿”å›èŒƒå›´å†…æœ€æ¥è¿‘çš„æ•°å­—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def clamp_number(num, a, b):</span><br><span class="line">    return max(min(num, max(a, b)), min(a, b))</span><br><span class="line"></span><br><span class="line">a &#x3D; clamp_number(2, 3, 5)</span><br><span class="line">b &#x3D; clamp_number(1, -1, -5)</span><br><span class="line">print(a, b)</span><br><span class="line"></span><br><span class="line"># 3 -1</span><br></pre></td></tr></table></figure>
</li>
<li><p>String: byte_size<br>åŠŸèƒ½å®ç°: è¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°<br>è§£è¯»: ä½¿ç”¨String.encode(â€˜utf-8â€™) è§£ç ç»™å®šå­—ç¬¦ä¸², è¿”å›é•¿åº¦</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def byte_size(string):</span><br><span class="line">    return len(string.encode(&#39;utf-8&#39;))</span><br><span class="line"></span><br><span class="line"># print(byte_size(&#39;ğŸ˜€&#39;)) # 4</span><br><span class="line"># print(byte_size(&#39;Hello World&#39;)) # 11</span><br></pre></td></tr></table></figure>
</li>
<li><p>Math: gcd<br>åŠŸèƒ½å®ç°: è®¡ç®—å‡ ä¸ªæ•°çš„æœ€å¤§å…¬å› æ•°<br>è§£è¯»: ä½¿ç”¨reduce()å’Œmath.gcdåœ¨ç»™å®šåˆ—è¡¨ä¸Šå®ç°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from functools import reduce</span><br><span class="line">import math</span><br><span class="line"></span><br><span class="line">def gcd(numbers):</span><br><span class="line">    return reduce(math.gcd, numbers)</span><br><span class="line"></span><br><span class="line">print(gcd([8, 36, 28]))  # 4</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>è®©äººæƒ³éª‚è¡—çš„ Python ç‚«æŠ€æ“ä½œï¼šæ¡ä»¶è¯­å¥çš„ä¸ƒç§å†™æ³•</title>
    <url>/2020/04/20/%E8%AE%A9%E4%BA%BA%E6%83%B3%E9%AA%82%E8%A1%97%E7%9A%84-Python-%E7%82%AB%E6%8A%80%E6%93%8D%E4%BD%9C%EF%BC%9A%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%E7%9A%84%E4%B8%83%E7%A7%8D%E5%86%99%E6%B3%95/</url>
    <content><![CDATA[<p>æœ‰çš„äººè¯´ Python æ˜¯ä¸€é—¨å…¥é—¨å®¹æ˜“ï¼Œä½†æ˜¯ç²¾é€šéš¾çš„è¯­è¨€ï¼Œè¿™ä¸€ç‚¹æˆ‘éå¸¸èµåŒã€‚</p>
<p>Python è¯­è¨€é‡Œæœ‰è®¸å¤šï¼ˆè€Œä¸”æ˜¯è¶Šæ¥è¶Šå¤šï¼‰çš„é«˜çº§ç‰¹æ€§ï¼Œæ˜¯ Python å‘çƒ§å‹ä»¬éå¸¸å–œæ¬¢çš„ã€‚åœ¨è¿™äº›äººçš„çœ¼é‡Œï¼Œèƒ½å¤Ÿå†™å‡ºé‚£äº›ä¸€èˆ¬å¼€å‘è€…çœ‹ä¸æ‡‚çš„é«˜çº§ç‰¹æ€§ï¼Œå°±æ˜¯é«˜æ‰‹ï¼Œå°±æ˜¯å¤§ç¥ã€‚</p>
<p>ä½†ä½ è¦çŸ¥é“ï¼Œåœ¨å›¢é˜Ÿåˆä½œé‡Œï¼Œç‚«æŠ€æ˜¯å¤§å¿Œã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘è¯´ä¸‹è‡ªå·±çš„çœ‹æ³•ï¼š</p>
<p>è¶Šç®€æ´çš„ä»£ç ï¼Œè¶Šæ¸…æ™°çš„é€»è¾‘ï¼Œå°±è¶Šä¸å®¹æ˜“å‡ºé”™ï¼›<br>åœ¨å›¢é˜Ÿåˆä½œä¸­ï¼Œä½ çš„ä»£ç ä¸åªæœ‰ä½ åœ¨ç»´æŠ¤ï¼Œé™ä½åˆ«äººçš„é˜…è¯»/ç†è§£ä»£ç é€»è¾‘çš„æˆæœ¬æ˜¯ä¸€ç§è‰¯å¥½çš„å“å¾·<br>ç®€å•çš„ä»£ç ï¼Œåªä¼šç”¨åˆ°æœ€åŸºæœ¬çš„è¯­æ³•ç³–ï¼Œå¤æ‚çš„é«˜çº§ç‰¹æ€§ï¼Œä¼šæœ‰æ›´å¤šçš„ä¾èµ–ï¼ˆå¦‚è¯­è¨€çš„ç‰ˆæœ¬ï¼‰<br>åœ¨è¿™ä¸ªç³»åˆ—é‡Œï¼Œæˆ‘å°†æ€»ç»“åˆ—ä¸¾ä¸€ä¸‹ï¼Œæˆ‘æ‰€è§è¿‡çš„é‚£äº›ç‚«æŠ€æ“ä½œï¼Œä»Šå¤©å…ˆæ¥ä¸ªçƒ­èº«ï¼Œå†™ä¸€å†™å¾ˆç®€å•çš„æ¡ä»¶åˆ¤æ–­è¯­å¥é‡Œæœ‰å“ªäº›è®©äººæƒ³éª‚è¡—çš„ç‚«æŠ€æ“ä½œï¼Œåœ¨è¿™é‡Œï¼Œå¦‚æœä½ æ˜¯ Python å‘çƒ§å‹ï¼Œä½ å¯ä»¥å­¦åˆ°ä¸€äº›å†™å‡ºè¶…é…·çš„ä»£ç ä¹¦å†™æŠ€å·§ï¼Œä½†å­¦ä¹ å½’å­¦ä¹ ï¼Œå¸Œæœ›ä½ åŒºåˆ†åœºæ™¯ä½¿ç”¨ã€‚</p>
<ol start="0">
<li>åŸä»£ç <br>è¿™æ˜¯ä¸€æ®µéå¸¸ç®€å•çš„é€šè¿‡å¹´é¾„åˆ¤æ–­ä¸€ä¸ªäººæ˜¯å¦æˆå¹´çš„ä»£ç ï¼Œç”±äºä»£ç è¡Œæ•°è¿‡å¤šï¼Œæœ‰äº›äººå°±ä¸å¤ªæ„¿æ„è¿™æ ·å†™ï¼Œå› ä¸ºè¿™ä½“ç°ä¸å‡ºè‡ªå·±å¤šå¹´çš„ Python åŠŸåŠ›ã€‚<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if age &gt; 18:</span><br><span class="line">    return &quot;å·²æˆå¹´&quot;</span><br><span class="line">else:</span><br><span class="line">    return &quot;æœªæˆå¹´&quot;</span><br></pre></td></tr></table></figure>
ä¸‹é¢æˆ‘åˆ—ä¸¾äº†å…­ç§è¿™æ®µä»£ç çš„å˜å¼‚å†™æ³•ï¼Œä¸€ä¸ªæ¯”ä¸€ä¸ªè¿˜ 6 ï¼Œå•ç‹¬æ‹¿å‡ºæ¥æ¯”è¾ƒå¥½ç†è§£ï¼Œæ”¾åœ¨å·¥ç¨‹ä»£ç é‡Œï¼Œæ²¡ç”¨è¿‡è¿™äº›å­¦æ³•çš„äººï¼Œä¸€å®šä¼šçœ‹å¾—ä¸€è„¸æ‡µé€¼ï¼Œç†è§£äº†ä¹‹åï¼Œåˆä¸ç»æ„å¤§å‘¼ï¼šå§æ§½ï¼Œè¿˜å¯ä»¥è¿™æ ·å†™ï¼Ÿï¼Œè€Œåå°±è¦å¼€å§‹éª‚è¡—äº†ï¼šè¿™æ˜¯ç»™äººçœ‹çš„ä»£ç ï¼Ÿ</li>
<li>ç¬¬ä¸€ç§<br>è¯­æ³•:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;on_true&gt; if &lt;condition&gt; else &lt;on_false&gt;</span><br></pre></td></tr></table></figure>
ä¾‹å­<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; age1 &#x3D; 20</span><br><span class="line">&gt;&gt;&gt; age2 &#x3D; 17</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg1 &#x3D; &quot;å·²æˆå¹´&quot; if age1 &gt; 18 else &quot;æœªæˆå¹´&quot;</span><br><span class="line">&gt;&gt;&gt; print msg1</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; &quot;å·²æˆå¹´&quot; if age2 &gt; 18 else &quot;æœªæˆå¹´&quot;</span><br><span class="line">&gt;&gt;&gt; print msg2</span><br><span class="line">æœªæˆå¹´</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬äºŒç§<br>è¯­æ³•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;expression&gt; and &lt;on_true&gt; or &lt;on_false&gt;</span><br></pre></td></tr></table></figure>
ä¾‹å­<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; msg1 &#x3D; age1 &gt; 18 and &quot;å·²æˆå¹´&quot; or &quot;æœªæˆå¹´&quot;</span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; &quot;å·²æˆå¹´&quot; if age2 &gt; 18 else &quot;æœªæˆå¹´&quot;</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; print(msg1)</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; print(msg2)</span><br><span class="line">æœªæˆå¹´</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬ä¸‰ç§<br>è¯­æ³•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&lt;on_true&gt;, &lt;on_false&gt;)[condition]</span><br></pre></td></tr></table></figure>
ä¾‹å­<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; msg1 &#x3D; (&quot;æœªæˆå¹´&quot;, &quot;å·²æˆå¹´&quot;)[age1 &gt; 18]</span><br><span class="line">&gt;&gt;&gt; print(msg1)</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; (&quot;æœªæˆå¹´&quot;, &quot;å·²æˆå¹´&quot;)[age2 &gt; 18]</span><br><span class="line">&gt;&gt;&gt; print(msg2)</span><br><span class="line">æœªæˆå¹´</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬å››ç§<br>è¯­æ³•:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(lambda: &lt;on_false&gt;, lambda:&lt;on_true&gt;)[&lt;condition&gt;]()</span><br></pre></td></tr></table></figure>
ä¾‹å­<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; msg1 &#x3D; (lambda:&quot;æœªæˆå¹´&quot;, lambda:&quot;å·²æˆå¹´&quot;)[age1 &gt; 18]()</span><br><span class="line">&gt;&gt;&gt; print(msg1)</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; (lambda:&quot;æœªæˆå¹´&quot;, lambda:&quot;å·²æˆå¹´&quot;)[age2 &gt; 18]()</span><br><span class="line">&gt;&gt;&gt; print(msg2)</span><br><span class="line">æœªæˆå¹´</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬äº”ç§<br>è¯­æ³•:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;True: &lt;on_true&gt;, False: &lt;on_false&gt;&#125;[&lt;condition&gt;]</span><br></pre></td></tr></table></figure>
ä¾‹å­<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; msg1 &#x3D; &#123;True: &quot;å·²æˆå¹´&quot;, False: &quot;æœªæˆå¹´&quot;&#125;[age1 &gt; 18]</span><br><span class="line">&gt;&gt;&gt; print(msg1)</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; &#123;True: &quot;å·²æˆå¹´&quot;, False: &quot;æœªæˆå¹´&quot;&#125;[age2 &gt; 18]</span><br><span class="line">&gt;&gt;&gt; print(msg2)</span><br><span class="line">æœªæˆå¹´</span><br></pre></td></tr></table></figure></li>
<li>ç¬¬å…­ç§<br>è¯­æ³•:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">((&lt;condition&gt;) and (&lt;on_true&gt;,) or (&lt;on_false&gt;,))[0]</span><br></pre></td></tr></table></figure>
ä¾‹å­:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; msg1 &#x3D; ((age1 &gt; 18) and (&quot;å·²æˆå¹´&quot;,) or (&quot;æœªæˆå¹´&quot;,))[0]</span><br><span class="line">&gt;&gt;&gt; print(msg1)</span><br><span class="line">å·²æˆå¹´</span><br><span class="line">&gt;&gt;&gt; </span><br><span class="line">&gt;&gt;&gt; msg2 &#x3D; ((age2 &gt; 18) and (&quot;å·²æˆå¹´&quot;,) or (&quot;æœªæˆå¹´&quot;,))[0]</span><br><span class="line">&gt;&gt;&gt; print(msg2)</span><br><span class="line">æœªæˆå¹´</span><br></pre></td></tr></table></figure>
ä»¥ä¸Šä»£ç ï¼Œéƒ½æ¯”è¾ƒç®€å•ï¼Œä»”ç»†çœ‹éƒ½èƒ½çœ‹æ‡‚ï¼Œæˆ‘å°±ä¸åšè§£é‡Šäº†ã€‚</li>
</ol>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæœ‰æ²¡æœ‰æ¶¨å§¿åŠ¿äº†ï¼Œå­¦äº†è¿™ä¹ˆä¹…çš„ Python ï¼Œè¿™ä¹ˆå¤šéªšæ“ä½œï¼Œè¿˜çœŸæ˜¯æ´»ä¹…è§ã€‚ã€‚è¿™å…­ç§å†™æ³•é‡Œï¼Œæˆ‘æœ€æ¨èä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ç§ï¼Œè‡ªå·±ä¹Ÿç»å¸¸åœ¨ç”¨ï¼Œç®€æ´ç›´ç™½ï¼Œä»£ç è¡Œè¿˜å°‘ã€‚è€Œå…¶ä»–çš„å†™æ³•è™½ç„¶èƒ½å†™ï¼Œä½†æ˜¯ä¸ä¼šç”¨ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨æˆ‘ä½™ç”Ÿé‡Œç¢°åˆ°ä¼šåœ¨å…¬å…±ä»£ç é‡Œç”¨è¿™äº›å†™æ³•çš„åŒäº‹ã€‚</p>
]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>DevOpså·¥å…·ä¸»é¢˜æ•´ç†</title>
    <url>/2020/05/22/DevOps%E5%B7%A5%E5%85%B7%E4%B8%BB%E9%A2%98%E6%95%B4%E7%90%86/</url>
    <content><![CDATA[<img src="/2020/05/22/DevOps%E5%B7%A5%E5%85%B7%E4%B8%BB%E9%A2%98%E6%95%B4%E7%90%86/DevOps.svg">]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonè½»é‡çº§æ¡†æ¶</title>
    <url>/2020/05/05/python%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<h2 id="Responderæ¡†æ¶"><a href="#Responderæ¡†æ¶" class="headerlink" title="Responderæ¡†æ¶"></a>Responderæ¡†æ¶</h2><blockquote>
<p>responderæ˜¯@kennethreitzæ–°å¼€å‘çš„ä¸€ä¸ªé¡¹ç›®ï¼Œ æ˜¯ä¸€ä¸ªåŸºäº Python çš„ HTTP æœåŠ¡æ¡†æ¶. åº•å±‚ç”¨äº† Starlette çš„æ¡†æ¶, Starlette æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ ASGI æ¡†æ¶/å·¥å…·åŒ…ï¼Œ å¯ä»¥ç”¨ Starlette æ„å»ºé«˜æ€§èƒ½çš„å¼‚æ­¥ IO æœåŠ¡.</p>
</blockquote>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">@version: v0.1</span><br><span class="line">@Author: shu_ke163@163.com</span><br><span class="line">@Description: file content</span><br><span class="line">@Date: 2020-05-05 01:04:37</span><br><span class="line">@LastEditors: shuke</span><br><span class="line">@LastEditTime: 2020-05-05 02:07:37</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">import time</span><br><span class="line">import graphene</span><br><span class="line">import responder</span><br><span class="line"></span><br><span class="line">api &#x3D; responder.API()</span><br><span class="line"></span><br><span class="line">@api.route(&quot;&#x2F;&#123;greeting&#125;&quot;)</span><br><span class="line">async def greet_world(req, resp, *, greeting):</span><br><span class="line">    resp.text &#x3D; f&quot;&#123;greeting&#125;, world&quot;</span><br><span class="line"></span><br><span class="line">@api.route(&quot;&#x2F;&quot;)</span><br><span class="line">def hello(req, resp):</span><br><span class="line"></span><br><span class="line">    # ä½œä¸ºåå°ä»»åŠ¡æ‰§è¡Œ</span><br><span class="line">    @api.background.task</span><br><span class="line">    def sleep(s&#x3D;10):</span><br><span class="line">        time.sleep(s)</span><br><span class="line">        print(&quot;slept!&quot;)</span><br><span class="line"></span><br><span class="line">    sleep()</span><br><span class="line">    resp.content &#x3D; &quot;processing&quot;</span><br><span class="line"></span><br><span class="line">class Query(graphene.ObjectType):</span><br><span class="line">    hello &#x3D; graphene.String(name&#x3D;graphene.String(default_value&#x3D;&quot;stranger&quot;))</span><br><span class="line"></span><br><span class="line">    def resolve_hello(self, info, name):</span><br><span class="line">        return f&quot;Hello &#123;name&#125;&quot;</span><br><span class="line"></span><br><span class="line">schema &#x3D; graphene.Schema(query&#x3D;Query)</span><br><span class="line">view &#x3D; responder.ext.GraphQLView(api&#x3D;api, schema&#x3D;schema)</span><br><span class="line"></span><br><span class="line">api.add_route(&quot;&#x2F;graph&quot;, view)</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    api.run()</span><br></pre></td></tr></table></figure>

<p><a href="https://responder.kennethreitz.org/en/latest/tour.html" target="_blank" rel="noopener">å®˜æ–¹ç¤ºä¾‹æ–‡æ¡£</a></p>
<h2 id="Starlette"><a href="#Starlette" class="headerlink" title="Starlette"></a>Starlette</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">@version: v0.1</span><br><span class="line">@Author: shu_ke163@163.com</span><br><span class="line">@Description: file content</span><br><span class="line">@Date: 2020-05-05 02:16:32</span><br><span class="line">@LastEditors: shuke</span><br><span class="line">@LastEditTime: 2020-05-05 02:22:39</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">from starlette.applications import Starlette</span><br><span class="line">from starlette.responses import JSONResponse</span><br><span class="line">from starlette.routing import Route</span><br><span class="line"></span><br><span class="line">async def homepage(request):</span><br><span class="line">    return JSONResponse(&#123;&quot;hello&quot;: &quot;shuke&#39;s world&quot;&#125;)</span><br><span class="line"></span><br><span class="line">routes &#x3D; [</span><br><span class="line">    Route(&quot;&#x2F;&quot;, endpoint&#x3D;homepage)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">app &#x3D; Starlette(debug&#x3D;True, routes&#x3D;routes)</span><br></pre></td></tr></table></figure>
<h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(base) âœ  uvicorn example:app --reload</span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(base) âœ http http:&#x2F;&#x2F;127.0.0.1:8000</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">content-length: 25</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">date: Mon, 04 May 2020 18:27:23 GMT</span><br><span class="line">server: uvicorn</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;hello&quot;: &quot;shuke&#39;s world&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://www.starlette.io/" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></p>
<h2 id="FastAPI"><a href="#FastAPI" class="headerlink" title="FastAPI"></a>FastAPI</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">@version: v0.1</span><br><span class="line">@Author: shu_ke163@163.com</span><br><span class="line">@Description: file content</span><br><span class="line">@Date: 2020-05-05 01:04:37</span><br><span class="line">@LastEditors: shuke</span><br><span class="line">@LastEditTime: 2020-05-05 02:48:43</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">from fastapi import FastAPI</span><br><span class="line"></span><br><span class="line">app &#x3D; FastAPI()</span><br><span class="line"></span><br><span class="line">@app.get(&quot;&#x2F;&quot;)</span><br><span class="line">async def read_root():</span><br><span class="line">    return &#123;&quot;hello&quot;: &quot;world!&quot;&#125;</span><br><span class="line"></span><br><span class="line">@app.get(&quot;&#x2F;items&#x2F;&#123;item_id&#125;&quot;)</span><br><span class="line">async def read_item(item_id: int, q: str &#x3D; None) -&gt; dict:</span><br><span class="line">    return &#123;&quot;item_id&quot;: item_id, &quot;q&quot;: q&#125;</span><br><span class="line"></span><br><span class="line"># å¯åŠ¨</span><br><span class="line">(base) âœ  learn uvicorn main:app --reload</span><br></pre></td></tr></table></figure>

<h2 id="è¯·æ±‚ç¤ºä¾‹"><a href="#è¯·æ±‚ç¤ºä¾‹" class="headerlink" title="è¯·æ±‚ç¤ºä¾‹"></a>è¯·æ±‚ç¤ºä¾‹</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(base) âœ  http http:&#x2F;&#x2F;127.0.0.1:8000</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">content-length: 18</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">date: Mon, 04 May 2020 18:52:08 GMT</span><br><span class="line">server: uvicorn</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;hello&quot;: &quot;world!&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(base) âœ  http http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;items&#x2F;5\?q\&#x3D;shuke</span><br><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">content-length: 25</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">date: Mon, 04 May 2020 18:55:40 GMT</span><br><span class="line">server: uvicorn</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;item_id&quot;: 5,</span><br><span class="line">    &quot;q&quot;: &quot;shuke&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="api-docs"><a href="#api-docs" class="headerlink" title="api docs"></a>api docs</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;docs</span><br></pre></td></tr></table></figure>

<h2 id="refs"><a href="#refs" class="headerlink" title="refs"></a>refs</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;learnku.com&#x2F;python&#x2F;t&#x2F;38942</span><br><span class="line">https:&#x2F;&#x2F;fastapi.tiangolo.com&#x2F;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>PYTHON</category>
      </categories>
      <tags>
        <tag>PYTHON</tag>
      </tags>
  </entry>
  <entry>
    <title>é˜¿é‡Œå·´å·´ DevOps è½¬å‹åçš„è¿ç»´å¹³å°å»ºè®¾</title>
    <url>/2020/04/20/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4-DevOps-%E8%BD%AC%E5%9E%8B%E5%90%8E%E7%9A%84%E8%BF%90%E7%BB%B4%E5%B9%B3%E5%8F%B0%E5%BB%BA%E8%AE%BE/</url>
    <content><![CDATA[<h2 id="å®æˆ˜-é˜¿é‡Œå·´å·´-DevOps-è½¬å‹åçš„è¿ç»´å¹³å°å»ºè®¾"><a href="#å®æˆ˜-é˜¿é‡Œå·´å·´-DevOps-è½¬å‹åçš„è¿ç»´å¹³å°å»ºè®¾" class="headerlink" title="å®æˆ˜:é˜¿é‡Œå·´å·´ DevOps è½¬å‹åçš„è¿ç»´å¹³å°å»ºè®¾"></a>å®æˆ˜:é˜¿é‡Œå·´å·´ DevOps è½¬å‹åçš„è¿ç»´å¹³å°å»ºè®¾</h2><blockquote>
<p>å¯¼è¯»ï¼šé˜¿é‡Œå·´å·´DevOpsè½¬å‹ä¹‹åï¼Œè¿ç»´å¹³å°æ˜¯å¦‚ä½•å»ºè®¾çš„ï¼Ÿé˜¿é‡Œå·´å·´é«˜çº§æŠ€æœ¯ä¸“å®¶é™ˆå–»ç»“åˆè¿ç»´è‡ªèº«çš„ç†è§£ï¼Œä¸šåŠ¡åœºæ™¯çš„åˆ†æå’Œä¸šç•Œæ–¹æ³•è®ºçš„ä¸€äº›æ€è€ƒï¼Œå¾—å‡ºæ¥ä¸€äº›æœ€ä½³å®è·µåˆ†äº«ç»™å¤§å®¶.</p>
</blockquote>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>â€œæˆ‘æ˜¯è¿™ä¸ªåº”ç”¨çš„ Ownerâ€æ˜¯é˜¿é‡Œå·´å·´DevOpsè½¬å‹çš„é‡è¦ç­–ç•¥ï¼Œè¿ç»´æœ‰äº†è¿™ä¸ªç­–ç•¥ä»¥åï¼ŒPEå¤§é‡çš„æ—¥å¸¸å·¥ä½œå°±å¯ä»¥é‡Šæ”¾å‡ºæ¥ï¼Œä¼šæœ‰æ›´å¤šçš„æ—¶é—´å»æ€è€ƒæ²‰æ·€ï¼Œå»åšç¼–ç ï¼Œå»åšä»¥å‰ä¸æ›¾åšçš„äº‹æƒ…ã€‚</p>
<h3 id="è¿ç»´çš„ä¸‰ä¸ªé˜¶æ®µ"><a href="#è¿ç»´çš„ä¸‰ä¸ªé˜¶æ®µ" class="headerlink" title="è¿ç»´çš„ä¸‰ä¸ªé˜¶æ®µ"></a>è¿ç»´çš„ä¸‰ä¸ªé˜¶æ®µ</h3><p><img src="https://note.youdao.com/yws/api/personal/file/WEBbf3865e31808fe00f15398bbcc41424f?method=download&shareKey=f5bd11f6b941ca6316940227c22768bc" alt="è¿ç»´ä¸‰ä¸ªé˜¶æ®µ">  </p>
<ol>
<li>ç¬¬ä¸€é˜¶æ®µï¼šé»‘å±ï¼Œä¸‰è§’å½¢æ˜¯ä»£è¡¨æ•´ä¸ªè¿ç»´ç»™ç”¨æˆ·çš„ä¸€äº›ä½“æ„Ÿæˆ–è€…ç»™ç ”å‘çš„ä½“æ„Ÿï¼Œäººå·¥è¿ç»´ï¼Œç›®å‰å¾ˆå¤šä¼ä¸šå¯èƒ½è¿˜æ˜¯è¿™æ ·ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼šç™½å±,è‡ªåŠ¨åŒ–è¿ç»´ï¼Œä»¥å‰æŠŠè„šæœ¬åšæˆå·¥å…·å»å¼„ï¼Œæœ‰ä»€ä¹ˆç‰¹å¾ï¼Œäººpushæœºå™¨å»å¹²æ´»ï¼Œè‡ªåŠ©è¿ç»´ã€‚</li>
<li>ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·å¯¹è¿ç»´ä½“æ„Ÿå¾ˆå°‘ï¼Œä½†æ˜¯è¿ç»´è¿™ä¸ªé¢†åŸŸæ˜¯ä¸å˜çš„ã€‚æœ€é‡è¦çš„æ˜¯äººæœºäº¤äº’å˜å°‘äº†ï¼Œæ— å±è™½è¯´æ˜¯ä¸å¯èƒ½çš„ï¼Œéå¸¸æç«¯ï¼Œä½†æ˜¯ä¸ªè¶‹åŠ¿ï¼Œå°‘é‡çš„äººæœºäº¤äº’ï¼Œå®ƒæœ‰è‡ªå†³ç­–ã€è‡ªé©±åŠ¨ã€‚</li>
</ol>
<h3 id="è‡ªåŠ¨åŒ–è¿ç»´åŸºç¡€"><a href="#è‡ªåŠ¨åŒ–è¿ç»´åŸºç¡€" class="headerlink" title="è‡ªåŠ¨åŒ–è¿ç»´åŸºç¡€"></a>è‡ªåŠ¨åŒ–è¿ç»´åŸºç¡€</h3><p>åšè‡ªåŠ¨åŒ–è¿ç»´ï¼Œæˆ‘è®¤ä¸ºæœ‰å››å¤§åŸºç¡€ã€‚</p>
<h4 id="ç¬¬ä¸€-è¿ç»´æ ‡å‡†ä¸è§„èŒƒ"><a href="#ç¬¬ä¸€-è¿ç»´æ ‡å‡†ä¸è§„èŒƒ" class="headerlink" title="ç¬¬ä¸€: è¿ç»´æ ‡å‡†ä¸è§„èŒƒ"></a>ç¬¬ä¸€: è¿ç»´æ ‡å‡†ä¸è§„èŒƒ</h4><p>æˆ‘ä»¬çš„æ ‡å‡†æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œè®©ç ”å‘ follow è¿™ä¸ªæ ‡å‡†ï¼Œæ ‡å‡†ä¼šåœ¨å·¥å…·é‡Œå›ºåŒ–ã€‚</p>
<h4 id="ç¬¬äºŒ-æ³›ç›‘æ§ï¼Œè¿è¡Œæ—¶ï¼Œé™æ€ï¼Œæ•°æ®åŒ–ï¼Œå¯è§†åŒ–"><a href="#ç¬¬äºŒ-æ³›ç›‘æ§ï¼Œè¿è¡Œæ—¶ï¼Œé™æ€ï¼Œæ•°æ®åŒ–ï¼Œå¯è§†åŒ–" class="headerlink" title="ç¬¬äºŒ: æ³›ç›‘æ§ï¼Œè¿è¡Œæ—¶ï¼Œé™æ€ï¼Œæ•°æ®åŒ–ï¼Œå¯è§†åŒ–"></a>ç¬¬äºŒ: æ³›ç›‘æ§ï¼Œè¿è¡Œæ—¶ï¼Œé™æ€ï¼Œæ•°æ®åŒ–ï¼Œå¯è§†åŒ–</h4><p>æ³›ç›‘æ§ï¼Œä¸æ˜¯è¯´ä¼ ç»Ÿçš„ç›‘æ§ï¼Œæ˜¯æŠŠçº¿ä¸Šæƒ³çŸ¥é“çš„ä¸€åˆ‡éƒ½æ•°æ®åŒ–ï¼Œæœ€ç»ˆæ•°æ®ä¸æ˜¯ç»™äººçœ‹çš„ï¼Œæ˜¯ç»™æœºå™¨å»æ¶ˆè´¹çš„ï¼Œæ•°æ®æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§èµ„æ–™ï¼Œä¸æ˜¯å¯è§†åŒ–ï¼Œé‚£ä¸æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚</p>
<h4 id="ç¬¬ä¸‰-CMDB"><a href="#ç¬¬ä¸‰-CMDB" class="headerlink" title="ç¬¬ä¸‰: CMDB"></a>ç¬¬ä¸‰: CMDB</h4><p>1.CMDB åº”è¯¥æ”¾ä»€ä¹ˆï¼Œä¸€èˆ¬æ”¾æœåŠ¡å™¨ç›¸å…³çš„ã€ç½‘ç»œç›¸å…³çš„ã€åº”ç”¨ç›¸å…³çš„è¿™ä¸‰ä¸ªç»´åº¦çš„ç›¸å…³ä¿¡æ¯ã€‚<br>2.ç»å¸¸æœ‰äººä¼šè¯´ CMDB ä¸å‡†ï¼Œæ•°æ®ä¸å‡†æ˜¯å› ä¸ºæ²¡æœ‰æŠŠæ•°æ®ç”Ÿäº§å’Œæ•°æ®æ¶ˆè´¹å½¢æˆé—­ç¯ï¼Œå¦‚æœå½¢æˆäº†é—­ç¯æ•°æ®ä¸å‡†ï¼Œé‚£æ˜¯å› ä¸ºä½ ä¸ç”¨è¿™ä¸ªæ•°æ®ï¼Œæ‰€ä»¥ä¸å‡†ã€‚</p>
<h4 id="ç¬¬å››-é«˜æ•ˆçš„CI-CD"><a href="#ç¬¬å››-é«˜æ•ˆçš„CI-CD" class="headerlink" title="ç¬¬å››: é«˜æ•ˆçš„CI/CD"></a>ç¬¬å››: é«˜æ•ˆçš„CI/CD</h4><p>æˆ‘ä»¬ä¸€å®šè¦å…·å¤‡å¿«é€Ÿçš„äº¤ä»˜èƒ½åŠ›ï¼Œä¸»è¦ä½“ç°è¿™ä¸¤ä¸ªæ–¹é¢ï¼šç¬¬ä¸€ï¼Œæ–°å¼€å‘çš„èƒ½åŠ›èƒ½ä¸èƒ½å¿«é€Ÿä¸Šçº¿ï¼Œç¬¬äºŒï¼Œæƒ³æ‰©å®¹ä¸€å°æœºå™¨èƒ½ä¸èƒ½å¿«é€Ÿæ‰©å‡ºæ¥ã€‚è¿™ä¸¤ä¸ªèƒ½åŠ›æŠ½è±¡å‡ºæ¥æ˜¯ä¸‰å—ã€‚<br>æŒç»­é›†æˆ(CI)ï¼Œå¾ˆå¤šäººè¯´æŒç»­é›†æˆå·¥å…·ä¸å¥½ç”¨ï¼Œæ•ˆç‡ä½ï¼Œå…¶å®æŒç»­é›†æˆçš„æœ¬è´¨æ˜¯è¦è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚å¦‚æœç ”å‘éƒ¨ä¸å…·å¤‡è‡ªåŠ¨åŒ–æµ‹è¯•çš„èƒ½åŠ›ï¼ŒæŒç»­é›†æˆæ€ä¹ˆåšéƒ½æ˜¯å¤±è´¥çš„ã€‚<br>æŒç»­é›†æˆé‡Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦æ¨è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•è¿˜æœ‰ç³»ç»Ÿæµ‹è¯•ï¼Œå•æµ‹æ˜¯ä¿è¯è‡ªå·±æ²¡é—®é¢˜ï¼Œé›†æˆæµ‹è¯•æ˜¯ä¿è¯è·Ÿä¸Šä¸‹æ¸¸æ²¡é—®é¢˜ï¼Œç³»ç»Ÿæµ‹è¯•æ˜¯ä¿è¯æ•´ä¸ªç³»ç»Ÿæ²¡é—®é¢˜ã€‚<br>æŒç»­äº¤ä»˜(CD)ï¼Œæœ‰å¾ˆå¤šäººè¯´æŒç»­äº¤ä»˜æœ¬è´¨æ˜¯ä¸€ä¸ª Pipelineï¼ŒCIçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿå¿«é€Ÿæ­£ç¡®æ‰“ä¸€ä¸ªåŒ…å‡ºæ¥ã€‚CDçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿèƒ½å¤Ÿå¿«é€ŸæŠŠä¸€ä¸ªåŒ…åœ¨ä¸åŒçš„ç¯å¢ƒéªŒè¯å®ƒæ˜¯okçš„ï¼Œå¯ä»¥æ”¾åˆ°çº¿ä¸Šå»ï¼Œè¿™å°±æ˜¯æŒç»­äº¤ä»˜è¦å¹²çš„äº‹ã€‚æŒç»­äº¤ä»˜é‡Œå¾ˆå…³é”®çš„ä¸€ç‚¹æˆ‘ä»¬è¦è§£å†³ï¼Œå°±æ˜¯å®ƒçš„ç¯å¢ƒä¸€è‡´æ€§ã€é…ç½®ä¸€è‡´æ€§ã€‚ç¯å¢ƒä¸€è‡´æ€§å¯ä»¥ç”¨Dockerè§£å†³ï¼ŒDocker æœ¬èº«å°±æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„ä¸œè¥¿ã€‚æ‰€ä»¥è¯´ç¬¬ä¸€æ¡ç”¨ Dockerï¼Œè‚¯å®šæ˜¯æ ‡å‡†åŒ–çš„ï¼Œå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œé…ç½®æ˜¯ä¸æ˜¯ä¸€è‡´æ€§ï¼Œæ˜¯ä¸æ˜¯åŠ¨é™åˆ†ç¦»ã€‚<br>æŒç»­éƒ¨ç½²(CD)ï¼Œæ˜¯ä¸€ç§èƒ½åŠ›ï¼Œè¿™ç§èƒ½åŠ›éå¸¸é‡è¦ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªåŒ…å¿«é€Ÿéƒ¨ç½²åœ¨ä½ æƒ³è¦çš„åœ°æ–¹ã€‚</p>
<p>PSï¼šæŒç»­éƒ¨ç½²çš„å‡ ä¸ªç—›ç‚¹ã€‚</p>
<ol>
<li>å¯¹åŒ…çš„æ–‡ä»¶çš„åˆ†å‘ï¼Œé˜¿é‡Œæœ‰ä¸€ä¸ªå«èœ»èœ“çš„äº§å“ï¼Œæ˜¯åšäº† SP2Pï¼Œåœ¨ P2P çš„åŸºç¡€ä¸ŠåŠ äº†ä¸€ä¸ª Superã€‚</li>
<li>åº”ç”¨å¯åŠ¨ï¼Œå¾ˆå¤šåº”ç”¨å¯åŠ¨çš„æ—¶å€™è¦ä¸¤ä¸‰åˆ†é’Ÿï¼Œè¿™æ˜¯å¾ˆæœ‰é—®é¢˜çš„ã€‚</li>
<li>éƒ¨ç½²èµ·æ¥ä»¥åè¿™ä¸ªä¸šåŠ¡æ˜¯ä¸æ˜¯æ­£ç¡®çš„ï¼Œå¤§å®¶ä¸€å®šè¦åšä¸€ä¸ª HealthCheckï¼Œä¸æ˜¯è¿ç»´åšï¼Œæ˜¯PEåšï¼Œä¸€å®šè¦æŠŠè¿™ä¸ªè¦æ±‚è¯´å‡ºæ¥ï¼Œæ‰§è¡Œ HealthCheck è¿™ä¸ªè„šæœ¬ã€‚</li>
</ol>
<h3 id="è¿ç»´ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§"><a href="#è¿ç»´ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§" class="headerlink" title="è¿ç»´ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§"></a>è¿ç»´ç³»ç»Ÿçš„é‡è¦ç‰¹æ€§</h3><p>ä¸­é—´ä»¶ç ”å‘é¦–å…ˆå…³æ³¨ç¨³å®šæ€§ï¼Œå…¶æ¬¡æ˜¯æ•ˆç‡ï¼Œç„¶åæ˜¯æ˜“æ‰©å±•ã€‚è¿ç»´ç ”å‘é‡Œé¢çš„å…­ä¸ªé‡è¦ç‰¹å¾ï¼Œæ¯ä¸€ä¸ªéƒ½éå¸¸é‡è¦ï¼Œä»¥ä¸‹æ˜¯æˆ‘æ„Ÿè§¦æ¯”è¾ƒæ·±çš„å‡ ä¸ªã€‚<br><img src="https://note.youdao.com/yws/api/personal/file/WEB620101a1629a2fdfbd0c36d6564055ff?method=download&shareKey=08971d6ce40134622e0c64456099e2ae" alt="è¿ç»´ç³»ç»Ÿé‡è¦ç‰¹æ€§">  </p>
<ol>
<li><p>é«˜å¯ç”¨<br>åœ¨åšåŒåŸå®¹ç¾æ¼”ç»ƒçš„æ—¶å€™ï¼Œæˆ‘æŠŠå…³ä¸€åˆ‡ï¼Œç»“æœå‘ç°è¿ç»´ç³»ç»ŸæŒ‚äº†ï¼Œæ•‘å‘½çš„ä¸œè¥¿æ²¡æœ‰äº†æ€ä¹ˆåŠï¼Ÿæ‰€ä»¥è¯´è¿ç»´ç³»ç»Ÿä¸€å®šè¦æ˜¯é«˜å¯ç”¨ï¼Œä¸ä¸€å®šæ˜¯é«˜å¹¶å‘ã€‚</p>
</li>
<li><p>å¹‚ç­‰æ€§<br>å¹‚ç­‰æ€§æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ååˆ†é‡è¦çš„æ¦‚å¿µï¼Œè¿™ä¸ªä¹Ÿéå¸¸é‡è¦ã€‚</p>
</li>
<li><p>å¯å›æ»š<br>è¿™ä¸ªæ˜¯åšè¿ç»´æœ€åŸºæœ¬çš„ä¸€ä¸ª senseï¼Œä½ åšçš„ä»»ä½•æ“ä½œæ˜¯ä¸æ˜¯å¯æ§çš„ã€‚å¦‚æœçœŸæ­£åšå¯å›æ»šï¼Œå…¶å®äº‹æƒ…æ²¡æœ‰è¿™ä¹ˆå¤æ‚ã€‚</p>
</li>
<li><p>é«˜æ•ˆç‡<br>å¦‚æœä½ çš„ä¼ä¸šå‘å±•éå¸¸å¿«é€Ÿï¼Œä½ çš„è§„æ¨¡æ€§æ•ˆåº”å·²ç»æ¥äº†ï¼Œä½ çš„è¿ç»´ç³»ç»Ÿä¸€å®šè¦å…·å¤‡å¾ˆé«˜æ•ˆç‡ï¼Œå¿«é€Ÿæ‰©å®¹ã€å¿«é€Ÿéƒ¨ç½²è¿™ä¸ªæ•ˆç‡æˆ‘ä»¬è¦è¿½æ±‚æè‡´ã€‚</p>
</li>
</ol>
<h3 id="ç ”å‘å®šä¹‰è¿ç»´ï¼Œé…ç½®é©±åŠ¨å˜æ›´"><a href="#ç ”å‘å®šä¹‰è¿ç»´ï¼Œé…ç½®é©±åŠ¨å˜æ›´" class="headerlink" title="ç ”å‘å®šä¹‰è¿ç»´ï¼Œé…ç½®é©±åŠ¨å˜æ›´"></a>ç ”å‘å®šä¹‰è¿ç»´ï¼Œé…ç½®é©±åŠ¨å˜æ›´</h3><ol>
<li><p>ä»æœ€ä¸‹é¢çœ‹ï¼Œæ˜¯æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ï¼Œæä¾›ä¸‰ç§èƒ½åŠ›ï¼ŒåŒ…æ‹¬é›†æ•£ã€å­˜å‚¨ã€ç½‘ç»œã€‚ä»å³ä¸‹è§’çš„ä½ç½®çœ‹ï¼Œç”»çš„æ˜¯ä¸€ä¸ªæ³›ç›‘æ§ï¼Œå®ƒä¼šçŸ¥é“ç³»ç»Ÿã€åº”ç”¨ç­‰ï¼Œåœ¨æ—è¾¹æ ‡äº†ä¸€ä¸ªå­—ï¼Œç°çŠ¶ï¼Œæˆ‘è¦é€šè¿‡è¿™ä¸ªç°çŠ¶æŠŠçº¿ä¸Šçš„ç³»ç»Ÿå…¨éƒ¨æ•°æ®åŒ–ï¼Œç„¶åæ”¾åˆ°å†³ç­–ä¸­å¿ƒã€‚</p>
</li>
<li><p>å·¦ä¸Šè§’æœ‰ CMDBï¼Œç°åœ¨å¾ˆå¤šå˜æ›´ç³»ç»Ÿï¼Œå¾ˆå¤šå¼ºè°ƒæµç¨‹ã€‚æˆ‘æœ¬äººæ˜¯åšç ”å‘å‡ºèº«ï¼Œéå¸¸æŠµè§¦æµç¨‹ï¼Œæµç¨‹ä¸æ˜¯ä¸€ä¸ªæ•ˆç‡å·¥å…·ï¼Œå®ƒæ˜¯é˜»ç¢æ•ˆç‡çš„ã€‚</p>
</li>
<li><p>æ¯”å¦‚æ•…éšœæå®Œä»¥åå°±æ˜¯ä¸€å †çš„æµç¨‹ï¼Œéå¸¸é˜»ç¢æ•ˆç‡ï¼Œæ˜¯è´¨é‡æ§åˆ¶çš„ä¸€ä¸ªå·¥å…·ã€‚æµç¨‹ä¸æ˜¯ä¸è¦ï¼Œæ˜¯æŠŠæµç¨‹åšåˆ°ç³»ç»Ÿé‡Œé¢å»ï¼Œè®©ç³»ç»Ÿå¸®äººåšå†³ç­–ï¼Œè€Œä¸æ˜¯äººåœ¨é‚£é‡Œç‚¹ã€‚</p>
</li>
<li><p>CMDB å®šä¹‰äº†æˆ‘åˆšæ‰è¯´çš„ç›®æ ‡ï¼Œç°çŠ¶é€šè¿‡ç›‘æ§æ‹¿åˆ°äº†ï¼Œç›®æ ‡ä¹ŸçŸ¥é“äº†ï¼Œè¿™ä¸ªæ—¶å€™è¿˜è§‰å¾—è¿™ä¸ªäº‹æƒ…å¾ˆå¤æ‚å—ï¼Ÿæˆ‘è®¤ä¸ºè¿™çœ‹ä½ æ€ä¹ˆå»åšã€‚æƒ³åšæˆäººå·¥è¿˜æ˜¯åšæˆè‡ªåŠ¨æˆ–è€…åšæˆæ™ºèƒ½ï¼Œéƒ½å–å†³äºè¿™ä¸ªåœ°æ–¹ã€‚æ‰€ä»¥æ™ºèƒ½é‡Œä¸€å®šè¦æœ‰æ•°æ®ã€‚</p>
</li>
<li><p>ä¸¾ä¸ªä¾‹å­ï¼Œé€šè¿‡æ™ºèƒ½åˆ†æå‡ºç›®æ ‡çŠ¶æ€æ˜¯ä½¿è¿™ä¸ªåº”ç”¨æœ‰100ä¸ªVMï¼Œä½†æ˜¯ç°åœ¨çŠ¶æ€åªæœ‰80ä¸ªï¼Œä¸€çœ‹è¿™ä¸¤ä¸ªä¸ä¸€æ ·ï¼Œè¦æ‰©å®¹20å°ï¼Œå¦‚æœç³»ç»Ÿåšå¾—æ›´æ™ºèƒ½ä¸€ç‚¹ï¼Œé€šè¿‡å›¾ä¸Šå·¦è¾¹çš„äº‹ä»¶ä¸­å¿ƒæç¤ºæˆ‘20å°è´Ÿè½½è¾ƒè½»çš„æ”¾åœ¨å“ªï¼Œå¯ä»¥è°ƒåº¦è¿‡å»ï¼Œç„¶åå»åšæ‰§è¡Œå˜æ›´ã€‚</p>
</li>
</ol>
<p>åŸºäºè¿™äº›ä¸œè¥¿å¾—å‡ºæ¥ä¸¤ä¸ªç»“è®ºï¼Œâ€œç ”å‘å®šä¹‰è¿ç»´â€ï¼Œâ€œé…ç½®é©±åŠ¨å˜æ›´â€ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆæ˜¯ç ”å‘å®šä¹‰è¿ç»´ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯ç ”å‘å®šä¹‰è¿ç»´ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ç ”å‘å®šä¹‰è¿ç»´ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯ç ”å‘å®šä¹‰è¿ç»´ï¼Ÿ</h3><p>ç ”å‘å®šä¹‰è¿ç»´ï¼ˆDDOï¼‰ï¼Œç ”å‘æœ€è´´è¿‘ä¸šåŠ¡ï¼Œæœ€åº”è¯¥æ¸…æ¥šè¿™ä¸ªä¸šåŠ¡åº”è¯¥å…·å¤‡ä»€ä¹ˆæ ·çš„èƒ½åŠ›ï¼Œåªæœ‰ç ”å‘æ‰çŸ¥é“è¿™ä¸ªä¸šåŠ¡KPSæ˜¯å¤šå°‘ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆæ˜¯é…ç½®é©±åŠ¨å˜æ›´"><a href="#ä¸ºä»€ä¹ˆæ˜¯é…ç½®é©±åŠ¨å˜æ›´" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯é…ç½®é©±åŠ¨å˜æ›´?"></a>ä¸ºä»€ä¹ˆæ˜¯é…ç½®é©±åŠ¨å˜æ›´?</h3><p>é…ç½®å°±æ˜¯æŠŠç›®æ ‡æ”¹å˜ä¸€ä¸‹ï¼Œä½ è·Ÿæˆ‘è¯´ä¸€ä¸ªè¿ç»´åœºæ™¯ï¼Œæˆ‘å¯ä»¥åœ¨è¿™ä¸ªå›¾é‡Œé¢ run èµ·æ¥ï¼Œé…ç½®åªéœ€è¦æ”¹ä½ çš„ç›®æ ‡çŠ¶æ€ï¼Œæ¯”å¦‚æŠŠä½ çš„çŠ¶æ€10VM å˜æˆ15ä¸ªVMã€‚<br>è¿™å°±æ˜¯â€ç ”å‘å®šä¹‰è¿ç»´ï¼Œé…ç½®é©±åŠ¨å˜æ›´â€å‰å› åæœçš„æ€è€ƒã€‚</p>
<h3 id="è¿ç»´å·¥å…·ä¸æ–¹æ³•è®º"><a href="#è¿ç»´å·¥å…·ä¸æ–¹æ³•è®º" class="headerlink" title="è¿ç»´å·¥å…·ä¸æ–¹æ³•è®º"></a>è¿ç»´å·¥å…·ä¸æ–¹æ³•è®º</h3><p><img src="https://note.youdao.com/yws/api/personal/file/WEB9c904e2294e2fc84199992da72822695?method=download&shareKey=ebfc4a36f6d42bca917684b002fd174d" alt="è¿ç»´å·¥å…·åŠæ–¹æ³•è®º">  </p>
<h4 id="ç²¾ç›Šå‘ç°ä»·å€¼"><a href="#ç²¾ç›Šå‘ç°ä»·å€¼" class="headerlink" title="ç²¾ç›Šå‘ç°ä»·å€¼"></a>ç²¾ç›Šå‘ç°ä»·å€¼</h4><p>ä»·å€¼æ¥æºäºç”¨æˆ·çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯è‡ªå·±çš„YYï¼Œæˆ‘ä»¬çš„ä»·å€¼æ¥æºäºç”¨æˆ·ã€‚</p>
<p>ç²¾ç›Šå¯¹æˆ‘æœ€å¤§çš„æ„Ÿè§¦å°±æ˜¯è¦å‘ç°ä»·å€¼ã€‚ç²¾ç›Šæ€æƒ³ï¼Œä»€ä¹ˆä¸œè¥¿æ˜¯æœ‰ä»·å€¼çš„ï¼Œèƒ½å¤Ÿå¯¹ç”¨æˆ·å¸¦æ¥ç‰©è´¨ä¸Šçš„æˆ–è€…èº«ä½“ä¸Šçš„æ„‰æ‚¦çš„ä¸œè¥¿å°±æ˜¯æœ‰ä»·å€¼çš„ã€‚</p>
<p>ä»Šå¤©ä¹Ÿæœ‰äººé—®ï¼ŒDevOps å›¢é˜Ÿæ˜¯è¯¥æ‹†è¿˜æ˜¯è¯¥åˆï¼Œæˆ‘æƒ³ä»–åº”è¯¥é¦–å…ˆå¼„æ¸…æ¥šé¢å¯¹çš„æ˜¯ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œé—®é¢˜çš„ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœåªè§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿè®¸å¹¶ä¸æ˜¯DevOps å›¢é˜Ÿæ‹†ä¸æ‹†çš„é—®é¢˜ã€‚</p>
<h4 id="æ•æ·äº¤ä»˜ä»·å€¼"><a href="#æ•æ·äº¤ä»˜ä»·å€¼" class="headerlink" title="æ•æ·äº¤ä»˜ä»·å€¼"></a>æ•æ·äº¤ä»˜ä»·å€¼</h4><p>æ•æ·ä¹Ÿæ˜¯å¯¹æˆ‘å½±å“å¾ˆå¤šçš„ã€‚å¾ˆå¤šäººè°ˆæ•æ·ï¼Œæˆ‘ä»¬å›¢é˜Ÿé‡Œä¹Ÿææ•æ·ï¼Œæ•æ·æ˜¯è¦å¿«é€Ÿäº¤ä»˜ä»·å€¼ï¼Œå®ƒæ˜¯ä¸€ç³»åˆ—çš„æ–¹æ³•è®ºã€‚ä½†æ˜¯åœ¨å¼•å…¥çš„æ—¶å€™åƒä¸‡æ³¨æ„ï¼Œåˆ«äººè¡Œçš„ä¸œè¥¿ä½ ä¸ä¸€å®šè¡Œï¼Œä½ éœ€è¦çš„ä¸œè¥¿å¹¶ä¸ä¸€å®šæ˜¯æ•æ·ï¼Œè¦å› å›¢é˜Ÿè€Œå¼‚ï¼Œå½¢æˆä¸€ä¸ªç¯ï¼ŒæŒç»­åé¦ˆã€‚</p>
<h4 id="OODAç¯"><a href="#OODAç¯" class="headerlink" title="OODAç¯"></a>OODAç¯</h4><p>OODA ç¯ï¼Œå°±æ˜¯å½¢æˆé—­ç¯ï¼Œè®©ä»·å€¼å¿«é€ŸæµåŠ¨ã€‚</p>
<h3 id="åº”ç”¨è¿ç»´å¹³å°ATOM"><a href="#åº”ç”¨è¿ç»´å¹³å°ATOM" class="headerlink" title="åº”ç”¨è¿ç»´å¹³å°ATOM"></a>åº”ç”¨è¿ç»´å¹³å°ATOM</h3><p>åº”ç”¨è¿ç»´å¹³å°çš„åŸºç¡€è®¾æ–½æ˜¯ä¸€å±‚ï¼ŒäºŒå±‚æ˜¯è¿ç»´ä¸­å°ï¼Œæœ€ä¸Šé¢ä¸€å—æ˜¯è¦åšçš„ PaaS å¹³å°ï¼Œè¿™ä¸ªå¹³å°åˆ†å‡ æ­¥ã€‚<br><img src="https://note.youdao.com/yws/api/personal/file/WEBcf540b68ea94cc7580696604fdd19476?method=download&shareKey=0a14435fa7c2bae87259c1ca63a072ff" alt="ATOMå¹³å°äº§å“æ¶æ„">  </p>
<h4 id="ç¬¬ä¸€å—ï¼Œé¢„ç®—ã€å®¹é‡ã€èµ„æºã€å¼¹æ€§"><a href="#ç¬¬ä¸€å—ï¼Œé¢„ç®—ã€å®¹é‡ã€èµ„æºã€å¼¹æ€§" class="headerlink" title="ç¬¬ä¸€å—ï¼Œé¢„ç®—ã€å®¹é‡ã€èµ„æºã€å¼¹æ€§"></a>ç¬¬ä¸€å—ï¼Œé¢„ç®—ã€å®¹é‡ã€èµ„æºã€å¼¹æ€§</h4><p>è¿™ä¸ªæ˜¯PaaS å¹³å°ä¸Šéå¸¸é‡è¦çš„ä¸€å—ï¼Œç›®çš„å°±æ˜¯è®©èµ„æºå¿«é€ŸæµåŠ¨èµ·æ¥ï¼Œæµå‘æ­£ç¡®çš„æ–¹å‘æ¥äº§ç”Ÿä»·å€¼ã€‚èµ„æºå¦‚æœå¸¸å¹´ä¸å¢ä¸å‡ï¼Œæ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<h4 id="ç¬¬äºŒå—ï¼Œåº”ç”¨ç®¡ç†"><a href="#ç¬¬äºŒå—ï¼Œåº”ç”¨ç®¡ç†" class="headerlink" title="ç¬¬äºŒå—ï¼Œåº”ç”¨ç®¡ç†"></a>ç¬¬äºŒå—ï¼Œåº”ç”¨ç®¡ç†</h4><p>è¿™æ˜¯æ—¥å¸¸è¦åšçš„æ“ä½œï¼Œè§„æ¨¡åŒ–ï¼Œè¦å¿«é€Ÿå¯¹ä¸€ä¸ªå•å…ƒå»ºç«™ã€æ‰©å®¹ã€ç¼©å®¹ã€‚</p>
<h4 id="ç¬¬ä¸‰å—ï¼Œæ•°æ®åŒ–è¿è¥"><a href="#ç¬¬ä¸‰å—ï¼Œæ•°æ®åŒ–è¿è¥" class="headerlink" title="ç¬¬ä¸‰å—ï¼Œæ•°æ®åŒ–è¿è¥"></a>ç¬¬ä¸‰å—ï¼Œæ•°æ®åŒ–è¿è¥</h4><p>ä¸€å®šè¦è®²æ•°æ®ï¼Œæ•°æ®ä¸æ˜¯å¯è§†åŒ–å‡ºæ¥ä¸€äº›æŠ¥è¡¨ï¼Œæ˜¯è¦ç»™ç»“è®ºï¼Œå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªæ•°æ®å®Œäº†ä»¥ååº”è¯¥æ˜¯ä»€ä¹ˆï¼Œè§„åˆ™ä¸­å¿ƒæ˜¯ä»€ä¹ˆï¼Œæ˜¯æ‰€æœ‰è¿ç»´åŒå­¦æ—¥å¸¸çš„è¿ç»´ç»éªŒæ²‰æ·€ã€‚</p>
<h3 id="æ‰¹é‡è…¾æŒªå·¥å…·"><a href="#æ‰¹é‡è…¾æŒªå·¥å…·" class="headerlink" title="æ‰¹é‡è…¾æŒªå·¥å…·"></a>æ‰¹é‡è…¾æŒªå·¥å…·</h3><p>æ‰¹é‡è…¾æŒªå·¥å…·-èƒŒæ™¯</p>
<ul>
<li>ç—›ç‚¹: <ul>
<li>æœºæˆ¿æ¬è¿</li>
<li>æœºå™¨è¿‡ä¿æ›¿æ¢</li>
<li>æœºå™¨æ•…éšœé¢‘å‘,æ›¿æ¢</li>
</ul>
</li>
<li>ç›®æ ‡:<ul>
<li>è§„æ¨¡åŒ–,ç³»ç»ŸåŒ–èµ„æºè…¾æŒª,æå‡è¿ç»´æ•ˆç‡</li>
<li>å‡å°‘æ‰¹é‡è…¾æŒªæŠ•å…¥çš„äººåŠ›,æ—¶é—´èµ„æº</li>
<li>å•æœºæ›¿æ¢è‡ªåŠ¨åŒ–å¤„ç†<br>è¿™ä¸ªå·¥å…·ä¸æ˜¯æ‰€æœ‰äººéƒ½éœ€è¦ï¼Œå¯ä»¥è§£å†³æœºæˆ¿çš„æ¬è¿ï¼Œå‡‘æ¡†è¿ç§»ã€‚<br>å¼¹æ€§ä¼¸ç¼©æ˜¯æˆ‘ä»¬çš„å†³ç­–ä¸­å¿ƒã€‚å®ƒå†³å®šä½ çš„èµ„æºå¾€å“ªä¸ªåœ°æ–¹æµï¼Œéå¸¸å…³é”®ã€‚<br>æœ€åï¼Œè¿™é‡Œæ˜¯è¿ç»´é¢†åŸŸæŠ€æœ¯å«é‡æœ€æ·±çš„ä¸€ä¸ªåœ°æ–¹ï¼Œè¦ææœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ ã€å¼ºåŒ–å­¦ä¹ ã€ç®—æ³•ç­‰ã€‚<br>å¼¹æ€§ä¸€èˆ¬æœ‰æ°´å¹³ä¼¸ç¼©ã€å‚ç›´ä¼¸ç¼©ï¼Œå¯¹çº¿ä¸Šåšç®¡ç†ï¼Œå½“ç„¶æˆ‘ä»¬æœ‰é¢åº¦ï¼Œè¿™æ˜¯æ¯”è¾ƒç²¾ç»†åŒ–çš„ç®¡ç†ã€‚å¼¹æ€§æœ‰è§‚å¯Ÿè€…æ¨¡å¼è¿˜æœ‰è‡ªåŠ¨åŒ–æ‰§è¡Œï¼Œæ¯æ¬¡å¼¹æ€§å®Œä»¥åæœ‰ä¸€ä¸ªæ§åˆ¶å°ï¼ŒåŒ11åšå…¨å¹´å‹æµ‹çš„æ—¶å€™ä¸€èˆ¬æƒ…å†µä¸‹ä¸çœ‹è¿™ä¸ªã€‚</li>
</ul>
</li>
</ul>
<p>ä¸ªäººè§‰å¾—æœ¬æ–‡å†…å®¹æ€»ç»“çš„ç›¸å½“å¥½,å…·æœ‰å¾ˆé«˜çš„å‚è€ƒæ„ä¹‰å’Œä»·å€¼,æ•…åšæ•´ç†,æ–¹ä¾¿é˜…è¯»!</p>
<p><a href="https://segmentfault.com/a/1190000014088336" target="_blank" rel="noopener">åŸæ–‡é“¾æ¥</a><br><a href="http://dbaplus.cn/news-134-1876-1.html" target="_blank" rel="noopener">å‚è€ƒæ–‡ç« </a>  </p>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¨èå‡ ä¸ªå¥½ç”¨çš„DevOpså°å·¥å…·</title>
    <url>/2020/04/30/%E6%8E%A8%E8%8D%90%E5%87%A0%E4%B8%AA%E5%A5%BD%E7%94%A8%E7%9A%84DevOps%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="å·¥å…·æ¨è"><a href="#å·¥å…·æ¨è" class="headerlink" title="å·¥å…·æ¨è"></a>å·¥å…·æ¨è</h2><ol>
<li>æ–‡æ¡£ç®¡ç†</li>
</ol>
<ul>
<li>wiki</li>
<li>MM-wiki</li>
<li>gitbook(æ¨è)</li>
<li>Docusaurus(æ¨è)</li>
<li>hexo</li>
</ul>
<ol start="2">
<li>bugç®¡ç†</li>
</ol>
<ul>
<li>git-bug</li>
<li>è‰é“</li>
<li>Readme</li>
</ul>
<ol start="3">
<li>code review</li>
</ol>
<ul>
<li>Phabricator(PHA)</li>
</ul>
<ol start="4">
<li>markdown ç»˜å›¾å·¥å…·</li>
</ol>
<ul>
<li>PlantUML</li>
<li>Graphviz</li>
<li>Mermaid</li>
</ul>
]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title>è¿ç»´çŸ¥è¯†ä½“ç³»</title>
    <url>/2020/04/20/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/</url>
    <content><![CDATA[<p><img src="/2020/04/20/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB/%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BBV1.0.png" alt="è¿ç»´çŸ¥è¯†ä½“ç³»"></p>
]]></content>
      <categories>
        <category>SRE</category>
      </categories>
      <tags>
        <tag>SRE</tag>
      </tags>
  </entry>
  <entry>
    <title>ä»€ä¹ˆæ˜¯RESTful APIä»¥åŠDjango RestFramework</title>
    <url>/2020/04/20/%E4%BB%80%E4%B9%88%E6%98%AFRESTful-API%E4%BB%A5%E5%8F%8ADjango-RestFramework/</url>
    <content><![CDATA[<h2 id="ä¸€-ä»€ä¹ˆæ˜¯RESTful-APIä»¥åŠDjango-RestFramework"><a href="#ä¸€-ä»€ä¹ˆæ˜¯RESTful-APIä»¥åŠDjango-RestFramework" class="headerlink" title="ä¸€. ä»€ä¹ˆæ˜¯RESTful APIä»¥åŠDjango RestFramework"></a>ä¸€. ä»€ä¹ˆæ˜¯RESTful APIä»¥åŠDjango RestFramework</h2><h3 id="1-åè®®"><a href="#1-åè®®" class="headerlink" title="1. åè®®"></a>1. åè®®</h3><p>APIä¸ç”¨æˆ·çš„é€šä¿¡åè®®ï¼Œæ€»æ˜¯ä½¿ç”¨HTTPSåè®®ã€‚</p>
<h3 id="2-åŸŸå"><a href="#2-åŸŸå" class="headerlink" title="2. åŸŸå"></a>2. åŸŸå</h3><ul>
<li>åº”è¯¥å°½é‡å°†APIéƒ¨ç½²åœ¨ä¸“ç”¨åŸŸåä¹‹ä¸‹(å­˜åœ¨è·¨åŸŸé—®é¢˜): <a href="https://api.example.com" target="_blank" rel="noopener">https://api.example.com</a></li>
<li>å¦‚æœç¡®å®šAPIå¾ˆç®€å•ï¼Œä¸ä¼šæœ‰è¿›ä¸€æ­¥æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨ä¸»åŸŸåä¸‹: <a href="https://example.org/api/" target="_blank" rel="noopener">https://example.org/api/</a></li>
</ul>
<h3 id="3-ç‰ˆæœ¬"><a href="#3-ç‰ˆæœ¬" class="headerlink" title="3. ç‰ˆæœ¬"></a>3. ç‰ˆæœ¬</h3><p>åº”è¯¥å°†APIçš„ç‰ˆæœ¬å·æ”¾å…¥URL: <a href="https://api.example.com/v1/" target="_blank" rel="noopener">https://api.example.com/v1/</a><br>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œå°†ç‰ˆæœ¬å·æ”¾åœ¨HTTPå¤´ä¿¡æ¯ä¸­ï¼Œä½†ä¸å¦‚æ”¾å…¥URLæ–¹ä¾¿å’Œç›´è§‚ã€‚<a href="https://developer.github.com/v3/media/#request-specific-version" target="_blank" rel="noopener">GitHub Developer Guide</a>é‡‡ç”¨è¿™ç§åšæ³•,è·¨åŸŸæ—¶ä¼šå¼•å‘å¤šæ¬¡è¯·æ±‚</p>
<h3 id="4-è·¯å¾„-Endpoint"><a href="#4-è·¯å¾„-Endpoint" class="headerlink" title="4. è·¯å¾„(Endpoint)"></a>4. è·¯å¾„(Endpoint)</h3><p>è·¯å¾„åˆç§°â€ç»ˆç‚¹â€ï¼ˆendpointï¼‰ï¼Œè¡¨ç¤ºAPIçš„å…·ä½“ç½‘å€ã€‚<br>åœ¨RESTfulæ¶æ„ä¸­ï¼Œæ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼ˆresourceï¼‰ï¼Œæ‰€ä»¥ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯å¾€å¾€ä¸æ•°æ®åº“çš„è¡¨æ ¼åå¯¹åº”ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®åº“ä¸­çš„è¡¨éƒ½æ˜¯åŒç§è®°å½•çš„â€é›†åˆâ€ï¼ˆcollectionï¼‰ï¼Œæ‰€ä»¥APIä¸­çš„åè¯ä¹Ÿåº”è¯¥ä½¿ç”¨å¤æ•°ã€‚<br>ä¸¾ä¾‹æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªAPIæä¾›åŠ¨ç‰©å›­ï¼ˆzooï¼‰çš„ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬å„ç§åŠ¨ç‰©å’Œé›‡å‘˜çš„ä¿¡æ¯ï¼Œåˆ™å®ƒçš„è·¯å¾„åº”è¯¥è®¾è®¡æˆä¸‹é¢è¿™æ ·ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;api.example.com&#x2F;v1&#x2F;zoos</span><br><span class="line">https:&#x2F;&#x2F;api.example.com&#x2F;v1&#x2F;animals</span><br><span class="line">https:&#x2F;&#x2F;api.example.com&#x2F;v1&#x2F;employees</span><br></pre></td></tr></table></figure>

<h3 id="5-HTTPåŠ¨è¯"><a href="#5-HTTPåŠ¨è¯" class="headerlink" title="5. HTTPåŠ¨è¯"></a>5. HTTPåŠ¨è¯</h3><p>å¯¹äºèµ„æºçš„å…·ä½“æ“ä½œç±»å‹ï¼Œç”±HTTPåŠ¨è¯è¡¨ç¤ºã€‚<br>å¸¸ç”¨çš„HTTPåŠ¨è¯æœ‰ä¸‹é¢äº”ä¸ª(æ‹¬å·é‡Œæ˜¯å¯¹åº”çš„SQLå‘½ä»¤)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GETï¼ˆSELECTï¼‰ï¼šä»æœåŠ¡å™¨å–å‡ºèµ„æºï¼ˆä¸€é¡¹æˆ–å¤šé¡¹ï¼‰</span><br><span class="line">POSTï¼ˆCREATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ–°å»ºä¸€ä¸ªèµ„æº</span><br><span class="line">PUTï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜åçš„å®Œæ•´èµ„æºï¼‰</span><br><span class="line">PATCHï¼ˆUPDATEï¼‰ï¼šåœ¨æœåŠ¡å™¨æ›´æ–°èµ„æºï¼ˆå®¢æˆ·ç«¯æä¾›æ”¹å˜çš„å±æ€§ï¼‰</span><br><span class="line">DELETEï¼ˆDELETEï¼‰ï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æº</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸¤ä¸ªä¸å¸¸ç”¨çš„HTTPåŠ¨è¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HEADï¼šè·å–èµ„æºçš„å…ƒæ•°æ®</span><br><span class="line">OPTIONSï¼šè·å–ä¿¡æ¯ï¼Œå…³äºèµ„æºçš„å“ªäº›å±æ€§æ˜¯å®¢æˆ·ç«¯å¯ä»¥æ”¹å˜çš„</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯ä¸€äº›æ —å­:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;zoosï¼šåˆ—å‡ºæ‰€æœ‰åŠ¨ç‰©å›­</span><br><span class="line">POST &#x2F;zoosï¼šæ–°å»ºä¸€ä¸ªåŠ¨ç‰©å›­</span><br><span class="line">GET &#x2F;zoos&#x2F;IDï¼šè·å–æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯</span><br><span class="line">PUT &#x2F;zoos&#x2F;IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„å…¨éƒ¨ä¿¡æ¯ï¼‰</span><br><span class="line">PATCH &#x2F;zoos&#x2F;IDï¼šæ›´æ–°æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„ä¿¡æ¯ï¼ˆæä¾›è¯¥åŠ¨ç‰©å›­çš„éƒ¨åˆ†ä¿¡æ¯ï¼‰</span><br><span class="line">DELETE &#x2F;zoos&#x2F;IDï¼šåˆ é™¤æŸä¸ªåŠ¨ç‰©å›­</span><br><span class="line">GET &#x2F;zoos&#x2F;ID&#x2F;animalsï¼šåˆ—å‡ºæŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æ‰€æœ‰åŠ¨ç‰©</span><br><span class="line">DELETE &#x2F;zoos&#x2F;ID&#x2F;animals&#x2F;IDï¼šåˆ é™¤æŸä¸ªæŒ‡å®šåŠ¨ç‰©å›­çš„æŒ‡å®šåŠ¨ç‰©</span><br></pre></td></tr></table></figure>

<h3 id="6-è¿‡æ»¤ä¿¡æ¯-Filtering"><a href="#6-è¿‡æ»¤ä¿¡æ¯-Filtering" class="headerlink" title="6. è¿‡æ»¤ä¿¡æ¯(Filtering)"></a>6. è¿‡æ»¤ä¿¡æ¯(Filtering)</h3><p>å¦‚æœè®°å½•æ•°é‡å¾ˆå¤š,æœåŠ¡å™¨ä¸å¯èƒ½éƒ½å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·.APIåº”è¯¥æä¾›å‚æ•°,è¿‡æ»¤è¿”å›ç»“æœ<br>å¸¸è§çš„å‚æ•°å½¢å¼å¦‚ä¸‹:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?limit&#x3D;10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡</span><br><span class="line">?offset&#x3D;10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®ã€‚</span><br><span class="line">?page&#x3D;2&amp;per_page&#x3D;100ï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°ã€‚</span><br><span class="line">?sortby&#x3D;name&amp;order&#x3D;ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåºã€‚</span><br><span class="line">?animal_type_id&#x3D;1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶</span><br></pre></td></tr></table></figure>
<p>å‚æ•°çš„è®¾è®¡å…è®¸å­˜åœ¨å†—ä½™ï¼Œå³å…è®¸APIè·¯å¾„å’ŒURLå‚æ•°å¶å°”æœ‰é‡å¤ã€‚æ¯”å¦‚ï¼ŒGET /zoo/ID/animals ä¸ GET /animals?zoo_id=ID çš„å«ä¹‰æ˜¯ç›¸åŒçš„ã€‚</p>
<h3 id="7-çŠ¶æ€ç -Status-Codes"><a href="#7-çŠ¶æ€ç -Status-Codes" class="headerlink" title="7. çŠ¶æ€ç (Status Codes)"></a>7. çŠ¶æ€ç (Status Codes)</h3><p>æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„çŠ¶æ€ç å’Œæç¤ºä¿¡æ¯ï¼Œå¸¸è§çš„æœ‰ä»¥ä¸‹ä¸€äº›(æ–¹æ‹¬å·ä¸­æ˜¯è¯¥çŠ¶æ€ç å¯¹åº”çš„HTTPåŠ¨è¯)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">200 OK - [GET]ï¼šæœåŠ¡å™¨æˆåŠŸè¿”å›ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ï¼ˆIdempotentï¼‰ã€‚</span><br><span class="line">201 CREATED - [POST&#x2F;PUT&#x2F;PATCH]ï¼šç”¨æˆ·æ–°å»ºæˆ–ä¿®æ”¹æ•°æ®æˆåŠŸã€‚</span><br><span class="line">202 Accepted - [*]ï¼šè¡¨ç¤ºä¸€ä¸ªè¯·æ±‚å·²ç»è¿›å…¥åå°æ’é˜Ÿï¼ˆå¼‚æ­¥ä»»åŠ¡ï¼‰</span><br><span class="line">204 NO CONTENT - [DELETE]ï¼šç”¨æˆ·åˆ é™¤æ•°æ®æˆåŠŸã€‚</span><br><span class="line">400 INVALID REQUEST - [POST&#x2F;PUT&#x2F;PATCH]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚æœ‰é”™è¯¯ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ–°å»ºæˆ–ä¿®æ”¹æ•°æ®çš„æ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</span><br><span class="line">401 Unauthorized - [*]ï¼šè¡¨ç¤ºç”¨æˆ·æ²¡æœ‰æƒé™ï¼ˆä»¤ç‰Œã€ç”¨æˆ·åã€å¯†ç é”™è¯¯ï¼‰ã€‚</span><br><span class="line">403 Forbidden - [*] è¡¨ç¤ºç”¨æˆ·å¾—åˆ°æˆæƒï¼ˆä¸401é”™è¯¯ç›¸å¯¹ï¼‰ï¼Œä½†æ˜¯è®¿é—®æ˜¯è¢«ç¦æ­¢çš„ã€‚</span><br><span class="line">404 NOT FOUND - [*]ï¼šç”¨æˆ·å‘å‡ºçš„è¯·æ±‚é’ˆå¯¹çš„æ˜¯ä¸å­˜åœ¨çš„è®°å½•ï¼ŒæœåŠ¡å™¨æ²¡æœ‰è¿›è¡Œæ“ä½œï¼Œè¯¥æ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</span><br><span class="line">406 Not Acceptable - [GET]ï¼šç”¨æˆ·è¯·æ±‚çš„æ ¼å¼ä¸å¯å¾—ï¼ˆæ¯”å¦‚ç”¨æˆ·è¯·æ±‚JSONæ ¼å¼ï¼Œä½†æ˜¯åªæœ‰XMLæ ¼å¼ï¼‰ã€‚</span><br><span class="line">410 Gone -[GET]ï¼šç”¨æˆ·è¯·æ±‚çš„èµ„æºè¢«æ°¸ä¹…åˆ é™¤ï¼Œä¸”ä¸ä¼šå†å¾—åˆ°çš„ã€‚</span><br><span class="line">422 Unprocesable entity - [POST&#x2F;PUT&#x2F;PATCH] å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå‘ç”Ÿä¸€ä¸ªéªŒè¯é”™è¯¯ã€‚</span><br><span class="line">500 INTERNAL SERVER ERROR - [*]ï¼šæœåŠ¡å™¨å‘ç”Ÿé”™è¯¯ï¼Œç”¨æˆ·å°†æ— æ³•åˆ¤æ–­å‘å‡ºçš„è¯·æ±‚æ˜¯å¦æˆåŠŸ</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„: çŠ¶æ€ç çš„å®Œå…¨åˆ—è¡¨å‚è§<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank" rel="noopener">è¿™é‡Œ</a></p>
<h3 id="8-é”™è¯¯å¤„ç†-Error-handling"><a href="#8-é”™è¯¯å¤„ç†-Error-handling" class="headerlink" title="8. é”™è¯¯å¤„ç†(Error handling)"></a>8. é”™è¯¯å¤„ç†(Error handling)</h3><p>å¦‚æœçŠ¶æ€ç æ˜¯4xxï¼Œå°±åº”è¯¥å‘ç”¨æˆ·è¿”å›å‡ºé”™ä¿¡æ¯ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿”å›çš„ä¿¡æ¯ä¸­å°†errorä½œä¸ºé”®åï¼Œå‡ºé”™ä¿¡æ¯ä½œä¸ºé”®å€¼å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    error: &quot;Invalid API key&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-è¿”å›ç»“æœ"><a href="#9-è¿”å›ç»“æœ" class="headerlink" title="9. è¿”å›ç»“æœ"></a>9. è¿”å›ç»“æœ</h3><p>é’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET &#x2F;collectionï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰</span><br><span class="line">GET &#x2F;collection&#x2F;resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡</span><br><span class="line">POST &#x2F;collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡</span><br><span class="line">PUT &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</span><br><span class="line">PATCH &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡</span><br><span class="line">DELETE &#x2F;collection&#x2F;resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£</span><br></pre></td></tr></table></figure>

<h3 id="10-Hypermedia-API"><a href="#10-Hypermedia-API" class="headerlink" title="10. Hypermedia API"></a>10. Hypermedia API</h3><p>RESTful APIæœ€å¥½åšåˆ°Hypermediaï¼Œå³è¿”å›ç»“æœä¸­æä¾›é“¾æ¥ï¼Œè¿å‘å…¶ä»–APIæ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·ä¸æŸ¥æ–‡æ¡£ï¼Œä¹ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆã€‚<br>æ¯”å¦‚ï¼Œå½“ç”¨æˆ·å‘api.example.comçš„æ ¹ç›®å½•å‘å‡ºè¯·æ±‚ï¼Œä¼šå¾—åˆ°è¿™æ ·ä¸€ä¸ªæ–‡æ¡£:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&quot;link&quot;: &#123;</span><br><span class="line">  &quot;rel&quot;:   &quot;collection https:&#x2F;&#x2F;www.example.com&#x2F;zoos&quot;,</span><br><span class="line">  &quot;href&quot;:  &quot;https:&#x2F;&#x2F;api.example.com&#x2F;zoos&quot;,</span><br><span class="line">  &quot;title&quot;: &quot;List of zoos&quot;,</span><br><span class="line">  &quot;type&quot;:  &quot;application&#x2F;vnd.yourformat+json&quot;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œæ–‡æ¡£ä¸­æœ‰ä¸€ä¸ªlinkå±æ€§ï¼Œç”¨æˆ·è¯»å–è¿™ä¸ªå±æ€§å°±çŸ¥é“ä¸‹ä¸€æ­¥è¯¥è°ƒç”¨ä»€ä¹ˆAPIäº†ã€‚relè¡¨ç¤ºè¿™ä¸ªAPIä¸å½“å‰ç½‘å€çš„å…³ç³»ï¼ˆcollectionå…³ç³»ï¼Œå¹¶ç»™å‡ºè¯¥collectionçš„ç½‘å€ï¼‰ï¼Œhrefè¡¨ç¤ºAPIçš„è·¯å¾„ï¼Œtitleè¡¨ç¤ºAPIçš„æ ‡é¢˜ï¼Œtypeè¡¨ç¤ºè¿”å›ç±»å‹ã€‚<br>Hypermedia APIçš„è®¾è®¡è¢«ç§°ä¸ºHATEOASã€‚Githubçš„APIå°±æ˜¯è¿™ç§è®¾è®¡ï¼Œè®¿é—®api.github.comä¼šå¾—åˆ°ä¸€ä¸ªæ‰€æœ‰å¯ç”¨APIçš„ç½‘å€åˆ—è¡¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;current_user_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;user&quot;,</span><br><span class="line">  &quot;authorizations_url&quot;: &quot;https:&#x2F;&#x2F;api.github.com&#x2F;authorizations&quot;,</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæƒ³è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåº”è¯¥å»è®¿é—®\api.github.com/userï¼Œç„¶åå°±å¾—åˆ°äº†ä¸‹é¢ç»“æœ:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;message&quot;: &quot;Requires authentication&quot;,</span><br><span class="line">  &quot;documentation_url&quot;: &quot;https:&#x2F;&#x2F;developer.github.com&#x2F;v3&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼ŒæœåŠ¡å™¨ç»™å‡ºäº†æç¤ºä¿¡æ¯ï¼Œä»¥åŠæ–‡æ¡£çš„ç½‘å€</p>
<h3 id="11-å…¶ä»–"><a href="#11-å…¶ä»–" class="headerlink" title="11. å…¶ä»–"></a>11. å…¶ä»–</h3><ul>
<li>APIçš„èº«ä»½è®¤è¯åº”è¯¥ä½¿ç”¨<a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">OAuth 2.0</a>æ¡†æ¶ã€‚</li>
<li>æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼ï¼Œåº”è¯¥å°½é‡ä½¿ç”¨JSONï¼Œé¿å…ä½¿ç”¨XMLã€‚</li>
</ul>
<p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="noopener">RESTful API è®¾è®¡æŒ‡å— - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a><br><a href="https://github.com/aisuhua/restful-api-design-references" target="_blank" rel="noopener">GitHub - aisuhua/restful-api-design-references: RESTful API è®¾è®¡å‚è€ƒæ–‡çŒ®åˆ—è¡¨</a>  </p>
<h2 id="äºŒ-åŸºäºDjangoçš„å®ç°"><a href="#äºŒ-åŸºäºDjangoçš„å®ç°" class="headerlink" title="äºŒ. åŸºäºDjangoçš„å®ç°"></a>äºŒ. åŸºäºDjangoçš„å®ç°</h2><h3 id="2-1-è·¯ç”±ç³»ç»Ÿ"><a href="#2-1-è·¯ç”±ç³»ç»Ÿ" class="headerlink" title="2.1 è·¯ç”±ç³»ç»Ÿ"></a>2.1 è·¯ç”±ç³»ç»Ÿ</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from app01 import views</span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^users&#39;, views.UserView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="2-2-CBVè¯•å›¾"><a href="#2-2-CBVè¯•å›¾" class="headerlink" title="2.2 CBVè¯•å›¾"></a>2.2 CBVè¯•å›¾</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class UserView(View):</span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        result &#x3D; &#123;&quot;status&quot;: True, &quot;data&quot;: &quot;This is a get request&quot;, &quot;msg&quot;: None, &quot;code&quot;: 2000&#125;</span><br><span class="line">        return JsonResponse(result, status&#x3D;200)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        result &#x3D; &#123;&quot;status&quot;: True, &quot;data&quot;: &quot;This is a post request&quot;, &quot;msg&quot;: None, &quot;code&quot;: 2000&#125;</span><br><span class="line">        return JsonResponse(result, status&#x3D;200)</span><br></pre></td></tr></table></figure>

<h2 id="ä¸‰-åŸºäºDjango-Rest-Framework-æ¡†æ¶å®ç°"><a href="#ä¸‰-åŸºäºDjango-Rest-Framework-æ¡†æ¶å®ç°" class="headerlink" title="ä¸‰. åŸºäºDjango Rest Framework æ¡†æ¶å®ç°"></a>ä¸‰. åŸºäºDjango Rest Framework æ¡†æ¶å®ç°</h2><h3 id="3-1-åŸºæœ¬æµç¨‹"><a href="#3-1-åŸºæœ¬æµç¨‹" class="headerlink" title="3.1 åŸºæœ¬æµç¨‹"></a>3.1 åŸºæœ¬æµç¨‹</h3><p>è·¯ç”±:URL.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^index&#39;, views.IndexView.as_view())</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾: views.py</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line">class IndexView(APIView):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è¯·æ±‚åˆ°æ¥ä¹‹åï¼Œéƒ½è¦æ‰§è¡Œdispatchæ–¹æ³•ï¼Œdispatchæ–¹æ³•æ ¹æ®è¯·æ±‚æ–¹å¼ä¸åŒè§¦å‘åå°„ get&#x2F;post&#x2F;put ç­‰æ–¹æ³•</span><br><span class="line">    æ³¨æ„ï¼šAPIViewä¸­çš„dispatchæ–¹æ³•æœ‰å¥½å¤šå¥½å¤šçš„åŠŸèƒ½</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def dispatch(self, request, *args, **kwargs):</span><br><span class="line">        return super().dispatch(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br></pre></td></tr></table></figure>
<p>âš ï¸ : ä»¥ä¸Šæ˜¯Django rest frameworkæ¡†æ¶åŸºæœ¬æµç¨‹,é‡è¦çš„åŠŸèƒ½æ˜¯åœ¨APIViewçš„dispatchä¸­è§¦å‘,ä¹Ÿæ˜¯æ¡†æ¶çš„æºç å…¥å£</p>
<h3 id="3-2-è®¤è¯å’Œæˆæƒ"><a href="#3-2-è®¤è¯å’Œæˆæƒ" class="headerlink" title="3.2 è®¤è¯å’Œæˆæƒ"></a>3.2 è®¤è¯å’Œæˆæƒ</h3><h4 id="3-2-1-åŸºäºtokençš„éªŒè¯"><a href="#3-2-1-åŸºäºtokençš„éªŒè¯" class="headerlink" title="3.2.1 åŸºäºtokençš„éªŒè¯"></a>3.2.1 åŸºäºtokençš„éªŒè¯</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    url(r&#39;^api&#x2F;(?P&lt;version&gt;\w+)&#x2F;&#39;, include(&#39;app01.urls&#39;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ cat app01&#x2F;urls.py </span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^auth&#x2F;$&#39;, views.AuthView.as_view()),</span><br><span class="line">    url(r&#39;^user&#x2F;$&#39;, views.UserView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat models.py </span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    username &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    password &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserToken(models.Model):</span><br><span class="line">    user &#x3D; models.OneToOneField(&#39;UserInfo&#39;, on_delete&#x3D;True)</span><br><span class="line">    token &#x3D; models.CharField(max_length&#x3D;64)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat views.py</span><br><span class="line">from django.shortcuts import render, HttpResponse</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from app01 import models</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line">class AuthView(APIView):</span><br><span class="line">    authentication_classes &#x3D; []    # ç™»å½•è®¤è¯æ¥å£è¦†ç›–é»˜è®¤çš„toeknè®¤è¯ç±»</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        response &#x3D; &#123;&#39;code&#39;: 1000&#125;</span><br><span class="line">        user &#x3D; request.data.get(&#39;username&#39;)</span><br><span class="line">        pwd &#x3D; request.data.get(&#39;password&#39;)</span><br><span class="line"></span><br><span class="line">        obj &#x3D; models.UserInfo.objects.filter(username&#x3D;user, password&#x3D;pwd).first()</span><br><span class="line">        if not obj:</span><br><span class="line">            response[&#39;code&#39;] &#x3D; 1001</span><br><span class="line">            response[&#39;msg&#39;] &#x3D; &#39;ç”¨æˆ·æˆ–å¯†ç é”™è¯¯&#39;</span><br><span class="line">            return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            response[&#39;token&#39;] &#x3D; token</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line">        return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserView(APIView):</span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return HttpResponse(&#39;user.get: %s&#39; % request.user)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return HttpResponse(&#39;user.post&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat app01&#x2F;utils&#x2F;auth.py</span><br><span class="line"></span><br><span class="line">from rest_framework.authentication import BaseAuthentication</span><br><span class="line">from rest_framework.exceptions import AuthenticationFailed</span><br><span class="line">from app01 import models</span><br><span class="line"></span><br><span class="line">class TokenAuthtication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        (user,auth) è¡¨ç¤ºè®¤è¯æˆåŠŸ,å¹¶å°†å…ƒç»„åˆ†åˆ«èµ‹å€¼ç»™request.user&#x2F;request.auth</span><br><span class="line">        :raise AuthenticationFailed(&#39;è®¤è¯å¤±è´¥&#39;)  è¡¨ç¤ºè®¤è¯å¤±è´¥</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        token &#x3D; request.query_params.get(&#39;token&#39;)</span><br><span class="line">        if not token:</span><br><span class="line">            raise AuthenticationFailed(&quot;ç”¨æˆ·Tokenæœªæºå¸¦&quot;)</span><br><span class="line"></span><br><span class="line">        token_obj &#x3D; models.UserToken.objects.filter(token&#x3D;token).first()</span><br><span class="line">        if not token_obj:</span><br><span class="line">            raise AuthenticationFailed(&quot;Tokenå·²å¤±æ•ˆæˆ–é”™è¯¯&quot;)</span><br><span class="line">        return (token_obj.user.username, token_obj)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat settings.py</span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: [&#39;app01.utils.auth.TokenAuthtication&#39;, ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯:</p>
<ol>
<li>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æ„é€ è¯·æ±‚ç™»å½•çš„ç”¨æˆ·åå¯†ç </li>
<li>æ„é€ æ•°æ®è·å–tokenä¿¡æ¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X POST \</span><br><span class="line">&gt;   http:&#x2F;&#x2F;127.0.0.1:8001&#x2F;api&#x2F;v1&#x2F;auth&#x2F; \</span><br><span class="line">&gt;   -H &#39;Cache-Control: no-cache&#39; \</span><br><span class="line">&gt;   -H &#39;Content-Type: application&#x2F;json&#39; \</span><br><span class="line">&gt;   -H &#39;Postman-Token: 8439ce0a-94ff-3970-c8c2-4c6bc200bb4f&#39; \</span><br><span class="line">&gt;   -d &#39;&#123;&quot;username&quot;: &quot;eric&quot;,&quot;password&quot;:&quot;123&quot;&#125;&#39;</span><br><span class="line">è¿”å›:</span><br><span class="line">&#123;&quot;code&quot;: 1000, &quot;token&quot;: &quot;4c90f696-008b-4e30-86fa-4b00b6fc9237&quot;&#125;</span><br></pre></td></tr></table></figure></li>
<li>æºå¸¦tokenè®¿é—®useræ¥å£,è·å–ç”¨æˆ·ä¿¡æ¯<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt;   &#39;http:&#x2F;&#x2F;127.0.0.1:8001&#x2F;api&#x2F;v1&#x2F;user&#x2F;?token&#x3D;4c90f696-008b-4e30-86fa-4b00b6fc9237&#39; \</span><br><span class="line">&gt;   -H &#39;Cache-Control: no-cache&#39; \</span><br><span class="line">&gt;   -H &#39;Postman-Token: 1b4125ad-7ad1-1cca-70fd-6a00cca16d96&#39;</span><br><span class="line">è¿”å›:</span><br><span class="line">user.get: eric</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-2-2-åŸºäºè¯·æ±‚å¤´è®¤è¯"><a href="#3-2-2-åŸºäºè¯·æ±‚å¤´è®¤è¯" class="headerlink" title="3.2.2 åŸºäºè¯·æ±‚å¤´è®¤è¯"></a>3.2.2 åŸºäºè¯·æ±‚å¤´è®¤è¯</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    url(r&#39;^api&#x2F;(?P&lt;version&gt;\w+)&#x2F;&#39;, include(&#39;app01.urls&#39;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ cat app01&#x2F;urls.py </span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^auth&#x2F;$&#39;, views.AuthView.as_view()),</span><br><span class="line">    url(r&#39;^user&#x2F;$&#39;, views.UserView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat app01&#x2F;utils&#x2F;auth.py</span><br><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;6&#x2F;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from rest_framework.authentication import BaseAuthentication</span><br><span class="line">from rest_framework.exceptions import AuthenticationFailed</span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from app01 import models</span><br><span class="line"></span><br><span class="line">class HeaderAuthentication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ç”¨æˆ·è®¤è¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸåè¿”å›å…ƒç»„ï¼š (ç”¨æˆ·,ç”¨æˆ·Token)</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">            None,è¡¨ç¤ºè·³è¿‡è¯¥éªŒè¯ï¼›</span><br><span class="line">                å¦‚æœè·³è¿‡äº†æ‰€æœ‰è®¤è¯ï¼Œé»˜è®¤ç”¨æˆ·å’ŒTokenå’Œä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®</span><br><span class="line">                self._authenticator &#x3D; None</span><br><span class="line">                if api_settings.UNAUTHENTICATED_USER:</span><br><span class="line">                    self.user &#x3D; api_settings.UNAUTHENTICATED_USER()</span><br><span class="line">                else:</span><br><span class="line">                    self.user &#x3D; None</span><br><span class="line"></span><br><span class="line">                if api_settings.UNAUTHENTICATED_TOKEN:</span><br><span class="line">                    self.auth &#x3D; api_settings.UNAUTHENTICATED_TOKEN()</span><br><span class="line">                else:</span><br><span class="line">                    self.auth &#x3D; None</span><br><span class="line">            (user,token)è¡¨ç¤ºéªŒè¯é€šè¿‡å¹¶è®¾ç½®ç”¨æˆ·åå’ŒTokenï¼›</span><br><span class="line">            AuthenticationFailedå¼‚å¸¸</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        import base64</span><br><span class="line">        import uuid</span><br><span class="line">        auth &#x3D; request.META.get(&#39;HTTP_AUTHORIZATION&#39;, b&#39;&#39;)</span><br><span class="line">        if auth:</span><br><span class="line">            auth &#x3D; auth.encode(&#39;utf-8&#39;)</span><br><span class="line">        auth &#x3D; auth.split()</span><br><span class="line">        if not auth or auth[0].lower() !&#x3D; b&#39;basic&#39;:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        if len(auth) !&#x3D; 2:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        username, part, password &#x3D; base64.b64decode(auth[1]).decode(&#39;utf-8&#39;).partition(&#39;:&#39;)</span><br><span class="line">        try:</span><br><span class="line">            obj &#x3D; models.UserInfo.objects.filter(username&#x3D;username, password&#x3D;password).first()</span><br><span class="line">            if not obj:</span><br><span class="line">                raise exceptions.AuthenticationFailed(&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;)</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            token_obj, status &#x3D; models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            return (token_obj.user.username, token_obj)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line"></span><br><span class="line">    def authenticate_header(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Return a string to be used as the value of the &#96;WWW-Authenticate&#96;</span><br><span class="line">        header in a &#96;401 Unauthenticated&#96; response, or &#96;None&#96; if the</span><br><span class="line">        authentication scheme should return &#96;403 Permission Denied&#96; responses.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return &#39;Basic realm&#x3D;api&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat views.py</span><br><span class="line">from django.shortcuts import render, HttpResponse</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from app01.utils.auth import HeaderAuthentication</span><br><span class="line">from app01 import models</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AuthView(APIView):</span><br><span class="line">    authentication_classes &#x3D; []</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        response &#x3D; &#123;&#39;code&#39;: 1000&#125;</span><br><span class="line">        user &#x3D; request.data.get(&#39;username&#39;)</span><br><span class="line">        pwd &#x3D; request.data.get(&#39;password&#39;)</span><br><span class="line"></span><br><span class="line">        obj &#x3D; models.UserInfo.objects.filter(username&#x3D;user, password&#x3D;pwd).first()</span><br><span class="line">        if not obj:</span><br><span class="line">            response[&#39;code&#39;] &#x3D; 1001</span><br><span class="line">            response[&#39;msg&#39;] &#x3D; &#39;ç”¨æˆ·æˆ–å¯†ç é”™è¯¯&#39;</span><br><span class="line">            return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            response[&#39;token&#39;] &#x3D; token</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line">        return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserView(APIView):</span><br><span class="line">    authentication_classes &#x3D; [HeaderAuthentication, ]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return HttpResponse(&#39;user.get: %s,token: %s&#39; % (request.user, request.auth))</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return HttpResponse(&#39;user.post&#39;)</span><br></pre></td></tr></table></figure>
<p>éªŒè¯:</p>
<ol>
<li>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æ„é€ è¯·æ±‚ç™»å½•çš„ç”¨æˆ·åå¯†ç </li>
<li>æ„é€ æ•°æ®è·å–tokenä¿¡æ¯,å»ºè®®ä½¿ç”¨postmanè¿›è¡Œæ„é€ æµ‹è¯•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X GET \</span><br><span class="line">  http:&#x2F;&#x2F;127.0.0.1:8001&#x2F;api&#x2F;v1&#x2F;user&#x2F; \</span><br><span class="line">  -H &#39;Authorization: Basic c2h1a2U6MTIz&#39; \</span><br><span class="line">  -H &#39;Cache-Control: no-cache&#39; \</span><br><span class="line">  -H &#39;Postman-Token: ba3f99ce-da6a-7e5f-3e0b-3c79129ecca1&#39;</span><br><span class="line">è¿”å›:</span><br><span class="line">user.get: shuke,token: 2d3af34a-1598-4d5a-af56-7f29a706a26e</span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-å¤šä¸ªè®¤è¯è§„åˆ™"><a href="#3-2-3-å¤šä¸ªè®¤è¯è§„åˆ™" class="headerlink" title="3.2.3 å¤šä¸ªè®¤è¯è§„åˆ™"></a>3.2.3 å¤šä¸ªè®¤è¯è§„åˆ™</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    url(r&#39;^api&#x2F;(?P&lt;version&gt;\w+)&#x2F;&#39;, include(&#39;app01.urls&#39;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ cat app01&#x2F;urls.py </span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^auth&#x2F;$&#39;, views.AuthView.as_view()),</span><br><span class="line">    url(r&#39;^user&#x2F;$&#39;, views.UserView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat app01&#x2F;utils&#x2F;auth.py</span><br><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;6&#x2F;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from rest_framework.authentication import BaseAuthentication</span><br><span class="line">from rest_framework.exceptions import AuthenticationFailed</span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from app01 import models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TokenAuthtication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        (user,auth) è¡¨ç¤ºè®¤è¯æˆåŠŸ,å¹¶å°†å…ƒç»„åˆ†åˆ«èµ‹å€¼ç»™request.user&#x2F;request.auth</span><br><span class="line">        :raise AuthenticationFailed(&#39;è®¤è¯å¤±è´¥&#39;)  è¡¨ç¤ºè®¤è¯å¤±è´¥</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        token &#x3D; request.query_params.get(&#39;token&#39;)</span><br><span class="line">        if not token:</span><br><span class="line">            raise AuthenticationFailed(&quot;ç”¨æˆ·Tokenæœªæºå¸¦&quot;)</span><br><span class="line"></span><br><span class="line">        token_obj &#x3D; models.UserToken.objects.filter(token&#x3D;token).first()</span><br><span class="line">        if not token_obj:</span><br><span class="line">            raise AuthenticationFailed(&quot;Tokenå·²å¤±æ•ˆæˆ–é”™è¯¯&quot;)</span><br><span class="line">        return (token_obj.user.username, token_obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class HeaderAuthentication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ç”¨æˆ·è®¤è¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸåè¿”å›å…ƒç»„ï¼š (ç”¨æˆ·,ç”¨æˆ·Token)</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">            None,è¡¨ç¤ºè·³è¿‡è¯¥éªŒè¯ï¼›</span><br><span class="line">                å¦‚æœè·³è¿‡äº†æ‰€æœ‰è®¤è¯ï¼Œé»˜è®¤ç”¨æˆ·å’ŒTokenå’Œä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®</span><br><span class="line">                self._authenticator &#x3D; None</span><br><span class="line">                if api_settings.UNAUTHENTICATED_USER:</span><br><span class="line">                    self.user &#x3D; api_settings.UNAUTHENTICATED_USER()</span><br><span class="line">                else:</span><br><span class="line">                    self.user &#x3D; None</span><br><span class="line"></span><br><span class="line">                if api_settings.UNAUTHENTICATED_TOKEN:</span><br><span class="line">                    self.auth &#x3D; api_settings.UNAUTHENTICATED_TOKEN()</span><br><span class="line">                else:</span><br><span class="line">                    self.auth &#x3D; None</span><br><span class="line">            (user,token)è¡¨ç¤ºéªŒè¯é€šè¿‡å¹¶è®¾ç½®ç”¨æˆ·åå’ŒTokenï¼›</span><br><span class="line">            AuthenticationFailedå¼‚å¸¸</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        import base64</span><br><span class="line">        import uuid</span><br><span class="line">        auth &#x3D; request.META.get(&#39;HTTP_AUTHORIZATION&#39;, b&#39;&#39;)</span><br><span class="line">        if auth:</span><br><span class="line">            auth &#x3D; auth.encode(&#39;utf-8&#39;)</span><br><span class="line">        auth &#x3D; auth.split()</span><br><span class="line">        if not auth or auth[0].lower() !&#x3D; b&#39;basic&#39;:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        if len(auth) !&#x3D; 2:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        username, part, password &#x3D; base64.b64decode(auth[1]).decode(&#39;utf-8&#39;).partition(&#39;:&#39;)</span><br><span class="line">        try:</span><br><span class="line">            obj &#x3D; models.UserInfo.objects.filter(username&#x3D;username, password&#x3D;password).first()</span><br><span class="line">            if not obj:</span><br><span class="line">                raise exceptions.AuthenticationFailed(&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;)</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            token_obj, status &#x3D; models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            return (token_obj.user.username, token_obj)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line"></span><br><span class="line">    def authenticate_header(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Return a string to be used as the value of the &#96;WWW-Authenticate&#96;</span><br><span class="line">        header in a &#96;401 Unauthenticated&#96; response, or &#96;None&#96; if the</span><br><span class="line">        authentication scheme should return &#96;403 Permission Denied&#96; responses.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return &#39;Basic realm&#x3D;api&#39;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat views.py</span><br><span class="line">from django.shortcuts import render, HttpResponse</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from app01.utils.auth import HeaderAuthentication, TokenAuthtication</span><br><span class="line">from app01 import models</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AuthView(APIView):</span><br><span class="line">    authentication_classes &#x3D; []</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        response &#x3D; &#123;&#39;code&#39;: 1000&#125;</span><br><span class="line">        user &#x3D; request.data.get(&#39;username&#39;)</span><br><span class="line">        pwd &#x3D; request.data.get(&#39;password&#39;)</span><br><span class="line"></span><br><span class="line">        obj &#x3D; models.UserInfo.objects.filter(username&#x3D;user, password&#x3D;pwd).first()</span><br><span class="line">        if not obj:</span><br><span class="line">            response[&#39;code&#39;] &#x3D; 1001</span><br><span class="line">            response[&#39;msg&#39;] &#x3D; &#39;ç”¨æˆ·æˆ–å¯†ç é”™è¯¯&#39;</span><br><span class="line">            return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            response[&#39;token&#39;] &#x3D; token</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line">        return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserView(APIView):</span><br><span class="line">    authentication_classes &#x3D; [HeaderAuthentication, TokenAuthtication]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return HttpResponse(&#39;user.get: %s,token: %s&#39; % (request.user, request.auth))</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return HttpResponse(&#39;user.post&#39;)</span><br></pre></td></tr></table></figure>
éªŒè¯:</li>
<li>é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æ„é€ è¯·æ±‚ç™»å½•çš„ç”¨æˆ·åå¯†ç </li>
<li>æ„é€ æ•°æ®è·å–tokenä¿¡æ¯,å»ºè®®ä½¿ç”¨postmanè¿›è¡Œæ„é€ æµ‹è¯•<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ curl -X GET \</span><br><span class="line">  http:&#x2F;&#x2F;127.0.0.1:8001&#x2F;api&#x2F;v1&#x2F;user&#x2F; \</span><br><span class="line">  -H &#39;Authorization: Basic c2h1a2U6MTIz&#39; \</span><br><span class="line">  -H &#39;Cache-Control: no-cache&#39; \</span><br><span class="line">  -H &#39;Postman-Token: f91805b7-c742-b713-0010-c75cdbfbb24a&#39;</span><br><span class="line">è¿”å›:</span><br><span class="line">user.get: shuke,token: 9c3ca96a-ac03-4207-aaec-20433bae6058</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="3-2-4-è®¤è¯å’Œæƒé™"><a href="#3-2-4-è®¤è¯å’Œæƒé™" class="headerlink" title="3.2.4 è®¤è¯å’Œæƒé™"></a>3.2.4 è®¤è¯å’Œæƒé™</h4><p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    url(r&#39;^api&#x2F;(?P&lt;version&gt;\w+)&#x2F;&#39;, include(&#39;app01.urls&#39;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ cat app01&#x2F;urls.py </span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^auth&#x2F;$&#39;, views.AuthView.as_view()),</span><br><span class="line">    url(r&#39;^user&#x2F;$&#39;, views.UserView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>model</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"># Create your models here.</span><br><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    user_type_choices &#x3D; (</span><br><span class="line">        (1, &#39;æ™®é€šç”¨æˆ·&#39;),</span><br><span class="line">        (2, &#39;ç®¡ç†å‘˜&#39;),</span><br><span class="line">        (3, &#39;è¶…çº§ç®¡ç†å‘˜&#39;),</span><br><span class="line">    )</span><br><span class="line">    username &#x3D; models.CharField(max_length&#x3D;32)</span><br><span class="line">    password &#x3D; models.CharField(max_length&#x3D;64)</span><br><span class="line">    user_type &#x3D; models.IntegerField(choices&#x3D;user_type_choices, default&#x3D;1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserToken(models.Model):</span><br><span class="line">    user &#x3D; models.OneToOneField(&#39;UserInfo&#39;, on_delete&#x3D;True)</span><br><span class="line">    token &#x3D; models.CharField(max_length&#x3D;64)</span><br></pre></td></tr></table></figure>
<p>è®¤è¯</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat app01&#x2F;utils&#x2F;auth.py</span><br><span class="line"></span><br><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;6&#x2F;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">from rest_framework.authentication import BaseAuthentication</span><br><span class="line">from rest_framework.exceptions import AuthenticationFailed</span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from app01 import models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TokenAuthtication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        (user,auth) è¡¨ç¤ºè®¤è¯æˆåŠŸ,å¹¶å°†å…ƒç»„åˆ†åˆ«èµ‹å€¼ç»™request.user&#x2F;request.auth</span><br><span class="line">        :raise AuthenticationFailed(&#39;è®¤è¯å¤±è´¥&#39;)  è¡¨ç¤ºè®¤è¯å¤±è´¥</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        token &#x3D; request.query_params.get(&#39;token&#39;)</span><br><span class="line">        if not token:</span><br><span class="line">            raise AuthenticationFailed(&quot;ç”¨æˆ·Tokenæœªæºå¸¦&quot;)</span><br><span class="line"></span><br><span class="line">        token_obj &#x3D; models.UserToken.objects.filter(token&#x3D;token).first()</span><br><span class="line">        if not token_obj:</span><br><span class="line">            raise AuthenticationFailed(&quot;Tokenå·²å¤±æ•ˆæˆ–é”™è¯¯&quot;)</span><br><span class="line">        return (token_obj.user.username, token_obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class HeaderAuthentication(BaseAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ç”¨æˆ·è®¤è¯ï¼Œå¦‚æœéªŒè¯æˆåŠŸåè¿”å›å…ƒç»„ï¼š (ç”¨æˆ·,ç”¨æˆ·Token)</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">            None,è¡¨ç¤ºè·³è¿‡è¯¥éªŒè¯ï¼›</span><br><span class="line">                å¦‚æœè·³è¿‡äº†æ‰€æœ‰è®¤è¯ï¼Œé»˜è®¤ç”¨æˆ·å’ŒTokenå’Œä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®</span><br><span class="line">                self._authenticator &#x3D; None</span><br><span class="line">                if api_settings.UNAUTHENTICATED_USER:</span><br><span class="line">                    self.user &#x3D; api_settings.UNAUTHENTICATED_USER()</span><br><span class="line">                else:</span><br><span class="line">                    self.user &#x3D; None</span><br><span class="line"></span><br><span class="line">                if api_settings.UNAUTHENTICATED_TOKEN:</span><br><span class="line">                    self.auth &#x3D; api_settings.UNAUTHENTICATED_TOKEN()</span><br><span class="line">                else:</span><br><span class="line">                    self.auth &#x3D; None</span><br><span class="line">            (user,token)è¡¨ç¤ºéªŒè¯é€šè¿‡å¹¶è®¾ç½®ç”¨æˆ·åå’ŒTokenï¼›</span><br><span class="line">            AuthenticationFailedå¼‚å¸¸</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        import base64</span><br><span class="line">        import uuid</span><br><span class="line">        auth &#x3D; request.META.get(&#39;HTTP_AUTHORIZATION&#39;, b&#39;&#39;)</span><br><span class="line">        if auth:</span><br><span class="line">            auth &#x3D; auth.encode(&#39;utf-8&#39;)</span><br><span class="line">        auth &#x3D; auth.split()</span><br><span class="line">        if not auth or auth[0].lower() !&#x3D; b&#39;basic&#39;:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        if len(auth) !&#x3D; 2:</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line">        username, part, password &#x3D; base64.b64decode(auth[1]).decode(&#39;utf-8&#39;).partition(&#39;:&#39;)</span><br><span class="line">        try:</span><br><span class="line">            obj &#x3D; models.UserInfo.objects.filter(username&#x3D;username, password&#x3D;password).first()</span><br><span class="line">            if not obj:</span><br><span class="line">                raise exceptions.AuthenticationFailed(&#39;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&#39;)</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            token_obj, status &#x3D; models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            return (token_obj.user.username, token_obj)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line">            raise exceptions.AuthenticationFailed(&#39;éªŒè¯å¤±è´¥&#39;)</span><br><span class="line"></span><br><span class="line">    def authenticate_header(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Return a string to be used as the value of the &#96;WWW-Authenticate&#96;</span><br><span class="line">        header in a &#96;401 Unauthenticated&#96; response, or &#96;None&#96; if the</span><br><span class="line">        authentication scheme should return &#96;403 Permission Denied&#96; responses.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        return &#39;Basic realm&#x3D;api&#39;</span><br></pre></td></tr></table></figure>
<p>æƒé™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat app01&#x2F;utils&#x2F;permission.py</span><br><span class="line"></span><br><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># __author__ &#x3D; &quot;shuke&quot;</span><br><span class="line"># Date: 2018&#x2F;6&#x2F;3</span><br><span class="line">from rest_framework.permissions import BasePermission</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserPermission(BasePermission):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    æƒé™éªŒè¯</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def has_permission(self, request, view):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        åˆ¤æ–­æ˜¯å¦æœ‰æƒé™è®¿é—®å½“å‰è¯·æ±‚</span><br><span class="line">        Return &#96;True&#96; if permission is granted, &#96;False&#96; otherwise.</span><br><span class="line">        :param request:</span><br><span class="line">        :param view:</span><br><span class="line">        :return: Trueæœ‰æƒé™ï¼›Falseæ— æƒé™</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        user_type_id &#x3D; request.auth.user.user_type</span><br><span class="line">        if user_type_id &gt; 0:</span><br><span class="line">            return True</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    # GenericAPIViewä¸­get_objectæ—¶è°ƒç”¨</span><br><span class="line">    def has_object_permission(self, request, view, obj):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è§†å›¾ç»§æ‰¿GenericAPIViewï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨get_objectæ—¶è·å–å¯¹è±¡æ—¶ï¼Œè§¦å‘å•ç‹¬å¯¹è±¡æƒé™éªŒè¯</span><br><span class="line">        Return &#96;True&#96; if permission is granted, &#96;False&#96; otherwise.</span><br><span class="line">        :param request:</span><br><span class="line">        :param view:</span><br><span class="line">        :param obj:</span><br><span class="line">        :return: Trueæœ‰æƒé™ï¼›Falseæ— æƒé™</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        user_type_id &#x3D; request.auth.user.user_type</span><br><span class="line">        if user_type_id &gt; 0:</span><br><span class="line">            return True</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ManagerPermission(BasePermission):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    è§†å›¾ç»§æ‰¿GenericAPIViewï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨get_objectæ—¶è·å–å¯¹è±¡æ—¶ï¼Œè§¦å‘å•ç‹¬å¯¹è±¡æƒé™éªŒè¯</span><br><span class="line">    Return &#96;True&#96; if permission is granted, &#96;False&#96; otherwise.</span><br><span class="line">    :param request:</span><br><span class="line">    :param view:</span><br><span class="line">    :param obj:</span><br><span class="line">    :return: Trueæœ‰æƒé™ï¼›Falseæ— æƒé™</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def has_permission(self, request, view):</span><br><span class="line">        user_type_id &#x3D; request.auth.user.user_type</span><br><span class="line">        if user_type_id &gt; 1:</span><br><span class="line">            return True</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">    # GenericAPIViewä¸­get_objectæ—¶è°ƒç”¨</span><br><span class="line">    def has_object_permission(self, request, view, obj):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è§†å›¾ç»§æ‰¿GenericAPIViewï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨get_objectæ—¶è·å–å¯¹è±¡æ—¶ï¼Œè§¦å‘å•ç‹¬å¯¹è±¡æƒé™éªŒè¯</span><br><span class="line">        Return &#96;True&#96; if permission is granted, &#96;False&#96; otherwise.</span><br><span class="line">        :param request:</span><br><span class="line">        :param view:</span><br><span class="line">        :param obj:</span><br><span class="line">        :return: Trueæœ‰æƒé™ï¼›Falseæ— æƒé™</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        user_type_id &#x3D; request.auth.user.user_type</span><br><span class="line">        if user_type_id &gt; 1:</span><br><span class="line">            return True</span><br><span class="line">        return False</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾å‡½æ•°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.shortcuts import render, HttpResponse</span><br><span class="line"></span><br><span class="line"># Create your views here.</span><br><span class="line">from django.http import JsonResponse</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from app01.utils.auth import HeaderAuthentication, TokenAuthtication</span><br><span class="line">from app01.utils.permission import UserPermission, ManagerPermission</span><br><span class="line">from app01 import models</span><br><span class="line">import uuid</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class AuthView(APIView):</span><br><span class="line">    authentication_classes &#x3D; []</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        response &#x3D; &#123;&#39;code&#39;: 1000&#125;</span><br><span class="line">        user &#x3D; request.data.get(&#39;username&#39;)</span><br><span class="line">        pwd &#x3D; request.data.get(&#39;password&#39;)</span><br><span class="line"></span><br><span class="line">        obj &#x3D; models.UserInfo.objects.filter(username&#x3D;user, password&#x3D;pwd).first()</span><br><span class="line">        if not obj:</span><br><span class="line">            response[&#39;code&#39;] &#x3D; 1001</span><br><span class="line">            response[&#39;msg&#39;] &#x3D; &#39;ç”¨æˆ·æˆ–å¯†ç é”™è¯¯&#39;</span><br><span class="line">            return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line">        try:</span><br><span class="line">            token &#x3D; str(uuid.uuid4())</span><br><span class="line">            models.UserToken.objects.update_or_create(user&#x3D;obj, defaults&#x3D;&#123;&quot;token&quot;: token&#125;)</span><br><span class="line">            response[&#39;token&#39;] &#x3D; token</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&quot;Error: &quot;, e)</span><br><span class="line">        return JsonResponse(response, json_dumps_params&#x3D;&#123;&#39;ensure_ascii&#39;: False&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserView(APIView):</span><br><span class="line">    # è®¤è¯çš„åŠ¨ä½œæ˜¯ç”±request.userè§¦å‘</span><br><span class="line">    authentication_classes &#x3D; [HeaderAuthentication, TokenAuthtication]</span><br><span class="line"></span><br><span class="line">    # å¾ªç¯æ‰§è¡Œæ‰€æœ‰çš„æƒé™,å½“å‰è¯•å›¾åªå…è®¸ç®¡ç†å‘˜ä»¥ä¸Šæƒé™è®¿é—®</span><br><span class="line">    permission_classes &#x3D; [ManagerPermission, ]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return HttpResponse(&#39;user.get: %s,token: %s&#39; % (request.user, request.auth))</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return HttpResponse(&#39;user.post&#39;)</span><br></pre></td></tr></table></figure>
<p>éªŒè¯:<br><img src="https://note.youdao.com/yws/api/personal/file/WEB9df3ae98ed15b4c4725de0cc826fabe9?method=download&shareKey=f430295de0aa74cb2fa4f45b94d245ec" alt="æ— è®¿é—®æƒé™"><br><img src="https://note.youdao.com/yws/api/personal/file/WEBfa5e5818486654600b9b0563e7d4c262?method=download&shareKey=a547b0c96cdd95d95323c1fdbb9b2294" alt="æœ‰è®¿é—®æƒé™"></p>
<p>å…¨å±€åº”ç”¨æƒé™<br>ä¸Šè¿°æ“ä½œä¸­å‡æ˜¯å¯¹å•ç‹¬è§†å›¾è¿›è¡Œç‰¹æ®Šé…ç½®ï¼Œå¦‚æœæƒ³è¦å¯¹å…¨å±€è¿›è¡Œé…ç½®ï¼Œåˆ™éœ€è¦å†é…ç½®æ–‡ä»¶ä¸­å†™å…¥å³å¯ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;UNAUTHENTICATED_USER&#39;: None,</span><br><span class="line">    &#39;UNAUTHENTICATED_TOKEN&#39;: None,</span><br><span class="line">    &#39;DEFAULT_AUTHENTICATION_CLASSES&#39;: [&#39;app01.utils.auth.HeaderAuthentication&#39;, ],</span><br><span class="line">    &quot;DEFAULT_PERMISSION_CLASSES&quot;: [</span><br><span class="line">        &quot;app01.utils.permission.ManagerPermission&quot;,</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat urls.py</span><br><span class="line"></span><br><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">    url(r&#39;^api&#x2F;(?P&lt;version&gt;\w+)&#x2F;&#39;, include(&#39;app01.urls&#39;)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">$ cat app01&#x2F;urls.py </span><br><span class="line">from django.conf.urls import url</span><br><span class="line">from app01 import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^auth&#x2F;$&#39;, views.AuthView.as_view()),</span><br><span class="line">    url(r&#39;^user&#x2F;$&#39;, views.UserView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat views.py</span><br><span class="line"></span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserView(APIView):</span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # self.dispatch</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="3-3-ç”¨æˆ·è®¿é—®æ¬¡æ•°-é¢‘ç‡é™åˆ¶"><a href="#3-3-ç”¨æˆ·è®¿é—®æ¬¡æ•°-é¢‘ç‡é™åˆ¶" class="headerlink" title="3.3 ç”¨æˆ·è®¿é—®æ¬¡æ•°/é¢‘ç‡é™åˆ¶"></a>3.3 ç”¨æˆ·è®¿é—®æ¬¡æ•°/é¢‘ç‡é™åˆ¶</h3><h4 id="3-3-1-åŸºäºç”¨æˆ·IPè®¿é—®é™åˆ¶é¢‘ç‡"><a href="#3-3-1-åŸºäºç”¨æˆ·IPè®¿é—®é™åˆ¶é¢‘ç‡" class="headerlink" title="3.3.1 åŸºäºç”¨æˆ·IPè®¿é—®é™åˆ¶é¢‘ç‡"></a>3.3.1 åŸºäºç”¨æˆ·IPè®¿é—®é™åˆ¶é¢‘ç‡</h4><p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ cat urls.py</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">import time</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from rest_framework.throttling import BaseThrottle</span><br><span class="line">from rest_framework.settings import api_settings</span><br><span class="line"></span><br><span class="line"># ä¿å­˜è®¿é—®è®°å½•</span><br><span class="line">RECORD &#x3D; &#123;</span><br><span class="line">    &#39;ç”¨æˆ·IP&#39;: [12312139, 12312135, 12312133, ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestThrottle(BaseThrottle):</span><br><span class="line">    ctime &#x3D; time.time</span><br><span class="line"></span><br><span class="line">    def get_ident(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ ¹æ®ç”¨æˆ·IPå’Œä»£ç†IPï¼Œå½“åšè¯·æ±‚è€…çš„å”¯ä¸€IP</span><br><span class="line">        Identify the machine making the request by parsing HTTP_X_FORWARDED_FOR</span><br><span class="line">        if present and number of proxies is &gt; 0. If not use all of</span><br><span class="line">        HTTP_X_FORWARDED_FOR if it is available, if not use REMOTE_ADDR.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        xff &#x3D; request.META.get(&#39;HTTP_X_FORWARDED_FOR&#39;)</span><br><span class="line">        remote_addr &#x3D; request.META.get(&#39;REMOTE_ADDR&#39;)</span><br><span class="line">        num_proxies &#x3D; api_settings.NUM_PROXIES</span><br><span class="line"></span><br><span class="line">        if num_proxies is not None:</span><br><span class="line">            if num_proxies &#x3D;&#x3D; 0 or xff is None:</span><br><span class="line">                return remote_addr</span><br><span class="line">            addrs &#x3D; xff.split(&#39;,&#39;)</span><br><span class="line">            client_addr &#x3D; addrs[-min(num_proxies, len(addrs))]</span><br><span class="line">            return client_addr.strip()</span><br><span class="line"></span><br><span class="line">        return &#39;&#39;.join(xff.split()) if xff else remote_addr</span><br><span class="line"></span><br><span class="line">    def allow_request(self, request, view):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        æ˜¯å¦ä»ç„¶åœ¨å…è®¸èŒƒå›´å†…</span><br><span class="line">        Return &#96;True&#96; if the request should be allowed, &#96;False&#96; otherwise.</span><br><span class="line">        :param request: </span><br><span class="line">        :param view: </span><br><span class="line">        :return: Trueï¼Œè¡¨ç¤ºå¯ä»¥é€šè¿‡ï¼›Falseè¡¨ç¤ºå·²è¶…è¿‡é™åˆ¶ï¼Œä¸å…è®¸è®¿é—®</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # è·å–ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ï¼šIPï¼‰</span><br><span class="line"></span><br><span class="line">        # å…è®¸ä¸€åˆ†é’Ÿè®¿é—®10æ¬¡</span><br><span class="line">        num_request &#x3D; 10</span><br><span class="line">        time_request &#x3D; 60</span><br><span class="line"></span><br><span class="line">        now &#x3D; self.ctime()</span><br><span class="line">        ident &#x3D; self.get_ident(request)</span><br><span class="line">        self.ident &#x3D; ident</span><br><span class="line">        if ident not in RECORD:</span><br><span class="line">            RECORD[ident] &#x3D; [now, ]</span><br><span class="line">            return True</span><br><span class="line">        history &#x3D; RECORD[ident]</span><br><span class="line">        while history and history[-1] &lt;&#x3D; now - time_request:</span><br><span class="line">            history.pop()</span><br><span class="line">        if len(history) &lt; num_request:</span><br><span class="line">            history.insert(0, now)</span><br><span class="line">            return True</span><br><span class="line"></span><br><span class="line">    def wait(self):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        å¤šå°‘ç§’åå¯ä»¥å…è®¸ç»§ç»­è®¿é—®</span><br><span class="line">        Optionally, return a recommended number of seconds to wait before</span><br><span class="line">        the next request.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        last_time &#x3D; RECORD[self.ident][0]</span><br><span class="line">        now &#x3D; self.ctime()</span><br><span class="line">        return int(60 + last_time - now)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    throttle_classes &#x3D; [TestThrottle, ]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # self.dispatch</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def throttled(self, request, wait):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è®¿é—®æ¬¡æ•°è¢«é™åˆ¶æ—¶ï¼Œå®šåˆ¶é”™è¯¯ä¿¡æ¯</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        class Throttled(exceptions.Throttled):</span><br><span class="line">            default_detail &#x3D; &#39;è¯·æ±‚è¢«é™åˆ¶.&#39;</span><br><span class="line">            extra_detail_singular &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line">            extra_detail_plural &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line">            </span><br><span class="line">        raise Throttled(wait)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-åŸºäºç”¨æˆ·IPæ§åˆ¶è®¿é—®é¢‘ç‡-åˆ©ç”¨Djangoç¼“å­˜"><a href="#3-3-2-åŸºäºç”¨æˆ·IPæ§åˆ¶è®¿é—®é¢‘ç‡-åˆ©ç”¨Djangoç¼“å­˜" class="headerlink" title="3.3.2 åŸºäºç”¨æˆ·IPæ§åˆ¶è®¿é—®é¢‘ç‡(åˆ©ç”¨Djangoç¼“å­˜)"></a>3.3.2 åŸºäºç”¨æˆ·IPæ§åˆ¶è®¿é—®é¢‘ç‡(åˆ©ç”¨Djangoç¼“å­˜)</h4><p>å…¨å±€é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_THROTTLE_RATES&#39;: &#123;</span><br><span class="line">        &#39;test_scope&#39;: &#39;10&#x2F;m&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from rest_framework.throttling import SimpleRateThrottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestThrottle(SimpleRateThrottle):</span><br><span class="line"></span><br><span class="line">    # é…ç½®æ–‡ä»¶å®šä¹‰çš„æ˜¾ç¤ºé¢‘ç‡çš„Key</span><br><span class="line">    scope &#x3D; &quot;test_scope&quot;</span><br><span class="line"></span><br><span class="line">    def get_cache_key(self, request, view):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Should return a unique cache-key which can be used for throttling.</span><br><span class="line">        Must be overridden.</span><br><span class="line"></span><br><span class="line">        May return &#96;None&#96; if the request should not be throttled.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if not request.user:</span><br><span class="line">            ident &#x3D; self.get_ident(request)</span><br><span class="line">        else:</span><br><span class="line">            ident &#x3D; request.user</span><br><span class="line"></span><br><span class="line">        return self.cache_format % &#123;</span><br><span class="line">            &#39;scope&#39;: self.scope,</span><br><span class="line">            &#39;ident&#39;: ident</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    throttle_classes &#x3D; [TestThrottle, ]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # self.dispatch</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def throttled(self, request, wait):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è®¿é—®æ¬¡æ•°è¢«é™åˆ¶æ—¶ï¼Œå®šåˆ¶é”™è¯¯ä¿¡æ¯</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        class Throttled(exceptions.Throttled):</span><br><span class="line">            default_detail &#x3D; &#39;è¯·æ±‚è¢«é™åˆ¶.&#39;</span><br><span class="line">            extra_detail_singular &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line">            extra_detail_plural &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line"></span><br><span class="line">        raise Throttled(wait)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-3-åœ¨è¯•å›¾ä¸­é™åˆ¶è¯·æ±‚é¢‘ç‡"><a href="#3-3-3-åœ¨è¯•å›¾ä¸­é™åˆ¶è¯·æ±‚é¢‘ç‡" class="headerlink" title="3.3.3 åœ¨è¯•å›¾ä¸­é™åˆ¶è¯·æ±‚é¢‘ç‡"></a>3.3.3 åœ¨è¯•å›¾ä¸­é™åˆ¶è¯·æ±‚é¢‘ç‡</h4><p>å…¨å±€é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_THROTTLE_RATES&#39;: &#123;</span><br><span class="line">        &#39;request_scope&#39;: &#39;10&#x2F;m&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line">from rest_framework import exceptions</span><br><span class="line">from rest_framework.throttling import ScopedRateThrottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»§æ‰¿ ScopedRateThrottle</span><br><span class="line">class TestThrottle(ScopedRateThrottle):</span><br><span class="line"></span><br><span class="line">    def get_cache_key(self, request, view):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        Should return a unique cache-key which can be used for throttling.</span><br><span class="line">        Must be overridden.</span><br><span class="line"></span><br><span class="line">        May return &#96;None&#96; if the request should not be throttled.</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        if not request.user:</span><br><span class="line">            ident &#x3D; self.get_ident(request)</span><br><span class="line">        else:</span><br><span class="line">            ident &#x3D; request.user</span><br><span class="line"></span><br><span class="line">        return self.cache_format % &#123;</span><br><span class="line">            &#39;scope&#39;: self.scope,</span><br><span class="line">            &#39;ident&#39;: ident</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    throttle_classes &#x3D; [TestThrottle, ]</span><br><span class="line"></span><br><span class="line">    # åœ¨settingsä¸­è·å– xxxxxx å¯¹åº”çš„é¢‘ç‡é™åˆ¶å€¼</span><br><span class="line">    throttle_scope &#x3D; &quot;xxxxxx&quot;</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # self.dispatch</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def throttled(self, request, wait):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è®¿é—®æ¬¡æ•°è¢«é™åˆ¶æ—¶ï¼Œå®šåˆ¶é”™è¯¯ä¿¡æ¯</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">        class Throttled(exceptions.Throttled):</span><br><span class="line">            default_detail &#x3D; &#39;è¯·æ±‚è¢«é™åˆ¶.&#39;</span><br><span class="line">            extra_detail_singular &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line">            extra_detail_plural &#x3D; &#39;è¯· &#123;wait&#125; ç§’ä¹‹åå†é‡è¯•.&#39;</span><br><span class="line"></span><br><span class="line">        raise Throttled(wait)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-åŒ¿åæ—¶ç”¨IPé™åˆ¶-ç™»å½•æ—¶ç”¨Tokené™åˆ¶"><a href="#3-3-4-åŒ¿åæ—¶ç”¨IPé™åˆ¶-ç™»å½•æ—¶ç”¨Tokené™åˆ¶" class="headerlink" title="3.3.4 åŒ¿åæ—¶ç”¨IPé™åˆ¶+ç™»å½•æ—¶ç”¨Tokené™åˆ¶"></a>3.3.4 åŒ¿åæ—¶ç”¨IPé™åˆ¶+ç™»å½•æ—¶ç”¨Tokené™åˆ¶</h4><p>å…¨å±€é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;UNAUTHENTICATED_USER&#39;: None,</span><br><span class="line">    &#39;UNAUTHENTICATED_TOKEN&#39;: None,</span><br><span class="line">    &#39;DEFAULT_THROTTLE_RATES&#39;: &#123;</span><br><span class="line">        &#39;backend_anon&#39;: &#39;10&#x2F;m&#39;,</span><br><span class="line">        &#39;backend_user&#39;: &#39;20&#x2F;m&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views.s3_throttling import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># !&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line">from rest_framework.throttling import SimpleRateThrottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BackendAnonRateThrottle(SimpleRateThrottle):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    åŒ¿åç”¨æˆ·ï¼Œæ ¹æ®IPè¿›è¡Œé™åˆ¶</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    scope &#x3D; &quot;backend_anon&quot;</span><br><span class="line"></span><br><span class="line">    def get_cache_key(self, request, view):</span><br><span class="line">        # ç”¨æˆ·å·²ç™»å½•ï¼Œåˆ™è·³è¿‡ åŒ¿åé¢‘ç‡é™åˆ¶</span><br><span class="line">        if request.user:</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">        return self.cache_format % &#123;</span><br><span class="line">            &#39;scope&#39;: self.scope,</span><br><span class="line">            &#39;ident&#39;: self.get_ident(request)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class BackendUserRateThrottle(SimpleRateThrottle):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    ç™»å½•ç”¨æˆ·ï¼Œæ ¹æ®ç”¨æˆ·tokené™åˆ¶</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    scope &#x3D; &quot;backend_user&quot;</span><br><span class="line"></span><br><span class="line">    def get_ident(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è®¤è¯æˆåŠŸæ—¶ï¼šrequest.useræ˜¯ç”¨æˆ·å¯¹è±¡ï¼›request.authæ˜¯tokenå¯¹è±¡</span><br><span class="line">        :param request:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # return request.auth.token</span><br><span class="line">        return &quot;user_token&quot;</span><br><span class="line"></span><br><span class="line">    def get_cache_key(self, request, view):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        è·å–ç¼“å­˜key</span><br><span class="line">        :param request:</span><br><span class="line">        :param view:</span><br><span class="line">        :return:</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        # æœªç™»å½•ç”¨æˆ·ï¼Œåˆ™è·³è¿‡ Tokené™åˆ¶</span><br><span class="line">        if not request.user:</span><br><span class="line">            return None</span><br><span class="line"></span><br><span class="line">        return self.cache_format % &#123;</span><br><span class="line">            &#39;scope&#39;: self.scope,</span><br><span class="line">            &#39;ident&#39;: self.get_ident(request)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    throttle_classes &#x3D; [BackendAnonRateThrottle, BackendUserRateThrottle, ]</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # self.dispatch</span><br><span class="line">        print(request.user)</span><br><span class="line">        print(request.auth)</span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-5-å…¨å±€ä½¿ç”¨"><a href="#3-3-5-å…¨å±€ä½¿ç”¨" class="headerlink" title="3.3.5 å…¨å±€ä½¿ç”¨"></a>3.3.5 å…¨å±€ä½¿ç”¨</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_THROTTLE_CLASSES&#39;: [</span><br><span class="line">        &#39;api.utils.throttles.throttles.BackendAnonRateThrottle&#39;,</span><br><span class="line">        &#39;api.utils.throttles.throttles.BackendUserRateThrottle&#39;,</span><br><span class="line">    ],</span><br><span class="line">    &#39;DEFAULT_THROTTLE_RATES&#39;: &#123;</span><br><span class="line">        &#39;anon&#39;: &#39;10&#x2F;day&#39;,</span><br><span class="line">        &#39;user&#39;: &#39;10&#x2F;day&#39;,</span><br><span class="line">        &#39;backend_anon&#39;: &#39;10&#x2F;m&#39;,</span><br><span class="line">        &#39;backend_user&#39;: &#39;20&#x2F;m&#39;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-ç‰ˆæœ¬"><a href="#3-4-ç‰ˆæœ¬" class="headerlink" title="3.4 ç‰ˆæœ¬"></a>3.4 ç‰ˆæœ¬</h3><p>å…±6ä¸ªç±»</p>
<ol>
<li>BaseVersioning</li>
<li>AcceptHeaderVersioning</li>
<li>URLPathVersioning</li>
<li>NamespaceVersioning</li>
<li>HostNameVersioning</li>
<li>QueryParameterVersioning<br>è€Œä¸”è¿˜å¯ä»¥çœ‹åˆ°BaseVersioningç±»æ˜¯å…¶ä½™5ä¸ªç±»çš„çˆ¶ç±»,å¹¶ä¸”è¿™å…¶ä½™çš„5ä¸ªç±»,æ¯ä¸ªç±»ä¸­éƒ½æœ‰ä¸€ä¸ªdetermine_versionæ–¹æ³•,åœ¨é¡¹ç›®çš„è§†å›¾å‡½æ•°ä¸­å¯¼å…¥å…¶ä¸­ä»»æ„ä¸€ä¸ªç±»,æ‰“å°versioning_class<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.shortcuts import render,HttpResponse</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from django.views import View</span><br><span class="line">from rest_framework.versioning import QueryParameterVersioning</span><br><span class="line"></span><br><span class="line">class UsersView(APIView):</span><br><span class="line">    versioning_class&#x3D;QueryParameterVersioning</span><br><span class="line"></span><br><span class="line">    def get(self,request,*args,**kwargs):</span><br><span class="line">        print(self.versioning_class)        #æ‰“å°versioning_class</span><br><span class="line"></span><br><span class="line">        return HttpResponse(&quot;aaaa&quot;)</span><br></pre></td></tr></table></figure>
è¾“å‡ºç»“æœ:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;class &#39;rest_framework.versioning.QueryParameterVersioning&#39;&gt;</span><br></pre></td></tr></table></figure>
æ‰€ä»¥versioning_classæ˜¯ä¸€ä¸ªç±»,å¹¶ä¸”versioning_classç±»ä¸­æœ‰ä¸€ä¸ªdetermine_versionæ–¹æ³•</li>
</ol>
<h4 id="3-4-1-åŸºäºURLçš„GETä¼ å‚æ–¹å¼"><a href="#3-4-1-åŸºäºURLçš„GETä¼ å‚æ–¹å¼" class="headerlink" title="3.4.1 åŸºäºURLçš„GETä¼ å‚æ–¹å¼"></a>3.4.1 åŸºäºURLçš„GETä¼ å‚æ–¹å¼</h4><p>å¦‚ï¼š/users?version=v1<br>å…¨å±€é…ç½®</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_VERSION&#39;: &#39;v1&#39;,            # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">    &#39;ALLOWED_VERSIONS&#39;: [&#39;v1&#39;, &#39;v2&#39;],   # å…è®¸çš„ç‰ˆæœ¬</span><br><span class="line">    &#39;VERSION_PARAM&#39;: &#39;version&#39;          # URLä¸­è·å–å€¼çš„key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from django.conf.urls import url, include</span><br><span class="line">from app01.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.versioning import QueryParameterVersioning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    versioning_class &#x3D; QueryParameterVersioning</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # è·å–ç‰ˆæœ¬</span><br><span class="line">        print(request.version)</span><br><span class="line">        # è·å–ç‰ˆæœ¬ç®¡ç†çš„ç±»</span><br><span class="line">        print(request.versioning_scheme)</span><br><span class="line"></span><br><span class="line">        # åå‘ç”ŸæˆURL</span><br><span class="line">        reverse_url &#x3D; request.versioning_scheme.reverse(&#39;test&#39;, request&#x3D;request)</span><br><span class="line">        print(reverse_url)</span><br><span class="line"></span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-åŸºäºURLçš„æ­£åˆ™æ–¹å¼"><a href="#3-4-2-åŸºäºURLçš„æ­£åˆ™æ–¹å¼" class="headerlink" title="3.4.2 åŸºäºURLçš„æ­£åˆ™æ–¹å¼"></a>3.4.2 åŸºäºURLçš„æ­£åˆ™æ–¹å¼</h4><p>å¦‚: /v1/users/</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_VERSION&#39;: &#39;v1&#39;,            # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">    &#39;ALLOWED_VERSIONS&#39;: [&#39;v1&#39;, &#39;v2&#39;],   # å…è®¸çš„ç‰ˆæœ¬</span><br><span class="line">    &#39;VERSION_PARAM&#39;: &#39;version&#39;          # URLä¸­è·å–å€¼çš„key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^(?P&lt;version&gt;[v1|v2]+)&#x2F;test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.versioning import URLPathVersioning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    versioning_class &#x3D; URLPathVersioning</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # è·å–ç‰ˆæœ¬</span><br><span class="line">        print(request.version)</span><br><span class="line">        # è·å–ç‰ˆæœ¬ç®¡ç†çš„ç±»</span><br><span class="line">        print(request.versioning_scheme)</span><br><span class="line"></span><br><span class="line">        # åå‘ç”ŸæˆURL</span><br><span class="line">        reverse_url &#x3D; request.versioning_scheme.reverse(&#39;test&#39;, request&#x3D;request)</span><br><span class="line">        print(reverse_url)</span><br><span class="line"></span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-3-åŸºäºacceptè¯·æ±‚å¤´æ–¹å¼"><a href="#3-4-3-åŸºäºacceptè¯·æ±‚å¤´æ–¹å¼" class="headerlink" title="3.4.3 åŸºäºacceptè¯·æ±‚å¤´æ–¹å¼"></a>3.4.3 åŸºäºacceptè¯·æ±‚å¤´æ–¹å¼</h4><p>å¦‚ï¼šAccept: application/json; version=1.0</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_VERSION&#39;: &#39;v1&#39;,            # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">    &#39;ALLOWED_VERSIONS&#39;: [&#39;v1&#39;, &#39;v2&#39;],   # å…è®¸çš„ç‰ˆæœ¬</span><br><span class="line">    &#39;VERSION_PARAM&#39;: &#39;version&#39;          # URLä¸­è·å–å€¼çš„key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># !&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.versioning import AcceptHeaderVersioning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    versioning_class &#x3D; AcceptHeaderVersioning</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # è·å–ç‰ˆæœ¬ HTTP_ACCEPTå¤´</span><br><span class="line">        print(request.version)</span><br><span class="line">        # è·å–ç‰ˆæœ¬ç®¡ç†çš„ç±»</span><br><span class="line">        print(request.versioning_scheme)</span><br><span class="line">        # åå‘ç”ŸæˆURL</span><br><span class="line">        reverse_url &#x3D; request.versioning_scheme.reverse(&#39;test&#39;, request&#x3D;request)</span><br><span class="line">        print(reverse_url)</span><br><span class="line"></span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºAcceptè¯·æ±‚å¤´æ–¹å¼&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹ï¼ŒåŸºäºAcceptè¯·æ±‚å¤´æ–¹å¼&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹ï¼ŒåŸºäºAcceptè¯·æ±‚å¤´æ–¹å¼&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-4-åŸºäºä¸»æœºåæ–¹å¼"><a href="#3-4-4-åŸºäºä¸»æœºåæ–¹å¼" class="headerlink" title="3.4.4 åŸºäºä¸»æœºåæ–¹å¼"></a>3.4.4 åŸºäºä¸»æœºåæ–¹å¼</h4><p>å¦‚: v1.example.com</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ALLOWED_HOSTS &#x3D; [&#39;*&#39;]</span><br><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_VERSION&#39;: &#39;v1&#39;,  # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">    &#39;ALLOWED_VERSIONS&#39;: [&#39;v1&#39;, &#39;v2&#39;],  # å…è®¸çš„ç‰ˆæœ¬</span><br><span class="line">    &#39;VERSION_PARAM&#39;: &#39;version&#39;  # URLä¸­è·å–å€¼çš„key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from web.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># !&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.versioning import HostNameVersioning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    versioning_class &#x3D; HostNameVersioning</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # è·å–ç‰ˆæœ¬</span><br><span class="line">        print(request.version)</span><br><span class="line">        # è·å–ç‰ˆæœ¬ç®¡ç†çš„ç±»</span><br><span class="line">        print(request.versioning_scheme)</span><br><span class="line">        # åå‘ç”ŸæˆURL</span><br><span class="line">        reverse_url &#x3D; request.versioning_scheme.reverse(&#39;test&#39;, request&#x3D;request)</span><br><span class="line">        print(reverse_url)</span><br><span class="line"></span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºä¸»æœºåæ–¹å¼&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºä¸»æœºåæ–¹å¼&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºä¸»æœºåæ–¹å¼&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="3-4-5-åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace"><a href="#3-4-5-åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace" class="headerlink" title="3.4.5 åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace"></a>3.4.5 åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace</h4><p>å¦‚: example.com/v1/users/</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">REST_FRAMEWORK &#x3D; &#123;</span><br><span class="line">    &#39;DEFAULT_VERSION&#39;: &#39;v1&#39;,  # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">    &#39;ALLOWED_VERSIONS&#39;: [&#39;v1&#39;, &#39;v2&#39;],  # å…è®¸çš„ç‰ˆæœ¬</span><br><span class="line">    &#39;VERSION_PARAM&#39;: &#39;version&#39;  # URLä¸­è·å–å€¼çš„key</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·¯ç”±</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from django.conf.urls import url, include</span><br><span class="line">from app01.views import TestView</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    url(r&#39;^v1&#x2F;&#39;, ([</span><br><span class="line">                      url(r&#39;test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test1&#39;)</span><br><span class="line">                  ], None, &#39;v1&#39;)),</span><br><span class="line">    url(r&#39;^v2&#x2F;&#39;, ([</span><br><span class="line">                      url(r&#39;test&#x2F;&#39;, TestView.as_view(), name&#x3D;&#39;test2&#39;)</span><br><span class="line">                  ], None, &#39;v2&#39;)),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è¯•å›¾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># !&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">from rest_framework.versioning import NamespaceVersioning</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestView(APIView):</span><br><span class="line">    authentication_classes &#x3D; []</span><br><span class="line">    permission_classes &#x3D; []</span><br><span class="line">    versioning_class &#x3D; NamespaceVersioning</span><br><span class="line"></span><br><span class="line">    def get(self, request, *args, **kwargs):</span><br><span class="line">        # è·å–ç‰ˆæœ¬</span><br><span class="line">        print(request.version)</span><br><span class="line">        # è·å–ç‰ˆæœ¬ç®¡ç†çš„ç±»</span><br><span class="line">        print(request.versioning_scheme)</span><br><span class="line">        # åå‘ç”ŸæˆURL</span><br><span class="line">        reverse_url &#x3D; request.versioning_scheme.reverse(&#39;test1&#39;, request&#x3D;request)</span><br><span class="line">        print(reverse_url)</span><br><span class="line"></span><br><span class="line">        return Response(&#39;GETè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace&#39;)</span><br><span class="line"></span><br><span class="line">    def post(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace&#39;)</span><br><span class="line"></span><br><span class="line">    def put(self, request, *args, **kwargs):</span><br><span class="line">        return Response(&#39;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹,åŸºäºDjangoè·¯ç”±ç³»ç»Ÿçš„namespace&#39;)</span><br><span class="line">&#96;&#96;&#96;        </span><br><span class="line">#### 3.4.6 å…¨å±€åº”ç”¨</span><br></pre></td></tr></table></figure>
<p>REST_FRAMEWORK = {<br>    â€˜DEFAULT_VERSIONING_CLASSâ€™:â€rest_framework.versioning.URLPathVersioningâ€,<br>    â€˜DEFAULT_VERSIONâ€™: â€˜v1â€™,<br>    â€˜ALLOWED_VERSIONSâ€™: [â€˜v1â€™, â€˜v2â€™],<br>    â€˜VERSION_PARAMâ€™: â€˜versionâ€™<br>}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.4.7 è‡ªå®šä¹‰ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆ</span><br><span class="line">è¦å®ç°è‡ªå®šä¹‰ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆï¼Œè¯·ç»§æ‰¿ BaseVersioningå¹¶è¦†ç›– .determine_version æ–¹æ³•ã€‚</span><br><span class="line">ä¸¾ä¸ªæ —å­</span><br><span class="line">ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨è‡ªå®šä¹‰çš„ X-API-Version header æ¥ç¡®å®šæ‰€è¯·æ±‚çš„ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>
<p>class XAPIVersionScheme(versioning.BaseVersioning):<br>    def determine_version(self, request, <em>args, *</em>kwargs):<br>        return request.META.get(â€˜HTTP_X_API_VERSIONâ€™, None)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">å¦‚æœä½ çš„ç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆåŸºäºè¯·æ±‚ URLï¼Œåˆ™è¿˜éœ€è¦æ›´æ”¹ç‰ˆæœ¬åŒ– URL çš„ç¡®å®šæ–¹å¼ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ åº”è¯¥é‡å†™ç±»çš„ .reverse()æ–¹æ³•ã€‚æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚é˜…æºä»£ç ã€‚</span><br><span class="line"></span><br><span class="line">### 3.5 è§£æå™¨(parser)</span><br><span class="line">æ ¹æ®è¯·æ±‚å¤´content-typeé€‰æ‹©å¯¹åº”çš„è§£æå™¨å°±è¯·æ±‚ä½“å†…å®¹è¿›è¡Œå¤„ç†</span><br><span class="line">#### 3.5.1 ä»…å¤„ç†è¯·æ±‚å¤´content-typeä¸ºapplication&#x2F;jsonçš„è¯·æ±‚ä½“</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views.s5_parser import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python"><a href="#usr-bin-env-python" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework.parsers import JSONParser</p>
<p>class TestView(APIView):<br>    parser_classes = [JSONParser, ]</p>
<pre><code>def post(self, request, *args, **kwargs):
    print(request.content_type)

    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)

    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)

    return Response(&apos;POSTè¯·æ±‚ï¼Œè¯·æ±‚å†…å®¹: %s&apos; % request.data)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹ï¼Œè§£æå™¨&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.5.2 ä»…å¤„ç†è¯·æ±‚å¤´content-typeä¸ºapplication&#x2F;x-www-form-urlencodedçš„è¯·æ±‚ä½“</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework.request import Request<br>from rest_framework.parsers import FormParser</p>
<p>class TestView(APIView):<br>    parser_classes = [FormParser, ]</p>
<pre><code>def post(self, request, *args, **kwargs):
    print(request.content_type)

    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)

    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)

    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.5.3 ä»…å¤„ç†è¯·æ±‚å¤´content-typeä¸ºmultipart&#x2F;form-dataçš„è¯·æ±‚ä½“</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-1"><a href="#usr-bin-env-python-1" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-2"><a href="#coding-utf-8-2" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from django.shortcuts import render<br>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework.parsers import MultiPartParser</p>
<p>class TestView(APIView):<br>    authentication_classes = []<br>    permission_classes = []<br>    parser_classes = [MultiPartParser, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    return render(request, &apos;test.html&apos;)

def post(self, request, *args, **kwargs):
    print(request.content_type)

    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)
    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)
    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¨¡ç‰ˆæ–‡ä»¶</span><br></pre></td></tr></table></figure>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="shuke's Blog" type="application/atom+xml">
</head>
<body>
<form action="http://127.0.0.1:8000/test/" method="post" enctype="multipart/form-data">
    <input type="text" name="user">
    <input type="file" name="img">

<pre><code>&lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;</code></pre></form>
</body>
</html>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.5.4 ä»…ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
from django.conf.urls import url, include
from web.views import TestView

<p>urlpatterns = [<br>    url(râ€™test/(?P<filename>[^/]+)â€™, TestView.as_view(), name=â€™testâ€™),<br>]</filename></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-2"><a href="#usr-bin-env-python-2" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-3"><a href="#coding-utf-8-3" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework.parsers import FileUploadParser</p>
<p>class TestView(APIView):<br>    authentication_classes = []<br>    permission_classes = []<br>    parser_classes = [FileUploadParser, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    return render(request, &apos;test.html&apos;)

def post(self, request, filename, *args, **kwargs):
    print(filename)
    print(request.content_type)

    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)
    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)
    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¨¡ç‰ˆæ–‡ä»¶</span><br></pre></td></tr></table></figure>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<form action="http://127.0.0.1:8000/test/f1.numbers" method="post" enctype="multipart/form-data">
    <input type="text" name="user">
    <input type="file" name="img">

<pre><code>&lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;</code></pre></form>
</body>
</html>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.5.5 åŒæ—¶å¤šä¸ªParser</span><br><span class="line">å½“åŒæ—¶ä½¿ç”¨å¤šä¸ªparseræ—¶ï¼Œrest frameworkä¼šæ ¹æ®è¯·æ±‚å¤´content-typeè‡ªåŠ¨è¿›è¡Œæ¯”å¯¹ï¼Œå¹¶ä½¿ç”¨å¯¹åº”parser</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
from django.conf.urls import url, include
from web.views import TestView

<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-3"><a href="#usr-bin-env-python-3" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-4"><a href="#coding-utf-8-4" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework.parsers import JSONParser, FormParser, MultiPartParser</p>
<p>class TestView(APIView):<br>    parser_classes = [JSONParser, FormParser, MultiPartParser, ]</p>
<pre><code>def post(self, request, *args, **kwargs):
    print(request.content_type)

    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)
    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)
    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.5.6 å…¨å±€åº”ç”¨</span><br></pre></td></tr></table></figure>
<p>REST_FRAMEWORK = {<br>    â€˜DEFAULT_PARSER_CLASSESâ€™:[<br>        â€˜rest_framework.parsers.JSONParserâ€™<br>        â€˜rest_framework.parsers.FormParserâ€™<br>        â€˜rest_framework.parsers.MultiPartParserâ€™<br>    ]</p>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-5"><a href="#coding-utf-8-5" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response</p>
<p>class TestView(APIView):<br>    def post(self, request, <em>args, *</em>kwargs):<br>        print(request.content_type)</p>
<pre><code>    # è·å–è¯·æ±‚çš„å€¼ï¼Œå¹¶ä½¿ç”¨å¯¹åº”çš„JSONParserè¿›è¡Œå¤„ç†
    print(request.data)
    # application/x-www-form-urlencoded æˆ– multipart/form-dataæ—¶ï¼Œrequest.POSTä¸­æ‰æœ‰å€¼
    print(request.POST)
    print(request.FILES)
    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)

def put(self, request, *args, **kwargs):
    return Response(&apos;PUTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">âš ï¸ ä¸ªåˆ«ç‰¹æ®Šçš„å€¼å¯ä»¥é€šè¿‡Djangoçš„requestå¯¹è±¡ request\.\_request æ¥è¿›è¡Œè·å–</span><br><span class="line"></span><br><span class="line">### 3.6 åºåˆ—åŒ–</span><br><span class="line">åºåˆ—åŒ–ç”¨äºå¯¹ç”¨æˆ·è¯·æ±‚æ•°æ®è¿›è¡ŒéªŒè¯å’Œæ•°æ®è¿›è¡Œåºåˆ—åŒ–</span><br><span class="line">#### 3.6.1 è‡ªå®šä¹‰å­—æ®µ</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from app01.views import TestView</p>
<p>urlpatterns = [<br>    url(râ€™^test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">models</span><br></pre></td></tr></table></figure>
<p>from django.db import models</p>
<h1 id="Create-your-models-here"><a href="#Create-your-models-here" class="headerlink" title="Create your models here."></a>Create your models here.</h1><p>from django.db import models</p>
<p>class UserInfo(models.Model):<br>    user_type_choices = (<br>        (1, â€˜æ™®é€šç”¨æˆ·â€™),<br>        (2, â€˜ç®¡ç†å‘˜â€™),<br>        (3, â€˜è¶…çº§ç®¡ç†å‘˜â€™),<br>    )<br>    username = models.CharField(max_length=32)<br>    password = models.CharField(max_length=64)<br>    user_type = models.IntegerField(choices=user_type_choices, default=1)</p>
<p>class UserToken(models.Model):<br>    user = models.OneToOneField(â€˜UserInfoâ€™, on_delete=True)<br>    token = models.CharField(max_length=64)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-4"><a href="#usr-bin-env-python-4" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-6"><a href="#coding-utf-8-6" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from . import models</p>
<p>class PasswordValidator(object):<br>    def <strong>init</strong>(self, base):<br>        self.base = base</p>
<pre><code>def __call__(self, value):
    if value != self.base:
        message = &apos;This field must be %s.&apos; % self.base
        raise serializers.ValidationError(message)

def set_context(self, serializer_field):
    &quot;&quot;&quot;
    This hook is called by the serializer instance,
    prior to the validation call being made.
    &quot;&quot;&quot;
    # æ‰§è¡ŒéªŒè¯ä¹‹å‰è°ƒç”¨,serializer_fieldsæ˜¯å½“å‰å­—æ®µå¯¹è±¡
    pass</code></pre><p>class UserSerializer(serializers.Serializer):<br>    user_type = serializers.IntegerField()<br>    username = serializers.CharField(min_length=3)<br>    password = serializers.CharField(error_messages={â€˜requiredâ€™: â€˜å¯†ç ä¸èƒ½ä¸ºç©ºâ€™}, validators=[PasswordValidator(â€˜666â€™)])</p>
<p>class TestView(APIView):<br>    authentication_classes = []<br>    permission_classes = []</p>
<pre><code>def get(self, request, *args, **kwargs):

    # åºåˆ—åŒ–ï¼Œå°†æ•°æ®åº“æŸ¥è¯¢å­—æ®µåºåˆ—åŒ–ä¸ºå­—å…¸
    data_list = models.UserInfo.objects.all()
    ser = UserSerializer(instance=data_list, many=True)
    # æˆ–
    # obj = models.UserInfo.objects.all().first()
    # ser = UserSerializer(instance=obj, many=False)
    return Response(ser.data)

def post(self, request, *args, **kwargs):
    # éªŒè¯ï¼Œå¯¹è¯·æ±‚å‘æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯
    ser = UserSerializer(data=request.data)
    if ser.is_valid():
        print(ser.validated_data)
    else:
        print(ser.errors)

    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">POSTéªŒè¯:</span><br></pre></td></tr></table></figure>
<p>curl -X POST <br>  <a href="http://127.0.0.1:8001/test/" target="_blank" rel="noopener">http://127.0.0.1:8001/test/</a> <br>  -H â€˜Cache-Control: no-cacheâ€™ <br>  -H â€˜Content-Type: application/jsonâ€™ <br>  -H â€˜Postman-Token: 4ea5d1d1-e3b1-38a3-19f6-25070ace2342â€™ <br>  -d â€˜{<br>        â€œuser_typeâ€: 2,<br>        â€œusernameâ€: â€œpythonâ€,<br>        â€œpasswordâ€: â€œ666â€<br>    }â€™</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.6.2 åŸºäºModelè‡ªåŠ¨ç”Ÿæˆå­—æ®µ</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views.s6_serializers import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-7"><a href="#coding-utf-8-7" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from .. import models</p>
<p>class PasswordValidator(object):<br>    def <strong>init</strong>(self, base):<br>        self.base = str(base)</p>
<pre><code>def __call__(self, value):
    if value != self.base:
        message = &apos;This field must be %s.&apos; % self.base
        raise serializers.ValidationError(message)

def set_context(self, serializer_field):
    &quot;&quot;&quot;
    This hook is called by the serializer instance,
    prior to the validation call being made.
    &quot;&quot;&quot;
    # æ‰§è¡ŒéªŒè¯ä¹‹å‰è°ƒç”¨,serializer_fieldsæ˜¯å½“å‰å­—æ®µå¯¹è±¡
    pass</code></pre><p>class ModelUserSerializer(serializers.ModelSerializer):</p>
<pre><code>user = serializers.CharField(max_length=32)

class Meta:
    model = models.UserInfo
    fields = &quot;__all__&quot;
    # fields = [&apos;user&apos;, &apos;pwd&apos;, &apos;ut&apos;]
    depth = 2
    extra_kwargs = {&apos;user&apos;: {&apos;min_length&apos;: 6}, &apos;pwd&apos;: {&apos;validators&apos;: [PasswordValidator(666), ]}}
    # read_only_fields = [&apos;user&apos;]</code></pre><p>class TestView(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):</p>
<pre><code>    # åºåˆ—åŒ–ï¼Œå°†æ•°æ®åº“æŸ¥è¯¢å­—æ®µåºåˆ—åŒ–ä¸ºå­—å…¸
    data_list = models.UserInfo.objects.all()
    ser = ModelUserSerializer(instance=data_list, many=True)
    # æˆ–
    # obj = models.UserInfo.objects.all().first()
    # ser = UserSerializer(instance=obj, many=False)
    return Response(ser.data)

def post(self, request, *args, **kwargs):
    # éªŒè¯ï¼Œå¯¹è¯·æ±‚å‘æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯
    print(request.data)
    ser = ModelUserSerializer(data=request.data)
    if ser.is_valid():
        print(ser.validated_data)
    else:
        print(ser.errors)

    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.6.3 ç”ŸæˆURL</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views.s6_serializers import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>    url(râ€™detail/(?P<pk>\d+)/â€˜, TestView.as_view(), name=â€™detailâ€™),<br>]</pk></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">models</span><br></pre></td></tr></table></figure>
<p>from django.db import models</p>
<h1 id="Create-your-models-here-1"><a href="#Create-your-models-here-1" class="headerlink" title="Create your models here."></a>Create your models here.</h1><p>from django.db import models</p>
<p>class UserInfo(models.Model):<br>    user_type_choices = (<br>        (1, â€˜æ™®é€šç”¨æˆ·â€™),<br>        (2, â€˜ç®¡ç†å‘˜â€™),<br>        (3, â€˜è¶…çº§ç®¡ç†å‘˜â€™),<br>    )<br>    username = models.CharField(max_length=32)<br>    password = models.CharField(max_length=64)<br>    user_type = models.IntegerField(choices=user_type_choices, default=1)</p>
<p>class UserToken(models.Model):<br>    user = models.OneToOneField(â€˜UserInfoâ€™, on_delete=True)<br>    token = models.CharField(max_length=64)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-5"><a href="#usr-bin-env-python-5" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-8"><a href="#coding-utf-8-8" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from . import models</p>
<p>class PasswordValidator(object):<br>    def <strong>init</strong>(self, base):<br>        self.base = str(base)</p>
<pre><code>def __call__(self, value):
    if value != self.base:
        message = &apos;This field must be %s.&apos; % self.base
        raise serializers.ValidationError(message)

def set_context(self, serializer_field):
    &quot;&quot;&quot;
    This hook is called by the serializer instance,
    prior to the validation call being made.
    &quot;&quot;&quot;
    # æ‰§è¡ŒéªŒè¯ä¹‹å‰è°ƒç”¨,serializer_fieldsæ˜¯å½“å‰å­—æ®µå¯¹è±¡
    pass</code></pre><p>class ModelUserSerializer(serializers.ModelSerializer):<br>    user_type = serializers.HyperlinkedIdentityField(view_name=â€™detailâ€™)</p>
<pre><code>class Meta:
    model = models.UserInfo
    fields = &quot;__all__&quot;

    extra_kwargs = {
        &apos;username&apos;: {&apos;min_length&apos;: 6},
        &apos;pasword&apos;: {&apos;validators&apos;: [PasswordValidator(666), ]},
    }</code></pre><p>class TestView(APIView):<br>    authentication_classes = []<br>    permission_classes = []</p>
<pre><code>def get(self, request, *args, **kwargs):

    # åºåˆ—åŒ–ï¼Œå°†æ•°æ®åº“æŸ¥è¯¢å­—æ®µåºåˆ—åŒ–ä¸ºå­—å…¸
    data_list = models.UserInfo.objects.all()
    ser = ModelUserSerializer(instance=data_list, many=True, context={&apos;request&apos;: request})
    # æˆ–
    # obj = models.UserInfo.objects.all().first()
    # ser = UserSerializer(instance=obj, many=False)
    return Response(ser.data)

def post(self, request, *args, **kwargs):
    # éªŒè¯ï¼Œå¯¹è¯·æ±‚å‘æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯
    print(request.data)
    ser = ModelUserSerializer(data=request.data)
    if ser.is_valid():
        print(ser.validated_data)
    else:
        print(ser.errors)

    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚å¦‚ä¸‹å›¾æ‰€ç¤º:</span><br><span class="line">![images](https:&#x2F;&#x2F;note.youdao.com&#x2F;yws&#x2F;api&#x2F;personal&#x2F;file&#x2F;WEBe8cf0d66e9af86eaccbbfdc47f098d67?method&#x3D;download&amp;shareKey&#x3D;cff9deb39e5ad27072b3d2ccae7b1307)</span><br><span class="line"></span><br><span class="line">#### 3.6.4 è‡ªåŠ¨ç”ŸæˆURL</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from app01.views import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view(), name=â€™testâ€™),<br>    url(râ€™detail/(?P<pk>\d+)/â€˜, TestView.as_view(), name=â€™detail-infoâ€™),<br>]</pk></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-6"><a href="#usr-bin-env-python-6" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-9"><a href="#coding-utf-8-9" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from . import models</p>
<p>class PasswordValidator(object):<br>    def <strong>init</strong>(self, base):<br>        self.base = str(base)</p>
<pre><code>def __call__(self, value):
    if value != self.base:
        message = &apos;This field must be %s.&apos; % self.base
        raise serializers.ValidationError(message)

def set_context(self, serializer_field):
    &quot;&quot;&quot;
    This hook is called by the serializer instance,
    prior to the validation call being made.
    &quot;&quot;&quot;
    # æ‰§è¡ŒéªŒè¯ä¹‹å‰è°ƒç”¨,serializer_fieldsæ˜¯å½“å‰å­—æ®µå¯¹è±¡
    pass</code></pre><p>class ModelUserSerializer(serializers.HyperlinkedModelSerializer):<br>    ll = serializers.HyperlinkedIdentityField(view_name=â€™detail-infoâ€™)<br>    tt = serializers.CharField(required=False)</p>
<pre><code>class Meta:
    model = models.UserInfo
    fields = &quot;__all__&quot;
    list_serializer_class = serializers.ListSerializer

    extra_kwargs = {
        &apos;username&apos;: {&apos;min_length&apos;: 6},
        &apos;password&apos;: {&apos;validators&apos;: [PasswordValidator(666), ]},
        &apos;url&apos;: {&apos;view_name&apos;: &apos;detail-info&apos;},
        &apos;ut&apos;: {&apos;view_name&apos;: &apos;detail-info&apos;},
    }</code></pre><p>class TestView(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):<br>        # # åºåˆ—åŒ–ï¼Œå°†æ•°æ®åº“æŸ¥è¯¢å­—æ®µåºåˆ—åŒ–ä¸ºå­—å…¸<br>        data_list = models.UserInfo.objects.all()<br>        ser = ModelUserSerializer(instance=data_list, many=True, context={â€˜requestâ€™: request})<br>        # # å¦‚æœMany=True<br>        # # æˆ–<br>        # # obj = models.UserInfo.objects.all().first()<br>        # # ser = UserSerializer(instance=obj, many=False)<br>        return Response(ser.data)</p>
<pre><code>def post(self, request, *args, **kwargs):
    # éªŒè¯ï¼Œå¯¹è¯·æ±‚å‘æ¥çš„æ•°æ®è¿›è¡ŒéªŒè¯
    print(request.data)
    ser = ModelUserSerializer(data=request.data)
    if ser.is_valid():
        print(ser.validated_data)
    else:
        print(ser.errors)

    return Response(&apos;POSTè¯·æ±‚ï¼Œå“åº”å†…å®¹&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.7 åˆ†é¡µ</span><br><span class="line">#### 3.7.1 æ ¹æ®é¡µç è¿›è¡Œåˆ†é¡µ</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from app01.views import UserViewSet</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, UserViewSet.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-7"><a href="#usr-bin-env-python-7" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-10"><a href="#coding-utf-8-10" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework import serializers<br>from . import models</p>
<p>from rest_framework.pagination import PageNumberPagination</p>
<p>class StandardResultsSetPagination(PageNumberPagination):<br>    # é»˜è®¤æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°<br>    page_size = 1<br>    # è·å–URLå‚æ•°ä¸­è®¾ç½®çš„æ¯é¡µæ˜¾ç¤ºæ•°æ®æ¡æ•°<br>    page_size_query_param = â€˜page_sizeâ€™</p>
<pre><code># è·å–URLå‚æ•°ä¸­ä¼ å…¥çš„é¡µç key
page_query_param = &apos;page&apos;

# æœ€å¤§æ”¯æŒçš„æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°
max_page_size = 1</code></pre><p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):<br>        user_list = models.UserInfo.objects.all().order_by(â€˜-idâ€™)</p>
<pre><code># å®ä¾‹åŒ–åˆ†é¡µå¯¹è±¡ï¼Œè·å–æ•°æ®åº“ä¸­çš„åˆ†é¡µæ•°æ®
paginator = StandardResultsSetPagination()
page_user_list = paginator.paginate_queryset(user_list, self.request, view=self)

# åºåˆ—åŒ–å¯¹è±¡
serializer = UserSerializer(page_user_list, many=True)

# ç”Ÿæˆåˆ†é¡µå’Œæ•°æ®
response = paginator.get_paginated_response(serializer.data)
return response</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è®¿é—®éªŒè¯:</span><br></pre></td></tr></table></figure>
<p><a href="http://127.0.0.1:8001/test/?page=1" target="_blank" rel="noopener">http://127.0.0.1:8001/test/?page=1</a><br><a href="http://127.0.0.1:8001/test/?page=2" target="_blank" rel="noopener">http://127.0.0.1:8001/test/?page=2</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.7.2 ä½ç½®å’Œä¸ªæ•°è¿›è¡Œåˆ†é¡µ</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from app01.views import UserViewSet</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, UserViewSet.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-8"><a href="#usr-bin-env-python-8" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-11"><a href="#coding-utf-8-11" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework import serializers<br>from . import models</p>
<p>from rest_framework.pagination import PageNumberPagination, LimitOffsetPagination</p>
<p>class StandardResultsSetPagination(LimitOffsetPagination):<br>    # é»˜è®¤æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°<br>    default_limit = 2<br>    # URLä¸­ä¼ å…¥çš„æ˜¾ç¤ºæ•°æ®æ¡æ•°çš„å‚æ•°<br>    limit_query_param = â€˜limitâ€™<br>    # URLä¸­ä¼ å…¥çš„æ•°æ®ä½ç½®çš„å‚æ•°<br>    offset_query_param = â€˜offsetâ€™<br>    # æœ€å¤§æ¯é¡µæ˜¾å¾—æ¡æ•°<br>    max_limit = None</p>
<p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):<br>        user_list = models.UserInfo.objects.all().order_by(â€˜-idâ€™)</p>
<pre><code># å®ä¾‹åŒ–åˆ†é¡µå¯¹è±¡ï¼Œè·å–æ•°æ®åº“ä¸­çš„åˆ†é¡µæ•°æ®
paginator = StandardResultsSetPagination()
page_user_list = paginator.paginate_queryset(user_list, self.request, view=self)

# åºåˆ—åŒ–å¯¹è±¡
serializer = UserSerializer(page_user_list, many=True)

# ç”Ÿæˆåˆ†é¡µå’Œæ•°æ®
response = paginator.get_paginated_response(serializer.data)
return response</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">éªŒè¯:</span><br><span class="line">![ä½ç½®åˆ†é¡µ](https:&#x2F;&#x2F;note.youdao.com&#x2F;yws&#x2F;api&#x2F;personal&#x2F;file&#x2F;WEBdebc8cfb0c33b1533d1e041ed9925422?method&#x3D;download&amp;shareKey&#x3D;2b1d435332858dbe629d4c3d78b670d8)</span><br><span class="line"></span><br><span class="line">#### 3.7.3 æ¸¸æ ‡åˆ†é¡µ</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from app01.views import UserViewSet</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, UserViewSet.as_view(), name=â€™testâ€™),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<h1 id="usr-bin-env-python-9"><a href="#usr-bin-env-python-9" class="headerlink" title="!/usr/bin/env python"></a>!/usr/bin/env python</h1><h1 id="coding-utf-8-12"><a href="#coding-utf-8-12" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework import serializers<br>from . import models</p>
<p>from rest_framework.pagination import PageNumberPagination, LimitOffsetPagination, CursorPagination</p>
<p>class StandardResultsSetPagination(CursorPagination):<br>    # URLä¼ å…¥çš„æ¸¸æ ‡å‚æ•°<br>    cursor_query_param = â€˜cursorâ€™<br>    # é»˜è®¤æ¯é¡µæ˜¾ç¤ºçš„æ•°æ®æ¡æ•°<br>    page_size = 10<br>    # URLä¼ å…¥çš„æ¯é¡µæ˜¾ç¤ºæ¡æ•°çš„å‚æ•°<br>    page_size_query_param = â€˜page_sizeâ€™<br>    # æ¯é¡µæ˜¾ç¤ºæ•°æ®æœ€å¤§æ¡æ•°<br>    max_page_size = 1000</p>
<pre><code># æ ¹æ®IDä»å¤§åˆ°å°æ’åˆ—
ordering = &quot;id&quot;</code></pre><p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):<br>        user_list = models.UserInfo.objects.all().order_by(â€˜-idâ€™)</p>
<pre><code># å®ä¾‹åŒ–åˆ†é¡µå¯¹è±¡ï¼Œè·å–æ•°æ®åº“ä¸­çš„åˆ†é¡µæ•°æ®
paginator = StandardResultsSetPagination()
page_user_list = paginator.paginate_queryset(user_list, self.request, view=self)

# åºåˆ—åŒ–å¯¹è±¡
serializer = UserSerializer(page_user_list, many=True)

# ç”Ÿæˆåˆ†é¡µå’Œæ•°æ®
response = paginator.get_paginated_response(serializer.data)
return response</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 3.8  è·¯ç”±ç³»ç»Ÿ</span><br><span class="line">#### 3.8.1 è‡ªå®šä¹‰è·¯ç”±</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import s11_render</p>
<p>urlpatterns = [<br>    url(râ€™^test/$â€™, s11_render.TestView.as_view()),<br>    url(râ€™^test.(?P<format>[a-z0-9]+)$â€™, s11_render.TestView.as_view()),<br>    url(râ€™^test/(?P<pk>[^/.]+)/$â€™, s11_render.TestView.as_view()),<br>    url(râ€™^test/(?P<pk>[^/.]+).(?P<format>[a-z0-9]+)$â€™, s11_render.TestView.as_view())<br>]</format></pk></pk></format></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from .. import models</p>
<p>class TestView(APIView):<br>    def get(self, request, <em>args, *</em>kwargs):<br>        print(kwargs)<br>        print(self.renderer_classes)<br>        return Response(â€˜â€¦â€™)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.8.2 åŠè‡ªåŠ¨è·¯ç”±</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import s10_generic</p>
<p>urlpatterns = [<br>    url(râ€™^test/$â€™, s10_generic.UserViewSet.as_view({â€˜getâ€™: â€˜listâ€™, â€˜postâ€™: â€˜createâ€™})),<br>    url(râ€™^test/(?P<pk>\d+)/$â€™, s10_generic.UserViewSet.as_view(<br>        {â€˜getâ€™: â€˜retrieveâ€™, â€˜putâ€™: â€˜updateâ€™, â€˜patchâ€™: â€˜partial_updateâ€™, â€˜deleteâ€™: â€˜destroyâ€™})),<br>]</pk></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-13"><a href="#coding-utf-8-13" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.viewsets import ModelViewSet<br>from rest_framework import serializers<br>from .. import models</p>
<p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(ModelViewSet):<br>    queryset = models.UserInfo.objects.all()<br>    serializer_class = UserSerializer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.8.3 å…¨è‡ªåŠ¨è·¯ç”±</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from rest_framework import routers<br>from web.views import s10_generic</p>
<p>router = routers.DefaultRouter()<br>router.register(râ€™usersâ€™, s10_generic.UserViewSet)</p>
<p>urlpatterns = [<br>    url(râ€™^â€™, include(router.urls)),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>from rest_framework.viewsets import ModelViewSet<br>from rest_framework import serializers<br>from .. import models</p>
<p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(ModelViewSet):<br>    queryset = models.UserInfo.objects.all()<br>    serializer_class = UserSerializer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">### 3.9 è¯•å›¾</span><br><span class="line">#### 3.9.1 GenericViewSet</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views.s7_viewset import TestView</p>
<p>urlpatterns = [<br>    url(râ€™test/â€˜, TestView.as_view({â€˜getâ€™:â€™listâ€™}), name=â€™testâ€™),<br>    url(râ€™detail/(?P<pk>\d+)/â€˜, TestView.as_view({â€˜getâ€™:â€™listâ€™}), name=â€™xxxxâ€™),<br>]</pk></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-14"><a href="#coding-utf-8-14" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework import viewsets<br>from rest_framework.response import Response</p>
<p>class TestView(viewsets.GenericViewSet):<br>    def list(self, request, <em>args, *</em>kwargs):<br>        return Response(â€˜â€¦â€™)</p>
<pre><code>def add(self, request, *args, **kwargs):
    pass

def delete(self, request, *args, **kwargs):
    pass

def edit(self, request, *args, **kwargs):
    pass</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.9.2 ModelViewSet(è‡ªå®šä¹‰URL)</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import s10_generic</p>
<p>urlpatterns = [<br>    url(râ€™^test/$â€™, s10_generic.UserViewSet.as_view({â€˜getâ€™: â€˜listâ€™, â€˜postâ€™: â€˜createâ€™})),<br>    url(râ€™^test/(?P<pk>\d+)/$â€™, s10_generic.UserViewSet.as_view(<br>        {â€˜getâ€™: â€˜retrieveâ€™, â€˜putâ€™: â€˜updateâ€™, â€˜patchâ€™: â€˜partial_updateâ€™, â€˜deleteâ€™: â€˜destroyâ€™})),<br>]</pk></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-15"><a href="#coding-utf-8-15" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.viewsets import ModelViewSet<br>from rest_framework import serializers<br>from .. import models</p>
<p>class UserSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class UserViewSet(ModelViewSet):<br>    queryset = models.UserInfo.objects.all()<br>    serializer_class = UserSerializer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.9.3 ModelViewSet(rest frameworkè·¯ç”±)</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from rest_framework import routers<br>from app01 import views</p>
<p>router = routers.DefaultRouter()<br>router.register(râ€™usersâ€™, views.UserViewSet)<br>router.register(râ€™groupsâ€™, views.GroupViewSet)</p>
<h1 id="Wire-up-our-API-using-automatic-URL-routing"><a href="#Wire-up-our-API-using-automatic-URL-routing" class="headerlink" title="Wire up our API using automatic URL routing."></a>Wire up our API using automatic URL routing.</h1><h1 id="Additionally-we-include-login-URLs-for-the-browsable-API"><a href="#Additionally-we-include-login-URLs-for-the-browsable-API" class="headerlink" title="Additionally, we include login URLs for the browsable API."></a>Additionally, we include login URLs for the browsable API.</h1><p>urlpatterns = [<br>    url(râ€™^â€™, include(router.urls)),<br>]</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>from rest_framework import viewsets<br>from rest_framework import serializers</p>
<p>class UserSerializer(serializers.HyperlinkedModelSerializer):<br>    class Meta:<br>        model = models.User<br>        fields = (â€˜urlâ€™, â€˜usernameâ€™, â€˜emailâ€™, â€˜groupsâ€™)</p>
<p>class GroupSerializer(serializers.HyperlinkedModelSerializer):<br>    class Meta:<br>        model = models.Group<br>        fields = (â€˜urlâ€™, â€˜nameâ€™)</p>
<p>class UserViewSet(viewsets.ModelViewSet):<br>    â€œâ€â€<br>    API endpoint that allows users to be viewed or edited.<br>    â€œâ€â€<br>    queryset = User.objects.all().order_by(â€˜-date_joinedâ€™)<br>    serializer_class = UserSerializer</p>
<p>class GroupViewSet(viewsets.ModelViewSet):<br>    â€œâ€â€<br>    API endpoint that allows groups to be viewed or edited.<br>    â€œâ€â€<br>    queryset = Group.objects.all()<br>    serializer_class = GroupSerializer</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">### 3.10 æ¸²æŸ“å™¨</span><br><span class="line">æ ¹æ®ç”¨æˆ·è¯·æ±‚URLæˆ–ç”¨æˆ·å¯æ¥å—çš„ç±»å‹,ç­›é€‰å‡ºåˆé€‚çš„æ¸²æŸ“ç»„ä»¶</span><br><span class="line">ç”¨æˆ·è¯·æ±‚URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;json</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.json</span><br><span class="line">ç”¨æˆ·è¯·æ±‚å¤´:</span><br><span class="line">- Accept:text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8</span><br><span class="line"></span><br><span class="line">#### 3.10.1 Json</span><br><span class="line">è®¿é—®URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;json</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.json</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;</span><br><span class="line">è·¯ç”±:</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import s11_render</p>
<p>urlpatterns = [<br>    url(râ€™^test/$â€™, s11_render.TestView.as_view()),<br>    url(râ€™^test.(?P<format>[a-z0-9]+)â€™, s11_render.TestView.as_view()),<br>]</format></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-16"><a href="#coding-utf-8-16" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers</p>
<p>from rest_framework.renderers import JSONRenderer</p>
<p>from .. import models</p>
<p>class TestSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class TestView(APIView):<br>    renderer_classes = [JSONRenderer, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    user_list = models.UserInfo.objects.all()
    ser = TestSerializer(instance=user_list, many=True)
    return Response(ser.data)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.10.2 è¡¨æ ¼</span><br><span class="line">è®¿é—®URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;admin</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.admin</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;</span><br><span class="line">è¯•å›¾:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-17"><a href="#coding-utf-8-17" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from rest_framework.renderers import AdminRenderer<br>from . import models</p>
<p>class TestSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class TestView(APIView):<br>    renderer_classes = [AdminRenderer, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    user_list = models.UserInfo.objects.all()
    ser = TestSerializer(instance=user_list, many=True)
    return Response(ser.data)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.10.3 Formè¡¨å•</span><br><span class="line">è®¿é—®URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;form</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.form</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;</span><br><span class="line">è¯•å›¾:</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-18"><a href="#coding-utf-8-18" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers</p>
<p>from rest_framework.renderers import JSONRenderer<br>from rest_framework.renderers import AdminRenderer<br>from rest_framework.renderers import HTMLFormRendere<br>from . import models</p>
<p>class TestSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class TestView(APIView):<br>    renderer_classes = [HTMLFormRenderer, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    user_list = models.UserInfo.objects.all().first()
    ser = TestSerializer(instance=user_list, many=False)
    return Response(ser.data)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.10.4 è‡ªå®šä¹‰æ˜¾ç¤ºæ¨¡ç‰ˆ</span><br><span class="line">è®¿é—®URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;html</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.html</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;</span><br><span class="line">è·¯ç”±</span><br></pre></td></tr></table></figure>
<p>from django.conf.urls import url, include<br>from web.views import s11_render</p>
<p>urlpatterns = [<br>    url(râ€™^test/$â€™, s11_render.TestView.as_view()),<br>    url(râ€™^test.(?P<format>[a-z0-9]+)â€™, s11_render.TestView.as_view()),<br>]</format></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">è¯•å›¾</span><br></pre></td></tr></table></figure>
<p>#!/usr/bin/env python</p>
<h1 id="coding-utf-8-19"><a href="#coding-utf-8-19" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>from rest_framework.views import APIView<br>from rest_framework.response import Response<br>from rest_framework import serializers<br>from rest_framework.renderers import TemplateHTMLRenderer<br>from . import models</p>
<p>class TestSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class TestView(APIView):<br>    renderer_classes = [TemplateHTMLRenderer, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    user_list = models.UserInfo.objects.all().first()
    ser = TestSerializer(instance=user_list, many=False)
    return Response(ser.data, template_name=&apos;user_detail.html&apos;)</code></pre><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ¨¡ç‰ˆ</span><br></pre></td></tr></table></figure>
<p>$ cat user_detail.html<br><!DOCTYPE html></p>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    
    
    
</body>
</html>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#### 3.10.5 æµè§ˆå™¨API+JSON</span><br><span class="line">è®¿é—®URL:</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;?format&#x3D;api</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test.api</span><br><span class="line">- http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;test&#x2F;</span><br><span class="line">è¯•å›¾:</span><br></pre></td></tr></table></figure>
#!/usr/bin/env python
# -*- coding:utf-8 -*-
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import serializers
from rest_framework.renderers import JSONRenderer
from rest_framework.renderers import BrowsableAPIRenderer
from . import models

<p>class TestSerializer(serializers.ModelSerializer):<br>    class Meta:<br>        model = models.UserInfo<br>        fields = â€œ<strong>all</strong>â€œ</p>
<p>class CustomBrowsableAPIRenderer(BrowsableAPIRenderer):<br>    def get_default_renderer(self, view):<br>        return JSONRenderer()</p>
<p>class TestView(APIView):<br>    renderer_classes = [CustomBrowsableAPIRenderer, ]</p>
<pre><code>def get(self, request, *args, **kwargs):
    user_list = models.UserInfo.objects.all().first()
    ser = TestSerializer(instance=user_list, many=False)
    return Response(ser.data, template_name=&apos;user_detail.html&apos;)</code></pre><pre><code>æ³¨æ„: å¦‚æœåŒæ—¶å¤šä¸ªå­˜åœ¨æ—¶,è‡ªåŠ¨æ ¹æ®URLåç¼€æ¥é€‰æ‹©æ¸²æŸ“å™¨


[åŸæ–‡åœ°å€](http://www.cnblogs.com/wupeiqi/articles/7805382.html)





</code></pre>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Django</tag>
      </tags>
  </entry>
</search>
